(()=>{var React,ReactDOM,App,__webpack_modules__={792:(module,__unused_webpack_exports,__webpack_require__)=>{var EventEmitter=__webpack_require__(6729),ERROR=__webpack_require__(9657);function ChromecastSenderVideo(options){var containerElement=(options=options||{}).containerElement;if(!(containerElement instanceof HTMLElement))throw new Error("Container element required to be instance of HTMLElement");var chromecastTransport=options.chromecastTransport;if(!chromecastTransport)throw new Error("Chromecast transport required");var device=chromecastTransport.getCastDevice();if(null===device)throw new Error("Chromecast session must be started");var deviceNameContainerElement=document.createElement("div");deviceNameContainerElement.style.display="flex",deviceNameContainerElement.style.flexDirection="row",deviceNameContainerElement.style.alignItems="center",deviceNameContainerElement.style.justifyContent="center",deviceNameContainerElement.style.width="100%",deviceNameContainerElement.style.height="100%",deviceNameContainerElement.style.backgroundColor="black";var deviceNameLabelElement=document.createElement("div");deviceNameLabelElement.style.flex="none",deviceNameLabelElement.style.maxWidth="80%",deviceNameLabelElement.style.fontSize="5vmin",deviceNameLabelElement.style.lineHeight="1.2em",deviceNameLabelElement.style.maxHeight="3.6em",deviceNameLabelElement.style.textAlign="center",deviceNameLabelElement.style.color="#FFFFFF90",deviceNameLabelElement.innerText="Casting to "+device.friendlyName,deviceNameContainerElement.appendChild(deviceNameLabelElement),containerElement.appendChild(deviceNameContainerElement),chromecastTransport.on("message",onMessage),chromecastTransport.on("message-error",onMessageReceivedError);var events=new EventEmitter,destroyed=!1,observedProps={stream:!1,loaded:!1,paused:!1,time:!1,duration:!1,buffering:!1,buffered:!1,audioTracks:!1,selectedAudioTrackId:!1,subtitlesTracks:!1,selectedSubtitlesTrackId:!1,subtitlesOffset:!1,subtitlesSize:!1,subtitlesTextColor:!1,subtitlesBackgroundColor:!1,subtitlesOutlineColor:!1,volume:!1,muted:!1,playbackSpeed:!1,videoParams:!1,extraSubtitlesTracks:!1,selectedExtraSubtitlesTrackId:!1,extraSubtitlesDelay:!1,extraSubtitlesSize:!1,extraSubtitlesOffset:!1,extraSubtitlesTextColor:!1,extraSubtitlesBackgroundColor:!1,extraSubtitlesOutlineColor:!1};function onMessageSendError(error,action){events.emit("error",Object.assign({},ERROR.CHROMECAST_SENDER_VIDEO.MESSAGE_SEND_FAILED,{error:error,action:action}))}function onMessageReceivedError(error){events.emit("error",Object.assign({},ERROR.CHROMECAST_SENDER_VIDEO.INVALID_MESSAGE_RECEIVED,{error:error}))}function onMessage(message){if(message&&"string"==typeof message.event){var args=Array.isArray(message.args)?message.args:[];events.emit.apply(events,[message.event].concat(args))}else onMessageReceivedError(new Error("Invalid message: "+message))}function onPropChanged(propName,propValue){observedProps[propName]&&events.emit("propChanged",propName,propValue)}this.on=function(eventName,listener){if(destroyed)throw new Error("Video is destroyed");events.on(eventName,listener)},this.dispatch=function(action){if(destroyed)throw new Error("Video is destroyed");if(action)switch(action.type){case"observeProp":return propName=action.propName,observedProps.hasOwnProperty(propName)&&(observedProps[propName]=!0),void chromecastTransport.sendMessage(action).catch((function(error){onMessageSendError(error,action)}));case"setProp":return void chromecastTransport.sendMessage(action).catch((function(error){onMessageSendError(error,action)}));case"command":return(function(commandName){switch(commandName){case"destroy":destroyed=!0,onPropChanged("stream",null),onPropChanged("loaded",null),onPropChanged("paused",null),onPropChanged("time",null),onPropChanged("duration",null),onPropChanged("buffering",null),onPropChanged("buffered",null),onPropChanged("audioTracks",[]),onPropChanged("selectedAudioTrackId",[]),onPropChanged("subtitlesTracks",[]),onPropChanged("selectedSubtitlesTrackId",null),onPropChanged("subtitlesOffset",null),onPropChanged("subtitlesSize",null),onPropChanged("subtitlesTextColor",null),onPropChanged("subtitlesBackgroundColor",null),onPropChanged("subtitlesOutlineColor",null),onPropChanged("volume",null),onPropChanged("muted",null),onPropChanged("playbackSpeed",null),onPropChanged("videoParams",null),onPropChanged("extraSubtitlesTracks",[]),onPropChanged("selectedExtraSubtitlesTrackId",null),onPropChanged("extraSubtitlesDelay",null),onPropChanged("extraSubtitlesSize",null),onPropChanged("extraSubtitlesOffset",null),onPropChanged("extraSubtitlesTextColor",null),onPropChanged("extraSubtitlesBackgroundColor",null),onPropChanged("extraSubtitlesOutlineColor",null),events.removeAllListeners(),chromecastTransport.off("message",onMessage),containerElement.removeChild(deviceNameContainerElement)}})(action.commandName,action.commandArgs),void chromecastTransport.sendMessage(action).catch((function(error){onMessageSendError(error,action)}))}var propName;throw new Error("Invalid action dispatched: "+JSON.stringify(action))}}ChromecastSenderVideo.canPlayStream=function(){return Promise.resolve(!0)},ChromecastSenderVideo.manifest={name:"ChromecastSenderVideo",external:!0,props:["stream","loaded","paused","time","duration","buffering","buffered","audioTracks","selectedAudioTrackId","subtitlesTracks","selectedSubtitlesTrackId","subtitlesOffset","subtitlesSize","subtitlesTextColor","subtitlesBackgroundColor","subtitlesOutlineColor","volume","muted","playbackSpeed","videoParams","extraSubtitlesTracks","selectedExtraSubtitlesTrackId","extraSubtitlesDelay","extraSubtitlesSize","extraSubtitlesOffset","extraSubtitlesTextColor","extraSubtitlesBackgroundColor","extraSubtitlesOutlineColor"],commands:["load","unload","destroy","addExtraSubtitlesTracks"],events:["propValue","propChanged","ended","error","subtitlesTrackLoaded","audioTrackLoaded","extraSubtitlesTrackLoaded","implementationChanged"]},module.exports=ChromecastSenderVideo},3153:(module,__unused_webpack_exports,__webpack_require__)=>{var ChromecastSenderVideo=__webpack_require__(792);module.exports=ChromecastSenderVideo},1431:(module,__unused_webpack_exports,__webpack_require__)=>{var EventEmitter=__webpack_require__(6729),Hls=__webpack_require__(7631),cloneDeep=__webpack_require__(3465),deepFreeze=__webpack_require__(2682),Color=__webpack_require__(6767),ERROR=__webpack_require__(9657),getContentType=__webpack_require__(8973),HLS_CONFIG=__webpack_require__(1566);function HTMLVideo(options){var containerElement=(options=options||{}).containerElement;if(!(containerElement instanceof HTMLElement))throw new Error("Container element required to be instance of HTMLElement");var styleElement=document.createElement("style");containerElement.appendChild(styleElement),styleElement.sheet.insertRule("video::cue { font-size: 4vmin; color: rgb(255, 255, 255); background-color: rgba(0, 0, 0, 0); text-shadow: rgb(34, 34, 34) 1px 1px 0.1em; }");var videoElement=document.createElement("video");videoElement.style.width="100%",videoElement.style.height="100%",videoElement.style.backgroundColor="black",videoElement.controls=!1,videoElement.playsInline=!0,videoElement.onerror=function(){!(function(){if(destroyed)return;var error;switch(videoElement.error.code){case 1:error=ERROR.HTML_VIDEO.MEDIA_ERR_ABORTED;break;case 2:error=ERROR.HTML_VIDEO.MEDIA_ERR_NETWORK;break;case 3:error=ERROR.HTML_VIDEO.MEDIA_ERR_DECODE;break;case 4:error=ERROR.HTML_VIDEO.MEDIA_ERR_SRC_NOT_SUPPORTED;break;default:error=ERROR.UNKNOWN_ERROR}onError(Object.assign({},error,{critical:!0,error:videoElement.error}))})()},videoElement.onended=function(){events.emit("ended")},videoElement.onpause=function(){onPropChanged("paused")},videoElement.onplay=function(){onPropChanged("paused")},videoElement.ontimeupdate=function(){onPropChanged("time"),onPropChanged("buffered")},videoElement.ondurationchange=function(){onPropChanged("duration")},videoElement.onwaiting=function(){onPropChanged("buffering"),onPropChanged("buffered")},videoElement.onseeking=function(){onPropChanged("time"),onPropChanged("buffering"),onPropChanged("buffered")},videoElement.onseeked=function(){onPropChanged("time"),onPropChanged("buffering"),onPropChanged("buffered")},videoElement.onstalled=function(){onPropChanged("buffering"),onPropChanged("buffered")},videoElement.onplaying=function(){onPropChanged("time"),onPropChanged("buffering"),onPropChanged("buffered")},videoElement.oncanplay=function(){onPropChanged("buffering"),onPropChanged("buffered")},videoElement.canplaythrough=function(){onPropChanged("buffering"),onPropChanged("buffered")},videoElement.onloadedmetadata=function(){onPropChanged("loaded")},videoElement.onloadeddata=function(){onPropChanged("buffering"),onPropChanged("buffered")},videoElement.onvolumechange=function(){onPropChanged("volume"),onPropChanged("muted")},videoElement.onratechange=function(){onPropChanged("playbackSpeed")},videoElement.textTracks.onchange=function(){onPropChanged("subtitlesTracks"),onPropChanged("selectedSubtitlesTrackId"),onCueChange(),Array.from(videoElement.textTracks).forEach((function(track){track.oncuechange=onCueChange}))},containerElement.appendChild(videoElement);var hls=null,events=new EventEmitter,destroyed=!1,stream=null,subtitlesOffset=0,observedProps={stream:!1,loaded:!1,paused:!1,time:!1,duration:!1,buffering:!1,buffered:!1,subtitlesTracks:!1,selectedSubtitlesTrackId:!1,subtitlesOffset:!1,subtitlesSize:!1,subtitlesTextColor:!1,subtitlesBackgroundColor:!1,subtitlesOutlineColor:!1,audioTracks:!1,selectedAudioTrackId:!1,volume:!1,muted:!1,playbackSpeed:!1};function getProp(propName){switch(propName){case"stream":return stream;case"loaded":return null===stream?null:videoElement.readyState>=videoElement.HAVE_METADATA;case"paused":return null===stream?null:!!videoElement.paused;case"time":return null!==stream&&null!==videoElement.currentTime&&isFinite(videoElement.currentTime)?Math.floor(1e3*videoElement.currentTime):null;case"duration":return null!==stream&&null!==videoElement.duration&&isFinite(videoElement.duration)?Math.floor(1e3*videoElement.duration):null;case"buffering":return null===stream?null:videoElement.readyState<videoElement.HAVE_FUTURE_DATA;case"buffered":if(null===stream)return null;for(var time=null!==videoElement.currentTime&&isFinite(videoElement.currentTime)?videoElement.currentTime:0,i=0;i<videoElement.buffered.length;i++)if(videoElement.buffered.start(i)<=time&&time<=videoElement.buffered.end(i))return Math.floor(1e3*videoElement.buffered.end(i));return Math.floor(1e3*time);case"subtitlesTracks":return null===stream?[]:Array.from(videoElement.textTracks).map((function(track,index){return Object.freeze({id:"EMBEDDED_"+String(index),lang:track.language,label:track.label,origin:"EMBEDDED",embedded:!0})}));case"selectedSubtitlesTrackId":return null===stream?null:Array.from(videoElement.textTracks).reduce((function(result,track,index){return null===result&&"showing"===track.mode?"EMBEDDED_"+String(index):result}),null);case"subtitlesOffset":return destroyed?null:subtitlesOffset;case"subtitlesSize":return destroyed?null:25*parseInt(styleElement.sheet.cssRules[0].style.fontSize,10);case"subtitlesTextColor":return destroyed?null:styleElement.sheet.cssRules[0].style.color;case"subtitlesBackgroundColor":return destroyed?null:styleElement.sheet.cssRules[0].style.backgroundColor;case"subtitlesOutlineColor":return destroyed?null:styleElement.sheet.cssRules[0].style.textShadow.slice(0,styleElement.sheet.cssRules[0].style.textShadow.indexOf(")")+1);case"audioTracks":return null!==hls&&Array.isArray(hls.audioTracks)?hls.audioTracks.map((function(track){return Object.freeze({id:"EMBEDDED_"+String(track.id),lang:"string"==typeof track.lang&&track.lang.length>0?track.lang:"string"==typeof track.name&&track.name.length>0?track.name:String(track.id),label:"string"==typeof track.name&&track.name.length>0?track.name:"string"==typeof track.lang&&track.lang.length>0?track.lang:String(track.id),origin:"EMBEDDED",embedded:!0})})):[];case"selectedAudioTrackId":return null!==hls&&null!==hls.audioTrack&&isFinite(hls.audioTrack)&&-1!==hls.audioTrack?"EMBEDDED_"+String(hls.audioTrack):null;case"volume":return destroyed||null===videoElement.volume||!isFinite(videoElement.volume)?null:Math.floor(100*videoElement.volume);case"muted":return destroyed?null:!!videoElement.muted;case"playbackSpeed":return destroyed||null===videoElement.playbackRate||!isFinite(videoElement.playbackRate)?null:videoElement.playbackRate;default:return null}}function onCueChange(){Array.from(videoElement.textTracks).forEach((function(track){Array.from(track.cues||[]).forEach((function(cue){cue.snapToLines=!1,cue.line=100-subtitlesOffset}))}))}function onError(error){events.emit("error",error),error.critical&&command("unload")}function onPropChanged(propName){observedProps[propName]&&events.emit("propChanged",propName,getProp(propName))}function command(commandName,commandArgs){switch(commandName){case"load":command("unload"),commandArgs&&commandArgs.stream&&"string"==typeof commandArgs.stream.url?(stream=commandArgs.stream,onPropChanged("stream"),onPropChanged("loaded"),videoElement.autoplay="boolean"!=typeof commandArgs.autoplay||commandArgs.autoplay,videoElement.currentTime=null!==commandArgs.time&&isFinite(commandArgs.time)?parseInt(commandArgs.time,10)/1e3:0,onPropChanged("paused"),onPropChanged("time"),onPropChanged("duration"),onPropChanged("buffering"),onPropChanged("buffered"),onPropChanged("subtitlesTracks"),onPropChanged("selectedSubtitlesTrackId"),onPropChanged("audioTracks"),onPropChanged("selectedAudioTrackId"),getContentType(stream).then((function(contentType){stream===commandArgs.stream&&("application/vnd.apple.mpegurl"===contentType&&Hls.isSupported()?((hls=new Hls(HLS_CONFIG)).on(Hls.Events.AUDIO_TRACKS_UPDATED,(function(){onPropChanged("audioTracks"),onPropChanged("selectedAudioTrackId")})),hls.on(Hls.Events.AUDIO_TRACK_SWITCHED,(function(){onPropChanged("audioTracks"),onPropChanged("selectedAudioTrackId")})),hls.loadSource(stream.url),hls.attachMedia(videoElement)):videoElement.src=stream.url)})).catch((function(){stream===commandArgs.stream&&(videoElement.src=stream.url)}))):onError(Object.assign({},ERROR.UNSUPPORTED_STREAM,{critical:!0,stream:commandArgs?commandArgs.stream:null}));break;case"unload":stream=null,Array.from(videoElement.textTracks).forEach((function(track){track.oncuechange=null})),null!==hls&&(hls.removeAllListeners(),hls.detachMedia(videoElement),hls.destroy(),hls=null),videoElement.removeAttribute("src"),videoElement.load(),videoElement.currentTime=0,onPropChanged("stream"),onPropChanged("loaded"),onPropChanged("paused"),onPropChanged("time"),onPropChanged("duration"),onPropChanged("buffering"),onPropChanged("buffered"),onPropChanged("subtitlesTracks"),onPropChanged("selectedSubtitlesTrackId"),onPropChanged("audioTracks"),onPropChanged("selectedAudioTrackId");break;case"destroy":command("unload"),destroyed=!0,onPropChanged("subtitlesOffset"),onPropChanged("subtitlesSize"),onPropChanged("subtitlesTextColor"),onPropChanged("subtitlesBackgroundColor"),onPropChanged("subtitlesOutlineColor"),onPropChanged("volume"),onPropChanged("muted"),onPropChanged("playbackSpeed"),events.removeAllListeners(),videoElement.onerror=null,videoElement.onended=null,videoElement.onpause=null,videoElement.onplay=null,videoElement.ontimeupdate=null,videoElement.ondurationchange=null,videoElement.onwaiting=null,videoElement.onseeking=null,videoElement.onseeked=null,videoElement.onstalled=null,videoElement.onplaying=null,videoElement.oncanplay=null,videoElement.canplaythrough=null,videoElement.onloadeddata=null,videoElement.onvolumechange=null,videoElement.onratechange=null,videoElement.textTracks.onchange=null,containerElement.removeChild(videoElement),containerElement.removeChild(styleElement)}}this.on=function(eventName,listener){if(destroyed)throw new Error("Video is destroyed");events.on(eventName,listener)},this.dispatch=function(action){if(destroyed)throw new Error("Video is destroyed");if(action)switch((action=deepFreeze(cloneDeep(action))).type){case"observeProp":return propName=action.propName,void(observedProps.hasOwnProperty(propName)&&(events.emit("propValue",propName,getProp(propName)),observedProps[propName]=!0));case"setProp":return void(function(propName,propValue){switch(propName){case"paused":null!==stream&&(propValue?videoElement.pause():videoElement.play(),onPropChanged("paused"));break;case"time":null!==stream&&null!==propValue&&isFinite(propValue)&&(videoElement.currentTime=parseInt(propValue,10)/1e3,onPropChanged("time"));break;case"selectedSubtitlesTrackId":if(null!==stream){Array.from(videoElement.textTracks).forEach((function(track,index){track.mode="EMBEDDED_"+String(index)===propValue?"showing":"disabled"}));var selecterdSubtitlesTrack=getProp("subtitlesTracks").find((function(track){return track.id===propValue}));selecterdSubtitlesTrack&&(onPropChanged("selectedSubtitlesTrackId"),events.emit("subtitlesTrackLoaded",selecterdSubtitlesTrack))}break;case"subtitlesOffset":null!==propValue&&isFinite(propValue)&&(subtitlesOffset=Math.max(0,Math.min(100,parseInt(propValue,10))),onCueChange(),onPropChanged("subtitlesOffset"));break;case"subtitlesSize":null!==propValue&&isFinite(propValue)&&(styleElement.sheet.cssRules[0].style.fontSize=Math.floor(Math.max(0,parseInt(propValue,10))/25)+"vmin",onPropChanged("subtitlesSize"));break;case"subtitlesTextColor":if("string"==typeof propValue){try{styleElement.sheet.cssRules[0].style.color=Color(propValue).rgb().string()}catch(error){console.error("HTMLVideo",error)}onPropChanged("subtitlesTextColor")}break;case"subtitlesBackgroundColor":if("string"==typeof propValue){try{styleElement.sheet.cssRules[0].style.backgroundColor=Color(propValue).rgb().string()}catch(error){console.error("HTMLVideo",error)}onPropChanged("subtitlesBackgroundColor")}break;case"subtitlesOutlineColor":if("string"==typeof propValue){try{styleElement.sheet.cssRules[0].style.textShadow=Color(propValue).rgb().string()+" 1px 1px 0.1em"}catch(error){console.error("HTMLVideo",error)}onPropChanged("subtitlesOutlineColor")}break;case"selectedAudioTrackId":if(null!==hls){var selecterdAudioTrack=getProp("audioTracks").find((function(track){return track.id===propValue}));hls.audioTrack=selecterdAudioTrack?parseInt(selecterdAudioTrack.id.split("_").pop(),10):-1,selecterdAudioTrack&&(onPropChanged("selectedAudioTrackId"),events.emit("audioTrackLoaded",selecterdAudioTrack))}break;case"volume":null!==propValue&&isFinite(propValue)&&(videoElement.muted=!1,videoElement.volume=Math.max(0,Math.min(100,parseInt(propValue,10)))/100,onPropChanged("muted"),onPropChanged("volume"));break;case"muted":videoElement.muted=!!propValue,onPropChanged("muted");break;case"playbackSpeed":null!==propValue&&isFinite(propValue)&&(videoElement.playbackRate=parseFloat(propValue),onPropChanged("playbackSpeed"))}})(action.propName,action.propValue);case"command":return void command(action.commandName,action.commandArgs)}var propName;throw new Error("Invalid action dispatched: "+JSON.stringify(action))}}HTMLVideo.canPlayStream=function(stream){return!stream||stream.behaviorHints&&stream.behaviorHints.notWebReady?Promise.resolve(!1):getContentType(stream).then((function(contentType){return!!document.createElement("video").canPlayType(contentType)||"application/vnd.apple.mpegurl"===contentType&&Hls.isSupported()})).catch((function(){return!1}))},HTMLVideo.manifest={name:"HTMLVideo",external:!1,props:["stream","loaded","paused","time","duration","buffering","buffered","audioTracks","selectedAudioTrackId","subtitlesTracks","selectedSubtitlesTrackId","subtitlesOffset","subtitlesSize","subtitlesTextColor","subtitlesBackgroundColor","subtitlesOutlineColor","volume","muted","playbackSpeed"],commands:["load","unload","destroy"],events:["propValue","propChanged","ended","error","subtitlesTrackLoaded","audioTrackLoaded"]},module.exports=HTMLVideo},8973:module=>{module.exports=function(stream){return stream&&"string"==typeof stream.url?stream.behaviorHints&&stream.behaviorHints.proxyHeaders&&stream.behaviorHints.proxyHeaders.response&&"string"==typeof stream.behaviorHints.proxyHeaders.response["content-type"]?Promise.resolve(stream.behaviorHints.proxyHeaders.response["content-type"]):fetch(stream.url,{method:"HEAD"}).then((function(resp){if(resp.ok)return resp.headers.get("content-type");throw new Error(resp.status+" ("+resp.statusText+")")})):Promise.reject(new Error("Invalid stream parameter!"))}},1566:module=>{module.exports={debug:!1,enableWorker:!0,lowLatencyMode:!1,backBufferLength:30,maxBufferLength:50,maxMaxBufferLength:80,maxFragLookUpTolerance:0,maxBufferHole:0,appendErrorMaxRetry:20,nudgeMaxRetry:20,manifestLoadingTimeOut:3e4,manifestLoadingMaxRetry:10,fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:20,retryDelayMs:0,maxRetryDelayMs:15},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:15}}}}},9222:(module,__unused_webpack_exports,__webpack_require__)=>{var HTMLVideo=__webpack_require__(1431);module.exports=HTMLVideo},8879:(module,__unused_webpack_exports,__webpack_require__)=>{var EventEmitter=__webpack_require__(6729),cloneDeep=__webpack_require__(3465),deepFreeze=__webpack_require__(2682),ERROR=__webpack_require__(9657);function IFrameVideo(options){var containerElement=(options=options||{}).containerElement;if(!(containerElement instanceof HTMLElement))throw new Error("Container element required to be instance of HTMLElement");var iframeElement=document.createElement("iframe");iframeElement.style.width="100%",iframeElement.style.height="100%",iframeElement.style.border=0,iframeElement.style.backgroundColor="black",iframeElement.allowFullscreen=!1,iframeElement.allow="autoplay",containerElement.appendChild(iframeElement);var events=new EventEmitter,destroyed=!1,observedProps={stream:!1,loaded:!1,paused:!1,time:!1,duration:!1,buffering:!1,buffered:!1,volume:!1,muted:!1,playbackSpeed:!1};function onMessage(event){if(event.source===iframeElement.contentWindow){var data=event.data||event.message;if(data&&"string"==typeof data.event){var eventName=data.event,args=Array.isArray(data.args)?data.args:[];events.emit.apply(events,[eventName].concat(args))}}}function sendMessage(action){iframeElement.contentWindow.postMessage(action,"*")}function onPropChanged(propName,propValue){observedProps[propName]&&events.emit("propChanged",propName,propValue)}function command(commandName,commandArgs){switch(commandName){case"load":return command("unload"),commandArgs&&commandArgs.stream&&"string"==typeof commandArgs.stream.playerFrameUrl?(window.addEventListener("message",onMessage,!1),iframeElement.onload=function(){sendMessage({type:"command",commandName:commandName,commandArgs:commandArgs})},iframeElement.src=commandArgs.stream.playerFrameUrl):(error=Object.assign({},ERROR.UNSUPPORTED_STREAM,{critical:!0,stream:commandArgs?commandArgs.stream:null}),events.emit("error",error),error.critical&&command("unload")),!0;case"unload":return window.removeEventListener("message",onMessage),iframeElement.onload=null,iframeElement.removeAttribute("src"),onPropChanged("stream",null),onPropChanged("loaded",null),onPropChanged("paused",null),onPropChanged("time",null),onPropChanged("duration",null),onPropChanged("buffering",null),onPropChanged("buffered",null),onPropChanged("volume",null),onPropChanged("muted",null),onPropChanged("playbackSpeed",null),!0;case"destroy":return command("unload"),destroyed=!0,events.removeAllListeners(),containerElement.removeChild(iframeElement),!0}var error}this.on=function(eventName,listener){if(destroyed)throw new Error("Video is destroyed");events.on(eventName,listener)},this.dispatch=function(action){if(destroyed)throw new Error("Video is destroyed");if(action)switch((action=deepFreeze(cloneDeep(action))).type){case"observeProp":return propName=action.propName,observedProps.hasOwnProperty(propName)&&(observedProps[propName]=!0),void sendMessage(action);case"setProp":return void sendMessage(action);case"command":return void(command(action.commandName,action.commandArgs)||sendMessage(action))}var propName;throw new Error("Invalid action dispatched: "+JSON.stringify(action))}}IFrameVideo.canPlayStream=function(stream){return Promise.resolve(stream&&"string"==typeof stream.playerFrameUrl)},IFrameVideo.manifest={name:"IFrameVideo",external:!0,props:["stream","loaded","paused","time","duration","buffering","buffered","audioTracks","selectedAudioTrackId","subtitlesTracks","selectedSubtitlesTrackId","subtitlesOffset","subtitlesSize","subtitlesTextColor","subtitlesBackgroundColor","subtitlesOutlineColor","volume","muted","playbackSpeed","extraSubtitlesTracks","selectedExtraSubtitlesTrackId","extraSubtitlesDelay","extraSubtitlesSize","extraSubtitlesOffset","extraSubtitlesTextColor","extraSubtitlesBackgroundColor","extraSubtitlesOutlineColor"],commands:["load","unload","destroy","addExtraSubtitlesTracks"],events:["propValue","propChanged","ended","error","subtitlesTrackLoaded","audioTrackLoaded","extraSubtitlesTrackLoaded","implementationChanged"]},module.exports=IFrameVideo},7685:(module,__unused_webpack_exports,__webpack_require__)=>{var IFrameVideo=__webpack_require__(8879);module.exports=IFrameVideo},8945:(module,__unused_webpack_exports,__webpack_require__)=>{var EventEmitter=__webpack_require__(6729),cloneDeep=__webpack_require__(3465),deepFreeze=__webpack_require__(2682),ERROR=__webpack_require__(9657),stremioToMPVProps={stream:null,paused:"pause",time:"time-pos",duration:"duration",buffering:"buffering",volume:"volume",muted:"mute",playbackSpeed:"speed",audioTracks:"audioTracks",selectedAudioTrackId:"aid",subtitlesTracks:"subtitlesTracks",selectedSubtitlesTrackId:"sid",subtitlesSize:"sub-scale",subtitlesTextColor:"sub-color",subtitlesBackgroundColor:"sub-back-color",subtitlesOutlineColor:"sub-border-color"};function ShellVideo(options){var ipc=(options=options||{}).shellTransport,stremioProps={};Object.keys(stremioToMPVProps).forEach((function(key){stremioToMPVProps[key]&&(stremioProps[stremioToMPVProps[key]]=key)})),ipc.send("mpv-command",["stop"]),ipc.send("mpv-observe-prop","path"),ipc.send("mpv-observe-prop","time-pos"),ipc.send("mpv-observe-prop","volume"),ipc.send("mpv-observe-prop","pause"),ipc.send("mpv-observe-prop","seeking"),ipc.send("mpv-observe-prop","eof-reached"),ipc.send("mpv-observe-prop","duration"),ipc.send("mpv-observe-prop","metadata"),ipc.send("mpv-observe-prop","video-params"),ipc.send("mpv-observe-prop","track-list"),ipc.send("mpv-observe-prop","paused-for-cache"),ipc.send("mpv-observe-prop","cache-buffering-state"),ipc.send("mpv-observe-prop","aid"),ipc.send("mpv-observe-prop","vid"),ipc.send("mpv-observe-prop","sid"),ipc.send("mpv-observe-prop","sub-scale"),ipc.send("mpv-observe-prop","sub-pos"),ipc.send("mpv-observe-prop","speed"),ipc.send("mpv-observe-prop","mpv-version"),ipc.send("mpv-observe-prop","ffmpeg-version");var events=new EventEmitter,destroyed=!1,stream=null,observedProps={},continueFrom=0,avgDuration=0,props={};function setBackground(visible){for(var bg=visible?"":"transparent",container=options.containerElement;container;container=container.parentElement)container.style.background=bg}var last_time=0;function getProp(propName){return stremioToMPVProps[propName]?props[stremioToMPVProps[propName]]:(console.log("Unsupported prop requested",propName),null)}function onError(error){events.emit("error",error),error.critical&&command("unload")}function onPropChanged(propName){observedProps[propName]&&events.emit("propChanged",propName,getProp(propName))}function command(commandName,commandArgs){switch(commandName){case"load":if(command("unload"),commandArgs&&commandArgs.stream&&"string"==typeof commandArgs.stream.url){stream=commandArgs.stream,onPropChanged("stream"),continueFrom=null!==commandArgs.time&&isFinite(commandArgs.time)?parseInt(commandArgs.time,10)/1e3:0,setBackground(!1),ipc.send("mpv-set-prop",["no-sub-ass"]);var windowRenderer="Win32"===navigator.platform?"direct3d":"opengl",videoOutput=options.mpvSeparateWindow?windowRenderer:"opengl-cb",separateWindow=options.mpvSeparateWindow?"yes":"no";ipc.send("mpv-set-prop",["vo",videoOutput]),ipc.send("mpv-set-prop",["osc",separateWindow]),ipc.send("mpv-set-prop",["input-defalt-bindings",separateWindow]),ipc.send("mpv-set-prop",["input-vo-keyboard",separateWindow]),ipc.send("mpv-command",["loadfile",stream.url]),ipc.send("mpv-set-prop",["pause",!1]),ipc.send("mpv-set-prop",["speed",props.speed]),ipc.send("mpv-set-prop",["aid",props.aid]),ipc.send("mpv-set-prop",["mute","no"]),onPropChanged("paused"),onPropChanged("time"),onPropChanged("duration"),onPropChanged("buffering"),onPropChanged("volume"),onPropChanged("muted"),onPropChanged("subtitlesTracks"),onPropChanged("selectedSubtitlesTrackId")}else onError(Object.assign({},ERROR.UNSUPPORTED_STREAM,{critical:!0,stream:commandArgs?commandArgs.stream:null}));break;case"unload":props={mute:!1,speed:1,subtitlesTracks:[],buffering:!0,aid:null,sid:null},continueFrom=0,avgDuration=0,ipc.send("mpv-command",["stop"]),onPropChanged("stream"),onPropChanged("paused"),onPropChanged("time"),onPropChanged("duration"),onPropChanged("buffering"),onPropChanged("volume"),onPropChanged("muted"),onPropChanged("subtitlesTracks"),onPropChanged("selectedSubtitlesTrackId"),setBackground(!0);break;case"destroy":command("unload"),destroyed=!0,events.removeAllListeners()}}ipc.on("mpv-prop-change",(function(args){switch(args.name){case"mpv-version":case"ffmpeg-version":props[args.name]=(function(args){console.log(args.name+": "+args.data)})(args);break;case"duration":var intDuration=0|args.data;props[args.name]=args.data>=30&&(!avgDuration||intDuration===avgDuration)?Math.round(1e3*args.data):null,avgDuration=avgDuration?avgDuration+intDuration>>1:intDuration;break;case"time-pos":props[args.name]=Math.round(1e3*args.data),continueFrom&&(ipc.send("mpv-set-prop",["time-pos",continueFrom]),props[args.name]=Math.round(continueFrom),continueFrom=0);break;case"sub-scale":props[args.name]=Math.round(args.data/.0066);break;case"paused-for-cache":case"seeking":props.buffering!==args.data&&(props.buffering=args.data,onPropChanged("buffering"));break;case"aid":case"sid":case"vid":props[args.name]=(function(args){return args.data?"EMBEDDED_"+args.data.toString():null})(args);break;case"track-list":props.audioTracks=args.data.filter((function(x){return"audio"===x.type})).map((function(x,index){return{id:"EMBEDDED_"+x.id,lang:void 0===x.lang?"Track"+(index+1):x.lang,label:void 0===x.title||void 0===x.lang?"":x.title||x.lang,origin:"EMBEDDED",embedded:!0,mode:x.id===props.aid?"showing":"disabled"}})),onPropChanged("audioTracks"),props.subtitlesTracks=args.data.filter((function(x){return"sub"===x.type})).map((function(x,index){return{id:"EMBEDDED_"+x.id,lang:void 0===x.lang?"Track "+(index+1):x.lang,label:void 0===x.title||void 0===x.lang?"":x.title||x.lang,origin:"EMBEDDED",embedded:!0,mode:x.id===props.sid?"showing":"disabled"}})),onPropChanged("subtitlesTracks");break;default:props[args.name]=args.data}var current_time="time-pos"===args.name?Math.floor(props["time-pos"]/1e3):null;current_time&&last_time===current_time||!stremioProps[args.name]||(current_time&&(last_time=current_time),onPropChanged(stremioProps[args.name]))})),ipc.on("mpv-event-ended",(function(args){args.error?onError(args.error):events.emit("ended")})),this.on=function(eventName,listener){if(destroyed)throw new Error("Video is destroyed");events.on(eventName,listener)},this.dispatch=function(action){if(destroyed)throw new Error("Video is destroyed");if(action)switch((action=deepFreeze(cloneDeep(action))).type){case"observeProp":propName=action.propName,events.emit("propValue",propName,getProp(propName)),observedProps[propName]=!0;break;case"setProp":return void(function(propName,propValue){switch(propName){case"paused":null!==stream&&ipc.send("mpv-set-prop",["pause",propValue]);break;case"time":null!==stream&&null!==propValue&&isFinite(propValue)&&ipc.send("mpv-set-prop",["time-pos",propValue/1e3]);break;case"playbackSpeed":null!==stream&&null!==propValue&&isFinite(propValue)&&ipc.send("mpv-set-prop",["speed",propValue]);break;case"volume":null!==stream&&null!==propValue&&isFinite(propValue)&&(props.mute=!1,ipc.send("mpv-set-prop",["mute","no"]),ipc.send("mpv-set-prop",["volume",propValue]),onPropChanged("muted"),onPropChanged("volume"));break;case"muted":null!==stream&&(ipc.send("mpv-set-prop",["mute",propValue?"yes":"no"]),props.mute=propValue,onPropChanged("muted"));break;case"selectedAudioTrackId":if(null!==stream){var actualId=propValue.slice("EMBEDDED_".length);ipc.send("mpv-set-prop",["aid",actualId])}break;case"selectedSubtitlesTrackId":null!==stream&&(propValue?(actualId=propValue.slice("EMBEDDED_".length),ipc.send("mpv-set-prop",["sid",actualId]),events.emit("subtitlesTrackLoaded",propValue)):(ipc.send("mpv-set-prop",["sid","no"]),props.sid=null)),onPropChanged("selectedSubtitlesTrackId");break;case"subtitlesSize":ipc.send("mpv-set-prop",[stremioToMPVProps[propName],.0066*propValue]);break;case"subtitlesOffset":ipc.send("mpv-set-prop",[stremioToMPVProps[propName],propValue]);break;case"subtitlesTextColor":case"subtitlesBackgroundColor":case"subtitlesOutlineColor":var argb=propValue.replace(/^#(\w{6})(\w{2})$/,"#$2$1");ipc.send("mpv-set-prop",[stremioToMPVProps[propName],argb]);break;default:console.log("Unhandled setProp for",propName)}})(action.propName,action.propValue);case"command":return void command(action.commandName,action.commandArgs)}var propName}}ShellVideo.canPlayStream=function(){return Promise.resolve(!0)},ShellVideo.manifest={name:"ShellVideo",external:!1,props:Object.keys(stremioToMPVProps),commands:["load","unload","destroy"],events:["propValue","propChanged","ended","error","subtitlesTrackLoaded"]},module.exports=ShellVideo},2024:(module,__unused_webpack_exports,__webpack_require__)=>{var ShellVideo=__webpack_require__(8945);module.exports=ShellVideo},8117:(module,__unused_webpack_exports,__webpack_require__)=>{var EventEmitter=__webpack_require__(6729),cloneDeep=__webpack_require__(3465),deepFreeze=__webpack_require__(2682),selectVideoImplementation=__webpack_require__(2081),ERROR=__webpack_require__(9657);function StremioVideo(){var video=null,events=new EventEmitter,destroyed=!1;this.on=function(eventName,listener){if(destroyed)throw new Error("Video is destroyed");events.on(eventName,listener)},this.dispatch=function(action,options){if(destroyed)throw new Error("Video is destroyed");if(!action)throw new Error("Invalid action dispatched: "+JSON.stringify(action));if(options=options||{},"command"===(action=deepFreeze(cloneDeep(action))).type&&"load"===action.commandName&&action.commandArgs){var Video=selectVideoImplementation(action.commandArgs,options);if(null!==video&&video.constructor!==Video&&(video.dispatch({type:"command",commandName:"destroy"}),video=null),null===video){if(null===Video)return void events.emit("error",Object.assign({},ERROR.UNSUPPORTED_STREAM,{error:new Error("No video implementation was selected"),critical:!0,stream:action.commandArgs.stream}));(video=new Video(options)).on("ended",(function(){events.emit("ended")})),video.on("error",(function(args){events.emit("error",args)})),video.on("propValue",(function(propName,propValue){events.emit("propValue",propName,propValue)})),video.on("propChanged",(function(propName,propValue){events.emit("propChanged",propName,propValue)})),video.on("subtitlesTrackLoaded",(function(track){events.emit("subtitlesTrackLoaded",track)})),video.on("audioTrackLoaded",(function(track){events.emit("audioTrackLoaded",track)})),video.on("extraSubtitlesTrackLoaded",(function(track){events.emit("extraSubtitlesTrackLoaded",track)})),Video.manifest.external?video.on("implementationChanged",(function(manifest){events.emit("implementationChanged",manifest)})):events.emit("implementationChanged",Video.manifest)}}if(null!==video)try{video.dispatch(action)}catch(error){console.error(video.constructor.manifest.name,error)}"command"===action.type&&"destroy"===action.commandName&&(video=null)},this.destroy=function(){destroyed=!0,null!==video&&(video.dispatch({type:"command",commandName:"destroy"}),video=null),events.removeAllListeners()}}StremioVideo.ERROR=ERROR,module.exports=StremioVideo},5010:(module,__unused_webpack_exports,__webpack_require__)=>{var StremioVideo=__webpack_require__(8117);module.exports=StremioVideo},2081:(module,__unused_webpack_exports,__webpack_require__)=>{var ChromecastSenderVideo=__webpack_require__(3153),ShellVideo=__webpack_require__(2024),HTMLVideo=__webpack_require__(9222),TizenVideo=__webpack_require__(5682),WebOsVideo=__webpack_require__(8846),IFrameVideo=__webpack_require__(7685),YouTubeVideo=__webpack_require__(3142),withStreamingServer=__webpack_require__(5690),withHTMLSubtitles=__webpack_require__(4282),withVideoParams=__webpack_require__(9450);module.exports=function(commandArgs,options){return commandArgs.stream&&"string"!=typeof commandArgs.stream.externalUrl?options.chromecastTransport&&options.chromecastTransport.getCastState()===cast.framework.CastState.CONNECTED?ChromecastSenderVideo:"string"==typeof commandArgs.stream.ytId?withVideoParams(withHTMLSubtitles(YouTubeVideo)):"string"==typeof commandArgs.stream.playerFrameUrl?withVideoParams(IFrameVideo):options.shellTransport?withStreamingServer(withHTMLSubtitles(ShellVideo)):"string"==typeof commandArgs.streamingServerURL?void 0!==__webpack_require__.g.tizen?withStreamingServer(withHTMLSubtitles(TizenVideo)):void 0!==__webpack_require__.g.webOS?withStreamingServer(withHTMLSubtitles(WebOsVideo)):withStreamingServer(withHTMLSubtitles(HTMLVideo)):"string"==typeof commandArgs.stream.url?void 0!==__webpack_require__.g.webOS?withVideoParams(withHTMLSubtitles(WebOsVideo)):void 0!==__webpack_require__.g.tizen?withVideoParams(withHTMLSubtitles(TizenVideo)):withVideoParams(withHTMLSubtitles(HTMLVideo)):null:null}},5071:(module,__unused_webpack_exports,__webpack_require__)=>{var EventEmitter=__webpack_require__(6729),cloneDeep=__webpack_require__(3465),deepFreeze=__webpack_require__(2682),Color=__webpack_require__(6767),ERROR=__webpack_require__(9657);function TizenVideo(options){var isBuffering=!0,videoSpeed=1,currentSubTrack=null,currentAudioTrack=null,containerElement=(options=options||{}).containerElement;if(!(containerElement instanceof HTMLElement))throw new Error("Container element required to be instance of HTMLElement");var lastSub,promiseAudioTrackChange=!1,size=100,offset=0,textColor="rgb(255, 255, 255)",backgroundColor="rgba(0, 0, 0, 0)",outlineColor="rgb(34, 34, 34)",subtitlesOpacity=1,objElement=document.createElement("object");objElement.type="application/avplayer",objElement.style.width="100%",objElement.style.height="100%",objElement.style.backgroundColor="black";var disabledSubs=!1;function refreshSubtitle(){if(lastSub){var lastSubDurationDiff=lastSub.duration-(getProp("time")-lastSub.now);lastSubDurationDiff>0&&renderSubtitle(lastSubDurationDiff,lastSub.text)}}function renderSubtitle(duration,text){if(!disabledSubs){for(lastSub={duration:duration,text:text,now:getProp("time")},subtitleTimeout&&(clearTimeout(subtitleTimeout),subtitleTimeout=!1);subtitlesElement.hasChildNodes();)subtitlesElement.removeChild(subtitlesElement.lastChild);subtitlesElement.style.bottom=offset+"%",subtitlesElement.style.opacity=subtitlesOpacity;var cueNode=document.createElement("span");cueNode.innerHTML=text,cueNode.style.display="inline-block",cueNode.style.padding="0.2em",cueNode.style.fontSize=Math.floor(size/25)+"vmin",cueNode.style.color=textColor,cueNode.style.backgroundColor=backgroundColor,cueNode.style.textShadow="1px 1px 0.1em "+outlineColor,subtitlesElement.appendChild(cueNode),subtitlesElement.appendChild(document.createElement("br")),duration&&(subtitleTimeout=setTimeout((function(){for(;subtitlesElement.hasChildNodes();)subtitlesElement.removeChild(subtitlesElement.lastChild)}),parseInt(duration*videoSpeed)))}}var subtitleTimeout=!1,Listener={onbufferingstart:function(){isBuffering=!0,onPropChanged("buffering")},onbufferingprogress:function(){isBuffering=!0,onPropChanged("buffering")},onbufferingcomplete:function(){isBuffering=!1,onPropChanged("buffering")},oncurrentplaytime:function(){onPropChanged("time")},onsubtitlechange:function(duration,text){renderSubtitle(duration,text)},onstreamcompleted:function(){events.emit("ended")}};window.webapis.avplay.setListener(Listener),containerElement.appendChild(objElement);var subtitlesElement=document.createElement("div");subtitlesElement.style.position="absolute",subtitlesElement.style.right="0",subtitlesElement.style.bottom="0",subtitlesElement.style.left="0",subtitlesElement.style.zIndex="1",subtitlesElement.style.textAlign="center",containerElement.style.position="relative",containerElement.style.zIndex="0",containerElement.appendChild(subtitlesElement);var events=new EventEmitter,destroyed=!1,stream=null,retries=0,isLoaded=null,observedProps={stream:!1,loaded:!1,paused:!1,time:!1,duration:!1,buffering:!1,subtitlesTracks:!1,selectedSubtitlesTrackId:!1,subtitlesOffset:!1,subtitlesSize:!1,subtitlesTextColor:!1,subtitlesBackgroundColor:!1,subtitlesOutlineColor:!1,subtitlesOpacity:!1,audioTracks:!1,selectedAudioTrackId:!1,playbackSpeed:!1};function getProp(propName){switch(propName){case"stream":return stream;case"loaded":return isLoaded;case"paused":if(null===stream)return null;var isPaused=!("PAUSED"!==window.webapis.avplay.getState());return!isPaused&&promiseAudioTrackChange&&(window.webapis.avplay.setSelectTrack("AUDIO",parseInt(promiseAudioTrackChange.replace("EMBEDDED_",""))),promiseAudioTrackChange=!1),isPaused;case"time":var currentTime=window.webapis.avplay.getCurrentTime();return null!==stream&&null!==currentTime&&isFinite(currentTime)?Math.floor(currentTime):null;case"duration":var duration=window.webapis.avplay.getDuration();return null!==stream&&null!==duration&&isFinite(duration)?Math.floor(duration):null;case"buffering":return null===stream?null:isBuffering;case"subtitlesTracks":if(null===stream)return[];for(var totalTrackInfo=window.webapis.avplay.getTotalTrackInfo(),textTracks=[],i=0;i<totalTrackInfo.length;i++)if("TEXT"===totalTrackInfo[i].type){var textTrack=totalTrackInfo[i],textTrackId="EMBEDDED_"+String(textTrack.index);currentSubTrack||textTracks.length||(currentSubTrack=textTrackId);var extra={};try{extra=JSON.parse(textTrack.extra_info)}catch(e){}var textTrackLang="string"==typeof extra.track_lang&&extra.track_lang.length>0?extra.track_lang.trim():null;textTracks.push({id:textTrackId,lang:textTrackLang,label:textTrackLang,origin:"EMBEDDED",embedded:!0,mode:disabledSubs||textTrackId!==currentSubTrack?"disabled":"showing"})}return textTracks;case"selectedSubtitlesTrackId":if(null===stream||disabledSubs)return null;var currentTracks=window.webapis.avplay.getCurrentStreamInfo();for(i=0;i<currentTracks.length;i++)if("TEXT"===currentTracks[i].type){currentIndex=currentTracks[i].index;break}return currentIndex?"EMBEDDED_"+String(currentIndex):null;case"subtitlesOffset":return destroyed?null:offset;case"subtitlesSize":return destroyed?null:size;case"subtitlesTextColor":return destroyed?null:textColor;case"subtitlesBackgroundColor":return destroyed?null:backgroundColor;case"subtitlesOutlineColor":return destroyed?null:outlineColor;case"subtitlesOpacity":return destroyed?null:subtitlesOpacity;case"audioTracks":if(null===stream)return[];totalTrackInfo=window.webapis.avplay.getTotalTrackInfo();var audioTracks=[];for(i=0;i<totalTrackInfo.length;i++)if("AUDIO"===totalTrackInfo[i].type){var audioTrack=totalTrackInfo[i],audioTrackId="EMBEDDED_"+String(audioTrack.index);currentAudioTrack||audioTracks.length||(currentAudioTrack=audioTrackId);extra={};try{extra=JSON.parse(audioTrack.extra_info)}catch(e){}var audioTrackLang="string"==typeof extra.language&&extra.language.length>0?extra.language:null;audioTracks.push({id:audioTrackId,lang:audioTrackLang,label:audioTrackLang,origin:"EMBEDDED",embedded:!0,mode:audioTrackId===currentAudioTrack?"showing":"disabled"})}return audioTracks;case"selectedAudioTrackId":if(null===stream)return null;if(promiseAudioTrackChange)return promiseAudioTrackChange;currentTracks=window.webapis.avplay.getCurrentStreamInfo();var currentIndex=!1;for(i=0;i<currentTracks.length;i++)if("AUDIO"===currentTracks[i].type){currentIndex=currentTracks[i].index;break}return!1!==currentIndex?"EMBEDDED_"+String(currentIndex):null;case"playbackSpeed":return destroyed||null===videoSpeed||!isFinite(videoSpeed)?null:videoSpeed;default:return null}}function onError(error){events.emit("error",error),error.critical&&command("unload")}function onPropChanged(propName){observedProps[propName]&&events.emit("propChanged",propName,getProp(propName))}function command(commandName,commandArgs){switch(commandName){case"load":if(commandArgs&&commandArgs.stream&&"string"==typeof commandArgs.stream.url){if((stream=commandArgs.stream)!==commandArgs.stream)return;onPropChanged("buffering"),window.webapis.avplay.open(stream.url),window.webapis.avplay.setDisplayRect(0,0,window.innerWidth,window.innerHeight),window.webapis.avplay.setDisplayMethod("PLAYER_DISPLAY_MODE_LETTER_BOX"),window.webapis.avplay.seekTo(null!==commandArgs.time&&isFinite(commandArgs.time)?parseInt(commandArgs.time,10):0),window.webapis.avplay.prepareAsync((function(){onPropChanged("duration"),window.webapis.avplay.play(),isLoaded=!0,onPropChanged("loaded"),onPropChanged("stream"),onPropChanged("paused"),onPropChanged("time"),onPropChanged("duration"),onPropChanged("subtitlesTracks"),onPropChanged("selectedSubtitlesTrackId"),onPropChanged("audioTracks"),onPropChanged("selectedAudioTrackId")}),(function(error){if(retries<5){retries++;try{window.webapis.avplay.stop()}catch(e){}command("load",commandArgs)}else onError(Object.assign({},ERROR.STREAM_FAILED_TO_LOAD,{critical:!0,stream:commandArgs?commandArgs.stream:null,error:error}))}))}else onError(Object.assign({},ERROR.UNSUPPORTED_STREAM,{critical:!0,stream:commandArgs?commandArgs.stream:null}));break;case"unload":stream=null,window.webapis.avplay.stop(),isLoaded=!1,onPropChanged("loaded"),onPropChanged("stream"),onPropChanged("paused"),onPropChanged("time"),onPropChanged("duration"),onPropChanged("buffering"),onPropChanged("subtitlesTracks"),onPropChanged("selectedSubtitlesTrackId"),onPropChanged("audioTracks"),onPropChanged("selectedAudioTrackId");break;case"destroy":command("unload"),destroyed=!0,onPropChanged("subtitlesOffset"),onPropChanged("subtitlesSize"),onPropChanged("subtitlesTextColor"),onPropChanged("subtitlesBackgroundColor"),onPropChanged("subtitlesOutlineColor"),onPropChanged("subtitlesOpacity"),onPropChanged("playbackSpeed"),events.removeAllListeners(),containerElement.removeChild(objElement)}}this.on=function(eventName,listener){if(destroyed)throw new Error("Video is destroyed");events.on(eventName,listener)},this.dispatch=function(action){if(destroyed)throw new Error("Video is destroyed");if(action)switch((action=deepFreeze(cloneDeep(action))).type){case"observeProp":return propName=action.propName,void(observedProps.hasOwnProperty(propName)&&(events.emit("propValue",propName,getProp(propName)),observedProps[propName]=!0));case"setProp":return void(function(propName,propValue){switch(propName){case"paused":if(null!==stream){var willPause=!!propValue;willPause?window.webapis.avplay.pause():window.webapis.avplay.play(),willPause?subtitleTimeout&&clearTimeout(subtitleTimeout):refreshSubtitle()}onPropChanged("paused");var lastKnownProp=getProp("paused");setTimeout((function(){getProp("paused")!==lastKnownProp&&onPropChanged("paused")}),1e3);break;case"time":null!==stream&&null!==propValue&&isFinite(propValue)&&(window.webapis.avplay.seekTo(parseInt(propValue,10)),renderSubtitle(1,""),onPropChanged("time"));break;case"selectedSubtitlesTrackId":if(null!==stream)if(0===(currentSubTrack||"").indexOf("EMBEDDED_")){if(-1===(propValue||"").indexOf("EMBEDDED_"))return renderSubtitle(1,""),disabledSubs=!0,void onPropChanged("selectedSubtitlesTrackId");disabledSubs=!1,currentSubTrack=propValue;var selectedSubtitlesTrack=getProp("subtitlesTracks").find((function(track){return track.id===propValue}));window.webapis.avplay.setSelectTrack("TEXT",parseInt(currentSubTrack.replace("EMBEDDED_",""))),selectedSubtitlesTrack&&(events.emit("subtitlesTrackLoaded",selectedSubtitlesTrack),onPropChanged("selectedSubtitlesTrackId"))}else propValue||(renderSubtitle(1,""),disabledSubs=!0,onPropChanged("selectedSubtitlesTrackId"));break;case"subtitlesOffset":null!==propValue&&isFinite(propValue)&&(offset=Math.max(0,Math.min(100,parseInt(propValue,10))),refreshSubtitle(),onPropChanged("subtitlesOffset"));break;case"subtitlesSize":null!==propValue&&isFinite(propValue)&&(size=Math.max(0,parseInt(propValue,10)),refreshSubtitle(),onPropChanged("subtitlesSize"));break;case"subtitlesTextColor":if("string"==typeof propValue){try{textColor=Color(propValue).rgb().string()}catch(error){console.error("Tizen player with HTML Subtitles",error)}refreshSubtitle(),onPropChanged("subtitlesTextColor")}break;case"subtitlesBackgroundColor":if("string"==typeof propValue){try{backgroundColor=Color(propValue).rgb().string()}catch(error){console.error("Tizen player with HTML Subtitles",error)}refreshSubtitle(),onPropChanged("subtitlesBackgroundColor")}break;case"subtitlesOutlineColor":if("string"==typeof propValue){try{outlineColor=Color(propValue).rgb().string()}catch(error){console.error("Tizen player with HTML Subtitles",error)}refreshSubtitle(),onPropChanged("subtitlesOutlineColor")}break;case"subtitlesOpacity":if("number"==typeof propValue){try{subtitlesOpacity=Math.min(Math.max(propValue/100,0),1)}catch(error){console.error("Tizen player with HTML Subtitles",error)}refreshSubtitle(),onPropChanged("subtitlesOpacity")}break;case"selectedAudioTrackId":if(null!==stream){currentAudioTrack=propValue;var selectedAudioTrack=getProp("audioTracks").find((function(track){return track.id===propValue}));getProp("paused")?(promiseAudioTrackChange=propValue,onPropChanged("selectedAudioTrackId")):window.webapis.avplay.setSelectTrack("AUDIO",parseInt(currentAudioTrack.replace("EMBEDDED_",""))),selectedAudioTrack&&(events.emit("audioTrackLoaded",selectedAudioTrack),onPropChanged("selectedAudioTrackId"))}break;case"playbackSpeed":if(null!==propValue&&isFinite(propValue)){videoSpeed=parseFloat(propValue);try{window.webapis.avplay.setSpeed(videoSpeed)}catch(e){}onPropChanged("playbackSpeed")}}})(action.propName,action.propValue);case"command":return void command(action.commandName,action.commandArgs)}var propName;throw new Error("Invalid action dispatched: "+JSON.stringify(action))}}TizenVideo.canPlayStream=function(){return Promise.resolve(!0)},TizenVideo.manifest={name:"TizenVideo",external:!1,props:["stream","loaded","paused","time","duration","buffering","audioTracks","selectedAudioTrackId","subtitlesTracks","selectedSubtitlesTrackId","subtitlesOffset","subtitlesSize","subtitlesTextColor","subtitlesBackgroundColor","subtitlesOutlineColor","subtitlesOpacity","playbackSpeed"],commands:["load","unload","destroy"],events:["propValue","propChanged","ended","error","subtitlesTrackLoaded","audioTrackLoaded"]},module.exports=TizenVideo},5682:(module,__unused_webpack_exports,__webpack_require__)=>{var TizenVideo=__webpack_require__(5071);module.exports=TizenVideo},4333:(module,__unused_webpack_exports,__webpack_require__)=>{var EventEmitter=__webpack_require__(6729),cloneDeep=__webpack_require__(3465),deepFreeze=__webpack_require__(2682),ERROR=__webpack_require__(9657);function luna(params,call,fail,method){call&&(params.onSuccess=call||function(){}),params.onFailure=function(result){console.log("WebOS",(params.method||method)+" [fail]["+result.errorCode+"] "+result.errorText),console.log("fail result",JSON.stringify(result)),fail&&fail()},window.webOS.service.request(method||"luna://com.webos.media",params)}function launchVideoApp(params,success,failure){window.webOS.service.request("luna://com.webos.applicationManager",{method:"launch",parameters:{id:params.id,params:{payload:[{fullPath:params.url,artist:"",subtitle:"",dlnaInfo:{flagVal:4096,cleartextSize:"-1",contentLength:"-1",opVal:1,protocolInfo:"http-get:*:video/x-matroska:DLNA.ORG_OP=01;DLNA.ORG_CI=0;DLNA.ORG_FLAGS=01700000000000000000000000000000",duration:0},mediaType:"VIDEO",thumbnail:"",deviceType:"DMR",album:"",fileName:params.name,lastPlayPosition:params.position}]}},onSuccess:function(){success&&success()},onFailure:function(){failure&&failure(new Error("Failed to launch"+params.id)),"com.webos.app.photovideo"===params.id?(params.id="com.webos.app.smartshare",launchVideoApp(params,success,failure)):"com.webos.app.smartshare"===params.id&&(params.id="com.webos.app.mediadiscovery",launchVideoApp(params,success,failure))}})}var webOsColors=["none","black","white","yellow","red","green","blue"],stremioColors={"rgba(0, 0, 0, 0)":"none","rgba(0, 0, 0, 255)":"black","rgba(255, 255, 255, 255)":"white","rgba(255, 255, 0, 255)":"yellow","rgba(255, 0, 0, 255)":"red","rgba(0, 255, 0, 255)":"green","rgba(0, 0, 255, 255)":"blue","rgba(0, 0, 0, 1)":"black","rgba(255, 255, 255, 1)":"white","rgba(255, 255, 0, 1)":"yellow","rgba(255, 0, 0, 1)":"red","rgba(0, 255, 0, 1)":"green","rgba(0, 0, 255, 1)":"blue","rgb(0, 0, 0)":"black","rgb(255, 255, 255)":"white","rgb(255, 255, 0)":"yellow","rgb(255, 0, 0)":"red","rgb(0, 255, 0)":"green","rgb(0, 0, 255)":"blue","#000000FF":"black","#FFFFFFFF":"white","#FFFF00FF":"yellow","#FF0000FF":"red","#00FF00FF":"green","#0000FFFF":"blue","#000000":"black","#FFFFFF":"white","#FFFF00":"yellow","#FF0000":"red","#00FF00":"green","#0000FF":"blue"};function WebOsVideo(options){var containerElement=(options=options||{}).containerElement;if(!(containerElement instanceof HTMLElement))throw new Error("Container element required to be instance of HTMLElement");var knownMediaId=!1,subSize=75,disabledSubs=!0,subscribed=!1,currentSubTrack=!1,currentAudioTrack=!1,textTracks=[],audioTracks=[],count_message=0,subStyles={color:"white",font_size:1,bg_color:"none",position:-1,bg_opacity:0,char_opacity:255},subscribe=function(cb){if(!subscribed){subscribed=!0;var answered=!1;luna({method:"subscribe",parameters:{mediaId:knownMediaId,subscribe:!0}},(function(result){if(result.sourceInfo&&!answered){answered=!0;var info=result.sourceInfo.programInfo[0];!(function(info){if(textTracks=[],info.numSubtitleTracks){for(var i=0;i<info.subtitleTrackInfo.length;i++){var textTrack=info.subtitleTrackInfo[i];textTrack.index=i;var textTrackLang="(null)"===textTrack.language?"":textTrack.language,textTrackId="EMBEDDED_"+textTrack.index;currentSubTrack||textTracks.length||(currentSubTrack=textTrackId),textTracks.push({id:textTrackId,lang:textTrackLang,label:textTrackLang,origin:"EMBEDDED",embedded:!0,mode:textTrackId===currentSubTrack?"showing":"disabled"})}onPropChanged("subtitlesTracks"),onPropChanged("selectedSubtitlesTrackId")}})(info),(function(info){if(audioTracks=[],info.numAudioTracks){for(var i=0;i<info.audioTrackInfo.length;i++){var audioTrack=info.audioTrackInfo[i];audioTrack.index=i;var audioTrackId="EMBEDDED_"+audioTrack.index;currentAudioTrack||audioTracks.length||(currentAudioTrack=audioTrackId);var audioTrackLang="(null)"===audioTrack.language?"":audioTrack.language;audioTracks.push({id:audioTrackId,lang:audioTrackLang,label:audioTrackLang,origin:"EMBEDDED",embedded:!0,mode:audioTrackId===currentAudioTrack?"showing":"disabled"})}onPropChanged("audioTracks"),onPropChanged("selectedAudioTrackId")}})(info),unsubscribe(cb)}if((result.error||{}).errorCode)return answered=!0,void unsubscribe(cb);(result.unloadCompleted||{}).mediaId===knownMediaId&&(result.unloadCompleted||{}).state||30!==++count_message||answered||unsubscribe(cb)}),(function(){}))}},unsubscribe=function(cb){subscribed&&(subscribed=!1,luna({method:"unsubscribe",parameters:{mediaId:knownMediaId}},(function(){cb()}),(function(){cb()})),cb())},toggleSubtitles=function(status){videoElement.mediaId&&(disabledSubs=!status,luna({method:"setSubtitleEnable",parameters:{mediaId:videoElement.mediaId,enable:status}}))},styleElement=document.createElement("style");containerElement.appendChild(styleElement),styleElement.sheet.insertRule("video::cue { font-size: 4vmin; color: rgb(255, 255, 255); background-color: rgba(0, 0, 0, 0); text-shadow: rgb(34, 34, 34) 1px 1px 0.1em; }");var videoElement=document.createElement("video");videoElement.style.width="100%",videoElement.style.height="100%",videoElement.style.backgroundColor="black",videoElement.controls=!1,videoElement.onerror=function(){!(function(){if(destroyed)return;var error;switch((videoElement.error||{}).code){case 1:error=ERROR.HTML_VIDEO.MEDIA_ERR_ABORTED;break;case 2:error=ERROR.HTML_VIDEO.MEDIA_ERR_NETWORK;break;case 3:error=ERROR.HTML_VIDEO.MEDIA_ERR_DECODE,launchVideoApp({id:"com.webos.app.photovideo",url:stream.url,name:"Stremio",position:-1},null,(function(e){console.error(e)}));break;case 4:error=ERROR.HTML_VIDEO.MEDIA_ERR_SRC_NOT_SUPPORTED,launchVideoApp({id:"com.webos.app.photovideo",url:stream.url,name:"Stremio",position:-1},null,(function(e){console.error(e)}));break;default:error=ERROR.UNKNOWN_ERROR}onError(Object.assign({},error,{critical:!0,error:videoElement.error}))})()},videoElement.onended=function(){events.emit("ended")},videoElement.onpause=function(){onPropChanged("paused")},videoElement.onplay=function(){onPropChanged("paused")},videoElement.ontimeupdate=function(){onPropChanged("time"),onPropChanged("buffered")},videoElement.ondurationchange=function(){onPropChanged("duration")},videoElement.onwaiting=function(){onPropChanged("buffering"),onPropChanged("buffered")},videoElement.onseeking=function(){onPropChanged("buffering"),onPropChanged("buffered")},videoElement.onseeked=function(){onPropChanged("buffering"),onPropChanged("buffered")},videoElement.onstalled=function(){onPropChanged("buffering"),onPropChanged("buffered")},videoElement.onplaying=function(){onPropChanged("buffering"),onPropChanged("buffered")},videoElement.oncanplay=function(){onPropChanged("buffering"),onPropChanged("buffered")},videoElement.canplaythrough=function(){onPropChanged("buffering"),onPropChanged("buffered")},videoElement.onloadeddata=function(){onPropChanged("buffering"),onPropChanged("buffered")},videoElement.onloadedmetadata=function(){onPropChanged("buffering"),onPropChanged("buffered"),setProp("time",startTime)},videoElement.onvolumechange=function(){onPropChanged("volume"),onPropChanged("muted")},videoElement.onratechange=function(){onPropChanged("playbackSpeed")},videoElement.textTracks.onchange=function(){onPropChanged("subtitlesTracks"),onPropChanged("selectedSubtitlesTrackId"),onCueChange(),Array.from(videoElement.textTracks).forEach((function(track){track.oncuechange=onCueChange}))},containerElement.appendChild(videoElement);var lastSubColor=null,lastSubBgColor=null,lastPlaybackSpeed=1,events=new EventEmitter,destroyed=!1,stream=null,startTime=null,subtitlesOffset=0,subtitlesOpacity=100,observedProps={stream:!1,paused:!1,time:!1,duration:!1,buffering:!1,buffered:!1,subtitlesTracks:!1,selectedSubtitlesTrackId:!1,subtitlesOffset:!1,subtitlesSize:!1,subtitlesTextColor:!1,subtitlesBackgroundColor:!1,subtitlesOpacity:!1,audioTracks:!1,selectedAudioTrackId:!1,volume:!1,muted:!1,playbackSpeed:!1};function getProp(propName){switch(propName){case"stream":return stream;case"paused":return null===stream?null:!!videoElement.paused;case"time":return null!==stream&&null!==videoElement.currentTime&&isFinite(videoElement.currentTime)?Math.floor(1e3*videoElement.currentTime):null;case"duration":return null!==stream&&null!==videoElement.duration&&isFinite(videoElement.duration)?Math.floor(1e3*videoElement.duration):null;case"buffering":return null===stream?null:videoElement.readyState<videoElement.HAVE_FUTURE_DATA;case"buffered":if(null===stream)return null;for(var time=null!==videoElement.currentTime&&isFinite(videoElement.currentTime)?videoElement.currentTime:0,i=0;i<videoElement.buffered.length;i++)if(videoElement.buffered.start(i)<=time&&time<=videoElement.buffered.end(i))return Math.floor(1e3*videoElement.buffered.end(i));return Math.floor(1e3*time);case"subtitlesTracks":return null===stream?[]:textTracks;case"selectedSubtitlesTrackId":return null===stream||disabledSubs?null:currentSubTrack;case"subtitlesOffset":return destroyed?null:subtitlesOffset;case"subtitlesSize":return destroyed?null:subSize;case"subtitlesTextColor":return destroyed?null:lastSubColor||"rgb(255, 255, 255)";case"subtitlesBackgroundColor":return destroyed?null:lastSubBgColor||"rgba(0, 0, 0, 0)";case"subtitlesOpacity":return destroyed?null:subtitlesOpacity||100;case"audioTracks":return audioTracks;case"selectedAudioTrackId":return currentAudioTrack;case"volume":return destroyed||null===videoElement.volume||!isFinite(videoElement.volume)?null:Math.floor(100*videoElement.volume);case"muted":return destroyed?null:!!videoElement.muted;case"playbackSpeed":return destroyed||null===lastPlaybackSpeed||!isFinite(lastPlaybackSpeed)?null:lastPlaybackSpeed;default:return null}}function onCueChange(){Array.from(videoElement.textTracks).forEach((function(track){Array.from(track.cues||[]).forEach((function(cue){cue.snapToLines=!1,cue.line=100-subtitlesOffset}))}))}function onError(error){events.emit("error",error),error.critical&&command("unload")}function onPropChanged(propName){observedProps[propName]&&events.emit("propChanged",propName,getProp(propName))}function setProp(propName,propValue){switch(propName){case"paused":null!==stream&&(propValue?videoElement.pause():videoElement.play());break;case"time":if(null!==stream&&videoElement.readyState>=videoElement.HAVE_METADATA&&null!==propValue&&isFinite(propValue))try{videoElement.currentTime=parseInt(propValue,10)/1e3,onPropChanged("time")}catch(e){}break;case"selectedSubtitlesTrackId":if(videoElement.mediaId&&null!==stream&&0===(propValue||"").indexOf("EMBEDDED_")){toggleSubtitles(!0),subStyles.bg_opacity="none"===subStyles.bg_color?0:255,["setSubtitleCharacterColor","setSubtitleBackgroundColor","setSubtitlePosition","setSubtitleFontSize","setSubtitleBackgroundOpacity","setSubtitleCharacterOpacity"].forEach((function(key){luna({method:key,parameters:{mediaId:videoElement.mediaId,charColor:subStyles.color,bgColor:"none"===subStyles.bg_color?"black":subStyles.bg_color,position:subStyles.position,fontSize:subStyles.font_size,bgOpacity:subStyles.bg_opacity,charOpacity:subStyles.char_opacity}})})),console.log("WebOS","change subtitles for id: ",videoElement.mediaId," index:",propValue),currentSubTrack=propValue;var trackIndex=parseInt(propValue.replace("EMBEDDED_",""));console.log("set subs to track idx: "+trackIndex),setTimeout((function(){var successCb=function(){var selectedSubtitlesTrack=getProp("subtitlesTracks").find((function(track){return track.id===propValue}));textTracks=textTracks.map((function(track){return track.mode=track.id===currentSubTrack?"showing":"disabled",track})),selectedSubtitlesTrack&&(events.emit("subtitlesTrackLoaded",selectedSubtitlesTrack),onPropChanged("selectedSubtitlesTrackId"))};luna({method:"selectTrack",parameters:{type:"text",mediaId:videoElement.mediaId,index:trackIndex}},successCb,successCb)}),500)}-1===(propValue||"").indexOf("EMBEDDED_")&&(currentSubTrack=null,onPropChanged("selectedSubtitlesTrackId"),toggleSubtitles(!1));break;case"subtitlesOffset":if(null!==propValue&&isFinite(propValue)){subtitlesOffset=propValue;var nextOffset=0===(offset=Math.max(0,Math.min(100,parseInt(subtitlesOffset,10))))?-3:offset<=2?-2:offset<=3?-1:offset<=5?0:offset<=10?1:offset<=25?2:offset<=50?3:offset<=100&&4;!1===nextOffset&&(nextOffset=-1),subStyles.position=nextOffset,videoElement.mediaId&&luna({method:"setSubtitlePosition",parameters:{mediaId:videoElement.mediaId,position:nextOffset}}),onPropChanged("subtitlesOffset")}break;case"subtitlesSize":if(null!==propValue&&isFinite(propValue)){subSize=propValue;var nextSubSize=(size=Math.max(0,parseInt(subSize,10)))<=75?1:size<=100?2:size<=150?3:size<=250&&4;!1===nextSubSize&&(nextSubSize=1),subStyles.font_size=nextSubSize,videoElement.mediaId&&luna({method:"setSubtitleFontSize",parameters:{mediaId:videoElement.mediaId,fontSize:nextSubSize}}),onPropChanged("subtitlesSize")}break;case"subtitlesTextColor":if("string"==typeof propValue){var nextColor="white";stremioColors[propValue]&&webOsColors.indexOf(stremioColors[propValue])>-1&&(nextColor=stremioColors[propValue]),subStyles.color=nextColor,videoElement.mediaId&&luna({method:"setSubtitleCharacterColor",parameters:{mediaId:videoElement.mediaId,charColor:nextColor}}),lastSubColor=propValue,onPropChanged("subtitlesTextColor")}break;case"subtitlesBackgroundColor":"string"==typeof propValue&&(stremioColors[propValue]&&webOsColors.indexOf(stremioColors[propValue])>-1&&(subStyles.bg_color=stremioColors[propValue],videoElement.mediaId&&(luna({method:"setSubtitleBackgroundColor",parameters:{mediaId:videoElement.mediaId,bgColor:"none"===stremioColors[propValue]?"black":stremioColors[propValue]}}),luna("none"===stremioColors[propValue]?{method:"setSubtitleBackgroundOpacity",parameters:{mediaId:videoElement.mediaId,bgOpacity:0}}:{method:"setSubtitleBackgroundOpacity",parameters:{mediaId:videoElement.mediaId,bgOpacity:255}}))),lastSubBgColor=propValue,onPropChanged("subtitlesBackgroundColor"));break;case"subtitlesOpacity":if("number"==typeof propValue){var nextSubOpacity=Math.floor(propValue/100*255);subStyles.char_opacity=nextSubOpacity,videoElement.mediaId&&luna({method:"setSubtitleCharacterOpacity",parameters:{mediaId:videoElement.mediaId,charOpacity:nextSubOpacity}}),subtitlesOpacity=propValue,onPropChanged("subtitlesOpacity")}break;case"selectedAudioTrackId":if(0===(propValue||"").indexOf("EMBEDDED_")){currentAudioTrack=propValue;trackIndex=parseInt(propValue.replace("EMBEDDED_",""));if(videoElement.mediaId&&luna({method:"selectTrack",parameters:{type:"audio",mediaId:videoElement.mediaId,index:trackIndex}},(function(){var selectedAudioTrack=getProp("audioTracks").find((function(track){return track.id===propValue}));audioTracks=audioTracks.map((function(track){return track.mode=track.id===currentAudioTrack?"showing":"disabled",track})),selectedAudioTrack&&(events.emit("audioTrackLoaded",selectedAudioTrack),onPropChanged("selectedAudioTrackId"))})),videoElement&&videoElement.audioTracks){for(var i=0;i<videoElement.audioTracks.length;i++)videoElement.audioTracks[i].enabled=!1;videoElement.audioTracks[trackIndex]&&(videoElement.audioTracks[trackIndex].enabled=!0)}}break;case"volume":null!==propValue&&isFinite(propValue)&&(videoElement.muted=!1,videoElement.volume=Math.max(0,Math.min(100,parseInt(propValue,10)))/100);break;case"muted":videoElement.muted=!!propValue;break;case"playbackSpeed":null!==propValue&&isFinite(propValue)&&(lastPlaybackSpeed=parseFloat(propValue),videoElement.mediaId&&luna({method:"setPlayRate",parameters:{mediaId:videoElement.mediaId,playRate:lastPlaybackSpeed,audioOutput:!0}}),onPropChanged("playbackSpeed"))}var size,offset}function command(commandName,commandArgs){switch(commandName){case"load":if(commandArgs&&commandArgs.stream&&"string"==typeof commandArgs.stream.url){stream=commandArgs.stream,startTime=commandArgs.time,onPropChanged("stream"),videoElement.autoplay="boolean"!=typeof commandArgs.autoplay||commandArgs.autoplay,onPropChanged("paused"),onPropChanged("time"),onPropChanged("duration"),onPropChanged("buffering"),onPropChanged("buffered"),onPropChanged("subtitlesTracks"),onPropChanged("selectedSubtitlesTrackId"),onPropChanged("audioTracks"),onPropChanged("selectedAudioTrackId");var count=0;videoElement.src=stream.url,cb=function(){try{videoElement.load()}catch(e){}try{videoElement.play()}catch(e){}},timer=setInterval((function(){if(videoElement.mediaId)return knownMediaId=videoElement.mediaId,clearInterval(timer),void subscribe(cb);++count>4&&(clearInterval(timer),cb())}),300)}else onError(Object.assign({},ERROR.UNSUPPORTED_STREAM,{critical:!0,stream:commandArgs?commandArgs.stream:null}));break;case"unload":stream=null,startTime=null,Array.from(videoElement.textTracks).forEach((function(track){track.oncuechange=null})),videoElement.removeAttribute("src"),videoElement.load(),onPropChanged("stream"),onPropChanged("paused"),onPropChanged("time"),onPropChanged("duration"),onPropChanged("buffering"),onPropChanged("buffered"),onPropChanged("subtitlesTracks"),onPropChanged("selectedSubtitlesTrackId"),onPropChanged("audioTracks"),onPropChanged("selectedAudioTrackId");break;case"destroy":command("unload"),destroyed=!0,onPropChanged("subtitlesOffset"),onPropChanged("subtitlesSize"),onPropChanged("subtitlesTextColor"),onPropChanged("subtitlesBackgroundColor"),onPropChanged("subtitlesOpacity"),onPropChanged("volume"),onPropChanged("muted"),onPropChanged("playbackSpeed"),events.removeAllListeners(),videoElement.onerror=null,videoElement.onended=null,videoElement.onpause=null,videoElement.onplay=null,videoElement.ontimeupdate=null,videoElement.ondurationchange=null,videoElement.onwaiting=null,videoElement.onseeking=null,videoElement.onseeked=null,videoElement.onstalled=null,videoElement.onplaying=null,videoElement.oncanplay=null,videoElement.canplaythrough=null,videoElement.onloadeddata=null,videoElement.onloadedmetadata=null,videoElement.onvolumechange=null,videoElement.onratechange=null,videoElement.textTracks.onchange=null,containerElement.removeChild(videoElement),containerElement.removeChild(styleElement)}var cb,timer}this.on=function(eventName,listener){if(destroyed)throw new Error("Video is destroyed");events.on(eventName,listener)},this.dispatch=function(action){if(destroyed)throw new Error("Video is destroyed");if(action)switch((action=deepFreeze(cloneDeep(action))).type){case"observeProp":return propName=action.propName,void(observedProps.hasOwnProperty(propName)&&(events.emit("propValue",propName,getProp(propName)),observedProps[propName]=!0));case"setProp":return void setProp(action.propName,action.propValue);case"command":return void command(action.commandName,action.commandArgs)}var propName;throw new Error("Invalid action dispatched: "+JSON.stringify(action))}}WebOsVideo.canPlayStream=function(){return Promise.resolve(!0)},WebOsVideo.manifest={name:"WebOsVideo",external:!1,props:["stream","paused","time","duration","buffering","buffered","audioTracks","selectedAudioTrackId","subtitlesTracks","selectedSubtitlesTrackId","subtitlesOffset","subtitlesSize","subtitlesTextColor","subtitlesBackgroundColor","subtitlesOpacity","volume","muted","playbackSpeed"],commands:["load","unload","destroy"],events:["propValue","propChanged","ended","error","subtitlesTrackLoaded","audioTrackLoaded"]},module.exports=WebOsVideo},8846:(module,__unused_webpack_exports,__webpack_require__)=>{var WebOsVideo=__webpack_require__(4333);module.exports=WebOsVideo},9736:(module,__unused_webpack_exports,__webpack_require__)=>{var EventEmitter=__webpack_require__(6729),cloneDeep=__webpack_require__(3465),deepFreeze=__webpack_require__(2682),ERROR=__webpack_require__(9657);function YouTubeVideo(options){var timeChangedTimeout=null!==(options=options||{}).timeChangedTimeout&&isFinite(options.timeChangedTimeout)?parseInt(options.timeChangedTimeout,10):100,containerElement=options.containerElement;if(!(containerElement instanceof HTMLElement))throw new Error("Container element required to be instance of HTMLElement");var apiScriptElement=document.createElement("script");apiScriptElement.type="text/javascript",apiScriptElement.src="https://www.youtube.com/iframe_api",apiScriptElement.onload=function(){if(destroyed)return;if(!YT||"function"!=typeof YT.ready)return void onAPIError();YT.ready((function(){destroyed||(YT&&YT.PlayerState&&"function"==typeof YT.Player?video=new YT.Player(videoContainerElement,{width:"100%",height:"100%",playerVars:{autoplay:1,cc_load_policy:3,controls:0,disablekb:1,enablejsapi:1,fs:0,iv_load_policy:3,loop:0,modestbranding:1,playsinline:1,rel:0},events:{onError:onVideoError,onReady:onVideoReady,onApiChange:onVideoAPIChange,onStateChange:onVideoStateChange}}):onAPIError())}))},apiScriptElement.onerror=onAPIError,containerElement.appendChild(apiScriptElement);var videoContainerElement=document.createElement("div");videoContainerElement.style.width="100%",videoContainerElement.style.height="100%",videoContainerElement.style.backgroundColor="black",containerElement.appendChild(videoContainerElement);var timeChangedIntervalId=window.setInterval((function(){onPropChanged("time"),onPropChanged("volume"),onPropChanged("muted"),onPropChanged("playbackSpeed")}),timeChangedTimeout),video=null,ready=!1,pendingLoadArgs=null,events=new EventEmitter,destroyed=!1,stream=null,selectedSubtitlesTrackId=null,observedProps={stream:!1,loaded:!1,paused:!1,time:!1,duration:!1,buffering:!1,volume:!1,muted:!1,playbackSpeed:!1,subtitlesTracks:!1,selectedSubtitlesTrackId:!1};function onAPIError(){destroyed||onError(Object.assign({},ERROR.YOUTUBE_VIDEO.API_LOAD_FAILED,{critical:!0}))}function onVideoError(videoError){if(!destroyed){var error;switch(videoError.data){case 2:error=ERROR.YOUTUBE_VIDEO.INVALID_PARAMETER;break;case 5:error=ERROR.YOUTUBE_VIDEO.HTML5_VIDEO;break;case 100:error=ERROR.YOUTUBE_VIDEO.VIDEO_NOT_FOUND;break;case 101:case 150:error=ERROR.YOUTUBE_VIDEO.VIDEO_NOT_EMBEDDABLE;break;default:error=ERROR.UNKNOWN_ERROR}onError(Object.assign({},error,{critical:!0,error:videoError}))}}function onVideoReady(){destroyed||(ready=!0,null!==pendingLoadArgs&&(command("load",pendingLoadArgs),pendingLoadArgs=null))}function onVideoAPIChange(){destroyed||("function"==typeof video.loadModule&&video.loadModule("captions"),"function"==typeof video.setOption&&video.setOption("captions","track",{}),onPropChanged("paused"),onPropChanged("time"),onPropChanged("duration"),onPropChanged("buffering"),onPropChanged("volume"),onPropChanged("muted"),onPropChanged("playbackSpeed"),onPropChanged("subtitlesTracks"),onPropChanged("selectedSubtitlesTrackId"))}function onVideoStateChange(state){switch(onPropChanged("buffering"),state.data){case YT.PlayerState.ENDED:events.emit("ended");break;case YT.PlayerState.CUED:case YT.PlayerState.UNSTARTED:case YT.PlayerState.PAUSED:case YT.PlayerState.PLAYING:onPropChanged("paused"),onPropChanged("time"),onPropChanged("duration")}}function getProp(propName){switch(propName){case"stream":return stream;case"loaded":return null!==stream||null;case"paused":return null===stream||"function"!=typeof video.getPlayerState?null:video.getPlayerState()!==YT.PlayerState.PLAYING;case"time":return null!==stream&&"function"==typeof video.getCurrentTime&&null!==video.getCurrentTime()&&isFinite(video.getCurrentTime())?Math.floor(1e3*video.getCurrentTime()):null;case"duration":return null!==stream&&"function"==typeof video.getDuration&&null!==video.getDuration()&&isFinite(video.getDuration())?Math.floor(1e3*video.getDuration()):null;case"buffering":return null===stream||"function"!=typeof video.getPlayerState?null:video.getPlayerState()===YT.PlayerState.BUFFERING;case"volume":return null!==stream&&"function"==typeof video.getVolume&&null!==video.getVolume()&&isFinite(video.getVolume())?video.getVolume():null;case"muted":return null===stream||"function"!=typeof video.isMuted?null:video.isMuted();case"playbackSpeed":return null!==stream&&"function"==typeof video.getPlaybackRate&&null!==video.getPlaybackRate()&&isFinite(video.getPlaybackRate())?video.getPlaybackRate():null;case"subtitlesTracks":return null===stream||"function"!=typeof video.getOption?[]:(video.getOption("captions","tracklist")||[]).filter((function(track){return track&&"string"==typeof track.languageCode})).map((function(track,index){return Object.freeze({id:"EMBEDDED_"+String(index),lang:track.languageCode,label:"string"==typeof track.displayName?track.displayName:track.languageCode,origin:"EMBEDDED",embedded:!0})}));case"selectedSubtitlesTrackId":return null===stream?null:selectedSubtitlesTrackId;default:return null}}function onError(error){events.emit("error",error),error.critical&&command("unload")}function onPropChanged(propName){observedProps[propName]&&events.emit("propChanged",propName,getProp(propName))}function command(commandName,commandArgs){switch(commandName){case"load":if(command("unload"),commandArgs&&commandArgs.stream&&"string"==typeof commandArgs.stream.ytId)if(ready){stream=commandArgs.stream,onPropChanged("stream"),onPropChanged("loaded");var autoplay="boolean"!=typeof commandArgs.autoplay||commandArgs.autoplay,time=null!==commandArgs.time&&isFinite(commandArgs.time)?parseInt(commandArgs.time,10)/1e3:0;autoplay&&"function"==typeof video.loadVideoById?video.loadVideoById({videoId:commandArgs.stream.ytId,startSeconds:time}):"function"==typeof video.cueVideoById&&video.cueVideoById({videoId:commandArgs.stream.ytId,startSeconds:time}),onPropChanged("paused"),onPropChanged("time"),onPropChanged("duration"),onPropChanged("buffering"),onPropChanged("volume"),onPropChanged("muted"),onPropChanged("playbackSpeed"),onPropChanged("subtitlesTracks"),onPropChanged("selectedSubtitlesTrackId")}else pendingLoadArgs=commandArgs;else onError(Object.assign({},ERROR.UNSUPPORTED_STREAM,{critical:!0,stream:commandArgs?commandArgs.stream:null}));break;case"unload":pendingLoadArgs=null,stream=null,onPropChanged("stream"),onPropChanged("loaded"),selectedSubtitlesTrackId=null,ready&&"function"==typeof video.stopVideo&&video.stopVideo(),onPropChanged("paused"),onPropChanged("time"),onPropChanged("duration"),onPropChanged("buffering"),onPropChanged("volume"),onPropChanged("muted"),onPropChanged("playbackSpeed"),onPropChanged("subtitlesTracks"),onPropChanged("selectedSubtitlesTrackId");break;case"destroy":command("unload"),destroyed=!0,events.removeAllListeners(),clearInterval(timeChangedIntervalId),ready&&"function"==typeof video.destroy&&video.destroy(),containerElement.removeChild(apiScriptElement),containerElement.removeChild(videoContainerElement)}}this.on=function(eventName,listener){if(destroyed)throw new Error("Video is destroyed");events.on(eventName,listener)},this.dispatch=function(action){if(destroyed)throw new Error("Video is destroyed");if(action)switch((action=deepFreeze(cloneDeep(action))).type){case"observeProp":return propName=action.propName,void(observedProps.hasOwnProperty(propName)&&(events.emit("propValue",propName,getProp(propName)),observedProps[propName]=!0));case"setProp":return void(function(propName,propValue){switch(propName){case"paused":null!==stream&&(propValue?"function"==typeof video.pauseVideo&&video.pauseVideo():"function"==typeof video.playVideo&&video.playVideo());break;case"time":null!==stream&&"function"==typeof video.seekTo&&null!==propValue&&isFinite(propValue)&&video.seekTo(parseInt(propValue,10)/1e3);break;case"volume":null!==stream&&null!==propValue&&isFinite(propValue)&&("function"==typeof video.unMute&&video.unMute(),"function"==typeof video.setVolume&&video.setVolume(Math.max(0,Math.min(100,parseInt(propValue,10)))),onPropChanged("muted"),onPropChanged("volume"));break;case"muted":null!==stream&&(propValue?"function"==typeof video.mute&&video.mute():"function"==typeof video.unMute&&video.unMute(),onPropChanged("muted"));break;case"playbackSpeed":null!==stream&&"function"==typeof video.setPlaybackRate&&isFinite(propValue)&&(video.setPlaybackRate(propValue),onPropChanged("playbackSpeed"));break;case"selectedSubtitlesTrackId":if(null!==stream){selectedSubtitlesTrackId=null;var selecterdTrack=getProp("subtitlesTracks").find((function(track){return track.id===propValue}));"function"==typeof video.setOption&&(selecterdTrack?(selectedSubtitlesTrackId=selecterdTrack.id,video.setOption("captions","track",{languageCode:selecterdTrack.lang}),events.emit("subtitlesTrackLoaded",selecterdTrack)):video.setOption("captions","track",{})),onPropChanged("selectedSubtitlesTrackId")}}})(action.propName,action.propValue);case"command":return void command(action.commandName,action.commandArgs)}var propName;throw new Error("Invalid action dispatched: "+JSON.stringify(action))}}YouTubeVideo.canPlayStream=function(stream){return Promise.resolve(stream&&"string"==typeof stream.ytId)},YouTubeVideo.manifest={name:"YouTubeVideo",external:!1,props:["stream","loaded","paused","time","duration","buffering","volume","muted","playbackSpeed","subtitlesTracks","selectedSubtitlesTrackId"],commands:["load","unload","destroy"],events:["propValue","propChanged","ended","error","subtitlesTrackLoaded"]},module.exports=YouTubeVideo},3142:(module,__unused_webpack_exports,__webpack_require__)=>{var YouTubeVideo=__webpack_require__(9736);module.exports=YouTubeVideo},9657:module=>{module.exports={CHROMECAST_SENDER_VIDEO:{INVALID_MESSAGE_RECEIVED:{code:100,message:"Invalid message received"},MESSAGE_SEND_FAILED:{code:101,message:"Failed to send message"}},YOUTUBE_VIDEO:{API_LOAD_FAILED:{code:90,message:"YouTube player iframe API failed to load"},INVALID_PARAMETER:{code:91,message:"The request contains an invalid parameter value"},HTML5_VIDEO:{code:92,message:"The requested content cannot be played in an HTML5 player"},VIDEO_NOT_FOUND:{code:93,message:"The video requested was not found"},VIDEO_NOT_EMBEDDABLE:{code:94,message:"The owner of the requested video does not allow it to be played in embedded players"}},HTML_VIDEO:{MEDIA_ERR_ABORTED:{code:80,message:"Fetching process aborted"},MEDIA_ERR_NETWORK:{code:81,message:"Error occurred when downloading"},MEDIA_ERR_DECODE:{code:82,message:"Error occurred when decoding"},MEDIA_ERR_SRC_NOT_SUPPORTED:{code:83,message:"Video is not supported"}},WITH_HTML_SUBTITLES:{LOAD_FAILED:{code:70,message:"Failed to load external subtitles"}},WITH_STREAMING_SERVER:{CONVERT_FAILED:{code:60,message:"Your device does not support the stream"}},UNKNOWN_ERROR:{code:1,message:"Unknown error"},UNSUPPORTED_STREAM:{code:2,message:"Stream is not supported"},STREAM_FAILED_TO_LOAD:{code:3,message:"Stream failed to load"}}},1654:(module,__unused_webpack_exports,__webpack_require__)=>{var StremioVideo=__webpack_require__(5010);module.exports=StremioVideo},5015:module=>{var mediaElement,formats,VIDEO_CODEC_CONFIGS=[{codec:"h264",force:window.chrome||window.cast,mime:'video/mp4; codecs="avc1.42E01E"'},{codec:"h265",mime:'video/mp4; codecs="hev1.1.6.L150.B0"',aliases:["hevc"]},{codec:"vp8",mime:'video/mp4; codecs="vp8"'},{codec:"vp9",mime:'video/mp4; codecs="vp9"'}],AUDIO_CODEC_CONFIGS=[{codec:"aac",mime:'audio/mp4; codecs="mp4a.40.2"'},{codec:"mp3",mime:'audio/mp4; codecs="mp3"'},{codec:"ac3",mime:'audio/mp4; codecs="ac-3"'},{codec:"eac3",mime:'audio/mp4; codecs="ec-3"'},{codec:"vorbis",mime:'audio/mp4; codecs="vorbis"'},{codec:"opus",mime:'audio/mp4; codecs="opus"'}];function canPlay(config,options){return config.force||options.mediaElement.canPlayType(config.mime)?[config.codec].concat(config.aliases||[]):[]}module.exports=(mediaElement=document.createElement("video"),formats=["mp4"],(window.chrome||window.cast)&&formats.push("matroska,webm"),{formats:formats,videoCodecs:VIDEO_CODEC_CONFIGS.map((function(config){return canPlay(config,{mediaElement:mediaElement})})).reduce((function(result,value){return result.concat(value)}),[]),audioCodecs:AUDIO_CODEC_CONFIGS.map((function(config){return canPlay(config,{mediaElement:mediaElement})})).reduce((function(result,value){return result.concat(value)}),[]),maxAudioChannels:(function(){if(/firefox/i.test(window.navigator.userAgent))return 6;if(!window.AudioContext||window.chrome||window.cast)return 2;var maxChannelCount=(new AudioContext).destination.maxChannelCount;return maxChannelCount>0?maxChannelCount:2})()})},1258:(module,__unused_webpack_exports,__webpack_require__)=>{module.exports=function(){return void 0!==__webpack_require__.g.tizen||void 0!==__webpack_require__.g.webOS?Promise.resolve(!1):Promise.resolve(!0)}},9490:module=>{module.exports=function(array,value){if(value<array[0]||array[array.length-1]<value)return-1;for(var left=0,right=array.length-1,index=-1;left<=right;){var middle=Math.floor((left+right)/2);array[middle]>value?right=middle-1:(array[middle]<value||(index=middle),left=middle+1)}return-1!==index?index:right}},4282:(module,__unused_webpack_exports,__webpack_require__)=>{var withHTMLSubtitles=__webpack_require__(4253);module.exports=withHTMLSubtitles},6950:module=>{function convertSrtCue(caption){for(var cue="",s=(caption=caption.replace(/<[a-zA-Z/][^>]*>/g,"")).split(/\n/);s.length>3;){for(var i=3;i<s.length;i++)s[2]+="\n"+s[i];s.splice(3,s.length-3)}var line=0;if(!s[0].match(/\d+:\d+:\d+/)&&s[1].match(/\d+:\d+:\d+/)&&(cue+=s[0].match(/\w+/)+"\n",line+=1),!s[line].match(/\d+:\d+:\d+/))return"";var m=s[1].match(/(\d+):(\d+):(\d+)(?:,(\d+))?\s*--?>\s*(\d+):(\d+):(\d+)(?:,(\d+))?/);return m?(cue+=m[1]+":"+m[2]+":"+m[3]+"."+m[4]+" --\x3e "+m[5]+":"+m[6]+":"+m[7]+"."+m[8]+"\n",s[line+=1]&&(cue+=s[line]+"\n\n"),cue):""}module.exports={convert:function(text){if(text.includes("WEBVTT"))return text;try{return(function(data){var srt=data.replace(/\r+/g,""),cuelist=(srt=srt.replace(/^\s+|\s+$/g,"")).split("\n\n"),result="";if(cuelist.length>0){result+="WEBVTT\n\n";for(var i=0;i<cuelist.length;i+=1)result+=convertSrtCue(cuelist[i])}return result})(text)}catch(error){throw new Error("Failed to convert srt to webvtt: "+error.message)}}}},5517:(module,__unused_webpack_exports,__webpack_require__)=>{var VTTJS=__webpack_require__(8369),binarySearchUpperBound=__webpack_require__(9490);module.exports={parse:function(text){return new Promise((function(resolve,reject){var parser=new VTTJS.WebVTT.Parser(window,VTTJS.WebVTT.StringDecoder()),errors=[],cues=[],cuesByTime={};parser.oncue=function(c){var cue={startTime:1e3*c.startTime|0,endTime:1e3*c.endTime|0,text:c.text};cues.push(cue),cuesByTime[cue.startTime]=cuesByTime[cue.startTime]||[],cuesByTime[cue.endTime]=cuesByTime[cue.endTime]||[]},parser.onparsingerror=function(error){0===error.code?(parser.oncue=null,parser.onparsingerror=null,parser.onflush=null,reject(error)):(console.warn("Subtitles parsing error",error),errors.push(error))},parser.onflush=function(){cuesByTime.times=Object.keys(cuesByTime).map((function(time){return parseInt(time,10)})).sort((function(t1,t2){return t1-t2}));for(var i=0;i<cues.length;i++){cuesByTime[cues[i].startTime].push(cues[i]);for(var j=binarySearchUpperBound(cuesByTime.times,cues[i].startTime)+1;j<cuesByTime.times.length&&!(cues[i].endTime<=cuesByTime.times[j]);j++)cuesByTime[cuesByTime.times[j]].push(cues[i])}for(var k=0;k<cuesByTime.times.length;k++)cuesByTime[cuesByTime.times[k]].sort((function(c1,c2){return c1.startTime-c2.startTime||c1.endTime-c2.endTime}));parser.oncue=null,parser.onparsingerror=null,parser.onflush=null,0===cues.length&&errors.length?reject(errors[0]):0===cuesByTime.times.length?reject(new Error("Missing subtitle track cues")):resolve(cuesByTime)},parser.parse(text)}))}}},2913:(module,__unused_webpack_exports,__webpack_require__)=>{var VTTJS=__webpack_require__(8369),binarySearchUpperBound=__webpack_require__(9490);module.exports={render:function(cuesByTime,time){var nodes=[],timeIndex=binarySearchUpperBound(cuesByTime.times,time);if(-1!==timeIndex)for(var cuesForTime=cuesByTime[cuesByTime.times[timeIndex]],i=0;i<cuesForTime.length;i++){var node=VTTJS.WebVTT.convertCueToDOMTree(window,cuesForTime[i].text);nodes.push(node)}return nodes}}},4253:(module,__unused_webpack_exports,__webpack_require__)=>{var EventEmitter=__webpack_require__(6729),cloneDeep=__webpack_require__(3465),deepFreeze=__webpack_require__(2682),Color=__webpack_require__(6767),ERROR=__webpack_require__(9657),subtitlesParser=__webpack_require__(5517),subtitlesRenderer=__webpack_require__(2913),subtitlesConverter=__webpack_require__(6950);module.exports=function(Video){function VideoWithHTMLSubtitles(options){var video=new Video(options=options||{});video.on("error",(function(error){events.emit("error",error),error.critical&&command("unload")})),video.on("propValue",onVideoPropEvent.bind(null,"propValue")),video.on("propChanged",onVideoPropEvent.bind(null,"propChanged")),Video.manifest.events.filter((function(eventName){return!["error","propValue","propChanged"].includes(eventName)})).forEach((function(eventName){video.on(eventName,(function(eventName){return function(){events.emit.apply(events,[eventName].concat(Array.from(arguments)))}})(eventName))}));var containerElement=options.containerElement;if(!(containerElement instanceof HTMLElement))throw new Error("Container element required to be instance of HTMLElement");var subtitlesElement=document.createElement("div");subtitlesElement.style.position="absolute",subtitlesElement.style.right="0",subtitlesElement.style.bottom="0",subtitlesElement.style.left="0",subtitlesElement.style.zIndex="1",subtitlesElement.style.textAlign="center",containerElement.style.position="relative",containerElement.style.zIndex="0",containerElement.appendChild(subtitlesElement);var videoState={time:null},cuesByTime=null,events=new EventEmitter,destroyed=!1,tracks=[],selectedTrackId=null,delay=null,size=100,offset=0,textColor="rgb(255, 255, 255)",backgroundColor="rgba(0, 0, 0, 0)",outlineColor="rgb(34, 34, 34)",opacity=1,observedProps={extraSubtitlesTracks:!1,selectedExtraSubtitlesTrackId:!1,extraSubtitlesDelay:!1,extraSubtitlesSize:!1,extraSubtitlesOffset:!1,extraSubtitlesTextColor:!1,extraSubtitlesBackgroundColor:!1,extraSubtitlesOutlineColor:!1,extraSubtitlesOpacity:!1};function renderSubtitles(){for(;subtitlesElement.hasChildNodes();)subtitlesElement.removeChild(subtitlesElement.lastChild);null!==cuesByTime&&null!==videoState.time&&isFinite(videoState.time)&&(subtitlesElement.style.bottom=offset+"%",subtitlesElement.style.opacity=opacity,subtitlesRenderer.render(cuesByTime,videoState.time-delay).forEach((function(cueNode){cueNode.style.display="inline-block",cueNode.style.padding="0.2em",cueNode.style.whiteSpace="pre-wrap",cueNode.style.fontSize=Math.floor(size/25)+"vmin",cueNode.style.color=textColor,cueNode.style.backgroundColor=backgroundColor,cueNode.style.textShadow="1px 1px 0.1em "+outlineColor,subtitlesElement.appendChild(cueNode),subtitlesElement.appendChild(document.createElement("br"))})))}function onVideoPropEvent(eventName,propName,propValue){switch(propName){case"time":videoState.time=propValue,renderSubtitles()}events.emit(eventName,propName,getProp(propName,propValue))}function onPropChanged(propName){observedProps[propName]&&events.emit("propChanged",propName,getProp(propName,null))}function getProp(propName,videoPropValue){switch(propName){case"extraSubtitlesTracks":return destroyed?[]:tracks.slice();case"selectedExtraSubtitlesTrackId":return destroyed?null:selectedTrackId;case"extraSubtitlesDelay":return destroyed?null:delay;case"extraSubtitlesSize":return destroyed?null:size;case"extraSubtitlesOffset":return destroyed?null:offset;case"extraSubtitlesTextColor":return destroyed?null:textColor;case"extraSubtitlesBackgroundColor":return destroyed?null:backgroundColor;case"extraSubtitlesOutlineColor":return destroyed?null:outlineColor;case"extraSubtitlesOpacity":return destroyed?null:opacity;default:return videoPropValue}}function setProp(propName,propValue){switch(propName){case"selectedExtraSubtitlesTrackId":cuesByTime=null,selectedTrackId=null,delay=null;var selectedTrack=tracks.find((function(track){return track.id===propValue}));return selectedTrack&&(selectedTrackId=selectedTrack.id,delay=0,fetch(selectedTrack.url).then((function(resp){if(resp.ok)return resp.text();throw new Error(resp.status+" ("+resp.statusText+")")})).then((function(text){return subtitlesConverter.convert(text)})).then((function(text){return subtitlesParser.parse(text)})).then((function(result){selectedTrackId===selectedTrack.id&&(cuesByTime=result,renderSubtitles(),events.emit("extraSubtitlesTrackLoaded",selectedTrack))})).catch((function(error){selectedTrackId===selectedTrack.id&&(function(error){events.emit("error",error),error.critical&&(command("unload"),video.dispatch({type:"command",commandName:"unload"}))})(Object.assign({},ERROR.WITH_HTML_SUBTITLES.LOAD_FAILED,{error:error,track:selectedTrack,critical:!1}))}))),renderSubtitles(),onPropChanged("selectedExtraSubtitlesTrackId"),onPropChanged("extraSubtitlesDelay"),!0;case"extraSubtitlesDelay":return null!==selectedTrackId&&null!==propValue&&isFinite(propValue)&&(delay=parseInt(propValue,10),renderSubtitles(),onPropChanged("extraSubtitlesDelay")),!0;case"extraSubtitlesSize":return null!==propValue&&isFinite(propValue)&&(size=Math.max(0,parseInt(propValue,10)),renderSubtitles(),onPropChanged("extraSubtitlesSize")),!0;case"extraSubtitlesOffset":return null!==propValue&&isFinite(propValue)&&(offset=Math.max(0,Math.min(100,parseInt(propValue,10))),renderSubtitles(),onPropChanged("extraSubtitlesOffset")),!0;case"extraSubtitlesTextColor":if("string"==typeof propValue){try{textColor=Color(propValue).rgb().string()}catch(error){console.error("withHTMLSubtitles",error)}renderSubtitles(),onPropChanged("extraSubtitlesTextColor")}return!0;case"extraSubtitlesBackgroundColor":if("string"==typeof propValue){try{backgroundColor=Color(propValue).rgb().string()}catch(error){console.error("withHTMLSubtitles",error)}renderSubtitles(),onPropChanged("extraSubtitlesBackgroundColor")}return!0;case"extraSubtitlesOutlineColor":if("string"==typeof propValue){try{outlineColor=Color(propValue).rgb().string()}catch(error){console.error("withHTMLSubtitles",error)}renderSubtitles(),onPropChanged("extraSubtitlesOutlineColor")}return!0;case"extraSubtitlesOpacity":if("number"==typeof propValue){try{opacity=Math.min(Math.max(propValue/100,0),1)}catch(error){console.error("withHTMLSubtitles",error)}renderSubtitles(),onPropChanged("extraSubtitlesOpacity")}return!0;default:return!1}}function command(commandName,commandArgs){switch(commandName){case"addExtraSubtitlesTracks":return commandArgs&&Array.isArray(commandArgs.tracks)&&(tracks=tracks.concat(commandArgs.tracks).filter((function(track,index,tracks){return track&&"string"==typeof track.id&&"string"==typeof track.url&&"string"==typeof track.lang&&"string"==typeof track.label&&"string"==typeof track.origin&&!track.embedded&&index===tracks.findIndex((function(t){return t.id===track.id}))})),onPropChanged("extraSubtitlesTracks")),!0;case"load":return command("unload"),commandArgs.stream&&Array.isArray(commandArgs.stream.subtitles)&&command("addExtraSubtitlesTracks",{tracks:commandArgs.stream.subtitles.map((function(track){return Object.assign({},track,{origin:"EXCLUSIVE",exclusive:!0,embedded:!1})}))}),!1;case"unload":return cuesByTime=null,tracks=[],selectedTrackId=null,delay=null,renderSubtitles(),onPropChanged("extraSubtitlesTracks"),onPropChanged("selectedExtraSubtitlesTrackId"),onPropChanged("extraSubtitlesDelay"),!1;case"destroy":return command("unload"),destroyed=!0,onPropChanged("extraSubtitlesSize"),onPropChanged("extraSubtitlesOffset"),onPropChanged("extraSubtitlesTextColor"),onPropChanged("extraSubtitlesBackgroundColor"),onPropChanged("extraSubtitlesOutlineColor"),onPropChanged("extraSubtitlesOpacity"),video.dispatch({type:"command",commandName:"destroy"}),events.removeAllListeners(),containerElement.removeChild(subtitlesElement),!0;default:return!1}}this.on=function(eventName,listener){if(destroyed)throw new Error("Video is destroyed");events.on(eventName,listener)},this.dispatch=function(action){if(destroyed)throw new Error("Video is destroyed");if(action)switch((action=deepFreeze(cloneDeep(action))).type){case"observeProp":if((function(propName){switch(propName){case"extraSubtitlesTracks":case"selectedExtraSubtitlesTrackId":case"extraSubtitlesDelay":case"extraSubtitlesSize":case"extraSubtitlesOffset":case"extraSubtitlesTextColor":case"extraSubtitlesBackgroundColor":case"extraSubtitlesOutlineColor":case"extraSubtitlesOpacity":return events.emit("propValue",propName,getProp(propName,null)),observedProps[propName]=!0,!0;default:return!1}})(action.propName))return;break;case"setProp":if(setProp(action.propName,action.propValue))return;break;case"command":if(command(action.commandName,action.commandArgs))return}video.dispatch(action)}}return VideoWithHTMLSubtitles.canPlayStream=function(stream){return Video.canPlayStream(stream)},VideoWithHTMLSubtitles.manifest={name:Video.manifest.name+"WithHTMLSubtitles",external:Video.manifest.external,props:Video.manifest.props.concat(["extraSubtitlesTracks","selectedExtraSubtitlesTrackId","extraSubtitlesDelay","extraSubtitlesSize","extraSubtitlesOffset","extraSubtitlesTextColor","extraSubtitlesBackgroundColor","extraSubtitlesOutlineColor","extraSubtitlesOpacity"]).filter((function(value,index,array){return array.indexOf(value)===index})),commands:Video.manifest.commands.concat(["load","unload","destroy","addExtraSubtitlesTracks"]).filter((function(value,index,array){return array.indexOf(value)===index})),events:Video.manifest.events.concat(["propValue","propChanged","error","extraSubtitlesTrackLoaded"]).filter((function(value,index,array){return array.indexOf(value)===index}))},VideoWithHTMLSubtitles}},7054:(module,__unused_webpack_exports,__webpack_require__)=>{var magnet=__webpack_require__(9566),createTorrent=__webpack_require__(7190);module.exports=function(streamingServerURL,stream,seriesInfo){return new Promise((function(resolve,reject){if("string"!=typeof stream.url)"string"!=typeof stream.infoHash?reject(new Error("Stream cannot be converted")):createTorrent(streamingServerURL,stream.infoHash,stream.fileIdx,stream.announce,seriesInfo).then((function(torrent){resolve({url:torrent.url,infoHash:torrent.infoHash,fileIdx:torrent.fileIdx})})).catch((function(error){reject(error)}));else if(0===stream.url.indexOf("magnet:")){var parsedMagnetURI;try{if(!(parsedMagnetURI=magnet.decode(stream.url))||"string"!=typeof parsedMagnetURI.infoHash)throw new Error("Failed to decode magnet url")}catch(error){return void reject(error)}var sources=Array.isArray(parsedMagnetURI.announce)?parsedMagnetURI.announce.map((function(source){return"tracker:"+source})):[];createTorrent(streamingServerURL,parsedMagnetURI.infoHash,null,sources,seriesInfo).then((function(torrent){resolve({url:torrent.url,infoHash:torrent.infoHash,fileIdx:torrent.fileIdx})})).catch((function(error){reject(error)}))}else resolve({url:stream.url})}))}},7190:(module,__unused_webpack_exports,__webpack_require__)=>{var url=__webpack_require__(8575);function buildTorrent(streamingServerURL,infoHash,fileIdx,sources){var query=Array.isArray(sources)&&sources.length>0?"?"+new URLSearchParams(sources.map((function(source){return["tr",source]}))):"";return{url:url.resolve(streamingServerURL,"/"+encodeURIComponent(infoHash)+"/"+encodeURIComponent(fileIdx))+query,infoHash:infoHash,fileIdx:fileIdx,sources:sources}}module.exports=function(streamingServerURL,infoHash,fileIdx,sources,seriesInfo){if((!Array.isArray(sources)||0===sources.length)&&null!==fileIdx&&isFinite(fileIdx))return Promise.resolve(buildTorrent(streamingServerURL,infoHash,fileIdx,sources));var body={torrent:{infoHash:infoHash}};return Array.isArray(sources)&&sources.length>0&&(body.peerSearch={sources:["dht:"+infoHash].concat(sources).filter((function(source,index,sources){return sources.indexOf(source)===index})),min:40,max:200}),null!==fileIdx&&isFinite(fileIdx)?body.guessFileIdx=!1:(body.guessFileIdx={},seriesInfo&&(null!==seriesInfo.season&&isFinite(seriesInfo.season)&&(body.guessFileIdx.season=seriesInfo.season),null!==seriesInfo.episode&&isFinite(seriesInfo.episode)&&(body.guessFileIdx.episode=seriesInfo.episode))),fetch(url.resolve(streamingServerURL,"/"+encodeURIComponent(infoHash)+"/create"),{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(body)}).then((function(resp){if(resp.ok)return resp.json();throw new Error(resp.status+" ("+resp.statusText+")")})).then((function(resp){return buildTorrent(streamingServerURL,infoHash,body.guessFileIdx?resp.guessedFileIdx:fileIdx,body.peerSearch?body.peerSearch.sources:[])}))}},4536:(module,__unused_webpack_exports,__webpack_require__)=>{var url=__webpack_require__(8575);function fetchOpensubtitlesParams(streamingServerURL,mediaURL,behaviorHints){var hash=behaviorHints&&"string"==typeof behaviorHints.videoHash?behaviorHints.videoHash:null,size=behaviorHints&&isFinite(behaviorHints.videoSize)?behaviorHints.videoSize:null;if("string"==typeof hash&&null!==size&&isFinite(size))return Promise.resolve({hash:hash,size:size});var queryParams=new URLSearchParams([["videoUrl",mediaURL]]);return fetch(url.resolve(streamingServerURL,"/opensubHash?"+queryParams.toString())).then((function(resp){if(resp.ok)return resp.json();throw new Error(resp.status+" ("+resp.statusText+")")})).then((function(resp){if(resp.error)throw new Error(resp.error);return{hash:"string"==typeof hash?hash:resp.result&&"string"==typeof resp.result.hash?resp.result.hash:null,size:null!==size&&isFinite(size)?size:resp.result&&(resp.result.size,1)?resp.result.size:null}}))}function fetchFilename(streamingServerURL,mediaURL,infoHash,fileIdx,behaviorHints){return behaviorHints&&"string"==typeof behaviorHints.filename?Promise.resolve(behaviorHints.filename):infoHash?fetch(url.resolve(streamingServerURL,"/"+encodeURIComponent(infoHash)+"/"+encodeURIComponent(fileIdx)+"/stats.json")).then((function(resp){if(resp.ok)return resp.json();throw new Error(resp.status+" ("+resp.statusText+")")})).then((function(resp){if(!resp||"string"!=typeof resp.streamName)throw new Error("Could not retrieve filename from torrent");return resp.streamName})):Promise.resolve(decodeURIComponent(mediaURL.split("/").pop()))}module.exports=function(streamingServerURL,mediaURL,infoHash,fileIdx,behaviorHints){return Promise.allSettled([fetchOpensubtitlesParams(streamingServerURL,mediaURL,behaviorHints),fetchFilename(streamingServerURL,mediaURL,infoHash,fileIdx,behaviorHints)]).then((function(results){var result={hash:null,size:null,filename:null};return"fulfilled"===results[0].status?(result.hash=results[0].value.hash,result.size=results[0].value.size):results[0].reason&&console.error(results[0].reason),"fulfilled"===results[1].status?result.filename=results[1].value:results[1].reason&&console.error(results[1].reason),result}))}},5690:(module,__unused_webpack_exports,__webpack_require__)=>{var withStreamingServer=__webpack_require__(7746);module.exports=withStreamingServer},8393:module=>{module.exports=function(video,props){return props.includes("loaded")?new Promise((function(resolve,reject){var isLoaded=null;video.on("propChanged",(function(propName,propValue){"loaded"===propName&&null!==propValue&&null===isLoaded&&(isLoaded=propValue,!0===propValue?resolve(!0):!1===propValue&&reject(Error("Player failed to load, will not retrieve video params")))})),video.dispatch({type:"observeProp",propName:"loaded"})})):Promise.resolve(!0)}},7746:(module,__unused_webpack_exports,__webpack_require__)=>{var EventEmitter=__webpack_require__(6729),url=__webpack_require__(8575),hat=__webpack_require__(542),cloneDeep=__webpack_require__(3465),deepFreeze=__webpack_require__(2682),mediaCapabilities=__webpack_require__(5015),convertStream=__webpack_require__(7054),fetchVideoParams=__webpack_require__(4536),isPlayerLoaded=__webpack_require__(8393),supportsTranscoding=__webpack_require__(1258),ERROR=__webpack_require__(9657);module.exports=function(Video){function VideoWithStreamingServer(options){var video=new Video(options=options||{});video.on("error",(function(error){events.emit("error",error),error.critical&&command("unload")})),video.on("propValue",onVideoPropEvent.bind(null,"propValue")),video.on("propChanged",onVideoPropEvent.bind(null,"propChanged")),Video.manifest.events.filter((function(eventName){return!["error","propValue","propChanged"].includes(eventName)})).forEach((function(eventName){video.on(eventName,(function(eventName){return function(){events.emit.apply(events,[eventName].concat(Array.from(arguments)))}})(eventName))}));var self=this,loadArgs=null,loaded=!1,actionsQueue=[],videoParams=null,events=new EventEmitter,destroyed=!1,observedProps={stream:!1,videoParams:!1};function onVideoPropEvent(eventName,propName,propValue){events.emit(eventName,propName,getProp(propName,propValue))}function onPropChanged(propName){observedProps[propName]&&events.emit("propChanged",propName,getProp(propName,null))}function onError(error){events.emit("error",error),error.critical&&(command("unload"),video.dispatch({type:"command",commandName:"unload"}))}function getProp(propName,videoPropValue){switch(propName){case"stream":return null!==loadArgs?loadArgs.stream:null;case"videoParams":return videoParams;default:return videoPropValue}}function command(commandName,commandArgs){switch(commandName){case"load":return commandArgs&&commandArgs.stream&&"string"==typeof commandArgs.streamingServerURL?(command("unload"),video.dispatch({type:"command",commandName:"unload"}),loadArgs=commandArgs,onPropChanged("stream"),convertStream(commandArgs.streamingServerURL,commandArgs.stream,commandArgs.seriesInfo).then((function(result){var mediaURL=result.url,infoHash=result.infoHash,fileIdx=result.fileIdx,formats=Array.isArray(commandArgs.formats)?commandArgs.formats:mediaCapabilities.formats,videoCodecs=Array.isArray(commandArgs.videoCodecs)?commandArgs.videoCodecs:mediaCapabilities.videoCodecs,audioCodecs=Array.isArray(commandArgs.audioCodecs)?commandArgs.audioCodecs:mediaCapabilities.audioCodecs,maxAudioChannels=null!==commandArgs.maxAudioChannels&&isFinite(commandArgs.maxAudioChannels)?commandArgs.maxAudioChannels:mediaCapabilities.maxAudioChannels,canPlayStreamOptions=Object.assign({},commandArgs,{formats:formats,videoCodecs:videoCodecs,audioCodecs:audioCodecs,maxAudioChannels:maxAudioChannels});return(commandArgs.forceTranscoding?Promise.resolve(!1):VideoWithStreamingServer.canPlayStream({url:mediaURL},canPlayStreamOptions)).catch((function(error){return console.warn("Media probe error",error),!1})).then((function(canPlay){if(canPlay)return{mediaURL:mediaURL,infoHash:infoHash,fileIdx:fileIdx,stream:{url:mediaURL}};var id=hat(),queryParams=new URLSearchParams([["mediaURL",mediaURL]]);return commandArgs.forceTranscoding&&queryParams.set("forceTranscoding","1"),videoCodecs.forEach((function(videoCodec){queryParams.append("videoCodecs",videoCodec)})),audioCodecs.forEach((function(audioCodec){queryParams.append("audioCodecs",audioCodec)})),queryParams.set("maxAudioChannels",maxAudioChannels),{mediaURL:mediaURL,infoHash:infoHash,fileIdx:fileIdx,stream:{url:url.resolve(commandArgs.streamingServerURL,"/hlsv2/"+id+"/master.m3u8?"+queryParams.toString()),subtitles:Array.isArray(commandArgs.stream.subtitles)?commandArgs.stream.subtitles.map((function(track){return Object.assign({},track,{url:"string"==typeof track.url?url.resolve(commandArgs.streamingServerURL,"/subtitles.vtt?"+new URLSearchParams([["from",track.url]]).toString()):track.url})})):[],behaviorHints:{headers:{"content-type":"application/vnd.apple.mpegurl"}}}}}))})).then((function(result){commandArgs===loadArgs&&(video.dispatch({type:"command",commandName:"load",commandArgs:Object.assign({},commandArgs,{stream:result.stream})}),loaded=!0,(function(){for(;actionsQueue.length>0;){var action=actionsQueue.shift();self.dispatch.call(self,action)}})(),isPlayerLoaded(video,Video.manifest.props).then((function(){return fetchVideoParams(commandArgs.streamingServerURL,result.mediaURL,result.infoHash,result.fileIdx,commandArgs.stream.behaviorHints)})).then((function(result){commandArgs===loadArgs&&(videoParams=result,onPropChanged("videoParams"))})).catch((function(error){commandArgs===loadArgs&&(console.error(error),videoParams={hash:null,size:null,filename:null},onPropChanged("videoParams"))})))})).catch((function(error){commandArgs===loadArgs&&onError(Object.assign({},ERROR.WITH_STREAMING_SERVER.CONVERT_FAILED,{error:error,critical:!0,stream:commandArgs.stream,streamingServerURL:commandArgs.streamingServerURL}))}))):onError(Object.assign({},ERROR.UNSUPPORTED_STREAM,{critical:!0,stream:commandArgs?commandArgs.stream:null,streamingServerURL:commandArgs&&"string"==typeof commandArgs.streamingServerURL?commandArgs.streamingServerURL:null})),!0;case"addExtraSubtitlesTracks":return loadArgs&&commandArgs&&Array.isArray(commandArgs.tracks)&&(loaded?video.dispatch({type:"command",commandName:"addExtraSubtitlesTracks",commandArgs:Object.assign({},commandArgs,{tracks:commandArgs.tracks.map((function(track){return Object.assign({},track,{url:"string"==typeof track.url?url.resolve(loadArgs.streamingServerURL,"/subtitles.vtt?"+new URLSearchParams([["from",track.url]]).toString()):track.url})}))})}):actionsQueue.push({type:"command",commandName:"addExtraSubtitlesTracks",commandArgs:commandArgs})),!0;case"unload":return loadArgs=null,loaded=!1,actionsQueue=[],videoParams=null,onPropChanged("stream"),onPropChanged("videoParams"),!1;case"destroy":return command("unload"),destroyed=!0,video.dispatch({type:"command",commandName:"destroy"}),events.removeAllListeners(),!0;default:return!loaded&&(actionsQueue.push({type:"command",commandName:commandName,commandArgs:commandArgs}),!0)}}this.on=function(eventName,listener){if(destroyed)throw new Error("Video is destroyed");events.on(eventName,listener)},this.dispatch=function(action){if(destroyed)throw new Error("Video is destroyed");if(action)switch((action=deepFreeze(cloneDeep(action))).type){case"observeProp":if((function(propName){switch(propName){case"stream":case"videoParams":return events.emit("propValue",propName,getProp(propName,null)),observedProps[propName]=!0,!0;default:return!1}})(action.propName))return;break;case"command":if(command(action.commandName,action.commandArgs))return}video.dispatch(action)}}return VideoWithStreamingServer.canPlayStream=function(stream,options){return supportsTranscoding().then((function(supported){if(!supported)return Video.canPlayStream(stream);var queryParams=new URLSearchParams([["mediaURL",stream.url]]);return fetch(url.resolve(options.streamingServerURL,"/hlsv2/probe?"+queryParams.toString())).then((function(resp){return resp.json()})).then((function(probe){var isFormatSupported=options.formats.some((function(format){return-1!==probe.format.name.indexOf(format)})),areStreamsSupported=probe.streams.every((function(stream){return"audio"===stream.track?stream.channels<=options.maxAudioChannels&&-1!==options.audioCodecs.indexOf(stream.codec):"video"!==stream.track||-1!==options.videoCodecs.indexOf(stream.codec)}));return isFormatSupported&&areStreamsSupported})).catch((function(){return Video.canPlayStream(stream)}))}))},VideoWithStreamingServer.manifest={name:Video.manifest.name+"WithStreamingServer",external:Video.manifest.external,props:Video.manifest.props.concat(["stream","videoParams"]).filter((function(value,index,array){return array.indexOf(value)===index})),commands:Video.manifest.commands.concat(["load","unload","destroy","addExtraSubtitlesTracks"]).filter((function(value,index,array){return array.indexOf(value)===index})),events:Video.manifest.events.concat(["propValue","propChanged","error"]).filter((function(value,index,array){return array.indexOf(value)===index}))},VideoWithStreamingServer}},9450:(module,__unused_webpack_exports,__webpack_require__)=>{var withVideoParams=__webpack_require__(6693);module.exports=withVideoParams},6693:(module,__unused_webpack_exports,__webpack_require__)=>{var EventEmitter=__webpack_require__(6729),cloneDeep=__webpack_require__(3465),deepFreeze=__webpack_require__(2682);module.exports=function(Video){function VideoWithVideoParams(options){var video=new Video(options=options||{});video.on("propValue",onVideoPropEvent.bind(null,"propValue")),video.on("propChanged",onVideoPropEvent.bind(null,"propChanged")),Video.manifest.events.filter((function(eventName){return!["propValue","propChanged"].includes(eventName)})).forEach((function(eventName){video.on(eventName,(function(eventName){return function(){events.emit.apply(events,[eventName].concat(Array.from(arguments)))}})(eventName))}));var stream=null,events=new EventEmitter,destroyed=!1,observedProps={videoParams:!1};function onVideoPropEvent(eventName,propName,propValue){"videoParams"!==propName&&events.emit(eventName,propName,getProp(propName,propValue)),"stream"===propName&&(stream=propValue,(function(propName){observedProps[propName]&&events.emit("propChanged",propName,getProp(propName,null))})("videoParams"))}function getProp(propName,videoPropValue){switch(propName){case"videoParams":return null===stream?null:{hash:stream.behaviorHints&&"string"==typeof stream.behaviorHints.videoHash?stream.behaviorHints.videoHash:null,size:stream.behaviorHints&&null!==stream.behaviorHints.videoSize&&isFinite(stream.behaviorHints.videoSize)?stream.behaviorHints.videoSize:null,filename:stream.behaviorHints&&"string"==typeof stream.behaviorHints.filename?stream.behaviorHints.filename:null};default:return videoPropValue}}this.on=function(eventName,listener){if(destroyed)throw new Error("Video is destroyed");events.on(eventName,listener)},this.dispatch=function(action){if(destroyed)throw new Error("Video is destroyed");if(action)switch((action=deepFreeze(cloneDeep(action))).type){case"observeProp":if((function(propName){switch(propName){case"videoParams":return events.emit("propValue",propName,getProp(propName,null)),observedProps[propName]=!0,!0;default:return!1}})(action.propName))return;break;case"command":if((function(commandName){switch(commandName){case"destroy":return destroyed=!0,video.dispatch({type:"command",commandName:"destroy"}),events.removeAllListeners(),!0;default:return!1}})(action.commandName,action.commandArgs))return}video.dispatch(action)}}return VideoWithVideoParams.canPlayStream=function(stream,options){return Video.canPlayStream(stream,options)},VideoWithVideoParams.manifest={name:Video.manifest.name+"WithVideoParams",external:Video.manifest.external,props:Video.manifest.props.concat(["videoParams"]).filter((function(value,index,array){return array.indexOf(value)===index})),commands:Video.manifest.commands.concat(["destroy"]).filter((function(value,index,array){return array.indexOf(value)===index})),events:Video.manifest.events.concat(["propValue","propChanged"]).filter((function(value,index,array){return array.indexOf(value)===index}))},VideoWithVideoParams}},5677:(module,__unused_webpack_exports,__webpack_require__)=>{function _slicedToArray(arr,i){return(function(arr){if(Array.isArray(arr))return arr})(arr)||(function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr})(arr,i)||(function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)})(arr,i)||(function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")})()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var React=__webpack_require__(7294),classnames=__webpack_require__(4184),hat=__webpack_require__(542),StremioVideo=__webpack_require__(1654),styles=__webpack_require__(751);module.exports=function(){var videoElementRef=React.useRef(null),_React$useState2=_slicedToArray(React.useState(!1),2),loaded=_React$useState2[0],setLoaded=_React$useState2[1];return React.useEffect((function(){var context=cast.framework.CastReceiverContext.getInstance(),video=new StremioVideo,messages={},emit=function(args){console.log("emit",args);for(var serializedMessage=JSON.stringify(args,(function(_,value){return value instanceof Error?{message:value.message,stack:value.stack}:value instanceof MediaError?{message:value.message,code:value.code}:value})),chunksCount=Math.ceil(serializedMessage.length/2e4),chunks=[],i=0;i<chunksCount;i++){var start=2e4*i,chunk=serializedMessage.slice(start,start+2e4);chunks.push(chunk)}var id=hat();chunks.map((function(chunk,index){context.sendCustomMessage("urn:x-cast:com.stremio",void 0,{id:id,chunk:chunk,index:index,length:chunks.length})}))},dispatch=function(action){console.log("dispatch",action);try{if(action&&"command"===action.type&&"load"===action.commandName&&action.commandArgs)return void video.dispatch(action,{containerElement:videoElementRef.current});video.dispatch(action)}catch(error){console.error("StremioVideo",error)}},onCustomMessage=function(event){try{var _event$data=event.data,id=_event$data.id,chunk=_event$data.chunk,index=_event$data.index,length=_event$data.length;if(messages[id]=messages[id]||[],messages[id][index]=chunk,Object.keys(messages[id]).length===length){var action=JSON.parse(messages[id].join(""));delete messages[id],dispatch(action)}}catch(error){emit({event:"error",args:[Object.assign({},StremioVideo.ERROR.CHROMECAST_SENDER_VIDEO.MESSAGE_SEND_FAILED,{error:error})]})}};video.on("propValue",(function(propName,propValue){"stream"===propName&&setLoaded(null!==propValue),emit({event:"propValue",args:[propName,propValue]})})),video.on("propChanged",(function(propName,propValue){"stream"===propName&&setLoaded(null!==propValue),emit({event:"propChanged",args:[propName,propValue]})})),video.on("error",(function(error){emit({event:"error",args:[error]})})),video.on("ended",(function(){emit({event:"ended"})})),video.on("subtitlesTrackLoaded",(function(track){emit({event:"subtitlesTrackLoaded",args:[track]})})),video.on("audioTrackLoaded",(function(track){emit({event:"audioTrackLoaded",args:[track]})})),video.on("extraSubtitlesTrackLoaded",(function(track){emit({event:"extraSubtitlesTrackLoaded",args:[track]})})),video.on("implementationChanged",(function(manifest){emit({event:"implementationChanged",args:[manifest]})})),context.addCustomMessageListener("urn:x-cast:com.stremio",onCustomMessage),context.setLoggerLevel(cast.framework.LoggerLevel.NONE);var options=new cast.framework.CastReceiverOptions;return options.disableIdleTimeout=!0,options.mediaElement=videoElementRef.current,context.start(options),function(){dispatch({commandName:"destroy"}),context.removeCustomMessageListener("urn:x-cast:com.stremio",onCustomMessage),context.stop()}}),[]),React.createElement("div",{className:styles["app-container"]},React.createElement("div",{className:classnames(styles.layer,styles["video-layer"])},React.createElement("div",{ref:videoElementRef,className:styles.video})),loaded?null:React.createElement("div",{className:classnames(styles.layer,styles["info-layer"])},React.createElement("img",{className:styles.logo,src:__webpack_require__(5313),alt:" ",loading:"lazy"}),React.createElement("div",{className:styles.label},"Stremio Chromecast Receiver v","0.0.17")))}},4008:(module,__unused_webpack_exports,__webpack_require__)=>{var App=__webpack_require__(5677);module.exports=App},9742:(__unused_webpack_module,exports)=>{"use strict";exports.byteLength=function(b64){var lens=getLens(b64),validLen=lens[0],placeHoldersLen=lens[1];return 3*(validLen+placeHoldersLen)/4-placeHoldersLen},exports.toByteArray=function(b64){var tmp,i,lens=getLens(b64),validLen=lens[0],placeHoldersLen=lens[1],arr=new Arr((function(b64,validLen,placeHoldersLen){return 3*(validLen+placeHoldersLen)/4-placeHoldersLen})(0,validLen,placeHoldersLen)),curByte=0,len=placeHoldersLen>0?validLen-4:validLen;for(i=0;i<len;i+=4)tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)],arr[curByte++]=tmp>>16&255,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp;2===placeHoldersLen&&(tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4,arr[curByte++]=255&tmp);1===placeHoldersLen&&(tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp);return arr},exports.fromByteArray=function(uint8){for(var tmp,len=uint8.length,extraBytes=len%3,parts=[],i=0,len2=len-extraBytes;i<len2;i+=16383)parts.push(encodeChunk(uint8,i,i+16383>len2?len2:i+16383));1===extraBytes?(tmp=uint8[len-1],parts.push(lookup[tmp>>2]+lookup[tmp<<4&63]+"==")):2===extraBytes&&(tmp=(uint8[len-2]<<8)+uint8[len-1],parts.push(lookup[tmp>>10]+lookup[tmp>>4&63]+lookup[tmp<<2&63]+"="));return parts.join("")};for(var lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;function getLens(b64){var len=b64.length;if(len%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var validLen=b64.indexOf("=");return-1===validLen&&(validLen=len),[validLen,validLen===len?0:4-validLen%4]}function encodeChunk(uint8,start,end){for(var tmp,num,output=[],i=start;i<end;i+=3)tmp=(uint8[i]<<16&16711680)+(uint8[i+1]<<8&65280)+(255&uint8[i+2]),output.push(lookup[(num=tmp)>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[63&num]);return output.join("")}revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63},7500:module=>{function parseRange(range){return range.reduce(((acc,cur,idx,arr)=>{const r=cur.split("-").map((cur=>parseInt(cur)));return acc.concat(((start,end=start)=>Array.from({length:end-start+1},((cur,idx)=>idx+start)))(...r))}),[])}module.exports=parseRange,module.exports.parse=parseRange,module.exports.compose=function(range){return range.reduce(((acc,cur,idx,arr)=>(0!==idx&&cur===arr[idx-1]+1||acc.push([]),acc[acc.length-1].push(cur),acc)),[]).map((cur=>cur.length>1?`${cur[0]}-${cur[cur.length-1]}`:`${cur[0]}`))}},8764:(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";const base64=__webpack_require__(9742),ieee754=__webpack_require__(645),customInspectSymbol="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;exports.Buffer=Buffer,exports.SlowBuffer=function(length){+length!=length&&(length=0);return Buffer.alloc(+length)},exports.INSPECT_MAX_BYTES=50;function createBuffer(length){if(length>2147483647)throw new RangeError('The value "'+length+'" is invalid for option "size"');const buf=new Uint8Array(length);return Object.setPrototypeOf(buf,Buffer.prototype),buf}function Buffer(arg,encodingOrOffset,length){if("number"==typeof arg){if("string"==typeof encodingOrOffset)throw new TypeError('The "string" argument must be of type string. Received type number');return allocUnsafe(arg)}return from(arg,encodingOrOffset,length)}function from(value,encodingOrOffset,length){if("string"==typeof value)return(function(string,encoding){"string"==typeof encoding&&""!==encoding||(encoding="utf8");if(!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding);const length=0|byteLength(string,encoding);let buf=createBuffer(length);const actual=buf.write(string,encoding);actual!==length&&(buf=buf.slice(0,actual));return buf})(value,encodingOrOffset);if(ArrayBuffer.isView(value))return(function(arrayView){if(isInstance(arrayView,Uint8Array)){const copy=new Uint8Array(arrayView);return fromArrayBuffer(copy.buffer,copy.byteOffset,copy.byteLength)}return fromArrayLike(arrayView)})(value);if(null==value)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof value);if(isInstance(value,ArrayBuffer)||value&&isInstance(value.buffer,ArrayBuffer))return fromArrayBuffer(value,encodingOrOffset,length);if("undefined"!=typeof SharedArrayBuffer&&(isInstance(value,SharedArrayBuffer)||value&&isInstance(value.buffer,SharedArrayBuffer)))return fromArrayBuffer(value,encodingOrOffset,length);if("number"==typeof value)throw new TypeError('The "value" argument must not be of type number. Received type number');const valueOf=value.valueOf&&value.valueOf();if(null!=valueOf&&valueOf!==value)return Buffer.from(valueOf,encodingOrOffset,length);const b=(function(obj){if(Buffer.isBuffer(obj)){const len=0|checked(obj.length),buf=createBuffer(len);return 0===buf.length||obj.copy(buf,0,0,len),buf}if(void 0!==obj.length)return"number"!=typeof obj.length||numberIsNaN(obj.length)?createBuffer(0):fromArrayLike(obj);if("Buffer"===obj.type&&Array.isArray(obj.data))return fromArrayLike(obj.data)})(value);if(b)return b;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof value[Symbol.toPrimitive])return Buffer.from(value[Symbol.toPrimitive]("string"),encodingOrOffset,length);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof value)}function assertSize(size){if("number"!=typeof size)throw new TypeError('"size" argument must be of type number');if(size<0)throw new RangeError('The value "'+size+'" is invalid for option "size"')}function allocUnsafe(size){return assertSize(size),createBuffer(size<0?0:0|checked(size))}function fromArrayLike(array){const length=array.length<0?0:0|checked(array.length),buf=createBuffer(length);for(let i=0;i<length;i+=1)buf[i]=255&array[i];return buf}function fromArrayBuffer(array,byteOffset,length){if(byteOffset<0||array.byteLength<byteOffset)throw new RangeError('"offset" is outside of buffer bounds');if(array.byteLength<byteOffset+(length||0))throw new RangeError('"length" is outside of buffer bounds');let buf;return buf=void 0===byteOffset&&void 0===length?new Uint8Array(array):void 0===length?new Uint8Array(array,byteOffset):new Uint8Array(array,byteOffset,length),Object.setPrototypeOf(buf,Buffer.prototype),buf}function checked(length){if(length>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+2147483647..toString(16)+" bytes");return 0|length}function byteLength(string,encoding){if(Buffer.isBuffer(string))return string.length;if(ArrayBuffer.isView(string)||isInstance(string,ArrayBuffer))return string.byteLength;if("string"!=typeof string)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof string);const len=string.length,mustMatch=arguments.length>2&&!0===arguments[2];if(!mustMatch&&0===len)return 0;let loweredCase=!1;for(;;)switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*len;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return mustMatch?-1:utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase(),loweredCase=!0}}function slowToString(encoding,start,end){let loweredCase=!1;if((void 0===start||start<0)&&(start=0),start>this.length)return"";if((void 0===end||end>this.length)&&(end=this.length),end<=0)return"";if((end>>>=0)<=(start>>>=0))return"";for(encoding||(encoding="utf8");;)switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase(),loweredCase=!0}}function swap(b,n,m){const i=b[n];b[n]=b[m],b[m]=i}function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(0===buffer.length)return-1;if("string"==typeof byteOffset?(encoding=byteOffset,byteOffset=0):byteOffset>2147483647?byteOffset=2147483647:byteOffset<-2147483648&&(byteOffset=-2147483648),numberIsNaN(byteOffset=+byteOffset)&&(byteOffset=dir?0:buffer.length-1),byteOffset<0&&(byteOffset=buffer.length+byteOffset),byteOffset>=buffer.length){if(dir)return-1;byteOffset=buffer.length-1}else if(byteOffset<0){if(!dir)return-1;byteOffset=0}if("string"==typeof val&&(val=Buffer.from(val,encoding)),Buffer.isBuffer(val))return 0===val.length?-1:arrayIndexOf(buffer,val,byteOffset,encoding,dir);if("number"==typeof val)return val&=255,"function"==typeof Uint8Array.prototype.indexOf?dir?Uint8Array.prototype.indexOf.call(buffer,val,byteOffset):Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset):arrayIndexOf(buffer,[val],byteOffset,encoding,dir);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){let i,indexSize=1,arrLength=arr.length,valLength=val.length;if(void 0!==encoding&&("ucs2"===(encoding=String(encoding).toLowerCase())||"ucs-2"===encoding||"utf16le"===encoding||"utf-16le"===encoding)){if(arr.length<2||val.length<2)return-1;indexSize=2,arrLength/=2,valLength/=2,byteOffset/=2}function read(buf,i){return 1===indexSize?buf[i]:buf.readUInt16BE(i*indexSize)}if(dir){let foundIndex=-1;for(i=byteOffset;i<arrLength;i++)if(read(arr,i)===read(val,-1===foundIndex?0:i-foundIndex)){if(-1===foundIndex&&(foundIndex=i),i-foundIndex+1===valLength)return foundIndex*indexSize}else-1!==foundIndex&&(i-=i-foundIndex),foundIndex=-1}else for(byteOffset+valLength>arrLength&&(byteOffset=arrLength-valLength),i=byteOffset;i>=0;i--){let found=!0;for(let j=0;j<valLength;j++)if(read(arr,i+j)!==read(val,j)){found=!1;break}if(found)return i}return-1}function hexWrite(buf,string,offset,length){offset=Number(offset)||0;const remaining=buf.length-offset;length?(length=Number(length))>remaining&&(length=remaining):length=remaining;const strLen=string.length;let i;for(length>strLen/2&&(length=strLen/2),i=0;i<length;++i){const parsed=parseInt(string.substr(2*i,2),16);if(numberIsNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer((function(str){const byteArray=[];for(let i=0;i<str.length;++i)byteArray.push(255&str.charCodeAt(i));return byteArray})(string),buf,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer((function(str,units){let c,hi,lo;const byteArray=[];for(let i=0;i<str.length&&!((units-=2)<0);++i)c=str.charCodeAt(i),hi=c>>8,lo=c%256,byteArray.push(lo),byteArray.push(hi);return byteArray})(string,buf.length-offset),buf,offset,length)}function base64Slice(buf,start,end){return 0===start&&end===buf.length?base64.fromByteArray(buf):base64.fromByteArray(buf.slice(start,end))}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);const res=[];let i=start;for(;i<end;){const firstByte=buf[i];let codePoint=null,bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){let secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:firstByte<128&&(codePoint=firstByte);break;case 2:secondByte=buf[i+1],128==(192&secondByte)&&(tempCodePoint=(31&firstByte)<<6|63&secondByte,tempCodePoint>127&&(codePoint=tempCodePoint));break;case 3:secondByte=buf[i+1],thirdByte=buf[i+2],128==(192&secondByte)&&128==(192&thirdByte)&&(tempCodePoint=(15&firstByte)<<12|(63&secondByte)<<6|63&thirdByte,tempCodePoint>2047&&(tempCodePoint<55296||tempCodePoint>57343)&&(codePoint=tempCodePoint));break;case 4:secondByte=buf[i+1],thirdByte=buf[i+2],fourthByte=buf[i+3],128==(192&secondByte)&&128==(192&thirdByte)&&128==(192&fourthByte)&&(tempCodePoint=(15&firstByte)<<18|(63&secondByte)<<12|(63&thirdByte)<<6|63&fourthByte,tempCodePoint>65535&&tempCodePoint<1114112&&(codePoint=tempCodePoint))}}null===codePoint?(codePoint=65533,bytesPerSequence=1):codePoint>65535&&(codePoint-=65536,res.push(codePoint>>>10&1023|55296),codePoint=56320|1023&codePoint),res.push(codePoint),i+=bytesPerSequence}return(function(codePoints){const len=codePoints.length;if(len<=4096)return String.fromCharCode.apply(String,codePoints);let res="",i=0;for(;i<len;)res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=4096));return res})(res)}exports.kMaxLength=2147483647,Buffer.TYPED_ARRAY_SUPPORT=(function(){try{const arr=new Uint8Array(1),proto={foo:function(){return 42}};return Object.setPrototypeOf(proto,Uint8Array.prototype),Object.setPrototypeOf(arr,proto),42===arr.foo()}catch(e){return!1}})(),Buffer.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(Buffer.prototype,"parent",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.buffer}}),Object.defineProperty(Buffer.prototype,"offset",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.byteOffset}}),Buffer.poolSize=8192,Buffer.from=function(value,encodingOrOffset,length){return from(value,encodingOrOffset,length)},Object.setPrototypeOf(Buffer.prototype,Uint8Array.prototype),Object.setPrototypeOf(Buffer,Uint8Array),Buffer.alloc=function(size,fill,encoding){return(function(size,fill,encoding){return assertSize(size),size<=0?createBuffer(size):void 0!==fill?"string"==typeof encoding?createBuffer(size).fill(fill,encoding):createBuffer(size).fill(fill):createBuffer(size)})(size,fill,encoding)},Buffer.allocUnsafe=function(size){return allocUnsafe(size)},Buffer.allocUnsafeSlow=function(size){return allocUnsafe(size)},Buffer.isBuffer=function(b){return null!=b&&!0===b._isBuffer&&b!==Buffer.prototype},Buffer.compare=function(a,b){if(isInstance(a,Uint8Array)&&(a=Buffer.from(a,a.offset,a.byteLength)),isInstance(b,Uint8Array)&&(b=Buffer.from(b,b.offset,b.byteLength)),!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(a===b)return 0;let x=a.length,y=b.length;for(let i=0,len=Math.min(x,y);i<len;++i)if(a[i]!==b[i]){x=a[i],y=b[i];break}return x<y?-1:y<x?1:0},Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(list,length){if(!Array.isArray(list))throw new TypeError('"list" argument must be an Array of Buffers');if(0===list.length)return Buffer.alloc(0);let i;if(void 0===length)for(length=0,i=0;i<list.length;++i)length+=list[i].length;const buffer=Buffer.allocUnsafe(length);let pos=0;for(i=0;i<list.length;++i){let buf=list[i];if(isInstance(buf,Uint8Array))pos+buf.length>buffer.length?(Buffer.isBuffer(buf)||(buf=Buffer.from(buf)),buf.copy(buffer,pos)):Uint8Array.prototype.set.call(buffer,buf,pos);else{if(!Buffer.isBuffer(buf))throw new TypeError('"list" argument must be an Array of Buffers');buf.copy(buffer,pos)}pos+=buf.length}return buffer},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){const len=this.length;if(len%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let i=0;i<len;i+=2)swap(this,i,i+1);return this},Buffer.prototype.swap32=function(){const len=this.length;if(len%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let i=0;i<len;i+=4)swap(this,i,i+3),swap(this,i+1,i+2);return this},Buffer.prototype.swap64=function(){const len=this.length;if(len%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let i=0;i<len;i+=8)swap(this,i,i+7),swap(this,i+1,i+6),swap(this,i+2,i+5),swap(this,i+3,i+4);return this},Buffer.prototype.toString=function(){const length=this.length;return 0===length?"":0===arguments.length?utf8Slice(this,0,length):slowToString.apply(this,arguments)},Buffer.prototype.toLocaleString=Buffer.prototype.toString,Buffer.prototype.equals=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b||0===Buffer.compare(this,b)},Buffer.prototype.inspect=function(){let str="";const max=exports.INSPECT_MAX_BYTES;return str=this.toString("hex",0,max).replace(/(.{2})/g,"$1 ").trim(),this.length>max&&(str+=" ... "),"<Buffer "+str+">"},customInspectSymbol&&(Buffer.prototype[customInspectSymbol]=Buffer.prototype.inspect),Buffer.prototype.compare=function(target,start,end,thisStart,thisEnd){if(isInstance(target,Uint8Array)&&(target=Buffer.from(target,target.offset,target.byteLength)),!Buffer.isBuffer(target))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof target);if(void 0===start&&(start=0),void 0===end&&(end=target?target.length:0),void 0===thisStart&&(thisStart=0),void 0===thisEnd&&(thisEnd=this.length),start<0||end>target.length||thisStart<0||thisEnd>this.length)throw new RangeError("out of range index");if(thisStart>=thisEnd&&start>=end)return 0;if(thisStart>=thisEnd)return-1;if(start>=end)return 1;if(this===target)return 0;let x=(thisEnd>>>=0)-(thisStart>>>=0),y=(end>>>=0)-(start>>>=0);const len=Math.min(x,y),thisCopy=this.slice(thisStart,thisEnd),targetCopy=target.slice(start,end);for(let i=0;i<len;++i)if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i],y=targetCopy[i];break}return x<y?-1:y<x?1:0},Buffer.prototype.includes=function(val,byteOffset,encoding){return-1!==this.indexOf(val,byteOffset,encoding)},Buffer.prototype.indexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!0)},Buffer.prototype.lastIndexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!1)},Buffer.prototype.write=function(string,offset,length,encoding){if(void 0===offset)encoding="utf8",length=this.length,offset=0;else if(void 0===length&&"string"==typeof offset)encoding=offset,length=this.length,offset=0;else{if(!isFinite(offset))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");offset>>>=0,isFinite(length)?(length>>>=0,void 0===encoding&&(encoding="utf8")):(encoding=length,length=void 0)}const remaining=this.length-offset;if((void 0===length||length>remaining)&&(length=remaining),string.length>0&&(length<0||offset<0)||offset>this.length)throw new RangeError("Attempt to write outside buffer bounds");encoding||(encoding="utf8");let loweredCase=!1;for(;;)switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":case"latin1":case"binary":return asciiWrite(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase(),loweredCase=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function asciiSlice(buf,start,end){let ret="";end=Math.min(buf.length,end);for(let i=start;i<end;++i)ret+=String.fromCharCode(127&buf[i]);return ret}function latin1Slice(buf,start,end){let ret="";end=Math.min(buf.length,end);for(let i=start;i<end;++i)ret+=String.fromCharCode(buf[i]);return ret}function hexSlice(buf,start,end){const len=buf.length;(!start||start<0)&&(start=0),(!end||end<0||end>len)&&(end=len);let out="";for(let i=start;i<end;++i)out+=hexSliceLookupTable[buf[i]];return out}function utf16leSlice(buf,start,end){const bytes=buf.slice(start,end);let res="";for(let i=0;i<bytes.length-1;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}function checkOffset(offset,ext,length){if(offset%1!=0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}function wrtBigUInt64LE(buf,value,offset,min,max){checkIntBI(value,min,max,buf,offset,7);let lo=Number(value&BigInt(4294967295));buf[offset++]=lo,lo>>=8,buf[offset++]=lo,lo>>=8,buf[offset++]=lo,lo>>=8,buf[offset++]=lo;let hi=Number(value>>BigInt(32)&BigInt(4294967295));return buf[offset++]=hi,hi>>=8,buf[offset++]=hi,hi>>=8,buf[offset++]=hi,hi>>=8,buf[offset++]=hi,offset}function wrtBigUInt64BE(buf,value,offset,min,max){checkIntBI(value,min,max,buf,offset,7);let lo=Number(value&BigInt(4294967295));buf[offset+7]=lo,lo>>=8,buf[offset+6]=lo,lo>>=8,buf[offset+5]=lo,lo>>=8,buf[offset+4]=lo;let hi=Number(value>>BigInt(32)&BigInt(4294967295));return buf[offset+3]=hi,hi>>=8,buf[offset+2]=hi,hi>>=8,buf[offset+1]=hi,hi>>=8,buf[offset]=hi,offset+8}function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){return value=+value,offset>>>=0,noAssert||checkIEEE754(buf,0,offset,4),ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){return value=+value,offset>>>=0,noAssert||checkIEEE754(buf,0,offset,8),ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}Buffer.prototype.slice=function(start,end){const len=this.length;(start=~~start)<0?(start+=len)<0&&(start=0):start>len&&(start=len),(end=void 0===end?len:~~end)<0?(end+=len)<0&&(end=0):end>len&&(end=len),end<start&&(end=start);const newBuf=this.subarray(start,end);return Object.setPrototypeOf(newBuf,Buffer.prototype),newBuf},Buffer.prototype.readUintLE=Buffer.prototype.readUIntLE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);let val=this[offset],mul=1,i=0;for(;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val},Buffer.prototype.readUintBE=Buffer.prototype.readUIntBE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);let val=this[offset+--byteLength],mul=1;for(;byteLength>0&&(mul*=256);)val+=this[offset+--byteLength]*mul;return val},Buffer.prototype.readUint8=Buffer.prototype.readUInt8=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer.prototype.readUint16LE=Buffer.prototype.readUInt16LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer.prototype.readUint16BE=Buffer.prototype.readUInt16BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer.prototype.readUint32LE=Buffer.prototype.readUInt32LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer.prototype.readUint32BE=Buffer.prototype.readUInt32BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer.prototype.readBigUInt64LE=defineBigIntMethod((function(offset){validateNumber(offset>>>=0,"offset");const first=this[offset],last=this[offset+7];void 0!==first&&void 0!==last||boundsError(offset,this.length-8);const lo=first+256*this[++offset]+65536*this[++offset]+this[++offset]*2**24,hi=this[++offset]+256*this[++offset]+65536*this[++offset]+last*2**24;return BigInt(lo)+(BigInt(hi)<<BigInt(32))})),Buffer.prototype.readBigUInt64BE=defineBigIntMethod((function(offset){validateNumber(offset>>>=0,"offset");const first=this[offset],last=this[offset+7];void 0!==first&&void 0!==last||boundsError(offset,this.length-8);const hi=first*2**24+65536*this[++offset]+256*this[++offset]+this[++offset],lo=this[++offset]*2**24+65536*this[++offset]+256*this[++offset]+last;return(BigInt(hi)<<BigInt(32))+BigInt(lo)})),Buffer.prototype.readIntLE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);let val=this[offset],mul=1,i=0;for(;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return mul*=128,val>=mul&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readIntBE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);let i=byteLength,mul=1,val=this[offset+--i];for(;i>0&&(mul*=256);)val+=this[offset+--i]*mul;return mul*=128,val>=mul&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readInt8=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,1,this.length),128&this[offset]?-1*(255-this[offset]+1):this[offset]},Buffer.prototype.readInt16LE=function(offset,noAssert){offset>>>=0,noAssert||checkOffset(offset,2,this.length);const val=this[offset]|this[offset+1]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt16BE=function(offset,noAssert){offset>>>=0,noAssert||checkOffset(offset,2,this.length);const val=this[offset+1]|this[offset]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt32LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer.prototype.readInt32BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer.prototype.readBigInt64LE=defineBigIntMethod((function(offset){validateNumber(offset>>>=0,"offset");const first=this[offset],last=this[offset+7];void 0!==first&&void 0!==last||boundsError(offset,this.length-8);const val=this[offset+4]+256*this[offset+5]+65536*this[offset+6]+(last<<24);return(BigInt(val)<<BigInt(32))+BigInt(first+256*this[++offset]+65536*this[++offset]+this[++offset]*2**24)})),Buffer.prototype.readBigInt64BE=defineBigIntMethod((function(offset){validateNumber(offset>>>=0,"offset");const first=this[offset],last=this[offset+7];void 0!==first&&void 0!==last||boundsError(offset,this.length-8);const val=(first<<24)+65536*this[++offset]+256*this[++offset]+this[++offset];return(BigInt(val)<<BigInt(32))+BigInt(this[++offset]*2**24+65536*this[++offset]+256*this[++offset]+last)})),Buffer.prototype.readFloatLE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!0,23,4)},Buffer.prototype.readFloatBE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!1,23,4)},Buffer.prototype.readDoubleLE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!0,52,8)},Buffer.prototype.readDoubleBE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!1,52,8)},Buffer.prototype.writeUintLE=Buffer.prototype.writeUIntLE=function(value,offset,byteLength,noAssert){if(value=+value,offset>>>=0,byteLength>>>=0,!noAssert){checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0)}let mul=1,i=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUintBE=Buffer.prototype.writeUIntBE=function(value,offset,byteLength,noAssert){if(value=+value,offset>>>=0,byteLength>>>=0,!noAssert){checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0)}let i=byteLength-1,mul=1;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUint8=Buffer.prototype.writeUInt8=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,255,0),this[offset]=255&value,offset+1},Buffer.prototype.writeUint16LE=Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),this[offset]=255&value,this[offset+1]=value>>>8,offset+2},Buffer.prototype.writeUint16BE=Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),this[offset]=value>>>8,this[offset+1]=255&value,offset+2},Buffer.prototype.writeUint32LE=Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=255&value,offset+4},Buffer.prototype.writeUint32BE=Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value,offset+4},Buffer.prototype.writeBigUInt64LE=defineBigIntMethod((function(value,offset=0){return wrtBigUInt64LE(this,value,offset,BigInt(0),BigInt("0xffffffffffffffff"))})),Buffer.prototype.writeBigUInt64BE=defineBigIntMethod((function(value,offset=0){return wrtBigUInt64BE(this,value,offset,BigInt(0),BigInt("0xffffffffffffffff"))})),Buffer.prototype.writeIntLE=function(value,offset,byteLength,noAssert){if(value=+value,offset>>>=0,!noAssert){const limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}let i=0,mul=1,sub=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i-1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeIntBE=function(value,offset,byteLength,noAssert){if(value=+value,offset>>>=0,!noAssert){const limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}let i=byteLength-1,mul=1,sub=0;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i+1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeInt8=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,127,-128),value<0&&(value=255+value+1),this[offset]=255&value,offset+1},Buffer.prototype.writeInt16LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),this[offset]=255&value,this[offset+1]=value>>>8,offset+2},Buffer.prototype.writeInt16BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),this[offset]=value>>>8,this[offset+1]=255&value,offset+2},Buffer.prototype.writeInt32LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),this[offset]=255&value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24,offset+4},Buffer.prototype.writeInt32BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),value<0&&(value=4294967295+value+1),this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value,offset+4},Buffer.prototype.writeBigInt64LE=defineBigIntMethod((function(value,offset=0){return wrtBigUInt64LE(this,value,offset,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),Buffer.prototype.writeBigInt64BE=defineBigIntMethod((function(value,offset=0){return wrtBigUInt64BE(this,value,offset,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.copy=function(target,targetStart,start,end){if(!Buffer.isBuffer(target))throw new TypeError("argument should be a Buffer");if(start||(start=0),end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),targetStart||(targetStart=0),end>0&&end<start&&(end=start),end===start)return 0;if(0===target.length||0===this.length)return 0;if(targetStart<0)throw new RangeError("targetStart out of bounds");if(start<0||start>=this.length)throw new RangeError("Index out of range");if(end<0)throw new RangeError("sourceEnd out of bounds");end>this.length&&(end=this.length),target.length-targetStart<end-start&&(end=target.length-targetStart+start);const len=end-start;return this===target&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(targetStart,start,end):Uint8Array.prototype.set.call(target,this.subarray(start,end),targetStart),len},Buffer.prototype.fill=function(val,start,end,encoding){if("string"==typeof val){if("string"==typeof start?(encoding=start,start=0,end=this.length):"string"==typeof end&&(encoding=end,end=this.length),void 0!==encoding&&"string"!=typeof encoding)throw new TypeError("encoding must be a string");if("string"==typeof encoding&&!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding);if(1===val.length){const code=val.charCodeAt(0);("utf8"===encoding&&code<128||"latin1"===encoding)&&(val=code)}}else"number"==typeof val?val&=255:"boolean"==typeof val&&(val=Number(val));if(start<0||this.length<start||this.length<end)throw new RangeError("Out of range index");if(end<=start)return this;let i;if(start>>>=0,end=void 0===end?this.length:end>>>0,val||(val=0),"number"==typeof val)for(i=start;i<end;++i)this[i]=val;else{const bytes=Buffer.isBuffer(val)?val:Buffer.from(val,encoding),len=bytes.length;if(0===len)throw new TypeError('The value "'+val+'" is invalid for argument "value"');for(i=0;i<end-start;++i)this[i+start]=bytes[i%len]}return this};const errors={};function E(sym,getMessage,Base){errors[sym]=class extends Base{constructor(){super(),Object.defineProperty(this,"message",{value:getMessage.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${sym}]`,this.stack,delete this.name}get code(){return sym}set code(value){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:value,writable:!0})}toString(){return`${this.name} [${sym}]: ${this.message}`}}}function addNumericalSeparator(val){let res="",i=val.length;const start="-"===val[0]?1:0;for(;i>=start+4;i-=3)res=`_${val.slice(i-3,i)}${res}`;return`${val.slice(0,i)}${res}`}function checkIntBI(value,min,max,buf,offset,byteLength){if(value>max||value<min){const n="bigint"==typeof min?"n":"";let range;throw range=byteLength>3?0===min||min===BigInt(0)?`>= 0${n} and < 2${n} ** ${8*(byteLength+1)}${n}`:`>= -(2${n} ** ${8*(byteLength+1)-1}${n}) and < 2 ** ${8*(byteLength+1)-1}${n}`:`>= ${min}${n} and <= ${max}${n}`,new errors.ERR_OUT_OF_RANGE("value",range,value)}!(function(buf,offset,byteLength){validateNumber(offset,"offset"),void 0!==buf[offset]&&void 0!==buf[offset+byteLength]||boundsError(offset,buf.length-(byteLength+1))})(buf,offset,byteLength)}function validateNumber(value,name){if("number"!=typeof value)throw new errors.ERR_INVALID_ARG_TYPE(name,"number",value)}function boundsError(value,length,type){if(Math.floor(value)!==value)throw validateNumber(value,type),new errors.ERR_OUT_OF_RANGE(type||"offset","an integer",value);if(length<0)throw new errors.ERR_BUFFER_OUT_OF_BOUNDS;throw new errors.ERR_OUT_OF_RANGE(type||"offset",`>= ${type?1:0} and <= ${length}`,value)}E("ERR_BUFFER_OUT_OF_BOUNDS",(function(name){return name?`${name} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),E("ERR_INVALID_ARG_TYPE",(function(name,actual){return`The "${name}" argument must be of type number. Received type ${typeof actual}`}),TypeError),E("ERR_OUT_OF_RANGE",(function(str,range,input){let msg=`The value of "${str}" is out of range.`,received=input;return Number.isInteger(input)&&Math.abs(input)>2**32?received=addNumericalSeparator(String(input)):"bigint"==typeof input&&(received=String(input),(input>BigInt(2)**BigInt(32)||input<-(BigInt(2)**BigInt(32)))&&(received=addNumericalSeparator(received)),received+="n"),msg+=` It must be ${range}. Received ${received}`,msg}),RangeError);const INVALID_BASE64_RE=/[^+/0-9A-Za-z-_]/g;function utf8ToBytes(string,units){let codePoint;units=units||1/0;const length=string.length;let leadSurrogate=null;const bytes=[];for(let i=0;i<length;++i){if(codePoint=string.charCodeAt(i),codePoint>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){(units-=3)>-1&&bytes.push(239,191,189);continue}if(i+1===length){(units-=3)>-1&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){(units-=3)>-1&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=65536+(leadSurrogate-55296<<10|codePoint-56320)}else leadSurrogate&&(units-=3)>-1&&bytes.push(239,191,189);if(leadSurrogate=null,codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(codePoint<1114112))throw new Error("Invalid code point");if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function base64ToBytes(str){return base64.toByteArray((function(str){if((str=(str=str.split("=")[0]).trim().replace(INVALID_BASE64_RE,"")).length<2)return"";for(;str.length%4!=0;)str+="=";return str})(str))}function blitBuffer(src,dst,offset,length){let i;for(i=0;i<length&&!(i+offset>=dst.length||i>=src.length);++i)dst[i+offset]=src[i];return i}function isInstance(obj,type){return obj instanceof type||null!=obj&&null!=obj.constructor&&null!=obj.constructor.name&&obj.constructor.name===type.name}function numberIsNaN(obj){return obj!=obj}const hexSliceLookupTable=(function(){const table=new Array(256);for(let i=0;i<16;++i){const i16=16*i;for(let j=0;j<16;++j)table[i16+j]="0123456789abcdef"[i]+"0123456789abcdef"[j]}return table})();function defineBigIntMethod(fn){return"undefined"==typeof BigInt?BufferBigIntNotDefined:fn}function BufferBigIntNotDefined(){throw new Error("BigInt not supported")}},4184:(module,exports)=>{var __WEBPACK_AMD_DEFINE_RESULT__;!(function(){"use strict";var hasOwn={}.hasOwnProperty;function classNames(){for(var classes=[],i=0;i<arguments.length;i++){var arg=arguments[i];if(arg){var argType=typeof arg;if("string"===argType||"number"===argType)classes.push(arg);else if(Array.isArray(arg)){if(arg.length){var inner=classNames.apply(null,arg);inner&&classes.push(inner)}}else if("object"===argType)if(arg.toString===Object.prototype.toString)for(var key in arg)hasOwn.call(arg,key)&&arg[key]&&classes.push(key);else classes.push(arg.toString())}}return classes.join(" ")}module.exports?(classNames.default=classNames,module.exports=classNames):void 0===(__WEBPACK_AMD_DEFINE_RESULT__=function(){return classNames}.apply(exports,[]))||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)})()},8874:module=>{"use strict";module.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},9818:(module,__unused_webpack_exports,__webpack_require__)=>{var colorNames=__webpack_require__(8874),swizzle=__webpack_require__(6851),hasOwnProperty=Object.hasOwnProperty,reverseNames=Object.create(null);for(var name in colorNames)hasOwnProperty.call(colorNames,name)&&(reverseNames[colorNames[name]]=name);var cs=module.exports={to:{},get:{}};function clamp(num,min,max){return Math.min(Math.max(min,num),max)}function hexDouble(num){var str=Math.round(num).toString(16).toUpperCase();return str.length<2?"0"+str:str}cs.get=function(string){var val,model;switch(string.substring(0,3).toLowerCase()){case"hsl":val=cs.get.hsl(string),model="hsl";break;case"hwb":val=cs.get.hwb(string),model="hwb";break;default:val=cs.get.rgb(string),model="rgb"}return val?{model:model,value:val}:null},cs.get.rgb=function(string){if(!string)return null;var match,i,hexAlpha,rgb=[0,0,0,1];if(match=string.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(hexAlpha=match[2],match=match[1],i=0;i<3;i++){var i2=2*i;rgb[i]=parseInt(match.slice(i2,i2+2),16)}hexAlpha&&(rgb[3]=parseInt(hexAlpha,16)/255)}else if(match=string.match(/^#([a-f0-9]{3,4})$/i)){for(hexAlpha=(match=match[1])[3],i=0;i<3;i++)rgb[i]=parseInt(match[i]+match[i],16);hexAlpha&&(rgb[3]=parseInt(hexAlpha+hexAlpha,16)/255)}else if(match=string.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(i=0;i<3;i++)rgb[i]=parseInt(match[i+1],0);match[4]&&(match[5]?rgb[3]=.01*parseFloat(match[4]):rgb[3]=parseFloat(match[4]))}else{if(!(match=string.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(match=string.match(/^(\w+)$/))?"transparent"===match[1]?[0,0,0,0]:hasOwnProperty.call(colorNames,match[1])?((rgb=colorNames[match[1]])[3]=1,rgb):null:null;for(i=0;i<3;i++)rgb[i]=Math.round(2.55*parseFloat(match[i+1]));match[4]&&(match[5]?rgb[3]=.01*parseFloat(match[4]):rgb[3]=parseFloat(match[4]))}for(i=0;i<3;i++)rgb[i]=clamp(rgb[i],0,255);return rgb[3]=clamp(rgb[3],0,1),rgb},cs.get.hsl=function(string){if(!string)return null;var match=string.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(match){var alpha=parseFloat(match[4]);return[(parseFloat(match[1])%360+360)%360,clamp(parseFloat(match[2]),0,100),clamp(parseFloat(match[3]),0,100),clamp(isNaN(alpha)?1:alpha,0,1)]}return null},cs.get.hwb=function(string){if(!string)return null;var match=string.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(match){var alpha=parseFloat(match[4]);return[(parseFloat(match[1])%360+360)%360,clamp(parseFloat(match[2]),0,100),clamp(parseFloat(match[3]),0,100),clamp(isNaN(alpha)?1:alpha,0,1)]}return null},cs.to.hex=function(){var rgba=swizzle(arguments);return"#"+hexDouble(rgba[0])+hexDouble(rgba[1])+hexDouble(rgba[2])+(rgba[3]<1?hexDouble(Math.round(255*rgba[3])):"")},cs.to.rgb=function(){var rgba=swizzle(arguments);return rgba.length<4||1===rgba[3]?"rgb("+Math.round(rgba[0])+", "+Math.round(rgba[1])+", "+Math.round(rgba[2])+")":"rgba("+Math.round(rgba[0])+", "+Math.round(rgba[1])+", "+Math.round(rgba[2])+", "+rgba[3]+")"},cs.to.rgb.percent=function(){var rgba=swizzle(arguments),r=Math.round(rgba[0]/255*100),g=Math.round(rgba[1]/255*100),b=Math.round(rgba[2]/255*100);return rgba.length<4||1===rgba[3]?"rgb("+r+"%, "+g+"%, "+b+"%)":"rgba("+r+"%, "+g+"%, "+b+"%, "+rgba[3]+")"},cs.to.hsl=function(){var hsla=swizzle(arguments);return hsla.length<4||1===hsla[3]?"hsl("+hsla[0]+", "+hsla[1]+"%, "+hsla[2]+"%)":"hsla("+hsla[0]+", "+hsla[1]+"%, "+hsla[2]+"%, "+hsla[3]+")"},cs.to.hwb=function(){var hwba=swizzle(arguments),a="";return hwba.length>=4&&1!==hwba[3]&&(a=", "+hwba[3]),"hwb("+hwba[0]+", "+hwba[1]+"%, "+hwba[2]+"%"+a+")"},cs.to.keyword=function(rgb){return reverseNames[rgb.slice(0,3)]}},6767:(module,__unused_webpack_exports,__webpack_require__)=>{const colorString=__webpack_require__(9818),convert=__webpack_require__(978),skippedModels=["keyword","gray","hex"],hashedModelKeys={};for(const model of Object.keys(convert))hashedModelKeys[[...convert[model].labels].sort().join("")]=model;const limiters={};function Color(object,model){if(!(this instanceof Color))return new Color(object,model);if(model&&model in skippedModels&&(model=null),model&&!(model in convert))throw new Error("Unknown model: "+model);let i,channels;if(null==object)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(object instanceof Color)this.model=object.model,this.color=[...object.color],this.valpha=object.valpha;else if("string"==typeof object){const result=colorString.get(object);if(null===result)throw new Error("Unable to parse color from string: "+object);this.model=result.model,channels=convert[this.model].channels,this.color=result.value.slice(0,channels),this.valpha="number"==typeof result.value[channels]?result.value[channels]:1}else if(object.length>0){this.model=model||"rgb",channels=convert[this.model].channels;const newArray=Array.prototype.slice.call(object,0,channels);this.color=zeroArray(newArray,channels),this.valpha="number"==typeof object[channels]?object[channels]:1}else if("number"==typeof object)this.model="rgb",this.color=[object>>16&255,object>>8&255,255&object],this.valpha=1;else{this.valpha=1;const keys=Object.keys(object);"alpha"in object&&(keys.splice(keys.indexOf("alpha"),1),this.valpha="number"==typeof object.alpha?object.alpha:0);const hashedKeys=keys.sort().join("");if(!(hashedKeys in hashedModelKeys))throw new Error("Unable to parse color from object: "+JSON.stringify(object));this.model=hashedModelKeys[hashedKeys];const{labels:labels}=convert[this.model],color=[];for(i=0;i<labels.length;i++)color.push(object[labels[i]]);this.color=zeroArray(color)}if(limiters[this.model])for(channels=convert[this.model].channels,i=0;i<channels;i++){const limit=limiters[this.model][i];limit&&(this.color[i]=limit(this.color[i]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}Color.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(places){let self=this.model in colorString.to?this:this.rgb();self=self.round("number"==typeof places?places:1);const args=1===self.valpha?self.color:[...self.color,this.valpha];return colorString.to[self.model](args)},percentString(places){const self=this.rgb().round("number"==typeof places?places:1),args=1===self.valpha?self.color:[...self.color,this.valpha];return colorString.to.rgb.percent(args)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const result={},{channels:channels}=convert[this.model],{labels:labels}=convert[this.model];for(let i=0;i<channels;i++)result[labels[i]]=this.color[i];return 1!==this.valpha&&(result.alpha=this.valpha),result},unitArray(){const rgb=this.rgb().color;return rgb[0]/=255,rgb[1]/=255,rgb[2]/=255,1!==this.valpha&&rgb.push(this.valpha),rgb},unitObject(){const rgb=this.rgb().object();return rgb.r/=255,rgb.g/=255,rgb.b/=255,1!==this.valpha&&(rgb.alpha=this.valpha),rgb},round(places){return places=Math.max(places||0,0),new Color([...this.color.map(roundToPlace(places)),this.valpha],this.model)},alpha(value){return void 0!==value?new Color([...this.color,Math.max(0,Math.min(1,value))],this.model):this.valpha},red:getset("rgb",0,maxfn(255)),green:getset("rgb",1,maxfn(255)),blue:getset("rgb",2,maxfn(255)),hue:getset(["hsl","hsv","hsl","hwb","hcg"],0,(value=>(value%360+360)%360)),saturationl:getset("hsl",1,maxfn(100)),lightness:getset("hsl",2,maxfn(100)),saturationv:getset("hsv",1,maxfn(100)),value:getset("hsv",2,maxfn(100)),chroma:getset("hcg",1,maxfn(100)),gray:getset("hcg",2,maxfn(100)),white:getset("hwb",1,maxfn(100)),wblack:getset("hwb",2,maxfn(100)),cyan:getset("cmyk",0,maxfn(100)),magenta:getset("cmyk",1,maxfn(100)),yellow:getset("cmyk",2,maxfn(100)),black:getset("cmyk",3,maxfn(100)),x:getset("xyz",0,maxfn(95.047)),y:getset("xyz",1,maxfn(100)),z:getset("xyz",2,maxfn(108.833)),l:getset("lab",0,maxfn(100)),a:getset("lab",1),b:getset("lab",2),keyword(value){return void 0!==value?new Color(value):convert[this.model].keyword(this.color)},hex(value){return void 0!==value?new Color(value):colorString.to.hex(this.rgb().round().color)},hexa(value){if(void 0!==value)return new Color(value);const rgbArray=this.rgb().round().color;let alphaHex=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===alphaHex.length&&(alphaHex="0"+alphaHex),colorString.to.hex(rgbArray)+alphaHex},rgbNumber(){const rgb=this.rgb().color;return(255&rgb[0])<<16|(255&rgb[1])<<8|255&rgb[2]},luminosity(){const rgb=this.rgb().color,lum=[];for(const[i,element]of rgb.entries()){const chan=element/255;lum[i]=chan<=.04045?chan/12.92:((chan+.055)/1.055)**2.4}return.2126*lum[0]+.7152*lum[1]+.0722*lum[2]},contrast(color2){const lum1=this.luminosity(),lum2=color2.luminosity();return lum1>lum2?(lum1+.05)/(lum2+.05):(lum2+.05)/(lum1+.05)},level(color2){const contrastRatio=this.contrast(color2);return contrastRatio>=7?"AAA":contrastRatio>=4.5?"AA":""},isDark(){const rgb=this.rgb().color;return(2126*rgb[0]+7152*rgb[1]+722*rgb[2])/1e4<128},isLight(){return!this.isDark()},negate(){const rgb=this.rgb();for(let i=0;i<3;i++)rgb.color[i]=255-rgb.color[i];return rgb},lighten(ratio){const hsl=this.hsl();return hsl.color[2]+=hsl.color[2]*ratio,hsl},darken(ratio){const hsl=this.hsl();return hsl.color[2]-=hsl.color[2]*ratio,hsl},saturate(ratio){const hsl=this.hsl();return hsl.color[1]+=hsl.color[1]*ratio,hsl},desaturate(ratio){const hsl=this.hsl();return hsl.color[1]-=hsl.color[1]*ratio,hsl},whiten(ratio){const hwb=this.hwb();return hwb.color[1]+=hwb.color[1]*ratio,hwb},blacken(ratio){const hwb=this.hwb();return hwb.color[2]+=hwb.color[2]*ratio,hwb},grayscale(){const rgb=this.rgb().color,value=.3*rgb[0]+.59*rgb[1]+.11*rgb[2];return Color.rgb(value,value,value)},fade(ratio){return this.alpha(this.valpha-this.valpha*ratio)},opaquer(ratio){return this.alpha(this.valpha+this.valpha*ratio)},rotate(degrees){const hsl=this.hsl();let hue=hsl.color[0];return hue=(hue+degrees)%360,hue=hue<0?360+hue:hue,hsl.color[0]=hue,hsl},mix(mixinColor,weight){if(!mixinColor||!mixinColor.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof mixinColor);const color1=mixinColor.rgb(),color2=this.rgb(),p=void 0===weight?.5:weight,w=2*p-1,a=color1.alpha()-color2.alpha(),w1=((w*a==-1?w:(w+a)/(1+w*a))+1)/2,w2=1-w1;return Color.rgb(w1*color1.red()+w2*color2.red(),w1*color1.green()+w2*color2.green(),w1*color1.blue()+w2*color2.blue(),color1.alpha()*p+color2.alpha()*(1-p))}};for(const model of Object.keys(convert)){if(skippedModels.includes(model))continue;const{channels:channels}=convert[model];Color.prototype[model]=function(...args){return this.model===model?new Color(this):args.length>0?new Color(args,model):new Color([...(value=convert[this.model][model].raw(this.color),Array.isArray(value)?value:[value]),this.valpha],model);var value},Color[model]=function(...args){let color=args[0];return"number"==typeof color&&(color=zeroArray(args,channels)),new Color(color,model)}}function roundToPlace(places){return function(number){return(function(number,places){return Number(number.toFixed(places))})(number,places)}}function getset(model,channel,modifier){model=Array.isArray(model)?model:[model];for(const m of model)(limiters[m]||(limiters[m]=[]))[channel]=modifier;return model=model[0],function(value){let result;return void 0!==value?(modifier&&(value=modifier(value)),result=this[model](),result.color[channel]=value,result):(result=this[model]().color[channel],modifier&&(result=modifier(result)),result)}}function maxfn(max){return function(v){return Math.max(0,Math.min(max,v))}}function zeroArray(array,length){for(let i=0;i<length;i++)"number"!=typeof array[i]&&(array[i]=0);return array}module.exports=Color},2956:(module,__unused_webpack_exports,__webpack_require__)=>{const cssKeywords=__webpack_require__(8900),reverseKeywords={};for(const key of Object.keys(cssKeywords))reverseKeywords[cssKeywords[key]]=key;const convert={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};module.exports=convert;for(const model of Object.keys(convert)){if(!("channels"in convert[model]))throw new Error("missing channels property: "+model);if(!("labels"in convert[model]))throw new Error("missing channel labels property: "+model);if(convert[model].labels.length!==convert[model].channels)throw new Error("channel and label counts mismatch: "+model);const{channels:channels,labels:labels}=convert[model];delete convert[model].channels,delete convert[model].labels,Object.defineProperty(convert[model],"channels",{value:channels}),Object.defineProperty(convert[model],"labels",{value:labels})}convert.rgb.hsl=function(rgb){const r=rgb[0]/255,g=rgb[1]/255,b=rgb[2]/255,min=Math.min(r,g,b),max=Math.max(r,g,b),delta=max-min;let h,s;max===min?h=0:r===max?h=(g-b)/delta:g===max?h=2+(b-r)/delta:b===max&&(h=4+(r-g)/delta),h=Math.min(60*h,360),h<0&&(h+=360);const l=(min+max)/2;return s=max===min?0:l<=.5?delta/(max+min):delta/(2-max-min),[h,100*s,100*l]},convert.rgb.hsv=function(rgb){let rdif,gdif,bdif,h,s;const r=rgb[0]/255,g=rgb[1]/255,b=rgb[2]/255,v=Math.max(r,g,b),diff=v-Math.min(r,g,b),diffc=function(c){return(v-c)/6/diff+.5};return 0===diff?(h=0,s=0):(s=diff/v,rdif=diffc(r),gdif=diffc(g),bdif=diffc(b),r===v?h=bdif-gdif:g===v?h=1/3+rdif-bdif:b===v&&(h=2/3+gdif-rdif),h<0?h+=1:h>1&&(h-=1)),[360*h,100*s,100*v]},convert.rgb.hwb=function(rgb){const r=rgb[0],g=rgb[1];let b=rgb[2];const h=convert.rgb.hsl(rgb)[0],w=1/255*Math.min(r,Math.min(g,b));return b=1-1/255*Math.max(r,Math.max(g,b)),[h,100*w,100*b]},convert.rgb.cmyk=function(rgb){const r=rgb[0]/255,g=rgb[1]/255,b=rgb[2]/255,k=Math.min(1-r,1-g,1-b);return[100*((1-r-k)/(1-k)||0),100*((1-g-k)/(1-k)||0),100*((1-b-k)/(1-k)||0),100*k]},convert.rgb.keyword=function(rgb){const reversed=reverseKeywords[rgb];if(reversed)return reversed;let currentClosestKeyword,currentClosestDistance=1/0;for(const keyword of Object.keys(cssKeywords)){const value=cssKeywords[keyword],distance=(y=value,((x=rgb)[0]-y[0])**2+(x[1]-y[1])**2+(x[2]-y[2])**2);distance<currentClosestDistance&&(currentClosestDistance=distance,currentClosestKeyword=keyword)}var x,y;return currentClosestKeyword},convert.keyword.rgb=function(keyword){return cssKeywords[keyword]},convert.rgb.xyz=function(rgb){let r=rgb[0]/255,g=rgb[1]/255,b=rgb[2]/255;r=r>.04045?((r+.055)/1.055)**2.4:r/12.92,g=g>.04045?((g+.055)/1.055)**2.4:g/12.92,b=b>.04045?((b+.055)/1.055)**2.4:b/12.92;return[100*(.4124*r+.3576*g+.1805*b),100*(.2126*r+.7152*g+.0722*b),100*(.0193*r+.1192*g+.9505*b)]},convert.rgb.lab=function(rgb){const xyz=convert.rgb.xyz(rgb);let x=xyz[0],y=xyz[1],z=xyz[2];x/=95.047,y/=100,z/=108.883,x=x>.008856?x**(1/3):7.787*x+16/116,y=y>.008856?y**(1/3):7.787*y+16/116,z=z>.008856?z**(1/3):7.787*z+16/116;return[116*y-16,500*(x-y),200*(y-z)]},convert.hsl.rgb=function(hsl){const h=hsl[0]/360,s=hsl[1]/100,l=hsl[2]/100;let t2,t3,val;if(0===s)return val=255*l,[val,val,val];t2=l<.5?l*(1+s):l+s-l*s;const t1=2*l-t2,rgb=[0,0,0];for(let i=0;i<3;i++)t3=h+1/3*-(i-1),t3<0&&t3++,t3>1&&t3--,val=6*t3<1?t1+6*(t2-t1)*t3:2*t3<1?t2:3*t3<2?t1+(t2-t1)*(2/3-t3)*6:t1,rgb[i]=255*val;return rgb},convert.hsl.hsv=function(hsl){const h=hsl[0];let s=hsl[1]/100,l=hsl[2]/100,smin=s;const lmin=Math.max(l,.01);l*=2,s*=l<=1?l:2-l,smin*=lmin<=1?lmin:2-lmin;return[h,100*(0===l?2*smin/(lmin+smin):2*s/(l+s)),100*((l+s)/2)]},convert.hsv.rgb=function(hsv){const h=hsv[0]/60,s=hsv[1]/100;let v=hsv[2]/100;const hi=Math.floor(h)%6,f=h-Math.floor(h),p=255*v*(1-s),q=255*v*(1-s*f),t=255*v*(1-s*(1-f));switch(v*=255,hi){case 0:return[v,t,p];case 1:return[q,v,p];case 2:return[p,v,t];case 3:return[p,q,v];case 4:return[t,p,v];case 5:return[v,p,q]}},convert.hsv.hsl=function(hsv){const h=hsv[0],s=hsv[1]/100,v=hsv[2]/100,vmin=Math.max(v,.01);let sl,l;l=(2-s)*v;const lmin=(2-s)*vmin;return sl=s*vmin,sl/=lmin<=1?lmin:2-lmin,sl=sl||0,l/=2,[h,100*sl,100*l]},convert.hwb.rgb=function(hwb){const h=hwb[0]/360;let wh=hwb[1]/100,bl=hwb[2]/100;const ratio=wh+bl;let f;ratio>1&&(wh/=ratio,bl/=ratio);const i=Math.floor(6*h),v=1-bl;f=6*h-i,0!=(1&i)&&(f=1-f);const n=wh+f*(v-wh);let r,g,b;switch(i){default:case 6:case 0:r=v,g=n,b=wh;break;case 1:r=n,g=v,b=wh;break;case 2:r=wh,g=v,b=n;break;case 3:r=wh,g=n,b=v;break;case 4:r=n,g=wh,b=v;break;case 5:r=v,g=wh,b=n}return[255*r,255*g,255*b]},convert.cmyk.rgb=function(cmyk){const c=cmyk[0]/100,m=cmyk[1]/100,y=cmyk[2]/100,k=cmyk[3]/100;return[255*(1-Math.min(1,c*(1-k)+k)),255*(1-Math.min(1,m*(1-k)+k)),255*(1-Math.min(1,y*(1-k)+k))]},convert.xyz.rgb=function(xyz){const x=xyz[0]/100,y=xyz[1]/100,z=xyz[2]/100;let r,g,b;return r=3.2406*x+-1.5372*y+-.4986*z,g=-.9689*x+1.8758*y+.0415*z,b=.0557*x+-.204*y+1.057*z,r=r>.0031308?1.055*r**(1/2.4)-.055:12.92*r,g=g>.0031308?1.055*g**(1/2.4)-.055:12.92*g,b=b>.0031308?1.055*b**(1/2.4)-.055:12.92*b,r=Math.min(Math.max(0,r),1),g=Math.min(Math.max(0,g),1),b=Math.min(Math.max(0,b),1),[255*r,255*g,255*b]},convert.xyz.lab=function(xyz){let x=xyz[0],y=xyz[1],z=xyz[2];x/=95.047,y/=100,z/=108.883,x=x>.008856?x**(1/3):7.787*x+16/116,y=y>.008856?y**(1/3):7.787*y+16/116,z=z>.008856?z**(1/3):7.787*z+16/116;return[116*y-16,500*(x-y),200*(y-z)]},convert.lab.xyz=function(lab){let x,y,z;y=(lab[0]+16)/116,x=lab[1]/500+y,z=y-lab[2]/200;const y2=y**3,x2=x**3,z2=z**3;return y=y2>.008856?y2:(y-16/116)/7.787,x=x2>.008856?x2:(x-16/116)/7.787,z=z2>.008856?z2:(z-16/116)/7.787,x*=95.047,y*=100,z*=108.883,[x,y,z]},convert.lab.lch=function(lab){const l=lab[0],a=lab[1],b=lab[2];let h;h=360*Math.atan2(b,a)/2/Math.PI,h<0&&(h+=360);return[l,Math.sqrt(a*a+b*b),h]},convert.lch.lab=function(lch){const l=lch[0],c=lch[1],hr=lch[2]/360*2*Math.PI;return[l,c*Math.cos(hr),c*Math.sin(hr)]},convert.rgb.ansi16=function(args,saturation=null){const[r,g,b]=args;let value=null===saturation?convert.rgb.hsv(args)[2]:saturation;if(value=Math.round(value/50),0===value)return 30;let ansi=30+(Math.round(b/255)<<2|Math.round(g/255)<<1|Math.round(r/255));return 2===value&&(ansi+=60),ansi},convert.hsv.ansi16=function(args){return convert.rgb.ansi16(convert.hsv.rgb(args),args[2])},convert.rgb.ansi256=function(args){const r=args[0],g=args[1],b=args[2];if(r===g&&g===b)return r<8?16:r>248?231:Math.round((r-8)/247*24)+232;return 16+36*Math.round(r/255*5)+6*Math.round(g/255*5)+Math.round(b/255*5)},convert.ansi16.rgb=function(args){let color=args%10;if(0===color||7===color)return args>50&&(color+=3.5),color=color/10.5*255,[color,color,color];const mult=.5*(1+~~(args>50));return[(1&color)*mult*255,(color>>1&1)*mult*255,(color>>2&1)*mult*255]},convert.ansi256.rgb=function(args){if(args>=232){const c=10*(args-232)+8;return[c,c,c]}let rem;args-=16;return[Math.floor(args/36)/5*255,Math.floor((rem=args%36)/6)/5*255,rem%6/5*255]},convert.rgb.hex=function(args){const string=(((255&Math.round(args[0]))<<16)+((255&Math.round(args[1]))<<8)+(255&Math.round(args[2]))).toString(16).toUpperCase();return"000000".substring(string.length)+string},convert.hex.rgb=function(args){const match=args.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!match)return[0,0,0];let colorString=match[0];3===match[0].length&&(colorString=colorString.split("").map((char=>char+char)).join(""));const integer=parseInt(colorString,16);return[integer>>16&255,integer>>8&255,255&integer]},convert.rgb.hcg=function(rgb){const r=rgb[0]/255,g=rgb[1]/255,b=rgb[2]/255,max=Math.max(Math.max(r,g),b),min=Math.min(Math.min(r,g),b),chroma=max-min;let grayscale,hue;return grayscale=chroma<1?min/(1-chroma):0,hue=chroma<=0?0:max===r?(g-b)/chroma%6:max===g?2+(b-r)/chroma:4+(r-g)/chroma,hue/=6,hue%=1,[360*hue,100*chroma,100*grayscale]},convert.hsl.hcg=function(hsl){const s=hsl[1]/100,l=hsl[2]/100,c=l<.5?2*s*l:2*s*(1-l);let f=0;return c<1&&(f=(l-.5*c)/(1-c)),[hsl[0],100*c,100*f]},convert.hsv.hcg=function(hsv){const s=hsv[1]/100,v=hsv[2]/100,c=s*v;let f=0;return c<1&&(f=(v-c)/(1-c)),[hsv[0],100*c,100*f]},convert.hcg.rgb=function(hcg){const h=hcg[0]/360,c=hcg[1]/100,g=hcg[2]/100;if(0===c)return[255*g,255*g,255*g];const pure=[0,0,0],hi=h%1*6,v=hi%1,w=1-v;let mg=0;switch(Math.floor(hi)){case 0:pure[0]=1,pure[1]=v,pure[2]=0;break;case 1:pure[0]=w,pure[1]=1,pure[2]=0;break;case 2:pure[0]=0,pure[1]=1,pure[2]=v;break;case 3:pure[0]=0,pure[1]=w,pure[2]=1;break;case 4:pure[0]=v,pure[1]=0,pure[2]=1;break;default:pure[0]=1,pure[1]=0,pure[2]=w}return mg=(1-c)*g,[255*(c*pure[0]+mg),255*(c*pure[1]+mg),255*(c*pure[2]+mg)]},convert.hcg.hsv=function(hcg){const c=hcg[1]/100,v=c+hcg[2]/100*(1-c);let f=0;return v>0&&(f=c/v),[hcg[0],100*f,100*v]},convert.hcg.hsl=function(hcg){const c=hcg[1]/100,l=hcg[2]/100*(1-c)+.5*c;let s=0;return l>0&&l<.5?s=c/(2*l):l>=.5&&l<1&&(s=c/(2*(1-l))),[hcg[0],100*s,100*l]},convert.hcg.hwb=function(hcg){const c=hcg[1]/100,v=c+hcg[2]/100*(1-c);return[hcg[0],100*(v-c),100*(1-v)]},convert.hwb.hcg=function(hwb){const w=hwb[1]/100,v=1-hwb[2]/100,c=v-w;let g=0;return c<1&&(g=(v-c)/(1-c)),[hwb[0],100*c,100*g]},convert.apple.rgb=function(apple){return[apple[0]/65535*255,apple[1]/65535*255,apple[2]/65535*255]},convert.rgb.apple=function(rgb){return[rgb[0]/255*65535,rgb[1]/255*65535,rgb[2]/255*65535]},convert.gray.rgb=function(args){return[args[0]/100*255,args[0]/100*255,args[0]/100*255]},convert.gray.hsl=function(args){return[0,0,args[0]]},convert.gray.hsv=convert.gray.hsl,convert.gray.hwb=function(gray){return[0,100,gray[0]]},convert.gray.cmyk=function(gray){return[0,0,0,gray[0]]},convert.gray.lab=function(gray){return[gray[0],0,0]},convert.gray.hex=function(gray){const val=255&Math.round(gray[0]/100*255),string=((val<<16)+(val<<8)+val).toString(16).toUpperCase();return"000000".substring(string.length)+string},convert.rgb.gray=function(rgb){return[(rgb[0]+rgb[1]+rgb[2])/3/255*100]}},978:(module,__unused_webpack_exports,__webpack_require__)=>{const conversions=__webpack_require__(2956),route=__webpack_require__(7774),convert={};Object.keys(conversions).forEach((fromModel=>{convert[fromModel]={},Object.defineProperty(convert[fromModel],"channels",{value:conversions[fromModel].channels}),Object.defineProperty(convert[fromModel],"labels",{value:conversions[fromModel].labels});const routes=route(fromModel);Object.keys(routes).forEach((toModel=>{const fn=routes[toModel];convert[fromModel][toModel]=(function(fn){const wrappedFn=function(...args){const arg0=args[0];if(null==arg0)return arg0;arg0.length>1&&(args=arg0);const result=fn(args);if("object"==typeof result)for(let len=result.length,i=0;i<len;i++)result[i]=Math.round(result[i]);return result};return"conversion"in fn&&(wrappedFn.conversion=fn.conversion),wrappedFn})(fn),convert[fromModel][toModel].raw=(function(fn){const wrappedFn=function(...args){const arg0=args[0];return null==arg0?arg0:(arg0.length>1&&(args=arg0),fn(args))};return"conversion"in fn&&(wrappedFn.conversion=fn.conversion),wrappedFn})(fn)}))})),module.exports=convert},7774:(module,__unused_webpack_exports,__webpack_require__)=>{const conversions=__webpack_require__(2956);function deriveBFS(fromModel){const graph=(function(){const graph={},models=Object.keys(conversions);for(let len=models.length,i=0;i<len;i++)graph[models[i]]={distance:-1,parent:null};return graph})(),queue=[fromModel];for(graph[fromModel].distance=0;queue.length;){const current=queue.pop(),adjacents=Object.keys(conversions[current]);for(let len=adjacents.length,i=0;i<len;i++){const adjacent=adjacents[i],node=graph[adjacent];-1===node.distance&&(node.distance=graph[current].distance+1,node.parent=current,queue.unshift(adjacent))}}return graph}function link(from,to){return function(args){return to(from(args))}}function wrapConversion(toModel,graph){const path=[graph[toModel].parent,toModel];let fn=conversions[graph[toModel].parent][toModel],cur=graph[toModel].parent;for(;graph[cur].parent;)path.unshift(graph[cur].parent),fn=link(conversions[graph[cur].parent][cur],fn),cur=graph[cur].parent;return fn.conversion=path,fn}module.exports=function(fromModel){const graph=deriveBFS(fromModel),conversion={},models=Object.keys(graph);for(let len=models.length,i=0;i<len;i++){const toModel=models[i];null!==graph[toModel].parent&&(conversion[toModel]=wrapConversion(toModel,graph))}return conversion}},8900:module=>{"use strict";module.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},2682:module=>{module.exports=function deepFreeze(o){return Object.freeze(o),Object.getOwnPropertyNames(o).forEach((function(prop){!o.hasOwnProperty(prop)||null===o[prop]||"object"!=typeof o[prop]&&"function"!=typeof o[prop]||Object.isFrozen(o[prop])||deepFreeze(o[prop])})),o}},6729:module=>{"use strict";var has=Object.prototype.hasOwnProperty,prefix="~";function Events(){}function EE(fn,context,once){this.fn=fn,this.context=context,this.once=once||!1}function addListener(emitter,event,fn,context,once){if("function"!=typeof fn)throw new TypeError("The listener must be a function");var listener=new EE(fn,context||emitter,once),evt=prefix?prefix+event:event;return emitter._events[evt]?emitter._events[evt].fn?emitter._events[evt]=[emitter._events[evt],listener]:emitter._events[evt].push(listener):(emitter._events[evt]=listener,emitter._eventsCount++),emitter}function clearEvent(emitter,evt){0==--emitter._eventsCount?emitter._events=new Events:delete emitter._events[evt]}function EventEmitter(){this._events=new Events,this._eventsCount=0}Object.create&&(Events.prototype=Object.create(null),(new Events).__proto__||(prefix=!1)),EventEmitter.prototype.eventNames=function(){var events,name,names=[];if(0===this._eventsCount)return names;for(name in events=this._events)has.call(events,name)&&names.push(prefix?name.slice(1):name);return Object.getOwnPropertySymbols?names.concat(Object.getOwnPropertySymbols(events)):names},EventEmitter.prototype.listeners=function(event){var evt=prefix?prefix+event:event,handlers=this._events[evt];if(!handlers)return[];if(handlers.fn)return[handlers.fn];for(var i=0,l=handlers.length,ee=new Array(l);i<l;i++)ee[i]=handlers[i].fn;return ee},EventEmitter.prototype.listenerCount=function(event){var evt=prefix?prefix+event:event,listeners=this._events[evt];return listeners?listeners.fn?1:listeners.length:0},EventEmitter.prototype.emit=function(event,a1,a2,a3,a4,a5){var evt=prefix?prefix+event:event;if(!this._events[evt])return!1;var args,i,listeners=this._events[evt],len=arguments.length;if(listeners.fn){switch(listeners.once&&this.removeListener(event,listeners.fn,void 0,!0),len){case 1:return listeners.fn.call(listeners.context),!0;case 2:return listeners.fn.call(listeners.context,a1),!0;case 3:return listeners.fn.call(listeners.context,a1,a2),!0;case 4:return listeners.fn.call(listeners.context,a1,a2,a3),!0;case 5:return listeners.fn.call(listeners.context,a1,a2,a3,a4),!0;case 6:return listeners.fn.call(listeners.context,a1,a2,a3,a4,a5),!0}for(i=1,args=new Array(len-1);i<len;i++)args[i-1]=arguments[i];listeners.fn.apply(listeners.context,args)}else{var j,length=listeners.length;for(i=0;i<length;i++)switch(listeners[i].once&&this.removeListener(event,listeners[i].fn,void 0,!0),len){case 1:listeners[i].fn.call(listeners[i].context);break;case 2:listeners[i].fn.call(listeners[i].context,a1);break;case 3:listeners[i].fn.call(listeners[i].context,a1,a2);break;case 4:listeners[i].fn.call(listeners[i].context,a1,a2,a3);break;default:if(!args)for(j=1,args=new Array(len-1);j<len;j++)args[j-1]=arguments[j];listeners[i].fn.apply(listeners[i].context,args)}}return!0},EventEmitter.prototype.on=function(event,fn,context){return addListener(this,event,fn,context,!1)},EventEmitter.prototype.once=function(event,fn,context){return addListener(this,event,fn,context,!0)},EventEmitter.prototype.removeListener=function(event,fn,context,once){var evt=prefix?prefix+event:event;if(!this._events[evt])return this;if(!fn)return clearEvent(this,evt),this;var listeners=this._events[evt];if(listeners.fn)listeners.fn!==fn||once&&!listeners.once||context&&listeners.context!==context||clearEvent(this,evt);else{for(var i=0,events=[],length=listeners.length;i<length;i++)(listeners[i].fn!==fn||once&&!listeners[i].once||context&&listeners[i].context!==context)&&events.push(listeners[i]);events.length?this._events[evt]=1===events.length?events[0]:events:clearEvent(this,evt)}return this},EventEmitter.prototype.removeAllListeners=function(event){var evt;return event?(evt=prefix?prefix+event:event,this._events[evt]&&clearEvent(this,evt)):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prefixed=prefix,EventEmitter.EventEmitter=EventEmitter,module.exports=EventEmitter},542:module=>{var hat=module.exports=function(bits,base){if(base||(base=16),void 0===bits&&(bits=128),bits<=0)return"0";for(var digits=Math.log(Math.pow(2,bits))/Math.log(base),i=2;digits===1/0;i*=2)digits=Math.log(Math.pow(2,bits/i))/Math.log(base)*i;var rem=digits-Math.floor(digits),res="";for(i=0;i<Math.floor(digits);i++){res=Math.floor(Math.random()*base).toString(base)+res}if(rem){var b=Math.pow(base,rem);res=Math.floor(Math.random()*b).toString(base)+res}var parsed=parseInt(res,base);return parsed!==1/0&&parsed>=Math.pow(2,bits)?hat(bits,base):res};hat.rack=function(bits,base,expandBy){var fn=function(data){var iters=0;do{if(iters++>10){if(!expandBy)throw new Error("too many ID collisions, use more bits");bits+=expandBy}var id=hat(bits,base)}while(Object.hasOwnProperty.call(hats,id));return hats[id]=data,id},hats=fn.hats={};return fn.get=function(id){return fn.hats[id]},fn.set=function(id,value){return fn.hats[id]=value,fn},fn.bits=bits||128,fn.base=base||16,fn}},7631:module=>{!(function __HLS_WORKER_BUNDLE__(__IN_WORKER__){module.exports=(function(){"use strict";function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread2(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function _toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}function _toPropertyKey(t){var i=_toPrimitive(t,"string");return"symbol"==typeof i?i:String(i)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,_toPropertyKey(descriptor.key),descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}function _defineProperty(obj,key,value){return(key=_toPropertyKey(key))in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _extends(){return(_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,_setPrototypeOf(subClass,superClass)}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,p){return o.__proto__=p,o})(o,p)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _construct(Parent,args,Class){return(_construct=_isNativeReflectConstruct()?Reflect.construct.bind():function(Parent,args,Class){var a=[null];a.push.apply(a,args);var instance=new(Function.bind.apply(Parent,a));return Class&&_setPrototypeOf(instance,Class.prototype),instance}).apply(null,arguments)}function _isNativeFunction(fn){try{return-1!==Function.toString.call(fn).indexOf("[native code]")}catch(e){return"function"==typeof fn}}function _wrapNativeSuper(Class){var _cache="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(Class){if(null===Class||!_isNativeFunction(Class))return Class;if("function"!=typeof Class)throw new TypeError("Super expression must either be null or a function");if(void 0!==_cache){if(_cache.has(Class))return _cache.get(Class);_cache.set(Class,Wrapper)}function Wrapper(){return _construct(Class,arguments,_getPrototypeOf(this).constructor)}return Wrapper.prototype=Object.create(Class.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(Wrapper,Class)})(Class)}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _createForOfIteratorHelperLoose(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0;return function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function getDefaultExportFromCjs(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,"default")?x.default:x}var urlToolkit={exports:{}};!(function(module,exports){var URL_REGEX,FIRST_SEGMENT_REGEX,SLASH_DOT_REGEX,SLASH_DOT_DOT_REGEX,URLToolkit;URL_REGEX=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,FIRST_SEGMENT_REGEX=/^(?=([^\/?#]*))\1([^]*)$/,SLASH_DOT_REGEX=/(?:\/|^)\.(?=\/)/g,SLASH_DOT_DOT_REGEX=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,URLToolkit={buildAbsoluteURL:function(baseURL,relativeURL,opts){if(opts=opts||{},baseURL=baseURL.trim(),!(relativeURL=relativeURL.trim())){if(!opts.alwaysNormalize)return baseURL;var basePartsForNormalise=URLToolkit.parseURL(baseURL);if(!basePartsForNormalise)throw new Error("Error trying to parse base URL.");return basePartsForNormalise.path=URLToolkit.normalizePath(basePartsForNormalise.path),URLToolkit.buildURLFromParts(basePartsForNormalise)}var relativeParts=URLToolkit.parseURL(relativeURL);if(!relativeParts)throw new Error("Error trying to parse relative URL.");if(relativeParts.scheme)return opts.alwaysNormalize?(relativeParts.path=URLToolkit.normalizePath(relativeParts.path),URLToolkit.buildURLFromParts(relativeParts)):relativeURL;var baseParts=URLToolkit.parseURL(baseURL);if(!baseParts)throw new Error("Error trying to parse base URL.");if(!baseParts.netLoc&&baseParts.path&&"/"!==baseParts.path[0]){var pathParts=FIRST_SEGMENT_REGEX.exec(baseParts.path);baseParts.netLoc=pathParts[1],baseParts.path=pathParts[2]}baseParts.netLoc&&!baseParts.path&&(baseParts.path="/");var builtParts={scheme:baseParts.scheme,netLoc:relativeParts.netLoc,path:null,params:relativeParts.params,query:relativeParts.query,fragment:relativeParts.fragment};if(!relativeParts.netLoc&&(builtParts.netLoc=baseParts.netLoc,"/"!==relativeParts.path[0]))if(relativeParts.path){var baseURLPath=baseParts.path,newPath=baseURLPath.substring(0,baseURLPath.lastIndexOf("/")+1)+relativeParts.path;builtParts.path=URLToolkit.normalizePath(newPath)}else builtParts.path=baseParts.path,relativeParts.params||(builtParts.params=baseParts.params,relativeParts.query||(builtParts.query=baseParts.query));return null===builtParts.path&&(builtParts.path=opts.alwaysNormalize?URLToolkit.normalizePath(relativeParts.path):relativeParts.path),URLToolkit.buildURLFromParts(builtParts)},parseURL:function(url){var parts=URL_REGEX.exec(url);return parts?{scheme:parts[1]||"",netLoc:parts[2]||"",path:parts[3]||"",params:parts[4]||"",query:parts[5]||"",fragment:parts[6]||""}:null},normalizePath:function(path){for(path=path.split("").reverse().join("").replace(SLASH_DOT_REGEX,"");path.length!==(path=path.replace(SLASH_DOT_DOT_REGEX,"")).length;);return path.split("").reverse().join("")},buildURLFromParts:function(parts){return parts.scheme+parts.netLoc+parts.path+parts.params+parts.query+parts.fragment}},module.exports=URLToolkit})(urlToolkit);var urlToolkitExports=urlToolkit.exports,isFiniteNumber=Number.isFinite||function(value){return"number"==typeof value&&isFinite(value)},isSafeInteger=Number.isSafeInteger||function(value){return"number"==typeof value&&Math.abs(value)<=MAX_SAFE_INTEGER},MAX_SAFE_INTEGER=Number.MAX_SAFE_INTEGER||9007199254740991,Events=(function(Events){return Events.MEDIA_ATTACHING="hlsMediaAttaching",Events.MEDIA_ATTACHED="hlsMediaAttached",Events.MEDIA_DETACHING="hlsMediaDetaching",Events.MEDIA_DETACHED="hlsMediaDetached",Events.BUFFER_RESET="hlsBufferReset",Events.BUFFER_CODECS="hlsBufferCodecs",Events.BUFFER_CREATED="hlsBufferCreated",Events.BUFFER_APPENDING="hlsBufferAppending",Events.BUFFER_APPENDED="hlsBufferAppended",Events.BUFFER_EOS="hlsBufferEos",Events.BUFFER_FLUSHING="hlsBufferFlushing",Events.BUFFER_FLUSHED="hlsBufferFlushed",Events.MANIFEST_LOADING="hlsManifestLoading",Events.MANIFEST_LOADED="hlsManifestLoaded",Events.MANIFEST_PARSED="hlsManifestParsed",Events.LEVEL_SWITCHING="hlsLevelSwitching",Events.LEVEL_SWITCHED="hlsLevelSwitched",Events.LEVEL_LOADING="hlsLevelLoading",Events.LEVEL_LOADED="hlsLevelLoaded",Events.LEVEL_UPDATED="hlsLevelUpdated",Events.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",Events.LEVELS_UPDATED="hlsLevelsUpdated",Events.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",Events.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",Events.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",Events.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",Events.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",Events.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",Events.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",Events.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",Events.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",Events.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",Events.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",Events.CUES_PARSED="hlsCuesParsed",Events.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",Events.INIT_PTS_FOUND="hlsInitPtsFound",Events.FRAG_LOADING="hlsFragLoading",Events.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",Events.FRAG_LOADED="hlsFragLoaded",Events.FRAG_DECRYPTED="hlsFragDecrypted",Events.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",Events.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",Events.FRAG_PARSING_METADATA="hlsFragParsingMetadata",Events.FRAG_PARSED="hlsFragParsed",Events.FRAG_BUFFERED="hlsFragBuffered",Events.FRAG_CHANGED="hlsFragChanged",Events.FPS_DROP="hlsFpsDrop",Events.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",Events.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",Events.ERROR="hlsError",Events.DESTROYING="hlsDestroying",Events.KEY_LOADING="hlsKeyLoading",Events.KEY_LOADED="hlsKeyLoaded",Events.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",Events.BACK_BUFFER_REACHED="hlsBackBufferReached",Events.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",Events})({}),ErrorTypes=(function(ErrorTypes){return ErrorTypes.NETWORK_ERROR="networkError",ErrorTypes.MEDIA_ERROR="mediaError",ErrorTypes.KEY_SYSTEM_ERROR="keySystemError",ErrorTypes.MUX_ERROR="muxError",ErrorTypes.OTHER_ERROR="otherError",ErrorTypes})({}),ErrorDetails=(function(ErrorDetails){return ErrorDetails.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",ErrorDetails.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",ErrorDetails.KEY_SYSTEM_NO_SESSION="keySystemNoSession",ErrorDetails.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",ErrorDetails.MANIFEST_LOAD_ERROR="manifestLoadError",ErrorDetails.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",ErrorDetails.MANIFEST_PARSING_ERROR="manifestParsingError",ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",ErrorDetails.LEVEL_EMPTY_ERROR="levelEmptyError",ErrorDetails.LEVEL_LOAD_ERROR="levelLoadError",ErrorDetails.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",ErrorDetails.LEVEL_PARSING_ERROR="levelParsingError",ErrorDetails.LEVEL_SWITCH_ERROR="levelSwitchError",ErrorDetails.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",ErrorDetails.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",ErrorDetails.FRAG_LOAD_ERROR="fragLoadError",ErrorDetails.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",ErrorDetails.FRAG_DECRYPT_ERROR="fragDecryptError",ErrorDetails.FRAG_PARSING_ERROR="fragParsingError",ErrorDetails.FRAG_GAP="fragGap",ErrorDetails.REMUX_ALLOC_ERROR="remuxAllocError",ErrorDetails.KEY_LOAD_ERROR="keyLoadError",ErrorDetails.KEY_LOAD_TIMEOUT="keyLoadTimeOut",ErrorDetails.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",ErrorDetails.BUFFER_APPEND_ERROR="bufferAppendError",ErrorDetails.BUFFER_APPENDING_ERROR="bufferAppendingError",ErrorDetails.BUFFER_STALLED_ERROR="bufferStalledError",ErrorDetails.BUFFER_FULL_ERROR="bufferFullError",ErrorDetails.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",ErrorDetails.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",ErrorDetails.INTERNAL_EXCEPTION="internalException",ErrorDetails.INTERNAL_ABORTED="aborted",ErrorDetails.UNKNOWN="unknown",ErrorDetails})({}),noop=function(){},fakeLogger={trace:noop,debug:noop,log:noop,warn:noop,info:noop,error:noop},exportedLogger=fakeLogger;function consolePrintFn(type){var func=self.console[type];return func?func.bind(self.console,"["+type+"] >"):noop}function exportLoggerFunctions(debugConfig){for(var _len=arguments.length,functions=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)functions[_key-1]=arguments[_key];functions.forEach((function(type){exportedLogger[type]=debugConfig[type]?debugConfig[type].bind(debugConfig):consolePrintFn(type)}))}function enableLogs(debugConfig,id){if("object"==typeof console&&!0===debugConfig||"object"==typeof debugConfig){exportLoggerFunctions(debugConfig,"debug","log","info","warn","error");try{exportedLogger.log('Debug logs enabled for "'+id+'" in hls.js version 1.5.5-0.canary.9893')}catch(e){exportedLogger=fakeLogger}}else exportedLogger=fakeLogger}var logger=exportedLogger,DECIMAL_RESOLUTION_REGEX=/^(\d+)x(\d+)$/,ATTR_LIST_REGEX=/(.+?)=(".*?"|.*?)(?:,|$)/g,AttrList=(function(){function AttrList(attrs){"string"==typeof attrs&&(attrs=AttrList.parseAttrList(attrs)),_extends(this,attrs)}var _proto=AttrList.prototype;return _proto.decimalInteger=function(attrName){var intValue=parseInt(this[attrName],10);return intValue>Number.MAX_SAFE_INTEGER?1/0:intValue},_proto.hexadecimalInteger=function(attrName){if(this[attrName]){var stringValue=(this[attrName]||"0x").slice(2);stringValue=(1&stringValue.length?"0":"")+stringValue;for(var value=new Uint8Array(stringValue.length/2),i=0;i<stringValue.length/2;i++)value[i]=parseInt(stringValue.slice(2*i,2*i+2),16);return value}return null},_proto.hexadecimalIntegerAsNumber=function(attrName){var intValue=parseInt(this[attrName],16);return intValue>Number.MAX_SAFE_INTEGER?1/0:intValue},_proto.decimalFloatingPoint=function(attrName){return parseFloat(this[attrName])},_proto.optionalFloat=function(attrName,defaultValue){var value=this[attrName];return value?parseFloat(value):defaultValue},_proto.enumeratedString=function(attrName){return this[attrName]},_proto.bool=function(attrName){return"YES"===this[attrName]},_proto.decimalResolution=function(attrName){var res=DECIMAL_RESOLUTION_REGEX.exec(this[attrName]);if(null!==res)return{width:parseInt(res[1],10),height:parseInt(res[2],10)}},AttrList.parseAttrList=function(input){var match,attrs={},quote='"';for(ATTR_LIST_REGEX.lastIndex=0;null!==(match=ATTR_LIST_REGEX.exec(input));){var value=match[2];0===value.indexOf(quote)&&value.lastIndexOf(quote)===value.length-1&&(value=value.slice(1,-1)),attrs[match[1].trim()]=value}return attrs},_createClass(AttrList,[{key:"clientAttrs",get:function(){return Object.keys(this).filter((function(attr){return"X-"===attr.substring(0,2)}))}}]),AttrList})();function isDateRangeCueAttribute(attrName){return"ID"!==attrName&&"CLASS"!==attrName&&"START-DATE"!==attrName&&"DURATION"!==attrName&&"END-DATE"!==attrName&&"END-ON-NEXT"!==attrName}function isSCTE35Attribute(attrName){return"SCTE35-OUT"===attrName||"SCTE35-IN"===attrName}var DateRange=(function(){function DateRange(dateRangeAttr,dateRangeWithSameId){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,dateRangeWithSameId){var previousAttr=dateRangeWithSameId.attr;for(var key in previousAttr)if(Object.prototype.hasOwnProperty.call(dateRangeAttr,key)&&dateRangeAttr[key]!==previousAttr[key]){logger.warn('DATERANGE tag attribute: "'+key+'" does not match for tags with ID: "'+dateRangeAttr.ID+'"'),this._badValueForSameId=key;break}dateRangeAttr=_extends(new AttrList({}),previousAttr,dateRangeAttr)}if(this.attr=dateRangeAttr,this._startDate=new Date(dateRangeAttr["START-DATE"]),"END-DATE"in this.attr){var endDate=new Date(this.attr["END-DATE"]);isFiniteNumber(endDate.getTime())&&(this._endDate=endDate)}}return _createClass(DateRange,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var duration=this.duration;return null!==duration?new Date(this._startDate.getTime()+1e3*duration):null}},{key:"duration",get:function(){if("DURATION"in this.attr){var duration=this.attr.decimalFloatingPoint("DURATION");if(isFiniteNumber(duration))return duration}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}},{key:"endOnNext",get:function(){return this.attr.bool("END-ON-NEXT")}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&isFiniteNumber(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),DateRange})(),LoadStats=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}},ElementaryStreamTypes={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"},BaseSegment=(function(){function BaseSegment(baseurl){var _this$elementaryStrea;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((_this$elementaryStrea={})[ElementaryStreamTypes.AUDIO]=null,_this$elementaryStrea[ElementaryStreamTypes.VIDEO]=null,_this$elementaryStrea[ElementaryStreamTypes.AUDIOVIDEO]=null,_this$elementaryStrea),this.baseurl=baseurl}return BaseSegment.prototype.setByteRange=function(value,previous){var start,params=value.split("@",2);start=1===params.length?(null==previous?void 0:previous.byteRangeEndOffset)||0:parseInt(params[1]),this._byteRange=[start,parseInt(params[0])+start]},_createClass(BaseSegment,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=urlToolkitExports.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(value){this._url=value}}]),BaseSegment})(),Fragment=(function(_BaseSegment){function Fragment(type,baseurl){var _this;return(_this=_BaseSegment.call(this,baseurl)||this)._decryptdata=null,_this.rawProgramDateTime=null,_this.programDateTime=null,_this.tagList=[],_this.duration=0,_this.sn=0,_this.levelkeys=void 0,_this.type=void 0,_this.loader=null,_this.keyLoader=null,_this.level=-1,_this.cc=0,_this.startPTS=void 0,_this.endPTS=void 0,_this.startDTS=void 0,_this.endDTS=void 0,_this.start=0,_this.deltaPTS=void 0,_this.maxStartPTS=void 0,_this.minEndPTS=void 0,_this.stats=new LoadStats,_this.data=void 0,_this.bitrateTest=!1,_this.title=null,_this.initSegment=null,_this.endList=void 0,_this.gap=void 0,_this.urlId=0,_this.type=type,_this}_inheritsLoose(Fragment,_BaseSegment);var _proto2=Fragment.prototype;return _proto2.setKeyFormat=function(keyFormat){if(this.levelkeys){var _key=this.levelkeys[keyFormat];_key&&!this._decryptdata&&(this._decryptdata=_key.getDecryptData(this.sn))}},_proto2.abortRequests=function(){var _this$loader,_this$keyLoader;null==(_this$loader=this.loader)||_this$loader.abort(),null==(_this$keyLoader=this.keyLoader)||_this$keyLoader.abort()},_proto2.setElementaryStreamInfo=function(type,startPTS,endPTS,startDTS,endDTS,partial){void 0===partial&&(partial=!1);var elementaryStreams=this.elementaryStreams,info=elementaryStreams[type];info?(info.startPTS=Math.min(info.startPTS,startPTS),info.endPTS=Math.max(info.endPTS,endPTS),info.startDTS=Math.min(info.startDTS,startDTS),info.endDTS=Math.max(info.endDTS,endDTS)):elementaryStreams[type]={startPTS:startPTS,endPTS:endPTS,startDTS:startDTS,endDTS:endDTS,partial:partial}},_proto2.clearElementaryStreamInfo=function(){var elementaryStreams=this.elementaryStreams;elementaryStreams[ElementaryStreamTypes.AUDIO]=null,elementaryStreams[ElementaryStreamTypes.VIDEO]=null,elementaryStreams[ElementaryStreamTypes.AUDIOVIDEO]=null},_createClass(Fragment,[{key:"decryptdata",get:function(){if(!this.levelkeys&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var _key2=this.levelkeys.identity;if(_key2)this._decryptdata=_key2.getDecryptData(this.sn);else{var keyFormats=Object.keys(this.levelkeys);if(1===keyFormats.length)return this._decryptdata=this.levelkeys[keyFormats[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!isFiniteNumber(this.programDateTime))return null;var duration=isFiniteNumber(this.duration)?this.duration:0;return this.programDateTime+1e3*duration}},{key:"encrypted",get:function(){var _this$_decryptdata;if(null!=(_this$_decryptdata=this._decryptdata)&&_this$_decryptdata.encrypted)return!0;if(this.levelkeys){var keyFormats=Object.keys(this.levelkeys),len=keyFormats.length;if(len>1||1===len&&this.levelkeys[keyFormats[0]].encrypted)return!0}return!1}}]),Fragment})(BaseSegment),Part=(function(_BaseSegment2){function Part(partAttrs,frag,baseurl,index,previous){var _this2;(_this2=_BaseSegment2.call(this,baseurl)||this).fragOffset=0,_this2.duration=0,_this2.gap=!1,_this2.independent=!1,_this2.relurl=void 0,_this2.fragment=void 0,_this2.index=void 0,_this2.stats=new LoadStats,_this2.duration=partAttrs.decimalFloatingPoint("DURATION"),_this2.gap=partAttrs.bool("GAP"),_this2.independent=partAttrs.bool("INDEPENDENT"),_this2.relurl=partAttrs.enumeratedString("URI"),_this2.fragment=frag,_this2.index=index;var byteRange=partAttrs.enumeratedString("BYTERANGE");return byteRange&&_this2.setByteRange(byteRange,previous),previous&&(_this2.fragOffset=previous.fragOffset+previous.duration),_this2}return _inheritsLoose(Part,_BaseSegment2),_createClass(Part,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var elementaryStreams=this.elementaryStreams;return!!(elementaryStreams.audio||elementaryStreams.video||elementaryStreams.audiovideo)}}]),Part})(BaseSegment),DEFAULT_TARGET_DURATION=10,LevelDetails=(function(){function LevelDetails(baseUrl){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=baseUrl}return LevelDetails.prototype.reloaded=function(previous){if(!previous)return this.advanced=!0,void(this.updated=!0);var partSnDiff=this.lastPartSn-previous.lastPartSn,partIndexDiff=this.lastPartIndex-previous.lastPartIndex;this.updated=this.endSN!==previous.endSN||!!partIndexDiff||!!partSnDiff||!this.live,this.advanced=this.endSN>previous.endSN||partSnDiff>0||0===partSnDiff&&partIndexDiff>0,this.updated||this.advanced?this.misses=Math.floor(.6*previous.misses):this.misses=previous.misses+1,this.availabilityDelay=previous.availabilityDelay},_createClass(LevelDetails,[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&isFiniteNumber(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||DEFAULT_TARGET_DURATION}},{key:"drift",get:function(){var runTime=this.driftEndTime-this.driftStartTime;return runTime>0?1e3*(this.driftEnd-this.driftStart)/runTime:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var _this$partList;return null!=(_this$partList=this.partList)&&_this$partList.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var _this$fragments;return null!=(_this$fragments=this.fragments)&&_this$fragments.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var _this$partList2;return null!=(_this$partList2=this.partList)&&_this$partList2.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var _this$partList3;return null!=(_this$partList3=this.partList)&&_this$partList3.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),LevelDetails})();function base64Decode(base64encodedStr){return Uint8Array.from(atob(base64encodedStr),(function(c){return c.charCodeAt(0)}))}function getKeyIdBytes(str){var keyIdbytes=strToUtf8array(str).subarray(0,16),paddedkeyIdbytes=new Uint8Array(16);return paddedkeyIdbytes.set(keyIdbytes,16-keyIdbytes.length),paddedkeyIdbytes}function changeEndianness(keyId){var swap=function(array,from,to){var cur=array[from];array[from]=array[to],array[to]=cur};swap(keyId,0,3),swap(keyId,1,2),swap(keyId,4,5),swap(keyId,6,7)}function convertDataUriToArrayBytes(uri){var colonsplit=uri.split(":"),keydata=null;if("data"===colonsplit[0]&&2===colonsplit.length){var semicolonsplit=colonsplit[1].split(";"),commasplit=semicolonsplit[semicolonsplit.length-1].split(",");if(2===commasplit.length){var isbase64="base64"===commasplit[0],data=commasplit[1];isbase64?(semicolonsplit.splice(-1,1),keydata=base64Decode(data)):keydata=getKeyIdBytes(data)}}return keydata}function strToUtf8array(str){return Uint8Array.from(unescape(encodeURIComponent(str)),(function(c){return c.charCodeAt(0)}))}var optionalSelf="undefined"!=typeof self?self:void 0,KeySystems={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},KeySystemFormats={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function keySystemFormatToKeySystemDomain(format){switch(format){case KeySystemFormats.FAIRPLAY:return KeySystems.FAIRPLAY;case KeySystemFormats.PLAYREADY:return KeySystems.PLAYREADY;case KeySystemFormats.WIDEVINE:return KeySystems.WIDEVINE;case KeySystemFormats.CLEARKEY:return KeySystems.CLEARKEY}}var KeySystemIds={WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function keySystemIdToKeySystemDomain(systemId){if(systemId===KeySystemIds.WIDEVINE)return KeySystems.WIDEVINE}function keySystemDomainToKeySystemFormat(keySystem){switch(keySystem){case KeySystems.FAIRPLAY:return KeySystemFormats.FAIRPLAY;case KeySystems.PLAYREADY:return KeySystemFormats.PLAYREADY;case KeySystems.WIDEVINE:return KeySystemFormats.WIDEVINE;case KeySystems.CLEARKEY:return KeySystemFormats.CLEARKEY}}function getKeySystemsForConfig(config){var drmSystems=config.drmSystems,widevineLicenseUrl=config.widevineLicenseUrl,keySystemsToAttempt=drmSystems?[KeySystems.FAIRPLAY,KeySystems.WIDEVINE,KeySystems.PLAYREADY,KeySystems.CLEARKEY].filter((function(keySystem){return!!drmSystems[keySystem]})):[];return!keySystemsToAttempt[KeySystems.WIDEVINE]&&widevineLicenseUrl&&keySystemsToAttempt.push(KeySystems.WIDEVINE),keySystemsToAttempt}var _optionalSelf$navigat,requestMediaKeySystemAccess=null!=optionalSelf&&null!=(_optionalSelf$navigat=optionalSelf.navigator)&&_optionalSelf$navigat.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function getSupportedMediaKeySystemConfigurations(keySystem,audioCodecs,videoCodecs,drmSystemOptions){var initDataTypes;switch(keySystem){case KeySystems.FAIRPLAY:initDataTypes=["cenc","sinf"];break;case KeySystems.WIDEVINE:case KeySystems.PLAYREADY:initDataTypes=["cenc"];break;case KeySystems.CLEARKEY:initDataTypes=["cenc","keyids"];break;default:throw new Error("Unknown key-system: "+keySystem)}return createMediaKeySystemConfigurations(initDataTypes,audioCodecs,videoCodecs,drmSystemOptions)}function createMediaKeySystemConfigurations(initDataTypes,audioCodecs,videoCodecs,drmSystemOptions){return[{initDataTypes:initDataTypes,persistentState:drmSystemOptions.persistentState||"optional",distinctiveIdentifier:drmSystemOptions.distinctiveIdentifier||"optional",sessionTypes:drmSystemOptions.sessionTypes||[drmSystemOptions.sessionType||"temporary"],audioCapabilities:audioCodecs.map((function(codec){return{contentType:'audio/mp4; codecs="'+codec+'"',robustness:drmSystemOptions.audioRobustness||"",encryptionScheme:drmSystemOptions.audioEncryptionScheme||null}})),videoCapabilities:videoCodecs.map((function(codec){return{contentType:'video/mp4; codecs="'+codec+'"',robustness:drmSystemOptions.videoRobustness||"",encryptionScheme:drmSystemOptions.videoEncryptionScheme||null}}))}]}function sliceUint8(array,start,end){return Uint8Array.prototype.slice?array.slice(start,end):new Uint8Array(Array.prototype.slice.call(array,start,end))}var decoder,isHeader$2=function(data,offset){return offset+10<=data.length&&73===data[offset]&&68===data[offset+1]&&51===data[offset+2]&&data[offset+3]<255&&data[offset+4]<255&&data[offset+6]<128&&data[offset+7]<128&&data[offset+8]<128&&data[offset+9]<128},isFooter=function(data,offset){return offset+10<=data.length&&51===data[offset]&&68===data[offset+1]&&73===data[offset+2]&&data[offset+3]<255&&data[offset+4]<255&&data[offset+6]<128&&data[offset+7]<128&&data[offset+8]<128&&data[offset+9]<128},getID3Data=function(data,offset){for(var front=offset,length=0;isHeader$2(data,offset);)length+=10,length+=readSize(data,offset+6),isFooter(data,offset+10)&&(length+=10),offset+=length;if(length>0)return data.subarray(front,front+length)},readSize=function(data,offset){var size=0;return size=(127&data[offset])<<21,size|=(127&data[offset+1])<<14,size|=(127&data[offset+2])<<7,size|=127&data[offset+3]},canParse$2=function(data,offset){return isHeader$2(data,offset)&&readSize(data,offset+6)+10<=data.length-offset},getTimeStamp=function(data){for(var frames=getID3Frames(data),i=0;i<frames.length;i++){var frame=frames[i];if(isTimeStampFrame(frame))return readTimeStamp(frame)}},isTimeStampFrame=function(frame){return frame&&"PRIV"===frame.key&&"com.apple.streaming.transportStreamTimestamp"===frame.info},getFrameData=function(data){var type=String.fromCharCode(data[0],data[1],data[2],data[3]),size=readSize(data,4),offset=10;return{type:type,size:size,data:data.subarray(offset,offset+size)}},getID3Frames=function(id3Data){for(var offset=0,frames=[];isHeader$2(id3Data,offset);){for(var size=readSize(id3Data,offset+6),end=(offset+=10)+size;offset+8<end;){var frameData=getFrameData(id3Data.subarray(offset)),frame=decodeFrame(frameData);frame&&frames.push(frame),offset+=frameData.size+10}isFooter(id3Data,offset)&&(offset+=10)}return frames},decodeFrame=function(frame){return"PRIV"===frame.type?decodePrivFrame(frame):"W"===frame.type[0]?decodeURLFrame(frame):decodeTextFrame(frame)},decodePrivFrame=function(frame){if(!(frame.size<2)){var owner=utf8ArrayToStr(frame.data,!0),privateData=new Uint8Array(frame.data.subarray(owner.length+1));return{key:frame.type,info:owner,data:privateData.buffer}}},decodeTextFrame=function(frame){if(!(frame.size<2)){if("TXXX"===frame.type){var index=1,description=utf8ArrayToStr(frame.data.subarray(index),!0);index+=description.length+1;var value=utf8ArrayToStr(frame.data.subarray(index));return{key:frame.type,info:description,data:value}}var text=utf8ArrayToStr(frame.data.subarray(1));return{key:frame.type,data:text}}},decodeURLFrame=function(frame){if("WXXX"===frame.type){if(frame.size<2)return;var index=1,description=utf8ArrayToStr(frame.data.subarray(index),!0);index+=description.length+1;var value=utf8ArrayToStr(frame.data.subarray(index));return{key:frame.type,info:description,data:value}}var url=utf8ArrayToStr(frame.data);return{key:frame.type,data:url}},readTimeStamp=function(timeStampFrame){if(8===timeStampFrame.data.byteLength){var data=new Uint8Array(timeStampFrame.data),pts33Bit=1&data[3],timestamp=(data[4]<<23)+(data[5]<<15)+(data[6]<<7)+data[7];return timestamp/=45,pts33Bit&&(timestamp+=47721858.84),Math.round(timestamp)}},utf8ArrayToStr=function(array,exitOnNull){void 0===exitOnNull&&(exitOnNull=!1);var decoder=getTextDecoder();if(decoder){var decoded=decoder.decode(array);if(exitOnNull){var idx=decoded.indexOf("\0");return-1!==idx?decoded.substring(0,idx):decoded}return decoded.replace(/\0/g,"")}for(var c,char2,char3,len=array.length,out="",i=0;i<len;){if(0===(c=array[i++])&&exitOnNull)return out;if(0!==c&&3!==c)switch(c>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:out+=String.fromCharCode(c);break;case 12:case 13:char2=array[i++],out+=String.fromCharCode((31&c)<<6|63&char2);break;case 14:char2=array[i++],char3=array[i++],out+=String.fromCharCode((15&c)<<12|(63&char2)<<6|(63&char3)<<0)}}return out};function getTextDecoder(){if(!navigator.userAgent.includes("PlayStation 4"))return decoder||void 0===self.TextDecoder||(decoder=new self.TextDecoder("utf-8")),decoder}var Hex={hexDump:function(array){for(var str="",i=0;i<array.length;i++){var h=array[i].toString(16);h.length<2&&(h="0"+h),str+=h}return str}},UINT32_MAX$1=Math.pow(2,32)-1,push=[].push,RemuxerTrackIdConfig={video:1,audio:2,id3:3,text:4};function bin2str(data){return String.fromCharCode.apply(null,data)}function readUint16(buffer,offset){var val=buffer[offset]<<8|buffer[offset+1];return val<0?65536+val:val}function readUint32(buffer,offset){var val=readSint32(buffer,offset);return val<0?4294967296+val:val}function readUint64(buffer,offset){var result=readUint32(buffer,offset);return result*=Math.pow(2,32),result+=readUint32(buffer,offset+4)}function readSint32(buffer,offset){return buffer[offset]<<24|buffer[offset+1]<<16|buffer[offset+2]<<8|buffer[offset+3]}function writeUint32(buffer,offset,value){buffer[offset]=value>>24,buffer[offset+1]=value>>16&255,buffer[offset+2]=value>>8&255,buffer[offset+3]=255&value}function hasMoofData(data){for(var end=data.byteLength,i=0;i<end;){var size=readUint32(data,i);if(size>8&&109===data[i+4]&&111===data[i+5]&&111===data[i+6]&&102===data[i+7])return!0;i=size>1?i+size:end}return!1}function findBox(data,path){var results=[];if(!path.length)return results;for(var end=data.byteLength,i=0;i<end;){var size=readUint32(data,i),endbox=size>1?i+size:end;if(bin2str(data.subarray(i+4,i+8))===path[0])if(1===path.length)results.push(data.subarray(i+8,endbox));else{var subresults=findBox(data.subarray(i+8,endbox),path.slice(1));subresults.length&&push.apply(results,subresults)}i=endbox}return results}function parseSegmentIndex(sidx){var references=[],version=sidx[0],index=8,timescale=readUint32(sidx,index);index+=4;var earliestPresentationTime=0,firstOffset=0;0===version?(earliestPresentationTime=readUint32(sidx,index),firstOffset=readUint32(sidx,index+4),index+=8):(earliestPresentationTime=readUint64(sidx,index),firstOffset=readUint64(sidx,index+8),index+=16),index+=2;var startByte=sidx.length+firstOffset,referencesCount=readUint16(sidx,index);index+=2;for(var i=0;i<referencesCount;i++){var referenceIndex=index,referenceInfo=readUint32(sidx,referenceIndex);referenceIndex+=4;var referenceSize=2147483647&referenceInfo;if(1==(2147483648&referenceInfo)>>>31)return logger.warn("SIDX has hierarchical references (not supported)"),null;var subsegmentDuration=readUint32(sidx,referenceIndex);referenceIndex+=4,references.push({referenceSize:referenceSize,subsegmentDuration:subsegmentDuration,info:{duration:subsegmentDuration/timescale,start:startByte,end:startByte+referenceSize-1}}),startByte+=referenceSize,index=referenceIndex+=4}return{earliestPresentationTime:earliestPresentationTime,timescale:timescale,version:version,referencesCount:referencesCount,references:references}}function parseInitSegment(initSegment){for(var result=[],traks=findBox(initSegment,["moov","trak"]),i=0;i<traks.length;i++){var trak=traks[i],tkhd=findBox(trak,["tkhd"])[0];if(tkhd){var version=tkhd[0],trackId=readUint32(tkhd,0===version?12:20),mdhd=findBox(trak,["mdia","mdhd"])[0];if(mdhd){var timescale=readUint32(mdhd,0===(version=mdhd[0])?12:20),hdlr=findBox(trak,["mdia","hdlr"])[0];if(hdlr){var hdlrType=bin2str(hdlr.subarray(8,12)),type={soun:ElementaryStreamTypes.AUDIO,vide:ElementaryStreamTypes.VIDEO}[hdlrType];if(type){var stsdData=parseStsd(findBox(trak,["mdia","minf","stbl","stsd"])[0]);result[trackId]={timescale:timescale,type:type},result[type]=_objectSpread2({timescale:timescale,id:trackId},stsdData)}}}}}return findBox(initSegment,["moov","mvex","trex"]).forEach((function(trex){var trackId=readUint32(trex,4),track=result[trackId];track&&(track.default={duration:readUint32(trex,12),flags:readUint32(trex,20)})})),result}function parseStsd(stsd){var sampleEntries=stsd.subarray(8),sampleEntriesEnd=sampleEntries.subarray(86),fourCC=bin2str(sampleEntries.subarray(4,8)),codec=fourCC,encrypted="enca"===fourCC||"encv"===fourCC;if(encrypted){var encBox=findBox(sampleEntries,[fourCC])[0];findBox(encBox.subarray("enca"===fourCC?28:78),["sinf"]).forEach((function(sinf){var schm=findBox(sinf,["schm"])[0];if(schm){var scheme=bin2str(schm.subarray(4,8));if("cbcs"===scheme||"cenc"===scheme){var frma=findBox(sinf,["frma"])[0];frma&&(codec=bin2str(frma))}}}))}switch(codec){case"avc1":case"avc2":case"avc3":case"avc4":var avcCBox=findBox(sampleEntriesEnd,["avcC"])[0];codec+="."+toHex(avcCBox[1])+toHex(avcCBox[2])+toHex(avcCBox[3]);break;case"mp4a":var codecBox=findBox(sampleEntries,[fourCC])[0],esdsBox=findBox(codecBox.subarray(28),["esds"])[0];if(esdsBox&&esdsBox.length>12){var i=4;if(3!==esdsBox[i++])break;i=skipBERInteger(esdsBox,i),i+=2;var flags=esdsBox[i++];if(128&flags&&(i+=2),64&flags&&(i+=esdsBox[i++]),4!==esdsBox[i++])break;i=skipBERInteger(esdsBox,i);var objectType=esdsBox[i++];if(64!==objectType)break;if(codec+="."+toHex(objectType),i+=12,5!==esdsBox[i++])break;i=skipBERInteger(esdsBox,i);var firstByte=esdsBox[i++],audioObjectType=(248&firstByte)>>3;31===audioObjectType&&(audioObjectType+=1+((7&firstByte)<<3)+((224&esdsBox[i])>>5)),codec+="."+audioObjectType}break;case"hvc1":case"hev1":var hvcCBox=findBox(sampleEntriesEnd,["hvcC"])[0],profileByte=hvcCBox[1],profileSpace=["","A","B","C"][profileByte>>6],generalProfileIdc=31&profileByte,profileCompat=readUint32(hvcCBox,2),tierFlag=(32&profileByte)>>5?"H":"L",levelIDC=hvcCBox[12],constraintIndicator=hvcCBox.subarray(6,12);codec+="."+profileSpace+generalProfileIdc,codec+="."+profileCompat.toString(16).toUpperCase(),codec+="."+tierFlag+levelIDC;for(var constraintString="",_i=constraintIndicator.length;_i--;){var _byte=constraintIndicator[_i];(_byte||constraintString)&&(constraintString="."+_byte.toString(16).toUpperCase()+constraintString)}codec+=constraintString;break;case"dvh1":case"dvhe":var dvcCBox=findBox(sampleEntriesEnd,["dvcC"])[0],profile=dvcCBox[2]>>1&127,level=dvcCBox[2]<<5&32|dvcCBox[3]>>3&31;codec+="."+addLeadingZero(profile)+"."+addLeadingZero(level);break;case"vp09":var vpcCBox=findBox(sampleEntriesEnd,["vpcC"])[0],_profile=vpcCBox[4],_level=vpcCBox[5],bitDepth=vpcCBox[6]>>4&15;codec+="."+addLeadingZero(_profile)+"."+addLeadingZero(_level)+"."+addLeadingZero(bitDepth);break;case"av01":var av1CBox=findBox(sampleEntriesEnd,["av1C"])[0],_profile2=av1CBox[1]>>>5,_level2=31&av1CBox[1],_tierFlag=av1CBox[2]>>>7?"H":"M",highBitDepth=(64&av1CBox[2])>>6,twelveBit=(32&av1CBox[2])>>5,_bitDepth=2===_profile2&&highBitDepth?twelveBit?12:10:highBitDepth?10:8,monochrome=(16&av1CBox[2])>>4,chromaSubsamplingX=(8&av1CBox[2])>>3,chromaSubsamplingY=(4&av1CBox[2])>>2,chromaSamplePosition=3&av1CBox[2],colorPrimaries=1,transferCharacteristics=1,matrixCoefficients=1,videoFullRangeFlag=0;codec+="."+_profile2+"."+addLeadingZero(_level2)+_tierFlag+"."+addLeadingZero(_bitDepth)+"."+monochrome+"."+chromaSubsamplingX+chromaSubsamplingY+chromaSamplePosition+"."+addLeadingZero(colorPrimaries)+"."+addLeadingZero(transferCharacteristics)+"."+addLeadingZero(matrixCoefficients)+"."+videoFullRangeFlag}return{codec:codec,encrypted:encrypted}}function skipBERInteger(bytes,i){for(var limit=i+5;128&bytes[i++]&&i<limit;);return i}function toHex(x){return("0"+x.toString(16).toUpperCase()).slice(-2)}function addLeadingZero(num){return(num<10?"0":"")+num}function patchEncyptionData(initSegment,decryptdata){if(!initSegment||!decryptdata)return initSegment;var keyId=decryptdata.keyId;return keyId&&decryptdata.isCommonEncryption&&findBox(initSegment,["moov","trak"]).forEach((function(trak){var sampleEntries=findBox(trak,["mdia","minf","stbl","stsd"])[0].subarray(8),encBoxes=findBox(sampleEntries,["enca"]),isAudio=encBoxes.length>0;isAudio||(encBoxes=findBox(sampleEntries,["encv"])),encBoxes.forEach((function(enc){findBox(isAudio?enc.subarray(28):enc.subarray(78),["sinf"]).forEach((function(sinf){var tenc=parseSinf(sinf);if(tenc){var tencKeyId=tenc.subarray(8,24);tencKeyId.some((function(b){return 0!==b}))||(logger.log("[eme] Patching keyId in 'enc"+(isAudio?"a":"v")+">sinf>>tenc' box: "+Hex.hexDump(tencKeyId)+" -> "+Hex.hexDump(keyId)),tenc.set(keyId,8))}}))}))})),initSegment}function parseSinf(sinf){var schm=findBox(sinf,["schm"])[0];if(schm){var scheme=bin2str(schm.subarray(4,8));if("cbcs"===scheme||"cenc"===scheme)return findBox(sinf,["schi","tenc"])[0]}return logger.error("[eme] missing 'schm' box"),null}function getStartDTS(initData,fmp4){return findBox(fmp4,["moof","traf"]).reduce((function(result,traf){var tfdt=findBox(traf,["tfdt"])[0],version=tfdt[0],start=findBox(traf,["tfhd"]).reduce((function(result,tfhd){var id=readUint32(tfhd,4),track=initData[id];if(track){var baseTime=readUint32(tfdt,4);if(1===version){if(baseTime===UINT32_MAX$1)return logger.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),result;baseTime*=UINT32_MAX$1+1,baseTime+=readUint32(tfdt,8)}var startTime=baseTime/(track.timescale||9e4);if(isFiniteNumber(startTime)&&(null===result||startTime<result))return startTime}return result}),null);return null!==start&&isFiniteNumber(start)&&(null===result||start<result)?start:result}),null)}function getDuration(data,initData){for(var sidxMinStart=1/0,sidxMaxEnd=0,sidxDuration=0,sidxs=findBox(data,["sidx"]),i=0;i<sidxs.length;i++){var sidx=parseSegmentIndex(sidxs[i]);if(null!=sidx&&sidx.references){sidxMinStart=Math.min(sidxMinStart,sidx.earliestPresentationTime/sidx.timescale);var subSegmentDuration=sidx.references.reduce((function(dur,ref){return dur+ref.info.duration||0}),0);sidxDuration=(sidxMaxEnd=Math.max(sidxMaxEnd,subSegmentDuration+sidx.earliestPresentationTime/sidx.timescale))-sidxMinStart}}if(sidxDuration&&isFiniteNumber(sidxDuration))return sidxDuration;for(var rawDuration=0,videoDuration=0,audioDuration=0,trafs=findBox(data,["moof","traf"]),_i2=0;_i2<trafs.length;_i2++){var traf=trafs[_i2],tfhd=findBox(traf,["tfhd"])[0],track=initData[readUint32(tfhd,4)];if(track){var trackDefault=track.default,tfhdFlags=readUint32(tfhd,0)|(null==trackDefault?void 0:trackDefault.flags),sampleDuration=null==trackDefault?void 0:trackDefault.duration;8&tfhdFlags&&(sampleDuration=readUint32(tfhd,2&tfhdFlags?12:8));for(var timescale=track.timescale||9e4,truns=findBox(traf,["trun"]),j=0;j<truns.length;j++)!(rawDuration=computeRawDurationFromSamples(truns[j]))&&sampleDuration&&(rawDuration=sampleDuration*readUint32(truns[j],4)),track.type===ElementaryStreamTypes.VIDEO?videoDuration+=rawDuration/timescale:track.type===ElementaryStreamTypes.AUDIO&&(audioDuration+=rawDuration/timescale)}}return videoDuration||audioDuration}function computeRawDurationFromSamples(trun){var flags=readUint32(trun,0),offset=8;1&flags&&(offset+=4),4&flags&&(offset+=4);for(var duration=0,sampleCount=readUint32(trun,4),i=0;i<sampleCount;i++)256&flags&&(duration+=readUint32(trun,offset),offset+=4),512&flags&&(offset+=4),1024&flags&&(offset+=4),2048&flags&&(offset+=4);return duration}function offsetStartDTS(initData,fmp4,timeOffset){findBox(fmp4,["moof","traf"]).forEach((function(traf){findBox(traf,["tfhd"]).forEach((function(tfhd){var id=readUint32(tfhd,4),track=initData[id];if(track){var timescale=track.timescale||9e4;findBox(traf,["tfdt"]).forEach((function(tfdt){var version=tfdt[0],offset=timeOffset*timescale;if(offset){var baseMediaDecodeTime=readUint32(tfdt,4);if(0===version)baseMediaDecodeTime-=offset,writeUint32(tfdt,4,baseMediaDecodeTime=Math.max(baseMediaDecodeTime,0));else{baseMediaDecodeTime*=Math.pow(2,32),baseMediaDecodeTime+=readUint32(tfdt,8),baseMediaDecodeTime-=offset,baseMediaDecodeTime=Math.max(baseMediaDecodeTime,0);var upper=Math.floor(baseMediaDecodeTime/(UINT32_MAX$1+1)),lower=Math.floor(baseMediaDecodeTime%(UINT32_MAX$1+1));writeUint32(tfdt,4,upper),writeUint32(tfdt,8,lower)}}}))}}))}))}function segmentValidRange(data){var segmentedRange={valid:null,remainder:null},moofs=findBox(data,["moof"]);if(moofs.length<2)return segmentedRange.remainder=data,segmentedRange;var last=moofs[moofs.length-1];return segmentedRange.valid=sliceUint8(data,0,last.byteOffset-8),segmentedRange.remainder=sliceUint8(data,last.byteOffset-8),segmentedRange}function appendUint8Array(data1,data2){var temp=new Uint8Array(data1.length+data2.length);return temp.set(data1),temp.set(data2,data1.length),temp}function parseSamples(timeOffset,track){var seiSamples=[],videoData=track.samples,timescale=track.timescale,trackId=track.id,isHEVCFlavor=!1;return findBox(videoData,["moof"]).map((function(moof){var moofOffset=moof.byteOffset-8;findBox(moof,["traf"]).map((function(traf){var baseTime=findBox(traf,["tfdt"]).map((function(tfdt){var version=tfdt[0],result=readUint32(tfdt,4);return 1===version&&(result*=Math.pow(2,32),result+=readUint32(tfdt,8)),result/timescale}))[0];return void 0!==baseTime&&(timeOffset=baseTime),findBox(traf,["tfhd"]).map((function(tfhd){var id=readUint32(tfhd,4),tfhdFlags=16777215&readUint32(tfhd,0),defaultSampleDuration=0,defaultSampleSizePresent=0!=(16&tfhdFlags),defaultSampleSize=0,defaultSampleFlagsPresent=0!=(32&tfhdFlags),tfhdOffset=8;id===trackId&&(0!=(1&tfhdFlags)&&(tfhdOffset+=8),0!=(2&tfhdFlags)&&(tfhdOffset+=4),0!=(8&tfhdFlags)&&(defaultSampleDuration=readUint32(tfhd,tfhdOffset),tfhdOffset+=4),defaultSampleSizePresent&&(defaultSampleSize=readUint32(tfhd,tfhdOffset),tfhdOffset+=4),defaultSampleFlagsPresent&&(tfhdOffset+=4),"video"===track.type&&(isHEVCFlavor=isHEVC(track.codec)),findBox(traf,["trun"]).map((function(trun){var version=trun[0],flags=16777215&readUint32(trun,0),dataOffsetPresent=0!=(1&flags),dataOffset=0,firstSampleFlagsPresent=0!=(4&flags),sampleDurationPresent=0!=(256&flags),sampleDuration=0,sampleSizePresent=0!=(512&flags),sampleSize=0,sampleFlagsPresent=0!=(1024&flags),sampleCompositionOffsetsPresent=0!=(2048&flags),compositionOffset=0,sampleCount=readUint32(trun,4),trunOffset=8;dataOffsetPresent&&(dataOffset=readUint32(trun,trunOffset),trunOffset+=4),firstSampleFlagsPresent&&(trunOffset+=4);for(var sampleOffset=dataOffset+moofOffset,ix=0;ix<sampleCount;ix++){if(sampleDurationPresent?(sampleDuration=readUint32(trun,trunOffset),trunOffset+=4):sampleDuration=defaultSampleDuration,sampleSizePresent?(sampleSize=readUint32(trun,trunOffset),trunOffset+=4):sampleSize=defaultSampleSize,sampleFlagsPresent&&(trunOffset+=4),sampleCompositionOffsetsPresent&&(compositionOffset=0===version?readUint32(trun,trunOffset):readSint32(trun,trunOffset),trunOffset+=4),track.type===ElementaryStreamTypes.VIDEO)for(var naluTotalSize=0;naluTotalSize<sampleSize;){var naluSize=readUint32(videoData,sampleOffset);isSEIMessage(isHEVCFlavor,videoData[sampleOffset+=4])&&parseSEIMessageFromNALu(videoData.subarray(sampleOffset,sampleOffset+naluSize),isHEVCFlavor?2:1,timeOffset+compositionOffset/timescale,seiSamples),sampleOffset+=naluSize,naluTotalSize+=naluSize+4}timeOffset+=sampleDuration/timescale}})))}))}))})),seiSamples}function isHEVC(codec){if(!codec)return!1;var delimit=codec.indexOf("."),baseCodec=delimit<0?codec:codec.substring(0,delimit);return"hvc1"===baseCodec||"hev1"===baseCodec||"dvh1"===baseCodec||"dvhe"===baseCodec}function isSEIMessage(isHEVCFlavor,naluHeader){if(isHEVCFlavor){var naluType=naluHeader>>1&63;return 39===naluType||40===naluType}return 6==(31&naluHeader)}function parseSEIMessageFromNALu(unescapedData,headerSize,pts,samples){var data=discardEPB(unescapedData),seiPtr=0;seiPtr+=headerSize;for(var payloadType=0,payloadSize=0,b=0;seiPtr<data.length;){payloadType=0;do{if(seiPtr>=data.length)break;payloadType+=b=data[seiPtr++]}while(255===b);payloadSize=0;do{if(seiPtr>=data.length)break;payloadSize+=b=data[seiPtr++]}while(255===b);var leftOver=data.length-seiPtr,payPtr=seiPtr;if(payloadSize<leftOver)seiPtr+=payloadSize;else if(payloadSize>leftOver){logger.error("Malformed SEI payload. "+payloadSize+" is too small, only "+leftOver+" bytes left to parse.");break}if(4===payloadType){if(181===data[payPtr++]){var providerCode=readUint16(data,payPtr);if(payPtr+=2,49===providerCode){var userStructure=readUint32(data,payPtr);if(payPtr+=4,1195456820===userStructure){var userDataType=data[payPtr++];if(3===userDataType){var firstByte=data[payPtr++],enabled=64&firstByte,totalBytes=enabled?2+3*(31&firstByte):0,byteArray=new Uint8Array(totalBytes);if(enabled){byteArray[0]=firstByte;for(var i=1;i<totalBytes;i++)byteArray[i]=data[payPtr++]}samples.push({type:userDataType,payloadType:payloadType,pts:pts,bytes:byteArray})}}}}}else if(5===payloadType&&payloadSize>16){for(var uuidStrArray=[],_i3=0;_i3<16;_i3++){var _b=data[payPtr++].toString(16);uuidStrArray.push(1==_b.length?"0"+_b:_b),3!==_i3&&5!==_i3&&7!==_i3&&9!==_i3||uuidStrArray.push("-")}for(var length=payloadSize-16,userDataBytes=new Uint8Array(length),_i4=0;_i4<length;_i4++)userDataBytes[_i4]=data[payPtr++];samples.push({payloadType:payloadType,pts:pts,uuid:uuidStrArray.join(""),userData:utf8ArrayToStr(userDataBytes),userDataBytes:userDataBytes})}}}function discardEPB(data){for(var length=data.byteLength,EPBPositions=[],i=1;i<length-2;)0===data[i]&&0===data[i+1]&&3===data[i+2]?(EPBPositions.push(i+2),i+=2):i++;if(0===EPBPositions.length)return data;var newLength=length-EPBPositions.length,newData=new Uint8Array(newLength),sourceIndex=0;for(i=0;i<newLength;sourceIndex++,i++)sourceIndex===EPBPositions[0]&&(sourceIndex++,EPBPositions.shift()),newData[i]=data[sourceIndex];return newData}function parseEmsg(data){var version=data[0],schemeIdUri="",value="",timeScale=0,presentationTimeDelta=0,presentationTime=0,eventDuration=0,id=0,offset=0;if(0===version){for(;"\0"!==bin2str(data.subarray(offset,offset+1));)schemeIdUri+=bin2str(data.subarray(offset,offset+1)),offset+=1;for(schemeIdUri+=bin2str(data.subarray(offset,offset+1)),offset+=1;"\0"!==bin2str(data.subarray(offset,offset+1));)value+=bin2str(data.subarray(offset,offset+1)),offset+=1;value+=bin2str(data.subarray(offset,offset+1)),offset+=1,timeScale=readUint32(data,12),presentationTimeDelta=readUint32(data,16),eventDuration=readUint32(data,20),id=readUint32(data,24),offset=28}else if(1===version){timeScale=readUint32(data,offset+=4);var leftPresentationTime=readUint32(data,offset+=4),rightPresentationTime=readUint32(data,offset+=4);for(offset+=4,presentationTime=Math.pow(2,32)*leftPresentationTime+rightPresentationTime,isSafeInteger(presentationTime)||(presentationTime=Number.MAX_SAFE_INTEGER,logger.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),eventDuration=readUint32(data,offset),id=readUint32(data,offset+=4),offset+=4;"\0"!==bin2str(data.subarray(offset,offset+1));)schemeIdUri+=bin2str(data.subarray(offset,offset+1)),offset+=1;for(schemeIdUri+=bin2str(data.subarray(offset,offset+1)),offset+=1;"\0"!==bin2str(data.subarray(offset,offset+1));)value+=bin2str(data.subarray(offset,offset+1)),offset+=1;value+=bin2str(data.subarray(offset,offset+1)),offset+=1}return{schemeIdUri:schemeIdUri,value:value,timeScale:timeScale,presentationTime:presentationTime,presentationTimeDelta:presentationTimeDelta,eventDuration:eventDuration,id:id,payload:data.subarray(offset,data.byteLength)}}function mp4Box(type){for(var _len=arguments.length,payload=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)payload[_key-1]=arguments[_key];for(var len=payload.length,size=8,i=len;i--;)size+=payload[i].byteLength;var result=new Uint8Array(size);for(result[0]=size>>24&255,result[1]=size>>16&255,result[2]=size>>8&255,result[3]=255&size,result.set(type,4),i=0,size=8;i<len;i++)result.set(payload[i],size),size+=payload[i].byteLength;return result}function mp4pssh(systemId,keyids,data){if(16!==systemId.byteLength)throw new RangeError("Invalid system id");var version,kids,kidCount;if(keyids){version=1,kids=new Uint8Array(16*keyids.length);for(var ix=0;ix<keyids.length;ix++){var k=keyids[ix];if(16!==k.byteLength)throw new RangeError("Invalid key");kids.set(k,16*ix)}}else version=0,kids=new Uint8Array;version>0?(kidCount=new Uint8Array(4),keyids.length>0&&new DataView(kidCount.buffer).setUint32(0,keyids.length,!1)):kidCount=new Uint8Array;var dataSize=new Uint8Array(4);return data&&data.byteLength>0&&new DataView(dataSize.buffer).setUint32(0,data.byteLength,!1),mp4Box([112,115,115,104],new Uint8Array([version,0,0,0]),systemId,kidCount,kids,dataSize,data||new Uint8Array)}function parsePssh(initData){if(!(initData instanceof ArrayBuffer)||initData.byteLength<32)return null;var result={version:0,systemId:"",kids:null,data:null},view=new DataView(initData),boxSize=view.getUint32(0);if(initData.byteLength!==boxSize&&boxSize>44)return null;if(1886614376!==view.getUint32(4))return null;if(result.version=view.getUint32(8)>>>24,result.version>1)return null;result.systemId=Hex.hexDump(new Uint8Array(initData,12,16));var dataSizeOrKidCount=view.getUint32(28);if(0===result.version){if(boxSize-32<dataSizeOrKidCount)return null;result.data=new Uint8Array(initData,32,dataSizeOrKidCount)}else if(1===result.version){result.kids=[];for(var i=0;i<dataSizeOrKidCount;i++)result.kids.push(new Uint8Array(initData,32+16*i,16))}return result}var keyUriToKeyIdMap={},LevelKey=(function(){function LevelKey(method,uri,format,formatversions,iv){void 0===formatversions&&(formatversions=[1]),void 0===iv&&(iv=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=method,this.uri=uri,this.keyFormat=format,this.keyFormatVersions=formatversions,this.iv=iv,this.encrypted=!!method&&"NONE"!==method,this.isCommonEncryption=this.encrypted&&"AES-128"!==method}LevelKey.clearKeyUriToKeyIdMap=function(){keyUriToKeyIdMap={}};var _proto=LevelKey.prototype;return _proto.isSupported=function(){if(this.method){if("AES-128"===this.method||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case KeySystemFormats.FAIRPLAY:case KeySystemFormats.WIDEVINE:case KeySystemFormats.PLAYREADY:case KeySystemFormats.CLEARKEY:return-1!==["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1},_proto.getDecryptData=function(sn){if(!this.encrypted||!this.uri)return null;if("AES-128"===this.method&&this.uri&&!this.iv){"number"!=typeof sn&&("AES-128"!==this.method||this.iv||logger.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),sn=0);var iv=createInitializationVector(sn);return new LevelKey(this.method,this.uri,"identity",this.keyFormatVersions,iv)}var keyBytes=convertDataUriToArrayBytes(this.uri);if(keyBytes)switch(this.keyFormat){case KeySystemFormats.WIDEVINE:this.pssh=keyBytes,keyBytes.length>=22&&(this.keyId=keyBytes.subarray(keyBytes.length-22,keyBytes.length-6));break;case KeySystemFormats.PLAYREADY:var PlayReadyKeySystemUUID=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=mp4pssh(PlayReadyKeySystemUUID,null,keyBytes);var keyBytesUtf16=new Uint16Array(keyBytes.buffer,keyBytes.byteOffset,keyBytes.byteLength/2),keyByteStr=String.fromCharCode.apply(null,Array.from(keyBytesUtf16)),xmlKeyBytes=keyByteStr.substring(keyByteStr.indexOf("<"),keyByteStr.length),keyData=(new DOMParser).parseFromString(xmlKeyBytes,"text/xml").getElementsByTagName("KID")[0];if(keyData){var keyId=keyData.childNodes[0]?keyData.childNodes[0].nodeValue:keyData.getAttribute("VALUE");if(keyId){var keyIdArray=base64Decode(keyId).subarray(0,16);changeEndianness(keyIdArray),this.keyId=keyIdArray}}break;default:var keydata=keyBytes.subarray(0,16);if(16!==keydata.length){var padded=new Uint8Array(16);padded.set(keydata,16-keydata.length),keydata=padded}this.keyId=keydata}if(!this.keyId||16!==this.keyId.byteLength){var _keyId=keyUriToKeyIdMap[this.uri];if(!_keyId){var val=Object.keys(keyUriToKeyIdMap).length%Number.MAX_SAFE_INTEGER;_keyId=new Uint8Array(16),new DataView(_keyId.buffer,12,4).setUint32(0,val),keyUriToKeyIdMap[this.uri]=_keyId}this.keyId=_keyId}return this},LevelKey})();function createInitializationVector(segmentNumber){for(var uint8View=new Uint8Array(16),i=12;i<16;i++)uint8View[i]=segmentNumber>>8*(15-i)&255;return uint8View}var VARIABLE_REPLACEMENT_REGEX=/\{\$([a-zA-Z0-9-_]+)\}/g;function hasVariableReferences(str){return VARIABLE_REPLACEMENT_REGEX.test(str)}function substituteVariablesInAttributes(parsed,attr,attributeNames){if(null!==parsed.variableList||parsed.hasVariableRefs)for(var i=attributeNames.length;i--;){var name=attributeNames[i],value=attr[name];value&&(attr[name]=substituteVariables(parsed,value))}}function substituteVariables(parsed,value){if(null!==parsed.variableList||parsed.hasVariableRefs){var variableList=parsed.variableList;return value.replace(VARIABLE_REPLACEMENT_REGEX,(function(variableReference){var variableName=variableReference.substring(2,variableReference.length-1),variableValue=null==variableList?void 0:variableList[variableName];return void 0===variableValue?(parsed.playlistParsingError||(parsed.playlistParsingError=new Error('Missing preceding EXT-X-DEFINE tag for Variable Reference: "'+variableName+'"')),variableReference):variableValue}))}return value}function addVariableDefinition(parsed,attr,parentUrl){var NAME,VALUE,variableList=parsed.variableList;if(variableList||(parsed.variableList=variableList={}),"QUERYPARAM"in attr){NAME=attr.QUERYPARAM;try{var searchParams=new self.URL(parentUrl).searchParams;if(!searchParams.has(NAME))throw new Error('"'+NAME+'" does not match any query parameter in URI: "'+parentUrl+'"');VALUE=searchParams.get(NAME)}catch(error){parsed.playlistParsingError||(parsed.playlistParsingError=new Error("EXT-X-DEFINE QUERYPARAM: "+error.message))}}else NAME=attr.NAME,VALUE=attr.VALUE;NAME in variableList?parsed.playlistParsingError||(parsed.playlistParsingError=new Error('EXT-X-DEFINE duplicate Variable Name declarations: "'+NAME+'"')):variableList[NAME]=VALUE||""}function importVariableDefinition(parsed,attr,sourceVariableList){var IMPORT=attr.IMPORT;if(sourceVariableList&&IMPORT in sourceVariableList){var variableList=parsed.variableList;variableList||(parsed.variableList=variableList={}),variableList[IMPORT]=sourceVariableList[IMPORT]}else parsed.playlistParsingError||(parsed.playlistParsingError=new Error('EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "'+IMPORT+'"'))}function getMediaSource(preferManagedMediaSource){if(void 0===preferManagedMediaSource&&(preferManagedMediaSource=!0),"undefined"!=typeof self)return(preferManagedMediaSource||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}var sampleEntryCodesISO={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function isCodecType(codec,type){var typeCodes=sampleEntryCodesISO[type];return!!typeCodes&&!!typeCodes[codec.slice(0,4)]}function areCodecsMediaSourceSupported(codecs,type,preferManagedMediaSource){return void 0===preferManagedMediaSource&&(preferManagedMediaSource=!0),!codecs.split(",").some((function(codec){return!isCodecMediaSourceSupported(codec,type,preferManagedMediaSource)}))}function isCodecMediaSourceSupported(codec,type,preferManagedMediaSource){var _MediaSource$isTypeSu;void 0===preferManagedMediaSource&&(preferManagedMediaSource=!0);var MediaSource=getMediaSource(preferManagedMediaSource);return null!=(_MediaSource$isTypeSu=null==MediaSource?void 0:MediaSource.isTypeSupported(mimeTypeForCodec(codec,type)))&&_MediaSource$isTypeSu}function mimeTypeForCodec(codec,type){return type+'/mp4;codecs="'+codec+'"'}function videoCodecPreferenceValue(videoCodec){if(videoCodec){var fourCC=videoCodec.substring(0,4);return sampleEntryCodesISO.video[fourCC]}return 2}function codecsSetSelectionPreferenceValue(codecSet){return codecSet.split(",").reduce((function(num,fourCC){var preferenceValue=sampleEntryCodesISO.video[fourCC];return preferenceValue?(2*preferenceValue+num)/(num?3:2):(sampleEntryCodesISO.audio[fourCC]+num)/(num?2:1)}),0)}var CODEC_COMPATIBLE_NAMES={};function getCodecCompatibleNameLower(lowerCaseCodec,preferManagedMediaSource){if(void 0===preferManagedMediaSource&&(preferManagedMediaSource=!0),CODEC_COMPATIBLE_NAMES[lowerCaseCodec])return CODEC_COMPATIBLE_NAMES[lowerCaseCodec];for(var codecsToCheck={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"]}[lowerCaseCodec],i=0;i<codecsToCheck.length;i++)if(isCodecMediaSourceSupported(codecsToCheck[i],"audio",preferManagedMediaSource))return CODEC_COMPATIBLE_NAMES[lowerCaseCodec]=codecsToCheck[i],codecsToCheck[i];return lowerCaseCodec}var AUDIO_CODEC_REGEXP=/flac|opus/i;function getCodecCompatibleName(codec,preferManagedMediaSource){return void 0===preferManagedMediaSource&&(preferManagedMediaSource=!0),codec.replace(AUDIO_CODEC_REGEXP,(function(m){return getCodecCompatibleNameLower(m.toLowerCase(),preferManagedMediaSource)}))}function pickMostCompleteCodecName(parsedCodec,levelCodec){return parsedCodec&&"mp4a"!==parsedCodec?parsedCodec:levelCodec}function convertAVC1ToAVCOTI(codec){var avcdata=codec.split(".");if(avcdata.length>2){var result=avcdata.shift()+".";return result+=parseInt(avcdata.shift()).toString(16),result+=("000"+parseInt(avcdata.shift()).toString(16)).slice(-4)}return codec}var MASTER_PLAYLIST_REGEX=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,MASTER_PLAYLIST_MEDIA_REGEX=/#EXT-X-MEDIA:(.*)/g,IS_MEDIA_PLAYLIST=/^#EXT(?:INF|-X-TARGETDURATION):/m,LEVEL_PLAYLIST_REGEX_FAST=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),LEVEL_PLAYLIST_REGEX_SLOW=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),M3U8Parser=(function(){function M3U8Parser(){}return M3U8Parser.findGroup=function(groups,mediaGroupId){for(var i=0;i<groups.length;i++){var group=groups[i];if(group.id===mediaGroupId)return group}},M3U8Parser.resolve=function(url,baseUrl){return urlToolkitExports.buildAbsoluteURL(baseUrl,url,{alwaysNormalize:!0})},M3U8Parser.isMediaPlaylist=function(str){return IS_MEDIA_PLAYLIST.test(str)},M3U8Parser.parseMasterPlaylist=function(string,baseurl){var result,parsed={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:hasVariableReferences(string)},levelsWithKnownCodecs=[];for(MASTER_PLAYLIST_REGEX.lastIndex=0;null!=(result=MASTER_PLAYLIST_REGEX.exec(string));)if(result[1]){var _level$unknownCodecs,attrs=new AttrList(result[1]);substituteVariablesInAttributes(parsed,attrs,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);var uri=substituteVariables(parsed,result[2]),level={attrs:attrs,bitrate:attrs.decimalInteger("BANDWIDTH")||attrs.decimalInteger("AVERAGE-BANDWIDTH"),name:attrs.NAME,url:M3U8Parser.resolve(uri,baseurl)},resolution=attrs.decimalResolution("RESOLUTION");resolution&&(level.width=resolution.width,level.height=resolution.height),setCodecs(attrs.CODECS,level),null!=(_level$unknownCodecs=level.unknownCodecs)&&_level$unknownCodecs.length||levelsWithKnownCodecs.push(level),parsed.levels.push(level)}else if(result[3]){var tag=result[3],attributes=result[4];switch(tag){case"SESSION-DATA":var sessionAttrs=new AttrList(attributes);substituteVariablesInAttributes(parsed,sessionAttrs,["DATA-ID","LANGUAGE","VALUE","URI"]);var dataId=sessionAttrs["DATA-ID"];dataId&&(null===parsed.sessionData&&(parsed.sessionData={}),parsed.sessionData[dataId]=sessionAttrs);break;case"SESSION-KEY":var sessionKey=parseKey(attributes,baseurl,parsed);sessionKey.encrypted&&sessionKey.isSupported()?(null===parsed.sessionKeys&&(parsed.sessionKeys=[]),parsed.sessionKeys.push(sessionKey)):logger.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+attributes+'"');break;case"DEFINE":var variableAttributes=new AttrList(attributes);substituteVariablesInAttributes(parsed,variableAttributes,["NAME","VALUE","QUERYPARAM"]),addVariableDefinition(parsed,variableAttributes,baseurl);break;case"CONTENT-STEERING":var contentSteeringAttributes=new AttrList(attributes);substituteVariablesInAttributes(parsed,contentSteeringAttributes,["SERVER-URI","PATHWAY-ID"]),parsed.contentSteering={uri:M3U8Parser.resolve(contentSteeringAttributes["SERVER-URI"],baseurl),pathwayId:contentSteeringAttributes["PATHWAY-ID"]||"."};break;case"START":parsed.startTimeOffset=parseStartTimeOffset(attributes)}}var stripUnknownCodecLevels=levelsWithKnownCodecs.length>0&&levelsWithKnownCodecs.length<parsed.levels.length;return parsed.levels=stripUnknownCodecLevels?levelsWithKnownCodecs:parsed.levels,0===parsed.levels.length&&(parsed.playlistParsingError=new Error("no levels found in manifest")),parsed},M3U8Parser.parseMasterPlaylistMedia=function(string,baseurl,parsed){var result,results={},levels=parsed.levels,groupsByType={AUDIO:levels.map((function(level){return{id:level.attrs.AUDIO,audioCodec:level.audioCodec}})),SUBTITLES:levels.map((function(level){return{id:level.attrs.SUBTITLES,textCodec:level.textCodec}})),"CLOSED-CAPTIONS":[]},id=0;for(MASTER_PLAYLIST_MEDIA_REGEX.lastIndex=0;null!==(result=MASTER_PLAYLIST_MEDIA_REGEX.exec(string));){var attrs=new AttrList(result[1]),type=attrs.TYPE;if(type){var groups=groupsByType[type],medias=results[type]||[];results[type]=medias,substituteVariablesInAttributes(parsed,attrs,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);var lang=attrs.LANGUAGE,assocLang=attrs["ASSOC-LANGUAGE"],channels=attrs.CHANNELS,characteristics=attrs.CHARACTERISTICS,instreamId=attrs["INSTREAM-ID"],media={attrs:attrs,bitrate:0,id:id++,groupId:attrs["GROUP-ID"]||"",name:attrs.NAME||lang||"",type:type,default:attrs.bool("DEFAULT"),autoselect:attrs.bool("AUTOSELECT"),forced:attrs.bool("FORCED"),lang:lang,url:attrs.URI?M3U8Parser.resolve(attrs.URI,baseurl):""};if(assocLang&&(media.assocLang=assocLang),channels&&(media.channels=channels),characteristics&&(media.characteristics=characteristics),instreamId&&(media.instreamId=instreamId),null!=groups&&groups.length){var groupCodec=M3U8Parser.findGroup(groups,media.groupId)||groups[0];assignCodec(media,groupCodec,"audioCodec"),assignCodec(media,groupCodec,"textCodec")}medias.push(media)}}return results},M3U8Parser.parseLevelPlaylist=function(string,baseurl,id,type,levelUrlId,multivariantVariableList){var result,i,levelkeys,level=new LevelDetails(baseurl),fragments=level.fragments,currentInitSegment=null,currentSN=0,currentPart=0,totalduration=0,discontinuityCounter=0,prevFrag=null,frag=new Fragment(type,baseurl),firstPdtIndex=-1,createNextFrag=!1,nextByteRange=null;for(LEVEL_PLAYLIST_REGEX_FAST.lastIndex=0,level.m3u8=string,level.hasVariableRefs=hasVariableReferences(string);null!==(result=LEVEL_PLAYLIST_REGEX_FAST.exec(string));){createNextFrag&&(createNextFrag=!1,(frag=new Fragment(type,baseurl)).start=totalduration,frag.sn=currentSN,frag.cc=discontinuityCounter,frag.level=id,currentInitSegment&&(frag.initSegment=currentInitSegment,frag.rawProgramDateTime=currentInitSegment.rawProgramDateTime,currentInitSegment.rawProgramDateTime=null,nextByteRange&&(frag.setByteRange(nextByteRange),nextByteRange=null)));var duration=result[1];if(duration){frag.duration=parseFloat(duration);var title=(" "+result[2]).slice(1);frag.title=title||null,frag.tagList.push(title?["INF",duration,title]:["INF",duration])}else if(result[3]){if(isFiniteNumber(frag.duration)){frag.start=totalduration,levelkeys&&setFragLevelKeys(frag,levelkeys,level),frag.sn=currentSN,frag.level=id,frag.cc=discontinuityCounter,fragments.push(frag);var uri=(" "+result[3]).slice(1);frag.relurl=substituteVariables(level,uri),assignProgramDateTime(frag,prevFrag),prevFrag=frag,totalduration+=frag.duration,currentSN++,currentPart=0,createNextFrag=!0}}else if(result[4]){var data=(" "+result[4]).slice(1);prevFrag?frag.setByteRange(data,prevFrag):frag.setByteRange(data)}else if(result[5])frag.rawProgramDateTime=(" "+result[5]).slice(1),frag.tagList.push(["PROGRAM-DATE-TIME",frag.rawProgramDateTime]),-1===firstPdtIndex&&(firstPdtIndex=fragments.length);else{if(!(result=result[0].match(LEVEL_PLAYLIST_REGEX_SLOW))){logger.warn("No matches on slow regex match for level playlist!");continue}for(i=1;i<result.length&&void 0===result[i];i++);var tag=(" "+result[i]).slice(1),value1=(" "+result[i+1]).slice(1),value2=result[i+2]?(" "+result[i+2]).slice(1):"";switch(tag){case"PLAYLIST-TYPE":level.type=value1.toUpperCase();break;case"MEDIA-SEQUENCE":currentSN=level.startSN=parseInt(value1);break;case"SKIP":var skipAttrs=new AttrList(value1);substituteVariablesInAttributes(level,skipAttrs,["RECENTLY-REMOVED-DATERANGES"]);var skippedSegments=skipAttrs.decimalInteger("SKIPPED-SEGMENTS");if(isFiniteNumber(skippedSegments)){level.skippedSegments=skippedSegments;for(var _i=skippedSegments;_i--;)fragments.unshift(null);currentSN+=skippedSegments}var recentlyRemovedDateranges=skipAttrs.enumeratedString("RECENTLY-REMOVED-DATERANGES");recentlyRemovedDateranges&&(level.recentlyRemovedDateranges=recentlyRemovedDateranges.split("\t"));break;case"TARGETDURATION":level.targetduration=Math.max(parseInt(value1),1);break;case"VERSION":level.version=parseInt(value1);break;case"INDEPENDENT-SEGMENTS":case"EXTM3U":break;case"ENDLIST":level.live=!1;break;case"#":(value1||value2)&&frag.tagList.push(value2?[value1,value2]:[value1]);break;case"DISCONTINUITY":discontinuityCounter++,frag.tagList.push(["DIS"]);break;case"GAP":frag.gap=!0,frag.tagList.push([tag]);break;case"BITRATE":frag.tagList.push([tag,value1]);break;case"DATERANGE":var dateRangeAttr=new AttrList(value1);substituteVariablesInAttributes(level,dateRangeAttr,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),substituteVariablesInAttributes(level,dateRangeAttr,dateRangeAttr.clientAttrs);var dateRange=new DateRange(dateRangeAttr,level.dateRanges[dateRangeAttr.ID]);dateRange.isValid||level.skippedSegments?level.dateRanges[dateRange.id]=dateRange:logger.warn('Ignoring invalid DATERANGE tag: "'+value1+'"'),frag.tagList.push(["EXT-X-DATERANGE",value1]);break;case"DEFINE":var variableAttributes=new AttrList(value1);substituteVariablesInAttributes(level,variableAttributes,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in variableAttributes?importVariableDefinition(level,variableAttributes,multivariantVariableList):addVariableDefinition(level,variableAttributes,baseurl);break;case"DISCONTINUITY-SEQUENCE":discontinuityCounter=parseInt(value1);break;case"KEY":var levelKey=parseKey(value1,baseurl,level);if(levelKey.isSupported()){if("NONE"===levelKey.method){levelkeys=void 0;break}levelkeys||(levelkeys={}),levelkeys[levelKey.keyFormat]&&(levelkeys=_extends({},levelkeys)),levelkeys[levelKey.keyFormat]=levelKey}else logger.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+value1+'"');break;case"START":level.startTimeOffset=parseStartTimeOffset(value1);break;case"MAP":var mapAttrs=new AttrList(value1);if(substituteVariablesInAttributes(level,mapAttrs,["BYTERANGE","URI"]),frag.duration){var init=new Fragment(type,baseurl);setInitSegment(init,mapAttrs,id,levelkeys),currentInitSegment=init,frag.initSegment=currentInitSegment,currentInitSegment.rawProgramDateTime&&!frag.rawProgramDateTime&&(frag.rawProgramDateTime=currentInitSegment.rawProgramDateTime)}else{var end=frag.byteRangeEndOffset;if(end){var start=frag.byteRangeStartOffset;nextByteRange=end-start+"@"+start}else nextByteRange=null;setInitSegment(frag,mapAttrs,id,levelkeys),currentInitSegment=frag,createNextFrag=!0}break;case"SERVER-CONTROL":var serverControlAttrs=new AttrList(value1);level.canBlockReload=serverControlAttrs.bool("CAN-BLOCK-RELOAD"),level.canSkipUntil=serverControlAttrs.optionalFloat("CAN-SKIP-UNTIL",0),level.canSkipDateRanges=level.canSkipUntil>0&&serverControlAttrs.bool("CAN-SKIP-DATERANGES"),level.partHoldBack=serverControlAttrs.optionalFloat("PART-HOLD-BACK",0),level.holdBack=serverControlAttrs.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var partInfAttrs=new AttrList(value1);level.partTarget=partInfAttrs.decimalFloatingPoint("PART-TARGET");break;case"PART":var partList=level.partList;partList||(partList=level.partList=[]);var previousFragmentPart=currentPart>0?partList[partList.length-1]:void 0,index=currentPart++,partAttrs=new AttrList(value1);substituteVariablesInAttributes(level,partAttrs,["BYTERANGE","URI"]);var part=new Part(partAttrs,frag,baseurl,index,previousFragmentPart);partList.push(part),frag.duration+=part.duration;break;case"PRELOAD-HINT":var preloadHintAttrs=new AttrList(value1);substituteVariablesInAttributes(level,preloadHintAttrs,["URI"]),level.preloadHint=preloadHintAttrs;break;case"RENDITION-REPORT":var renditionReportAttrs=new AttrList(value1);substituteVariablesInAttributes(level,renditionReportAttrs,["URI"]),level.renditionReports=level.renditionReports||[],level.renditionReports.push(renditionReportAttrs);break;default:logger.warn("line parsed but not handled: "+result)}}}prevFrag&&!prevFrag.relurl?(fragments.pop(),totalduration-=prevFrag.duration,level.partList&&(level.fragmentHint=prevFrag)):level.partList&&(assignProgramDateTime(frag,prevFrag),frag.cc=discontinuityCounter,level.fragmentHint=frag,levelkeys&&setFragLevelKeys(frag,levelkeys,level));var fragmentLength=fragments.length,firstFragment=fragments[0],lastFragment=fragments[fragmentLength-1];if((totalduration+=level.skippedSegments*level.targetduration)>0&&fragmentLength&&lastFragment){level.averagetargetduration=totalduration/fragmentLength;var lastSn=lastFragment.sn;level.endSN="initSegment"!==lastSn?lastSn:0,level.live||(lastFragment.endList=!0),firstFragment&&(level.startCC=firstFragment.cc)}else level.endSN=0,level.startCC=0;return level.fragmentHint&&(totalduration+=level.fragmentHint.duration),level.totalduration=totalduration,level.endCC=discontinuityCounter,firstPdtIndex>0&&backfillProgramDateTimes(fragments,firstPdtIndex),level},M3U8Parser})();function parseKey(keyTagAttributes,baseurl,parsed){var _keyAttrs$METHOD,_keyAttrs$KEYFORMAT,keyAttrs=new AttrList(keyTagAttributes);substituteVariablesInAttributes(parsed,keyAttrs,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);var decryptmethod=null!=(_keyAttrs$METHOD=keyAttrs.METHOD)?_keyAttrs$METHOD:"",decrypturi=keyAttrs.URI,decryptiv=keyAttrs.hexadecimalInteger("IV"),decryptkeyformatversions=keyAttrs.KEYFORMATVERSIONS,decryptkeyformat=null!=(_keyAttrs$KEYFORMAT=keyAttrs.KEYFORMAT)?_keyAttrs$KEYFORMAT:"identity";decrypturi&&keyAttrs.IV&&!decryptiv&&logger.error("Invalid IV: "+keyAttrs.IV);var resolvedUri=decrypturi?M3U8Parser.resolve(decrypturi,baseurl):"",keyFormatVersions=(decryptkeyformatversions||"1").split("/").map(Number).filter(Number.isFinite);return new LevelKey(decryptmethod,resolvedUri,decryptkeyformat,keyFormatVersions,decryptiv)}function parseStartTimeOffset(startAttributes){var startTimeOffset=new AttrList(startAttributes).decimalFloatingPoint("TIME-OFFSET");return isFiniteNumber(startTimeOffset)?startTimeOffset:null}function setCodecs(codecsAttributeValue,level){var codecs=(codecsAttributeValue||"").split(/[ ,]+/).filter((function(c){return c}));["video","audio","text"].forEach((function(type){var filtered=codecs.filter((function(codec){return isCodecType(codec,type)}));filtered.length&&(level[type+"Codec"]=filtered.join(","),codecs=codecs.filter((function(codec){return-1===filtered.indexOf(codec)})))})),level.unknownCodecs=codecs}function assignCodec(media,groupItem,codecProperty){var codecValue=groupItem[codecProperty];codecValue&&(media[codecProperty]=codecValue)}function backfillProgramDateTimes(fragments,firstPdtIndex){for(var fragPrev=fragments[firstPdtIndex],i=firstPdtIndex;i--;){var frag=fragments[i];if(!frag)return;frag.programDateTime=fragPrev.programDateTime-1e3*frag.duration,fragPrev=frag}}function assignProgramDateTime(frag,prevFrag){frag.rawProgramDateTime?frag.programDateTime=Date.parse(frag.rawProgramDateTime):null!=prevFrag&&prevFrag.programDateTime&&(frag.programDateTime=prevFrag.endProgramDateTime),isFiniteNumber(frag.programDateTime)||(frag.programDateTime=null,frag.rawProgramDateTime=null)}function setInitSegment(frag,mapAttrs,id,levelkeys){frag.relurl=mapAttrs.URI,mapAttrs.BYTERANGE&&frag.setByteRange(mapAttrs.BYTERANGE),frag.level=id,frag.sn="initSegment",levelkeys&&(frag.levelkeys=levelkeys),frag.initSegment=null}function setFragLevelKeys(frag,levelkeys,level){frag.levelkeys=levelkeys;var encryptedFragments=level.encryptedFragments;encryptedFragments.length&&encryptedFragments[encryptedFragments.length-1].levelkeys===levelkeys||!Object.keys(levelkeys).some((function(format){return levelkeys[format].isCommonEncryption}))||encryptedFragments.push(frag)}var PlaylistContextType={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},PlaylistLevelType={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function mapContextToLevelType(context){switch(context.type){case PlaylistContextType.AUDIO_TRACK:return PlaylistLevelType.AUDIO;case PlaylistContextType.SUBTITLE_TRACK:return PlaylistLevelType.SUBTITLE;default:return PlaylistLevelType.MAIN}}function getResponseUrl(response,context){var url=response.url;return void 0!==url&&0!==url.indexOf("data:")||(url=context.url),url}var PlaylistLoader=(function(){function PlaylistLoader(hls){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=hls,this.registerListeners()}var _proto=PlaylistLoader.prototype;return _proto.startLoad=function(startPosition){},_proto.stopLoad=function(){this.destroyInternalLoaders()},_proto.registerListeners=function(){var hls=this.hls;hls.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),hls.on(Events.LEVEL_LOADING,this.onLevelLoading,this),hls.on(Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),hls.on(Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},_proto.unregisterListeners=function(){var hls=this.hls;hls.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),hls.off(Events.LEVEL_LOADING,this.onLevelLoading,this),hls.off(Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),hls.off(Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},_proto.createInternalLoader=function(context){var config=this.hls.config,PLoader=config.pLoader,Loader=config.loader,loader=new(PLoader||Loader)(config);return this.loaders[context.type]=loader,loader},_proto.getInternalLoader=function(context){return this.loaders[context.type]},_proto.resetInternalLoader=function(contextType){this.loaders[contextType]&&delete this.loaders[contextType]},_proto.destroyInternalLoaders=function(){for(var contextType in this.loaders){var loader=this.loaders[contextType];loader&&loader.destroy(),this.resetInternalLoader(contextType)}},_proto.destroy=function(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()},_proto.onManifestLoading=function(event,data){var url=data.url;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:PlaylistContextType.MANIFEST,url:url,deliveryDirectives:null})},_proto.onLevelLoading=function(event,data){var id=data.id,level=data.level,pathwayId=data.pathwayId,url=data.url,deliveryDirectives=data.deliveryDirectives;this.load({id:id,level:level,pathwayId:pathwayId,responseType:"text",type:PlaylistContextType.LEVEL,url:url,deliveryDirectives:deliveryDirectives})},_proto.onAudioTrackLoading=function(event,data){var id=data.id,groupId=data.groupId,url=data.url,deliveryDirectives=data.deliveryDirectives;this.load({id:id,groupId:groupId,level:null,responseType:"text",type:PlaylistContextType.AUDIO_TRACK,url:url,deliveryDirectives:deliveryDirectives})},_proto.onSubtitleTrackLoading=function(event,data){var id=data.id,groupId=data.groupId,url=data.url,deliveryDirectives=data.deliveryDirectives;this.load({id:id,groupId:groupId,level:null,responseType:"text",type:PlaylistContextType.SUBTITLE_TRACK,url:url,deliveryDirectives:deliveryDirectives})},_proto.load=function(context){var _context$deliveryDire,loadPolicy,levelDetails,_this=this,config=this.hls.config,loader=this.getInternalLoader(context);if(loader){var loaderContext=loader.context;if(loaderContext&&loaderContext.url===context.url&&loaderContext.level===context.level)return void logger.trace("[playlist-loader]: playlist request ongoing");logger.log("[playlist-loader]: aborting previous loader for type: "+context.type),loader.abort()}if(loadPolicy=context.type===PlaylistContextType.MANIFEST?config.manifestLoadPolicy.default:_extends({},config.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),loader=this.createInternalLoader(context),isFiniteNumber(null==(_context$deliveryDire=context.deliveryDirectives)?void 0:_context$deliveryDire.part)&&(context.type===PlaylistContextType.LEVEL&&null!==context.level?levelDetails=this.hls.levels[context.level].details:context.type===PlaylistContextType.AUDIO_TRACK&&null!==context.id?levelDetails=this.hls.audioTracks[context.id].details:context.type===PlaylistContextType.SUBTITLE_TRACK&&null!==context.id&&(levelDetails=this.hls.subtitleTracks[context.id].details),levelDetails)){var partTarget=levelDetails.partTarget,targetDuration=levelDetails.targetduration;if(partTarget&&targetDuration){var maxLowLatencyPlaylistRefresh=1e3*Math.max(3*partTarget,.8*targetDuration);loadPolicy=_extends({},loadPolicy,{maxTimeToFirstByteMs:Math.min(maxLowLatencyPlaylistRefresh,loadPolicy.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(maxLowLatencyPlaylistRefresh,loadPolicy.maxTimeToFirstByteMs)})}}var legacyRetryCompatibility=loadPolicy.errorRetry||loadPolicy.timeoutRetry||{},loaderConfig={loadPolicy:loadPolicy,timeout:loadPolicy.maxLoadTimeMs,maxRetry:legacyRetryCompatibility.maxNumRetry||0,retryDelay:legacyRetryCompatibility.retryDelayMs||0,maxRetryDelay:legacyRetryCompatibility.maxRetryDelayMs||0},loaderCallbacks={onSuccess:function(response,stats,context,networkDetails){var loader=_this.getInternalLoader(context);_this.resetInternalLoader(context.type);var string=response.data;0===string.indexOf("#EXTM3U")?(stats.parsing.start=performance.now(),M3U8Parser.isMediaPlaylist(string)?_this.handleTrackOrLevelPlaylist(response,stats,context,networkDetails||null,loader):_this.handleMasterPlaylist(response,stats,context,networkDetails)):_this.handleManifestParsingError(response,context,new Error("no EXTM3U delimiter"),networkDetails||null,stats)},onError:function(response,context,networkDetails,stats){_this.handleNetworkError(context,networkDetails,!1,response,stats)},onTimeout:function(stats,context,networkDetails){_this.handleNetworkError(context,networkDetails,!0,void 0,stats)}};loader.load(context,loaderConfig,loaderCallbacks)},_proto.handleMasterPlaylist=function(response,stats,context,networkDetails){var hls=this.hls,string=response.data,url=getResponseUrl(response,context),parsedResult=M3U8Parser.parseMasterPlaylist(string,url);if(parsedResult.playlistParsingError)this.handleManifestParsingError(response,context,parsedResult.playlistParsingError,networkDetails,stats);else{var contentSteering=parsedResult.contentSteering,levels=parsedResult.levels,sessionData=parsedResult.sessionData,sessionKeys=parsedResult.sessionKeys,startTimeOffset=parsedResult.startTimeOffset,variableList=parsedResult.variableList;this.variableList=variableList;var _M3U8Parser$parseMast=M3U8Parser.parseMasterPlaylistMedia(string,url,parsedResult),_M3U8Parser$parseMast2=_M3U8Parser$parseMast.AUDIO,audioTracks=void 0===_M3U8Parser$parseMast2?[]:_M3U8Parser$parseMast2,subtitles=_M3U8Parser$parseMast.SUBTITLES,captions=_M3U8Parser$parseMast["CLOSED-CAPTIONS"];audioTracks.length&&(audioTracks.some((function(audioTrack){return!audioTrack.url}))||!levels[0].audioCodec||levels[0].attrs.AUDIO||(logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),audioTracks.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new AttrList({}),bitrate:0,url:""}))),hls.trigger(Events.MANIFEST_LOADED,{levels:levels,audioTracks:audioTracks,subtitles:subtitles,captions:captions,contentSteering:contentSteering,url:url,stats:stats,networkDetails:networkDetails,sessionData:sessionData,sessionKeys:sessionKeys,startTimeOffset:startTimeOffset,variableList:variableList})}},_proto.handleTrackOrLevelPlaylist=function(response,stats,context,networkDetails,loader){var hls=this.hls,id=context.id,level=context.level,type=context.type,url=getResponseUrl(response,context),levelUrlId=0,levelId=isFiniteNumber(level)?level:isFiniteNumber(id)?id:0,levelType=mapContextToLevelType(context),levelDetails=M3U8Parser.parseLevelPlaylist(response.data,url,levelId,levelType,levelUrlId,this.variableList);if(type===PlaylistContextType.MANIFEST){var singleLevel={attrs:new AttrList({}),bitrate:0,details:levelDetails,name:"",url:url};hls.trigger(Events.MANIFEST_LOADED,{levels:[singleLevel],audioTracks:[],url:url,stats:stats,networkDetails:networkDetails,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}stats.parsing.end=performance.now(),context.levelDetails=levelDetails,this.handlePlaylistLoaded(levelDetails,response,stats,context,networkDetails,loader)},_proto.handleManifestParsingError=function(response,context,error,networkDetails,stats){this.hls.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.MANIFEST_PARSING_ERROR,fatal:context.type===PlaylistContextType.MANIFEST,url:response.url,err:error,error:error,reason:error.message,response:response,context:context,networkDetails:networkDetails,stats:stats})},_proto.handleNetworkError=function(context,networkDetails,timeout,response,stats){void 0===timeout&&(timeout=!1);var message="A network "+(timeout?"timeout":"error"+(response?" (status "+response.code+")":""))+" occurred while loading "+context.type;context.type===PlaylistContextType.LEVEL?message+=": "+context.level+" id: "+context.id:context.type!==PlaylistContextType.AUDIO_TRACK&&context.type!==PlaylistContextType.SUBTITLE_TRACK||(message+=" id: "+context.id+' group-id: "'+context.groupId+'"');var error=new Error(message);logger.warn("[playlist-loader]: "+message);var details=ErrorDetails.UNKNOWN,fatal=!1,loader=this.getInternalLoader(context);switch(context.type){case PlaylistContextType.MANIFEST:details=timeout?ErrorDetails.MANIFEST_LOAD_TIMEOUT:ErrorDetails.MANIFEST_LOAD_ERROR,fatal=!0;break;case PlaylistContextType.LEVEL:details=timeout?ErrorDetails.LEVEL_LOAD_TIMEOUT:ErrorDetails.LEVEL_LOAD_ERROR,fatal=!1;break;case PlaylistContextType.AUDIO_TRACK:details=timeout?ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal=!1;break;case PlaylistContextType.SUBTITLE_TRACK:details=timeout?ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:ErrorDetails.SUBTITLE_LOAD_ERROR,fatal=!1}loader&&this.resetInternalLoader(context.type);var errorData={type:ErrorTypes.NETWORK_ERROR,details:details,fatal:fatal,url:context.url,loader:loader,context:context,error:error,networkDetails:networkDetails,stats:stats};if(response){var url=(null==networkDetails?void 0:networkDetails.url)||context.url;errorData.response=_objectSpread2({url:url,data:void 0},response)}this.hls.trigger(Events.ERROR,errorData)},_proto.handlePlaylistLoaded=function(levelDetails,response,stats,context,networkDetails,loader){var hls=this.hls,type=context.type,level=context.level,id=context.id,groupId=context.groupId,deliveryDirectives=context.deliveryDirectives,url=getResponseUrl(response,context),parent=mapContextToLevelType(context),levelIndex="number"==typeof context.level&&parent===PlaylistLevelType.MAIN?level:void 0;if(levelDetails.fragments.length){levelDetails.targetduration||(levelDetails.playlistParsingError=new Error("Missing Target Duration"));var error=levelDetails.playlistParsingError;if(error)hls.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.LEVEL_PARSING_ERROR,fatal:!1,url:url,error:error,reason:error.message,response:response,context:context,level:levelIndex,parent:parent,networkDetails:networkDetails,stats:stats});else switch(levelDetails.live&&loader&&(loader.getCacheAge&&(levelDetails.ageHeader=loader.getCacheAge()||0),loader.getCacheAge&&!isNaN(levelDetails.ageHeader)||(levelDetails.ageHeader=0)),type){case PlaylistContextType.MANIFEST:case PlaylistContextType.LEVEL:hls.trigger(Events.LEVEL_LOADED,{details:levelDetails,level:levelIndex||0,id:id||0,stats:stats,networkDetails:networkDetails,deliveryDirectives:deliveryDirectives});break;case PlaylistContextType.AUDIO_TRACK:hls.trigger(Events.AUDIO_TRACK_LOADED,{details:levelDetails,id:id||0,groupId:groupId||"",stats:stats,networkDetails:networkDetails,deliveryDirectives:deliveryDirectives});break;case PlaylistContextType.SUBTITLE_TRACK:hls.trigger(Events.SUBTITLE_TRACK_LOADED,{details:levelDetails,id:id||0,groupId:groupId||"",stats:stats,networkDetails:networkDetails,deliveryDirectives:deliveryDirectives})}}else{var _error=new Error("No Segments found in Playlist");hls.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:url,error:_error,reason:_error.message,response:response,context:context,level:levelIndex,parent:parent,networkDetails:networkDetails,stats:stats})}},PlaylistLoader})();function sendAddTrackEvent(track,videoEl){var event;try{event=new Event("addtrack")}catch(err){(event=document.createEvent("Event")).initEvent("addtrack",!1,!1)}event.track=track,videoEl.dispatchEvent(event)}function addCueToTrack(track,cue){var mode=track.mode;if("disabled"===mode&&(track.mode="hidden"),track.cues&&!track.cues.getCueById(cue.id))try{if(track.addCue(cue),!track.cues.getCueById(cue.id))throw new Error("addCue is failed for: "+cue)}catch(err){logger.debug("[texttrack-utils]: "+err);try{var textTrackCue=new self.TextTrackCue(cue.startTime,cue.endTime,cue.text);textTrackCue.id=cue.id,track.addCue(textTrackCue)}catch(err2){logger.debug("[texttrack-utils]: Legacy TextTrackCue fallback failed: "+err2)}}"disabled"===mode&&(track.mode=mode)}function clearCurrentCues(track){var mode=track.mode;if("disabled"===mode&&(track.mode="hidden"),track.cues)for(var i=track.cues.length;i--;)track.removeCue(track.cues[i]);"disabled"===mode&&(track.mode=mode)}function removeCuesInRange(track,start,end,predicate){var mode=track.mode;if("disabled"===mode&&(track.mode="hidden"),track.cues&&track.cues.length>0)for(var cues=getCuesInRange(track.cues,start,end),i=0;i<cues.length;i++)predicate&&!predicate(cues[i])||track.removeCue(cues[i]);"disabled"===mode&&(track.mode=mode)}function getFirstCueIndexAfterTime(cues,time){if(time<cues[0].startTime)return 0;var len=cues.length-1;if(time>cues[len].endTime)return-1;for(var left=0,right=len;left<=right;){var mid=Math.floor((right+left)/2);if(time<cues[mid].startTime)right=mid-1;else{if(!(time>cues[mid].startTime&&left<len))return mid;left=mid+1}}return cues[left].startTime-time<time-cues[right].startTime?left:right}function getCuesInRange(cues,start,end){var cuesFound=[],firstCueInRange=getFirstCueIndexAfterTime(cues,start);if(firstCueInRange>-1)for(var i=firstCueInRange,len=cues.length;i<len;i++){var _cue=cues[i];if(_cue.startTime>=start&&_cue.endTime<=end)cuesFound.push(_cue);else if(_cue.startTime>end)return cuesFound}return cuesFound}function filterSubtitleTracks(textTrackList){for(var tracks=[],i=0;i<textTrackList.length;i++){var track=textTrackList[i];"subtitles"!==track.kind&&"captions"!==track.kind||!track.label||tracks.push(textTrackList[i])}return tracks}var MetadataSchema={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"},MIN_CUE_DURATION=.25;function getCueClass(){if("undefined"!=typeof self)return self.VTTCue||self.TextTrackCue}function createCueWithDataFields(Cue,startTime,endTime,data,type){var cue=new Cue(startTime,endTime,"");try{cue.value=data,type&&(cue.type=type)}catch(e){cue=new Cue(startTime,endTime,JSON.stringify(type?_objectSpread2({type:type},data):data))}return cue}var MAX_CUE_ENDTIME=(function(){var Cue=getCueClass();try{Cue&&new Cue(0,Number.POSITIVE_INFINITY,"")}catch(e){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function dateRangeDateToTimelineSeconds(date,offset){return date.getTime()/1e3-offset}function hexToArrayBuffer(str){return Uint8Array.from(str.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var ID3TrackController=(function(){function ID3TrackController(hls){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=hls,this._registerListeners()}var _proto=ID3TrackController.prototype;return _proto.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},_proto._registerListeners=function(){var hls=this.hls;hls.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),hls.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),hls.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),hls.on(Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),hls.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),hls.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this)},_proto._unregisterListeners=function(){var hls=this.hls;hls.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),hls.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),hls.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),hls.off(Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),hls.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),hls.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this)},_proto.onMediaAttached=function(event,data){this.media=data.media},_proto.onMediaDetaching=function(){this.id3Track&&(clearCurrentCues(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},_proto.onManifestLoading=function(){this.dateRangeCuesAppended={}},_proto.createTrack=function(media){var track=this.getID3Track(media.textTracks);return track.mode="hidden",track},_proto.getID3Track=function(textTracks){if(this.media){for(var i=0;i<textTracks.length;i++){var textTrack=textTracks[i];if("metadata"===textTrack.kind&&"id3"===textTrack.label)return sendAddTrackEvent(textTrack,this.media),textTrack}return this.media.addTextTrack("metadata","id3")}},_proto.onFragParsingMetadata=function(event,data){if(this.media){var _this$hls$config=this.hls.config,enableEmsgMetadataCues=_this$hls$config.enableEmsgMetadataCues,enableID3MetadataCues=_this$hls$config.enableID3MetadataCues;if(enableEmsgMetadataCues||enableID3MetadataCues){var samples=data.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));var Cue=getCueClass();if(Cue)for(var i=0;i<samples.length;i++){var type=samples[i].type;if((type!==MetadataSchema.emsg||enableEmsgMetadataCues)&&enableID3MetadataCues){var frames=getID3Frames(samples[i].data);if(frames){var startTime=samples[i].pts,endTime=startTime+samples[i].duration;endTime>MAX_CUE_ENDTIME&&(endTime=MAX_CUE_ENDTIME),endTime-startTime<=0&&(endTime=startTime+MIN_CUE_DURATION);for(var j=0;j<frames.length;j++){var frame=frames[j];if(!isTimeStampFrame(frame)){this.updateId3CueEnds(startTime,type);var cue=createCueWithDataFields(Cue,startTime,endTime,frame,type);cue&&this.id3Track.addCue(cue)}}}}}}}},_proto.updateId3CueEnds=function(startTime,type){var _this$id3Track,cues=null==(_this$id3Track=this.id3Track)?void 0:_this$id3Track.cues;if(cues)for(var i=cues.length;i--;){var cue=cues[i];cue.type===type&&cue.startTime<startTime&&cue.endTime===MAX_CUE_ENDTIME&&(cue.endTime=startTime)}},_proto.onBufferFlushing=function(event,_ref){var startOffset=_ref.startOffset,endOffset=_ref.endOffset,type=_ref.type,id3Track=this.id3Track,hls=this.hls;if(hls){var _hls$config=hls.config,enableEmsgMetadataCues=_hls$config.enableEmsgMetadataCues,enableID3MetadataCues=_hls$config.enableID3MetadataCues;id3Track&&(enableEmsgMetadataCues||enableID3MetadataCues)&&removeCuesInRange(id3Track,startOffset,endOffset,"audio"===type?function(cue){return cue.type===MetadataSchema.audioId3&&enableID3MetadataCues}:"video"===type?function(cue){return cue.type===MetadataSchema.emsg&&enableEmsgMetadataCues}:function(cue){return cue.type===MetadataSchema.audioId3&&enableID3MetadataCues||cue.type===MetadataSchema.emsg&&enableEmsgMetadataCues})}},_proto.onLevelUpdated=function(event,_ref2){var _this=this,details=_ref2.details;if(this.media&&details.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var dateRangeCuesAppended=this.dateRangeCuesAppended,id3Track=this.id3Track,dateRanges=details.dateRanges,ids=Object.keys(dateRanges);if(id3Track)for(var idsToRemove=Object.keys(dateRangeCuesAppended).filter((function(id){return!ids.includes(id)})),_loop=function(){var id=idsToRemove[i];Object.keys(dateRangeCuesAppended[id].cues).forEach((function(key){id3Track.removeCue(dateRangeCuesAppended[id].cues[key])})),delete dateRangeCuesAppended[id]},i=idsToRemove.length;i--;)_loop();var lastFragment=details.fragments[details.fragments.length-1];if(0!==ids.length&&isFiniteNumber(null==lastFragment?void 0:lastFragment.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var dateTimeOffset=lastFragment.programDateTime/1e3-lastFragment.start,Cue=getCueClass(),_loop2=function(){var id=ids[_i],dateRange=dateRanges[id],startTime=dateRangeDateToTimelineSeconds(dateRange.startDate,dateTimeOffset),appendedDateRangeCues=dateRangeCuesAppended[id],cues=(null==appendedDateRangeCues?void 0:appendedDateRangeCues.cues)||{},durationKnown=(null==appendedDateRangeCues?void 0:appendedDateRangeCues.durationKnown)||!1,endTime=MAX_CUE_ENDTIME,endDate=dateRange.endDate;if(endDate)endTime=dateRangeDateToTimelineSeconds(endDate,dateTimeOffset),durationKnown=!0;else if(dateRange.endOnNext&&!durationKnown){var nextDateRangeWithSameClass=ids.reduce((function(candidateDateRange,id){if(id!==dateRange.id){var otherDateRange=dateRanges[id];if(otherDateRange.class===dateRange.class&&otherDateRange.startDate>dateRange.startDate&&(!candidateDateRange||dateRange.startDate<candidateDateRange.startDate))return otherDateRange}return candidateDateRange}),null);nextDateRangeWithSameClass&&(endTime=dateRangeDateToTimelineSeconds(nextDateRangeWithSameClass.startDate,dateTimeOffset),durationKnown=!0)}for(var attributes=Object.keys(dateRange.attr),j=0;j<attributes.length;j++){var key=attributes[j];if(isDateRangeCueAttribute(key)){var cue=cues[key];if(cue)durationKnown&&!appendedDateRangeCues.durationKnown&&(cue.endTime=endTime);else if(Cue){var data=dateRange.attr[key];isSCTE35Attribute(key)&&(data=hexToArrayBuffer(data));var _cue=createCueWithDataFields(Cue,startTime,endTime,{key:key,data:data},MetadataSchema.dateRange);_cue&&(_cue.id=id,_this.id3Track.addCue(_cue),cues[key]=_cue)}}}dateRangeCuesAppended[id]={cues:cues,dateRange:dateRange,durationKnown:durationKnown}},_i=0;_i<ids.length;_i++)_loop2()}}},ID3TrackController})(),LatencyController=(function(){function LatencyController(hls){var _this=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return _this.timeupdate()},this.hls=hls,this.config=hls.config,this.registerListeners()}var _proto=LatencyController.prototype;return _proto.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},_proto.registerListeners=function(){this.hls.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(Events.ERROR,this.onError,this)},_proto.unregisterListeners=function(){this.hls.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(Events.ERROR,this.onError,this)},_proto.onMediaAttached=function(event,data){this.media=data.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},_proto.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},_proto.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},_proto.onLevelUpdated=function(event,_ref){var details=_ref.details;this.levelDetails=details,details.advanced&&this.timeupdate(),!details.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},_proto.onError=function(event,data){var _this$levelDetails;data.details===ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,null!=(_this$levelDetails=this.levelDetails)&&_this$levelDetails.live&&logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},_proto.timeupdate=function(){var media=this.media,levelDetails=this.levelDetails;if(media&&levelDetails){this.currentTime=media.currentTime;var latency=this.computeLatency();if(null!==latency){this._latency=latency;var _this$config=this.config,lowLatencyMode=_this$config.lowLatencyMode,maxLiveSyncPlaybackRate=_this$config.maxLiveSyncPlaybackRate;if(lowLatencyMode&&1!==maxLiveSyncPlaybackRate&&levelDetails.live){var targetLatency=this.targetLatency;if(null!==targetLatency){var distanceFromTarget=latency-targetLatency;if(distanceFromTarget<Math.min(this.maxLatency,targetLatency+levelDetails.targetduration)&&distanceFromTarget>.05&&this.forwardBufferLength>1){var max=Math.min(2,Math.max(1,maxLiveSyncPlaybackRate)),rate=Math.round(2/(1+Math.exp(-.75*distanceFromTarget-this.edgeStalled))*20)/20;media.playbackRate=Math.min(max,Math.max(1,rate))}else 1!==media.playbackRate&&0!==media.playbackRate&&(media.playbackRate=1)}}}}},_proto.estimateLiveEdge=function(){var levelDetails=this.levelDetails;return null===levelDetails?null:levelDetails.edge+levelDetails.age},_proto.computeLatency=function(){var liveEdge=this.estimateLiveEdge();return null===liveEdge?null:liveEdge-this.currentTime},_createClass(LatencyController,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var config=this.config,levelDetails=this.levelDetails;return void 0!==config.liveMaxLatencyDuration?config.liveMaxLatencyDuration:levelDetails?config.liveMaxLatencyDurationCount*levelDetails.targetduration:0}},{key:"targetLatency",get:function(){var levelDetails=this.levelDetails;if(null===levelDetails)return null;var holdBack=levelDetails.holdBack,partHoldBack=levelDetails.partHoldBack,targetduration=levelDetails.targetduration,_this$config2=this.config,liveSyncDuration=_this$config2.liveSyncDuration,liveSyncDurationCount=_this$config2.liveSyncDurationCount,lowLatencyMode=_this$config2.lowLatencyMode,userConfig=this.hls.userConfig,targetLatency=lowLatencyMode&&partHoldBack||holdBack;(userConfig.liveSyncDuration||userConfig.liveSyncDurationCount||0===targetLatency)&&(targetLatency=void 0!==liveSyncDuration?liveSyncDuration:liveSyncDurationCount*targetduration);var maxLiveSyncOnStallIncrease=targetduration,liveSyncOnStallIncrease=1;return targetLatency+Math.min(this.stallCount*liveSyncOnStallIncrease,maxLiveSyncOnStallIncrease)}},{key:"liveSyncPosition",get:function(){var liveEdge=this.estimateLiveEdge(),targetLatency=this.targetLatency,levelDetails=this.levelDetails;if(null===liveEdge||null===targetLatency||null===levelDetails)return null;var edge=levelDetails.edge,syncPosition=liveEdge-targetLatency-this.edgeStalled,min=edge-levelDetails.totalduration,max=edge-(this.config.lowLatencyMode&&levelDetails.partTarget||levelDetails.targetduration);return Math.min(Math.max(min,syncPosition),max)}},{key:"drift",get:function(){var levelDetails=this.levelDetails;return null===levelDetails?1:levelDetails.drift}},{key:"edgeStalled",get:function(){var levelDetails=this.levelDetails;if(null===levelDetails)return 0;var maxLevelUpdateAge=3*(this.config.lowLatencyMode&&levelDetails.partTarget||levelDetails.targetduration);return Math.max(levelDetails.age-maxLevelUpdateAge,0)}},{key:"forwardBufferLength",get:function(){var media=this.media,levelDetails=this.levelDetails;if(!media||!levelDetails)return 0;var bufferedRanges=media.buffered.length;return(bufferedRanges?media.buffered.end(bufferedRanges-1):levelDetails.edge)-this.currentTime}}]),LatencyController})(),HdcpLevels=["NONE","TYPE-0","TYPE-1",null];function isHdcpLevel(value){return HdcpLevels.indexOf(value)>-1}var VideoRangeValues=["SDR","PQ","HLG"];function isVideoRange(value){return!!value&&VideoRangeValues.indexOf(value)>-1}var HlsSkip={No:"",Yes:"YES",v2:"v2"};function getSkipValue(details,msn){var canSkipUntil=details.canSkipUntil,canSkipDateRanges=details.canSkipDateRanges,endSN=details.endSN;return canSkipUntil&&(void 0!==msn?msn-endSN:0)<canSkipUntil?canSkipDateRanges?HlsSkip.v2:HlsSkip.Yes:HlsSkip.No}var HlsUrlParameters=(function(){function HlsUrlParameters(msn,part,skip){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=msn,this.part=part,this.skip=skip}return HlsUrlParameters.prototype.addDirectives=function(uri){var url=new self.URL(uri);return void 0!==this.msn&&url.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&url.searchParams.set("_HLS_part",this.part.toString()),this.skip&&url.searchParams.set("_HLS_skip",this.skip),url.href},HlsUrlParameters})(),Level=(function(){function Level(data){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[data.url],this._attrs=[data.attrs],this.bitrate=data.bitrate,data.details&&(this.details=data.details),this.id=data.id||0,this.name=data.name,this.width=data.width||0,this.height=data.height||0,this.frameRate=data.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=data.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=data.audioCodec,this.videoCodec=data.videoCodec,this.codecSet=[data.videoCodec,data.audioCodec].filter((function(c){return!!c})).map((function(s){return s.substring(0,4)})).join(","),this.addGroupId("audio",data.attrs.AUDIO),this.addGroupId("text",data.attrs.SUBTITLES)}var _proto2=Level.prototype;return _proto2.hasAudioGroup=function(groupId){return hasGroup(this._audioGroups,groupId)},_proto2.hasSubtitleGroup=function(groupId){return hasGroup(this._subtitleGroups,groupId)},_proto2.addGroupId=function(type,groupId){if(groupId)if("audio"===type){var audioGroups=this._audioGroups;audioGroups||(audioGroups=this._audioGroups=[]),-1===audioGroups.indexOf(groupId)&&audioGroups.push(groupId)}else if("text"===type){var subtitleGroups=this._subtitleGroups;subtitleGroups||(subtitleGroups=this._subtitleGroups=[]),-1===subtitleGroups.indexOf(groupId)&&subtitleGroups.push(groupId)}},_proto2.addFallback=function(){},_createClass(Level,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"averageBitrate",get:function(){return this._avgBitrate||this.realBitrate||this.bitrate}},{key:"attrs",get:function(){return this._attrs[0]}},{key:"codecs",get:function(){return this.attrs.CODECS||""}},{key:"pathwayId",get:function(){return this.attrs["PATHWAY-ID"]||"."}},{key:"videoRange",get:function(){return this.attrs["VIDEO-RANGE"]||"SDR"}},{key:"score",get:function(){return this.attrs.optionalFloat("SCORE",0)}},{key:"uri",get:function(){return this.url[0]||""}},{key:"audioGroups",get:function(){return this._audioGroups}},{key:"subtitleGroups",get:function(){return this._subtitleGroups}},{key:"urlId",get:function(){return 0},set:function(value){}},{key:"audioGroupIds",get:function(){return this.audioGroups?[this.audioGroupId]:void 0}},{key:"textGroupIds",get:function(){return this.subtitleGroups?[this.textGroupId]:void 0}},{key:"audioGroupId",get:function(){var _this$audioGroups;return null==(_this$audioGroups=this.audioGroups)?void 0:_this$audioGroups[0]}},{key:"textGroupId",get:function(){var _this$subtitleGroups;return null==(_this$subtitleGroups=this.subtitleGroups)?void 0:_this$subtitleGroups[0]}}]),Level})();function hasGroup(groups,groupId){return!(!groupId||!groups)&&-1!==groups.indexOf(groupId)}function updateFromToPTS(fragFrom,fragTo){var fragToPTS=fragTo.startPTS;if(isFiniteNumber(fragToPTS)){var frag,duration=0;fragTo.sn>fragFrom.sn?(duration=fragToPTS-fragFrom.start,frag=fragFrom):(duration=fragFrom.start-fragToPTS,frag=fragTo),frag.duration!==duration&&(frag.duration=duration)}else fragTo.sn>fragFrom.sn?fragFrom.cc===fragTo.cc&&fragFrom.minEndPTS?fragTo.start=fragFrom.start+(fragFrom.minEndPTS-fragFrom.start):fragTo.start=fragFrom.start+fragFrom.duration:fragTo.start=Math.max(fragFrom.start-fragTo.duration,0)}function updateFragPTSDTS(details,frag,startPTS,endPTS,startDTS,endDTS){endPTS-startPTS<=0&&(logger.warn("Fragment should have a positive duration",frag),endPTS=startPTS+frag.duration,endDTS=startDTS+frag.duration);var maxStartPTS=startPTS,minEndPTS=endPTS,fragStartPts=frag.startPTS,fragEndPts=frag.endPTS;if(isFiniteNumber(fragStartPts)){var deltaPTS=Math.abs(fragStartPts-startPTS);isFiniteNumber(frag.deltaPTS)?frag.deltaPTS=Math.max(deltaPTS,frag.deltaPTS):frag.deltaPTS=deltaPTS,maxStartPTS=Math.max(startPTS,fragStartPts),startPTS=Math.min(startPTS,fragStartPts),startDTS=Math.min(startDTS,frag.startDTS),minEndPTS=Math.min(endPTS,fragEndPts),endPTS=Math.max(endPTS,fragEndPts),endDTS=Math.max(endDTS,frag.endDTS)}var drift=startPTS-frag.start;0!==frag.start&&(frag.start=startPTS),frag.duration=endPTS-frag.start,frag.startPTS=startPTS,frag.maxStartPTS=maxStartPTS,frag.startDTS=startDTS,frag.endPTS=endPTS,frag.minEndPTS=minEndPTS,frag.endDTS=endDTS;var i,sn=frag.sn;if(!details||sn<details.startSN||sn>details.endSN)return 0;var fragIdx=sn-details.startSN,fragments=details.fragments;for(fragments[fragIdx]=frag,i=fragIdx;i>0;i--)updateFromToPTS(fragments[i],fragments[i-1]);for(i=fragIdx;i<fragments.length-1;i++)updateFromToPTS(fragments[i],fragments[i+1]);return details.fragmentHint&&updateFromToPTS(fragments[fragments.length-1],details.fragmentHint),details.PTSKnown=details.alignedSliding=!0,drift}function mergeDetails(oldDetails,newDetails){for(var currentInitSegment=null,oldFragments=oldDetails.fragments,i=oldFragments.length-1;i>=0;i--){var oldInit=oldFragments[i].initSegment;if(oldInit){currentInitSegment=oldInit;break}}oldDetails.fragmentHint&&delete oldDetails.fragmentHint.endPTS;var PTSFrag,ccOffset=0;if(mapFragmentIntersection(oldDetails,newDetails,(function(oldFrag,newFrag){oldFrag.relurl&&(ccOffset=oldFrag.cc-newFrag.cc),isFiniteNumber(oldFrag.startPTS)&&isFiniteNumber(oldFrag.endPTS)&&(newFrag.start=newFrag.startPTS=oldFrag.startPTS,newFrag.startDTS=oldFrag.startDTS,newFrag.maxStartPTS=oldFrag.maxStartPTS,newFrag.endPTS=oldFrag.endPTS,newFrag.endDTS=oldFrag.endDTS,newFrag.minEndPTS=oldFrag.minEndPTS,newFrag.duration=oldFrag.endPTS-oldFrag.startPTS,newFrag.duration&&(PTSFrag=newFrag),newDetails.PTSKnown=newDetails.alignedSliding=!0),newFrag.elementaryStreams=oldFrag.elementaryStreams,newFrag.loader=oldFrag.loader,newFrag.stats=oldFrag.stats,oldFrag.initSegment&&(newFrag.initSegment=oldFrag.initSegment,currentInitSegment=oldFrag.initSegment)})),currentInitSegment&&(newDetails.fragmentHint?newDetails.fragments.concat(newDetails.fragmentHint):newDetails.fragments).forEach((function(frag){var _currentInitSegment;!frag||frag.initSegment&&frag.initSegment.relurl!==(null==(_currentInitSegment=currentInitSegment)?void 0:_currentInitSegment.relurl)||(frag.initSegment=currentInitSegment)})),newDetails.skippedSegments)if(newDetails.deltaUpdateFailed=newDetails.fragments.some((function(frag){return!frag})),newDetails.deltaUpdateFailed){logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var _i=newDetails.skippedSegments;_i--;)newDetails.fragments.shift();newDetails.startSN=newDetails.fragments[0].sn,newDetails.startCC=newDetails.fragments[0].cc}else newDetails.canSkipDateRanges&&(newDetails.dateRanges=mergeDateRanges(oldDetails.dateRanges,newDetails.dateRanges,newDetails.recentlyRemovedDateranges));var newFragments=newDetails.fragments;if(ccOffset){logger.warn("discontinuity sliding from playlist, take drift into account");for(var _i2=0;_i2<newFragments.length;_i2++)newFragments[_i2].cc+=ccOffset}newDetails.skippedSegments&&(newDetails.startCC=newDetails.fragments[0].cc),mapPartIntersection(oldDetails.partList,newDetails.partList,(function(oldPart,newPart){newPart.elementaryStreams=oldPart.elementaryStreams,newPart.stats=oldPart.stats})),PTSFrag?updateFragPTSDTS(newDetails,PTSFrag,PTSFrag.startPTS,PTSFrag.endPTS,PTSFrag.startDTS,PTSFrag.endDTS):adjustSliding(oldDetails,newDetails),newFragments.length&&(newDetails.totalduration=newDetails.edge-newFragments[0].start),newDetails.driftStartTime=oldDetails.driftStartTime,newDetails.driftStart=oldDetails.driftStart;var advancedDateTime=newDetails.advancedDateTime;if(newDetails.advanced&&advancedDateTime){var edge=newDetails.edge;newDetails.driftStart||(newDetails.driftStartTime=advancedDateTime,newDetails.driftStart=edge),newDetails.driftEndTime=advancedDateTime,newDetails.driftEnd=edge}else newDetails.driftEndTime=oldDetails.driftEndTime,newDetails.driftEnd=oldDetails.driftEnd,newDetails.advancedDateTime=oldDetails.advancedDateTime}function mergeDateRanges(oldDateRanges,deltaDateRanges,recentlyRemovedDateranges){var dateRanges=_extends({},oldDateRanges);return recentlyRemovedDateranges&&recentlyRemovedDateranges.forEach((function(id){delete dateRanges[id]})),Object.keys(deltaDateRanges).forEach((function(id){var dateRange=new DateRange(deltaDateRanges[id].attr,dateRanges[id]);dateRange.isValid?dateRanges[id]=dateRange:logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(deltaDateRanges[id].attr)+'"')})),dateRanges}function mapPartIntersection(oldParts,newParts,intersectionFn){if(oldParts&&newParts)for(var delta=0,i=0,len=oldParts.length;i<=len;i++){var _oldPart=oldParts[i],_newPart=newParts[i+delta];_oldPart&&_newPart&&_oldPart.index===_newPart.index&&_oldPart.fragment.sn===_newPart.fragment.sn?intersectionFn(_oldPart,_newPart):delta--}}function mapFragmentIntersection(oldDetails,newDetails,intersectionFn){for(var skippedSegments=newDetails.skippedSegments,start=Math.max(oldDetails.startSN,newDetails.startSN)-newDetails.startSN,end=(oldDetails.fragmentHint?1:0)+(skippedSegments?newDetails.endSN:Math.min(oldDetails.endSN,newDetails.endSN))-newDetails.startSN,delta=newDetails.startSN-oldDetails.startSN,newFrags=newDetails.fragmentHint?newDetails.fragments.concat(newDetails.fragmentHint):newDetails.fragments,oldFrags=oldDetails.fragmentHint?oldDetails.fragments.concat(oldDetails.fragmentHint):oldDetails.fragments,i=start;i<=end;i++){var _oldFrag=oldFrags[delta+i],_newFrag=newFrags[i];skippedSegments&&!_newFrag&&i<skippedSegments&&(_newFrag=newDetails.fragments[i]=_oldFrag),_oldFrag&&_newFrag&&intersectionFn(_oldFrag,_newFrag)}}function adjustSliding(oldDetails,newDetails){var delta=newDetails.startSN+newDetails.skippedSegments-oldDetails.startSN,oldFragments=oldDetails.fragments;delta<0||delta>=oldFragments.length||addSliding(newDetails,oldFragments[delta].start)}function addSliding(details,start){if(start){for(var fragments=details.fragments,i=details.skippedSegments;i<fragments.length;i++)fragments[i].start+=start;details.fragmentHint&&(details.fragmentHint.start+=start)}}function computeReloadInterval(newDetails,distanceToLiveEdgeMs){void 0===distanceToLiveEdgeMs&&(distanceToLiveEdgeMs=1/0);var reloadInterval=1e3*newDetails.targetduration;if(newDetails.updated){var fragments=newDetails.fragments,liveEdgeMaxTargetDurations=4;if(fragments.length&&reloadInterval*liveEdgeMaxTargetDurations>distanceToLiveEdgeMs){var lastSegmentDuration=1e3*fragments[fragments.length-1].duration;lastSegmentDuration<reloadInterval&&(reloadInterval=lastSegmentDuration)}}else reloadInterval/=2;return Math.round(reloadInterval)}function getFragmentWithSN(level,sn,fragCurrent){if(null==level||!level.details)return null;var levelDetails=level.details,fragment=levelDetails.fragments[sn-levelDetails.startSN];return fragment||((fragment=levelDetails.fragmentHint)&&fragment.sn===sn?fragment:sn<levelDetails.startSN&&fragCurrent&&fragCurrent.sn===sn?fragCurrent:null)}function getPartWith(level,sn,partIndex){var _level$details;return null!=level&&level.details?findPart(null==(_level$details=level.details)?void 0:_level$details.partList,sn,partIndex):null}function findPart(partList,sn,partIndex){if(partList)for(var i=partList.length;i--;){var part=partList[i];if(part.index===partIndex&&part.fragment.sn===sn)return part}return null}function reassignFragmentLevelIndexes(levels){levels.forEach((function(level,index){var details=level.details;null!=details&&details.fragments&&details.fragments.forEach((function(fragment){fragment.level=index}))}))}function isTimeoutError(error){switch(error.details){case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_TIMEOUT:case ErrorDetails.LEVEL_LOAD_TIMEOUT:case ErrorDetails.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function getRetryConfig(loadPolicy,error){var isTimeout=isTimeoutError(error);return loadPolicy.default[(isTimeout?"timeout":"error")+"Retry"]}function getRetryDelay(retryConfig,retryCount){var backoffFactor="linear"===retryConfig.backoff?1:Math.pow(2,retryCount);return Math.min(backoffFactor*retryConfig.retryDelayMs,retryConfig.maxRetryDelayMs)}function getLoaderConfigWithoutReties(loderConfig){return _objectSpread2(_objectSpread2({},loderConfig),{errorRetry:null,timeoutRetry:null})}function shouldRetry(retryConfig,retryCount,isTimeout,loaderResponse){if(!retryConfig)return!1;var httpStatus=null==loaderResponse?void 0:loaderResponse.code,retry=retryCount<retryConfig.maxNumRetry&&(retryForHttpStatus(httpStatus)||!!isTimeout);return retryConfig.shouldRetry?retryConfig.shouldRetry(retryConfig,retryCount,isTimeout,loaderResponse,retry):retry}function retryForHttpStatus(httpStatus){return 0===httpStatus&&!1===navigator.onLine||!!httpStatus&&(httpStatus<400||httpStatus>499)}var BinarySearch={search:function(list,comparisonFn){for(var minIndex=0,maxIndex=list.length-1,currentIndex=null,currentElement=null;minIndex<=maxIndex;){var comparisonResult=comparisonFn(currentElement=list[currentIndex=(minIndex+maxIndex)/2|0]);if(comparisonResult>0)minIndex=currentIndex+1;else{if(!(comparisonResult<0))return currentElement;maxIndex=currentIndex-1}}return null}};function findFragmentByPDT(fragments,PDTValue,maxFragLookUpTolerance){if(null===PDTValue||!Array.isArray(fragments)||!fragments.length||!isFiniteNumber(PDTValue))return null;if(PDTValue<(fragments[0].programDateTime||0))return null;if(PDTValue>=(fragments[fragments.length-1].endProgramDateTime||0))return null;maxFragLookUpTolerance=maxFragLookUpTolerance||0;for(var seg=0;seg<fragments.length;++seg){var frag=fragments[seg];if(pdtWithinToleranceTest(PDTValue,maxFragLookUpTolerance,frag))return frag}return null}function findFragmentByPTS(fragPrevious,fragments,bufferEnd,maxFragLookUpTolerance){void 0===bufferEnd&&(bufferEnd=0),void 0===maxFragLookUpTolerance&&(maxFragLookUpTolerance=0);var fragNext=null;if(fragPrevious){fragNext=fragments[fragPrevious.sn-fragments[0].sn+1]||null;var bufferEdgeError=fragPrevious.endDTS-bufferEnd;bufferEdgeError>0&&bufferEdgeError<15e-7&&(bufferEnd+=15e-7)}else 0===bufferEnd&&0===fragments[0].start&&(fragNext=fragments[0]);if(fragNext&&(!fragPrevious||fragPrevious.level===fragNext.level)&&0===fragmentWithinToleranceTest(bufferEnd,maxFragLookUpTolerance,fragNext))return fragNext;var foundFragment=BinarySearch.search(fragments,fragmentWithinToleranceTest.bind(null,bufferEnd,maxFragLookUpTolerance));return!foundFragment||foundFragment===fragPrevious&&fragNext?fragNext:foundFragment}function fragmentWithinToleranceTest(bufferEnd,maxFragLookUpTolerance,candidate){if(void 0===bufferEnd&&(bufferEnd=0),void 0===maxFragLookUpTolerance&&(maxFragLookUpTolerance=0),candidate.start<=bufferEnd&&candidate.start+candidate.duration>bufferEnd)return 0;var candidateLookupTolerance=Math.min(maxFragLookUpTolerance,candidate.duration+(candidate.deltaPTS?candidate.deltaPTS:0));return candidate.start+candidate.duration-candidateLookupTolerance<=bufferEnd?1:candidate.start-candidateLookupTolerance>bufferEnd&&candidate.start?-1:0}function pdtWithinToleranceTest(pdtBufferEnd,maxFragLookUpTolerance,candidate){var candidateLookupTolerance=1e3*Math.min(maxFragLookUpTolerance,candidate.duration+(candidate.deltaPTS?candidate.deltaPTS:0));return(candidate.endProgramDateTime||0)-candidateLookupTolerance>pdtBufferEnd}function findFragWithCC(fragments,cc){return BinarySearch.search(fragments,(function(candidate){return candidate.cc<cc?1:candidate.cc>cc?-1:0}))}var NetworkErrorAction={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},ErrorActionFlags={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4},ErrorController=(function(){function ErrorController(hls){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=hls,this.log=logger.log.bind(logger,"[info]:"),this.warn=logger.warn.bind(logger,"[warning]:"),this.error=logger.error.bind(logger,"[error]:"),this.registerListeners()}var _proto=ErrorController.prototype;return _proto.registerListeners=function(){var hls=this.hls;hls.on(Events.ERROR,this.onError,this),hls.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),hls.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this)},_proto.unregisterListeners=function(){var hls=this.hls;hls&&(hls.off(Events.ERROR,this.onError,this),hls.off(Events.ERROR,this.onErrorOut,this),hls.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),hls.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this))},_proto.destroy=function(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}},_proto.startLoad=function(startPosition){},_proto.stopLoad=function(){this.playlistError=0},_proto.getVariantLevelIndex=function(frag){return(null==frag?void 0:frag.type)===PlaylistLevelType.MAIN?frag.level:this.hls.loadLevel},_proto.onManifestLoading=function(){this.playlistError=0,this.penalizedRenditions={}},_proto.onLevelUpdated=function(){this.playlistError=0},_proto.onError=function(event,data){var _data$frag,_data$level;if(!data.fatal){var hls=this.hls,context=data.context;switch(data.details){case ErrorDetails.FRAG_LOAD_ERROR:case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_ERROR:case ErrorDetails.KEY_LOAD_TIMEOUT:return void(data.errorAction=this.getFragRetryOrSwitchAction(data));case ErrorDetails.FRAG_PARSING_ERROR:if(null!=(_data$frag=data.frag)&&_data$frag.gap)return void(data.errorAction={action:NetworkErrorAction.DoNothing,flags:ErrorActionFlags.None});case ErrorDetails.FRAG_GAP:case ErrorDetails.FRAG_DECRYPT_ERROR:return data.errorAction=this.getFragRetryOrSwitchAction(data),void(data.errorAction.action=NetworkErrorAction.SendAlternateToPenaltyBox);case ErrorDetails.LEVEL_EMPTY_ERROR:case ErrorDetails.LEVEL_PARSING_ERROR:var _data$context,_data$context$levelDe,levelIndex=data.parent===PlaylistLevelType.MAIN?data.level:hls.loadLevel;return void(data.details===ErrorDetails.LEVEL_EMPTY_ERROR&&null!=(_data$context=data.context)&&null!=(_data$context$levelDe=_data$context.levelDetails)&&_data$context$levelDe.live?data.errorAction=this.getPlaylistRetryOrSwitchAction(data,levelIndex):(data.levelRetry=!1,data.errorAction=this.getLevelSwitchAction(data,levelIndex)));case ErrorDetails.LEVEL_LOAD_ERROR:case ErrorDetails.LEVEL_LOAD_TIMEOUT:return void("number"==typeof(null==context?void 0:context.level)&&(data.errorAction=this.getPlaylistRetryOrSwitchAction(data,context.level)));case ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case ErrorDetails.SUBTITLE_LOAD_ERROR:case ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:if(context){var level=hls.levels[hls.loadLevel];if(level&&(context.type===PlaylistContextType.AUDIO_TRACK&&level.hasAudioGroup(context.groupId)||context.type===PlaylistContextType.SUBTITLE_TRACK&&level.hasSubtitleGroup(context.groupId)))return data.errorAction=this.getPlaylistRetryOrSwitchAction(data,hls.loadLevel),data.errorAction.action=NetworkErrorAction.SendAlternateToPenaltyBox,void(data.errorAction.flags=ErrorActionFlags.MoveAllAlternatesMatchingHost)}return;case ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:var _level=hls.levels[hls.loadLevel],restrictedHdcpLevel=null==_level?void 0:_level.attrs["HDCP-LEVEL"];return void(restrictedHdcpLevel?data.errorAction={action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.MoveAllAlternatesMatchingHDCP,hdcpLevel:restrictedHdcpLevel}:this.keySystemError(data));case ErrorDetails.BUFFER_ADD_CODEC_ERROR:case ErrorDetails.REMUX_ALLOC_ERROR:case ErrorDetails.BUFFER_APPEND_ERROR:return void(data.errorAction=this.getLevelSwitchAction(data,null!=(_data$level=data.level)?_data$level:hls.loadLevel));case ErrorDetails.INTERNAL_EXCEPTION:case ErrorDetails.BUFFER_APPENDING_ERROR:case ErrorDetails.BUFFER_FULL_ERROR:case ErrorDetails.LEVEL_SWITCH_ERROR:case ErrorDetails.BUFFER_STALLED_ERROR:case ErrorDetails.BUFFER_SEEK_OVER_HOLE:case ErrorDetails.BUFFER_NUDGE_ON_STALL:return void(data.errorAction={action:NetworkErrorAction.DoNothing,flags:ErrorActionFlags.None})}data.type===ErrorTypes.KEY_SYSTEM_ERROR&&this.keySystemError(data)}},_proto.keySystemError=function(data){var levelIndex=this.getVariantLevelIndex(data.frag);data.levelRetry=!1,data.errorAction=this.getLevelSwitchAction(data,levelIndex)},_proto.getPlaylistRetryOrSwitchAction=function(data,levelIndex){var retryConfig=getRetryConfig(this.hls.config.playlistLoadPolicy,data),retryCount=this.playlistError++;if(shouldRetry(retryConfig,retryCount,isTimeoutError(data),data.response))return{action:NetworkErrorAction.RetryRequest,flags:ErrorActionFlags.None,retryConfig:retryConfig,retryCount:retryCount};var errorAction=this.getLevelSwitchAction(data,levelIndex);return retryConfig&&(errorAction.retryConfig=retryConfig,errorAction.retryCount=retryCount),errorAction},_proto.getFragRetryOrSwitchAction=function(data){var hls=this.hls,variantLevelIndex=this.getVariantLevelIndex(data.frag),level=hls.levels[variantLevelIndex],_hls$config=hls.config,fragLoadPolicy=_hls$config.fragLoadPolicy,keyLoadPolicy=_hls$config.keyLoadPolicy,retryConfig=getRetryConfig(data.details.startsWith("key")?keyLoadPolicy:fragLoadPolicy,data),fragmentErrors=hls.levels.reduce((function(acc,level){return acc+level.fragmentError}),0);if(level&&(data.details!==ErrorDetails.FRAG_GAP&&level.fragmentError++,shouldRetry(retryConfig,fragmentErrors,isTimeoutError(data),data.response)))return{action:NetworkErrorAction.RetryRequest,flags:ErrorActionFlags.None,retryConfig:retryConfig,retryCount:fragmentErrors};var errorAction=this.getLevelSwitchAction(data,variantLevelIndex);return retryConfig&&(errorAction.retryConfig=retryConfig,errorAction.retryCount=fragmentErrors),errorAction},_proto.getLevelSwitchAction=function(data,levelIndex){var hls=this.hls;null==levelIndex&&(levelIndex=hls.loadLevel);var level=this.hls.levels[levelIndex];if(level){var _data$frag2,_data$context2,errorDetails=data.details;level.loadError++,errorDetails===ErrorDetails.BUFFER_APPEND_ERROR&&level.fragmentError++;var nextLevel=-1,levels=hls.levels,loadLevel=hls.loadLevel,minAutoLevel=hls.minAutoLevel,maxAutoLevel=hls.maxAutoLevel;hls.autoLevelEnabled||(hls.loadLevel=-1);for(var _ret,fragErrorType=null==(_data$frag2=data.frag)?void 0:_data$frag2.type,findAudioCodecAlternate=(fragErrorType===PlaylistLevelType.AUDIO&&errorDetails===ErrorDetails.FRAG_PARSING_ERROR||"audio"===data.sourceBufferName&&(errorDetails===ErrorDetails.BUFFER_ADD_CODEC_ERROR||errorDetails===ErrorDetails.BUFFER_APPEND_ERROR))&&levels.some((function(_ref){var audioCodec=_ref.audioCodec;return level.audioCodec!==audioCodec})),findVideoCodecAlternate="video"===data.sourceBufferName&&(errorDetails===ErrorDetails.BUFFER_ADD_CODEC_ERROR||errorDetails===ErrorDetails.BUFFER_APPEND_ERROR)&&levels.some((function(_ref2){var codecSet=_ref2.codecSet,audioCodec=_ref2.audioCodec;return level.codecSet!==codecSet&&level.audioCodec===audioCodec})),_ref3=null!=(_data$context2=data.context)?_data$context2:{},playlistErrorType=_ref3.type,playlistErrorGroupId=_ref3.groupId,_loop=function(){var candidate=(i+loadLevel)%levels.length;if(candidate!==loadLevel&&candidate>=minAutoLevel&&candidate<=maxAutoLevel&&0===levels[candidate].loadError){var _level$audioGroups,_level$subtitleGroups,levelCandidate=levels[candidate];if(errorDetails===ErrorDetails.FRAG_GAP&&data.frag){var levelDetails=levels[candidate].details;if(levelDetails){var fragCandidate=findFragmentByPTS(data.frag,levelDetails.fragments,data.frag.start);if(null!=fragCandidate&&fragCandidate.gap)return 0}}else{if(playlistErrorType===PlaylistContextType.AUDIO_TRACK&&levelCandidate.hasAudioGroup(playlistErrorGroupId)||playlistErrorType===PlaylistContextType.SUBTITLE_TRACK&&levelCandidate.hasSubtitleGroup(playlistErrorGroupId))return 0;if(fragErrorType===PlaylistLevelType.AUDIO&&null!=(_level$audioGroups=level.audioGroups)&&_level$audioGroups.some((function(groupId){return levelCandidate.hasAudioGroup(groupId)}))||fragErrorType===PlaylistLevelType.SUBTITLE&&null!=(_level$subtitleGroups=level.subtitleGroups)&&_level$subtitleGroups.some((function(groupId){return levelCandidate.hasSubtitleGroup(groupId)}))||findAudioCodecAlternate&&level.audioCodec===levelCandidate.audioCodec||!findAudioCodecAlternate&&level.audioCodec!==levelCandidate.audioCodec||findVideoCodecAlternate&&level.codecSet===levelCandidate.codecSet)return 0}return nextLevel=candidate,1}},i=levels.length;i--&&(0===(_ret=_loop())||1!==_ret););if(nextLevel>-1&&hls.loadLevel!==nextLevel)return data.levelRetry=!0,this.playlistError=0,{action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.None,nextAutoLevel:nextLevel}}return{action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.MoveAllAlternatesMatchingHost}},_proto.onErrorOut=function(event,data){var _data$errorAction;switch(null==(_data$errorAction=data.errorAction)?void 0:_data$errorAction.action){case NetworkErrorAction.DoNothing:break;case NetworkErrorAction.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(data),data.errorAction.resolved||data.details===ErrorDetails.FRAG_GAP?/MediaSource readyState: ended/.test(data.error.message)&&(this.warn('MediaSource ended after "'+data.sourceBufferName+'" sourceBuffer append error. Attempting to recover from media error.'),this.hls.recoverMediaError()):data.fatal=!0}data.fatal&&this.hls.stopLoad()},_proto.sendAlternateToPenaltyBox=function(data){var hls=this.hls,errorAction=data.errorAction;if(errorAction){var flags=errorAction.flags,hdcpLevel=errorAction.hdcpLevel,nextAutoLevel=errorAction.nextAutoLevel;switch(flags){case ErrorActionFlags.None:this.switchLevel(data,nextAutoLevel);break;case ErrorActionFlags.MoveAllAlternatesMatchingHDCP:hdcpLevel&&(hls.maxHdcpLevel=HdcpLevels[HdcpLevels.indexOf(hdcpLevel)-1],errorAction.resolved=!0),this.warn('Restricting playback to HDCP-LEVEL of "'+hls.maxHdcpLevel+'" or lower')}errorAction.resolved||this.switchLevel(data,nextAutoLevel)}},_proto.switchLevel=function(data,levelIndex){void 0!==levelIndex&&data.errorAction&&(this.warn("switching to level "+levelIndex+" after "+data.details),this.hls.nextAutoLevel=levelIndex,data.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)},ErrorController})(),BasePlaylistController=(function(){function BasePlaylistController(hls,logPrefix){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=logger.log.bind(logger,logPrefix+":"),this.warn=logger.warn.bind(logger,logPrefix+":"),this.hls=hls}var _proto=BasePlaylistController.prototype;return _proto.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},_proto.clearTimer=function(){-1!==this.timer&&(self.clearTimeout(this.timer),this.timer=-1)},_proto.startLoad=function(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()},_proto.stopLoad=function(){this.canLoad=!1,this.clearTimer()},_proto.switchParams=function(playlistUri,previous){var renditionReports=null==previous?void 0:previous.renditionReports;if(renditionReports){for(var foundIndex=-1,i=0;i<renditionReports.length;i++){var attr=renditionReports[i],uri=void 0;try{uri=new self.URL(attr.URI,previous.url).href}catch(error){logger.warn("Could not construct new URL for Rendition Report: "+error),uri=attr.URI||""}if(uri===playlistUri){foundIndex=i;break}uri===playlistUri.substring(0,uri.length)&&(foundIndex=i)}if(-1!==foundIndex){var _attr=renditionReports[foundIndex],msn=parseInt(_attr["LAST-MSN"])||(null==previous?void 0:previous.lastPartSn),part=parseInt(_attr["LAST-PART"])||(null==previous?void 0:previous.lastPartIndex);if(this.hls.config.lowLatencyMode){var currentGoal=Math.min(previous.age-previous.partTarget,previous.targetduration);part>=0&&currentGoal>previous.partTarget&&(part+=1)}return new HlsUrlParameters(msn,part>=0?part:void 0,HlsSkip.No)}}},_proto.loadPlaylist=function(hlsUrlParameters){-1===this.requestScheduled&&(this.requestScheduled=self.performance.now())},_proto.shouldLoadPlaylist=function(playlist){return this.canLoad&&!!playlist&&!!playlist.url&&(!playlist.details||playlist.details.live)},_proto.shouldReloadPlaylist=function(playlist){return-1===this.timer&&-1===this.requestScheduled&&this.shouldLoadPlaylist(playlist)},_proto.playlistLoaded=function(index,data,previousDetails){var _this=this,details=data.details,stats=data.stats,now=self.performance.now(),elapsed=stats.loading.first?Math.max(0,now-stats.loading.first):0;if(details.advancedDateTime=Date.now()-elapsed,details.live||null!=previousDetails&&previousDetails.live){if(details.reloaded(previousDetails),previousDetails&&this.log("live playlist "+index+" "+(details.advanced?"REFRESHED "+details.lastPartSn+"-"+details.lastPartIndex:details.updated?"UPDATED":"MISSED")),previousDetails&&details.fragments.length>0&&mergeDetails(previousDetails,details),!this.canLoad||!details.live)return;var deliveryDirectives,msn=void 0,part=void 0;if(details.canBlockReload&&details.endSN&&details.advanced){var lowLatencyMode=this.hls.config.lowLatencyMode,lastPartSn=details.lastPartSn,endSn=details.endSN,lastPartIndex=details.lastPartIndex,lastPart=lastPartSn===endSn;-1!==lastPartIndex?(msn=lastPart?endSn+1:lastPartSn,part=lastPart?lowLatencyMode?0:lastPartIndex:lastPartIndex+1):msn=endSn+1;var lastAdvanced=details.age,cdnAge=lastAdvanced+details.ageHeader,currentGoal=Math.min(cdnAge-details.partTarget,1.5*details.targetduration);if(currentGoal>0){if(previousDetails&&currentGoal>previousDetails.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+previousDetails.tuneInGoal+" to: "+currentGoal+" with playlist age: "+details.age),currentGoal=0;else{var segments=Math.floor(currentGoal/details.targetduration);msn+=segments,void 0!==part&&(part+=Math.round(currentGoal%details.targetduration/details.partTarget)),this.log("CDN Tune-in age: "+details.ageHeader+"s last advanced "+lastAdvanced.toFixed(2)+"s goal: "+currentGoal+" skip sn "+segments+" to part "+part)}details.tuneInGoal=currentGoal}if(deliveryDirectives=this.getDeliveryDirectives(details,data.deliveryDirectives,msn,part),lowLatencyMode||!lastPart)return void this.loadPlaylist(deliveryDirectives)}else(details.canBlockReload||details.canSkipUntil)&&(deliveryDirectives=this.getDeliveryDirectives(details,data.deliveryDirectives,msn,part));var bufferInfo=this.hls.mainForwardBufferInfo,position=bufferInfo?bufferInfo.end-bufferInfo.len:0,reloadInterval=computeReloadInterval(details,1e3*(details.edge-position));details.updated&&now>this.requestScheduled+reloadInterval&&(this.requestScheduled=stats.loading.start),void 0!==msn&&details.canBlockReload?this.requestScheduled=stats.loading.first+reloadInterval-(1e3*details.partTarget||1e3):-1===this.requestScheduled||this.requestScheduled+reloadInterval<now?this.requestScheduled=now:this.requestScheduled-now<=0&&(this.requestScheduled+=reloadInterval);var estimatedTimeUntilUpdate=this.requestScheduled-now;estimatedTimeUntilUpdate=Math.max(0,estimatedTimeUntilUpdate),this.log("reload live playlist "+index+" in "+Math.round(estimatedTimeUntilUpdate)+" ms"),this.timer=self.setTimeout((function(){return _this.loadPlaylist(deliveryDirectives)}),estimatedTimeUntilUpdate)}else this.clearTimer()},_proto.getDeliveryDirectives=function(details,previousDeliveryDirectives,msn,part){var skip=getSkipValue(details,msn);return null!=previousDeliveryDirectives&&previousDeliveryDirectives.skip&&details.deltaUpdateFailed&&(msn=previousDeliveryDirectives.msn,part=previousDeliveryDirectives.part,skip=HlsSkip.No),new HlsUrlParameters(msn,part,skip)},_proto.checkRetry=function(errorEvent){var _this2=this,errorDetails=errorEvent.details,isTimeout=isTimeoutError(errorEvent),errorAction=errorEvent.errorAction,_ref=errorAction||{},action=_ref.action,_ref$retryCount=_ref.retryCount,retryCount=void 0===_ref$retryCount?0:_ref$retryCount,retryConfig=_ref.retryConfig,retry=!!errorAction&&!!retryConfig&&(action===NetworkErrorAction.RetryRequest||!errorAction.resolved&&action===NetworkErrorAction.SendAlternateToPenaltyBox);if(retry){var _errorEvent$context;if(this.requestScheduled=-1,retryCount>=retryConfig.maxNumRetry)return!1;if(isTimeout&&null!=(_errorEvent$context=errorEvent.context)&&_errorEvent$context.deliveryDirectives)this.warn("Retrying playlist loading "+(retryCount+1)+"/"+retryConfig.maxNumRetry+' after "'+errorDetails+'" without delivery-directives'),this.loadPlaylist();else{var delay=getRetryDelay(retryConfig,retryCount);this.timer=self.setTimeout((function(){return _this2.loadPlaylist()}),delay),this.warn("Retrying playlist loading "+(retryCount+1)+"/"+retryConfig.maxNumRetry+' after "'+errorDetails+'" in '+delay+"ms")}errorEvent.levelRetry=!0,errorAction.resolved=!0}return retry},BasePlaylistController})(),EWMA=(function(){function EWMA(halfLife,estimate,weight){void 0===estimate&&(estimate=0),void 0===weight&&(weight=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=halfLife,this.alpha_=halfLife?Math.exp(Math.log(.5)/halfLife):0,this.estimate_=estimate,this.totalWeight_=weight}var _proto=EWMA.prototype;return _proto.sample=function(weight,value){var adjAlpha=Math.pow(this.alpha_,weight);this.estimate_=value*(1-adjAlpha)+adjAlpha*this.estimate_,this.totalWeight_+=weight},_proto.getTotalWeight=function(){return this.totalWeight_},_proto.getEstimate=function(){if(this.alpha_){var zeroFactor=1-Math.pow(this.alpha_,this.totalWeight_);if(zeroFactor)return this.estimate_/zeroFactor}return this.estimate_},EWMA})(),EwmaBandWidthEstimator=(function(){function EwmaBandWidthEstimator(slow,fast,defaultEstimate,defaultTTFB){void 0===defaultTTFB&&(defaultTTFB=100),this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=defaultEstimate,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new EWMA(slow),this.fast_=new EWMA(fast),this.defaultTTFB_=defaultTTFB,this.ttfb_=new EWMA(slow)}var _proto=EwmaBandWidthEstimator.prototype;return _proto.update=function(slow,fast){var slow_=this.slow_,fast_=this.fast_,ttfb_=this.ttfb_;slow_.halfLife!==slow&&(this.slow_=new EWMA(slow,slow_.getEstimate(),slow_.getTotalWeight())),fast_.halfLife!==fast&&(this.fast_=new EWMA(fast,fast_.getEstimate(),fast_.getTotalWeight())),ttfb_.halfLife!==slow&&(this.ttfb_=new EWMA(slow,ttfb_.getEstimate(),ttfb_.getTotalWeight()))},_proto.sample=function(durationMs,numBytes){var durationS=(durationMs=Math.max(durationMs,this.minDelayMs_))/1e3,bandwidthInBps=8*numBytes/durationS;this.fast_.sample(durationS,bandwidthInBps),this.slow_.sample(durationS,bandwidthInBps)},_proto.sampleTTFB=function(ttfb){var seconds=ttfb/1e3,weight=Math.sqrt(2)*Math.exp(-Math.pow(seconds,2)/2);this.ttfb_.sample(weight,Math.max(ttfb,5))},_proto.canEstimate=function(){return this.fast_.getTotalWeight()>=this.minWeight_},_proto.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},_proto.getEstimateTTFB=function(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_},_proto.destroy=function(){},EwmaBandWidthEstimator})(),SUPPORTED_INFO_DEFAULT={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]},SUPPORTED_INFO_CACHE={};function requiresMediaCapabilitiesDecodingInfo(level,audioTracksByGroup,currentVideoRange,currentFrameRate,currentBw,audioPreference){var audioGroups=level.audioCodec?level.audioGroups:null,audioCodecPreference=null==audioPreference?void 0:audioPreference.audioCodec,channelsPreference=null==audioPreference?void 0:audioPreference.channels,maxChannels=channelsPreference?parseInt(channelsPreference):audioCodecPreference?1/0:2,audioChannels=null;if(null!=audioGroups&&audioGroups.length)try{audioChannels=1===audioGroups.length&&audioGroups[0]?audioTracksByGroup.groups[audioGroups[0]].channels:audioGroups.reduce((function(acc,groupId){if(groupId){var audioTrackGroup=audioTracksByGroup.groups[groupId];if(!audioTrackGroup)throw new Error("Audio track group "+groupId+" not found");Object.keys(audioTrackGroup.channels).forEach((function(key){acc[key]=(acc[key]||0)+audioTrackGroup.channels[key]}))}return acc}),{2:0})}catch(error){return!0}return void 0!==level.videoCodec&&(level.width>1920&&level.height>1088||level.height>1920&&level.width>1088||level.frameRate>Math.max(currentFrameRate,30)||"SDR"!==level.videoRange&&level.videoRange!==currentVideoRange||level.bitrate>Math.max(currentBw,8e6))||!!audioChannels&&isFiniteNumber(maxChannels)&&Object.keys(audioChannels).some((function(channels){return parseInt(channels)>maxChannels}))}function getMediaDecodingInfoPromise(level,audioTracksByGroup,mediaCapabilities){var videoCodecs=level.videoCodec,audioCodecs=level.audioCodec;if(!videoCodecs||!audioCodecs||!mediaCapabilities)return Promise.resolve(SUPPORTED_INFO_DEFAULT);var baseVideoConfiguration={width:level.width,height:level.height,bitrate:Math.ceil(Math.max(.9*level.bitrate,level.averageBitrate)),framerate:level.frameRate||30},videoRange=level.videoRange;"SDR"!==videoRange&&(baseVideoConfiguration.transferFunction=videoRange.toLowerCase());var configurations=videoCodecs.split(",").map((function(videoCodec){return{type:"media-source",video:_objectSpread2(_objectSpread2({},baseVideoConfiguration),{},{contentType:mimeTypeForCodec(videoCodec,"video")})}}));return audioCodecs&&level.audioGroups&&level.audioGroups.forEach((function(audioGroupId){var _audioTracksByGroup$g;audioGroupId&&(null==(_audioTracksByGroup$g=audioTracksByGroup.groups[audioGroupId])||_audioTracksByGroup$g.tracks.forEach((function(audioTrack){if(audioTrack.groupId===audioGroupId){var channels=audioTrack.channels||"",channelsNumber=parseFloat(channels);isFiniteNumber(channelsNumber)&&channelsNumber>2&&configurations.push.apply(configurations,audioCodecs.split(",").map((function(audioCodec){return{type:"media-source",audio:{contentType:mimeTypeForCodec(audioCodec,"audio"),channels:""+channelsNumber}}})))}})))})),Promise.all(configurations.map((function(configuration){var decodingInfoKey=getMediaDecodingInfoKey(configuration);return SUPPORTED_INFO_CACHE[decodingInfoKey]||(SUPPORTED_INFO_CACHE[decodingInfoKey]=mediaCapabilities.decodingInfo(configuration))}))).then((function(decodingInfoResults){return{supported:!decodingInfoResults.some((function(info){return!info.supported})),configurations:configurations,decodingInfoResults:decodingInfoResults}})).catch((function(error){return{supported:!1,configurations:configurations,decodingInfoResults:[],error:error}}))}function getMediaDecodingInfoKey(config){var audio=config.audio,video=config.video,mediaConfig=video||audio;if(mediaConfig){var codec=mediaConfig.contentType.split('"')[1];if(video)return"r"+video.height+"x"+video.width+"f"+Math.ceil(video.framerate)+(video.transferFunction||"sd")+"_"+codec+"_"+Math.ceil(video.bitrate/1e5);if(audio)return"c"+audio.channels+(audio.spatialRendering?"s":"n")+"_"+codec}return""}function isHdrSupported(){if("function"==typeof matchMedia){var mediaQueryList=matchMedia("(dynamic-range: high)"),badQuery=matchMedia("bad query");if(mediaQueryList.media!==badQuery.media)return!0===mediaQueryList.matches}return!1}function getVideoSelectionOptions(currentVideoRange,videoPreference){var preferHDR=!1,allowedVideoRanges=[];return currentVideoRange&&(preferHDR="SDR"!==currentVideoRange,allowedVideoRanges=[currentVideoRange]),videoPreference&&(allowedVideoRanges=videoPreference.allowedVideoRanges||VideoRangeValues.slice(0),allowedVideoRanges=(preferHDR=void 0!==videoPreference.preferHDR?videoPreference.preferHDR:isHdrSupported())?allowedVideoRanges.filter((function(range){return"SDR"!==range})):["SDR"]),{preferHDR:preferHDR,allowedVideoRanges:allowedVideoRanges}}function getStartCodecTier(codecTiers,currentVideoRange,currentBw,audioPreference,videoPreference){for(var codecSets=Object.keys(codecTiers),channelsPreference=null==audioPreference?void 0:audioPreference.channels,audioCodecPreference=null==audioPreference?void 0:audioPreference.audioCodec,preferStereo=channelsPreference&&2===parseInt(channelsPreference),hasStereo=!0,hasCurrentVideoRange=!1,minHeight=1/0,minFramerate=1/0,minBitrate=1/0,selectedScore=0,videoRanges=[],_getVideoSelectionOpt=getVideoSelectionOptions(currentVideoRange,videoPreference),preferHDR=_getVideoSelectionOpt.preferHDR,allowedVideoRanges=_getVideoSelectionOpt.allowedVideoRanges,_loop=function(){var tier=codecTiers[codecSets[i]];hasStereo=tier.channels[2]>0,minHeight=Math.min(minHeight,tier.minHeight),minFramerate=Math.min(minFramerate,tier.minFramerate),minBitrate=Math.min(minBitrate,tier.minBitrate);var matchingVideoRanges=allowedVideoRanges.filter((function(range){return tier.videoRanges[range]>0}));matchingVideoRanges.length>0&&(hasCurrentVideoRange=!0,videoRanges=matchingVideoRanges)},i=codecSets.length;i--;)_loop();minHeight=isFiniteNumber(minHeight)?minHeight:0,minFramerate=isFiniteNumber(minFramerate)?minFramerate:0;var maxHeight=Math.max(1080,minHeight),maxFramerate=Math.max(30,minFramerate);return minBitrate=isFiniteNumber(minBitrate)?minBitrate:currentBw,currentBw=Math.max(minBitrate,currentBw),hasCurrentVideoRange||(currentVideoRange=void 0,videoRanges=[]),{codecSet:codecSets.reduce((function(selected,candidate){var candidateTier=codecTiers[candidate];if(candidate===selected)return selected;if(candidateTier.minBitrate>currentBw)return logStartCodecCandidateIgnored(candidate,"min bitrate of "+candidateTier.minBitrate+" > current estimate of "+currentBw),selected;if(!candidateTier.hasDefaultAudio)return logStartCodecCandidateIgnored(candidate,"no renditions with default or auto-select sound found"),selected;if(audioCodecPreference&&candidate.indexOf(audioCodecPreference.substring(0,4))%5!=0)return logStartCodecCandidateIgnored(candidate,'audio codec preference "'+audioCodecPreference+'" not found'),selected;if(channelsPreference&&!preferStereo){if(!candidateTier.channels[channelsPreference])return logStartCodecCandidateIgnored(candidate,"no renditions with "+channelsPreference+" channel sound found (channels options: "+Object.keys(candidateTier.channels)+")"),selected}else if((!audioCodecPreference||preferStereo)&&hasStereo&&0===candidateTier.channels[2])return logStartCodecCandidateIgnored(candidate,"no renditions with stereo sound found"),selected;return candidateTier.minHeight>maxHeight?(logStartCodecCandidateIgnored(candidate,"min resolution of "+candidateTier.minHeight+" > maximum of "+maxHeight),selected):candidateTier.minFramerate>maxFramerate?(logStartCodecCandidateIgnored(candidate,"min framerate of "+candidateTier.minFramerate+" > maximum of "+maxFramerate),selected):videoRanges.some((function(range){return candidateTier.videoRanges[range]>0}))?candidateTier.maxScore<selectedScore?(logStartCodecCandidateIgnored(candidate,"max score of "+candidateTier.maxScore+" < selected max of "+selectedScore),selected):selected&&(codecsSetSelectionPreferenceValue(candidate)>=codecsSetSelectionPreferenceValue(selected)||candidateTier.fragmentError>codecTiers[selected].fragmentError)?selected:(selectedScore=candidateTier.maxScore,candidate):(logStartCodecCandidateIgnored(candidate,"no variants with VIDEO-RANGE of "+JSON.stringify(videoRanges)+" found"),selected)}),void 0),videoRanges:videoRanges,preferHDR:preferHDR,minFramerate:minFramerate,minBitrate:minBitrate}}function logStartCodecCandidateIgnored(codeSet,reason){logger.log('[abr] start candidates with "'+codeSet+'" ignored because '+reason)}function getAudioTracksByGroup(allAudioTracks){return allAudioTracks.reduce((function(audioTracksByGroup,track){var trackGroup=audioTracksByGroup.groups[track.groupId];trackGroup||(trackGroup=audioTracksByGroup.groups[track.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),trackGroup.tracks.push(track);var channelsKey=track.channels||"2";return trackGroup.channels[channelsKey]=(trackGroup.channels[channelsKey]||0)+1,trackGroup.hasDefault=trackGroup.hasDefault||track.default,trackGroup.hasAutoSelect=trackGroup.hasAutoSelect||track.autoselect,trackGroup.hasDefault&&(audioTracksByGroup.hasDefaultAudio=!0),trackGroup.hasAutoSelect&&(audioTracksByGroup.hasAutoSelectAudio=!0),audioTracksByGroup}),{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function getCodecTiers(levels,audioTracksByGroup,minAutoLevel,maxAutoLevel){return levels.slice(minAutoLevel,maxAutoLevel+1).reduce((function(tiers,level){if(!level.codecSet)return tiers;var audioGroups=level.audioGroups,tier=tiers[level.codecSet];tier||(tiers[level.codecSet]=tier={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!audioGroups,fragmentError:0}),tier.minBitrate=Math.min(tier.minBitrate,level.bitrate);var lesserWidthOrHeight=Math.min(level.height,level.width);return tier.minHeight=Math.min(tier.minHeight,lesserWidthOrHeight),tier.minFramerate=Math.min(tier.minFramerate,level.frameRate),tier.maxScore=Math.max(tier.maxScore,level.score),tier.fragmentError+=level.fragmentError,tier.videoRanges[level.videoRange]=(tier.videoRanges[level.videoRange]||0)+1,audioGroups&&audioGroups.forEach((function(audioGroupId){if(audioGroupId){var audioGroup=audioTracksByGroup.groups[audioGroupId];tier.hasDefaultAudio=tier.hasDefaultAudio||audioTracksByGroup.hasDefaultAudio?audioGroup.hasDefault:audioGroup.hasAutoSelect||!audioTracksByGroup.hasDefaultAudio&&!audioTracksByGroup.hasAutoSelectAudio,Object.keys(audioGroup.channels).forEach((function(channels){tier.channels[channels]=(tier.channels[channels]||0)+audioGroup.channels[channels]}))}})),tiers}),{})}function findMatchingOption(option,tracks,matchPredicate){if("attrs"in option){var index=tracks.indexOf(option);if(-1!==index)return index}for(var i=0;i<tracks.length;i++)if(matchesOption(option,tracks[i],matchPredicate))return i;return-1}function matchesOption(option,track,matchPredicate){var groupId=option.groupId,name=option.name,lang=option.lang,assocLang=option.assocLang,characteristics=option.characteristics,isDefault=option.default,forced=option.forced;return(void 0===groupId||track.groupId===groupId)&&(void 0===name||track.name===name)&&(void 0===lang||track.lang===lang)&&(void 0===lang||track.assocLang===assocLang)&&(void 0===isDefault||track.default===isDefault)&&(void 0===forced||track.forced===forced)&&(void 0===characteristics||characteristicsMatch(characteristics,track.characteristics))&&(void 0===matchPredicate||matchPredicate(option,track))}function characteristicsMatch(characteristicsA,characteristicsB){void 0===characteristicsB&&(characteristicsB="");var arrA=characteristicsA.split(","),arrB=characteristicsB.split(",");return arrA.length===arrB.length&&!arrA.some((function(el){return-1===arrB.indexOf(el)}))}function audioMatchPredicate(option,track){var audioCodec=option.audioCodec,channels=option.channels;return!(void 0!==audioCodec&&(track.audioCodec||"").substring(0,4)!==audioCodec.substring(0,4)||void 0!==channels&&channels!==(track.channels||"2"))}function findClosestLevelWithAudioGroup(option,levels,allAudioTracks,searchIndex,matchPredicate){var currentLevel=levels[searchIndex],renditions=levels.reduce((function(variantMap,level,index){var uri=level.uri;return(variantMap[uri]||(variantMap[uri]=[])).push(index),variantMap}),{})[currentLevel.uri];renditions.length>1&&(searchIndex=Math.max.apply(Math,renditions));var currentVideoRange=currentLevel.videoRange,currentFrameRate=currentLevel.frameRate,currentVideoCodec=currentLevel.codecSet.substring(0,4),matchingVideo=searchDownAndUpList(levels,searchIndex,(function(level){if(level.videoRange!==currentVideoRange||level.frameRate!==currentFrameRate||level.codecSet.substring(0,4)!==currentVideoCodec)return!1;var audioGroups=level.audioGroups,tracks=allAudioTracks.filter((function(track){return!audioGroups||-1!==audioGroups.indexOf(track.groupId)}));return findMatchingOption(option,tracks,matchPredicate)>-1}));return matchingVideo>-1?matchingVideo:searchDownAndUpList(levels,searchIndex,(function(level){var audioGroups=level.audioGroups,tracks=allAudioTracks.filter((function(track){return!audioGroups||-1!==audioGroups.indexOf(track.groupId)}));return findMatchingOption(option,tracks,matchPredicate)>-1}))}function searchDownAndUpList(arr,searchIndex,predicate){for(var i=searchIndex;i;i--)if(predicate(arr[i]))return i;for(var _i=searchIndex+1;_i<arr.length;_i++)if(predicate(arr[_i]))return _i;return-1}var AbrController=(function(){function AbrController(_hls){var _this=this;this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this._abandonRulesCheck=function(){var frag=_this.fragCurrent,part=_this.partCurrent,hls=_this.hls,autoLevelEnabled=hls.autoLevelEnabled,media=hls.media;if(frag&&media){var now=performance.now(),stats=part?part.stats:frag.stats,duration=part?part.duration:frag.duration,timeLoading=now-stats.loading.start,minAutoLevel=hls.minAutoLevel;if(stats.aborted||stats.loaded&&stats.loaded===stats.total||frag.level<=minAutoLevel)return _this.clearTimer(),void(_this._nextAutoLevel=-1);if(autoLevelEnabled&&!media.paused&&media.playbackRate&&media.readyState){var bufferInfo=hls.mainForwardBufferInfo;if(null!==bufferInfo){var ttfbEstimate=_this.bwEstimator.getEstimateTTFB(),playbackRate=Math.abs(media.playbackRate);if(!(timeLoading<=Math.max(ttfbEstimate,duration/(2*playbackRate)*1e3))){var bufferStarvationDelay=bufferInfo.len/playbackRate,ttfb=stats.loading.first?stats.loading.first-stats.loading.start:-1,loadedFirstByte=stats.loaded&&ttfb>-1,bwEstimate=_this.getBwEstimate(),levels=hls.levels,level=levels[frag.level],expectedLen=stats.total||Math.max(stats.loaded,Math.round(duration*level.averageBitrate/8)),timeStreaming=loadedFirstByte?timeLoading-ttfb:timeLoading;timeStreaming<1&&loadedFirstByte&&(timeStreaming=Math.min(timeLoading,8*stats.loaded/bwEstimate));var loadRate=loadedFirstByte?1e3*stats.loaded/timeStreaming:0,fragLoadedDelay=loadRate?(expectedLen-stats.loaded)/loadRate:8*expectedLen/bwEstimate+ttfbEstimate/1e3;if(!(fragLoadedDelay<=bufferStarvationDelay)){var nextLoadLevel,bwe=loadRate?8*loadRate:bwEstimate,fragLevelNextLoadedDelay=Number.POSITIVE_INFINITY;for(nextLoadLevel=frag.level-1;nextLoadLevel>minAutoLevel;nextLoadLevel--){var levelNextBitrate=levels[nextLoadLevel].maxBitrate;if((fragLevelNextLoadedDelay=_this.getTimeToLoadFrag(ttfbEstimate/1e3,bwe,duration*levelNextBitrate,!levels[nextLoadLevel].details))<bufferStarvationDelay)break}if(!(fragLevelNextLoadedDelay>=fragLoadedDelay||fragLevelNextLoadedDelay>10*duration)){hls.nextLoadLevel=hls.nextAutoLevel=nextLoadLevel,loadedFirstByte?_this.bwEstimator.sample(timeLoading-Math.min(ttfbEstimate,ttfb),stats.loaded):_this.bwEstimator.sampleTTFB(timeLoading);var nextLoadLevelBitrate=levels[nextLoadLevel].maxBitrate;_this.getBwEstimate()*_this.hls.config.abrBandWidthUpFactor>nextLoadLevelBitrate&&_this.resetEstimator(nextLoadLevelBitrate),_this.clearTimer(),logger.warn("[abr] Fragment "+frag.sn+(part?" part "+part.index:"")+" of level "+frag.level+" is loading too slowly;\n      Time to underbuffer: "+bufferStarvationDelay.toFixed(3)+" s\n      Estimated load time for current fragment: "+fragLoadedDelay.toFixed(3)+" s\n      Estimated load time for down switch fragment: "+fragLevelNextLoadedDelay.toFixed(3)+" s\n      TTFB estimate: "+(0|ttfb)+" ms\n      Current BW estimate: "+(isFiniteNumber(bwEstimate)?0|bwEstimate:"Unknown")+" bps\n      New BW estimate: "+(0|_this.getBwEstimate())+" bps\n      Switching to level "+nextLoadLevel+" @ "+(0|nextLoadLevelBitrate)+" bps"),hls.trigger(Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:frag,part:part,stats:stats})}}}}}}},this.hls=_hls,this.bwEstimator=this.initEstimator(),this.registerListeners()}var _proto=AbrController.prototype;return _proto.resetEstimator=function(abrEwmaDefaultEstimate){abrEwmaDefaultEstimate&&(logger.log("setting initial bwe to "+abrEwmaDefaultEstimate),this.hls.config.abrEwmaDefaultEstimate=abrEwmaDefaultEstimate),this.firstSelection=-1,this.bwEstimator=this.initEstimator()},_proto.initEstimator=function(){var config=this.hls.config;return new EwmaBandWidthEstimator(config.abrEwmaSlowVoD,config.abrEwmaFastVoD,config.abrEwmaDefaultEstimate)},_proto.registerListeners=function(){var hls=this.hls;hls.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),hls.on(Events.FRAG_LOADING,this.onFragLoading,this),hls.on(Events.FRAG_LOADED,this.onFragLoaded,this),hls.on(Events.FRAG_BUFFERED,this.onFragBuffered,this),hls.on(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),hls.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),hls.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),hls.on(Events.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),hls.on(Events.ERROR,this.onError,this)},_proto.unregisterListeners=function(){var hls=this.hls;hls&&(hls.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),hls.off(Events.FRAG_LOADING,this.onFragLoading,this),hls.off(Events.FRAG_LOADED,this.onFragLoaded,this),hls.off(Events.FRAG_BUFFERED,this.onFragBuffered,this),hls.off(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),hls.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),hls.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),hls.off(Events.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),hls.off(Events.ERROR,this.onError,this))},_proto.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null},_proto.onManifestLoading=function(event,data){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()},_proto.onLevelsUpdated=function(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null},_proto.onMaxAutoLevelUpdated=function(){this.firstSelection=-1,this.nextAutoLevelKey=""},_proto.onFragLoading=function(event,data){var _data$part,frag=data.frag;this.ignoreFragment(frag)||(frag.bitrateTest||(this.fragCurrent=frag,this.partCurrent=null!=(_data$part=data.part)?_data$part:null),this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100))},_proto.onLevelSwitching=function(event,data){this.clearTimer()},_proto.onError=function(event,data){if(!data.fatal)switch(data.details){case ErrorDetails.BUFFER_ADD_CODEC_ERROR:case ErrorDetails.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case ErrorDetails.FRAG_LOAD_TIMEOUT:var frag=data.frag,fragCurrent=this.fragCurrent,part=this.partCurrent;if(frag&&fragCurrent&&frag.sn===fragCurrent.sn&&frag.level===fragCurrent.level){var now=performance.now(),stats=part?part.stats:frag.stats,timeLoading=now-stats.loading.start,ttfb=stats.loading.first?stats.loading.first-stats.loading.start:-1;if(stats.loaded&&ttfb>-1){var ttfbEstimate=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(timeLoading-Math.min(ttfbEstimate,ttfb),stats.loaded)}else this.bwEstimator.sampleTTFB(timeLoading)}}},_proto.getTimeToLoadFrag=function(timeToFirstByteSec,bandwidth,fragSizeBits,isSwitch){return timeToFirstByteSec+fragSizeBits/bandwidth+(isSwitch?this.lastLevelLoadSec:0)},_proto.onLevelLoaded=function(event,data){var config=this.hls.config,loading=data.stats.loading,timeLoadingMs=loading.end-loading.start;isFiniteNumber(timeLoadingMs)&&(this.lastLevelLoadSec=timeLoadingMs/1e3),data.details.live?this.bwEstimator.update(config.abrEwmaSlowLive,config.abrEwmaFastLive):this.bwEstimator.update(config.abrEwmaSlowVoD,config.abrEwmaFastVoD)},_proto.onFragLoaded=function(event,_ref){var frag=_ref.frag,part=_ref.part,stats=part?part.stats:frag.stats;if(frag.type===PlaylistLevelType.MAIN&&this.bwEstimator.sampleTTFB(stats.loading.first-stats.loading.start),!this.ignoreFragment(frag)){if(this.clearTimer(),frag.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){var duration=part?part.duration:frag.duration,level=this.hls.levels[frag.level],loadedBytes=(level.loaded?level.loaded.bytes:0)+stats.loaded,loadedDuration=(level.loaded?level.loaded.duration:0)+duration;level.loaded={bytes:loadedBytes,duration:loadedDuration},level.realBitrate=Math.round(8*loadedBytes/loadedDuration)}if(frag.bitrateTest){var fragBufferedData={stats:stats,frag:frag,part:part,id:frag.type};this.onFragBuffered(Events.FRAG_BUFFERED,fragBufferedData),frag.bitrateTest=!1}else this.lastLoadedFragLevel=frag.level}},_proto.onFragBuffered=function(event,data){var frag=data.frag,part=data.part,stats=null!=part&&part.stats.loaded?part.stats:frag.stats;if(!stats.aborted&&!this.ignoreFragment(frag)){var processingMs=stats.parsing.end-stats.loading.start-Math.min(stats.loading.first-stats.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(processingMs,stats.loaded),stats.bwEstimate=this.getBwEstimate(),frag.bitrateTest?this.bitrateTestDelay=processingMs/1e3:this.bitrateTestDelay=0}},_proto.ignoreFragment=function(frag){return frag.type!==PlaylistLevelType.MAIN||"initSegment"===frag.sn},_proto.clearTimer=function(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)},_proto.getAutoLevelKey=function(){var _this$hls$mainForward;return this.getBwEstimate()+"_"+(null==(_this$hls$mainForward=this.hls.mainForwardBufferInfo)?void 0:_this$hls$mainForward.len)},_proto.getNextABRAutoLevel=function(){var fragCurrent=this.fragCurrent,partCurrent=this.partCurrent,hls=this.hls,maxAutoLevel=hls.maxAutoLevel,config=hls.config,minAutoLevel=hls.minAutoLevel,media=hls.media,currentFragDuration=partCurrent?partCurrent.duration:fragCurrent?fragCurrent.duration:0,playbackRate=media&&0!==media.playbackRate?Math.abs(media.playbackRate):1,avgbw=this.getBwEstimate(),bufferInfo=hls.mainForwardBufferInfo,bufferStarvationDelay=(bufferInfo?bufferInfo.len:0)/playbackRate,bwFactor=config.abrBandWidthFactor,bwUpFactor=config.abrBandWidthUpFactor;if(bufferStarvationDelay){var _bestLevel=this.findBestLevel(avgbw,minAutoLevel,maxAutoLevel,bufferStarvationDelay,0,bwFactor,bwUpFactor);if(_bestLevel>=0)return _bestLevel}var maxStarvationDelay=currentFragDuration?Math.min(currentFragDuration,config.maxStarvationDelay):config.maxStarvationDelay;if(!bufferStarvationDelay){var bitrateTestDelay=this.bitrateTestDelay;bitrateTestDelay&&(maxStarvationDelay=(currentFragDuration?Math.min(currentFragDuration,config.maxLoadingDelay):config.maxLoadingDelay)-bitrateTestDelay,logger.info("[abr] bitrate test took "+Math.round(1e3*bitrateTestDelay)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*maxStarvationDelay)+" ms"),bwFactor=bwUpFactor=1)}var bestLevel=this.findBestLevel(avgbw,minAutoLevel,maxAutoLevel,bufferStarvationDelay,maxStarvationDelay,bwFactor,bwUpFactor);if(logger.info("[abr] "+(bufferStarvationDelay?"rebuffering expected":"buffer is empty")+", optimal quality level "+bestLevel),bestLevel>-1)return bestLevel;var minLevel=hls.levels[minAutoLevel],autoLevel=hls.levels[hls.loadLevel];return(null==minLevel?void 0:minLevel.bitrate)<(null==autoLevel?void 0:autoLevel.bitrate)?minAutoLevel:hls.loadLevel},_proto.getBwEstimate=function(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate},_proto.findBestLevel=function(currentBw,minAutoLevel,maxAutoLevel,bufferStarvationDelay,maxStarvationDelay,bwFactor,bwUpFactor){var _level$details,_this2=this,maxFetchDuration=bufferStarvationDelay+maxStarvationDelay,lastLoadedFragLevel=this.lastLoadedFragLevel,selectionBaseLevel=-1===lastLoadedFragLevel?this.hls.firstLevel:lastLoadedFragLevel,fragCurrent=this.fragCurrent,partCurrent=this.partCurrent,_this$hls=this.hls,levels=_this$hls.levels,allAudioTracks=_this$hls.allAudioTracks,loadLevel=_this$hls.loadLevel,config=_this$hls.config;if(1===levels.length)return 0;var currentCodecSet,level=levels[selectionBaseLevel],live=!(null==level||null==(_level$details=level.details)||!_level$details.live),firstSelection=-1===loadLevel||-1===lastLoadedFragLevel,currentVideoRange="SDR",currentFrameRate=(null==level?void 0:level.frameRate)||0,audioPreference=config.audioPreference,videoPreference=config.videoPreference,audioTracksByGroup=this.audioTracksByGroup||(this.audioTracksByGroup=getAudioTracksByGroup(allAudioTracks));if(firstSelection){if(-1!==this.firstSelection)return this.firstSelection;var startTier=getStartCodecTier(this.codecTiers||(this.codecTiers=getCodecTiers(levels,audioTracksByGroup,minAutoLevel,maxAutoLevel)),currentVideoRange,currentBw,audioPreference,videoPreference),codecSet=startTier.codecSet,videoRanges=startTier.videoRanges,minFramerate=startTier.minFramerate,minBitrate=startTier.minBitrate,preferHDR=startTier.preferHDR;currentCodecSet=codecSet,currentVideoRange=preferHDR?videoRanges[videoRanges.length-1]:videoRanges[0],currentFrameRate=minFramerate,currentBw=Math.max(currentBw,minBitrate),logger.log("[abr] picked start tier "+JSON.stringify(startTier))}else currentCodecSet=null==level?void 0:level.codecSet,currentVideoRange=null==level?void 0:level.videoRange;for(var _ret,currentFragDuration=partCurrent?partCurrent.duration:fragCurrent?fragCurrent.duration:0,ttfbEstimateSec=this.bwEstimator.getEstimateTTFB()/1e3,levelsSkipped=[],_loop=function(){var _levelInfo$supportedR,levelInfo=levels[i],upSwitch=i>selectionBaseLevel;if(!levelInfo)return 0;if(config.useMediaCapabilities&&!levelInfo.supportedResult&&!levelInfo.supportedPromise){var mediaCapabilities=navigator.mediaCapabilities;"function"==typeof(null==mediaCapabilities?void 0:mediaCapabilities.decodingInfo)&&requiresMediaCapabilitiesDecodingInfo(levelInfo,audioTracksByGroup,currentVideoRange,currentFrameRate,currentBw,audioPreference)?(levelInfo.supportedPromise=getMediaDecodingInfoPromise(levelInfo,audioTracksByGroup,mediaCapabilities),levelInfo.supportedPromise.then((function(decodingInfo){levelInfo.supportedResult=decodingInfo;var levels=_this2.hls.levels,index=levels.indexOf(levelInfo);decodingInfo.error?logger.warn('[abr] MediaCapabilities decodingInfo error: "'+decodingInfo.error+'" for level '+index+" "+JSON.stringify(decodingInfo)):decodingInfo.supported||(logger.warn("[abr] Unsupported MediaCapabilities decodingInfo result for level "+index+" "+JSON.stringify(decodingInfo)),index>-1&&levels.length>1&&(logger.log("[abr] Removing unsupported level "+index),_this2.hls.removeLevel(index)))}))):levelInfo.supportedResult=SUPPORTED_INFO_DEFAULT}if(currentCodecSet&&levelInfo.codecSet!==currentCodecSet||currentVideoRange&&levelInfo.videoRange!==currentVideoRange||upSwitch&&currentFrameRate>levelInfo.frameRate||!upSwitch&&currentFrameRate>0&&currentFrameRate<levelInfo.frameRate||levelInfo.supportedResult&&(null==(_levelInfo$supportedR=levelInfo.supportedResult.decodingInfoResults)||!_levelInfo$supportedR[0].smooth))return levelsSkipped.push(i),0;var adjustedbw,levelDetails=levelInfo.details,avgDuration=(partCurrent?null==levelDetails?void 0:levelDetails.partTarget:null==levelDetails?void 0:levelDetails.averagetargetduration)||currentFragDuration;adjustedbw=upSwitch?bwUpFactor*currentBw:bwFactor*currentBw;var bitrate=currentFragDuration&&bufferStarvationDelay>=2*currentFragDuration&&0===maxStarvationDelay?levels[i].averageBitrate:levels[i].maxBitrate,fetchDuration=_this2.getTimeToLoadFrag(ttfbEstimateSec,adjustedbw,bitrate*avgDuration,void 0===levelDetails);if(adjustedbw>=bitrate&&(i===lastLoadedFragLevel||0===levelInfo.loadError&&0===levelInfo.fragmentError)&&(fetchDuration<=ttfbEstimateSec||!isFiniteNumber(fetchDuration)||live&&!_this2.bitrateTestDelay||fetchDuration<maxFetchDuration)){var forcedAutoLevel=_this2.forcedAutoLevel;return i===loadLevel||-1!==forcedAutoLevel&&forcedAutoLevel===loadLevel||(levelsSkipped.length&&logger.trace("[abr] Skipped level(s) "+levelsSkipped.join(",")+" of "+maxAutoLevel+' max with CODECS and VIDEO-RANGE:"'+levels[levelsSkipped[0]].codecs+'" '+levels[levelsSkipped[0]].videoRange+'; not compatible with "'+level.codecs+'" '+currentVideoRange),logger.info("[abr] switch candidate:"+selectionBaseLevel+"->"+i+" adjustedbw("+Math.round(adjustedbw)+")-bitrate="+Math.round(adjustedbw-bitrate)+" ttfb:"+ttfbEstimateSec.toFixed(1)+" avgDuration:"+avgDuration.toFixed(1)+" maxFetchDuration:"+maxFetchDuration.toFixed(1)+" fetchDuration:"+fetchDuration.toFixed(1)+" firstSelection:"+firstSelection+" codecSet:"+currentCodecSet+" videoRange:"+currentVideoRange+" hls.loadLevel:"+loadLevel)),firstSelection&&(_this2.firstSelection=i),{v:i}}},i=maxAutoLevel;i>=minAutoLevel;i--)if(0!==(_ret=_loop())&&_ret)return _ret.v;return-1},_createClass(AbrController,[{key:"firstAutoLevel",get:function(){var _this$hls2=this.hls,maxAutoLevel=_this$hls2.maxAutoLevel,minAutoLevel=_this$hls2.minAutoLevel,bwEstimate=this.getBwEstimate(),maxStartDelay=this.hls.config.maxStarvationDelay,abrAutoLevel=this.findBestLevel(bwEstimate,minAutoLevel,maxAutoLevel,0,maxStartDelay,1,1);if(abrAutoLevel>-1)return abrAutoLevel;var firstLevel=this.hls.firstLevel,clamped=Math.min(Math.max(firstLevel,minAutoLevel),maxAutoLevel);return logger.warn("[abr] Could not find best starting auto level. Defaulting to first in playlist "+firstLevel+" clamped to "+clamped),clamped}},{key:"forcedAutoLevel",get:function(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}},{key:"nextAutoLevel",get:function(){var forcedAutoLevel=this.forcedAutoLevel,useEstimate=this.bwEstimator.canEstimate(),loadedFirstFrag=this.lastLoadedFragLevel>-1;if(!(-1===forcedAutoLevel||useEstimate&&loadedFirstFrag&&this.nextAutoLevelKey!==this.getAutoLevelKey()))return forcedAutoLevel;var nextABRAutoLevel=useEstimate&&loadedFirstFrag?this.getNextABRAutoLevel():this.firstAutoLevel;if(-1!==forcedAutoLevel){var levels=this.hls.levels;if(levels.length>Math.max(forcedAutoLevel,nextABRAutoLevel)&&levels[forcedAutoLevel].loadError<=levels[nextABRAutoLevel].loadError)return forcedAutoLevel}return this._nextAutoLevel=nextABRAutoLevel,this.nextAutoLevelKey=this.getAutoLevelKey(),nextABRAutoLevel},set:function(nextLevel){var _this$hls3=this.hls,maxAutoLevel=_this$hls3.maxAutoLevel,minAutoLevel=_this$hls3.minAutoLevel,value=Math.min(Math.max(nextLevel,minAutoLevel),maxAutoLevel);this._nextAutoLevel!==value&&(this.nextAutoLevelKey="",this._nextAutoLevel=value)}}]),AbrController})(),TaskLoop=(function(){function TaskLoop(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var _proto=TaskLoop.prototype;return _proto.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},_proto.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},_proto.onHandlerDestroyed=function(){},_proto.hasInterval=function(){return!!this._tickInterval},_proto.hasNextTick=function(){return!!this._tickTimer},_proto.setInterval=function(millis){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,millis),!0)},_proto.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},_proto.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},_proto.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},_proto.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},_proto.doTick=function(){},TaskLoop})(),FragmentState={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"},FragmentTracker=(function(){function FragmentTracker(hls){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=hls,this._registerListeners()}var _proto=FragmentTracker.prototype;return _proto._registerListeners=function(){var hls=this.hls;hls.on(Events.BUFFER_APPENDED,this.onBufferAppended,this),hls.on(Events.FRAG_BUFFERED,this.onFragBuffered,this),hls.on(Events.FRAG_LOADED,this.onFragLoaded,this)},_proto._unregisterListeners=function(){var hls=this.hls;hls.off(Events.BUFFER_APPENDED,this.onBufferAppended,this),hls.off(Events.FRAG_BUFFERED,this.onFragBuffered,this),hls.off(Events.FRAG_LOADED,this.onFragLoaded,this)},_proto.destroy=function(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null},_proto.getAppendedFrag=function(position,levelType){var activeParts=this.activePartLists[levelType];if(activeParts)for(var i=activeParts.length;i--;){var activePart=activeParts[i];if(!activePart)break;var appendedPTS=activePart.end;if(activePart.start<=position&&null!==appendedPTS&&position<=appendedPTS)return activePart}return this.getBufferedFrag(position,levelType)},_proto.getBufferedFrag=function(position,levelType){for(var fragments=this.fragments,keys=Object.keys(fragments),i=keys.length;i--;){var fragmentEntity=fragments[keys[i]];if((null==fragmentEntity?void 0:fragmentEntity.body.type)===levelType&&fragmentEntity.buffered){var frag=fragmentEntity.body;if(frag.start<=position&&position<=frag.end)return frag}}return null},_proto.detectEvictedFragments=function(elementaryStream,timeRange,playlistType,appendedPart){var _this=this;this.timeRanges&&(this.timeRanges[elementaryStream]=timeRange);var appendedPartSn=(null==appendedPart?void 0:appendedPart.fragment.sn)||-1;Object.keys(this.fragments).forEach((function(key){var fragmentEntity=_this.fragments[key];if(fragmentEntity&&!(appendedPartSn>=fragmentEntity.body.sn))if(fragmentEntity.buffered||fragmentEntity.loaded){var esData=fragmentEntity.range[elementaryStream];esData&&esData.time.some((function(time){var isNotBuffered=!_this.isTimeBuffered(time.startPTS,time.endPTS,timeRange);return isNotBuffered&&_this.removeFragment(fragmentEntity.body),isNotBuffered}))}else fragmentEntity.body.type===playlistType&&_this.removeFragment(fragmentEntity.body)}))},_proto.detectPartialFragments=function(data){var _this2=this,timeRanges=this.timeRanges,frag=data.frag,part=data.part;if(timeRanges&&"initSegment"!==frag.sn){var fragKey=getFragmentKey(frag),fragmentEntity=this.fragments[fragKey];if(!(!fragmentEntity||fragmentEntity.buffered&&frag.gap)){var isFragHint=!frag.relurl;Object.keys(timeRanges).forEach((function(elementaryStream){var streamInfo=frag.elementaryStreams[elementaryStream];if(streamInfo){var timeRange=timeRanges[elementaryStream],partial=isFragHint||!0===streamInfo.partial;fragmentEntity.range[elementaryStream]=_this2.getBufferedTimes(frag,part,partial,timeRange)}})),fragmentEntity.loaded=null,Object.keys(fragmentEntity.range).length?(fragmentEntity.buffered=!0,(fragmentEntity.body.endList=frag.endList||fragmentEntity.body.endList)&&(this.endListFragments[fragmentEntity.body.type]=fragmentEntity),isPartial(fragmentEntity)||this.removeParts(frag.sn-1,frag.type)):this.removeFragment(fragmentEntity.body)}}},_proto.removeParts=function(snToKeep,levelType){var activeParts=this.activePartLists[levelType];activeParts&&(this.activePartLists[levelType]=activeParts.filter((function(part){return part.fragment.sn>=snToKeep})))},_proto.fragBuffered=function(frag,force){var fragKey=getFragmentKey(frag),fragmentEntity=this.fragments[fragKey];!fragmentEntity&&force&&(fragmentEntity=this.fragments[fragKey]={body:frag,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},frag.gap&&(this.hasGaps=!0)),fragmentEntity&&(fragmentEntity.loaded=null,fragmentEntity.buffered=!0)},_proto.getBufferedTimes=function(fragment,part,partial,timeRange){for(var buffered={time:[],partial:partial},startPTS=fragment.start,endPTS=fragment.end,minEndPTS=fragment.minEndPTS||endPTS,maxStartPTS=fragment.maxStartPTS||startPTS,i=0;i<timeRange.length;i++){var startTime=timeRange.start(i)-this.bufferPadding,endTime=timeRange.end(i)+this.bufferPadding;if(maxStartPTS>=startTime&&minEndPTS<=endTime){buffered.time.push({startPTS:Math.max(startPTS,timeRange.start(i)),endPTS:Math.min(endPTS,timeRange.end(i))});break}if(startPTS<endTime&&endPTS>startTime){var start=Math.max(startPTS,timeRange.start(i)),end=Math.min(endPTS,timeRange.end(i));end>start&&(buffered.partial=!0,buffered.time.push({startPTS:start,endPTS:end}))}else if(endPTS<=startTime)break}return buffered},_proto.getPartialFragment=function(time){var timePadding,startTime,endTime,bestFragment=null,bestOverlap=0,bufferPadding=this.bufferPadding,fragments=this.fragments;return Object.keys(fragments).forEach((function(key){var fragmentEntity=fragments[key];fragmentEntity&&isPartial(fragmentEntity)&&(startTime=fragmentEntity.body.start-bufferPadding,endTime=fragmentEntity.body.end+bufferPadding,time>=startTime&&time<=endTime&&(timePadding=Math.min(time-startTime,endTime-time),bestOverlap<=timePadding&&(bestFragment=fragmentEntity.body,bestOverlap=timePadding)))})),bestFragment},_proto.isEndListAppended=function(type){var lastFragmentEntity=this.endListFragments[type];return void 0!==lastFragmentEntity&&(lastFragmentEntity.buffered||isPartial(lastFragmentEntity))},_proto.getState=function(fragment){var fragKey=getFragmentKey(fragment),fragmentEntity=this.fragments[fragKey];return fragmentEntity?fragmentEntity.buffered?isPartial(fragmentEntity)?FragmentState.PARTIAL:FragmentState.OK:FragmentState.APPENDING:FragmentState.NOT_LOADED},_proto.isTimeBuffered=function(startPTS,endPTS,timeRange){for(var startTime,endTime,i=0;i<timeRange.length;i++){if(startTime=timeRange.start(i)-this.bufferPadding,endTime=timeRange.end(i)+this.bufferPadding,startPTS>=startTime&&endPTS<=endTime)return!0;if(endPTS<=startTime)return!1}return!1},_proto.onFragLoaded=function(event,data){var frag=data.frag,part=data.part;if("initSegment"!==frag.sn&&!frag.bitrateTest){var loaded=part?null:data,fragKey=getFragmentKey(frag);this.fragments[fragKey]={body:frag,appendedPTS:null,loaded:loaded,buffered:!1,range:Object.create(null)}}},_proto.onBufferAppended=function(event,data){var _this3=this,frag=data.frag,part=data.part,timeRanges=data.timeRanges;if("initSegment"!==frag.sn){var playlistType=frag.type;if(part){var activeParts=this.activePartLists[playlistType];activeParts||(this.activePartLists[playlistType]=activeParts=[]),activeParts.push(part)}this.timeRanges=timeRanges,Object.keys(timeRanges).forEach((function(elementaryStream){var timeRange=timeRanges[elementaryStream];_this3.detectEvictedFragments(elementaryStream,timeRange,playlistType,part)}))}},_proto.onFragBuffered=function(event,data){this.detectPartialFragments(data)},_proto.hasFragment=function(fragment){var fragKey=getFragmentKey(fragment);return!!this.fragments[fragKey]},_proto.hasParts=function(type){var _this$activePartLists;return!(null==(_this$activePartLists=this.activePartLists[type])||!_this$activePartLists.length)},_proto.removeFragmentsInRange=function(start,end,playlistType,withGapOnly,unbufferedOnly){var _this4=this;withGapOnly&&!this.hasGaps||Object.keys(this.fragments).forEach((function(key){var fragmentEntity=_this4.fragments[key];if(fragmentEntity){var frag=fragmentEntity.body;frag.type!==playlistType||withGapOnly&&!frag.gap||frag.start<end&&frag.end>start&&(fragmentEntity.buffered||unbufferedOnly)&&_this4.removeFragment(frag)}}))},_proto.removeFragment=function(fragment){var fragKey=getFragmentKey(fragment);fragment.stats.loaded=0,fragment.clearElementaryStreamInfo();var activeParts=this.activePartLists[fragment.type];if(activeParts){var snToRemove=fragment.sn;this.activePartLists[fragment.type]=activeParts.filter((function(part){return part.fragment.sn!==snToRemove}))}delete this.fragments[fragKey],fragment.endList&&delete this.endListFragments[fragment.type]},_proto.removeAllFragments=function(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1},FragmentTracker})();function isPartial(fragmentEntity){var _fragmentEntity$range,_fragmentEntity$range2,_fragmentEntity$range3;return fragmentEntity.buffered&&(fragmentEntity.body.gap||(null==(_fragmentEntity$range=fragmentEntity.range.video)?void 0:_fragmentEntity$range.partial)||(null==(_fragmentEntity$range2=fragmentEntity.range.audio)?void 0:_fragmentEntity$range2.partial)||(null==(_fragmentEntity$range3=fragmentEntity.range.audiovideo)?void 0:_fragmentEntity$range3.partial))}function getFragmentKey(fragment){return fragment.type+"_"+fragment.level+"_"+fragment.sn}var noopBuffered={length:0,start:function(){return 0},end:function(){return 0}},BufferHelper=(function(){function BufferHelper(){}return BufferHelper.isBuffered=function(media,position){try{if(media)for(var buffered=BufferHelper.getBuffered(media),i=0;i<buffered.length;i++)if(position>=buffered.start(i)&&position<=buffered.end(i))return!0}catch(error){}return!1},BufferHelper.bufferInfo=function(media,pos,maxHoleDuration){try{if(media){var i,vbuffered=BufferHelper.getBuffered(media),buffered=[];for(i=0;i<vbuffered.length;i++)buffered.push({start:vbuffered.start(i),end:vbuffered.end(i)});return this.bufferedInfo(buffered,pos,maxHoleDuration)}}catch(error){}return{len:0,start:pos,end:pos,nextStart:void 0}},BufferHelper.bufferedInfo=function(buffered,pos,maxHoleDuration){pos=Math.max(0,pos),buffered.sort((function(a,b){var diff=a.start-b.start;return diff||b.end-a.end}));var buffered2=[];if(maxHoleDuration)for(var i=0;i<buffered.length;i++){var buf2len=buffered2.length;if(buf2len){var buf2end=buffered2[buf2len-1].end;buffered[i].start-buf2end<maxHoleDuration?buffered[i].end>buf2end&&(buffered2[buf2len-1].end=buffered[i].end):buffered2.push(buffered[i])}else buffered2.push(buffered[i])}else buffered2=buffered;for(var bufferStartNext,bufferLen=0,bufferStart=pos,bufferEnd=pos,_i=0;_i<buffered2.length;_i++){var start=buffered2[_i].start,end=buffered2[_i].end;if(pos+maxHoleDuration>=start&&pos<end)bufferStart=start,bufferLen=(bufferEnd=end)-pos;else if(pos+maxHoleDuration<start){bufferStartNext=start;break}}return{len:bufferLen,start:bufferStart||0,end:bufferEnd||0,nextStart:bufferStartNext}},BufferHelper.getBuffered=function(media){try{return media.buffered}catch(e){return logger.log("failed to get media.buffered",e),noopBuffered}},BufferHelper})(),ChunkMetadata=function(level,sn,id,size,part,partial){void 0===size&&(size=0),void 0===part&&(part=-1),void 0===partial&&(partial=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=getNewPerformanceTiming(),this.buffering={audio:getNewPerformanceTiming(),video:getNewPerformanceTiming(),audiovideo:getNewPerformanceTiming()},this.level=level,this.sn=sn,this.id=id,this.size=size,this.part=part,this.partial=partial};function getNewPerformanceTiming(){return{start:0,executeStart:0,executeEnd:0,end:0}}function findFirstFragWithCC(fragments,cc){for(var i=0,len=fragments.length;i<len;i++){var _fragments$i;if((null==(_fragments$i=fragments[i])?void 0:_fragments$i.cc)===cc)return fragments[i]}return null}function shouldAlignOnDiscontinuities(lastFrag,switchDetails,details){return!(!switchDetails||!(details.endCC>details.startCC||lastFrag&&lastFrag.cc<details.startCC))}function findDiscontinuousReferenceFrag(prevDetails,curDetails){var prevFrags=prevDetails.fragments,curFrags=curDetails.fragments;if(curFrags.length&&prevFrags.length){var prevStartFrag=findFirstFragWithCC(prevFrags,curFrags[0].cc);if(prevStartFrag&&(!prevStartFrag||prevStartFrag.startPTS))return prevStartFrag;logger.log("No frag in previous level to align on")}else logger.log("No fragments to align")}function adjustFragmentStart(frag,sliding){if(frag){var start=frag.start+sliding;frag.start=frag.startPTS=start,frag.endPTS=start+frag.duration}}function adjustSlidingStart(sliding,details){for(var fragments=details.fragments,i=0,len=fragments.length;i<len;i++)adjustFragmentStart(fragments[i],sliding);details.fragmentHint&&adjustFragmentStart(details.fragmentHint,sliding),details.alignedSliding=!0}function alignStream(lastFrag,switchDetails,details){switchDetails&&(alignDiscontinuities(lastFrag,details,switchDetails),!details.alignedSliding&&switchDetails&&alignMediaPlaylistByPDT(details,switchDetails),details.alignedSliding||!switchDetails||details.skippedSegments||adjustSliding(switchDetails,details))}function alignDiscontinuities(lastFrag,details,switchDetails){if(shouldAlignOnDiscontinuities(lastFrag,switchDetails,details)){var referenceFrag=findDiscontinuousReferenceFrag(switchDetails,details);referenceFrag&&isFiniteNumber(referenceFrag.start)&&(logger.log("Adjusting PTS using last level due to CC increase within current level "+details.url),adjustSlidingStart(referenceFrag.start,details))}}function alignMediaPlaylistByPDT(details,refDetails){if(details.hasProgramDateTime&&refDetails.hasProgramDateTime){var fragments=details.fragments,refFragments=refDetails.fragments;if(fragments.length&&refFragments.length){var refFrag,frag,targetCC=Math.min(refDetails.endCC,details.endCC);refDetails.startCC<targetCC&&details.startCC<targetCC&&(refFrag=findFirstFragWithCC(refFragments,targetCC),frag=findFirstFragWithCC(fragments,targetCC)),refFrag&&frag||(frag=findFirstFragWithCC(fragments,(refFrag=refFragments[Math.floor(refFragments.length/2)]).cc)||fragments[Math.floor(fragments.length/2)]);var refPDT=refFrag.programDateTime,targetPDT=frag.programDateTime;refPDT&&targetPDT&&adjustSlidingStart((targetPDT-refPDT)/1e3-(frag.start-refFrag.start),details)}}}var MIN_CHUNK_SIZE=Math.pow(2,17),FragmentLoader=(function(){function FragmentLoader(config){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=config}var _proto=FragmentLoader.prototype;return _proto.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},_proto.abort=function(){this.loader&&this.loader.abort()},_proto.load=function(frag,_onProgress){var _this=this,url=frag.url;if(!url)return Promise.reject(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:frag,error:new Error("Fragment does not have a "+(url?"part list":"url")),networkDetails:null}));this.abort();var config=this.config,FragmentILoader=config.fLoader,DefaultILoader=config.loader;return new Promise((function(resolve,reject){if(_this.loader&&_this.loader.destroy(),frag.gap){if(frag.tagList.some((function(tags){return"GAP"===tags[0]})))return void reject(createGapLoadError(frag));frag.gap=!1}var loader=_this.loader=frag.loader=FragmentILoader?new FragmentILoader(config):new DefaultILoader(config),loaderContext=createLoaderContext(frag),loadPolicy=getLoaderConfigWithoutReties(config.fragLoadPolicy.default),loaderConfig={loadPolicy:loadPolicy,timeout:loadPolicy.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===frag.sn?1/0:MIN_CHUNK_SIZE};frag.stats=loader.stats,loader.load(loaderContext,loaderConfig,{onSuccess:function(response,stats,context,networkDetails){_this.resetLoader(frag,loader);var payload=response.data;context.resetIV&&frag.decryptdata&&(frag.decryptdata.iv=new Uint8Array(payload.slice(0,16)),payload=payload.slice(16)),resolve({frag:frag,part:null,payload:payload,networkDetails:networkDetails})},onError:function(response,context,networkDetails,stats){_this.resetLoader(frag,loader),reject(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:frag,response:_objectSpread2({url:url,data:void 0},response),error:new Error("HTTP Error "+response.code+" "+response.text),networkDetails:networkDetails,stats:stats}))},onAbort:function(stats,context,networkDetails){_this.resetLoader(frag,loader),reject(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:frag,error:new Error("Aborted"),networkDetails:networkDetails,stats:stats}))},onTimeout:function(stats,context,networkDetails){_this.resetLoader(frag,loader),reject(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:frag,error:new Error("Timeout after "+loaderConfig.timeout+"ms"),networkDetails:networkDetails,stats:stats}))},onProgress:function(stats,context,data,networkDetails){_onProgress&&_onProgress({frag:frag,part:null,payload:data,networkDetails:networkDetails})}})}))},_proto.loadPart=function(frag,part,onProgress){var _this2=this;this.abort();var config=this.config,FragmentILoader=config.fLoader,DefaultILoader=config.loader;return new Promise((function(resolve,reject){if(_this2.loader&&_this2.loader.destroy(),frag.gap||part.gap)reject(createGapLoadError(frag,part));else{var loader=_this2.loader=frag.loader=FragmentILoader?new FragmentILoader(config):new DefaultILoader(config),loaderContext=createLoaderContext(frag,part),loadPolicy=getLoaderConfigWithoutReties(config.fragLoadPolicy.default),loaderConfig={loadPolicy:loadPolicy,timeout:loadPolicy.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:MIN_CHUNK_SIZE};part.stats=loader.stats,loader.load(loaderContext,loaderConfig,{onSuccess:function(response,stats,context,networkDetails){_this2.resetLoader(frag,loader),_this2.updateStatsFromPart(frag,part);var partLoadedData={frag:frag,part:part,payload:response.data,networkDetails:networkDetails};onProgress(partLoadedData),resolve(partLoadedData)},onError:function(response,context,networkDetails,stats){_this2.resetLoader(frag,loader),reject(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:frag,part:part,response:_objectSpread2({url:loaderContext.url,data:void 0},response),error:new Error("HTTP Error "+response.code+" "+response.text),networkDetails:networkDetails,stats:stats}))},onAbort:function(stats,context,networkDetails){frag.stats.aborted=part.stats.aborted,_this2.resetLoader(frag,loader),reject(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:frag,part:part,error:new Error("Aborted"),networkDetails:networkDetails,stats:stats}))},onTimeout:function(stats,context,networkDetails){_this2.resetLoader(frag,loader),reject(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:frag,part:part,error:new Error("Timeout after "+loaderConfig.timeout+"ms"),networkDetails:networkDetails,stats:stats}))}})}}))},_proto.updateStatsFromPart=function(frag,part){var fragStats=frag.stats,partStats=part.stats,partTotal=partStats.total;if(fragStats.loaded+=partStats.loaded,partTotal){var estTotalParts=Math.round(frag.duration/part.duration),estLoadedParts=Math.min(Math.round(fragStats.loaded/partTotal),estTotalParts),estRemainingBytes=(estTotalParts-estLoadedParts)*Math.round(fragStats.loaded/estLoadedParts);fragStats.total=fragStats.loaded+estRemainingBytes}else fragStats.total=Math.max(fragStats.loaded,fragStats.total);var fragLoading=fragStats.loading,partLoading=partStats.loading;fragLoading.start?fragLoading.first+=partLoading.first-partLoading.start:(fragLoading.start=partLoading.start,fragLoading.first=partLoading.first),fragLoading.end=partLoading.end},_proto.resetLoader=function(frag,loader){frag.loader=null,this.loader===loader&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),loader.destroy()},FragmentLoader})();function createLoaderContext(frag,part){void 0===part&&(part=null);var segment=part||frag,loaderContext={frag:frag,part:part,responseType:"arraybuffer",url:segment.url,headers:{},rangeStart:0,rangeEnd:0},start=segment.byteRangeStartOffset,end=segment.byteRangeEndOffset;if(isFiniteNumber(start)&&isFiniteNumber(end)){var _frag$decryptdata,byteRangeStart=start,byteRangeEnd=end;if("initSegment"===frag.sn&&"AES-128"===(null==(_frag$decryptdata=frag.decryptdata)?void 0:_frag$decryptdata.method)){var fragmentLen=end-start;fragmentLen%16&&(byteRangeEnd=end+(16-fragmentLen%16)),0!==start&&(loaderContext.resetIV=!0,byteRangeStart=start-16)}loaderContext.rangeStart=byteRangeStart,loaderContext.rangeEnd=byteRangeEnd}return loaderContext}function createGapLoadError(frag,part){var error=new Error("GAP "+(frag.gap?"tag":"attribute")+" found"),errorData={type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_GAP,fatal:!1,frag:frag,error:error,networkDetails:null};return part&&(errorData.part=part),(part||frag).stats.aborted=!0,new LoadError(errorData)}var LoadError=(function(_Error){function LoadError(data){var _this3;return(_this3=_Error.call(this,data.error.message)||this).data=void 0,_this3.data=data,_this3}return _inheritsLoose(LoadError,_Error),LoadError})(_wrapNativeSuper(Error)),AESCrypto=(function(){function AESCrypto(subtle,iv){this.subtle=void 0,this.aesIV=void 0,this.subtle=subtle,this.aesIV=iv}return AESCrypto.prototype.decrypt=function(data,key){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},key,data)},AESCrypto})(),FastAESKey=(function(){function FastAESKey(subtle,key){this.subtle=void 0,this.key=void 0,this.subtle=subtle,this.key=key}return FastAESKey.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},FastAESKey})();function removePadding(array){var outputBytes=array.byteLength,paddingBytes=outputBytes&&new DataView(array.buffer).getUint8(outputBytes-1);return paddingBytes?sliceUint8(array,0,outputBytes-paddingBytes):array}var AESDecryptor=(function(){function AESDecryptor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var _proto=AESDecryptor.prototype;return _proto.uint8ArrayToUint32Array_=function(arrayBuffer){for(var view=new DataView(arrayBuffer),newArray=new Uint32Array(4),i=0;i<4;i++)newArray[i]=view.getUint32(4*i);return newArray},_proto.initTable=function(){var sBox=this.sBox,invSBox=this.invSBox,subMix=this.subMix,subMix0=subMix[0],subMix1=subMix[1],subMix2=subMix[2],subMix3=subMix[3],invSubMix=this.invSubMix,invSubMix0=invSubMix[0],invSubMix1=invSubMix[1],invSubMix2=invSubMix[2],invSubMix3=invSubMix[3],d=new Uint32Array(256),x=0,xi=0,i=0;for(i=0;i<256;i++)d[i]=i<128?i<<1:i<<1^283;for(i=0;i<256;i++){var sx=xi^xi<<1^xi<<2^xi<<3^xi<<4;sx=sx>>>8^255&sx^99,sBox[x]=sx,invSBox[sx]=x;var x2=d[x],x4=d[x2],x8=d[x4],t=257*d[sx]^16843008*sx;subMix0[x]=t<<24|t>>>8,subMix1[x]=t<<16|t>>>16,subMix2[x]=t<<8|t>>>24,subMix3[x]=t,t=16843009*x8^65537*x4^257*x2^16843008*x,invSubMix0[sx]=t<<24|t>>>8,invSubMix1[sx]=t<<16|t>>>16,invSubMix2[sx]=t<<8|t>>>24,invSubMix3[sx]=t,x?(x=x2^d[d[d[x8^x2]]],xi^=d[d[xi]]):x=xi=1}},_proto.expandKey=function(keyBuffer){for(var key=this.uint8ArrayToUint32Array_(keyBuffer),sameKey=!0,offset=0;offset<key.length&&sameKey;)sameKey=key[offset]===this.key[offset],offset++;if(!sameKey){this.key=key;var keySize=this.keySize=key.length;if(4!==keySize&&6!==keySize&&8!==keySize)throw new Error("Invalid aes key size="+keySize);var ksRow,invKsRow,prev,t,ksRows=this.ksRows=4*(keySize+6+1),keySchedule=this.keySchedule=new Uint32Array(ksRows),invKeySchedule=this.invKeySchedule=new Uint32Array(ksRows),sbox=this.sBox,rcon=this.rcon,invSubMix=this.invSubMix,invSubMix0=invSubMix[0],invSubMix1=invSubMix[1],invSubMix2=invSubMix[2],invSubMix3=invSubMix[3];for(ksRow=0;ksRow<ksRows;ksRow++)ksRow<keySize?prev=keySchedule[ksRow]=key[ksRow]:(t=prev,ksRow%keySize==0?(t=sbox[(t=t<<8|t>>>24)>>>24]<<24|sbox[t>>>16&255]<<16|sbox[t>>>8&255]<<8|sbox[255&t],t^=rcon[ksRow/keySize|0]<<24):keySize>6&&ksRow%keySize==4&&(t=sbox[t>>>24]<<24|sbox[t>>>16&255]<<16|sbox[t>>>8&255]<<8|sbox[255&t]),keySchedule[ksRow]=prev=(keySchedule[ksRow-keySize]^t)>>>0);for(invKsRow=0;invKsRow<ksRows;invKsRow++)ksRow=ksRows-invKsRow,t=3&invKsRow?keySchedule[ksRow]:keySchedule[ksRow-4],invKeySchedule[invKsRow]=invKsRow<4||ksRow<=4?t:invSubMix0[sbox[t>>>24]]^invSubMix1[sbox[t>>>16&255]]^invSubMix2[sbox[t>>>8&255]]^invSubMix3[sbox[255&t]],invKeySchedule[invKsRow]=invKeySchedule[invKsRow]>>>0}},_proto.networkToHostOrderSwap=function(word){return word<<24|(65280&word)<<8|(16711680&word)>>8|word>>>24},_proto.decrypt=function(inputArrayBuffer,offset,aesIV){for(var t0,t1,t2,t3,s0,s1,s2,s3,inputWords0,inputWords1,inputWords2,inputWords3,ksRow,i,nRounds=this.keySize+6,invKeySchedule=this.invKeySchedule,invSBOX=this.invSBox,invSubMix=this.invSubMix,invSubMix0=invSubMix[0],invSubMix1=invSubMix[1],invSubMix2=invSubMix[2],invSubMix3=invSubMix[3],initVector=this.uint8ArrayToUint32Array_(aesIV),initVector0=initVector[0],initVector1=initVector[1],initVector2=initVector[2],initVector3=initVector[3],inputInt32=new Int32Array(inputArrayBuffer),outputInt32=new Int32Array(inputInt32.length),swapWord=this.networkToHostOrderSwap;offset<inputInt32.length;){for(inputWords0=swapWord(inputInt32[offset]),inputWords1=swapWord(inputInt32[offset+1]),inputWords2=swapWord(inputInt32[offset+2]),inputWords3=swapWord(inputInt32[offset+3]),s0=inputWords0^invKeySchedule[0],s1=inputWords3^invKeySchedule[1],s2=inputWords2^invKeySchedule[2],s3=inputWords1^invKeySchedule[3],ksRow=4,i=1;i<nRounds;i++)t0=invSubMix0[s0>>>24]^invSubMix1[s1>>16&255]^invSubMix2[s2>>8&255]^invSubMix3[255&s3]^invKeySchedule[ksRow],t1=invSubMix0[s1>>>24]^invSubMix1[s2>>16&255]^invSubMix2[s3>>8&255]^invSubMix3[255&s0]^invKeySchedule[ksRow+1],t2=invSubMix0[s2>>>24]^invSubMix1[s3>>16&255]^invSubMix2[s0>>8&255]^invSubMix3[255&s1]^invKeySchedule[ksRow+2],t3=invSubMix0[s3>>>24]^invSubMix1[s0>>16&255]^invSubMix2[s1>>8&255]^invSubMix3[255&s2]^invKeySchedule[ksRow+3],s0=t0,s1=t1,s2=t2,s3=t3,ksRow+=4;t0=invSBOX[s0>>>24]<<24^invSBOX[s1>>16&255]<<16^invSBOX[s2>>8&255]<<8^invSBOX[255&s3]^invKeySchedule[ksRow],t1=invSBOX[s1>>>24]<<24^invSBOX[s2>>16&255]<<16^invSBOX[s3>>8&255]<<8^invSBOX[255&s0]^invKeySchedule[ksRow+1],t2=invSBOX[s2>>>24]<<24^invSBOX[s3>>16&255]<<16^invSBOX[s0>>8&255]<<8^invSBOX[255&s1]^invKeySchedule[ksRow+2],t3=invSBOX[s3>>>24]<<24^invSBOX[s0>>16&255]<<16^invSBOX[s1>>8&255]<<8^invSBOX[255&s2]^invKeySchedule[ksRow+3],outputInt32[offset]=swapWord(t0^initVector0),outputInt32[offset+1]=swapWord(t3^initVector1),outputInt32[offset+2]=swapWord(t2^initVector2),outputInt32[offset+3]=swapWord(t1^initVector3),initVector0=inputWords0,initVector1=inputWords1,initVector2=inputWords2,initVector3=inputWords3,offset+=4}return outputInt32.buffer},AESDecryptor})(),CHUNK_SIZE=16,Decrypter=(function(){function Decrypter(config,_temp){var _ref$removePKCS7Paddi=(void 0===_temp?{}:_temp).removePKCS7Padding,removePKCS7Padding=void 0===_ref$removePKCS7Paddi||_ref$removePKCS7Paddi;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=config.enableSoftwareAES,this.removePKCS7Padding=removePKCS7Padding,removePKCS7Padding)try{var browserCrypto=self.crypto;browserCrypto&&(this.subtle=browserCrypto.subtle||browserCrypto.webkitSubtle)}catch(e){}null===this.subtle&&(this.useSoftware=!0)}var _proto=Decrypter.prototype;return _proto.destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},_proto.isSync=function(){return this.useSoftware},_proto.flush=function(){var currentResult=this.currentResult,remainderData=this.remainderData;if(!currentResult||remainderData)return this.reset(),null;var data=new Uint8Array(currentResult);return this.reset(),this.removePKCS7Padding?removePadding(data):data},_proto.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},_proto.decrypt=function(data,key,iv){var _this=this;return this.useSoftware?new Promise((function(resolve,reject){_this.softwareDecrypt(new Uint8Array(data),key,iv);var decryptResult=_this.flush();decryptResult?resolve(decryptResult.buffer):reject(new Error("[softwareDecrypt] Failed to decrypt data"))})):this.webCryptoDecrypt(new Uint8Array(data),key,iv)},_proto.softwareDecrypt=function(data,key,iv){var currentIV=this.currentIV,currentResult=this.currentResult,remainderData=this.remainderData;this.logOnce("JS AES decrypt"),remainderData&&(data=appendUint8Array(remainderData,data),this.remainderData=null);var currentChunk=this.getValidChunk(data);if(!currentChunk.length)return null;currentIV&&(iv=currentIV);var softwareDecrypter=this.softwareDecrypter;softwareDecrypter||(softwareDecrypter=this.softwareDecrypter=new AESDecryptor),softwareDecrypter.expandKey(key);var result=currentResult;return this.currentResult=softwareDecrypter.decrypt(currentChunk.buffer,0,iv),this.currentIV=sliceUint8(currentChunk,-16).buffer,result||null},_proto.webCryptoDecrypt=function(data,key,iv){var _this2=this,subtle=this.subtle;return this.key===key&&this.fastAesKey||(this.key=key,this.fastAesKey=new FastAESKey(subtle,key)),this.fastAesKey.expandKey().then((function(aesKey){return subtle?(_this2.logOnce("WebCrypto AES decrypt"),new AESCrypto(subtle,new Uint8Array(iv)).decrypt(data.buffer,aesKey)):Promise.reject(new Error("web crypto not initialized"))})).catch((function(err){return logger.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+err.name+": "+err.message),_this2.onWebCryptoError(data,key,iv)}))},_proto.onWebCryptoError=function(data,key,iv){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(data,key,iv);var decryptResult=this.flush();if(decryptResult)return decryptResult.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")},_proto.getValidChunk=function(data){var currentChunk=data,splitPoint=data.length-data.length%CHUNK_SIZE;return splitPoint!==data.length&&(currentChunk=sliceUint8(data,0,splitPoint),this.remainderData=sliceUint8(data,splitPoint)),currentChunk},_proto.logOnce=function(msg){this.logEnabled&&(logger.log("[decrypter]: "+msg),this.logEnabled=!1)},Decrypter})(),TimeRanges={toString:function(r){for(var log="",len=r.length,i=0;i<len;i++)log+="["+r.start(i).toFixed(3)+"-"+r.end(i).toFixed(3)+"]";return log}},State={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},BaseStreamController=(function(_TaskLoop){function BaseStreamController(hls,fragmentTracker,keyLoader,logPrefix,playlistType){var _this;return(_this=_TaskLoop.call(this)||this).hls=void 0,_this.fragPrevious=null,_this.fragCurrent=null,_this.fragmentTracker=void 0,_this.transmuxer=null,_this._state=State.STOPPED,_this.playlistType=void 0,_this.media=null,_this.mediaBuffer=null,_this.config=void 0,_this.bitrateTest=!1,_this.lastCurrentTime=0,_this.nextLoadPosition=0,_this.startPosition=0,_this.startTimeOffset=null,_this.loadedmetadata=!1,_this.retryDate=0,_this.levels=null,_this.fragmentLoader=void 0,_this.keyLoader=void 0,_this.levelLastLoaded=null,_this.startFragRequested=!1,_this.decrypter=void 0,_this.initPTS=[],_this.onvseeking=null,_this.onvended=null,_this.logPrefix="",_this.log=void 0,_this.warn=void 0,_this.playlistType=playlistType,_this.logPrefix=logPrefix,_this.log=logger.log.bind(logger,logPrefix+":"),_this.warn=logger.warn.bind(logger,logPrefix+":"),_this.hls=hls,_this.fragmentLoader=new FragmentLoader(hls.config),_this.keyLoader=keyLoader,_this.fragmentTracker=fragmentTracker,_this.config=hls.config,_this.decrypter=new Decrypter(hls.config),hls.on(Events.MANIFEST_LOADED,_this.onManifestLoaded,_assertThisInitialized(_this)),_this}_inheritsLoose(BaseStreamController,_TaskLoop);var _proto=BaseStreamController.prototype;return _proto.doTick=function(){this.onTickEnd()},_proto.onTickEnd=function(){},_proto.startLoad=function(startPosition){},_proto.stopLoad=function(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);var frag=this.fragCurrent;null!=frag&&frag.loader&&(frag.abortRequests(),this.fragmentTracker.removeFragment(frag)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=State.STOPPED},_proto._streamEnded=function(bufferInfo,levelDetails){if(levelDetails.live||bufferInfo.nextStart||!bufferInfo.end||!this.media)return!1;var partList=levelDetails.partList;if(null!=partList&&partList.length){var lastPart=partList[partList.length-1];return BufferHelper.isBuffered(this.media,lastPart.start+lastPart.duration/2)}var playlistType=levelDetails.fragments[levelDetails.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(playlistType)},_proto.getLevelDetails=function(){var _this$levelLastLoaded;if(this.levels&&null!==this.levelLastLoaded)return null==(_this$levelLastLoaded=this.levelLastLoaded)?void 0:_this$levelLastLoaded.details},_proto.onMediaAttached=function(event,data){var media=this.media=this.mediaBuffer=data.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),media.addEventListener("seeking",this.onvseeking),media.addEventListener("ended",this.onvended);var config=this.config;this.levels&&config.autoStartLoad&&this.state===State.STOPPED&&this.startLoad(config.startPosition)},_proto.onMediaDetaching=function(){var media=this.media;null!=media&&media.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),media&&this.onvseeking&&this.onvended&&(media.removeEventListener("seeking",this.onvseeking),media.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},_proto.onMediaSeeking=function(){var config=this.config,fragCurrent=this.fragCurrent,media=this.media,mediaBuffer=this.mediaBuffer,state=this.state,currentTime=media?media.currentTime:0,bufferInfo=BufferHelper.bufferInfo(mediaBuffer||media,currentTime,config.maxBufferHole);if(this.log("media seeking to "+(isFiniteNumber(currentTime)?currentTime.toFixed(3):currentTime)+", state: "+state),this.state===State.ENDED)this.resetLoadingState();else if(fragCurrent){var tolerance=config.maxFragLookUpTolerance,fragStartOffset=fragCurrent.start-tolerance,fragEndOffset=fragCurrent.start+fragCurrent.duration+tolerance;if(!bufferInfo.len||fragEndOffset<bufferInfo.start||fragStartOffset>bufferInfo.end){var pastFragment=currentTime>fragEndOffset;(currentTime<fragStartOffset||pastFragment)&&(pastFragment&&fragCurrent.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),fragCurrent.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}media&&(this.fragmentTracker.removeFragmentsInRange(currentTime,1/0,this.playlistType,!0),this.lastCurrentTime=currentTime),this.loadedmetadata||bufferInfo.len||(this.nextLoadPosition=this.startPosition=currentTime),this.tickImmediate()},_proto.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},_proto.onManifestLoaded=function(event,data){this.startTimeOffset=data.startTimeOffset,this.initPTS=[]},_proto.onHandlerDestroying=function(){this.hls.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),this.stopLoad(),_TaskLoop.prototype.onHandlerDestroying.call(this),this.hls=null},_proto.onHandlerDestroyed=function(){this.state=State.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,_TaskLoop.prototype.onHandlerDestroyed.call(this)},_proto.loadFragment=function(frag,level,targetBufferTime){this._loadFragForPlayback(frag,level,targetBufferTime)},_proto._loadFragForPlayback=function(frag,level,targetBufferTime){var _this2=this,progressCallback=function(data){if(_this2.fragContextChanged(frag))return _this2.warn("Fragment "+frag.sn+(data.part?" p: "+data.part.index:"")+" of level "+frag.level+" was dropped during download."),void _this2.fragmentTracker.removeFragment(frag);frag.stats.chunkCount++,_this2._handleFragmentLoadProgress(data)};this._doFragLoad(frag,level,targetBufferTime,progressCallback).then((function(data){if(data){var state=_this2.state;_this2.fragContextChanged(frag)?(state===State.FRAG_LOADING||!_this2.fragCurrent&&state===State.PARSING)&&(_this2.fragmentTracker.removeFragment(frag),_this2.state=State.IDLE):("payload"in data&&(_this2.log("Loaded fragment "+frag.sn+" of level "+frag.level),_this2.hls.trigger(Events.FRAG_LOADED,data)),_this2._handleFragmentLoadComplete(data))}})).catch((function(reason){_this2.state!==State.STOPPED&&_this2.state!==State.ERROR&&(_this2.warn(reason),_this2.resetFragmentLoading(frag))}))},_proto.clearTrackerIfNeeded=function(frag){var _this$mediaBuffer,fragmentTracker=this.fragmentTracker;if(fragmentTracker.getState(frag)===FragmentState.APPENDING){var playlistType=frag.type,bufferedInfo=this.getFwdBufferInfo(this.mediaBuffer,playlistType),minForwardBufferLength=Math.max(frag.duration,bufferedInfo?bufferedInfo.len:this.config.maxBufferLength);this.reduceMaxBufferLength(minForwardBufferLength)&&fragmentTracker.removeFragment(frag)}else 0===(null==(_this$mediaBuffer=this.mediaBuffer)?void 0:_this$mediaBuffer.buffered.length)?fragmentTracker.removeAllFragments():fragmentTracker.hasParts(frag.type)&&(fragmentTracker.detectPartialFragments({frag:frag,part:null,stats:frag.stats,id:frag.type}),fragmentTracker.getState(frag)===FragmentState.PARTIAL&&fragmentTracker.removeFragment(frag))},_proto.checkLiveUpdate=function(details){if(details.updated&&!details.live){var lastFragment=details.fragments[details.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:lastFragment,part:null,stats:lastFragment.stats,id:lastFragment.type})}details.fragments[0]||(details.deltaUpdateFailed=!0)},_proto.flushMainBuffer=function(startOffset,endOffset,type){if(void 0===type&&(type=null),startOffset-endOffset){var flushScope={startOffset:startOffset,endOffset:endOffset,type:type};this.hls.trigger(Events.BUFFER_FLUSHING,flushScope)}},_proto._loadInitSegment=function(frag,level){var _this3=this;this._doFragLoad(frag,level).then((function(data){if(!data||_this3.fragContextChanged(frag)||!_this3.levels)throw new Error("init load aborted");return data})).then((function(data){var hls=_this3.hls,payload=data.payload,decryptData=frag.decryptdata;if(payload&&payload.byteLength>0&&null!=decryptData&&decryptData.key&&decryptData.iv&&"AES-128"===decryptData.method){var startTime=self.performance.now();return _this3.decrypter.decrypt(new Uint8Array(payload),decryptData.key.buffer,decryptData.iv.buffer).catch((function(err){throw hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!1,error:err,reason:err.message,frag:frag}),err})).then((function(decryptedData){var endTime=self.performance.now();return hls.trigger(Events.FRAG_DECRYPTED,{frag:frag,payload:decryptedData,stats:{tstart:startTime,tdecrypt:endTime}}),data.payload=decryptedData,_this3.completeInitSegmentLoad(data)}))}return _this3.completeInitSegmentLoad(data)})).catch((function(reason){_this3.state!==State.STOPPED&&_this3.state!==State.ERROR&&(_this3.warn(reason),_this3.resetFragmentLoading(frag))}))},_proto.completeInitSegmentLoad=function(data){if(!this.levels)throw new Error("init load aborted, missing levels");var stats=data.frag.stats;this.state=State.IDLE,data.frag.data=new Uint8Array(data.payload),stats.parsing.start=stats.buffering.start=self.performance.now(),stats.parsing.end=stats.buffering.end=self.performance.now(),this.tick()},_proto.fragContextChanged=function(frag){var fragCurrent=this.fragCurrent;return!frag||!fragCurrent||frag.sn!==fragCurrent.sn||frag.level!==fragCurrent.level},_proto.fragBufferedComplete=function(frag,part){var _frag$startPTS,_frag$endPTS,_this$fragCurrent,_this$fragPrevious,media=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log("Buffered "+frag.type+" sn: "+frag.sn+(part?" part: "+part.index:"")+" of "+(this.playlistType===PlaylistLevelType.MAIN?"level":"track")+" "+frag.level+" (frag:["+(null!=(_frag$startPTS=frag.startPTS)?_frag$startPTS:NaN).toFixed(3)+"-"+(null!=(_frag$endPTS=frag.endPTS)?_frag$endPTS:NaN).toFixed(3)+"] > buffer:"+(media?TimeRanges.toString(BufferHelper.getBuffered(media)):"(detached)")+")"),"initSegment"!==frag.sn){var _this$levels;if(frag.type!==PlaylistLevelType.SUBTITLE){var el=frag.elementaryStreams;if(!Object.keys(el).some((function(type){return!!el[type]})))return void(this.state=State.IDLE)}var level=null==(_this$levels=this.levels)?void 0:_this$levels[frag.level];null!=level&&level.fragmentError&&(this.log("Resetting level fragment error count of "+level.fragmentError+" on frag buffered"),level.fragmentError=0)}this.state=State.IDLE,media&&(!this.loadedmetadata&&frag.type==PlaylistLevelType.MAIN&&media.buffered.length&&(null==(_this$fragCurrent=this.fragCurrent)?void 0:_this$fragCurrent.sn)===(null==(_this$fragPrevious=this.fragPrevious)?void 0:_this$fragPrevious.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},_proto.seekToStartPos=function(){},_proto._handleFragmentLoadComplete=function(fragLoadedEndData){var transmuxer=this.transmuxer;if(transmuxer){var frag=fragLoadedEndData.frag,part=fragLoadedEndData.part,partsLoaded=fragLoadedEndData.partsLoaded,complete=!partsLoaded||0===partsLoaded.length||partsLoaded.some((function(fragLoaded){return!fragLoaded})),chunkMeta=new ChunkMetadata(frag.level,frag.sn,frag.stats.chunkCount+1,0,part?part.index:-1,!complete);transmuxer.flush(chunkMeta)}},_proto._handleFragmentLoadProgress=function(frag){},_proto._doFragLoad=function(frag,level,targetBufferTime,progressCallback){var _frag$decryptdata,_this4=this;void 0===targetBufferTime&&(targetBufferTime=null);var details=null==level?void 0:level.details;if(!this.levels||!details)throw new Error("frag load aborted, missing level"+(details?"":" detail")+"s");var keyLoadingPromise=null;if(!frag.encrypted||null!=(_frag$decryptdata=frag.decryptdata)&&_frag$decryptdata.key?!frag.encrypted&&details.encryptedFragments.length&&this.keyLoader.loadClear(frag,details.encryptedFragments):(this.log("Loading key for "+frag.sn+" of ["+details.startSN+"-"+details.endSN+"], "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+frag.level),this.state=State.KEY_LOADING,this.fragCurrent=frag,keyLoadingPromise=this.keyLoader.load(frag).then((function(keyLoadedData){if(!_this4.fragContextChanged(keyLoadedData.frag))return _this4.hls.trigger(Events.KEY_LOADED,keyLoadedData),_this4.state===State.KEY_LOADING&&(_this4.state=State.IDLE),keyLoadedData})),this.hls.trigger(Events.KEY_LOADING,{frag:frag}),null===this.fragCurrent&&(keyLoadingPromise=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))),targetBufferTime=Math.max(frag.start,targetBufferTime||0),this.config.lowLatencyMode&&"initSegment"!==frag.sn){var partList=details.partList;if(partList&&progressCallback){targetBufferTime>frag.end&&details.fragmentHint&&(frag=details.fragmentHint);var partIndex=this.getNextPart(partList,frag,targetBufferTime);if(partIndex>-1){var _result,part=partList[partIndex];return this.log("Loading part sn: "+frag.sn+" p: "+part.index+" cc: "+frag.cc+" of playlist ["+details.startSN+"-"+details.endSN+"] parts [0-"+partIndex+"-"+(partList.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+frag.level+", target: "+parseFloat(targetBufferTime.toFixed(3))),this.nextLoadPosition=part.start+part.duration,this.state=State.FRAG_LOADING,_result=keyLoadingPromise?keyLoadingPromise.then((function(keyLoadedData){return!keyLoadedData||_this4.fragContextChanged(keyLoadedData.frag)?null:_this4.doFragPartsLoad(frag,part,level,progressCallback)})).catch((function(error){return _this4.handleFragLoadError(error)})):this.doFragPartsLoad(frag,part,level,progressCallback).catch((function(error){return _this4.handleFragLoadError(error)})),this.hls.trigger(Events.FRAG_LOADING,{frag:frag,part:part,targetBufferTime:targetBufferTime}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):_result}if(!frag.url||this.loadedEndOfParts(partList,targetBufferTime))return Promise.resolve(null)}}this.log("Loading fragment "+frag.sn+" cc: "+frag.cc+" "+(details?"of ["+details.startSN+"-"+details.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+frag.level+", target: "+parseFloat(targetBufferTime.toFixed(3))),isFiniteNumber(frag.sn)&&!this.bitrateTest&&(this.nextLoadPosition=frag.start+frag.duration),this.state=State.FRAG_LOADING;var result,dataOnProgress=this.config.progressive;return result=dataOnProgress&&keyLoadingPromise?keyLoadingPromise.then((function(keyLoadedData){return!keyLoadedData||_this4.fragContextChanged(null==keyLoadedData?void 0:keyLoadedData.frag)?null:_this4.fragmentLoader.load(frag,progressCallback)})).catch((function(error){return _this4.handleFragLoadError(error)})):Promise.all([this.fragmentLoader.load(frag,dataOnProgress?progressCallback:void 0),keyLoadingPromise]).then((function(_ref){var fragLoadedData=_ref[0];return!dataOnProgress&&fragLoadedData&&progressCallback&&progressCallback(fragLoadedData),fragLoadedData})).catch((function(error){return _this4.handleFragLoadError(error)})),this.hls.trigger(Events.FRAG_LOADING,{frag:frag,targetBufferTime:targetBufferTime}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):result},_proto.doFragPartsLoad=function(frag,fromPart,level,progressCallback){var _this5=this;return new Promise((function(resolve,reject){var _level$details,partsLoaded=[],initialPartList=null==(_level$details=level.details)?void 0:_level$details.partList;!(function loadPart(part){_this5.fragmentLoader.loadPart(frag,part,progressCallback).then((function(partLoadedData){partsLoaded[part.index]=partLoadedData;var loadedPart=partLoadedData.part;_this5.hls.trigger(Events.FRAG_LOADED,partLoadedData);var nextPart=getPartWith(level,frag.sn,part.index+1)||findPart(initialPartList,frag.sn,part.index+1);if(!nextPart)return resolve({frag:frag,part:loadedPart,partsLoaded:partsLoaded});loadPart(nextPart)})).catch(reject)})(fromPart)}))},_proto.handleFragLoadError=function(error){if("data"in error){var data=error.data;error.data&&data.details===ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(data.frag,data.part):this.hls.trigger(Events.ERROR,data)}else this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,err:error,error:error,fatal:!0});return null},_proto._handleTransmuxerFlush=function(chunkMeta){var context=this.getCurrentContext(chunkMeta);if(context&&this.state===State.PARSING){var frag=context.frag,part=context.part,level=context.level,now=self.performance.now();frag.stats.parsing.end=now,part&&(part.stats.parsing.end=now),this.updateLevelTiming(frag,part,level,chunkMeta.partial)}else this.fragCurrent||this.state===State.STOPPED||this.state===State.ERROR||(this.state=State.IDLE)},_proto.getCurrentContext=function(chunkMeta){var levels=this.levels,fragCurrent=this.fragCurrent,levelIndex=chunkMeta.level,sn=chunkMeta.sn,partIndex=chunkMeta.part;if(null==levels||!levels[levelIndex])return this.warn("Levels object was unset while buffering fragment "+sn+" of level "+levelIndex+". The current chunk will not be buffered."),null;var level=levels[levelIndex],part=partIndex>-1?getPartWith(level,sn,partIndex):null,frag=part?part.fragment:getFragmentWithSN(level,sn,fragCurrent);return frag?(fragCurrent&&fragCurrent!==frag&&(frag.stats=fragCurrent.stats),{frag:frag,part:part,level:level}):null},_proto.bufferFragmentData=function(data,frag,part,chunkMeta,noBacktracking){var _buffer;if(data&&this.state===State.PARSING){var data1=data.data1,data2=data.data2,buffer=data1;if(data1&&data2&&(buffer=appendUint8Array(data1,data2)),null!=(_buffer=buffer)&&_buffer.length){var segment={type:data.type,frag:frag,part:part,chunkMeta:chunkMeta,parent:frag.type,data:buffer};if(this.hls.trigger(Events.BUFFER_APPENDING,segment),data.dropped&&data.independent&&!part){if(noBacktracking)return;this.flushBufferGap(frag)}}}},_proto.flushBufferGap=function(frag){var media=this.media;if(media)if(BufferHelper.isBuffered(media,media.currentTime)){var currentTime=media.currentTime,bufferInfo=BufferHelper.bufferInfo(media,currentTime,0),fragDuration=frag.duration,segmentFraction=Math.min(2*this.config.maxFragLookUpTolerance,.25*fragDuration),start=Math.max(Math.min(frag.start-segmentFraction,bufferInfo.end-segmentFraction),currentTime+segmentFraction);frag.start-start>segmentFraction&&this.flushMainBuffer(start,frag.start)}else this.flushMainBuffer(0,frag.start)},_proto.getFwdBufferInfo=function(bufferable,type){var pos=this.getLoadPosition();return isFiniteNumber(pos)?this.getFwdBufferInfoAtPos(bufferable,pos,type):null},_proto.getFwdBufferInfoAtPos=function(bufferable,pos,type){var maxBufferHole=this.config.maxBufferHole,bufferInfo=BufferHelper.bufferInfo(bufferable,pos,maxBufferHole);if(0===bufferInfo.len&&void 0!==bufferInfo.nextStart){var bufferedFragAtPos=this.fragmentTracker.getBufferedFrag(pos,type);if(bufferedFragAtPos&&bufferInfo.nextStart<bufferedFragAtPos.end)return BufferHelper.bufferInfo(bufferable,pos,Math.max(bufferInfo.nextStart,maxBufferHole))}return bufferInfo},_proto.getMaxBufferLength=function(levelBitrate){var maxBufLen,config=this.config;return maxBufLen=levelBitrate?Math.max(8*config.maxBufferSize/levelBitrate,config.maxBufferLength):config.maxBufferLength,Math.min(maxBufLen,config.maxMaxBufferLength)},_proto.reduceMaxBufferLength=function(threshold){var config=this.config,minLength=threshold||config.maxBufferLength;return config.maxMaxBufferLength>=minLength&&(config.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+config.maxMaxBufferLength+"s"),!0)},_proto.getAppendedFrag=function(position,playlistType){var fragOrPart=this.fragmentTracker.getAppendedFrag(position,PlaylistLevelType.MAIN);return fragOrPart&&"fragment"in fragOrPart?fragOrPart.fragment:fragOrPart},_proto.getNextFragment=function(pos,levelDetails){var fragments=levelDetails.fragments,fragLen=fragments.length;if(!fragLen)return null;var frag,config=this.config,start=fragments[0].start;if(levelDetails.live){var initialLiveManifestSize=config.initialLiveManifestSize;if(fragLen<initialLiveManifestSize)return this.warn("Not enough fragments to start playback (have: "+fragLen+", need: "+initialLiveManifestSize+")"),null;(!levelDetails.PTSKnown&&!this.startFragRequested&&-1===this.startPosition||pos<start)&&(frag=this.getInitialLiveFragment(levelDetails,fragments),this.startPosition=this.nextLoadPosition=frag?this.hls.liveSyncPosition||frag.start:pos)}else pos<=start&&(frag=fragments[0]);if(!frag){var end=config.lowLatencyMode?levelDetails.partEnd:levelDetails.fragmentEnd;frag=this.getFragmentAtPosition(pos,end,levelDetails)}return this.mapToInitFragWhenRequired(frag)},_proto.isLoopLoading=function(frag,targetBufferTime){var trackerState=this.fragmentTracker.getState(frag);return(trackerState===FragmentState.OK||trackerState===FragmentState.PARTIAL&&!!frag.gap)&&this.nextLoadPosition>targetBufferTime},_proto.getNextFragmentLoopLoading=function(frag,levelDetails,bufferInfo,playlistType,maxBufLen){var gapStart=frag.gap,nextFragment=this.getNextFragment(this.nextLoadPosition,levelDetails);if(null===nextFragment)return nextFragment;if(frag=nextFragment,gapStart&&frag&&!frag.gap&&bufferInfo.nextStart){var nextbufferInfo=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,bufferInfo.nextStart,playlistType);if(null!==nextbufferInfo&&bufferInfo.len+nextbufferInfo.len>=maxBufLen)return this.log('buffer full after gaps in "'+playlistType+'" playlist starting at sn: '+frag.sn),null}return frag},_proto.mapToInitFragWhenRequired=function(frag){return null==frag||!frag.initSegment||null!=frag&&frag.initSegment.data||this.bitrateTest?frag:frag.initSegment},_proto.getNextPart=function(partList,frag,targetBufferTime){for(var nextPart=-1,contiguous=!1,independentAttrOmitted=!0,i=0,len=partList.length;i<len;i++){var part=partList[i];if(independentAttrOmitted=independentAttrOmitted&&!part.independent,nextPart>-1&&targetBufferTime<part.start)break;var loaded=part.loaded;loaded?nextPart=-1:(contiguous||part.independent||independentAttrOmitted)&&part.fragment===frag&&(nextPart=i),contiguous=loaded}return nextPart},_proto.loadedEndOfParts=function(partList,targetBufferTime){var lastPart=partList[partList.length-1];return lastPart&&targetBufferTime>lastPart.start&&lastPart.loaded},_proto.getInitialLiveFragment=function(levelDetails,fragments){var fragPrevious=this.fragPrevious,frag=null;if(fragPrevious){if(levelDetails.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+fragPrevious.programDateTime),frag=findFragmentByPDT(fragments,fragPrevious.endProgramDateTime,this.config.maxFragLookUpTolerance)),!frag){var targetSN=fragPrevious.sn+1;if(targetSN>=levelDetails.startSN&&targetSN<=levelDetails.endSN){var fragNext=fragments[targetSN-levelDetails.startSN];fragPrevious.cc===fragNext.cc&&(frag=fragNext,this.log("Live playlist, switching playlist, load frag with next SN: "+frag.sn))}frag||(frag=findFragWithCC(fragments,fragPrevious.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+frag.sn)}}else{var liveStart=this.hls.liveSyncPosition;null!==liveStart&&(frag=this.getFragmentAtPosition(liveStart,this.bitrateTest?levelDetails.fragmentEnd:levelDetails.edge,levelDetails))}return frag},_proto.getFragmentAtPosition=function(bufferEnd,end,levelDetails){var frag,config=this.config,fragPrevious=this.fragPrevious,fragments=levelDetails.fragments,endSN=levelDetails.endSN,fragmentHint=levelDetails.fragmentHint,tolerance=config.maxFragLookUpTolerance,partList=levelDetails.partList,loadingParts=!!(config.lowLatencyMode&&null!=partList&&partList.length&&fragmentHint);if(loadingParts&&fragmentHint&&!this.bitrateTest&&(fragments=fragments.concat(fragmentHint),endSN=fragmentHint.sn),frag=bufferEnd<end?findFragmentByPTS(fragPrevious,fragments,bufferEnd,bufferEnd>end-tolerance?0:tolerance):fragments[fragments.length-1]){var curSNIdx=frag.sn-levelDetails.startSN,fragState=this.fragmentTracker.getState(frag);if((fragState===FragmentState.OK||fragState===FragmentState.PARTIAL&&frag.gap)&&(fragPrevious=frag),fragPrevious&&frag.sn===fragPrevious.sn&&(!loadingParts||partList[0].fragment.sn>frag.sn)&&fragPrevious&&frag.level===fragPrevious.level){var nextFrag=fragments[curSNIdx+1];frag=frag.sn<endSN&&this.fragmentTracker.getState(nextFrag)!==FragmentState.OK?nextFrag:null}}return frag},_proto.synchronizeToLiveEdge=function(levelDetails){var config=this.config,media=this.media;if(media){var liveSyncPosition=this.hls.liveSyncPosition,currentTime=media.currentTime,start=levelDetails.fragments[0].start,end=levelDetails.edge,withinSlidingWindow=currentTime>=start-config.maxFragLookUpTolerance&&currentTime<=end;if(null!==liveSyncPosition&&media.duration>liveSyncPosition&&(currentTime<liveSyncPosition||!withinSlidingWindow)){var maxLatency=void 0!==config.liveMaxLatencyDuration?config.liveMaxLatencyDuration:config.liveMaxLatencyDurationCount*levelDetails.targetduration;(!withinSlidingWindow&&media.readyState<4||currentTime<end-maxLatency)&&(this.loadedmetadata||(this.nextLoadPosition=liveSyncPosition),media.readyState&&(this.warn("Playback: "+currentTime.toFixed(3)+" is located too far from the end of live sliding playlist: "+end+", reset currentTime to : "+liveSyncPosition.toFixed(3)),media.currentTime=liveSyncPosition))}}},_proto.alignPlaylists=function(details,previousDetails,switchDetails){var length=details.fragments.length;if(!length)return this.warn("No fragments in live playlist"),0;var slidingStart=details.fragments[0].start,firstLevelLoad=!previousDetails,aligned=details.alignedSliding&&isFiniteNumber(slidingStart);if(firstLevelLoad||!aligned&&!slidingStart){var fragPrevious=this.fragPrevious;alignStream(fragPrevious,switchDetails,details);var alignedSlidingStart=details.fragments[0].start;return this.log("Live playlist sliding: "+alignedSlidingStart.toFixed(2)+" start-sn: "+(previousDetails?previousDetails.startSN:"na")+"->"+details.startSN+" prev-sn: "+(fragPrevious?fragPrevious.sn:"na")+" fragments: "+length),alignedSlidingStart}return slidingStart},_proto.waitForCdnTuneIn=function(details){var advancePartLimit=3;return details.live&&details.canBlockReload&&details.partTarget&&details.tuneInGoal>Math.max(details.partHoldBack,details.partTarget*advancePartLimit)},_proto.setStartPosition=function(details,sliding){var startPosition=this.startPosition;if(startPosition<sliding&&(startPosition=-1),-1===startPosition||-1===this.lastCurrentTime){var offsetInMultivariantPlaylist=null!==this.startTimeOffset,startTimeOffset=offsetInMultivariantPlaylist?this.startTimeOffset:details.startTimeOffset;null!==startTimeOffset&&isFiniteNumber(startTimeOffset)?(startPosition=sliding+startTimeOffset,startTimeOffset<0&&(startPosition+=details.totalduration),startPosition=Math.min(Math.max(sliding,startPosition),sliding+details.totalduration),this.log("Start time offset "+startTimeOffset+" found in "+(offsetInMultivariantPlaylist?"multivariant":"media")+" playlist, adjust startPosition to "+startPosition),this.startPosition=startPosition):details.live?startPosition=this.hls.liveSyncPosition||sliding:this.startPosition=startPosition=0,this.lastCurrentTime=startPosition}this.nextLoadPosition=startPosition},_proto.getLoadPosition=function(){var media=this.media,pos=0;return this.loadedmetadata&&media?pos=media.currentTime:this.nextLoadPosition&&(pos=this.nextLoadPosition),pos},_proto.handleFragLoadAborted=function(frag,part){this.transmuxer&&"initSegment"!==frag.sn&&frag.stats.aborted&&(this.warn("Fragment "+frag.sn+(part?" part "+part.index:"")+" of level "+frag.level+" was aborted"),this.resetFragmentLoading(frag))},_proto.resetFragmentLoading=function(frag){this.fragCurrent&&(this.fragContextChanged(frag)||this.state===State.FRAG_LOADING_WAITING_RETRY)||(this.state=State.IDLE)},_proto.onFragmentOrKeyLoadError=function(filterType,data){if(data.chunkMeta&&!data.frag){var context=this.getCurrentContext(data.chunkMeta);context&&(data.frag=context.frag)}var frag=data.frag;if(frag&&frag.type===filterType&&this.levels)if(this.fragContextChanged(frag)){var _this$fragCurrent2;this.warn("Frag load error must match current frag to retry "+frag.url+" > "+(null==(_this$fragCurrent2=this.fragCurrent)?void 0:_this$fragCurrent2.url))}else{var gapTagEncountered=data.details===ErrorDetails.FRAG_GAP;gapTagEncountered&&this.fragmentTracker.fragBuffered(frag,!0);var errorAction=data.errorAction,_ref2=errorAction||{},action=_ref2.action,_ref2$retryCount=_ref2.retryCount,retryCount=void 0===_ref2$retryCount?0:_ref2$retryCount,retryConfig=_ref2.retryConfig;if(errorAction&&action===NetworkErrorAction.RetryRequest&&retryConfig){this.resetStartWhenNotLoaded(this.levelLastLoaded);var delay=getRetryDelay(retryConfig,retryCount);this.warn("Fragment "+frag.sn+" of "+filterType+" "+frag.level+" errored with "+data.details+", retrying loading "+(retryCount+1)+"/"+retryConfig.maxNumRetry+" in "+delay+"ms"),errorAction.resolved=!0,this.retryDate=self.performance.now()+delay,this.state=State.FRAG_LOADING_WAITING_RETRY}else if(retryConfig&&errorAction){if(this.resetFragmentErrors(filterType),!(retryCount<retryConfig.maxNumRetry))return void logger.warn(data.details+" reached or exceeded max retry ("+retryCount+")");gapTagEncountered||action===NetworkErrorAction.RemoveAlternatePermanently||(errorAction.resolved=!0)}else(null==errorAction?void 0:errorAction.action)===NetworkErrorAction.SendAlternateToPenaltyBox?this.state=State.WAITING_LEVEL:this.state=State.ERROR;this.tickImmediate()}},_proto.reduceLengthAndFlushBuffer=function(data){if(this.state===State.PARSING||this.state===State.PARSED){var playlistType=data.parent,bufferedInfo=this.getFwdBufferInfo(this.mediaBuffer,playlistType),buffered=bufferedInfo&&bufferedInfo.len>.5;buffered&&this.reduceMaxBufferLength(bufferedInfo.len);var flushBuffer=!buffered;return flushBuffer&&this.warn("Buffer full error while media.currentTime is not buffered, flush "+playlistType+" buffer"),data.frag&&(this.fragmentTracker.removeFragment(data.frag),this.nextLoadPosition=data.frag.start),this.resetLoadingState(),flushBuffer}return!1},_proto.resetFragmentErrors=function(filterType){filterType===PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==State.STOPPED&&(this.state=State.IDLE)},_proto.afterBufferFlushed=function(media,bufferType,playlistType){if(media){var bufferedTimeRanges=BufferHelper.getBuffered(media);this.fragmentTracker.detectEvictedFragments(bufferType,bufferedTimeRanges,playlistType),this.state===State.ENDED&&this.resetLoadingState()}},_proto.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=State.IDLE},_proto.resetStartWhenNotLoaded=function(level){if(!this.loadedmetadata){this.startFragRequested=!1;var details=level?level.details:null;null!=details&&details.live?(this.startPosition=-1,this.setStartPosition(details,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},_proto.resetWhenMissingContext=function(chunkMeta){this.warn("The loading context changed while buffering fragment "+chunkMeta.sn+" of level "+chunkMeta.level+". This chunk will not be buffered."),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()},_proto.removeUnbufferedFrags=function(start){void 0===start&&(start=0),this.fragmentTracker.removeFragmentsInRange(start,1/0,this.playlistType,!1,!0)},_proto.updateLevelTiming=function(frag,part,level,partial){var _this$transmuxer,_this6=this,details=level.details;if(details){if(!Object.keys(frag.elementaryStreams).reduce((function(result,type){var info=frag.elementaryStreams[type];if(info){var parsedDuration=info.endPTS-info.startPTS;if(parsedDuration<=0)return _this6.warn("Could not parse fragment "+frag.sn+" "+type+" duration reliably ("+parsedDuration+")"),result||!1;var drift=partial?0:updateFragPTSDTS(details,frag,info.startPTS,info.endPTS,info.startDTS,info.endDTS);return _this6.hls.trigger(Events.LEVEL_PTS_UPDATED,{details:details,level:level,drift:drift,type:type,frag:frag,start:info.startPTS,end:info.endPTS}),!0}return result}),!1)&&null===(null==(_this$transmuxer=this.transmuxer)?void 0:_this$transmuxer.error)){var error=new Error("Found no media in fragment "+frag.sn+" of level "+frag.level+" resetting transmuxer to fallback to playlist timing");if(0===level.fragmentError&&(level.fragmentError++,frag.gap=!0,this.fragmentTracker.removeFragment(frag),this.fragmentTracker.fragBuffered(frag,!0)),this.warn(error.message),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,error:error,frag:frag,reason:"Found no media in msn "+frag.sn+' of level "'+level.url+'"'}),!this.hls)return;this.resetTransmuxer()}this.state=State.PARSED,this.hls.trigger(Events.FRAG_PARSED,{frag:frag,part:part})}else this.warn("level.details undefined")},_proto.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},_proto.recoverWorkerError=function(data){"demuxerWorker"===data.event&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())},_createClass(BaseStreamController,[{key:"state",get:function(){return this._state},set:function(nextState){var previousState=this._state;previousState!==nextState&&(this._state=nextState,this.log(previousState+"->"+nextState))}}]),BaseStreamController})(TaskLoop),ChunkCache=(function(){function ChunkCache(){this.chunks=[],this.dataLength=0}var _proto=ChunkCache.prototype;return _proto.push=function(chunk){this.chunks.push(chunk),this.dataLength+=chunk.length},_proto.flush=function(){var result,chunks=this.chunks,dataLength=this.dataLength;return chunks.length?(result=1===chunks.length?chunks[0]:concatUint8Arrays(chunks,dataLength),this.reset(),result):new Uint8Array(0)},_proto.reset=function(){this.chunks.length=0,this.dataLength=0},ChunkCache})();function concatUint8Arrays(chunks,dataLength){for(var result=new Uint8Array(dataLength),offset=0,i=0;i<chunks.length;i++){var chunk=chunks[i];result.set(chunk,offset),offset+=chunk.length}return result}function dummyTrack(type,inputTimeScale){return void 0===type&&(type=""),void 0===inputTimeScale&&(inputTimeScale=9e4),{type:type,id:-1,pid:-1,inputTimeScale:inputTimeScale,sequenceNumber:-1,samples:[],dropped:0}}var BaseAudioDemuxer=(function(){function BaseAudioDemuxer(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var _proto=BaseAudioDemuxer.prototype;return _proto.resetInitSegment=function(initSegment,audioCodec,videoCodec,trackDuration){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},_proto.resetTimeStamp=function(deaultTimestamp){this.initPTS=deaultTimestamp,this.resetContiguity()},_proto.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},_proto.canParse=function(data,offset){return!1},_proto.appendFrame=function(track,data,offset){},_proto.demux=function(data,timeOffset){this.cachedData&&(data=appendUint8Array(this.cachedData,data),this.cachedData=null);var lastDataIndex,id3Data=getID3Data(data,0),offset=id3Data?id3Data.length:0,track=this._audioTrack,id3Track=this._id3Track,timestamp=id3Data?getTimeStamp(id3Data):void 0,length=data.length;for((null===this.basePTS||0===this.frameIndex&&isFiniteNumber(timestamp))&&(this.basePTS=initPTSFn(timestamp,timeOffset,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),id3Data&&id3Data.length>0&&id3Track.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:id3Data,type:MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});offset<length;){if(this.canParse(data,offset)){var frame=this.appendFrame(track,data,offset);frame?(this.frameIndex++,this.lastPTS=frame.sample.pts,lastDataIndex=offset+=frame.length):offset=length}else canParse$2(data,offset)?(id3Data=getID3Data(data,offset),id3Track.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:id3Data,type:MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),lastDataIndex=offset+=id3Data.length):offset++;if(offset===length&&lastDataIndex!==length){var partialData=sliceUint8(data,lastDataIndex);this.cachedData?this.cachedData=appendUint8Array(this.cachedData,partialData):this.cachedData=partialData}}return{audioTrack:track,videoTrack:dummyTrack(),id3Track:id3Track,textTrack:dummyTrack()}},_proto.demuxSampleAes=function(data,keyData,timeOffset){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},_proto.flush=function(timeOffset){var cachedData=this.cachedData;return cachedData&&(this.cachedData=null,this.demux(cachedData,0)),{audioTrack:this._audioTrack,videoTrack:dummyTrack(),id3Track:this._id3Track,textTrack:dummyTrack()}},_proto.destroy=function(){},BaseAudioDemuxer})(),initPTSFn=function(timestamp,timeOffset,initPTS){return isFiniteNumber(timestamp)?90*timestamp:9e4*timeOffset+(initPTS?9e4*initPTS.baseTime/initPTS.timescale:0)};function getAudioConfig(observer,data,offset,audioCodec){var adtsObjectType,adtsExtensionSamplingIndex,adtsChannelConfig,config,userAgent=navigator.userAgent.toLowerCase(),manifestCodec=audioCodec,adtsSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];adtsObjectType=1+((192&data[offset+2])>>>6);var adtsSamplingIndex=(60&data[offset+2])>>>2;if(!(adtsSamplingIndex>adtsSamplingRates.length-1))return adtsChannelConfig=(1&data[offset+2])<<2,adtsChannelConfig|=(192&data[offset+3])>>>6,logger.log("manifest codec:"+audioCodec+", ADTS type:"+adtsObjectType+", samplingIndex:"+adtsSamplingIndex),/firefox/i.test(userAgent)?adtsSamplingIndex>=6?(adtsObjectType=5,config=new Array(4),adtsExtensionSamplingIndex=adtsSamplingIndex-3):(adtsObjectType=2,config=new Array(2),adtsExtensionSamplingIndex=adtsSamplingIndex):-1!==userAgent.indexOf("android")?(adtsObjectType=2,config=new Array(2),adtsExtensionSamplingIndex=adtsSamplingIndex):(adtsObjectType=5,config=new Array(4),audioCodec&&(-1!==audioCodec.indexOf("mp4a.40.29")||-1!==audioCodec.indexOf("mp4a.40.5"))||!audioCodec&&adtsSamplingIndex>=6?adtsExtensionSamplingIndex=adtsSamplingIndex-3:((audioCodec&&-1!==audioCodec.indexOf("mp4a.40.2")&&(adtsSamplingIndex>=6&&1===adtsChannelConfig||/vivaldi/i.test(userAgent))||!audioCodec&&1===adtsChannelConfig)&&(adtsObjectType=2,config=new Array(2)),adtsExtensionSamplingIndex=adtsSamplingIndex)),config[0]=adtsObjectType<<3,config[0]|=(14&adtsSamplingIndex)>>1,config[1]|=(1&adtsSamplingIndex)<<7,config[1]|=adtsChannelConfig<<3,5===adtsObjectType&&(config[1]|=(14&adtsExtensionSamplingIndex)>>1,config[2]=(1&adtsExtensionSamplingIndex)<<7,config[2]|=8,config[3]=0),{config:config,samplerate:adtsSamplingRates[adtsSamplingIndex],channelCount:adtsChannelConfig,codec:"mp4a.40."+adtsObjectType,manifestCodec:manifestCodec};var error=new Error("invalid ADTS sampling index:"+adtsSamplingIndex);observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,error:error,reason:error.message})}function isHeaderPattern$1(data,offset){return 255===data[offset]&&240==(246&data[offset+1])}function getHeaderLength(data,offset){return 1&data[offset+1]?7:9}function getFullFrameLength(data,offset){return(3&data[offset+3])<<11|data[offset+4]<<3|(224&data[offset+5])>>>5}function canGetFrameLength(data,offset){return offset+5<data.length}function isHeader$1(data,offset){return offset+1<data.length&&isHeaderPattern$1(data,offset)}function canParse$1(data,offset){return canGetFrameLength(data,offset)&&isHeaderPattern$1(data,offset)&&getFullFrameLength(data,offset)<=data.length-offset}function probe$1(data,offset){if(isHeader$1(data,offset)){var headerLength=getHeaderLength(data,offset);if(offset+headerLength>=data.length)return!1;var frameLength=getFullFrameLength(data,offset);if(frameLength<=headerLength)return!1;var newOffset=offset+frameLength;return newOffset===data.length||isHeader$1(data,newOffset)}return!1}function initTrackConfig(track,observer,data,offset,audioCodec){if(!track.samplerate){var config=getAudioConfig(observer,data,offset,audioCodec);if(!config)return;track.config=config.config,track.samplerate=config.samplerate,track.channelCount=config.channelCount,track.codec=config.codec,track.manifestCodec=config.manifestCodec,logger.log("parsed codec:"+track.codec+", rate:"+config.samplerate+", channels:"+config.channelCount)}}function getFrameDuration(samplerate){return 9216e4/samplerate}function parseFrameHeader(data,offset){var headerLength=getHeaderLength(data,offset);if(offset+headerLength<=data.length){var frameLength=getFullFrameLength(data,offset)-headerLength;if(frameLength>0)return{headerLength:headerLength,frameLength:frameLength}}}function appendFrame$1(track,data,offset,pts,frameIndex){var unit,stamp=pts+frameIndex*getFrameDuration(track.samplerate),header=parseFrameHeader(data,offset);if(header){var frameLength=header.frameLength,headerLength=header.headerLength,_length=headerLength+frameLength,missing=Math.max(0,offset+_length-data.length);missing?(unit=new Uint8Array(_length-headerLength)).set(data.subarray(offset+headerLength,data.length),0):unit=data.subarray(offset+headerLength,offset+_length);var _sample={unit:unit,pts:stamp};return missing||track.samples.push(_sample),{sample:_sample,length:_length,missing:missing}}var length=data.length-offset;return(unit=new Uint8Array(length)).set(data.subarray(offset,data.length),0),{sample:{unit:unit,pts:stamp},length:length,missing:-1}}var chromeVersion$1=null,BitratesMap=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot=[0,1,1,4];function appendFrame(track,data,offset,pts,frameIndex){if(!(offset+24>data.length)){var header=parseHeader(data,offset);if(header&&offset+header.frameLength<=data.length){var stamp=pts+frameIndex*(9e4*header.samplesPerFrame/header.sampleRate),sample={unit:data.subarray(offset,offset+header.frameLength),pts:stamp,dts:stamp};return track.config=[],track.channelCount=header.channelCount,track.samplerate=header.sampleRate,track.samples.push(sample),{sample:sample,length:header.frameLength,missing:0}}}}function parseHeader(data,offset){var mpegVersion=data[offset+1]>>3&3,mpegLayer=data[offset+1]>>1&3,bitRateIndex=data[offset+2]>>4&15,sampleRateIndex=data[offset+2]>>2&3;if(1!==mpegVersion&&0!==bitRateIndex&&15!==bitRateIndex&&3!==sampleRateIndex){var paddingBit=data[offset+2]>>1&1,channelMode=data[offset+3]>>6,bitRate=1e3*BitratesMap[14*(3===mpegVersion?3-mpegLayer:3===mpegLayer?3:4)+bitRateIndex-1],sampleRate=SamplingRateMap[3*(3===mpegVersion?0:2===mpegVersion?1:2)+sampleRateIndex],channelCount=3===channelMode?1:2,sampleCoefficient=SamplesCoefficients[mpegVersion][mpegLayer],bytesInSlot=BytesInSlot[mpegLayer],samplesPerFrame=8*sampleCoefficient*bytesInSlot,frameLength=Math.floor(sampleCoefficient*bitRate/sampleRate+paddingBit)*bytesInSlot;if(null===chromeVersion$1){var result=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);chromeVersion$1=result?parseInt(result[1]):0}return!!chromeVersion$1&&chromeVersion$1<=87&&2===mpegLayer&&bitRate>=224e3&&0===channelMode&&(data[offset+3]=128|data[offset+3]),{sampleRate:sampleRate,channelCount:channelCount,frameLength:frameLength,samplesPerFrame:samplesPerFrame}}}function isHeaderPattern(data,offset){return 255===data[offset]&&224==(224&data[offset+1])&&0!=(6&data[offset+1])}function isHeader(data,offset){return offset+1<data.length&&isHeaderPattern(data,offset)}function canParse(data,offset){var headerSize=4;return isHeaderPattern(data,offset)&&headerSize<=data.length-offset}function probe(data,offset){if(offset+1<data.length&&isHeaderPattern(data,offset)){var headerLength=4,header=parseHeader(data,offset),frameLength=headerLength;null!=header&&header.frameLength&&(frameLength=header.frameLength);var newOffset=offset+frameLength;return newOffset===data.length||isHeader(data,newOffset)}return!1}var AACDemuxer=(function(_BaseAudioDemuxer){function AACDemuxer(observer,config){var _this;return(_this=_BaseAudioDemuxer.call(this)||this).observer=void 0,_this.config=void 0,_this.observer=observer,_this.config=config,_this}_inheritsLoose(AACDemuxer,_BaseAudioDemuxer);var _proto=AACDemuxer.prototype;return _proto.resetInitSegment=function(initSegment,audioCodec,videoCodec,trackDuration){_BaseAudioDemuxer.prototype.resetInitSegment.call(this,initSegment,audioCodec,videoCodec,trackDuration),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:audioCodec,duration:trackDuration,inputTimeScale:9e4,dropped:0}},AACDemuxer.probe=function(data){if(!data)return!1;var id3Data=getID3Data(data,0),offset=(null==id3Data?void 0:id3Data.length)||0;if(probe(data,offset))return!1;for(var length=data.length;offset<length;offset++)if(probe$1(data,offset))return logger.log("ADTS sync word found !"),!0;return!1},_proto.canParse=function(data,offset){return canParse$1(data,offset)},_proto.appendFrame=function(track,data,offset){initTrackConfig(track,this.observer,data,offset,track.manifestCodec);var frame=appendFrame$1(track,data,offset,this.basePTS,this.frameIndex);if(frame&&0===frame.missing)return frame},AACDemuxer})(BaseAudioDemuxer),emsgSchemePattern=/\/emsg[-/]ID3/i,MP4Demuxer=(function(){function MP4Demuxer(observer,config){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=config}var _proto=MP4Demuxer.prototype;return _proto.resetTimeStamp=function(){},_proto.resetInitSegment=function(initSegment,audioCodec,videoCodec,trackDuration){var videoTrack=this.videoTrack=dummyTrack("video",1),audioTrack=this.audioTrack=dummyTrack("audio",1),captionTrack=this.txtTrack=dummyTrack("text",1);if(this.id3Track=dummyTrack("id3",1),this.timeOffset=0,null!=initSegment&&initSegment.byteLength){var initData=parseInitSegment(initSegment);if(initData.video){var _initData$video=initData.video,id=_initData$video.id,timescale=_initData$video.timescale,codec=_initData$video.codec;videoTrack.id=id,videoTrack.timescale=captionTrack.timescale=timescale,videoTrack.codec=codec}if(initData.audio){var _initData$audio=initData.audio,_id=_initData$audio.id,_timescale=_initData$audio.timescale,_codec=_initData$audio.codec;audioTrack.id=_id,audioTrack.timescale=_timescale,audioTrack.codec=_codec}captionTrack.id=RemuxerTrackIdConfig.text,videoTrack.sampleDuration=0,videoTrack.duration=audioTrack.duration=trackDuration}},_proto.resetContiguity=function(){this.remainderData=null},MP4Demuxer.probe=function(data){return hasMoofData(data)},_proto.demux=function(data,timeOffset){this.timeOffset=timeOffset;var videoSamples=data,videoTrack=this.videoTrack,textTrack=this.txtTrack;if(this.config.progressive){this.remainderData&&(videoSamples=appendUint8Array(this.remainderData,data));var segmentedData=segmentValidRange(videoSamples);this.remainderData=segmentedData.remainder,videoTrack.samples=segmentedData.valid||new Uint8Array}else videoTrack.samples=videoSamples;var id3Track=this.extractID3Track(videoTrack,timeOffset);return textTrack.samples=parseSamples(timeOffset,videoTrack),{videoTrack:videoTrack,audioTrack:this.audioTrack,id3Track:id3Track,textTrack:this.txtTrack}},_proto.flush=function(){var timeOffset=this.timeOffset,videoTrack=this.videoTrack,textTrack=this.txtTrack;videoTrack.samples=this.remainderData||new Uint8Array,this.remainderData=null;var id3Track=this.extractID3Track(videoTrack,this.timeOffset);return textTrack.samples=parseSamples(timeOffset,videoTrack),{videoTrack:videoTrack,audioTrack:dummyTrack(),id3Track:id3Track,textTrack:dummyTrack()}},_proto.extractID3Track=function(videoTrack,timeOffset){var id3Track=this.id3Track;if(videoTrack.samples.length){var emsgs=findBox(videoTrack.samples,["emsg"]);emsgs&&emsgs.forEach((function(data){var emsgInfo=parseEmsg(data);if(emsgSchemePattern.test(emsgInfo.schemeIdUri)){var pts=isFiniteNumber(emsgInfo.presentationTime)?emsgInfo.presentationTime/emsgInfo.timeScale:timeOffset+emsgInfo.presentationTimeDelta/emsgInfo.timeScale,duration=4294967295===emsgInfo.eventDuration?Number.POSITIVE_INFINITY:emsgInfo.eventDuration/emsgInfo.timeScale;duration<=.001&&(duration=Number.POSITIVE_INFINITY);var payload=emsgInfo.payload;id3Track.samples.push({data:payload,len:payload.byteLength,dts:pts,pts:pts,type:MetadataSchema.emsg,duration:duration})}}))}return id3Track},_proto.demuxSampleAes=function(data,keyData,timeOffset){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},_proto.destroy=function(){},MP4Demuxer})(),getAudioBSID=function(data,offset){var bsid=0,numBits=5;offset+=numBits;for(var temp=new Uint32Array(1),mask=new Uint32Array(1),_byte=new Uint8Array(1);numBits>0;){_byte[0]=data[offset];var bits=Math.min(numBits,8),shift=8-bits;mask[0]=4278190080>>>24+shift<<shift,temp[0]=(_byte[0]&mask[0])>>shift,bsid=bsid?bsid<<bits|temp[0]:temp[0],offset+=1,numBits-=bits}return bsid},AC3Demuxer=(function(_BaseAudioDemuxer){function AC3Demuxer(observer){var _this;return(_this=_BaseAudioDemuxer.call(this)||this).observer=void 0,_this.observer=observer,_this}_inheritsLoose(AC3Demuxer,_BaseAudioDemuxer);var _proto=AC3Demuxer.prototype;return _proto.resetInitSegment=function(initSegment,audioCodec,videoCodec,trackDuration){_BaseAudioDemuxer.prototype.resetInitSegment.call(this,initSegment,audioCodec,videoCodec,trackDuration),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:audioCodec,duration:trackDuration,inputTimeScale:9e4,dropped:0}},_proto.canParse=function(data,offset){return offset+64<data.length},_proto.appendFrame=function(track,data,offset){var frameLength=_appendFrame(track,data,offset,this.basePTS,this.frameIndex);if(-1!==frameLength)return{sample:track.samples[track.samples.length-1],length:frameLength,missing:0}},AC3Demuxer.probe=function(data){if(!data)return!1;var id3Data=getID3Data(data,0);if(!id3Data)return!1;var offset=id3Data.length;return 11===data[offset]&&119===data[offset+1]&&void 0!==getTimeStamp(id3Data)&&getAudioBSID(data,offset)<16},AC3Demuxer})(BaseAudioDemuxer);function _appendFrame(track,data,start,pts,frameIndex){if(start+8>data.length)return-1;if(11!==data[start]||119!==data[start+1])return-1;var samplingRateCode=data[start+4]>>6;if(samplingRateCode>=3)return-1;var sampleRate=[48e3,44100,32e3][samplingRateCode],frameSizeCode=63&data[start+4],frameLength=2*[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][3*frameSizeCode+samplingRateCode];if(start+frameLength>data.length)return-1;var channelMode=data[start+6]>>5,skipCount=0;2===channelMode?skipCount+=2:(1&channelMode&&1!==channelMode&&(skipCount+=2),4&channelMode&&(skipCount+=2));var lfeon=(data[start+6]<<8|data[start+7])>>12-skipCount&1,channelCount=[2,1,2,3,3,4,4,5][channelMode]+lfeon,bsid=data[start+5]>>3,bsmod=7&data[start+5],config=new Uint8Array([samplingRateCode<<6|bsid<<1|bsmod>>2,(3&bsmod)<<6|channelMode<<3|lfeon<<2|frameSizeCode>>4,frameSizeCode<<4&224]),stamp=pts+frameIndex*(1536/sampleRate*9e4),unit=data.subarray(start,start+frameLength);return track.config=config,track.channelCount=channelCount,track.samplerate=sampleRate,track.samples.push({unit:unit,pts:stamp}),frameLength}var BaseVideoParser=(function(){function BaseVideoParser(){this.VideoSample=null}var _proto=BaseVideoParser.prototype;return _proto.createVideoSample=function(key,pts,dts,debug){return{key:key,frame:!1,pts:pts,dts:dts,units:[],debug:debug,length:0}},_proto.getLastNalUnit=function(samples){var _VideoSample,lastUnit,VideoSample=this.VideoSample;if(VideoSample&&0!==VideoSample.units.length||(VideoSample=samples[samples.length-1]),null!=(_VideoSample=VideoSample)&&_VideoSample.units){var units=VideoSample.units;lastUnit=units[units.length-1]}return lastUnit},_proto.pushAccessUnit=function(VideoSample,videoTrack){if(VideoSample.units.length&&VideoSample.frame){if(void 0===VideoSample.pts){var samples=videoTrack.samples,nbSamples=samples.length;if(!nbSamples)return void videoTrack.dropped++;var lastSample=samples[nbSamples-1];VideoSample.pts=lastSample.pts,VideoSample.dts=lastSample.dts}videoTrack.samples.push(VideoSample)}VideoSample.debug.length&&logger.log(VideoSample.pts+"/"+VideoSample.dts+":"+VideoSample.debug)},BaseVideoParser})(),ExpGolomb=(function(){function ExpGolomb(data){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=data,this.bytesAvailable=data.byteLength,this.word=0,this.bitsAvailable=0}var _proto=ExpGolomb.prototype;return _proto.loadWord=function(){var data=this.data,bytesAvailable=this.bytesAvailable,position=data.byteLength-bytesAvailable,workingBytes=new Uint8Array(4),availableBytes=Math.min(4,bytesAvailable);if(0===availableBytes)throw new Error("no bytes available");workingBytes.set(data.subarray(position,position+availableBytes)),this.word=new DataView(workingBytes.buffer).getUint32(0),this.bitsAvailable=8*availableBytes,this.bytesAvailable-=availableBytes},_proto.skipBits=function(count){var skipBytes;count=Math.min(count,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>count?(this.word<<=count,this.bitsAvailable-=count):(count-=this.bitsAvailable,count-=(skipBytes=count>>3)<<3,this.bytesAvailable-=skipBytes,this.loadWord(),this.word<<=count,this.bitsAvailable-=count)},_proto.readBits=function(size){var bits=Math.min(this.bitsAvailable,size),valu=this.word>>>32-bits;if(size>32&&logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=bits,this.bitsAvailable>0)this.word<<=bits;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return(bits=size-bits)>0&&this.bitsAvailable?valu<<bits|this.readBits(bits):valu},_proto.skipLZ=function(){var leadingZeroCount;for(leadingZeroCount=0;leadingZeroCount<this.bitsAvailable;++leadingZeroCount)if(0!=(this.word&2147483648>>>leadingZeroCount))return this.word<<=leadingZeroCount,this.bitsAvailable-=leadingZeroCount,leadingZeroCount;return this.loadWord(),leadingZeroCount+this.skipLZ()},_proto.skipUEG=function(){this.skipBits(1+this.skipLZ())},_proto.skipEG=function(){this.skipBits(1+this.skipLZ())},_proto.readUEG=function(){var clz=this.skipLZ();return this.readBits(clz+1)-1},_proto.readEG=function(){var valu=this.readUEG();return 1&valu?1+valu>>>1:-1*(valu>>>1)},_proto.readBoolean=function(){return 1===this.readBits(1)},_proto.readUByte=function(){return this.readBits(8)},_proto.readUShort=function(){return this.readBits(16)},_proto.readUInt=function(){return this.readBits(32)},_proto.skipScalingList=function(count){for(var lastScale=8,nextScale=8,j=0;j<count;j++)0!==nextScale&&(nextScale=(lastScale+this.readEG()+256)%256),lastScale=0===nextScale?lastScale:nextScale},_proto.readSPS=function(){var numRefFramesInPicOrderCntCycle,scalingListCount,i,frameCropLeftOffset=0,frameCropRightOffset=0,frameCropTopOffset=0,frameCropBottomOffset=0,readUByte=this.readUByte.bind(this),readBits=this.readBits.bind(this),readUEG=this.readUEG.bind(this),readBoolean=this.readBoolean.bind(this),skipBits=this.skipBits.bind(this),skipEG=this.skipEG.bind(this),skipUEG=this.skipUEG.bind(this),skipScalingList=this.skipScalingList.bind(this);readUByte();var profileIdc=readUByte();if(readBits(5),skipBits(3),readUByte(),skipUEG(),100===profileIdc||110===profileIdc||122===profileIdc||244===profileIdc||44===profileIdc||83===profileIdc||86===profileIdc||118===profileIdc||128===profileIdc){var chromaFormatIdc=readUEG();if(3===chromaFormatIdc&&skipBits(1),skipUEG(),skipUEG(),skipBits(1),readBoolean())for(scalingListCount=3!==chromaFormatIdc?8:12,i=0;i<scalingListCount;i++)readBoolean()&&skipScalingList(i<6?16:64)}skipUEG();var picOrderCntType=readUEG();if(0===picOrderCntType)readUEG();else if(1===picOrderCntType)for(skipBits(1),skipEG(),skipEG(),numRefFramesInPicOrderCntCycle=readUEG(),i=0;i<numRefFramesInPicOrderCntCycle;i++)skipEG();skipUEG(),skipBits(1);var picWidthInMbsMinus1=readUEG(),picHeightInMapUnitsMinus1=readUEG(),frameMbsOnlyFlag=readBits(1);0===frameMbsOnlyFlag&&skipBits(1),skipBits(1),readBoolean()&&(frameCropLeftOffset=readUEG(),frameCropRightOffset=readUEG(),frameCropTopOffset=readUEG(),frameCropBottomOffset=readUEG());var pixelRatio=[1,1];if(readBoolean()&&readBoolean())switch(readUByte()){case 1:pixelRatio=[1,1];break;case 2:pixelRatio=[12,11];break;case 3:pixelRatio=[10,11];break;case 4:pixelRatio=[16,11];break;case 5:pixelRatio=[40,33];break;case 6:pixelRatio=[24,11];break;case 7:pixelRatio=[20,11];break;case 8:pixelRatio=[32,11];break;case 9:pixelRatio=[80,33];break;case 10:pixelRatio=[18,11];break;case 11:pixelRatio=[15,11];break;case 12:pixelRatio=[64,33];break;case 13:pixelRatio=[160,99];break;case 14:pixelRatio=[4,3];break;case 15:pixelRatio=[3,2];break;case 16:pixelRatio=[2,1];break;case 255:pixelRatio=[readUByte()<<8|readUByte(),readUByte()<<8|readUByte()]}return{width:Math.ceil(16*(picWidthInMbsMinus1+1)-2*frameCropLeftOffset-2*frameCropRightOffset),height:(2-frameMbsOnlyFlag)*(picHeightInMapUnitsMinus1+1)*16-(frameMbsOnlyFlag?2:4)*(frameCropTopOffset+frameCropBottomOffset),pixelRatio:pixelRatio}},_proto.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},ExpGolomb})(),AvcVideoParser=(function(_BaseVideoParser){function AvcVideoParser(){return _BaseVideoParser.apply(this,arguments)||this}_inheritsLoose(AvcVideoParser,_BaseVideoParser);var _proto=AvcVideoParser.prototype;return _proto.parseAVCPES=function(track,textTrack,pes,last,duration){var push,_this=this,units=this.parseAVCNALu(track,pes.data),VideoSample=this.VideoSample,spsfound=!1;pes.data=null,VideoSample&&units.length&&!track.audFound&&(this.pushAccessUnit(VideoSample,track),VideoSample=this.VideoSample=this.createVideoSample(!1,pes.pts,pes.dts,"")),units.forEach((function(unit){var _VideoSample2;switch(unit.type){case 1:var iskey=!1;push=!0;var _VideoSample,data=unit.data;if(spsfound&&data.length>4){var sliceType=new ExpGolomb(data).readSliceType();2!==sliceType&&4!==sliceType&&7!==sliceType&&9!==sliceType||(iskey=!0)}iskey&&null!=(_VideoSample=VideoSample)&&_VideoSample.frame&&!VideoSample.key&&(_this.pushAccessUnit(VideoSample,track),VideoSample=_this.VideoSample=null),VideoSample||(VideoSample=_this.VideoSample=_this.createVideoSample(!0,pes.pts,pes.dts,"")),VideoSample.frame=!0,VideoSample.key=iskey;break;case 5:push=!0,null!=(_VideoSample2=VideoSample)&&_VideoSample2.frame&&!VideoSample.key&&(_this.pushAccessUnit(VideoSample,track),VideoSample=_this.VideoSample=null),VideoSample||(VideoSample=_this.VideoSample=_this.createVideoSample(!0,pes.pts,pes.dts,"")),VideoSample.key=!0,VideoSample.frame=!0;break;case 6:push=!0,parseSEIMessageFromNALu(unit.data,1,pes.pts,textTrack.samples);break;case 7:var _track$pixelRatio,_track$pixelRatio2;push=!0,spsfound=!0;var sps=unit.data,config=new ExpGolomb(sps).readSPS();if(!track.sps||track.width!==config.width||track.height!==config.height||(null==(_track$pixelRatio=track.pixelRatio)?void 0:_track$pixelRatio[0])!==config.pixelRatio[0]||(null==(_track$pixelRatio2=track.pixelRatio)?void 0:_track$pixelRatio2[1])!==config.pixelRatio[1]){track.width=config.width,track.height=config.height,track.pixelRatio=config.pixelRatio,track.sps=[sps],track.duration=duration;for(var codecarray=sps.subarray(1,4),codecstring="avc1.",i=0;i<3;i++){var h=codecarray[i].toString(16);h.length<2&&(h="0"+h),codecstring+=h}track.codec=codecstring}break;case 8:push=!0,track.pps=[unit.data];break;case 9:push=!0,track.audFound=!0,VideoSample&&_this.pushAccessUnit(VideoSample,track),VideoSample=_this.VideoSample=_this.createVideoSample(!1,pes.pts,pes.dts,"");break;case 12:push=!0;break;default:push=!1,VideoSample&&(VideoSample.debug+="unknown NAL "+unit.type+" ")}VideoSample&&push&&VideoSample.units.push(unit)})),last&&VideoSample&&(this.pushAccessUnit(VideoSample,track),this.VideoSample=null)},_proto.parseAVCNALu=function(track,array){var value,overflow,len=array.byteLength,state=track.naluState||0,lastState=state,units=[],i=0,lastUnitStart=-1,lastUnitType=0;for(-1===state&&(lastUnitStart=0,lastUnitType=31&array[0],state=0,i=1);i<len;)if(value=array[i++],state)if(1!==state)if(value)if(1===value){if(overflow=i-state-1,lastUnitStart>=0){var unit={data:array.subarray(lastUnitStart,overflow),type:lastUnitType};units.push(unit)}else{var lastUnit=this.getLastNalUnit(track.samples);lastUnit&&(lastState&&i<=4-lastState&&lastUnit.state&&(lastUnit.data=lastUnit.data.subarray(0,lastUnit.data.byteLength-lastState)),overflow>0&&(lastUnit.data=appendUint8Array(lastUnit.data,array.subarray(0,overflow)),lastUnit.state=0))}i<len?(lastUnitStart=i,lastUnitType=31&array[i],state=0):state=-1}else state=0;else state=3;else state=value?0:2;else state=value?0:1;if(lastUnitStart>=0&&state>=0){var _unit={data:array.subarray(lastUnitStart,len),type:lastUnitType,state:state};units.push(_unit)}if(0===units.length){var _lastUnit=this.getLastNalUnit(track.samples);_lastUnit&&(_lastUnit.data=appendUint8Array(_lastUnit.data,array))}return track.naluState=state,units},AvcVideoParser})(BaseVideoParser),SampleAesDecrypter=(function(){function SampleAesDecrypter(observer,config,keyData){this.keyData=void 0,this.decrypter=void 0,this.keyData=keyData,this.decrypter=new Decrypter(config,{removePKCS7Padding:!1})}var _proto=SampleAesDecrypter.prototype;return _proto.decryptBuffer=function(encryptedData){return this.decrypter.decrypt(encryptedData,this.keyData.key.buffer,this.keyData.iv.buffer)},_proto.decryptAacSample=function(samples,sampleIndex,callback){var _this=this,curUnit=samples[sampleIndex].unit;if(!(curUnit.length<=16)){var encryptedData=curUnit.subarray(16,curUnit.length-curUnit.length%16),encryptedBuffer=encryptedData.buffer.slice(encryptedData.byteOffset,encryptedData.byteOffset+encryptedData.length);this.decryptBuffer(encryptedBuffer).then((function(decryptedBuffer){var decryptedData=new Uint8Array(decryptedBuffer);curUnit.set(decryptedData,16),_this.decrypter.isSync()||_this.decryptAacSamples(samples,sampleIndex+1,callback)}))}},_proto.decryptAacSamples=function(samples,sampleIndex,callback){for(;;sampleIndex++){if(sampleIndex>=samples.length)return void callback();if(!(samples[sampleIndex].unit.length<32||(this.decryptAacSample(samples,sampleIndex,callback),this.decrypter.isSync())))return}},_proto.getAvcEncryptedData=function(decodedData){for(var encryptedDataLen=16*Math.floor((decodedData.length-48)/160)+16,encryptedData=new Int8Array(encryptedDataLen),outputPos=0,inputPos=32;inputPos<decodedData.length-16;inputPos+=160,outputPos+=16)encryptedData.set(decodedData.subarray(inputPos,inputPos+16),outputPos);return encryptedData},_proto.getAvcDecryptedUnit=function(decodedData,decryptedData){for(var uint8DecryptedData=new Uint8Array(decryptedData),inputPos=0,outputPos=32;outputPos<decodedData.length-16;outputPos+=160,inputPos+=16)decodedData.set(uint8DecryptedData.subarray(inputPos,inputPos+16),outputPos);return decodedData},_proto.decryptAvcSample=function(samples,sampleIndex,unitIndex,callback,curUnit){var _this2=this,decodedData=discardEPB(curUnit.data),encryptedData=this.getAvcEncryptedData(decodedData);this.decryptBuffer(encryptedData.buffer).then((function(decryptedBuffer){curUnit.data=_this2.getAvcDecryptedUnit(decodedData,decryptedBuffer),_this2.decrypter.isSync()||_this2.decryptAvcSamples(samples,sampleIndex,unitIndex+1,callback)}))},_proto.decryptAvcSamples=function(samples,sampleIndex,unitIndex,callback){if(samples instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;sampleIndex++,unitIndex=0){if(sampleIndex>=samples.length)return void callback();for(var curUnits=samples[sampleIndex].units;!(unitIndex>=curUnits.length);unitIndex++){var curUnit=curUnits[unitIndex];if(!(curUnit.data.length<=48||1!==curUnit.type&&5!==curUnit.type||(this.decryptAvcSample(samples,sampleIndex,unitIndex,callback,curUnit),this.decrypter.isSync())))return}}},SampleAesDecrypter})(),PACKET_LENGTH=188,TSDemuxer=(function(){function TSDemuxer(observer,config,typeSupported){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=observer,this.config=config,this.typeSupported=typeSupported,this.videoParser=new AvcVideoParser}TSDemuxer.probe=function(data){var syncOffset=TSDemuxer.syncOffset(data);return syncOffset>0&&logger.warn("MPEG2-TS detected but first sync word found @ offset "+syncOffset),-1!==syncOffset},TSDemuxer.syncOffset=function(data){for(var length=data.length,scanwindow=Math.min(5*PACKET_LENGTH,length-PACKET_LENGTH)+1,i=0;i<scanwindow;){for(var foundPat=!1,packetStart=-1,tsPackets=0,j=i;j<length;j+=PACKET_LENGTH){if(71!==data[j]||length-j!==PACKET_LENGTH&&71!==data[j+PACKET_LENGTH]){if(tsPackets)return-1;break}if(tsPackets++,-1===packetStart&&0!==(packetStart=j)&&(scanwindow=Math.min(packetStart+99*PACKET_LENGTH,data.length-PACKET_LENGTH)+1),foundPat||(foundPat=0===parsePID(data,j)),foundPat&&tsPackets>1&&(0===packetStart&&tsPackets>2||j+PACKET_LENGTH>scanwindow))return packetStart}i++}return-1},TSDemuxer.createTrack=function(type,duration){return{container:"video"===type||"audio"===type?"video/mp2t":void 0,type:type,id:RemuxerTrackIdConfig[type],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===type?duration:void 0}};var _proto=TSDemuxer.prototype;return _proto.resetInitSegment=function(initSegment,audioCodec,videoCodec,trackDuration){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=TSDemuxer.createTrack("video"),this._audioTrack=TSDemuxer.createTrack("audio",trackDuration),this._id3Track=TSDemuxer.createTrack("id3"),this._txtTrack=TSDemuxer.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=audioCodec,this.videoCodec=videoCodec,this._duration=trackDuration},_proto.resetTimeStamp=function(){},_proto.resetContiguity=function(){var _audioTrack=this._audioTrack,_videoTrack=this._videoTrack,_id3Track=this._id3Track;_audioTrack&&(_audioTrack.pesData=null),_videoTrack&&(_videoTrack.pesData=null),_id3Track&&(_id3Track.pesData=null),this.aacOverFlow=null,this.remainderData=null},_proto.demux=function(data,timeOffset,isSampleAes,flush){var pes;void 0===isSampleAes&&(isSampleAes=!1),void 0===flush&&(flush=!1),isSampleAes||(this.sampleAes=null);var videoTrack=this._videoTrack,audioTrack=this._audioTrack,id3Track=this._id3Track,textTrack=this._txtTrack,videoPid=videoTrack.pid,videoData=videoTrack.pesData,audioPid=audioTrack.pid,id3Pid=id3Track.pid,audioData=audioTrack.pesData,id3Data=id3Track.pesData,unknownPID=null,pmtParsed=this.pmtParsed,pmtId=this._pmtId,len=data.length;if(this.remainderData&&(len=(data=appendUint8Array(this.remainderData,data)).length,this.remainderData=null),len<PACKET_LENGTH&&!flush)return this.remainderData=data,{audioTrack:audioTrack,videoTrack:videoTrack,id3Track:id3Track,textTrack:textTrack};var syncOffset=Math.max(0,TSDemuxer.syncOffset(data));(len-=(len-syncOffset)%PACKET_LENGTH)<data.byteLength&&!flush&&(this.remainderData=new Uint8Array(data.buffer,len,data.buffer.byteLength-len));for(var tsPacketErrors=0,start=syncOffset;start<len;start+=PACKET_LENGTH)if(71===data[start]){var stt=!!(64&data[start+1]),pid=parsePID(data,start),offset=void 0;if((48&data[start+3])>>4>1){if((offset=start+5+data[start+4])===start+PACKET_LENGTH)continue}else offset=start+4;switch(pid){case videoPid:stt&&(videoData&&(pes=parsePES(videoData))&&this.videoParser.parseAVCPES(videoTrack,textTrack,pes,!1,this._duration),videoData={data:[],size:0}),videoData&&(videoData.data.push(data.subarray(offset,start+PACKET_LENGTH)),videoData.size+=start+PACKET_LENGTH-offset);break;case audioPid:if(stt){if(audioData&&(pes=parsePES(audioData)))switch(audioTrack.segmentCodec){case"aac":this.parseAACPES(audioTrack,pes);break;case"mp3":this.parseMPEGPES(audioTrack,pes);break;case"ac3":this.parseAC3PES(audioTrack,pes)}audioData={data:[],size:0}}audioData&&(audioData.data.push(data.subarray(offset,start+PACKET_LENGTH)),audioData.size+=start+PACKET_LENGTH-offset);break;case id3Pid:stt&&(id3Data&&(pes=parsePES(id3Data))&&this.parseID3PES(id3Track,pes),id3Data={data:[],size:0}),id3Data&&(id3Data.data.push(data.subarray(offset,start+PACKET_LENGTH)),id3Data.size+=start+PACKET_LENGTH-offset);break;case 0:stt&&(offset+=data[offset]+1),pmtId=this._pmtId=parsePAT(data,offset);break;case pmtId:stt&&(offset+=data[offset]+1);var parsedPIDs=parsePMT(data,offset,this.typeSupported,isSampleAes);(videoPid=parsedPIDs.videoPid)>0&&(videoTrack.pid=videoPid,videoTrack.segmentCodec=parsedPIDs.segmentVideoCodec),(audioPid=parsedPIDs.audioPid)>0&&(audioTrack.pid=audioPid,audioTrack.segmentCodec=parsedPIDs.segmentAudioCodec),(id3Pid=parsedPIDs.id3Pid)>0&&(id3Track.pid=id3Pid),null===unknownPID||pmtParsed||(logger.warn("MPEG-TS PMT found at "+start+" after unknown PID '"+unknownPID+"'. Backtracking to sync byte @"+syncOffset+" to parse all TS packets."),unknownPID=null,start=syncOffset-188),pmtParsed=this.pmtParsed=!0;break;case 17:case 8191:break;default:unknownPID=pid}}else tsPacketErrors++;if(tsPacketErrors>0){var error=new Error("Found "+tsPacketErrors+" TS packet/s that do not start with 0x47");this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,error:error,reason:error.message})}videoTrack.pesData=videoData,audioTrack.pesData=audioData,id3Track.pesData=id3Data;var demuxResult={audioTrack:audioTrack,videoTrack:videoTrack,id3Track:id3Track,textTrack:textTrack};return flush&&this.extractRemainingSamples(demuxResult),demuxResult},_proto.flush=function(){var result,remainderData=this.remainderData;return this.remainderData=null,result=remainderData?this.demux(remainderData,-1,!1,!0):{videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(result),this.sampleAes?this.decrypt(result,this.sampleAes):result},_proto.extractRemainingSamples=function(demuxResult){var pes,audioTrack=demuxResult.audioTrack,videoTrack=demuxResult.videoTrack,id3Track=demuxResult.id3Track,textTrack=demuxResult.textTrack,videoData=videoTrack.pesData,audioData=audioTrack.pesData,id3Data=id3Track.pesData;if(videoData&&(pes=parsePES(videoData))?(this.videoParser.parseAVCPES(videoTrack,textTrack,pes,!0,this._duration),videoTrack.pesData=null):videoTrack.pesData=videoData,audioData&&(pes=parsePES(audioData))){switch(audioTrack.segmentCodec){case"aac":this.parseAACPES(audioTrack,pes);break;case"mp3":this.parseMPEGPES(audioTrack,pes);break;case"ac3":this.parseAC3PES(audioTrack,pes)}audioTrack.pesData=null}else null!=audioData&&audioData.size&&logger.log("last AAC PES packet truncated,might overlap between fragments"),audioTrack.pesData=audioData;id3Data&&(pes=parsePES(id3Data))?(this.parseID3PES(id3Track,pes),id3Track.pesData=null):id3Track.pesData=id3Data},_proto.demuxSampleAes=function(data,keyData,timeOffset){var demuxResult=this.demux(data,timeOffset,!0,!this.config.progressive),sampleAes=this.sampleAes=new SampleAesDecrypter(this.observer,this.config,keyData);return this.decrypt(demuxResult,sampleAes)},_proto.decrypt=function(demuxResult,sampleAes){return new Promise((function(resolve){var audioTrack=demuxResult.audioTrack,videoTrack=demuxResult.videoTrack;audioTrack.samples&&"aac"===audioTrack.segmentCodec?sampleAes.decryptAacSamples(audioTrack.samples,0,(function(){videoTrack.samples?sampleAes.decryptAvcSamples(videoTrack.samples,0,0,(function(){resolve(demuxResult)})):resolve(demuxResult)})):videoTrack.samples&&sampleAes.decryptAvcSamples(videoTrack.samples,0,0,(function(){resolve(demuxResult)}))}))},_proto.destroy=function(){this._duration=0},_proto.parseAACPES=function(track,pes){var offset,len,pts,startOffset=0,aacOverFlow=this.aacOverFlow,data=pes.data;if(aacOverFlow){this.aacOverFlow=null;var frameMissingBytes=aacOverFlow.missing,sampleLength=aacOverFlow.sample.unit.byteLength;if(-1===frameMissingBytes)data=appendUint8Array(aacOverFlow.sample.unit,data);else{var frameOverflowBytes=sampleLength-frameMissingBytes;aacOverFlow.sample.unit.set(data.subarray(0,frameMissingBytes),frameOverflowBytes),track.samples.push(aacOverFlow.sample),startOffset=aacOverFlow.missing}}for(offset=startOffset,len=data.length;offset<len-1&&!isHeader$1(data,offset);offset++);if(offset!==startOffset){var reason,recoverable=offset<len-1;reason=recoverable?"AAC PES did not start with ADTS header,offset:"+offset:"No ADTS header found in AAC PES";var error=new Error(reason);if(logger.warn("parsing error: "+reason),this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,levelRetry:recoverable,error:error,reason:reason}),!recoverable)return}if(initTrackConfig(track,this.observer,data,offset,this.audioCodec),void 0!==pes.pts)pts=pes.pts;else{if(!aacOverFlow)return void logger.warn("[tsdemuxer]: AAC PES unknown PTS");var frameDuration=getFrameDuration(track.samplerate);pts=aacOverFlow.sample.pts+frameDuration}for(var frame,frameIndex=0;offset<len;){if(offset+=(frame=appendFrame$1(track,data,offset,pts,frameIndex)).length,frame.missing){this.aacOverFlow=frame;break}for(frameIndex++;offset<len-1&&!isHeader$1(data,offset);offset++);}},_proto.parseMPEGPES=function(track,pes){var data=pes.data,length=data.length,frameIndex=0,offset=0,pts=pes.pts;if(void 0!==pts)for(;offset<length;)if(isHeader(data,offset)){var frame=appendFrame(track,data,offset,pts,frameIndex);if(!frame)break;offset+=frame.length,frameIndex++}else offset++;else logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},_proto.parseAC3PES=function(track,pes){var data=pes.data,pts=pes.pts;if(void 0!==pts)for(var parsed,length=data.length,frameIndex=0,offset=0;offset<length&&(parsed=_appendFrame(track,data,offset,pts,frameIndex++))>0;)offset+=parsed;else logger.warn("[tsdemuxer]: AC3 PES unknown PTS")},_proto.parseID3PES=function(id3Track,pes){if(void 0!==pes.pts){var id3Sample=_extends({},pes,{type:this._videoTrack?MetadataSchema.emsg:MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});id3Track.samples.push(id3Sample)}else logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},TSDemuxer})();function parsePID(data,offset){return((31&data[offset+1])<<8)+data[offset+2]}function parsePAT(data,offset){return(31&data[offset+10])<<8|data[offset+11]}function parsePMT(data,offset,typeSupported,isSampleAes){var result={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},tableEnd=offset+3+((15&data[offset+1])<<8|data[offset+2])-4;for(offset+=12+((15&data[offset+10])<<8|data[offset+11]);offset<tableEnd;){var pid=parsePID(data,offset),esInfoLength=(15&data[offset+3])<<8|data[offset+4];switch(data[offset]){case 207:if(!isSampleAes){logEncryptedSamplesFoundInUnencryptedStream("ADTS AAC");break}case 15:-1===result.audioPid&&(result.audioPid=pid);break;case 21:-1===result.id3Pid&&(result.id3Pid=pid);break;case 219:if(!isSampleAes){logEncryptedSamplesFoundInUnencryptedStream("H.264");break}case 27:-1===result.videoPid&&(result.videoPid=pid,result.segmentVideoCodec="avc");break;case 3:case 4:typeSupported.mpeg||typeSupported.mp3?-1===result.audioPid&&(result.audioPid=pid,result.segmentAudioCodec="mp3"):logger.log("MPEG audio found, not supported in this browser");break;case 193:if(!isSampleAes){logEncryptedSamplesFoundInUnencryptedStream("AC-3");break}case 129:typeSupported.ac3?-1===result.audioPid&&(result.audioPid=pid,result.segmentAudioCodec="ac3"):logger.log("AC-3 audio found, not supported in this browser");break;case 6:if(-1===result.audioPid&&esInfoLength>0)for(var parsePos=offset+5,remaining=esInfoLength;remaining>2;){switch(data[parsePos]){case 106:!0!==typeSupported.ac3?logger.log("AC-3 audio found, not supported in this browser for now"):(result.audioPid=pid,result.segmentAudioCodec="ac3")}var descriptorLen=data[parsePos+1]+2;parsePos+=descriptorLen,remaining-=descriptorLen}break;case 194:case 135:logger.warn("Unsupported EC-3 in M2TS found");break;case 36:logger.warn("Unsupported HEVC in M2TS found")}offset+=esInfoLength+5}return result}function logEncryptedSamplesFoundInUnencryptedStream(type){logger.log(type+" with AES-128-CBC encryption found in unencrypted stream")}function parsePES(stream){var frag,pesLen,pesHdrLen,pesPts,pesDts,i=0,data=stream.data;if(!stream||0===stream.size)return null;for(;data[0].length<19&&data.length>1;)data[0]=appendUint8Array(data[0],data[1]),data.splice(1,1);if(1===((frag=data[0])[0]<<16)+(frag[1]<<8)+frag[2]){if((pesLen=(frag[4]<<8)+frag[5])&&pesLen>stream.size-6)return null;var pesFlags=frag[7];192&pesFlags&&(pesPts=536870912*(14&frag[9])+4194304*(255&frag[10])+16384*(254&frag[11])+128*(255&frag[12])+(254&frag[13])/2,64&pesFlags?pesPts-(pesDts=536870912*(14&frag[14])+4194304*(255&frag[15])+16384*(254&frag[16])+128*(255&frag[17])+(254&frag[18])/2)>54e5&&(logger.warn(Math.round((pesPts-pesDts)/9e4)+"s delta between PTS and DTS, align them"),pesPts=pesDts):pesDts=pesPts);var payloadStartOffset=(pesHdrLen=frag[8])+9;if(stream.size<=payloadStartOffset)return null;stream.size-=payloadStartOffset;for(var pesData=new Uint8Array(stream.size),j=0,dataLen=data.length;j<dataLen;j++){var len=(frag=data[j]).byteLength;if(payloadStartOffset){if(payloadStartOffset>len){payloadStartOffset-=len;continue}frag=frag.subarray(payloadStartOffset),len-=payloadStartOffset,payloadStartOffset=0}pesData.set(frag,i),i+=len}return pesLen&&(pesLen-=pesHdrLen+3),{data:pesData,pts:pesPts,dts:pesDts,len:pesLen}}return null}var MP3Demuxer=(function(_BaseAudioDemuxer){function MP3Demuxer(){return _BaseAudioDemuxer.apply(this,arguments)||this}_inheritsLoose(MP3Demuxer,_BaseAudioDemuxer);var _proto=MP3Demuxer.prototype;return _proto.resetInitSegment=function(initSegment,audioCodec,videoCodec,trackDuration){_BaseAudioDemuxer.prototype.resetInitSegment.call(this,initSegment,audioCodec,videoCodec,trackDuration),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:audioCodec,duration:trackDuration,inputTimeScale:9e4,dropped:0}},MP3Demuxer.probe=function(data){if(!data)return!1;var id3Data=getID3Data(data,0),offset=(null==id3Data?void 0:id3Data.length)||0;if(id3Data&&11===data[offset]&&119===data[offset+1]&&void 0!==getTimeStamp(id3Data)&&getAudioBSID(data,offset)<=16)return!1;for(var length=data.length;offset<length;offset++)if(probe(data,offset))return logger.log("MPEG Audio sync word found !"),!0;return!1},_proto.canParse=function(data,offset){return canParse(data,offset)},_proto.appendFrame=function(track,data,offset){if(null!==this.basePTS)return appendFrame(track,data,offset,this.basePTS,this.frameIndex)},MP3Demuxer})(BaseAudioDemuxer),AAC=(function(){function AAC(){}return AAC.getSilentFrame=function(codec,channelCount){switch(codec){case"mp4a.40.2":if(1===channelCount)return new Uint8Array([0,200,0,128,35,128]);if(2===channelCount)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===channelCount)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===channelCount)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===channelCount)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===channelCount)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===channelCount)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===channelCount)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===channelCount)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},AAC})(),UINT32_MAX=Math.pow(2,32)-1,MP4=(function(){function MP4(){}return MP4.init=function(){var i;for(i in MP4.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},MP4.types)MP4.types.hasOwnProperty(i)&&(MP4.types[i]=[i.charCodeAt(0),i.charCodeAt(1),i.charCodeAt(2),i.charCodeAt(3)]);var videoHdlr=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),audioHdlr=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);MP4.HDLR_TYPES={video:videoHdlr,audio:audioHdlr};var dref=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),stco=new Uint8Array([0,0,0,0,0,0,0,0]);MP4.STTS=MP4.STSC=MP4.STCO=stco,MP4.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),MP4.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),MP4.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),MP4.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var majorBrand=new Uint8Array([105,115,111,109]),avc1Brand=new Uint8Array([97,118,99,49]),minorVersion=new Uint8Array([0,0,0,1]);MP4.FTYP=MP4.box(MP4.types.ftyp,majorBrand,minorVersion,majorBrand,avc1Brand),MP4.DINF=MP4.box(MP4.types.dinf,MP4.box(MP4.types.dref,dref))},MP4.box=function(type){for(var size=8,_len=arguments.length,payload=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)payload[_key-1]=arguments[_key];for(var i=payload.length,len=i;i--;)size+=payload[i].byteLength;var result=new Uint8Array(size);for(result[0]=size>>24&255,result[1]=size>>16&255,result[2]=size>>8&255,result[3]=255&size,result.set(type,4),i=0,size=8;i<len;i++)result.set(payload[i],size),size+=payload[i].byteLength;return result},MP4.hdlr=function(type){return MP4.box(MP4.types.hdlr,MP4.HDLR_TYPES[type])},MP4.mdat=function(data){return MP4.box(MP4.types.mdat,data)},MP4.mdhd=function(timescale,duration){duration*=timescale;var upperWordDuration=Math.floor(duration/(UINT32_MAX+1)),lowerWordDuration=Math.floor(duration%(UINT32_MAX+1));return MP4.box(MP4.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,timescale>>24&255,timescale>>16&255,timescale>>8&255,255&timescale,upperWordDuration>>24,upperWordDuration>>16&255,upperWordDuration>>8&255,255&upperWordDuration,lowerWordDuration>>24,lowerWordDuration>>16&255,lowerWordDuration>>8&255,255&lowerWordDuration,85,196,0,0]))},MP4.mdia=function(track){return MP4.box(MP4.types.mdia,MP4.mdhd(track.timescale,track.duration),MP4.hdlr(track.type),MP4.minf(track))},MP4.mfhd=function(sequenceNumber){return MP4.box(MP4.types.mfhd,new Uint8Array([0,0,0,0,sequenceNumber>>24,sequenceNumber>>16&255,sequenceNumber>>8&255,255&sequenceNumber]))},MP4.minf=function(track){return"audio"===track.type?MP4.box(MP4.types.minf,MP4.box(MP4.types.smhd,MP4.SMHD),MP4.DINF,MP4.stbl(track)):MP4.box(MP4.types.minf,MP4.box(MP4.types.vmhd,MP4.VMHD),MP4.DINF,MP4.stbl(track))},MP4.moof=function(sn,baseMediaDecodeTime,track){return MP4.box(MP4.types.moof,MP4.mfhd(sn),MP4.traf(track,baseMediaDecodeTime))},MP4.moov=function(tracks){for(var i=tracks.length,boxes=[];i--;)boxes[i]=MP4.trak(tracks[i]);return MP4.box.apply(null,[MP4.types.moov,MP4.mvhd(tracks[0].timescale,tracks[0].duration)].concat(boxes).concat(MP4.mvex(tracks)))},MP4.mvex=function(tracks){for(var i=tracks.length,boxes=[];i--;)boxes[i]=MP4.trex(tracks[i]);return MP4.box.apply(null,[MP4.types.mvex].concat(boxes))},MP4.mvhd=function(timescale,duration){duration*=timescale;var upperWordDuration=Math.floor(duration/(UINT32_MAX+1)),lowerWordDuration=Math.floor(duration%(UINT32_MAX+1)),bytes=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,timescale>>24&255,timescale>>16&255,timescale>>8&255,255&timescale,upperWordDuration>>24,upperWordDuration>>16&255,upperWordDuration>>8&255,255&upperWordDuration,lowerWordDuration>>24,lowerWordDuration>>16&255,lowerWordDuration>>8&255,255&lowerWordDuration,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return MP4.box(MP4.types.mvhd,bytes)},MP4.sdtp=function(track){var i,flags,samples=track.samples||[],bytes=new Uint8Array(4+samples.length);for(i=0;i<samples.length;i++)flags=samples[i].flags,bytes[i+4]=flags.dependsOn<<4|flags.isDependedOn<<2|flags.hasRedundancy;return MP4.box(MP4.types.sdtp,bytes)},MP4.stbl=function(track){return MP4.box(MP4.types.stbl,MP4.stsd(track),MP4.box(MP4.types.stts,MP4.STTS),MP4.box(MP4.types.stsc,MP4.STSC),MP4.box(MP4.types.stsz,MP4.STSZ),MP4.box(MP4.types.stco,MP4.STCO))},MP4.avc1=function(track){var i,data,len,sps=[],pps=[];for(i=0;i<track.sps.length;i++)len=(data=track.sps[i]).byteLength,sps.push(len>>>8&255),sps.push(255&len),sps=sps.concat(Array.prototype.slice.call(data));for(i=0;i<track.pps.length;i++)len=(data=track.pps[i]).byteLength,pps.push(len>>>8&255),pps.push(255&len),pps=pps.concat(Array.prototype.slice.call(data));var avcc=MP4.box(MP4.types.avcC,new Uint8Array([1,sps[3],sps[4],sps[5],255,224|track.sps.length].concat(sps).concat([track.pps.length]).concat(pps))),width=track.width,height=track.height,hSpacing=track.pixelRatio[0],vSpacing=track.pixelRatio[1];return MP4.box(MP4.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,width>>8&255,255&width,height>>8&255,255&height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),avcc,MP4.box(MP4.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),MP4.box(MP4.types.pasp,new Uint8Array([hSpacing>>24,hSpacing>>16&255,hSpacing>>8&255,255&hSpacing,vSpacing>>24,vSpacing>>16&255,vSpacing>>8&255,255&vSpacing])))},MP4.esds=function(track){var configlen=track.config.length;return new Uint8Array([0,0,0,0,3,23+configlen,0,1,0,4,15+configlen,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([configlen]).concat(track.config).concat([6,1,2]))},MP4.audioStsd=function(track){var samplerate=track.samplerate;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,track.channelCount,0,16,0,0,0,0,samplerate>>8&255,255&samplerate,0,0])},MP4.mp4a=function(track){return MP4.box(MP4.types.mp4a,MP4.audioStsd(track),MP4.box(MP4.types.esds,MP4.esds(track)))},MP4.mp3=function(track){return MP4.box(MP4.types[".mp3"],MP4.audioStsd(track))},MP4.ac3=function(track){return MP4.box(MP4.types["ac-3"],MP4.audioStsd(track),MP4.box(MP4.types.dac3,track.config))},MP4.stsd=function(track){return"audio"===track.type?"mp3"===track.segmentCodec&&"mp3"===track.codec?MP4.box(MP4.types.stsd,MP4.STSD,MP4.mp3(track)):"ac3"===track.segmentCodec?MP4.box(MP4.types.stsd,MP4.STSD,MP4.ac3(track)):MP4.box(MP4.types.stsd,MP4.STSD,MP4.mp4a(track)):MP4.box(MP4.types.stsd,MP4.STSD,MP4.avc1(track))},MP4.tkhd=function(track){var id=track.id,duration=track.duration*track.timescale,width=track.width,height=track.height,upperWordDuration=Math.floor(duration/(UINT32_MAX+1)),lowerWordDuration=Math.floor(duration%(UINT32_MAX+1));return MP4.box(MP4.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,id>>24&255,id>>16&255,id>>8&255,255&id,0,0,0,0,upperWordDuration>>24,upperWordDuration>>16&255,upperWordDuration>>8&255,255&upperWordDuration,lowerWordDuration>>24,lowerWordDuration>>16&255,lowerWordDuration>>8&255,255&lowerWordDuration,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,width>>8&255,255&width,0,0,height>>8&255,255&height,0,0]))},MP4.traf=function(track,baseMediaDecodeTime){var sampleDependencyTable=MP4.sdtp(track),id=track.id,upperWordBaseMediaDecodeTime=Math.floor(baseMediaDecodeTime/(UINT32_MAX+1)),lowerWordBaseMediaDecodeTime=Math.floor(baseMediaDecodeTime%(UINT32_MAX+1));return MP4.box(MP4.types.traf,MP4.box(MP4.types.tfhd,new Uint8Array([0,0,0,0,id>>24,id>>16&255,id>>8&255,255&id])),MP4.box(MP4.types.tfdt,new Uint8Array([1,0,0,0,upperWordBaseMediaDecodeTime>>24,upperWordBaseMediaDecodeTime>>16&255,upperWordBaseMediaDecodeTime>>8&255,255&upperWordBaseMediaDecodeTime,lowerWordBaseMediaDecodeTime>>24,lowerWordBaseMediaDecodeTime>>16&255,lowerWordBaseMediaDecodeTime>>8&255,255&lowerWordBaseMediaDecodeTime])),MP4.trun(track,sampleDependencyTable.length+16+20+8+16+8+8),sampleDependencyTable)},MP4.trak=function(track){return track.duration=track.duration||4294967295,MP4.box(MP4.types.trak,MP4.tkhd(track),MP4.mdia(track))},MP4.trex=function(track){var id=track.id;return MP4.box(MP4.types.trex,new Uint8Array([0,0,0,0,id>>24,id>>16&255,id>>8&255,255&id,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},MP4.trun=function(track,offset){var i,sample,duration,size,flags,cts,samples=track.samples||[],len=samples.length,arraylen=12+16*len,array=new Uint8Array(arraylen);for(offset+=8+arraylen,array.set(["video"===track.type?1:0,0,15,1,len>>>24&255,len>>>16&255,len>>>8&255,255&len,offset>>>24&255,offset>>>16&255,offset>>>8&255,255&offset],0),i=0;i<len;i++)duration=(sample=samples[i]).duration,size=sample.size,flags=sample.flags,cts=sample.cts,array.set([duration>>>24&255,duration>>>16&255,duration>>>8&255,255&duration,size>>>24&255,size>>>16&255,size>>>8&255,255&size,flags.isLeading<<2|flags.dependsOn,flags.isDependedOn<<6|flags.hasRedundancy<<4|flags.paddingValue<<1|flags.isNonSync,61440&flags.degradPrio,15&flags.degradPrio,cts>>>24&255,cts>>>16&255,cts>>>8&255,255&cts],12+16*i);return MP4.box(MP4.types.trun,array)},MP4.initSegment=function(tracks){MP4.types||MP4.init();var movie=MP4.moov(tracks);return appendUint8Array(MP4.FTYP,movie)},MP4})();MP4.types=void 0,MP4.HDLR_TYPES=void 0,MP4.STTS=void 0,MP4.STSC=void 0,MP4.STCO=void 0,MP4.STSZ=void 0,MP4.VMHD=void 0,MP4.SMHD=void 0,MP4.STSD=void 0,MP4.FTYP=void 0,MP4.DINF=void 0;var MPEG_TS_CLOCK_FREQ_HZ=9e4;function toTimescaleFromBase(baseTime,destScale,srcBase,round){void 0===srcBase&&(srcBase=1),void 0===round&&(round=!1);var result=baseTime*destScale*srcBase;return round?Math.round(result):result}function toTimescaleFromScale(baseTime,destScale,srcScale,round){return void 0===srcScale&&(srcScale=1),void 0===round&&(round=!1),toTimescaleFromBase(baseTime,destScale,1/srcScale,round)}function toMsFromMpegTsClock(baseTime,round){return void 0===round&&(round=!1),toTimescaleFromBase(baseTime,1e3,1/MPEG_TS_CLOCK_FREQ_HZ,round)}function toMpegTsClockFromTimescale(baseTime,srcScale){return void 0===srcScale&&(srcScale=1),toTimescaleFromBase(baseTime,MPEG_TS_CLOCK_FREQ_HZ,1/srcScale)}var MAX_SILENT_FRAME_DURATION=1e4,AAC_SAMPLES_PER_FRAME=1024,MPEG_AUDIO_SAMPLE_PER_FRAME=1152,AC3_SAMPLES_PER_FRAME=1536,chromeVersion=null,safariWebkitVersion=null,MP4Remuxer=(function(){function MP4Remuxer(observer,config,typeSupported,vendor){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=observer,this.config=config,this.typeSupported=typeSupported,this.ISGenerated=!1,null===chromeVersion){var result=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);chromeVersion=result?parseInt(result[1]):0}if(null===safariWebkitVersion){var _result=navigator.userAgent.match(/Safari\/(\d+)/i);safariWebkitVersion=_result?parseInt(_result[1]):0}}var _proto=MP4Remuxer.prototype;return _proto.destroy=function(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null},_proto.resetTimeStamp=function(defaultTimeStamp){logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=defaultTimeStamp},_proto.resetNextTimestamp=function(){logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},_proto.resetInitSegment=function(){logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0},_proto.getVideoStartPts=function(videoSamples){var rolloverDetected=!1,startPTS=videoSamples.reduce((function(minPTS,sample){var delta=sample.pts-minPTS;return delta<-4294967296?(rolloverDetected=!0,normalizePts(minPTS,sample.pts)):delta>0?minPTS:sample.pts}),videoSamples[0].pts);return rolloverDetected&&logger.debug("PTS rollover detected"),startPTS},_proto.remux=function(audioTrack,videoTrack,id3Track,textTrack,timeOffset,accurateTimeOffset,flush,playlistType){var video,audio,initSegment,text,id3,independent,audioTimeOffset=timeOffset,videoTimeOffset=timeOffset,hasAudio=audioTrack.pid>-1,hasVideo=videoTrack.pid>-1,length=videoTrack.samples.length,enoughAudioSamples=audioTrack.samples.length>0,enoughVideoSamples=flush&&length>0||length>1;if((!hasAudio||enoughAudioSamples)&&(!hasVideo||enoughVideoSamples)||this.ISGenerated||flush){if(this.ISGenerated){var _videoTrack$pixelRati,_config$pixelRatio,_videoTrack$pixelRati2,_config$pixelRatio2,config=this.videoTrackConfig;!config||videoTrack.width===config.width&&videoTrack.height===config.height&&(null==(_videoTrack$pixelRati=videoTrack.pixelRatio)?void 0:_videoTrack$pixelRati[0])===(null==(_config$pixelRatio=config.pixelRatio)?void 0:_config$pixelRatio[0])&&(null==(_videoTrack$pixelRati2=videoTrack.pixelRatio)?void 0:_videoTrack$pixelRati2[1])===(null==(_config$pixelRatio2=config.pixelRatio)?void 0:_config$pixelRatio2[1])||this.resetInitSegment()}else initSegment=this.generateIS(audioTrack,videoTrack,timeOffset,accurateTimeOffset);var firstKeyFramePTS,isVideoContiguous=this.isVideoContiguous,firstKeyFrameIndex=-1;if(enoughVideoSamples&&(firstKeyFrameIndex=findKeyframeIndex(videoTrack.samples),!isVideoContiguous&&this.config.forceKeyFrameOnDiscontinuity))if(independent=!0,firstKeyFrameIndex>0){logger.warn("[mp4-remuxer]: Dropped "+firstKeyFrameIndex+" out of "+length+" video samples due to a missing keyframe");var startPTS=this.getVideoStartPts(videoTrack.samples);videoTrack.samples=videoTrack.samples.slice(firstKeyFrameIndex),videoTrack.dropped+=firstKeyFrameIndex,firstKeyFramePTS=videoTimeOffset+=(videoTrack.samples[0].pts-startPTS)/videoTrack.inputTimeScale}else-1===firstKeyFrameIndex&&(logger.warn("[mp4-remuxer]: No keyframe found out of "+length+" video samples"),independent=!1);if(this.ISGenerated){if(enoughAudioSamples&&enoughVideoSamples){var _startPTS=this.getVideoStartPts(videoTrack.samples),audiovideoTimestampDelta=(normalizePts(audioTrack.samples[0].pts,_startPTS)-_startPTS)/videoTrack.inputTimeScale;audioTimeOffset+=Math.max(0,audiovideoTimestampDelta),videoTimeOffset+=Math.max(0,-audiovideoTimestampDelta)}if(enoughAudioSamples){if(audioTrack.samplerate||(logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),initSegment=this.generateIS(audioTrack,videoTrack,timeOffset,accurateTimeOffset)),audio=this.remuxAudio(audioTrack,audioTimeOffset,this.isAudioContiguous,accurateTimeOffset,hasVideo||enoughVideoSamples||playlistType===PlaylistLevelType.AUDIO?videoTimeOffset:void 0),enoughVideoSamples){var audioTrackLength=audio?audio.endPTS-audio.startPTS:0;videoTrack.inputTimeScale||(logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),initSegment=this.generateIS(audioTrack,videoTrack,timeOffset,accurateTimeOffset)),video=this.remuxVideo(videoTrack,videoTimeOffset,isVideoContiguous,audioTrackLength)}}else enoughVideoSamples&&(video=this.remuxVideo(videoTrack,videoTimeOffset,isVideoContiguous,0));video&&(video.firstKeyFrame=firstKeyFrameIndex,video.independent=-1!==firstKeyFrameIndex,video.firstKeyFramePTS=firstKeyFramePTS)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(id3Track.samples.length&&(id3=flushTextTrackMetadataCueSamples(id3Track,timeOffset,this._initPTS,this._initDTS)),textTrack.samples.length&&(text=flushTextTrackUserdataCueSamples(textTrack,timeOffset,this._initPTS))),{audio:audio,video:video,initSegment:initSegment,independent:independent,text:text,id3:id3}},_proto.generateIS=function(audioTrack,videoTrack,timeOffset,accurateTimeOffset){var initPTS,initDTS,timescale,audioSamples=audioTrack.samples,videoSamples=videoTrack.samples,typeSupported=this.typeSupported,tracks={},_initPTS=this._initPTS,computePTSDTS=!_initPTS||accurateTimeOffset,container="audio/mp4";if(computePTSDTS&&(initPTS=initDTS=1/0),audioTrack.config&&audioSamples.length){switch(audioTrack.timescale=audioTrack.samplerate,audioTrack.segmentCodec){case"mp3":typeSupported.mpeg?(container="audio/mpeg",audioTrack.codec=""):typeSupported.mp3&&(audioTrack.codec="mp3");break;case"ac3":audioTrack.codec="ac-3"}tracks.audio={id:"audio",container:container,codec:audioTrack.codec,initSegment:"mp3"===audioTrack.segmentCodec&&typeSupported.mpeg?new Uint8Array(0):MP4.initSegment([audioTrack]),metadata:{channelCount:audioTrack.channelCount}},computePTSDTS&&(timescale=audioTrack.inputTimeScale,_initPTS&&timescale===_initPTS.timescale?computePTSDTS=!1:initPTS=initDTS=audioSamples[0].pts-Math.round(timescale*timeOffset))}if(videoTrack.sps&&videoTrack.pps&&videoSamples.length){if(videoTrack.timescale=videoTrack.inputTimeScale,tracks.video={id:"main",container:"video/mp4",codec:videoTrack.codec,initSegment:MP4.initSegment([videoTrack]),metadata:{width:videoTrack.width,height:videoTrack.height}},computePTSDTS)if(timescale=videoTrack.inputTimeScale,_initPTS&&timescale===_initPTS.timescale)computePTSDTS=!1;else{var startPTS=this.getVideoStartPts(videoSamples),startOffset=Math.round(timescale*timeOffset);initDTS=Math.min(initDTS,normalizePts(videoSamples[0].dts,startPTS)-startOffset),initPTS=Math.min(initPTS,startPTS-startOffset)}this.videoTrackConfig={width:videoTrack.width,height:videoTrack.height,pixelRatio:videoTrack.pixelRatio}}if(Object.keys(tracks).length)return this.ISGenerated=!0,computePTSDTS?(this._initPTS={baseTime:initPTS,timescale:timescale},this._initDTS={baseTime:initDTS,timescale:timescale}):initPTS=timescale=void 0,{tracks:tracks,initPTS:initPTS,timescale:timescale}},_proto.remuxVideo=function(track,timeOffset,contiguous,audioTrackLength){var firstDTS,lastDTS,timeScale=track.inputTimeScale,inputSamples=track.samples,outputSamples=[],nbSamples=inputSamples.length,initPTS=this._initPTS,nextAvcDts=this.nextAvcDts,offset=8,mp4SampleDuration=this.videoSampleDuration,minPTS=Number.POSITIVE_INFINITY,maxPTS=Number.NEGATIVE_INFINITY,sortSamples=!1;if(!contiguous||null===nextAvcDts){var pts=timeOffset*timeScale,cts=inputSamples[0].pts-normalizePts(inputSamples[0].dts,inputSamples[0].pts);chromeVersion&&null!==nextAvcDts&&Math.abs(pts-cts-nextAvcDts)<15e3?contiguous=!0:nextAvcDts=pts-cts}for(var initTime=initPTS.baseTime*timeScale/initPTS.timescale,i=0;i<nbSamples;i++){var sample=inputSamples[i];sample.pts=normalizePts(sample.pts-initTime,nextAvcDts),sample.dts=normalizePts(sample.dts-initTime,nextAvcDts),sample.dts<inputSamples[i>0?i-1:i].dts&&(sortSamples=!0)}sortSamples&&inputSamples.sort((function(a,b){var deltadts=a.dts-b.dts,deltapts=a.pts-b.pts;return deltadts||deltapts})),firstDTS=inputSamples[0].dts;var inputDuration=(lastDTS=inputSamples[inputSamples.length-1].dts)-firstDTS,averageSampleDuration=inputDuration?Math.round(inputDuration/(nbSamples-1)):mp4SampleDuration||track.inputTimeScale/30;if(contiguous){var delta=firstDTS-nextAvcDts,foundHole=delta>averageSampleDuration,foundOverlap=delta<-1;if((foundHole||foundOverlap)&&(foundHole?logger.warn("AVC: "+toMsFromMpegTsClock(delta,!0)+" ms ("+delta+"dts) hole between fragments detected at "+timeOffset.toFixed(3)):logger.warn("AVC: "+toMsFromMpegTsClock(-delta,!0)+" ms ("+delta+"dts) overlapping between fragments detected at "+timeOffset.toFixed(3)),!foundOverlap||nextAvcDts>=inputSamples[0].pts||chromeVersion)){firstDTS=nextAvcDts;var firstPTS=inputSamples[0].pts-delta;if(foundHole)inputSamples[0].dts=firstDTS,inputSamples[0].pts=firstPTS;else for(var _i=0;_i<inputSamples.length&&!(inputSamples[_i].dts>firstPTS);_i++)inputSamples[_i].dts-=delta,inputSamples[_i].pts-=delta;logger.log("Video: Initial PTS/DTS adjusted: "+toMsFromMpegTsClock(firstPTS,!0)+"/"+toMsFromMpegTsClock(firstDTS,!0)+", delta: "+toMsFromMpegTsClock(delta,!0)+" ms")}}for(var nbNalu=0,naluLen=0,dtsStep=firstDTS=Math.max(0,firstDTS),_i2=0;_i2<nbSamples;_i2++){for(var _sample=inputSamples[_i2],units=_sample.units,nbUnits=units.length,sampleLen=0,j=0;j<nbUnits;j++)sampleLen+=units[j].data.length;naluLen+=sampleLen,nbNalu+=nbUnits,_sample.length=sampleLen,_sample.dts<dtsStep?(_sample.dts=dtsStep,dtsStep+=averageSampleDuration/4|0||1):dtsStep=_sample.dts,minPTS=Math.min(_sample.pts,minPTS),maxPTS=Math.max(_sample.pts,maxPTS)}lastDTS=inputSamples[nbSamples-1].dts;var mdat,mdatSize=naluLen+4*nbNalu+8;try{mdat=new Uint8Array(mdatSize)}catch(err){return void this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MUX_ERROR,details:ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,error:err,bytes:mdatSize,reason:"fail allocating video mdat "+mdatSize})}var view=new DataView(mdat.buffer);view.setUint32(0,mdatSize),mdat.set(MP4.types.mdat,4);for(var stretchedLastFrame=!1,minDtsDelta=Number.POSITIVE_INFINITY,minPtsDelta=Number.POSITIVE_INFINITY,maxDtsDelta=Number.NEGATIVE_INFINITY,maxPtsDelta=Number.NEGATIVE_INFINITY,_i3=0;_i3<nbSamples;_i3++){for(var _VideoSample=inputSamples[_i3],VideoSampleUnits=_VideoSample.units,mp4SampleLength=0,_j=0,_nbUnits=VideoSampleUnits.length;_j<_nbUnits;_j++){var unit=VideoSampleUnits[_j],unitData=unit.data,unitDataLen=unit.data.byteLength;view.setUint32(offset,unitDataLen),offset+=4,mdat.set(unitData,offset),offset+=unitDataLen,mp4SampleLength+=4+unitDataLen}var ptsDelta=void 0;if(_i3<nbSamples-1)mp4SampleDuration=inputSamples[_i3+1].dts-_VideoSample.dts,ptsDelta=inputSamples[_i3+1].pts-_VideoSample.pts;else{var config=this.config,lastFrameDuration=_i3>0?_VideoSample.dts-inputSamples[_i3-1].dts:averageSampleDuration;if(ptsDelta=_i3>0?_VideoSample.pts-inputSamples[_i3-1].pts:averageSampleDuration,config.stretchShortVideoTrack&&null!==this.nextAudioPts){var gapTolerance=Math.floor(config.maxBufferHole*timeScale),deltaToFrameEnd=(audioTrackLength?minPTS+audioTrackLength*timeScale:this.nextAudioPts)-_VideoSample.pts;deltaToFrameEnd>gapTolerance?((mp4SampleDuration=deltaToFrameEnd-lastFrameDuration)<0?mp4SampleDuration=lastFrameDuration:stretchedLastFrame=!0,logger.log("[mp4-remuxer]: It is approximately "+deltaToFrameEnd/90+" ms to the next segment; using duration "+mp4SampleDuration/90+" ms for the last video frame.")):mp4SampleDuration=lastFrameDuration}else mp4SampleDuration=lastFrameDuration}var compositionTimeOffset=Math.round(_VideoSample.pts-_VideoSample.dts);minDtsDelta=Math.min(minDtsDelta,mp4SampleDuration),maxDtsDelta=Math.max(maxDtsDelta,mp4SampleDuration),minPtsDelta=Math.min(minPtsDelta,ptsDelta),maxPtsDelta=Math.max(maxPtsDelta,ptsDelta),outputSamples.push(new Mp4Sample(_VideoSample.key,mp4SampleDuration,mp4SampleLength,compositionTimeOffset))}if(outputSamples.length)if(chromeVersion){if(chromeVersion<70){var flags=outputSamples[0].flags;flags.dependsOn=2,flags.isNonSync=0}}else if(safariWebkitVersion&&maxPtsDelta-minPtsDelta<maxDtsDelta-minDtsDelta&&averageSampleDuration/maxDtsDelta<.025&&0===outputSamples[0].cts){logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var dts=firstDTS,_i4=0,len=outputSamples.length;_i4<len;_i4++){var nextDts=dts+outputSamples[_i4].duration,_pts=dts+outputSamples[_i4].cts;if(_i4<len-1){var nextPts=nextDts+outputSamples[_i4+1].cts;outputSamples[_i4].duration=nextPts-_pts}else outputSamples[_i4].duration=_i4?outputSamples[_i4-1].duration:averageSampleDuration;outputSamples[_i4].cts=0,dts=nextDts}}mp4SampleDuration=stretchedLastFrame||!mp4SampleDuration?averageSampleDuration:mp4SampleDuration,this.nextAvcDts=nextAvcDts=lastDTS+mp4SampleDuration,this.videoSampleDuration=mp4SampleDuration,this.isVideoContiguous=!0;var data={data1:MP4.moof(track.sequenceNumber++,firstDTS,_extends({},track,{samples:outputSamples})),data2:mdat,startPTS:minPTS/timeScale,endPTS:(maxPTS+mp4SampleDuration)/timeScale,startDTS:firstDTS/timeScale,endDTS:nextAvcDts/timeScale,type:"video",hasAudio:!1,hasVideo:!0,nb:outputSamples.length,dropped:track.dropped};return track.samples=[],track.dropped=0,data},_proto.getSamplesPerFrame=function(track){switch(track.segmentCodec){case"mp3":return MPEG_AUDIO_SAMPLE_PER_FRAME;case"ac3":return AC3_SAMPLES_PER_FRAME;default:return AAC_SAMPLES_PER_FRAME}},_proto.remuxAudio=function(track,timeOffset,contiguous,accurateTimeOffset,videoTimeOffset){var inputTimeScale=track.inputTimeScale,scaleFactor=inputTimeScale/(track.samplerate?track.samplerate:inputTimeScale),mp4SampleDuration=this.getSamplesPerFrame(track),inputSampleDuration=mp4SampleDuration*scaleFactor,initPTS=this._initPTS,rawMPEG="mp3"===track.segmentCodec&&this.typeSupported.mpeg,outputSamples=[],alignedWithVideo=void 0!==videoTimeOffset,inputSamples=track.samples,offset=rawMPEG?0:8,nextAudioPts=this.nextAudioPts||-1,timeOffsetMpegTS=timeOffset*inputTimeScale,initTime=initPTS.baseTime*inputTimeScale/initPTS.timescale;if(this.isAudioContiguous=contiguous=contiguous||inputSamples.length&&nextAudioPts>0&&(accurateTimeOffset&&Math.abs(timeOffsetMpegTS-nextAudioPts)<9e3||Math.abs(normalizePts(inputSamples[0].pts-initTime,timeOffsetMpegTS)-nextAudioPts)<20*inputSampleDuration),inputSamples.forEach((function(sample){sample.pts=normalizePts(sample.pts-initTime,timeOffsetMpegTS)})),!contiguous||nextAudioPts<0){if(!(inputSamples=inputSamples.filter((function(sample){return sample.pts>=0}))).length)return;nextAudioPts=0===videoTimeOffset?0:accurateTimeOffset&&!alignedWithVideo?Math.max(0,timeOffsetMpegTS):inputSamples[0].pts}if("aac"===track.segmentCodec)for(var maxAudioFramesDrift=this.config.maxAudioFramesDrift,i=0,nextPts=nextAudioPts;i<inputSamples.length;i++){var sample=inputSamples[i],pts=sample.pts,delta=pts-nextPts,duration=Math.abs(1e3*delta/inputTimeScale);if(delta<=-maxAudioFramesDrift*inputSampleDuration&&alignedWithVideo)0===i&&(logger.warn("Audio frame @ "+(pts/inputTimeScale).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*delta/inputTimeScale)+" ms."),this.nextAudioPts=nextAudioPts=nextPts=pts);else if(delta>=maxAudioFramesDrift*inputSampleDuration&&duration<MAX_SILENT_FRAME_DURATION&&alignedWithVideo){var missing=Math.round(delta/inputSampleDuration);(nextPts=pts-missing*inputSampleDuration)<0&&(missing--,nextPts+=inputSampleDuration),0===i&&(this.nextAudioPts=nextAudioPts=nextPts),logger.warn("[mp4-remuxer]: Injecting "+missing+" audio frame @ "+(nextPts/inputTimeScale).toFixed(3)+"s due to "+Math.round(1e3*delta/inputTimeScale)+" ms gap.");for(var j=0;j<missing;j++){var newStamp=Math.max(nextPts,0),fillFrame=AAC.getSilentFrame(track.manifestCodec||track.codec,track.channelCount);fillFrame||(logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),fillFrame=sample.unit.subarray()),inputSamples.splice(i,0,{unit:fillFrame,pts:newStamp}),nextPts+=inputSampleDuration,i++}}sample.pts=nextPts,nextPts+=inputSampleDuration}for(var mdat,firstPTS=null,lastPTS=null,mdatSize=0,sampleLength=inputSamples.length;sampleLength--;)mdatSize+=inputSamples[sampleLength].unit.byteLength;for(var _j2=0,_nbSamples=inputSamples.length;_j2<_nbSamples;_j2++){var audioSample=inputSamples[_j2],unit=audioSample.unit,_pts2=audioSample.pts;if(null!==lastPTS)outputSamples[_j2-1].duration=Math.round((_pts2-lastPTS)/scaleFactor);else{if(contiguous&&"aac"===track.segmentCodec&&(_pts2=nextAudioPts),firstPTS=_pts2,!(mdatSize>0))return;mdatSize+=offset;try{mdat=new Uint8Array(mdatSize)}catch(err){return void this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MUX_ERROR,details:ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,error:err,bytes:mdatSize,reason:"fail allocating audio mdat "+mdatSize})}rawMPEG||(new DataView(mdat.buffer).setUint32(0,mdatSize),mdat.set(MP4.types.mdat,4))}mdat.set(unit,offset);var unitLen=unit.byteLength;offset+=unitLen,outputSamples.push(new Mp4Sample(!0,mp4SampleDuration,unitLen,0)),lastPTS=_pts2}var nbSamples=outputSamples.length;if(nbSamples){var lastSample=outputSamples[outputSamples.length-1];this.nextAudioPts=nextAudioPts=lastPTS+scaleFactor*lastSample.duration;var moof=rawMPEG?new Uint8Array(0):MP4.moof(track.sequenceNumber++,firstPTS/scaleFactor,_extends({},track,{samples:outputSamples}));track.samples=[];var start=firstPTS/inputTimeScale,end=nextAudioPts/inputTimeScale,audioData={data1:moof,data2:mdat,startPTS:start,endPTS:end,startDTS:start,endDTS:end,type:"audio",hasAudio:!0,hasVideo:!1,nb:nbSamples};return this.isAudioContiguous=!0,audioData}},_proto.remuxEmptyAudio=function(track,timeOffset,contiguous,videoData){var inputTimeScale=track.inputTimeScale,scaleFactor=inputTimeScale/(track.samplerate?track.samplerate:inputTimeScale),nextAudioPts=this.nextAudioPts,initDTS=this._initDTS,init90kHz=9e4*initDTS.baseTime/initDTS.timescale,startDTS=(null!==nextAudioPts?nextAudioPts:videoData.startDTS*inputTimeScale)+init90kHz,endDTS=videoData.endDTS*inputTimeScale+init90kHz,frameDuration=scaleFactor*AAC_SAMPLES_PER_FRAME,nbSamples=Math.ceil((endDTS-startDTS)/frameDuration),silentFrame=AAC.getSilentFrame(track.manifestCodec||track.codec,track.channelCount);if(logger.warn("[mp4-remuxer]: remux empty Audio"),silentFrame){for(var samples=[],i=0;i<nbSamples;i++){var stamp=startDTS+i*frameDuration;samples.push({unit:silentFrame,pts:stamp,dts:stamp})}return track.samples=samples,this.remuxAudio(track,timeOffset,contiguous,!1)}logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},MP4Remuxer})();function normalizePts(value,reference){var offset;if(null===reference)return value;for(offset=reference<value?-8589934592:8589934592;Math.abs(value-reference)>4294967296;)value+=offset;return value}function findKeyframeIndex(samples){for(var i=0;i<samples.length;i++)if(samples[i].key)return i;return-1}function flushTextTrackMetadataCueSamples(track,timeOffset,initPTS,initDTS){var length=track.samples.length;if(length){for(var inputTimeScale=track.inputTimeScale,index=0;index<length;index++){var sample=track.samples[index];sample.pts=normalizePts(sample.pts-initPTS.baseTime*inputTimeScale/initPTS.timescale,timeOffset*inputTimeScale)/inputTimeScale,sample.dts=normalizePts(sample.dts-initDTS.baseTime*inputTimeScale/initDTS.timescale,timeOffset*inputTimeScale)/inputTimeScale}var samples=track.samples;return track.samples=[],{samples:samples}}}function flushTextTrackUserdataCueSamples(track,timeOffset,initPTS){var length=track.samples.length;if(length){for(var inputTimeScale=track.inputTimeScale,index=0;index<length;index++){var sample=track.samples[index];sample.pts=normalizePts(sample.pts-initPTS.baseTime*inputTimeScale/initPTS.timescale,timeOffset*inputTimeScale)/inputTimeScale}track.samples.sort((function(a,b){return a.pts-b.pts}));var samples=track.samples;return track.samples=[],{samples:samples}}}var now,Mp4Sample=function(isKeyframe,duration,size,cts){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=duration,this.size=size,this.cts=cts,this.flags={isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:isKeyframe?2:1,isNonSync:isKeyframe?0:1}},PassThroughRemuxer=(function(){function PassThroughRemuxer(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}var _proto=PassThroughRemuxer.prototype;return _proto.destroy=function(){},_proto.resetTimeStamp=function(defaultInitPTS){this.initPTS=defaultInitPTS,this.lastEndTime=null},_proto.resetNextTimestamp=function(){this.lastEndTime=null},_proto.resetInitSegment=function(initSegment,audioCodec,videoCodec,decryptdata){this.audioCodec=audioCodec,this.videoCodec=videoCodec,this.generateInitSegment(patchEncyptionData(initSegment,decryptdata)),this.emitInitSegment=!0},_proto.generateInitSegment=function(initSegment){var audioCodec=this.audioCodec,videoCodec=this.videoCodec;if(null==initSegment||!initSegment.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var initData=this.initData=parseInitSegment(initSegment);initData.audio&&(audioCodec=getParsedTrackCodec(initData.audio,ElementaryStreamTypes.AUDIO)),initData.video&&(videoCodec=getParsedTrackCodec(initData.video,ElementaryStreamTypes.VIDEO));var tracks={};initData.audio&&initData.video?tracks.audiovideo={container:"video/mp4",codec:audioCodec+","+videoCodec,initSegment:initSegment,id:"main"}:initData.audio?tracks.audio={container:"audio/mp4",codec:audioCodec,initSegment:initSegment,id:"audio"}:initData.video?tracks.video={container:"video/mp4",codec:videoCodec,initSegment:initSegment,id:"main"}:logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=tracks},_proto.remux=function(audioTrack,videoTrack,id3Track,textTrack,timeOffset,accurateTimeOffset){var _initData,_initData2,initPTS=this.initPTS,lastEndTime=this.lastEndTime,result={audio:void 0,video:void 0,text:textTrack,id3:id3Track,initSegment:void 0};isFiniteNumber(lastEndTime)||(lastEndTime=this.lastEndTime=timeOffset||0);var data=videoTrack.samples;if(null==data||!data.length)return result;var initSegment={initPTS:void 0,timescale:1},initData=this.initData;if(null!=(_initData=initData)&&_initData.length||(this.generateInitSegment(data),initData=this.initData),null==(_initData2=initData)||!_initData2.length)return logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),result;this.emitInitSegment&&(initSegment.tracks=this.initTracks,this.emitInitSegment=!1);var duration=getDuration(data,initData),startDTS=getStartDTS(initData,data),decodeTime=null===startDTS?timeOffset:startDTS;(isInvalidInitPts(initPTS,decodeTime,timeOffset,duration)||initSegment.timescale!==initPTS.timescale&&accurateTimeOffset)&&(initSegment.initPTS=decodeTime-timeOffset,initPTS&&1===initPTS.timescale&&logger.warn("Adjusting initPTS by "+(initSegment.initPTS-initPTS.baseTime)),this.initPTS=initPTS={baseTime:initSegment.initPTS,timescale:1});var startTime=audioTrack?decodeTime-initPTS.baseTime/initPTS.timescale:lastEndTime,endTime=startTime+duration;offsetStartDTS(initData,data,initPTS.baseTime/initPTS.timescale),duration>0?this.lastEndTime=endTime:(logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var hasAudio=!!initData.audio,hasVideo=!!initData.video,type="";hasAudio&&(type+="audio"),hasVideo&&(type+="video");var track={data1:data,startPTS:startTime,startDTS:startTime,endPTS:endTime,endDTS:endTime,type:type,hasAudio:hasAudio,hasVideo:hasVideo,nb:1,dropped:0};return result.audio="audio"===track.type?track:void 0,result.video="audio"!==track.type?track:void 0,result.initSegment=initSegment,result.id3=flushTextTrackMetadataCueSamples(id3Track,timeOffset,initPTS,initPTS),textTrack.samples.length&&(result.text=flushTextTrackUserdataCueSamples(textTrack,timeOffset,initPTS)),result},PassThroughRemuxer})();function isInvalidInitPts(initPTS,startDTS,timeOffset,duration){if(null===initPTS)return!0;var minDuration=Math.max(duration,1),startTime=startDTS-initPTS.baseTime/initPTS.timescale;return Math.abs(startTime-timeOffset)>minDuration}function getParsedTrackCodec(track,type){var parsedCodec=null==track?void 0:track.codec;if(parsedCodec&&parsedCodec.length>4)return parsedCodec;if(type===ElementaryStreamTypes.AUDIO){if("ec-3"===parsedCodec||"ac-3"===parsedCodec||"alac"===parsedCodec)return parsedCodec;if("fLaC"===parsedCodec||"Opus"===parsedCodec)return getCodecCompatibleName(parsedCodec,!1);var result="mp4a.40.5";return logger.info('Parsed audio codec "'+parsedCodec+'" or audio object type not handled. Using "'+result+'"'),result}return logger.warn('Unhandled video codec "'+parsedCodec+'"'),"hvc1"===parsedCodec||"hev1"===parsedCodec?"hvc1.1.6.L120.90":"av01"===parsedCodec?"av01.0.04M.08":"avc1.42e01e"}try{now=self.performance.now.bind(self.performance)}catch(err){logger.debug("Unable to use Performance API on this environment"),now=null==optionalSelf?void 0:optionalSelf.Date.now}var muxConfig=[{demux:MP4Demuxer,remux:PassThroughRemuxer},{demux:TSDemuxer,remux:MP4Remuxer},{demux:AACDemuxer,remux:MP4Remuxer},{demux:MP3Demuxer,remux:MP4Remuxer}];muxConfig.splice(2,0,{demux:AC3Demuxer,remux:MP4Remuxer});var Transmuxer=(function(){function Transmuxer(observer,typeSupported,config,vendor,id){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=observer,this.typeSupported=typeSupported,this.config=config,this.vendor=vendor,this.id=id}var _proto=Transmuxer.prototype;return _proto.configure=function(transmuxConfig){this.transmuxConfig=transmuxConfig,this.decrypter&&this.decrypter.reset()},_proto.push=function(data,decryptdata,chunkMeta,state){var _this=this,stats=chunkMeta.transmuxing;stats.executeStart=now();var uintData=new Uint8Array(data),currentTransmuxState=this.currentTransmuxState,transmuxConfig=this.transmuxConfig;state&&(this.currentTransmuxState=state);var _ref=state||currentTransmuxState,contiguous=_ref.contiguous,discontinuity=_ref.discontinuity,trackSwitch=_ref.trackSwitch,accurateTimeOffset=_ref.accurateTimeOffset,timeOffset=_ref.timeOffset,initSegmentChange=_ref.initSegmentChange,audioCodec=transmuxConfig.audioCodec,videoCodec=transmuxConfig.videoCodec,defaultInitPts=transmuxConfig.defaultInitPts,duration=transmuxConfig.duration,initSegmentData=transmuxConfig.initSegmentData,keyData=getEncryptionType(uintData,decryptdata);if(keyData&&"AES-128"===keyData.method){var decrypter=this.getDecrypter();if(!decrypter.isSync())return this.decryptionPromise=decrypter.webCryptoDecrypt(uintData,keyData.key.buffer,keyData.iv.buffer).then((function(decryptedData){var result=_this.push(decryptedData,null,chunkMeta);return _this.decryptionPromise=null,result})),this.decryptionPromise;var decryptedData=decrypter.softwareDecrypt(uintData,keyData.key.buffer,keyData.iv.buffer);if(chunkMeta.part>-1&&(decryptedData=decrypter.flush()),!decryptedData)return stats.executeEnd=now(),emptyResult(chunkMeta);uintData=new Uint8Array(decryptedData)}var resetMuxers=this.needsProbing(discontinuity,trackSwitch);if(resetMuxers){var error=this.configureTransmuxer(uintData);if(error)return logger.warn("[transmuxer] "+error.message),this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,error:error,reason:error.message}),stats.executeEnd=now(),emptyResult(chunkMeta)}(discontinuity||trackSwitch||initSegmentChange||resetMuxers)&&this.resetInitSegment(initSegmentData,audioCodec,videoCodec,duration,decryptdata),(discontinuity||initSegmentChange||resetMuxers)&&this.resetInitialTimestamp(defaultInitPts),contiguous||this.resetContiguity();var result=this.transmux(uintData,keyData,timeOffset,accurateTimeOffset,chunkMeta),currentState=this.currentTransmuxState;return currentState.contiguous=!0,currentState.discontinuity=!1,currentState.trackSwitch=!1,stats.executeEnd=now(),result},_proto.flush=function(chunkMeta){var _this2=this,stats=chunkMeta.transmuxing;stats.executeStart=now();var decrypter=this.decrypter,currentTransmuxState=this.currentTransmuxState,decryptionPromise=this.decryptionPromise;if(decryptionPromise)return decryptionPromise.then((function(){return _this2.flush(chunkMeta)}));var transmuxResults=[],timeOffset=currentTransmuxState.timeOffset;if(decrypter){var decryptedData=decrypter.flush();decryptedData&&transmuxResults.push(this.push(decryptedData,null,chunkMeta))}var demuxer=this.demuxer,remuxer=this.remuxer;if(!demuxer||!remuxer)return stats.executeEnd=now(),[emptyResult(chunkMeta)];var demuxResultOrPromise=demuxer.flush(timeOffset);return isPromise(demuxResultOrPromise)?demuxResultOrPromise.then((function(demuxResult){return _this2.flushRemux(transmuxResults,demuxResult,chunkMeta),transmuxResults})):(this.flushRemux(transmuxResults,demuxResultOrPromise,chunkMeta),transmuxResults)},_proto.flushRemux=function(transmuxResults,demuxResult,chunkMeta){var audioTrack=demuxResult.audioTrack,videoTrack=demuxResult.videoTrack,id3Track=demuxResult.id3Track,textTrack=demuxResult.textTrack,_this$currentTransmux=this.currentTransmuxState,accurateTimeOffset=_this$currentTransmux.accurateTimeOffset,timeOffset=_this$currentTransmux.timeOffset;logger.log("[transmuxer.ts]: Flushed fragment "+chunkMeta.sn+(chunkMeta.part>-1?" p: "+chunkMeta.part:"")+" of level "+chunkMeta.level);var remuxResult=this.remuxer.remux(audioTrack,videoTrack,id3Track,textTrack,timeOffset,accurateTimeOffset,!0,this.id);transmuxResults.push({remuxResult:remuxResult,chunkMeta:chunkMeta}),chunkMeta.transmuxing.executeEnd=now()},_proto.resetInitialTimestamp=function(defaultInitPts){var demuxer=this.demuxer,remuxer=this.remuxer;demuxer&&remuxer&&(demuxer.resetTimeStamp(defaultInitPts),remuxer.resetTimeStamp(defaultInitPts))},_proto.resetContiguity=function(){var demuxer=this.demuxer,remuxer=this.remuxer;demuxer&&remuxer&&(demuxer.resetContiguity(),remuxer.resetNextTimestamp())},_proto.resetInitSegment=function(initSegmentData,audioCodec,videoCodec,trackDuration,decryptdata){var demuxer=this.demuxer,remuxer=this.remuxer;demuxer&&remuxer&&(demuxer.resetInitSegment(initSegmentData,audioCodec,videoCodec,trackDuration),remuxer.resetInitSegment(initSegmentData,audioCodec,videoCodec,decryptdata))},_proto.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},_proto.transmux=function(data,keyData,timeOffset,accurateTimeOffset,chunkMeta){return keyData&&"SAMPLE-AES"===keyData.method?this.transmuxSampleAes(data,keyData,timeOffset,accurateTimeOffset,chunkMeta):this.transmuxUnencrypted(data,timeOffset,accurateTimeOffset,chunkMeta)},_proto.transmuxUnencrypted=function(data,timeOffset,accurateTimeOffset,chunkMeta){var _demux=this.demuxer.demux(data,timeOffset,!1,!this.config.progressive),audioTrack=_demux.audioTrack,videoTrack=_demux.videoTrack,id3Track=_demux.id3Track,textTrack=_demux.textTrack;return{remuxResult:this.remuxer.remux(audioTrack,videoTrack,id3Track,textTrack,timeOffset,accurateTimeOffset,!1,this.id),chunkMeta:chunkMeta}},_proto.transmuxSampleAes=function(data,decryptData,timeOffset,accurateTimeOffset,chunkMeta){var _this3=this;return this.demuxer.demuxSampleAes(data,decryptData,timeOffset).then((function(demuxResult){return{remuxResult:_this3.remuxer.remux(demuxResult.audioTrack,demuxResult.videoTrack,demuxResult.id3Track,demuxResult.textTrack,timeOffset,accurateTimeOffset,!1,_this3.id),chunkMeta:chunkMeta}}))},_proto.configureTransmuxer=function(data){for(var mux,config=this.config,observer=this.observer,typeSupported=this.typeSupported,vendor=this.vendor,i=0,len=muxConfig.length;i<len;i++){var _muxConfig$i$demux;if(null!=(_muxConfig$i$demux=muxConfig[i].demux)&&_muxConfig$i$demux.probe(data)){mux=muxConfig[i];break}}if(!mux)return new Error("Failed to find demuxer by probing fragment data");var demuxer=this.demuxer,remuxer=this.remuxer,Remuxer=mux.remux,Demuxer=mux.demux;remuxer&&remuxer instanceof Remuxer||(this.remuxer=new Remuxer(observer,config,typeSupported,vendor)),demuxer&&demuxer instanceof Demuxer||(this.demuxer=new Demuxer(observer,config,typeSupported),this.probe=Demuxer.probe)},_proto.needsProbing=function(discontinuity,trackSwitch){return!this.demuxer||!this.remuxer||discontinuity||trackSwitch},_proto.getDecrypter=function(){var decrypter=this.decrypter;return decrypter||(decrypter=this.decrypter=new Decrypter(this.config)),decrypter},Transmuxer})();function getEncryptionType(data,decryptData){var encryptionType=null;return data.byteLength>0&&null!=(null==decryptData?void 0:decryptData.key)&&null!==decryptData.iv&&null!=decryptData.method&&(encryptionType=decryptData),encryptionType}var emptyResult=function(chunkMeta){return{remuxResult:{},chunkMeta:chunkMeta}};function isPromise(p){return"then"in p&&p.then instanceof Function}var TransmuxConfig=function(audioCodec,videoCodec,initSegmentData,duration,defaultInitPts){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=audioCodec,this.videoCodec=videoCodec,this.initSegmentData=initSegmentData,this.duration=duration,this.defaultInitPts=defaultInitPts||null},TransmuxState=function(discontinuity,contiguous,accurateTimeOffset,trackSwitch,timeOffset,initSegmentChange){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=discontinuity,this.contiguous=contiguous,this.accurateTimeOffset=accurateTimeOffset,this.trackSwitch=trackSwitch,this.timeOffset=timeOffset,this.initSegmentChange=initSegmentChange},eventemitter3={exports:{}};!(function(module){var has=Object.prototype.hasOwnProperty,prefix="~";function Events(){}function EE(fn,context,once){this.fn=fn,this.context=context,this.once=once||!1}function addListener(emitter,event,fn,context,once){if("function"!=typeof fn)throw new TypeError("The listener must be a function");var listener=new EE(fn,context||emitter,once),evt=prefix?prefix+event:event;return emitter._events[evt]?emitter._events[evt].fn?emitter._events[evt]=[emitter._events[evt],listener]:emitter._events[evt].push(listener):(emitter._events[evt]=listener,emitter._eventsCount++),emitter}function clearEvent(emitter,evt){0==--emitter._eventsCount?emitter._events=new Events:delete emitter._events[evt]}function EventEmitter(){this._events=new Events,this._eventsCount=0}Object.create&&(Events.prototype=Object.create(null),(new Events).__proto__||(prefix=!1)),EventEmitter.prototype.eventNames=function(){var events,name,names=[];if(0===this._eventsCount)return names;for(name in events=this._events)has.call(events,name)&&names.push(prefix?name.slice(1):name);return Object.getOwnPropertySymbols?names.concat(Object.getOwnPropertySymbols(events)):names},EventEmitter.prototype.listeners=function(event){var evt=prefix?prefix+event:event,handlers=this._events[evt];if(!handlers)return[];if(handlers.fn)return[handlers.fn];for(var i=0,l=handlers.length,ee=new Array(l);i<l;i++)ee[i]=handlers[i].fn;return ee},EventEmitter.prototype.listenerCount=function(event){var evt=prefix?prefix+event:event,listeners=this._events[evt];return listeners?listeners.fn?1:listeners.length:0},EventEmitter.prototype.emit=function(event,a1,a2,a3,a4,a5){var evt=prefix?prefix+event:event;if(!this._events[evt])return!1;var args,i,listeners=this._events[evt],len=arguments.length;if(listeners.fn){switch(listeners.once&&this.removeListener(event,listeners.fn,void 0,!0),len){case 1:return listeners.fn.call(listeners.context),!0;case 2:return listeners.fn.call(listeners.context,a1),!0;case 3:return listeners.fn.call(listeners.context,a1,a2),!0;case 4:return listeners.fn.call(listeners.context,a1,a2,a3),!0;case 5:return listeners.fn.call(listeners.context,a1,a2,a3,a4),!0;case 6:return listeners.fn.call(listeners.context,a1,a2,a3,a4,a5),!0}for(i=1,args=new Array(len-1);i<len;i++)args[i-1]=arguments[i];listeners.fn.apply(listeners.context,args)}else{var j,length=listeners.length;for(i=0;i<length;i++)switch(listeners[i].once&&this.removeListener(event,listeners[i].fn,void 0,!0),len){case 1:listeners[i].fn.call(listeners[i].context);break;case 2:listeners[i].fn.call(listeners[i].context,a1);break;case 3:listeners[i].fn.call(listeners[i].context,a1,a2);break;case 4:listeners[i].fn.call(listeners[i].context,a1,a2,a3);break;default:if(!args)for(j=1,args=new Array(len-1);j<len;j++)args[j-1]=arguments[j];listeners[i].fn.apply(listeners[i].context,args)}}return!0},EventEmitter.prototype.on=function(event,fn,context){return addListener(this,event,fn,context,!1)},EventEmitter.prototype.once=function(event,fn,context){return addListener(this,event,fn,context,!0)},EventEmitter.prototype.removeListener=function(event,fn,context,once){var evt=prefix?prefix+event:event;if(!this._events[evt])return this;if(!fn)return clearEvent(this,evt),this;var listeners=this._events[evt];if(listeners.fn)listeners.fn!==fn||once&&!listeners.once||context&&listeners.context!==context||clearEvent(this,evt);else{for(var i=0,events=[],length=listeners.length;i<length;i++)(listeners[i].fn!==fn||once&&!listeners[i].once||context&&listeners[i].context!==context)&&events.push(listeners[i]);events.length?this._events[evt]=1===events.length?events[0]:events:clearEvent(this,evt)}return this},EventEmitter.prototype.removeAllListeners=function(event){var evt;return event?(evt=prefix?prefix+event:event,this._events[evt]&&clearEvent(this,evt)):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prefixed=prefix,EventEmitter.EventEmitter=EventEmitter,module.exports=EventEmitter})(eventemitter3);var EventEmitter=getDefaultExportFromCjs(eventemitter3.exports);function startWorker(self){var observer=new EventEmitter,forwardMessage=function(ev,data){self.postMessage({event:ev,data:data})};observer.on(Events.FRAG_DECRYPTED,forwardMessage),observer.on(Events.ERROR,forwardMessage);var forwardWorkerLogs=function(){var _loop=function(logFn){var func=function(message){forwardMessage("workerLog",{logType:logFn,message:message})};logger[logFn]=func};for(var logFn in logger)_loop(logFn)};self.addEventListener("message",(function(ev){var data=ev.data;switch(data.cmd){case"init":var config=JSON.parse(data.config);self.transmuxer=new Transmuxer(observer,data.typeSupported,config,data.vendor,data.id),enableLogs(config.debug,data.id),forwardWorkerLogs(),forwardMessage("init",null);break;case"configure":self.transmuxer.configure(data.config);break;case"demux":var transmuxResult=self.transmuxer.push(data.data,data.decryptdata,data.chunkMeta,data.state);isPromise(transmuxResult)?(self.transmuxer.async=!0,transmuxResult.then((function(data){emitTransmuxComplete(self,data)})).catch((function(error){forwardMessage(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:data.chunkMeta,fatal:!1,error:error,err:error,reason:"transmuxer-worker push error"})}))):(self.transmuxer.async=!1,emitTransmuxComplete(self,transmuxResult));break;case"flush":var id=data.chunkMeta,_transmuxResult=self.transmuxer.flush(id);isPromise(_transmuxResult)||self.transmuxer.async?(isPromise(_transmuxResult)||(_transmuxResult=Promise.resolve(_transmuxResult)),_transmuxResult.then((function(results){handleFlushResult(self,results,id)})).catch((function(error){forwardMessage(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:data.chunkMeta,fatal:!1,error:error,err:error,reason:"transmuxer-worker flush error"})}))):handleFlushResult(self,_transmuxResult,id)}}))}function emitTransmuxComplete(self,transmuxResult){if(isEmptyResult(transmuxResult.remuxResult))return!1;var transferable=[],_transmuxResult$remux=transmuxResult.remuxResult,audio=_transmuxResult$remux.audio,video=_transmuxResult$remux.video;return audio&&addToTransferable(transferable,audio),video&&addToTransferable(transferable,video),self.postMessage({event:"transmuxComplete",data:transmuxResult},transferable),!0}function addToTransferable(transferable,track){track.data1&&transferable.push(track.data1.buffer),track.data2&&transferable.push(track.data2.buffer)}function handleFlushResult(self,results,chunkMeta){results.reduce((function(parsed,result){return emitTransmuxComplete(self,result)||parsed}),!1)||self.postMessage({event:"transmuxComplete",data:results[0]}),self.postMessage({event:"flush",data:chunkMeta})}function isEmptyResult(remuxResult){return!(remuxResult.audio||remuxResult.video||remuxResult.text||remuxResult.id3||remuxResult.initSegment)}function hasUMDWorker(){return!0}function injectWorker(){var blob=new self.Blob(["var exports={};var module={exports:exports};function define(f){f()};define.amd=true;("+__HLS_WORKER_BUNDLE__.toString()+")(true);"],{type:"text/javascript"}),objectURL=self.URL.createObjectURL(blob);return{worker:new self.Worker(objectURL),objectURL:objectURL}}function loadWorker(path){var scriptURL=new self.URL(path,self.location.href).href;return{worker:new self.Worker(scriptURL),scriptURL:scriptURL}}void 0!==__IN_WORKER__&&__IN_WORKER__&&startWorker(self);var TransmuxerInterface=(function(){function TransmuxerInterface(hls,id,onTransmuxComplete,onFlush){var _this=this;this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var config=hls.config;this.hls=hls,this.id=id,this.useWorker=!!config.enableWorker,this.onTransmuxComplete=onTransmuxComplete,this.onFlush=onFlush;var forwardMessage=function(ev,data){(data=data||{}).frag=_this.frag,data.id=_this.id,ev===Events.ERROR&&(_this.error=data.error),_this.hls.trigger(ev,data)};this.observer=new EventEmitter,this.observer.on(Events.FRAG_DECRYPTED,forwardMessage),this.observer.on(Events.ERROR,forwardMessage);var MediaSource=getMediaSource(config.preferManagedMediaSource)||{isTypeSupported:function(){return!1}},m2tsTypeSupported={mpeg:MediaSource.isTypeSupported("audio/mpeg"),mp3:MediaSource.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:MediaSource.isTypeSupported('audio/mp4; codecs="ac-3"')},vendor=navigator.vendor;if(this.useWorker&&"undefined"!=typeof Worker&&(config.workerPath||hasUMDWorker()))try{config.workerPath?(logger.log("loading Web Worker "+config.workerPath+' for "'+id+'"'),this.workerContext=loadWorker(config.workerPath)):(logger.log('injecting Web Worker for "'+id+'"'),this.workerContext=injectWorker()),this.onwmsg=function(ev){return _this.onWorkerMessage(ev)};var worker=this.workerContext.worker;worker.addEventListener("message",this.onwmsg),worker.onerror=function(event){var error=new Error(event.message+"  ("+event.filename+":"+event.lineno+")");config.enableWorker=!1,logger.warn('Error in "'+id+'" Web Worker, fallback to inline'),_this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:error})},worker.postMessage({cmd:"init",typeSupported:m2tsTypeSupported,vendor:vendor,id:id,config:JSON.stringify(config)})}catch(err){logger.warn('Error setting up "'+id+'" Web Worker, fallback to inline',err),this.resetWorker(),this.error=null,this.transmuxer=new Transmuxer(this.observer,m2tsTypeSupported,config,vendor,id)}else this.transmuxer=new Transmuxer(this.observer,m2tsTypeSupported,config,vendor,id)}var _proto=TransmuxerInterface.prototype;return _proto.resetWorker=function(){if(this.workerContext){var _this$workerContext=this.workerContext,worker=_this$workerContext.worker,objectURL=_this$workerContext.objectURL;objectURL&&self.URL.revokeObjectURL(objectURL),worker.removeEventListener("message",this.onwmsg),worker.onerror=null,worker.terminate(),this.workerContext=null}},_proto.destroy=function(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{var transmuxer=this.transmuxer;transmuxer&&(transmuxer.destroy(),this.transmuxer=null)}var observer=this.observer;observer&&observer.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},_proto.push=function(data,initSegmentData,audioCodec,videoCodec,frag,part,duration,accurateTimeOffset,chunkMeta,defaultInitPTS){var _frag$initSegment,_lastFrag$initSegment,_this2=this;chunkMeta.transmuxing.start=self.performance.now();var transmuxer=this.transmuxer,timeOffset=part?part.start:frag.start,decryptdata=frag.decryptdata,lastFrag=this.frag,discontinuity=!(lastFrag&&frag.cc===lastFrag.cc),trackSwitch=!(lastFrag&&chunkMeta.level===lastFrag.level),snDiff=lastFrag?chunkMeta.sn-lastFrag.sn:-1,partDiff=this.part?chunkMeta.part-this.part.index:-1,progressive=0===snDiff&&chunkMeta.id>1&&chunkMeta.id===(null==lastFrag?void 0:lastFrag.stats.chunkCount),contiguous=!trackSwitch&&(1===snDiff||0===snDiff&&(1===partDiff||progressive&&partDiff<=0)),now=self.performance.now();(trackSwitch||snDiff||0===frag.stats.parsing.start)&&(frag.stats.parsing.start=now),!part||!partDiff&&contiguous||(part.stats.parsing.start=now);var initSegmentChange=!(lastFrag&&(null==(_frag$initSegment=frag.initSegment)?void 0:_frag$initSegment.url)===(null==(_lastFrag$initSegment=lastFrag.initSegment)?void 0:_lastFrag$initSegment.url)),state=new TransmuxState(discontinuity,contiguous,accurateTimeOffset,trackSwitch,timeOffset,initSegmentChange);if(!contiguous||discontinuity||initSegmentChange){logger.log("[transmuxer-interface, "+frag.type+"]: Starting new transmux session for sn: "+chunkMeta.sn+" p: "+chunkMeta.part+" level: "+chunkMeta.level+" id: "+chunkMeta.id+"\n        discontinuity: "+discontinuity+"\n        trackSwitch: "+trackSwitch+"\n        contiguous: "+contiguous+"\n        accurateTimeOffset: "+accurateTimeOffset+"\n        timeOffset: "+timeOffset+"\n        initSegmentChange: "+initSegmentChange);var config=new TransmuxConfig(audioCodec,videoCodec,initSegmentData,duration,defaultInitPTS);this.configureTransmuxer(config)}if(this.frag=frag,this.part=part,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:data,decryptdata:decryptdata,chunkMeta:chunkMeta,state:state},data instanceof ArrayBuffer?[data]:[]);else if(transmuxer){var _transmuxResult=transmuxer.push(data,decryptdata,chunkMeta,state);isPromise(_transmuxResult)?(transmuxer.async=!0,_transmuxResult.then((function(data){_this2.handleTransmuxComplete(data)})).catch((function(error){_this2.transmuxerError(error,chunkMeta,"transmuxer-interface push error")}))):(transmuxer.async=!1,this.handleTransmuxComplete(_transmuxResult))}},_proto.flush=function(chunkMeta){var _this3=this;chunkMeta.transmuxing.start=self.performance.now();var transmuxer=this.transmuxer;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:chunkMeta});else if(transmuxer){var _transmuxResult2=transmuxer.flush(chunkMeta);isPromise(_transmuxResult2)||transmuxer.async?(isPromise(_transmuxResult2)||(_transmuxResult2=Promise.resolve(_transmuxResult2)),_transmuxResult2.then((function(data){_this3.handleFlushResult(data,chunkMeta)})).catch((function(error){_this3.transmuxerError(error,chunkMeta,"transmuxer-interface flush error")}))):this.handleFlushResult(_transmuxResult2,chunkMeta)}},_proto.transmuxerError=function(error,chunkMeta,reason){this.hls&&(this.error=error,this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:chunkMeta,fatal:!1,error:error,err:error,reason:reason}))},_proto.handleFlushResult=function(results,chunkMeta){var _this4=this;results.forEach((function(result){_this4.handleTransmuxComplete(result)})),this.onFlush(chunkMeta)},_proto.onWorkerMessage=function(ev){var data=ev.data,hls=this.hls;switch(data.event){case"init":var _this$workerContext2,objectURL=null==(_this$workerContext2=this.workerContext)?void 0:_this$workerContext2.objectURL;objectURL&&self.URL.revokeObjectURL(objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(data.data);break;case"flush":this.onFlush(data.data);break;case"workerLog":logger[data.data.logType]&&logger[data.data.logType](data.data.message);break;default:data.data=data.data||{},data.data.frag=this.frag,data.data.id=this.id,hls.trigger(data.event,data.data)}},_proto.configureTransmuxer=function(config){var transmuxer=this.transmuxer;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:config}):transmuxer&&transmuxer.configure(config)},_proto.handleTransmuxComplete=function(result){result.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(result)},TransmuxerInterface})();function subtitleOptionsIdentical(trackList1,trackList2){if(trackList1.length!==trackList2.length)return!1;for(var i=0;i<trackList1.length;i++)if(!mediaAttributesIdentical(trackList1[i].attrs,trackList2[i].attrs))return!1;return!0}function mediaAttributesIdentical(attrs1,attrs2,customAttributes){var stableRenditionId=attrs1["STABLE-RENDITION-ID"];return stableRenditionId&&!customAttributes?stableRenditionId===attrs2["STABLE-RENDITION-ID"]:!(customAttributes||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some((function(subtitleAttribute){return attrs1[subtitleAttribute]!==attrs2[subtitleAttribute]}))}function subtitleTrackMatchesTextTrack(subtitleTrack,textTrack){return textTrack.label.toLowerCase()===subtitleTrack.name.toLowerCase()&&(!textTrack.language||textTrack.language.toLowerCase()===(subtitleTrack.lang||"").toLowerCase())}var TICK_INTERVAL$2=100,AudioStreamController=(function(_BaseStreamController){function AudioStreamController(hls,fragmentTracker,keyLoader){var _this;return(_this=_BaseStreamController.call(this,hls,fragmentTracker,keyLoader,"[audio-stream-controller]",PlaylistLevelType.AUDIO)||this).videoBuffer=null,_this.videoTrackCC=-1,_this.waitingVideoCC=-1,_this.bufferedTrack=null,_this.switchingTrack=null,_this.trackId=-1,_this.waitingData=null,_this.mainDetails=null,_this.flushing=!1,_this.bufferFlushed=!1,_this.cachedTrackLoadedData=null,_this._registerListeners(),_this}_inheritsLoose(AudioStreamController,_BaseStreamController);var _proto=AudioStreamController.prototype;return _proto.onHandlerDestroying=function(){this._unregisterListeners(),_BaseStreamController.prototype.onHandlerDestroying.call(this),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null},_proto._registerListeners=function(){var hls=this.hls;hls.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),hls.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),hls.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),hls.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),hls.on(Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),hls.on(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),hls.on(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),hls.on(Events.ERROR,this.onError,this),hls.on(Events.BUFFER_RESET,this.onBufferReset,this),hls.on(Events.BUFFER_CREATED,this.onBufferCreated,this),hls.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),hls.on(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),hls.on(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),hls.on(Events.FRAG_BUFFERED,this.onFragBuffered,this)},_proto._unregisterListeners=function(){var hls=this.hls;hls.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),hls.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),hls.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),hls.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),hls.off(Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),hls.off(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),hls.off(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),hls.off(Events.ERROR,this.onError,this),hls.off(Events.BUFFER_RESET,this.onBufferReset,this),hls.off(Events.BUFFER_CREATED,this.onBufferCreated,this),hls.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),hls.off(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),hls.off(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),hls.off(Events.FRAG_BUFFERED,this.onFragBuffered,this)},_proto.onInitPtsFound=function(event,_ref){var frag=_ref.frag,id=_ref.id,initPTS=_ref.initPTS,timescale=_ref.timescale;if("main"===id){var cc=frag.cc;this.initPTS[frag.cc]={baseTime:initPTS,timescale:timescale},this.log("InitPTS for cc: "+cc+" found from main: "+initPTS),this.videoTrackCC=cc,this.state===State.WAITING_INIT_PTS&&this.tick()}},_proto.startLoad=function(startPosition){if(!this.levels)return this.startPosition=startPosition,void(this.state=State.STOPPED);var lastCurrentTime=this.lastCurrentTime;this.stopLoad(),this.setInterval(TICK_INTERVAL$2),lastCurrentTime>0&&-1===startPosition?(this.log("Override startPosition with lastCurrentTime @"+lastCurrentTime.toFixed(3)),startPosition=lastCurrentTime,this.state=State.IDLE):(this.loadedmetadata=!1,this.state=State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=startPosition,this.tick()},_proto.doTick=function(){switch(this.state){case State.IDLE:this.doTickIdle();break;case State.WAITING_TRACK:var _levels$trackId,levels=this.levels,trackId=this.trackId,details=null==levels||null==(_levels$trackId=levels[trackId])?void 0:_levels$trackId.details;if(details){if(this.waitForCdnTuneIn(details))break;this.state=State.WAITING_INIT_PTS}break;case State.FRAG_LOADING_WAITING_RETRY:var _this$media,now=performance.now(),retryDate=this.retryDate;if(!retryDate||now>=retryDate||null!=(_this$media=this.media)&&_this$media.seeking){var _levels=this.levels,_trackId=this.trackId;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((null==_levels?void 0:_levels[_trackId])||null),this.state=State.IDLE}break;case State.WAITING_INIT_PTS:var waitingData=this.waitingData;if(waitingData){var frag=waitingData.frag,part=waitingData.part,cache=waitingData.cache,complete=waitingData.complete;if(void 0!==this.initPTS[frag.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=State.FRAG_LOADING;var data={frag:frag,part:part,payload:cache.flush(),networkDetails:null};this._handleFragmentLoadProgress(data),complete&&_BaseStreamController.prototype._handleFragmentLoadComplete.call(this,data)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+frag.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var pos=this.getLoadPosition(),bufferInfo=BufferHelper.bufferInfo(this.mediaBuffer,pos,this.config.maxBufferHole);fragmentWithinToleranceTest(bufferInfo.end,this.config.maxFragLookUpTolerance,frag)<0&&(this.log("Waiting fragment cc ("+frag.cc+") @ "+frag.start+" cancelled because another fragment at "+bufferInfo.end+" is needed"),this.clearWaitingFragment())}}else this.state=State.IDLE}this.onTickEnd()},_proto.clearWaitingFragment=function(){var waitingData=this.waitingData;waitingData&&(this.fragmentTracker.removeFragment(waitingData.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=State.IDLE)},_proto.resetLoadingState=function(){this.clearWaitingFragment(),_BaseStreamController.prototype.resetLoadingState.call(this)},_proto.onTickEnd=function(){var media=this.media;null!=media&&media.readyState&&(this.lastCurrentTime=media.currentTime)},_proto.doTickIdle=function(){var hls=this.hls,levels=this.levels,media=this.media,trackId=this.trackId,config=hls.config;if((media||!this.startFragRequested&&config.startFragPrefetch)&&null!=levels&&levels[trackId]){var levelInfo=levels[trackId],trackDetails=levelInfo.details;if(!trackDetails||trackDetails.live&&this.levelLastLoaded!==levelInfo||this.waitForCdnTuneIn(trackDetails))this.state=State.WAITING_TRACK;else{var bufferable=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&bufferable&&(this.bufferFlushed=!1,this.afterBufferFlushed(bufferable,ElementaryStreamTypes.AUDIO,PlaylistLevelType.AUDIO));var bufferInfo=this.getFwdBufferInfo(bufferable,PlaylistLevelType.AUDIO);if(null!==bufferInfo){var bufferedTrack=this.bufferedTrack,switchingTrack=this.switchingTrack;if(!switchingTrack&&this._streamEnded(bufferInfo,trackDetails))return hls.trigger(Events.BUFFER_EOS,{type:"audio"}),void(this.state=State.ENDED);var mainBufferInfo=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,PlaylistLevelType.MAIN),bufferLen=bufferInfo.len,maxBufLen=this.getMaxBufferLength(null==mainBufferInfo?void 0:mainBufferInfo.len),fragments=trackDetails.fragments,start=fragments[0].start,targetBufferTime=this.flushing?this.getLoadPosition():bufferInfo.end;if(switchingTrack&&media){var pos=this.getLoadPosition();bufferedTrack&&!mediaAttributesIdentical(switchingTrack.attrs,bufferedTrack.attrs)&&(targetBufferTime=pos),trackDetails.PTSKnown&&pos<start&&(bufferInfo.end>start||bufferInfo.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),media.currentTime=start+.05)}if(!(bufferLen>=maxBufLen&&!switchingTrack&&targetBufferTime<fragments[fragments.length-1].start)){var frag=this.getNextFragment(targetBufferTime,trackDetails),atGap=!1;if(frag&&this.isLoopLoading(frag,targetBufferTime)&&(atGap=!!frag.gap,frag=this.getNextFragmentLoopLoading(frag,trackDetails,bufferInfo,PlaylistLevelType.MAIN,maxBufLen)),frag){var atBufferSyncLimit=mainBufferInfo&&frag.start>mainBufferInfo.end+trackDetails.targetduration;if(atBufferSyncLimit||(null==mainBufferInfo||!mainBufferInfo.len)&&bufferInfo.len){var mainFrag=this.getAppendedFrag(frag.start,PlaylistLevelType.MAIN);if(null===mainFrag)return;if(atGap||(atGap=!!mainFrag.gap||!!atBufferSyncLimit&&0===mainBufferInfo.len),atBufferSyncLimit&&!atGap||atGap&&bufferInfo.nextStart&&bufferInfo.nextStart<mainFrag.end)return}this.loadFragment(frag,levelInfo,targetBufferTime)}else this.bufferFlushed=!0}}}}},_proto.getMaxBufferLength=function(mainBufferLength){var maxConfigBuffer=_BaseStreamController.prototype.getMaxBufferLength.call(this);return mainBufferLength?Math.min(Math.max(maxConfigBuffer,mainBufferLength),this.config.maxMaxBufferLength):maxConfigBuffer},_proto.onMediaDetaching=function(){this.videoBuffer=null,this.bufferFlushed=this.flushing=!1,_BaseStreamController.prototype.onMediaDetaching.call(this)},_proto.onAudioTracksUpdated=function(event,_ref2){var audioTracks=_ref2.audioTracks;this.resetTransmuxer(),this.levels=audioTracks.map((function(mediaPlaylist){return new Level(mediaPlaylist)}))},_proto.onAudioTrackSwitching=function(event,data){var altAudio=!!data.url;this.trackId=data.id;var fragCurrent=this.fragCurrent;fragCurrent&&(fragCurrent.abortRequests(),this.removeUnbufferedFrags(fragCurrent.start)),this.resetLoadingState(),altAudio?this.setInterval(TICK_INTERVAL$2):this.resetTransmuxer(),altAudio?(this.switchingTrack=data,this.state=State.IDLE,this.flushAudioIfNeeded(data)):(this.switchingTrack=null,this.bufferedTrack=data,this.state=State.STOPPED),this.tick()},_proto.onManifestLoading=function(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=this.flushing=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1},_proto.onLevelLoaded=function(event,data){this.mainDetails=data.details,null!==this.cachedTrackLoadedData&&(this.hls.trigger(Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},_proto.onAudioTrackLoaded=function(event,data){var _track$details;if(null!=this.mainDetails){var levels=this.levels,newDetails=data.details,trackId=data.id;if(levels){this.log("Audio track "+trackId+" loaded ["+newDetails.startSN+","+newDetails.endSN+"]"+(newDetails.lastPartSn?"[part-"+newDetails.lastPartSn+"-"+newDetails.lastPartIndex+"]":"")+",duration:"+newDetails.totalduration);var track=levels[trackId],sliding=0;if(newDetails.live||null!=(_track$details=track.details)&&_track$details.live){this.checkLiveUpdate(newDetails);var _this$levelLastLoaded,mainDetails=this.mainDetails;if(newDetails.deltaUpdateFailed||!mainDetails)return;!track.details&&newDetails.hasProgramDateTime&&mainDetails.hasProgramDateTime?(alignMediaPlaylistByPDT(newDetails,mainDetails),sliding=newDetails.fragments[0].start):sliding=this.alignPlaylists(newDetails,track.details,null==(_this$levelLastLoaded=this.levelLastLoaded)?void 0:_this$levelLastLoaded.details)}track.details=newDetails,this.levelLastLoaded=track,this.startFragRequested||!this.mainDetails&&newDetails.live||this.setStartPosition(this.mainDetails||newDetails,sliding),this.state!==State.WAITING_TRACK||this.waitForCdnTuneIn(newDetails)||(this.state=State.IDLE),this.tick()}else this.warn("Audio tracks were reset while loading level "+trackId)}else this.cachedTrackLoadedData=data},_proto._handleFragmentLoadProgress=function(data){var _frag$initSegment,frag=data.frag,part=data.part,payload=data.payload,config=this.config,trackId=this.trackId,levels=this.levels;if(levels){var track=levels[trackId];if(track){var details=track.details;if(!details)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(frag.start);var audioCodec=config.defaultAudioCodec||track.audioCodec||"mp4a.40.2",transmuxer=this.transmuxer;transmuxer||(transmuxer=this.transmuxer=new TransmuxerInterface(this.hls,PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var initPTS=this.initPTS[frag.cc],initSegmentData=null==(_frag$initSegment=frag.initSegment)?void 0:_frag$initSegment.data;if(void 0!==initPTS){var accurateTimeOffset=!1,partIndex=part?part.index:-1,partial=-1!==partIndex,chunkMeta=new ChunkMetadata(frag.level,frag.sn,frag.stats.chunkCount,payload.byteLength,partIndex,partial);transmuxer.push(payload,initSegmentData,audioCodec,"",frag,part,details.totalduration,accurateTimeOffset,chunkMeta,initPTS)}else this.log("Unknown video PTS for cc "+frag.cc+", waiting for video PTS before demuxing audio frag "+frag.sn+" of ["+details.startSN+" ,"+details.endSN+"],track "+trackId),(this.waitingData=this.waitingData||{frag:frag,part:part,cache:new ChunkCache,complete:!1}).cache.push(new Uint8Array(payload)),this.waitingVideoCC=this.videoTrackCC,this.state=State.WAITING_INIT_PTS}else this.warn("Audio track is undefined on fragment load progress")}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+frag.sn+" of level "+frag.level+" will not be buffered")},_proto._handleFragmentLoadComplete=function(fragLoadedData){this.waitingData?this.waitingData.complete=!0:_BaseStreamController.prototype._handleFragmentLoadComplete.call(this,fragLoadedData)},_proto.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},_proto.onBufferCreated=function(event,data){var audioTrack=data.tracks.audio;audioTrack&&(this.mediaBuffer=audioTrack.buffer||null),data.tracks.video&&(this.videoBuffer=data.tracks.video.buffer||null)},_proto.onFragBuffered=function(event,data){var frag=data.frag,part=data.part;if(frag.type===PlaylistLevelType.AUDIO)if(this.fragContextChanged(frag))this.warn("Fragment "+frag.sn+(part?" p: "+part.index:"")+" of level "+frag.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+(this.switchingTrack?this.switchingTrack.name:"false"));else{if("initSegment"!==frag.sn){this.fragPrevious=frag;var track=this.switchingTrack;track&&(this.bufferedTrack=track,this.switchingTrack=null,this.hls.trigger(Events.AUDIO_TRACK_SWITCHED,_objectSpread2({},track)))}this.fragBufferedComplete(frag,part)}else if(!this.loadedmetadata&&frag.type===PlaylistLevelType.MAIN){var bufferable=this.videoBuffer||this.media;bufferable&&BufferHelper.getBuffered(bufferable).length&&(this.loadedmetadata=!0)}},_proto.onError=function(event,data){var _data$context;if(data.fatal)this.state=State.ERROR;else switch(data.details){case ErrorDetails.FRAG_GAP:case ErrorDetails.FRAG_PARSING_ERROR:case ErrorDetails.FRAG_DECRYPT_ERROR:case ErrorDetails.FRAG_LOAD_ERROR:case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_ERROR:case ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(PlaylistLevelType.AUDIO,data);break;case ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case ErrorDetails.LEVEL_PARSING_ERROR:data.levelRetry||this.state!==State.WAITING_TRACK||(null==(_data$context=data.context)?void 0:_data$context.type)!==PlaylistContextType.AUDIO_TRACK||(this.state=State.IDLE);break;case ErrorDetails.BUFFER_APPEND_ERROR:case ErrorDetails.BUFFER_FULL_ERROR:if(!data.parent||"audio"!==data.parent)return;if(data.details===ErrorDetails.BUFFER_APPEND_ERROR)return void this.resetLoadingState();this.reduceLengthAndFlushBuffer(data)&&(this.bufferedTrack=null,_BaseStreamController.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio"));break;case ErrorDetails.INTERNAL_EXCEPTION:this.recoverWorkerError(data)}},_proto.onBufferFlushing=function(event,_ref3){_ref3.type!==ElementaryStreamTypes.VIDEO&&(this.flushing=!0)},_proto.onBufferFlushed=function(event,_ref4){var type=_ref4.type;if(type!==ElementaryStreamTypes.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===State.ENDED&&(this.state=State.IDLE);var mediaBuffer=this.mediaBuffer||this.media;mediaBuffer&&(this.afterBufferFlushed(mediaBuffer,type,PlaylistLevelType.AUDIO),this.tick())}},_proto._handleTransmuxComplete=function(transmuxResult){var _id3$samples,id="audio",hls=this.hls,remuxResult=transmuxResult.remuxResult,chunkMeta=transmuxResult.chunkMeta,context=this.getCurrentContext(chunkMeta);if(context){var frag=context.frag,part=context.part,level=context.level,details=level.details,audio=remuxResult.audio,text=remuxResult.text,id3=remuxResult.id3,initSegment=remuxResult.initSegment;if(!this.fragContextChanged(frag)&&details){if(this.state=State.PARSING,this.switchingTrack&&audio&&this.completeAudioSwitch(this.switchingTrack),null!=initSegment&&initSegment.tracks){var mapFragment=frag.initSegment||frag;this._bufferInitSegment(level,initSegment.tracks,mapFragment,chunkMeta),hls.trigger(Events.FRAG_PARSING_INIT_SEGMENT,{frag:mapFragment,id:id,tracks:initSegment.tracks})}if(audio){var startPTS=audio.startPTS,endPTS=audio.endPTS,startDTS=audio.startDTS,endDTS=audio.endDTS;part&&(part.elementaryStreams[ElementaryStreamTypes.AUDIO]={startPTS:startPTS,endPTS:endPTS,startDTS:startDTS,endDTS:endDTS}),frag.setElementaryStreamInfo(ElementaryStreamTypes.AUDIO,startPTS,endPTS,startDTS,endDTS),this.bufferFragmentData(audio,frag,part,chunkMeta)}if(null!=id3&&null!=(_id3$samples=id3.samples)&&_id3$samples.length){var emittedID3=_extends({id:id,frag:frag,details:details},id3);hls.trigger(Events.FRAG_PARSING_METADATA,emittedID3)}if(text){var emittedText=_extends({id:id,frag:frag,details:details},text);hls.trigger(Events.FRAG_PARSING_USERDATA,emittedText)}}else this.fragmentTracker.removeFragment(frag)}else this.resetWhenMissingContext(chunkMeta)},_proto._bufferInitSegment=function(currentLevel,tracks,frag,chunkMeta){if(this.state===State.PARSING){tracks.video&&delete tracks.video;var track=tracks.audio;if(track){track.id="audio";var variantAudioCodecs=currentLevel.audioCodec;this.log("Init audio buffer, container:"+track.container+", codecs[level/parsed]=["+variantAudioCodecs+"/"+track.codec+"]"),variantAudioCodecs&&1===variantAudioCodecs.split(",").length&&(track.levelCodec=variantAudioCodecs),this.hls.trigger(Events.BUFFER_CODECS,tracks);var initSegment=track.initSegment;if(null!=initSegment&&initSegment.byteLength){var segment={type:"audio",frag:frag,part:null,chunkMeta:chunkMeta,parent:frag.type,data:initSegment};this.hls.trigger(Events.BUFFER_APPENDING,segment)}this.tickImmediate()}}},_proto.loadFragment=function(frag,track,targetBufferTime){var _track$details2,fragState=this.fragmentTracker.getState(frag);if(this.fragCurrent=frag,this.switchingTrack||fragState===FragmentState.NOT_LOADED||fragState===FragmentState.PARTIAL)if("initSegment"===frag.sn)this._loadInitSegment(frag,track);else if(null!=(_track$details2=track.details)&&_track$details2.live&&!this.initPTS[frag.cc]){this.log("Waiting for video PTS in continuity counter "+frag.cc+" of live stream before loading audio fragment "+frag.sn+" of level "+this.trackId),this.state=State.WAITING_INIT_PTS;var mainDetails=this.mainDetails;mainDetails&&mainDetails.fragments[0].start!==track.details.fragments[0].start&&alignMediaPlaylistByPDT(track.details,mainDetails)}else this.startFragRequested=!0,_BaseStreamController.prototype.loadFragment.call(this,frag,track,targetBufferTime);else this.clearTrackerIfNeeded(frag)},_proto.flushAudioIfNeeded=function(switchingTrack){var media=this.media,bufferedTrack=this.bufferedTrack,bufferedAttributes=null==bufferedTrack?void 0:bufferedTrack.attrs,switchAttributes=switchingTrack.attrs;media&&bufferedAttributes&&(bufferedAttributes.CHANNELS!==switchAttributes.CHANNELS||bufferedTrack.name!==switchingTrack.name||bufferedTrack.lang!==switchingTrack.lang)&&(this.log("Switching audio track : flushing all audio"),_BaseStreamController.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null)},_proto.completeAudioSwitch=function(switchingTrack){var hls=this.hls;this.flushAudioIfNeeded(switchingTrack),this.bufferedTrack=switchingTrack,this.switchingTrack=null,hls.trigger(Events.AUDIO_TRACK_SWITCHED,_objectSpread2({},switchingTrack))},AudioStreamController})(BaseStreamController),AudioTrackController=(function(_BasePlaylistControll){function AudioTrackController(hls){var _this;return(_this=_BasePlaylistControll.call(this,hls,"[audio-track-controller]")||this).tracks=[],_this.groupIds=null,_this.tracksInGroup=[],_this.trackId=-1,_this.currentTrack=null,_this.selectDefaultTrack=!0,_this.registerListeners(),_this}_inheritsLoose(AudioTrackController,_BasePlaylistControll);var _proto=AudioTrackController.prototype;return _proto.registerListeners=function(){var hls=this.hls;hls.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),hls.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),hls.on(Events.LEVEL_LOADING,this.onLevelLoading,this),hls.on(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),hls.on(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),hls.on(Events.ERROR,this.onError,this)},_proto.unregisterListeners=function(){var hls=this.hls;hls.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),hls.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),hls.off(Events.LEVEL_LOADING,this.onLevelLoading,this),hls.off(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),hls.off(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),hls.off(Events.ERROR,this.onError,this)},_proto.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,_BasePlaylistControll.prototype.destroy.call(this)},_proto.onManifestLoading=function(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0},_proto.onManifestParsed=function(event,data){this.tracks=data.audioTracks||[]},_proto.onAudioTrackLoaded=function(event,data){var id=data.id,groupId=data.groupId,details=data.details,trackInActiveGroup=this.tracksInGroup[id];if(trackInActiveGroup&&trackInActiveGroup.groupId===groupId){var curDetails=trackInActiveGroup.details;trackInActiveGroup.details=data.details,this.log("Audio track "+id+' "'+trackInActiveGroup.name+'" lang:'+trackInActiveGroup.lang+" group:"+groupId+" loaded ["+details.startSN+"-"+details.endSN+"]"),id===this.trackId&&this.playlistLoaded(id,data,curDetails)}else this.warn("Audio track with id:"+id+" and group:"+groupId+" not found in active group "+(null==trackInActiveGroup?void 0:trackInActiveGroup.groupId))},_proto.onLevelLoading=function(event,data){this.switchLevel(data.level)},_proto.onLevelSwitching=function(event,data){this.switchLevel(data.level)},_proto.switchLevel=function(levelIndex){var levelInfo=this.hls.levels[levelIndex];if(levelInfo){var audioGroups=levelInfo.audioGroups||null,currentGroups=this.groupIds,currentTrack=this.currentTrack;if(!audioGroups||(null==currentGroups?void 0:currentGroups.length)!==(null==audioGroups?void 0:audioGroups.length)||null!=audioGroups&&audioGroups.some((function(groupId){return-1===(null==currentGroups?void 0:currentGroups.indexOf(groupId))}))){this.groupIds=audioGroups,this.trackId=-1,this.currentTrack=null;var audioTracks=this.tracks.filter((function(track){return!audioGroups||-1!==audioGroups.indexOf(track.groupId)}));if(audioTracks.length)this.selectDefaultTrack&&!audioTracks.some((function(track){return track.default}))&&(this.selectDefaultTrack=!1),audioTracks.forEach((function(track,i){track.id=i}));else if(!currentTrack&&!this.tracksInGroup.length)return;this.tracksInGroup=audioTracks;var audioPreference=this.hls.config.audioPreference;if(!currentTrack&&audioPreference){var groupIndex=findMatchingOption(audioPreference,audioTracks,audioMatchPredicate);if(groupIndex>-1)currentTrack=audioTracks[groupIndex];else{var allIndex=findMatchingOption(audioPreference,this.tracks);currentTrack=this.tracks[allIndex]}}var trackId=this.findTrackId(currentTrack);-1===trackId&&currentTrack&&(trackId=this.findTrackId(null));var audioTracksUpdated={audioTracks:audioTracks};this.log("Updating audio tracks, "+audioTracks.length+" track(s) found in group(s): "+(null==audioGroups?void 0:audioGroups.join(","))),this.hls.trigger(Events.AUDIO_TRACKS_UPDATED,audioTracksUpdated);var selectedTrackId=this.trackId;if(-1!==trackId&&-1===selectedTrackId)this.setAudioTrack(trackId);else if(audioTracks.length&&-1===selectedTrackId){var _this$groupIds,error=new Error("No audio track selected for current audio group-ID(s): "+(null==(_this$groupIds=this.groupIds)?void 0:_this$groupIds.join(","))+" track count: "+audioTracks.length);this.warn(error.message),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:error})}}else this.shouldReloadPlaylist(currentTrack)&&this.setAudioTrack(this.trackId)}},_proto.onError=function(event,data){!data.fatal&&data.context&&(data.context.type!==PlaylistContextType.AUDIO_TRACK||data.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(data.context.groupId)||(this.requestScheduled=-1,this.checkRetry(data)))},_proto.setAudioOption=function(audioOption){var hls=this.hls;if(hls.config.audioPreference=audioOption,audioOption){var allAudioTracks=this.allAudioTracks;if(this.selectDefaultTrack=!1,allAudioTracks.length){var currentTrack=this.currentTrack;if(currentTrack&&matchesOption(audioOption,currentTrack,audioMatchPredicate))return currentTrack;var groupIndex=findMatchingOption(audioOption,this.tracksInGroup,audioMatchPredicate);if(groupIndex>-1){var track=this.tracksInGroup[groupIndex];return this.setAudioTrack(groupIndex),track}if(currentTrack){var searchIndex=hls.loadLevel;-1===searchIndex&&(searchIndex=hls.firstAutoLevel);var switchIndex=findClosestLevelWithAudioGroup(audioOption,hls.levels,allAudioTracks,searchIndex,audioMatchPredicate);if(-1===switchIndex)return null;hls.nextLoadLevel=switchIndex}if(audioOption.channels||audioOption.audioCodec){var withoutCodecAndChannelsMatch=findMatchingOption(audioOption,allAudioTracks);if(withoutCodecAndChannelsMatch>-1)return allAudioTracks[withoutCodecAndChannelsMatch]}}}return null},_proto.setAudioTrack=function(newId){var tracks=this.tracksInGroup;if(newId<0||newId>=tracks.length)this.warn("Invalid audio track id: "+newId);else{this.clearTimer(),this.selectDefaultTrack=!1;var lastTrack=this.currentTrack,track=tracks[newId],trackLoaded=track.details&&!track.details.live;if(!(newId===this.trackId&&track===lastTrack&&trackLoaded||(this.log("Switching to audio-track "+newId+' "'+track.name+'" lang:'+track.lang+" group:"+track.groupId+" channels:"+track.channels),this.trackId=newId,this.currentTrack=track,this.hls.trigger(Events.AUDIO_TRACK_SWITCHING,_objectSpread2({},track)),trackLoaded))){var hlsUrlParameters=this.switchParams(track.url,null==lastTrack?void 0:lastTrack.details);this.loadPlaylist(hlsUrlParameters)}}},_proto.findTrackId=function(currentTrack){for(var audioTracks=this.tracksInGroup,i=0;i<audioTracks.length;i++){var track=audioTracks[i];if((!this.selectDefaultTrack||track.default)&&(!currentTrack||matchesOption(currentTrack,track,audioMatchPredicate)))return i}if(currentTrack){for(var name=currentTrack.name,lang=currentTrack.lang,assocLang=currentTrack.assocLang,characteristics=currentTrack.characteristics,audioCodec=currentTrack.audioCodec,channels=currentTrack.channels,_i=0;_i<audioTracks.length;_i++)if(matchesOption({name:name,lang:lang,assocLang:assocLang,characteristics:characteristics,audioCodec:audioCodec,channels:channels},audioTracks[_i],audioMatchPredicate))return _i;for(var _i2=0;_i2<audioTracks.length;_i2++){var _track2=audioTracks[_i2];if(mediaAttributesIdentical(currentTrack.attrs,_track2.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return _i2}for(var _i3=0;_i3<audioTracks.length;_i3++){var _track3=audioTracks[_i3];if(mediaAttributesIdentical(currentTrack.attrs,_track3.attrs,["LANGUAGE"]))return _i3}}return-1},_proto.loadPlaylist=function(hlsUrlParameters){var audioTrack=this.currentTrack;if(this.shouldLoadPlaylist(audioTrack)&&audioTrack){_BasePlaylistControll.prototype.loadPlaylist.call(this);var id=audioTrack.id,groupId=audioTrack.groupId,url=audioTrack.url;if(hlsUrlParameters)try{url=hlsUrlParameters.addDirectives(url)}catch(error){this.warn("Could not construct new URL with HLS Delivery Directives: "+error)}this.log("loading audio-track playlist "+id+' "'+audioTrack.name+'" lang:'+audioTrack.lang+" group:"+groupId),this.clearTimer(),this.hls.trigger(Events.AUDIO_TRACK_LOADING,{url:url,id:id,groupId:groupId,deliveryDirectives:hlsUrlParameters||null})}},_createClass(AudioTrackController,[{key:"allAudioTracks",get:function(){return this.tracks}},{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(newId){this.selectDefaultTrack=!1,this.setAudioTrack(newId)}}]),AudioTrackController})(BasePlaylistController),TICK_INTERVAL$1=500,SubtitleStreamController=(function(_BaseStreamController){function SubtitleStreamController(hls,fragmentTracker,keyLoader){var _this;return(_this=_BaseStreamController.call(this,hls,fragmentTracker,keyLoader,"[subtitle-stream-controller]",PlaylistLevelType.SUBTITLE)||this).currentTrackId=-1,_this.tracksBuffered=[],_this.mainDetails=null,_this._registerListeners(),_this}_inheritsLoose(SubtitleStreamController,_BaseStreamController);var _proto=SubtitleStreamController.prototype;return _proto.onHandlerDestroying=function(){this._unregisterListeners(),_BaseStreamController.prototype.onHandlerDestroying.call(this),this.mainDetails=null},_proto._registerListeners=function(){var hls=this.hls;hls.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),hls.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),hls.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),hls.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),hls.on(Events.ERROR,this.onError,this),hls.on(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),hls.on(Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),hls.on(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),hls.on(Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),hls.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),hls.on(Events.FRAG_BUFFERED,this.onFragBuffered,this)},_proto._unregisterListeners=function(){var hls=this.hls;hls.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),hls.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),hls.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),hls.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),hls.off(Events.ERROR,this.onError,this),hls.off(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),hls.off(Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),hls.off(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),hls.off(Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),hls.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),hls.off(Events.FRAG_BUFFERED,this.onFragBuffered,this)},_proto.startLoad=function(startPosition){this.stopLoad(),this.state=State.IDLE,this.setInterval(TICK_INTERVAL$1),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=startPosition,this.tick()},_proto.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},_proto.onMediaDetaching=function(){this.tracksBuffered=[],_BaseStreamController.prototype.onMediaDetaching.call(this)},_proto.onLevelLoaded=function(event,data){this.mainDetails=data.details},_proto.onSubtitleFragProcessed=function(event,data){var frag=data.frag,success=data.success;if(this.fragPrevious=frag,this.state=State.IDLE,success){var buffered=this.tracksBuffered[this.currentTrackId];if(buffered){for(var timeRange,fragStart=frag.start,i=0;i<buffered.length;i++)if(fragStart>=buffered[i].start&&fragStart<=buffered[i].end){timeRange=buffered[i];break}var fragEnd=frag.start+frag.duration;timeRange?timeRange.end=fragEnd:(timeRange={start:fragStart,end:fragEnd},buffered.push(timeRange)),this.fragmentTracker.fragBuffered(frag),this.fragBufferedComplete(frag,null)}}},_proto.onBufferFlushing=function(event,data){var startOffset=data.startOffset,endOffset=data.endOffset;if(0===startOffset&&endOffset!==Number.POSITIVE_INFINITY){var endOffsetSubtitles=endOffset-1;if(endOffsetSubtitles<=0)return;data.endOffsetSubtitles=Math.max(0,endOffsetSubtitles),this.tracksBuffered.forEach((function(buffered){for(var i=0;i<buffered.length;)if(buffered[i].end<=endOffsetSubtitles)buffered.shift();else{if(!(buffered[i].start<endOffsetSubtitles))break;buffered[i].start=endOffsetSubtitles,i++}})),this.fragmentTracker.removeFragmentsInRange(startOffset,endOffsetSubtitles,PlaylistLevelType.SUBTITLE)}},_proto.onFragBuffered=function(event,data){var _this$media;this.loadedmetadata||data.frag.type!==PlaylistLevelType.MAIN||null!=(_this$media=this.media)&&_this$media.buffered.length&&(this.loadedmetadata=!0)},_proto.onError=function(event,data){var frag=data.frag;(null==frag?void 0:frag.type)===PlaylistLevelType.SUBTITLE&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==State.STOPPED&&(this.state=State.IDLE))},_proto.onSubtitleTracksUpdated=function(event,_ref){var _this2=this,subtitleTracks=_ref.subtitleTracks;this.levels&&!subtitleOptionsIdentical(this.levels,subtitleTracks)?(this.tracksBuffered=[],this.levels=subtitleTracks.map((function(mediaPlaylist){var level=new Level(mediaPlaylist);return _this2.tracksBuffered[level.id]=[],level})),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,PlaylistLevelType.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null):this.levels=subtitleTracks.map((function(mediaPlaylist){return new Level(mediaPlaylist)}))},_proto.onSubtitleTrackSwitch=function(event,data){var _this$levels;if(this.currentTrackId=data.id,null!=(_this$levels=this.levels)&&_this$levels.length&&-1!==this.currentTrackId){var currentTrack=this.levels[this.currentTrackId];null!=currentTrack&&currentTrack.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,currentTrack&&this.setInterval(TICK_INTERVAL$1)}else this.clearInterval()},_proto.onSubtitleTrackLoaded=function(event,data){var _track$details,currentTrackId=this.currentTrackId,levels=this.levels,newDetails=data.details,trackId=data.id;if(levels){var track=levels[currentTrackId];if(!(trackId>=levels.length||trackId!==currentTrackId)&&track){this.log("Subtitle track "+trackId+" loaded ["+newDetails.startSN+","+newDetails.endSN+"]"+(newDetails.lastPartSn?"[part-"+newDetails.lastPartSn+"-"+newDetails.lastPartIndex+"]":"")+",duration:"+newDetails.totalduration),this.mediaBuffer=this.mediaBufferTimeRanges;var sliding=0;if(newDetails.live||null!=(_track$details=track.details)&&_track$details.live){var mainDetails=this.mainDetails;if(newDetails.deltaUpdateFailed||!mainDetails)return;var _this$levelLastLoaded,mainSlidingStartFragment=mainDetails.fragments[0];track.details?0===(sliding=this.alignPlaylists(newDetails,track.details,null==(_this$levelLastLoaded=this.levelLastLoaded)?void 0:_this$levelLastLoaded.details))&&mainSlidingStartFragment&&addSliding(newDetails,sliding=mainSlidingStartFragment.start):newDetails.hasProgramDateTime&&mainDetails.hasProgramDateTime?(alignMediaPlaylistByPDT(newDetails,mainDetails),sliding=newDetails.fragments[0].start):mainSlidingStartFragment&&addSliding(newDetails,sliding=mainSlidingStartFragment.start)}track.details=newDetails,this.levelLastLoaded=track,this.startFragRequested||!this.mainDetails&&newDetails.live||this.setStartPosition(this.mainDetails||newDetails,sliding),this.tick(),newDetails.live&&!this.fragCurrent&&this.media&&this.state===State.IDLE&&(findFragmentByPTS(null,newDetails.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),track.details=void 0))}}else this.warn("Subtitle tracks were reset while loading level "+trackId)},_proto._handleFragmentLoadComplete=function(fragLoadedData){var _this3=this,frag=fragLoadedData.frag,payload=fragLoadedData.payload,decryptData=frag.decryptdata,hls=this.hls;if(!this.fragContextChanged(frag)&&payload&&payload.byteLength>0&&null!=decryptData&&decryptData.key&&decryptData.iv&&"AES-128"===decryptData.method){var startTime=performance.now();this.decrypter.decrypt(new Uint8Array(payload),decryptData.key.buffer,decryptData.iv.buffer).catch((function(err){throw hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!1,error:err,reason:err.message,frag:frag}),err})).then((function(decryptedData){var endTime=performance.now();hls.trigger(Events.FRAG_DECRYPTED,{frag:frag,payload:decryptedData,stats:{tstart:startTime,tdecrypt:endTime}})})).catch((function(err){_this3.warn(err.name+": "+err.message),_this3.state=State.IDLE}))}},_proto.doTick=function(){if(this.media){if(this.state===State.IDLE){var currentTrackId=this.currentTrackId,levels=this.levels,track=null==levels?void 0:levels[currentTrackId];if(!track||!levels.length||!track.details)return;var config=this.config,currentTime=this.getLoadPosition(),bufferedInfo=BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],currentTime,config.maxBufferHole),targetBufferTime=bufferedInfo.end,bufferLen=bufferedInfo.len,mainBufferInfo=this.getFwdBufferInfo(this.media,PlaylistLevelType.MAIN),trackDetails=track.details;if(bufferLen>this.getMaxBufferLength(null==mainBufferInfo?void 0:mainBufferInfo.len)+trackDetails.levelTargetDuration)return;var fragments=trackDetails.fragments,fragLen=fragments.length,end=trackDetails.edge,foundFrag=null,fragPrevious=this.fragPrevious;if(targetBufferTime<end){var tolerance=config.maxFragLookUpTolerance,lookupTolerance=targetBufferTime>end-tolerance?0:tolerance;!(foundFrag=findFragmentByPTS(fragPrevious,fragments,Math.max(fragments[0].start,targetBufferTime),lookupTolerance))&&fragPrevious&&fragPrevious.start<fragments[0].start&&(foundFrag=fragments[0])}else foundFrag=fragments[fragLen-1];if(!foundFrag)return;if("initSegment"!==(foundFrag=this.mapToInitFragWhenRequired(foundFrag)).sn){var prevFrag=fragments[foundFrag.sn-trackDetails.startSN-1];prevFrag&&prevFrag.cc===foundFrag.cc&&this.fragmentTracker.getState(prevFrag)===FragmentState.NOT_LOADED&&(foundFrag=prevFrag)}this.fragmentTracker.getState(foundFrag)===FragmentState.NOT_LOADED&&this.loadFragment(foundFrag,track,targetBufferTime)}}else this.state=State.IDLE},_proto.getMaxBufferLength=function(mainBufferLength){var maxConfigBuffer=_BaseStreamController.prototype.getMaxBufferLength.call(this);return mainBufferLength?Math.max(maxConfigBuffer,mainBufferLength):maxConfigBuffer},_proto.loadFragment=function(frag,level,targetBufferTime){this.fragCurrent=frag,"initSegment"===frag.sn?this._loadInitSegment(frag,level):(this.startFragRequested=!0,_BaseStreamController.prototype.loadFragment.call(this,frag,level,targetBufferTime))},_createClass(SubtitleStreamController,[{key:"mediaBufferTimeRanges",get:function(){return new BufferableInstance(this.tracksBuffered[this.currentTrackId]||[])}}]),SubtitleStreamController})(BaseStreamController),BufferableInstance=function(timeranges){this.buffered=void 0;var getRange=function(name,index,length){if((index>>>=0)>length-1)throw new DOMException("Failed to execute '"+name+"' on 'TimeRanges': The index provided ("+index+") is greater than the maximum bound ("+length+")");return timeranges[index][name]};this.buffered={get length(){return timeranges.length},end:function(index){return getRange("end",index,timeranges.length)},start:function(index){return getRange("start",index,timeranges.length)}}},SubtitleTrackController=(function(_BasePlaylistControll){function SubtitleTrackController(hls){var _this;return(_this=_BasePlaylistControll.call(this,hls,"[subtitle-track-controller]")||this).media=null,_this.tracks=[],_this.groupIds=null,_this.tracksInGroup=[],_this.trackId=-1,_this.currentTrack=null,_this.selectDefaultTrack=!0,_this.queuedDefaultTrack=-1,_this.asyncPollTrackChange=function(){return _this.pollTrackChange(0)},_this.useTextTrackPolling=!1,_this.subtitlePollingInterval=-1,_this._subtitleDisplay=!0,_this.onTextTracksChanged=function(){if(_this.useTextTrackPolling||self.clearInterval(_this.subtitlePollingInterval),_this.media&&_this.hls.config.renderTextTracksNatively){for(var textTrack=null,tracks=filterSubtitleTracks(_this.media.textTracks),i=0;i<tracks.length;i++)if("hidden"===tracks[i].mode)textTrack=tracks[i];else if("showing"===tracks[i].mode){textTrack=tracks[i];break}var trackId=_this.findTrackForTextTrack(textTrack);_this.subtitleTrack!==trackId&&_this.setSubtitleTrack(trackId)}},_this.registerListeners(),_this}_inheritsLoose(SubtitleTrackController,_BasePlaylistControll);var _proto=SubtitleTrackController.prototype;return _proto.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,_BasePlaylistControll.prototype.destroy.call(this)},_proto.registerListeners=function(){var hls=this.hls;hls.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),hls.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),hls.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),hls.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),hls.on(Events.LEVEL_LOADING,this.onLevelLoading,this),hls.on(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),hls.on(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),hls.on(Events.ERROR,this.onError,this)},_proto.unregisterListeners=function(){var hls=this.hls;hls.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),hls.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),hls.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),hls.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),hls.off(Events.LEVEL_LOADING,this.onLevelLoading,this),hls.off(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),hls.off(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),hls.off(Events.ERROR,this.onError,this)},_proto.onMediaAttached=function(event,data){this.media=data.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},_proto.pollTrackChange=function(timeout){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,timeout)},_proto.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),filterSubtitleTracks(this.media.textTracks).forEach((function(track){clearCurrentCues(track)})),this.subtitleTrack=-1,this.media=null)},_proto.onManifestLoading=function(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0},_proto.onManifestParsed=function(event,data){this.tracks=data.subtitleTracks},_proto.onSubtitleTrackLoaded=function(event,data){var id=data.id,groupId=data.groupId,details=data.details,trackInActiveGroup=this.tracksInGroup[id];if(trackInActiveGroup&&trackInActiveGroup.groupId===groupId){var curDetails=trackInActiveGroup.details;trackInActiveGroup.details=data.details,this.log("Subtitle track "+id+' "'+trackInActiveGroup.name+'" lang:'+trackInActiveGroup.lang+" group:"+groupId+" loaded ["+details.startSN+"-"+details.endSN+"]"),id===this.trackId&&this.playlistLoaded(id,data,curDetails)}else this.warn("Subtitle track with id:"+id+" and group:"+groupId+" not found in active group "+(null==trackInActiveGroup?void 0:trackInActiveGroup.groupId))},_proto.onLevelLoading=function(event,data){this.switchLevel(data.level)},_proto.onLevelSwitching=function(event,data){this.switchLevel(data.level)},_proto.switchLevel=function(levelIndex){var levelInfo=this.hls.levels[levelIndex];if(levelInfo){var subtitleGroups=levelInfo.subtitleGroups||null,currentGroups=this.groupIds,currentTrack=this.currentTrack;if(!subtitleGroups||(null==currentGroups?void 0:currentGroups.length)!==(null==subtitleGroups?void 0:subtitleGroups.length)||null!=subtitleGroups&&subtitleGroups.some((function(groupId){return-1===(null==currentGroups?void 0:currentGroups.indexOf(groupId))}))){this.groupIds=subtitleGroups,this.trackId=-1,this.currentTrack=null;var subtitleTracks=this.tracks.filter((function(track){return!subtitleGroups||-1!==subtitleGroups.indexOf(track.groupId)}));if(subtitleTracks.length)this.selectDefaultTrack&&!subtitleTracks.some((function(track){return track.default}))&&(this.selectDefaultTrack=!1),subtitleTracks.forEach((function(track,i){track.id=i}));else if(!currentTrack&&!this.tracksInGroup.length)return;this.tracksInGroup=subtitleTracks;var subtitlePreference=this.hls.config.subtitlePreference;if(!currentTrack&&subtitlePreference){this.selectDefaultTrack=!1;var groupIndex=findMatchingOption(subtitlePreference,subtitleTracks);if(groupIndex>-1)currentTrack=subtitleTracks[groupIndex];else{var allIndex=findMatchingOption(subtitlePreference,this.tracks);currentTrack=this.tracks[allIndex]}}var trackId=this.findTrackId(currentTrack);-1===trackId&&currentTrack&&(trackId=this.findTrackId(null));var subtitleTracksUpdated={subtitleTracks:subtitleTracks};this.log("Updating subtitle tracks, "+subtitleTracks.length+' track(s) found in "'+(null==subtitleGroups?void 0:subtitleGroups.join(","))+'" group-id'),this.hls.trigger(Events.SUBTITLE_TRACKS_UPDATED,subtitleTracksUpdated),-1!==trackId&&-1===this.trackId&&this.setSubtitleTrack(trackId)}else this.shouldReloadPlaylist(currentTrack)&&this.setSubtitleTrack(this.trackId)}},_proto.findTrackId=function(currentTrack){for(var tracks=this.tracksInGroup,selectDefault=this.selectDefaultTrack,i=0;i<tracks.length;i++){var track=tracks[i];if((!selectDefault||track.default)&&(selectDefault||currentTrack)&&(!currentTrack||matchesOption(track,currentTrack)))return i}if(currentTrack){for(var _i=0;_i<tracks.length;_i++){var _track=tracks[_i];if(mediaAttributesIdentical(currentTrack.attrs,_track.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return _i}for(var _i2=0;_i2<tracks.length;_i2++){var _track2=tracks[_i2];if(mediaAttributesIdentical(currentTrack.attrs,_track2.attrs,["LANGUAGE"]))return _i2}}return-1},_proto.findTrackForTextTrack=function(textTrack){if(textTrack)for(var tracks=this.tracksInGroup,i=0;i<tracks.length;i++)if(subtitleTrackMatchesTextTrack(tracks[i],textTrack))return i;return-1},_proto.onError=function(event,data){!data.fatal&&data.context&&(data.context.type!==PlaylistContextType.SUBTITLE_TRACK||data.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(data.context.groupId)||this.checkRetry(data))},_proto.setSubtitleOption=function(subtitleOption){if(this.hls.config.subtitlePreference=subtitleOption,subtitleOption){var allSubtitleTracks=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,allSubtitleTracks.length){var currentTrack=this.currentTrack;if(currentTrack&&matchesOption(subtitleOption,currentTrack))return currentTrack;var groupIndex=findMatchingOption(subtitleOption,this.tracksInGroup);if(groupIndex>-1){var track=this.tracksInGroup[groupIndex];return this.setSubtitleTrack(groupIndex),track}if(currentTrack)return null;var allIndex=findMatchingOption(subtitleOption,allSubtitleTracks);if(allIndex>-1)return allSubtitleTracks[allIndex]}}return null},_proto.loadPlaylist=function(hlsUrlParameters){_BasePlaylistControll.prototype.loadPlaylist.call(this);var currentTrack=this.currentTrack;if(this.shouldLoadPlaylist(currentTrack)&&currentTrack){var id=currentTrack.id,groupId=currentTrack.groupId,url=currentTrack.url;if(hlsUrlParameters)try{url=hlsUrlParameters.addDirectives(url)}catch(error){this.warn("Could not construct new URL with HLS Delivery Directives: "+error)}this.log("Loading subtitle playlist for id "+id),this.hls.trigger(Events.SUBTITLE_TRACK_LOADING,{url:url,id:id,groupId:groupId,deliveryDirectives:hlsUrlParameters||null})}},_proto.toggleTrackModes=function(){var media=this.media;if(media){var nextTrack,textTracks=filterSubtitleTracks(media.textTracks),currentTrack=this.currentTrack;if(currentTrack&&((nextTrack=textTracks.filter((function(textTrack){return subtitleTrackMatchesTextTrack(currentTrack,textTrack)}))[0])||this.warn('Unable to find subtitle TextTrack with name "'+currentTrack.name+'" and language "'+currentTrack.lang+'"')),[].slice.call(textTracks).forEach((function(track){"disabled"!==track.mode&&track!==nextTrack&&(track.mode="disabled")})),nextTrack){var mode=this.subtitleDisplay?"showing":"hidden";nextTrack.mode!==mode&&(nextTrack.mode=mode)}}},_proto.setSubtitleTrack=function(newId){var tracks=this.tracksInGroup;if(this.media)if(newId<-1||newId>=tracks.length||!isFiniteNumber(newId))this.warn("Invalid subtitle track id: "+newId);else{this.clearTimer(),this.selectDefaultTrack=!1;var lastTrack=this.currentTrack,track=tracks[newId]||null;if(this.trackId=newId,this.currentTrack=track,this.toggleTrackModes(),track){var trackLoaded=!!track.details&&!track.details.live;if(newId!==this.trackId||track!==lastTrack||!trackLoaded){this.log("Switching to subtitle-track "+newId+(track?' "'+track.name+'" lang:'+track.lang+" group:"+track.groupId:""));var id=track.id,_track$groupId=track.groupId,groupId=void 0===_track$groupId?"":_track$groupId,name=track.name,type=track.type,url=track.url;this.hls.trigger(Events.SUBTITLE_TRACK_SWITCH,{id:id,groupId:groupId,name:name,type:type,url:url});var hlsUrlParameters=this.switchParams(track.url,null==lastTrack?void 0:lastTrack.details);this.loadPlaylist(hlsUrlParameters)}}else this.hls.trigger(Events.SUBTITLE_TRACK_SWITCH,{id:newId})}else this.queuedDefaultTrack=newId},_createClass(SubtitleTrackController,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(value){this._subtitleDisplay=value,this.trackId>-1&&this.toggleTrackModes()}},{key:"allSubtitleTracks",get:function(){return this.tracks}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(newId){this.selectDefaultTrack=!1,this.setSubtitleTrack(newId)}}]),SubtitleTrackController})(BasePlaylistController),BufferOperationQueue=(function(){function BufferOperationQueue(sourceBufferReference){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=sourceBufferReference}var _proto=BufferOperationQueue.prototype;return _proto.append=function(operation,type,pending){var queue=this.queues[type];queue.push(operation),1!==queue.length||pending||this.executeNext(type)},_proto.insertAbort=function(operation,type){this.queues[type].unshift(operation),this.executeNext(type)},_proto.appendBlocker=function(type){var execute,promise=new Promise((function(resolve){execute=resolve})),operation={execute:execute,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(operation,type),promise},_proto.executeNext=function(type){var queue=this.queues[type];if(queue.length){var operation=queue[0];try{operation.execute()}catch(error){logger.warn('[buffer-operation-queue]: Exception executing "'+type+'" SourceBuffer operation: '+error),operation.onError(error);var sb=this.buffers[type];null!=sb&&sb.updating||this.shiftAndExecuteNext(type)}}},_proto.shiftAndExecuteNext=function(type){this.queues[type].shift(),this.executeNext(type)},_proto.current=function(type){return this.queues[type][0]},BufferOperationQueue})(),VIDEO_CODEC_PROFILE_REPLACE=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,BufferController=(function(){function BufferController(hls){var _this=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendSource=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this.log=void 0,this.warn=void 0,this.error=void 0,this._onEndStreaming=function(event){_this.hls&&_this.hls.pauseBuffering()},this._onStartStreaming=function(event){_this.hls&&_this.hls.resumeBuffering()},this._onMediaSourceOpen=function(){var media=_this.media,mediaSource=_this.mediaSource;_this.log("Media source opened"),media&&(media.removeEventListener("emptied",_this._onMediaEmptied),_this.updateMediaElementDuration(),_this.hls.trigger(Events.MEDIA_ATTACHED,{media:media,mediaSource:mediaSource})),mediaSource&&mediaSource.removeEventListener("sourceopen",_this._onMediaSourceOpen),_this.checkPendingTracks()},this._onMediaSourceClose=function(){_this.log("Media source closed")},this._onMediaSourceEnded=function(){_this.log("Media source ended")},this._onMediaEmptied=function(){var mediaSrc=_this.mediaSrc,_objectUrl=_this._objectUrl;mediaSrc!==_objectUrl&&logger.error("Media element src was set while attaching MediaSource ("+_objectUrl+" > "+mediaSrc+")")},this.hls=hls;var logPrefix="[buffer-controller]";this.appendSource=hls.config.preferManagedMediaSource,this.log=logger.log.bind(logger,logPrefix),this.warn=logger.warn.bind(logger,logPrefix),this.error=logger.error.bind(logger,logPrefix),this._initSourceBuffer(),this.registerListeners()}var _proto=BufferController.prototype;return _proto.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},_proto.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null,this.hls=null},_proto.registerListeners=function(){var hls=this.hls;hls.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),hls.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),hls.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),hls.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),hls.on(Events.BUFFER_RESET,this.onBufferReset,this),hls.on(Events.BUFFER_APPENDING,this.onBufferAppending,this),hls.on(Events.BUFFER_CODECS,this.onBufferCodecs,this),hls.on(Events.BUFFER_EOS,this.onBufferEos,this),hls.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),hls.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this),hls.on(Events.FRAG_PARSED,this.onFragParsed,this),hls.on(Events.FRAG_CHANGED,this.onFragChanged,this)},_proto.unregisterListeners=function(){var hls=this.hls;hls.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),hls.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),hls.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),hls.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),hls.off(Events.BUFFER_RESET,this.onBufferReset,this),hls.off(Events.BUFFER_APPENDING,this.onBufferAppending,this),hls.off(Events.BUFFER_CODECS,this.onBufferCodecs,this),hls.off(Events.BUFFER_EOS,this.onBufferEos,this),hls.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),hls.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this),hls.off(Events.FRAG_PARSED,this.onFragParsed,this),hls.off(Events.FRAG_CHANGED,this.onFragChanged,this)},_proto._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new BufferOperationQueue(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.appendErrors={audio:0,video:0,audiovideo:0},this.lastMpegAudioChunk=null},_proto.onManifestLoading=function(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null},_proto.onManifestParsed=function(event,data){var codecEvents=2;(data.audio&&!data.video||!data.altAudio)&&(codecEvents=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=codecEvents,this.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},_proto.onMediaAttaching=function(event,data){var media=this.media=data.media,MediaSource=getMediaSource(this.appendSource);if(media&&MediaSource){var _ms$constructor,ms=this.mediaSource=new MediaSource;this.log("created media source: "+(null==(_ms$constructor=ms.constructor)?void 0:_ms$constructor.name)),ms.addEventListener("sourceopen",this._onMediaSourceOpen),ms.addEventListener("sourceended",this._onMediaSourceEnded),ms.addEventListener("sourceclose",this._onMediaSourceClose),ms.addEventListener("startstreaming",this._onStartStreaming),ms.addEventListener("endstreaming",this._onEndStreaming);var objectUrl=this._objectUrl=self.URL.createObjectURL(ms);if(this.appendSource)try{media.removeAttribute("src");var MMS=self.ManagedMediaSource;media.disableRemotePlayback=media.disableRemotePlayback||MMS&&ms instanceof MMS,removeSourceChildren(media),addSource(media,objectUrl),media.load()}catch(error){media.src=objectUrl}else media.src=objectUrl;media.addEventListener("emptied",this._onMediaEmptied)}},_proto.onMediaDetaching=function(){var media=this.media,mediaSource=this.mediaSource,_objectUrl=this._objectUrl;if(mediaSource){if(this.log("media source detaching"),"open"===mediaSource.readyState)try{mediaSource.endOfStream()}catch(err){this.warn("onMediaDetaching: "+err.message+" while calling endOfStream")}this.onBufferReset(),mediaSource.removeEventListener("sourceopen",this._onMediaSourceOpen),mediaSource.removeEventListener("sourceended",this._onMediaSourceEnded),mediaSource.removeEventListener("sourceclose",this._onMediaSourceClose),mediaSource.removeEventListener("startstreaming",this._onStartStreaming),mediaSource.removeEventListener("endstreaming",this._onEndStreaming),media&&(media.removeEventListener("emptied",this._onMediaEmptied),_objectUrl&&self.URL.revokeObjectURL(_objectUrl),this.mediaSrc===_objectUrl?(media.removeAttribute("src"),this.appendSource&&removeSourceChildren(media),media.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(Events.MEDIA_DETACHED,void 0)},_proto.onBufferReset=function(){var _this2=this;this.getSourceBufferTypes().forEach((function(type){_this2.resetBuffer(type)})),this._initSourceBuffer()},_proto.resetBuffer=function(type){var sb=this.sourceBuffer[type];try{var _this$mediaSource;sb&&(this.removeBufferListeners(type),this.sourceBuffer[type]=void 0,null!=(_this$mediaSource=this.mediaSource)&&_this$mediaSource.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(sb))}catch(err){this.warn("onBufferReset "+type,err)}},_proto.onBufferCodecs=function(event,data){var _this3=this,sourceBufferCount=this.getSourceBufferTypes().length,trackNames=Object.keys(data);if(trackNames.forEach((function(trackName){if(sourceBufferCount){var track=_this3.tracks[trackName];if(track&&"function"==typeof track.buffer.changeType){var _trackCodec,_data$trackName=data[trackName],id=_data$trackName.id,codec=_data$trackName.codec,levelCodec=_data$trackName.levelCodec,container=_data$trackName.container,metadata=_data$trackName.metadata,currentCodecFull=pickMostCompleteCodecName(track.codec,track.levelCodec),currentCodec=null==currentCodecFull?void 0:currentCodecFull.replace(VIDEO_CODEC_PROFILE_REPLACE,"$1"),trackCodec=pickMostCompleteCodecName(codec,levelCodec),nextCodec=null==(_trackCodec=trackCodec)?void 0:_trackCodec.replace(VIDEO_CODEC_PROFILE_REPLACE,"$1");if(trackCodec&&currentCodec!==nextCodec){"audio"===trackName.slice(0,5)&&(trackCodec=getCodecCompatibleName(trackCodec,_this3.hls.config.preferManagedMediaSource));var mimeType=container+";codecs="+trackCodec;_this3.appendChangeType(trackName,mimeType),_this3.log("switching codec "+currentCodecFull+" to "+trackCodec),_this3.tracks[trackName]={buffer:track.buffer,codec:codec,container:container,levelCodec:levelCodec,metadata:metadata,id:id}}}}else _this3.pendingTracks[trackName]=data[trackName]})),!sourceBufferCount){var bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0);this.bufferCodecEventsExpected!==bufferCodecEventsExpected&&(this.log(bufferCodecEventsExpected+" bufferCodec event(s) expected "+trackNames.join(",")),this.bufferCodecEventsExpected=bufferCodecEventsExpected),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks()}},_proto.appendChangeType=function(type,mimeType){var _this4=this,operationQueue=this.operationQueue,operation={execute:function(){var sb=_this4.sourceBuffer[type];sb&&(_this4.log("changing "+type+" sourceBuffer type to "+mimeType),sb.changeType(mimeType)),operationQueue.shiftAndExecuteNext(type)},onStart:function(){},onComplete:function(){},onError:function(error){_this4.warn("Failed to change "+type+" SourceBuffer type",error)}};operationQueue.append(operation,type,!!this.pendingTracks[type])},_proto.onBufferAppending=function(event,eventData){var _this5=this,hls=this.hls,operationQueue=this.operationQueue,tracks=this.tracks,data=eventData.data,type=eventData.type,frag=eventData.frag,part=eventData.part,chunkMeta=eventData.chunkMeta,chunkStats=chunkMeta.buffering[type],bufferAppendingStart=self.performance.now();chunkStats.start=bufferAppendingStart;var fragBuffering=frag.stats.buffering,partBuffering=part?part.stats.buffering:null;0===fragBuffering.start&&(fragBuffering.start=bufferAppendingStart),partBuffering&&0===partBuffering.start&&(partBuffering.start=bufferAppendingStart);var audioTrack=tracks.audio,checkTimestampOffset=!1;"audio"===type&&"audio/mpeg"===(null==audioTrack?void 0:audioTrack.container)&&(checkTimestampOffset=!this.lastMpegAudioChunk||1===chunkMeta.id||this.lastMpegAudioChunk.sn!==chunkMeta.sn,this.lastMpegAudioChunk=chunkMeta);var fragStart=frag.start,operation={execute:function(){if(chunkStats.executeStart=self.performance.now(),checkTimestampOffset){var sb=_this5.sourceBuffer[type];if(sb){var delta=fragStart-sb.timestampOffset;Math.abs(delta)>=.1&&(_this5.log("Updating audio SourceBuffer timestampOffset to "+fragStart+" (delta: "+delta+") sn: "+frag.sn+")"),sb.timestampOffset=fragStart)}}_this5.appendExecutor(data,type)},onStart:function(){},onComplete:function(){var end=self.performance.now();chunkStats.executeEnd=chunkStats.end=end,0===fragBuffering.first&&(fragBuffering.first=end),partBuffering&&0===partBuffering.first&&(partBuffering.first=end);var sourceBuffer=_this5.sourceBuffer,timeRanges={};for(var _type in sourceBuffer)timeRanges[_type]=BufferHelper.getBuffered(sourceBuffer[_type]);_this5.appendErrors[type]=0,"audio"===type||"video"===type?_this5.appendErrors.audiovideo=0:(_this5.appendErrors.audio=0,_this5.appendErrors.video=0),_this5.hls.trigger(Events.BUFFER_APPENDED,{type:type,frag:frag,part:part,chunkMeta:chunkMeta,parent:frag.type,timeRanges:timeRanges})},onError:function(error){var event={type:ErrorTypes.MEDIA_ERROR,parent:frag.type,details:ErrorDetails.BUFFER_APPEND_ERROR,sourceBufferName:type,frag:frag,part:part,chunkMeta:chunkMeta,error:error,err:error,fatal:!1};if(error.code===DOMException.QUOTA_EXCEEDED_ERR)event.details=ErrorDetails.BUFFER_FULL_ERROR;else{var appendErrorCount=++_this5.appendErrors[type];event.details=ErrorDetails.BUFFER_APPEND_ERROR,_this5.warn("Failed "+appendErrorCount+"/"+hls.config.appendErrorMaxRetry+' times to append segment in "'+type+'" sourceBuffer'),appendErrorCount>=hls.config.appendErrorMaxRetry&&(event.fatal=!0)}hls.trigger(Events.ERROR,event)}};operationQueue.append(operation,type,!!this.pendingTracks[type])},_proto.onBufferFlushing=function(event,data){var _this6=this,operationQueue=this.operationQueue,flushOperation=function(type){return{execute:_this6.removeExecutor.bind(_this6,type,data.startOffset,data.endOffset),onStart:function(){},onComplete:function(){_this6.hls.trigger(Events.BUFFER_FLUSHED,{type:type})},onError:function(error){_this6.warn("Failed to remove from "+type+" SourceBuffer",error)}}};data.type?operationQueue.append(flushOperation(data.type),data.type):this.getSourceBufferTypes().forEach((function(type){operationQueue.append(flushOperation(type),type)}))},_proto.onFragParsed=function(event,data){var _this7=this,frag=data.frag,part=data.part,buffersAppendedTo=[],elementaryStreams=part?part.elementaryStreams:frag.elementaryStreams;elementaryStreams[ElementaryStreamTypes.AUDIOVIDEO]?buffersAppendedTo.push("audiovideo"):(elementaryStreams[ElementaryStreamTypes.AUDIO]&&buffersAppendedTo.push("audio"),elementaryStreams[ElementaryStreamTypes.VIDEO]&&buffersAppendedTo.push("video"));var onUnblocked=function(){var now=self.performance.now();frag.stats.buffering.end=now,part&&(part.stats.buffering.end=now);var stats=part?part.stats:frag.stats;_this7.hls.trigger(Events.FRAG_BUFFERED,{frag:frag,part:part,stats:stats,id:frag.type})};0===buffersAppendedTo.length&&this.warn("Fragments must have at least one ElementaryStreamType set. type: "+frag.type+" level: "+frag.level+" sn: "+frag.sn),this.blockBuffers(onUnblocked,buffersAppendedTo)},_proto.onFragChanged=function(event,data){this.trimBuffers()},_proto.onBufferEos=function(event,data){var _this8=this;this.getSourceBufferTypes().reduce((function(acc,type){var sb=_this8.sourceBuffer[type];return!sb||data.type&&data.type!==type||(sb.ending=!0,sb.ended||(sb.ended=!0,_this8.log(type+" sourceBuffer now EOS"))),acc&&!(sb&&!sb.ended)}),!0)&&(this.log("Queueing mediaSource.endOfStream()"),this.blockBuffers((function(){_this8.getSourceBufferTypes().forEach((function(type){var sb=_this8.sourceBuffer[type];sb&&(sb.ending=!1)}));var mediaSource=_this8.mediaSource;mediaSource&&"open"===mediaSource.readyState?(_this8.log("Calling mediaSource.endOfStream()"),mediaSource.endOfStream()):mediaSource&&_this8.log("Could not call mediaSource.endOfStream(). mediaSource.readyState: "+mediaSource.readyState)})))},_proto.onLevelUpdated=function(event,_ref){var details=_ref.details;details.fragments.length&&(this.details=details,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},_proto.trimBuffers=function(){var hls=this.hls,details=this.details,media=this.media;if(media&&null!==details&&this.getSourceBufferTypes().length){var config=hls.config,currentTime=media.currentTime,targetDuration=details.levelTargetDuration,backBufferLength=details.live&&null!==config.liveBackBufferLength?config.liveBackBufferLength:config.backBufferLength;if(isFiniteNumber(backBufferLength)&&backBufferLength>0){var maxBackBufferLength=Math.max(backBufferLength,targetDuration),targetBackBufferPosition=Math.floor(currentTime/targetDuration)*targetDuration-maxBackBufferLength;this.flushBackBuffer(currentTime,targetDuration,targetBackBufferPosition)}if(isFiniteNumber(config.frontBufferFlushThreshold)&&config.frontBufferFlushThreshold>0){var frontBufferLength=Math.max(config.maxBufferLength,config.frontBufferFlushThreshold),maxFrontBufferLength=Math.max(frontBufferLength,targetDuration),targetFrontBufferPosition=Math.floor(currentTime/targetDuration)*targetDuration+maxFrontBufferLength;this.flushFrontBuffer(currentTime,targetDuration,targetFrontBufferPosition)}}},_proto.flushBackBuffer=function(currentTime,targetDuration,targetBackBufferPosition){var _this9=this,details=this.details,sourceBuffer=this.sourceBuffer;this.getSourceBufferTypes().forEach((function(type){var sb=sourceBuffer[type];if(sb){var buffered=BufferHelper.getBuffered(sb);if(buffered.length>0&&targetBackBufferPosition>buffered.start(0)){if(_this9.hls.trigger(Events.BACK_BUFFER_REACHED,{bufferEnd:targetBackBufferPosition}),null!=details&&details.live)_this9.hls.trigger(Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:targetBackBufferPosition});else if(sb.ended&&buffered.end(buffered.length-1)-currentTime<2*targetDuration)return void _this9.log("Cannot flush "+type+" back buffer while SourceBuffer is in ended state");_this9.hls.trigger(Events.BUFFER_FLUSHING,{startOffset:0,endOffset:targetBackBufferPosition,type:type})}}}))},_proto.flushFrontBuffer=function(currentTime,targetDuration,targetFrontBufferPosition){var _this10=this,sourceBuffer=this.sourceBuffer;this.getSourceBufferTypes().forEach((function(type){var sb=sourceBuffer[type];if(sb){var buffered=BufferHelper.getBuffered(sb),numBufferedRanges=buffered.length;if(numBufferedRanges<2)return;var bufferStart=buffered.start(numBufferedRanges-1),bufferEnd=buffered.end(numBufferedRanges-1);if(targetFrontBufferPosition>bufferStart||currentTime>=bufferStart&&currentTime<=bufferEnd)return;if(sb.ended&&currentTime-bufferEnd<2*targetDuration)return void _this10.log("Cannot flush "+type+" front buffer while SourceBuffer is in ended state");_this10.hls.trigger(Events.BUFFER_FLUSHING,{startOffset:bufferStart,endOffset:1/0,type:type})}}))},_proto.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState){var details=this.details,hls=this.hls,media=this.media,mediaSource=this.mediaSource,levelDuration=details.fragments[0].start+details.totalduration,mediaDuration=media.duration,msDuration=isFiniteNumber(mediaSource.duration)?mediaSource.duration:0;details.live&&hls.config.liveDurationInfinity?(mediaSource.duration=1/0,this.updateSeekableRange(details)):(levelDuration>msDuration&&levelDuration>mediaDuration||!isFiniteNumber(mediaDuration))&&(this.log("Updating Media Source duration to "+levelDuration.toFixed(3)),mediaSource.duration=levelDuration)}},_proto.updateSeekableRange=function(levelDetails){var mediaSource=this.mediaSource,fragments=levelDetails.fragments;if(fragments.length&&levelDetails.live&&null!=mediaSource&&mediaSource.setLiveSeekableRange){var start=Math.max(0,fragments[0].start),end=Math.max(start,start+levelDetails.totalduration);this.log("Media Source duration is set to "+mediaSource.duration+". Setting seekable range to "+start+"-"+end+"."),mediaSource.setLiveSeekableRange(start,end)}},_proto.checkPendingTracks=function(){var bufferCodecEventsExpected=this.bufferCodecEventsExpected,operationQueue=this.operationQueue,pendingTracks=this.pendingTracks,pendingTracksCount=Object.keys(pendingTracks).length;if(pendingTracksCount&&(!bufferCodecEventsExpected||2===pendingTracksCount||"audiovideo"in pendingTracks)){this.createSourceBuffers(pendingTracks),this.pendingTracks={};var buffers=this.getSourceBufferTypes();if(buffers.length)this.hls.trigger(Events.BUFFER_CREATED,{tracks:this.tracks}),buffers.forEach((function(type){operationQueue.executeNext(type)}));else{var error=new Error("could not create source buffer for media codec(s)");this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:error,reason:error.message})}}},_proto.createSourceBuffers=function(tracks){var _this11=this,sourceBuffer=this.sourceBuffer,mediaSource=this.mediaSource;if(!mediaSource)throw Error("createSourceBuffers called when mediaSource was null");var _loop=function(trackName){if(!sourceBuffer[trackName]){var track=tracks[trackName];if(!track)throw Error("source buffer exists for track "+trackName+", however track does not");var codec=track.levelCodec||track.codec;codec&&"audio"===trackName.slice(0,5)&&(codec=getCodecCompatibleName(codec,_this11.hls.config.preferManagedMediaSource));var mimeType=track.container+";codecs="+codec;_this11.log("creating sourceBuffer("+mimeType+")");try{var sb=sourceBuffer[trackName]=mediaSource.addSourceBuffer(mimeType),sbName=trackName;_this11.addBufferListener(sbName,"updatestart",_this11._onSBUpdateStart),_this11.addBufferListener(sbName,"updateend",_this11._onSBUpdateEnd),_this11.addBufferListener(sbName,"error",_this11._onSBUpdateError),_this11.addBufferListener(sbName,"bufferedchange",(function(type,event){var removedRanges=event.removedRanges;null!=removedRanges&&removedRanges.length&&_this11.hls.trigger(Events.BUFFER_FLUSHED,{type:trackName})})),_this11.tracks[trackName]={buffer:sb,codec:codec,container:track.container,levelCodec:track.levelCodec,metadata:track.metadata,id:track.id}}catch(err){_this11.error("error while trying to add sourceBuffer: "+err.message),_this11.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:err,sourceBufferName:trackName,mimeType:mimeType})}}};for(var trackName in tracks)_loop(trackName)},_proto._onSBUpdateStart=function(type){this.operationQueue.current(type).onStart()},_proto._onSBUpdateEnd=function(type){var _this$mediaSource2;if("closed"!==(null==(_this$mediaSource2=this.mediaSource)?void 0:_this$mediaSource2.readyState)){var operationQueue=this.operationQueue;operationQueue.current(type).onComplete(),operationQueue.shiftAndExecuteNext(type)}else this.resetBuffer(type)},_proto._onSBUpdateError=function(type,event){var _this$mediaSource3,error=new Error(type+" SourceBuffer error. MediaSource readyState: "+(null==(_this$mediaSource3=this.mediaSource)?void 0:_this$mediaSource3.readyState));this.error(""+error,event),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_APPENDING_ERROR,sourceBufferName:type,error:error,fatal:!1});var operation=this.operationQueue.current(type);operation&&operation.onError(error)},_proto.removeExecutor=function(type,startOffset,endOffset){var media=this.media,mediaSource=this.mediaSource,operationQueue=this.operationQueue,sb=this.sourceBuffer[type];if(!media||!mediaSource||!sb)return this.warn("Attempting to remove from the "+type+" SourceBuffer, but it does not exist"),void operationQueue.shiftAndExecuteNext(type);var mediaDuration=isFiniteNumber(media.duration)?media.duration:1/0,msDuration=isFiniteNumber(mediaSource.duration)?mediaSource.duration:1/0,removeStart=Math.max(0,startOffset),removeEnd=Math.min(endOffset,mediaDuration,msDuration);removeEnd>removeStart&&(!sb.ending||sb.ended)?(sb.ended=!1,this.log("Removing ["+removeStart+","+removeEnd+"] from the "+type+" SourceBuffer"),sb.remove(removeStart,removeEnd)):operationQueue.shiftAndExecuteNext(type)},_proto.appendExecutor=function(data,type){var sb=this.sourceBuffer[type];if(sb)sb.ended=!1,sb.appendBuffer(data);else if(!this.pendingTracks[type])throw new Error("Attempting to append to the "+type+" SourceBuffer, but it does not exist")},_proto.blockBuffers=function(onUnblocked,buffers){var _this12=this;if(void 0===buffers&&(buffers=this.getSourceBufferTypes()),!buffers.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(onUnblocked);var operationQueue=this.operationQueue,blockingOperations=buffers.map((function(type){return operationQueue.appendBlocker(type)}));Promise.all(blockingOperations).then((function(){onUnblocked(),buffers.forEach((function(type){var sb=_this12.sourceBuffer[type];null!=sb&&sb.updating||operationQueue.shiftAndExecuteNext(type)}))}))},_proto.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},_proto.addBufferListener=function(type,event,fn){var buffer=this.sourceBuffer[type];if(buffer){var listener=fn.bind(this,type);this.listeners[type].push({event:event,listener:listener}),buffer.addEventListener(event,listener)}},_proto.removeBufferListeners=function(type){var buffer=this.sourceBuffer[type];buffer&&this.listeners[type].forEach((function(l){buffer.removeEventListener(l.event,l.listener)}))},_createClass(BufferController,[{key:"mediaSrc",get:function(){var _this$media,media=(null==(_this$media=this.media)?void 0:_this$media.firstChild)||this.media;return null==media?void 0:media.src}}]),BufferController})();function removeSourceChildren(node){var sourceChildren=node.querySelectorAll("source");[].slice.call(sourceChildren).forEach((function(source){node.removeChild(source)}))}function addSource(media,url){var source=self.document.createElement("source");source.type="video/mp4",source.src=url,media.appendChild(source)}var specialCea608CharsCodes={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},getCharForByte=function(_byte){var charCode=_byte;return specialCea608CharsCodes.hasOwnProperty(_byte)&&(charCode=specialCea608CharsCodes[_byte]),String.fromCharCode(charCode)},NR_ROWS=15,NR_COLS=100,rowsLowCh1={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},rowsHighCh1={17:2,18:4,21:6,22:8,23:10,19:13,20:15},rowsLowCh2={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},rowsHighCh2={25:2,26:4,29:6,30:8,31:10,27:13,28:15},backgroundColors=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],CaptionsLogger=(function(){function CaptionsLogger(){this.time=null,this.verboseLevel=0}return CaptionsLogger.prototype.log=function(severity,msg){if(this.verboseLevel>=severity){var m="function"==typeof msg?msg():msg;logger.log(this.time+" ["+severity+"] "+m)}},CaptionsLogger})(),numArrayToHexArray=function(numArray){for(var hexArray=[],j=0;j<numArray.length;j++)hexArray.push(numArray[j].toString(16));return hexArray},PenState=(function(){function PenState(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}var _proto2=PenState.prototype;return _proto2.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},_proto2.setStyles=function(styles){for(var attribs=["foreground","underline","italics","background","flash"],i=0;i<attribs.length;i++){var style=attribs[i];styles.hasOwnProperty(style)&&(this[style]=styles[style])}},_proto2.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},_proto2.equals=function(other){return this.foreground===other.foreground&&this.underline===other.underline&&this.italics===other.italics&&this.background===other.background&&this.flash===other.flash},_proto2.copy=function(newPenState){this.foreground=newPenState.foreground,this.underline=newPenState.underline,this.italics=newPenState.italics,this.background=newPenState.background,this.flash=newPenState.flash},_proto2.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},PenState})(),StyledUnicodeChar=(function(){function StyledUnicodeChar(){this.uchar=" ",this.penState=new PenState}var _proto3=StyledUnicodeChar.prototype;return _proto3.reset=function(){this.uchar=" ",this.penState.reset()},_proto3.setChar=function(uchar,newPenState){this.uchar=uchar,this.penState.copy(newPenState)},_proto3.setPenState=function(newPenState){this.penState.copy(newPenState)},_proto3.equals=function(other){return this.uchar===other.uchar&&this.penState.equals(other.penState)},_proto3.copy=function(newChar){this.uchar=newChar.uchar,this.penState.copy(newChar.penState)},_proto3.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},StyledUnicodeChar})(),Row=(function(){function Row(logger){this.chars=[],this.pos=0,this.currPenState=new PenState,this.cueStartTime=null,this.logger=void 0;for(var i=0;i<NR_COLS;i++)this.chars.push(new StyledUnicodeChar);this.logger=logger}var _proto4=Row.prototype;return _proto4.equals=function(other){for(var i=0;i<NR_COLS;i++)if(!this.chars[i].equals(other.chars[i]))return!1;return!0},_proto4.copy=function(other){for(var i=0;i<NR_COLS;i++)this.chars[i].copy(other.chars[i])},_proto4.isEmpty=function(){for(var empty=!0,i=0;i<NR_COLS;i++)if(!this.chars[i].isEmpty()){empty=!1;break}return empty},_proto4.setCursor=function(absPos){this.pos!==absPos&&(this.pos=absPos),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>NR_COLS&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=NR_COLS)},_proto4.moveCursor=function(relPos){var newPos=this.pos+relPos;if(relPos>1)for(var i=this.pos+1;i<newPos+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(newPos)},_proto4.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},_proto4.insertChar=function(_byte2){var _this=this;_byte2>=144&&this.backSpace();var _char=getCharForByte(_byte2);this.pos>=NR_COLS?this.logger.log(0,(function(){return"Cannot insert "+_byte2.toString(16)+" ("+_char+") at position "+_this.pos+". Skipping it!"})):(this.chars[this.pos].setChar(_char,this.currPenState),this.moveCursor(1))},_proto4.clearFromPos=function(startPos){var i;for(i=startPos;i<NR_COLS;i++)this.chars[i].reset()},_proto4.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},_proto4.clearToEndOfRow=function(){this.clearFromPos(this.pos)},_proto4.getTextString=function(){for(var chars=[],empty=!0,i=0;i<NR_COLS;i++){var _char2=this.chars[i].uchar;" "!==_char2&&(empty=!1),chars.push(_char2)}return empty?"":chars.join("")},_proto4.setPenStyles=function(styles){this.currPenState.setStyles(styles),this.chars[this.pos].setPenState(this.currPenState)},Row})(),CaptionScreen=(function(){function CaptionScreen(logger){this.rows=[],this.currRow=NR_ROWS-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(var i=0;i<NR_ROWS;i++)this.rows.push(new Row(logger));this.logger=logger}var _proto5=CaptionScreen.prototype;return _proto5.reset=function(){for(var i=0;i<NR_ROWS;i++)this.rows[i].clear();this.currRow=NR_ROWS-1},_proto5.equals=function(other){for(var equal=!0,i=0;i<NR_ROWS;i++)if(!this.rows[i].equals(other.rows[i])){equal=!1;break}return equal},_proto5.copy=function(other){for(var i=0;i<NR_ROWS;i++)this.rows[i].copy(other.rows[i])},_proto5.isEmpty=function(){for(var empty=!0,i=0;i<NR_ROWS;i++)if(!this.rows[i].isEmpty()){empty=!1;break}return empty},_proto5.backSpace=function(){this.rows[this.currRow].backSpace()},_proto5.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},_proto5.insertChar=function(_char3){this.rows[this.currRow].insertChar(_char3)},_proto5.setPen=function(styles){this.rows[this.currRow].setPenStyles(styles)},_proto5.moveCursor=function(relPos){this.rows[this.currRow].moveCursor(relPos)},_proto5.setCursor=function(absPos){this.logger.log(2,"setCursor: "+absPos),this.rows[this.currRow].setCursor(absPos)},_proto5.setPAC=function(pacData){this.logger.log(2,(function(){return"pacData = "+JSON.stringify(pacData)}));var newRow=pacData.row-1;if(this.nrRollUpRows&&newRow<this.nrRollUpRows-1&&(newRow=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==newRow){for(var i=0;i<NR_ROWS;i++)this.rows[i].clear();var topRowIndex=this.currRow+1-this.nrRollUpRows,lastOutputScreen=this.lastOutputScreen;if(lastOutputScreen){var prevLineTime=lastOutputScreen.rows[topRowIndex].cueStartTime,time=this.logger.time;if(null!==prevLineTime&&null!==time&&prevLineTime<time)for(var _i=0;_i<this.nrRollUpRows;_i++)this.rows[newRow-this.nrRollUpRows+_i+1].copy(lastOutputScreen.rows[topRowIndex+_i])}}this.currRow=newRow;var row=this.rows[this.currRow];if(null!==pacData.indent){var indent=pacData.indent,prevPos=Math.max(indent-1,0);row.setCursor(pacData.indent),pacData.color=row.chars[prevPos].penState.foreground}var styles={foreground:pacData.color,underline:pacData.underline,italics:pacData.italics,background:"black",flash:!1};this.setPen(styles)},_proto5.setBkgData=function(bkgData){this.logger.log(2,(function(){return"bkgData = "+JSON.stringify(bkgData)})),this.backSpace(),this.setPen(bkgData),this.insertChar(32)},_proto5.setRollUpRows=function(nrRows){this.nrRollUpRows=nrRows},_proto5.rollUp=function(){var _this2=this;if(null!==this.nrRollUpRows){this.logger.log(1,(function(){return _this2.getDisplayText()}));var topRowIndex=this.currRow+1-this.nrRollUpRows,topRow=this.rows.splice(topRowIndex,1)[0];topRow.clear(),this.rows.splice(this.currRow,0,topRow),this.logger.log(2,"Rolling up")}else this.logger.log(3,"roll_up but nrRollUpRows not set yet")},_proto5.getDisplayText=function(asOneRow){asOneRow=asOneRow||!1;for(var displayText=[],text="",rowNr=-1,i=0;i<NR_ROWS;i++){var rowText=this.rows[i].getTextString();rowText&&(rowNr=i+1,asOneRow?displayText.push("Row "+rowNr+": '"+rowText+"'"):displayText.push(rowText.trim()))}return displayText.length>0&&(text=asOneRow?"["+displayText.join(" | ")+"]":displayText.join("\n")),text},_proto5.getTextAndFormat=function(){return this.rows},CaptionScreen})(),Cea608Channel=(function(){function Cea608Channel(channelNumber,outputFilter,logger){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=channelNumber,this.outputFilter=outputFilter,this.mode=null,this.verbose=0,this.displayedMemory=new CaptionScreen(logger),this.nonDisplayedMemory=new CaptionScreen(logger),this.lastOutputScreen=new CaptionScreen(logger),this.currRollUpRow=this.displayedMemory.rows[NR_ROWS-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=logger}var _proto6=Cea608Channel.prototype;return _proto6.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[NR_ROWS-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},_proto6.getHandler=function(){return this.outputFilter},_proto6.setHandler=function(newHandler){this.outputFilter=newHandler},_proto6.setPAC=function(pacData){this.writeScreen.setPAC(pacData)},_proto6.setBkgData=function(bkgData){this.writeScreen.setBkgData(bkgData)},_proto6.setMode=function(newMode){newMode!==this.mode&&(this.mode=newMode,this.logger.log(2,(function(){return"MODE="+newMode})),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=newMode)},_proto6.insertChars=function(chars){for(var _this3=this,i=0;i<chars.length;i++)this.writeScreen.insertChar(chars[i]);var screen=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,(function(){return screen+": "+_this3.writeScreen.getDisplayText(!0)})),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(1,(function(){return"DISPLAYED: "+_this3.displayedMemory.getDisplayText(!0)})),this.outputDataUpdate())},_proto6.ccRCL=function(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},_proto6.ccBS=function(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},_proto6.ccAOF=function(){},_proto6.ccAON=function(){},_proto6.ccDER=function(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},_proto6.ccRU=function(nrRows){this.logger.log(2,"RU("+nrRows+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(nrRows)},_proto6.ccFON=function(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},_proto6.ccRDC=function(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},_proto6.ccTR=function(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")},_proto6.ccRTD=function(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")},_proto6.ccEDM=function(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},_proto6.ccCR=function(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},_proto6.ccENM=function(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},_proto6.ccEOC=function(){var _this4=this;if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var tmp=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=tmp,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,(function(){return"DISP: "+_this4.displayedMemory.getDisplayText()}))}this.outputDataUpdate(!0)},_proto6.ccTO=function(nrCols){this.logger.log(2,"TO("+nrCols+") - Tab Offset"),this.writeScreen.moveCursor(nrCols)},_proto6.ccMIDROW=function(secondByte){var styles={flash:!1};if(styles.underline=secondByte%2==1,styles.italics=secondByte>=46,styles.italics)styles.foreground="white";else{var colorIndex=Math.floor(secondByte/2)-16,colors=["white","green","blue","cyan","red","yellow","magenta"];styles.foreground=colors[colorIndex]}this.logger.log(2,"MIDROW: "+JSON.stringify(styles)),this.writeScreen.setPen(styles)},_proto6.outputDataUpdate=function(dispatch){void 0===dispatch&&(dispatch=!1);var time=this.logger.time;null!==time&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,time,this.lastOutputScreen),dispatch&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:time):this.cueStartTime=time,this.lastOutputScreen.copy(this.displayedMemory))},_proto6.cueSplitAtTime=function(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))},Cea608Channel})(),Cea608Parser=(function(){function Cea608Parser(field,out1,out2){this.channels=void 0,this.currentChannel=0,this.cmdHistory=createCmdHistory(),this.logger=void 0;var logger=this.logger=new CaptionsLogger;this.channels=[null,new Cea608Channel(field,out1,logger),new Cea608Channel(field+1,out2,logger)]}var _proto7=Cea608Parser.prototype;return _proto7.getHandler=function(channel){return this.channels[channel].getHandler()},_proto7.setHandler=function(channel,newHandler){this.channels[channel].setHandler(newHandler)},_proto7.addData=function(time,byteList){var cmdFound,a,b,charsFound=!1;this.logger.time=time;for(var i=0;i<byteList.length;i+=2)if(a=127&byteList[i],b=127&byteList[i+1],0!==a||0!==b){if(this.logger.log(3,"["+numArrayToHexArray([byteList[i],byteList[i+1]])+"] -> ("+numArrayToHexArray([a,b])+")"),(cmdFound=this.parseCmd(a,b))||(cmdFound=this.parseMidrow(a,b)),cmdFound||(cmdFound=this.parsePAC(a,b)),cmdFound||(cmdFound=this.parseBackgroundAttributes(a,b)),!cmdFound&&(charsFound=this.parseChars(a,b))){var currChNr=this.currentChannel;currChNr&&currChNr>0?this.channels[currChNr].insertChars(charsFound):this.logger.log(2,"No channel found yet. TEXT-MODE?")}cmdFound||charsFound||this.logger.log(2,"Couldn't parse cleaned data "+numArrayToHexArray([a,b])+" orig: "+numArrayToHexArray([byteList[i],byteList[i+1]]))}},_proto7.parseCmd=function(a,b){var cmdHistory=this.cmdHistory;if(!((20===a||28===a||21===a||29===a)&&b>=32&&b<=47||(23===a||31===a)&&b>=33&&b<=35))return!1;if(hasCmdRepeated(a,b,cmdHistory))return setLastCmd(null,null,cmdHistory),this.logger.log(3,"Repeated command ("+numArrayToHexArray([a,b])+") is dropped"),!0;var chNr=20===a||21===a||23===a?1:2,channel=this.channels[chNr];return 20===a||21===a||28===a||29===a?32===b?channel.ccRCL():33===b?channel.ccBS():34===b?channel.ccAOF():35===b?channel.ccAON():36===b?channel.ccDER():37===b?channel.ccRU(2):38===b?channel.ccRU(3):39===b?channel.ccRU(4):40===b?channel.ccFON():41===b?channel.ccRDC():42===b?channel.ccTR():43===b?channel.ccRTD():44===b?channel.ccEDM():45===b?channel.ccCR():46===b?channel.ccENM():47===b&&channel.ccEOC():channel.ccTO(b-32),setLastCmd(a,b,cmdHistory),this.currentChannel=chNr,!0},_proto7.parseMidrow=function(a,b){var chNr=0;if((17===a||25===a)&&b>=32&&b<=47){if((chNr=17===a?1:2)!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;var channel=this.channels[chNr];return!!channel&&(channel.ccMIDROW(b),this.logger.log(3,"MIDROW ("+numArrayToHexArray([a,b])+")"),!0)}return!1},_proto7.parsePAC=function(a,b){var row,cmdHistory=this.cmdHistory;if(!((a>=17&&a<=23||a>=25&&a<=31)&&b>=64&&b<=127||(16===a||24===a)&&b>=64&&b<=95))return!1;if(hasCmdRepeated(a,b,cmdHistory))return setLastCmd(null,null,cmdHistory),!0;var chNr=a<=23?1:2;row=b>=64&&b<=95?1===chNr?rowsLowCh1[a]:rowsLowCh2[a]:1===chNr?rowsHighCh1[a]:rowsHighCh2[a];var channel=this.channels[chNr];return!!channel&&(channel.setPAC(this.interpretPAC(row,b)),setLastCmd(a,b,cmdHistory),this.currentChannel=chNr,!0)},_proto7.interpretPAC=function(row,_byte3){var pacIndex,pacData={color:null,italics:!1,indent:null,underline:!1,row:row};return pacIndex=_byte3>95?_byte3-96:_byte3-64,pacData.underline=1==(1&pacIndex),pacIndex<=13?pacData.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(pacIndex/2)]:pacIndex<=15?(pacData.italics=!0,pacData.color="white"):pacData.indent=4*Math.floor((pacIndex-16)/2),pacData},_proto7.parseChars=function(a,b){var channelNr,oneCode,charCodes=null,charCode1=null;if(a>=25?(channelNr=2,charCode1=a-8):(channelNr=1,charCode1=a),charCode1>=17&&charCode1<=19?(oneCode=17===charCode1?b+80:18===charCode1?b+112:b+144,this.logger.log(2,"Special char '"+getCharForByte(oneCode)+"' in channel "+channelNr),charCodes=[oneCode]):a>=32&&a<=127&&(charCodes=0===b?[a]:[a,b]),charCodes){var hexCodes=numArrayToHexArray(charCodes);this.logger.log(3,"Char codes =  "+hexCodes.join(",")),setLastCmd(a,b,this.cmdHistory)}return charCodes},_proto7.parseBackgroundAttributes=function(a,b){var index;if(!((16===a||24===a)&&b>=32&&b<=47||(23===a||31===a)&&b>=45&&b<=47))return!1;var bkgData={};16===a||24===a?(index=Math.floor((b-32)/2),bkgData.background=backgroundColors[index],b%2==1&&(bkgData.background=bkgData.background+"_semi")):45===b?bkgData.background="transparent":(bkgData.foreground="black",47===b&&(bkgData.underline=!0));var chNr=a<=23?1:2;return this.channels[chNr].setBkgData(bkgData),setLastCmd(a,b,this.cmdHistory),!0},_proto7.reset=function(){for(var i=0;i<Object.keys(this.channels).length;i++){var channel=this.channels[i];channel&&channel.reset()}this.cmdHistory=createCmdHistory()},_proto7.cueSplitAtTime=function(t){for(var i=0;i<this.channels.length;i++){var channel=this.channels[i];channel&&channel.cueSplitAtTime(t)}},Cea608Parser})();function setLastCmd(a,b,cmdHistory){cmdHistory.a=a,cmdHistory.b=b}function hasCmdRepeated(a,b,cmdHistory){return cmdHistory.a===a&&cmdHistory.b===b}function createCmdHistory(){return{a:null,b:null}}var OutputFilter=(function(){function OutputFilter(timelineController,trackName){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=timelineController,this.trackName=trackName}var _proto=OutputFilter.prototype;return _proto.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},_proto.newCue=function(startTime,endTime,screen){(null===this.startTime||this.startTime>startTime)&&(this.startTime=startTime),this.endTime=endTime,this.screen=screen,this.timelineController.createCaptionsTrack(this.trackName)},_proto.reset=function(){this.cueRanges=[],this.startTime=null},OutputFilter})(),VTTCue=(function(){if(null!=optionalSelf&&optionalSelf.VTTCue)return self.VTTCue;var AllowedDirections=["","lr","rl"],AllowedAlignments=["start","middle","end","left","right"];function isAllowedValue(allowed,value){if("string"!=typeof value)return!1;if(!Array.isArray(allowed))return!1;var lcValue=value.toLowerCase();return!!~allowed.indexOf(lcValue)&&lcValue}function findDirectionSetting(value){return isAllowedValue(AllowedDirections,value)}function findAlignSetting(value){return isAllowedValue(AllowedAlignments,value)}function extend(obj){for(var _len=arguments.length,rest=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)rest[_key-1]=arguments[_key];for(var i=1;i<arguments.length;i++){var cobj=arguments[i];for(var p in cobj)obj[p]=cobj[p]}return obj}function VTTCue(startTime,endTime,text){var cue=this,baseObj={enumerable:!0};cue.hasBeenReset=!1;var _id="",_pauseOnExit=!1,_startTime=startTime,_endTime=endTime,_text=text,_region=null,_vertical="",_snapToLines=!0,_line="auto",_lineAlign="start",_position=50,_positionAlign="middle",_size=50,_align="middle";Object.defineProperty(cue,"id",extend({},baseObj,{get:function(){return _id},set:function(value){_id=""+value}})),Object.defineProperty(cue,"pauseOnExit",extend({},baseObj,{get:function(){return _pauseOnExit},set:function(value){_pauseOnExit=!!value}})),Object.defineProperty(cue,"startTime",extend({},baseObj,{get:function(){return _startTime},set:function(value){if("number"!=typeof value)throw new TypeError("Start time must be set to a number.");_startTime=value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"endTime",extend({},baseObj,{get:function(){return _endTime},set:function(value){if("number"!=typeof value)throw new TypeError("End time must be set to a number.");_endTime=value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"text",extend({},baseObj,{get:function(){return _text},set:function(value){_text=""+value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"region",extend({},baseObj,{get:function(){return _region},set:function(value){_region=value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"vertical",extend({},baseObj,{get:function(){return _vertical},set:function(value){var setting=findDirectionSetting(value);if(!1===setting)throw new SyntaxError("An invalid or illegal string was specified.");_vertical=setting,this.hasBeenReset=!0}})),Object.defineProperty(cue,"snapToLines",extend({},baseObj,{get:function(){return _snapToLines},set:function(value){_snapToLines=!!value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"line",extend({},baseObj,{get:function(){return _line},set:function(value){if("number"!=typeof value&&"auto"!==value)throw new SyntaxError("An invalid number or illegal string was specified.");_line=value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"lineAlign",extend({},baseObj,{get:function(){return _lineAlign},set:function(value){var setting=findAlignSetting(value);if(!setting)throw new SyntaxError("An invalid or illegal string was specified.");_lineAlign=setting,this.hasBeenReset=!0}})),Object.defineProperty(cue,"position",extend({},baseObj,{get:function(){return _position},set:function(value){if(value<0||value>100)throw new Error("Position must be between 0 and 100.");_position=value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"positionAlign",extend({},baseObj,{get:function(){return _positionAlign},set:function(value){var setting=findAlignSetting(value);if(!setting)throw new SyntaxError("An invalid or illegal string was specified.");_positionAlign=setting,this.hasBeenReset=!0}})),Object.defineProperty(cue,"size",extend({},baseObj,{get:function(){return _size},set:function(value){if(value<0||value>100)throw new Error("Size must be between 0 and 100.");_size=value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"align",extend({},baseObj,{get:function(){return _align},set:function(value){var setting=findAlignSetting(value);if(!setting)throw new SyntaxError("An invalid or illegal string was specified.");_align=setting,this.hasBeenReset=!0}})),cue.displayState=void 0}return VTTCue.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},VTTCue})(),StringDecoder=(function(){function StringDecoder(){}return StringDecoder.prototype.decode=function(data,options){if(!data)return"";if("string"!=typeof data)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(data))},StringDecoder})();function parseTimeStamp(input){function computeSeconds(h,m,s,f){return 3600*(0|h)+60*(0|m)+(0|s)+parseFloat(f||0)}var m=input.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return m?parseFloat(m[2])>59?computeSeconds(m[2],m[3],0,m[4]):computeSeconds(m[1],m[2],m[3],m[4]):null}var Settings=(function(){function Settings(){this.values=Object.create(null)}var _proto2=Settings.prototype;return _proto2.set=function(k,v){this.get(k)||""===v||(this.values[k]=v)},_proto2.get=function(k,dflt,defaultKey){return defaultKey?this.has(k)?this.values[k]:dflt[defaultKey]:this.has(k)?this.values[k]:dflt},_proto2.has=function(k){return k in this.values},_proto2.alt=function(k,v,a){for(var n=0;n<a.length;++n)if(v===a[n]){this.set(k,v);break}},_proto2.integer=function(k,v){/^-?\d+$/.test(v)&&this.set(k,parseInt(v,10))},_proto2.percent=function(k,v){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(v)){var percent=parseFloat(v);if(percent>=0&&percent<=100)return this.set(k,percent),!0}return!1},Settings})();function parseOptions(input,callback,keyValueDelim,groupDelim){var groups=groupDelim?input.split(groupDelim):[input];for(var i in groups)if("string"==typeof groups[i]){var kv=groups[i].split(keyValueDelim);2===kv.length&&callback(kv[0],kv[1])}}var defaults=new VTTCue(0,0,""),center="middle"===defaults.align?"middle":"center";function parseCue(input,cue,regionList){var oInput=input;function consumeTimeStamp(){var ts=parseTimeStamp(input);if(null===ts)throw new Error("Malformed timestamp: "+oInput);return input=input.replace(/^[^\sa-zA-Z-]+/,""),ts}function consumeCueSettings(input,cue){var settings=new Settings;parseOptions(input,(function(k,v){var vals;switch(k){case"region":for(var i=regionList.length-1;i>=0;i--)if(regionList[i].id===v){settings.set(k,regionList[i].region);break}break;case"vertical":settings.alt(k,v,["rl","lr"]);break;case"line":vals=v.split(","),settings.integer(k,vals[0]),settings.percent(k,vals[0])&&settings.set("snapToLines",!1),settings.alt(k,vals[0],["auto"]),2===vals.length&&settings.alt("lineAlign",vals[1],["start",center,"end"]);break;case"position":vals=v.split(","),settings.percent(k,vals[0]),2===vals.length&&settings.alt("positionAlign",vals[1],["start",center,"end","line-left","line-right","auto"]);break;case"size":settings.percent(k,v);break;case"align":settings.alt(k,v,["start",center,"end","left","right"])}}),/:/,/\s/),cue.region=settings.get("region",null),cue.vertical=settings.get("vertical","");var line=settings.get("line","auto");"auto"===line&&-1===defaults.line&&(line=-1),cue.line=line,cue.lineAlign=settings.get("lineAlign","start"),cue.snapToLines=settings.get("snapToLines",!0),cue.size=settings.get("size",100),cue.align=settings.get("align",center);var position=settings.get("position","auto");"auto"===position&&50===defaults.position&&(position="start"===cue.align||"left"===cue.align?0:"end"===cue.align||"right"===cue.align?100:50),cue.position=position}function skipWhitespace(){input=input.replace(/^\s+/,"")}if(skipWhitespace(),cue.startTime=consumeTimeStamp(),skipWhitespace(),"--\x3e"!==input.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+oInput);input=input.slice(3),skipWhitespace(),cue.endTime=consumeTimeStamp(),skipWhitespace(),consumeCueSettings(input,cue)}function fixLineBreaks(input){return input.replace(/<br(?: \/)?>/gi,"\n")}var VTTParser=(function(){function VTTParser(){this.state="INITIAL",this.buffer="",this.decoder=new StringDecoder,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var _proto3=VTTParser.prototype;return _proto3.parse=function(data){var _this=this;function collectNextLine(){var buffer=_this.buffer,pos=0;for(buffer=fixLineBreaks(buffer);pos<buffer.length&&"\r"!==buffer[pos]&&"\n"!==buffer[pos];)++pos;var line=buffer.slice(0,pos);return"\r"===buffer[pos]&&++pos,"\n"===buffer[pos]&&++pos,_this.buffer=buffer.slice(pos),line}function parseHeader(input){parseOptions(input,(function(k,v){}),/:/)}data&&(_this.buffer+=_this.decoder.decode(data,{stream:!0}));try{var line="";if("INITIAL"===_this.state){if(!/\r\n|\n/.test(_this.buffer))return this;var m=(line=collectNextLine()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(null==m||!m[0])throw new Error("Malformed WebVTT signature.");_this.state="HEADER"}for(var alreadyCollectedLine=!1;_this.buffer;){if(!/\r\n|\n/.test(_this.buffer))return this;switch(alreadyCollectedLine?alreadyCollectedLine=!1:line=collectNextLine(),_this.state){case"HEADER":/:/.test(line)?parseHeader(line):line||(_this.state="ID");continue;case"NOTE":line||(_this.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(line)){_this.state="NOTE";break}if(!line)continue;if(_this.cue=new VTTCue(0,0,""),_this.state="CUE",-1===line.indexOf("--\x3e")){_this.cue.id=line;continue}case"CUE":if(!_this.cue){_this.state="BADCUE";continue}try{parseCue(line,_this.cue,_this.regionList)}catch(e){_this.cue=null,_this.state="BADCUE";continue}_this.state="CUETEXT";continue;case"CUETEXT":var hasSubstring=-1!==line.indexOf("--\x3e");if(!line||hasSubstring&&(alreadyCollectedLine=!0)){_this.oncue&&_this.cue&&_this.oncue(_this.cue),_this.cue=null,_this.state="ID";continue}if(null===_this.cue)continue;_this.cue.text&&(_this.cue.text+="\n"),_this.cue.text+=line;continue;case"BADCUE":line||(_this.state="ID")}}}catch(e){"CUETEXT"===_this.state&&_this.cue&&_this.oncue&&_this.oncue(_this.cue),_this.cue=null,_this.state="INITIAL"===_this.state?"BADWEBVTT":"BADCUE"}return this},_proto3.flush=function(){var _this=this;try{if((_this.cue||"HEADER"===_this.state)&&(_this.buffer+="\n\n",_this.parse()),"INITIAL"===_this.state||"BADWEBVTT"===_this.state)throw new Error("Malformed WebVTT signature.")}catch(e){_this.onparsingerror&&_this.onparsingerror(e)}return _this.onflush&&_this.onflush(),this},VTTParser})(),LINEBREAKS=/\r\n|\n\r|\n|\r/g,startsWith=function(inputString,searchString,position){return void 0===position&&(position=0),inputString.slice(position,position+searchString.length)===searchString},cueString2millis=function(timeString){var ts=parseInt(timeString.slice(-3)),secs=parseInt(timeString.slice(-6,-4)),mins=parseInt(timeString.slice(-9,-7)),hours=timeString.length>9?parseInt(timeString.substring(0,timeString.indexOf(":"))):0;if(!(isFiniteNumber(ts)&&isFiniteNumber(secs)&&isFiniteNumber(mins)&&isFiniteNumber(hours)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+timeString);return ts+=1e3*secs,ts+=6e4*mins,ts+=36e5*hours},hash=function(text){for(var hash=5381,i=text.length;i;)hash=33*hash^text.charCodeAt(--i);return(hash>>>0).toString()};function generateCueId(startTime,endTime,text){return hash(startTime.toString())+hash(endTime.toString())+hash(text)}var calculateOffset=function(vttCCs,cc,presentationTime){var currCC=vttCCs[cc],prevCC=vttCCs[currCC.prevCC];if(!prevCC||!prevCC.new&&currCC.new)return vttCCs.ccOffset=vttCCs.presentationOffset=currCC.start,void(currCC.new=!1);for(;null!=(_prevCC=prevCC)&&_prevCC.new;){var _prevCC;vttCCs.ccOffset+=currCC.start-prevCC.start,currCC.new=!1,prevCC=vttCCs[(currCC=prevCC).prevCC]}vttCCs.presentationOffset=presentationTime};function parseWebVTT(vttByteArray,initPTS,vttCCs,cc,timeOffset,callBack,errorCallBack){var parsingError,parser=new VTTParser,vttLines=utf8ArrayToStr(new Uint8Array(vttByteArray)).trim().replace(LINEBREAKS,"\n").split("\n"),cues=[],init90kHz=initPTS?toMpegTsClockFromTimescale(initPTS.baseTime,initPTS.timescale):0,cueTime="00:00.000",timestampMapMPEGTS=0,timestampMapLOCAL=0,inHeader=!0;parser.oncue=function(cue){var currCC=vttCCs[cc],cueOffset=vttCCs.ccOffset,webVttMpegTsMapOffset=(timestampMapMPEGTS-init90kHz)/9e4;if(null!=currCC&&currCC.new&&(void 0!==timestampMapLOCAL?cueOffset=vttCCs.ccOffset=currCC.start:calculateOffset(vttCCs,cc,webVttMpegTsMapOffset)),webVttMpegTsMapOffset){if(!initPTS)return void(parsingError=new Error("Missing initPTS for VTT MPEGTS"));cueOffset=webVttMpegTsMapOffset-vttCCs.presentationOffset}var duration=cue.endTime-cue.startTime,startTime=normalizePts(9e4*(cue.startTime+cueOffset-timestampMapLOCAL),9e4*timeOffset)/9e4;cue.startTime=Math.max(startTime,0),cue.endTime=Math.max(startTime+duration,0);var text=cue.text.trim();cue.text=decodeURIComponent(encodeURIComponent(text)),cue.id||(cue.id=generateCueId(cue.startTime,cue.endTime,text)),cue.endTime>0&&cues.push(cue)},parser.onparsingerror=function(error){parsingError=error},parser.onflush=function(){parsingError?errorCallBack(parsingError):callBack(cues)},vttLines.forEach((function(line){if(inHeader){if(startsWith(line,"X-TIMESTAMP-MAP=")){inHeader=!1,line.slice(16).split(",").forEach((function(timestamp){startsWith(timestamp,"LOCAL:")?cueTime=timestamp.slice(6):startsWith(timestamp,"MPEGTS:")&&(timestampMapMPEGTS=parseInt(timestamp.slice(7)))}));try{timestampMapLOCAL=cueString2millis(cueTime)/1e3}catch(error){parsingError=error}return}""===line&&(inHeader=!1)}parser.parse(line+"\n")})),parser.flush()}var IMSC1_CODEC="stpp.ttml.im1t",HMSF_REGEX=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,TIME_UNIT_REGEX=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,textAlignToLineAlign={left:"start",center:"center",right:"end",start:"start",end:"end"};function parseIMSC1(payload,initPTS,callBack,errorCallBack){var results=findBox(new Uint8Array(payload),["mdat"]);if(0!==results.length){var ttmlList=results.map((function(mdat){return utf8ArrayToStr(mdat)})),syncTime=toTimescaleFromScale(initPTS.baseTime,1,initPTS.timescale);try{ttmlList.forEach((function(ttml){return callBack(parseTTML(ttml,syncTime))}))}catch(error){errorCallBack(error)}}else errorCallBack(new Error("Could not parse IMSC1 mdat"))}function parseTTML(ttml,syncTime){var tt=(new DOMParser).parseFromString(ttml,"text/xml").getElementsByTagName("tt")[0];if(!tt)throw new Error("Invalid ttml");var defaultRateInfo={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},rateInfo=Object.keys(defaultRateInfo).reduce((function(result,key){return result[key]=tt.getAttribute("ttp:"+key)||defaultRateInfo[key],result}),{}),trim="preserve"!==tt.getAttribute("xml:space"),styleElements=collectionToDictionary(getElementCollection(tt,"styling","style")),regionElements=collectionToDictionary(getElementCollection(tt,"layout","region")),cueElements=getElementCollection(tt,"body","[begin]");return[].map.call(cueElements,(function(cueElement){var cueText=getTextContent(cueElement,trim);if(!cueText||!cueElement.hasAttribute("begin"))return null;var startTime=parseTtmlTime(cueElement.getAttribute("begin"),rateInfo),duration=parseTtmlTime(cueElement.getAttribute("dur"),rateInfo),endTime=parseTtmlTime(cueElement.getAttribute("end"),rateInfo);if(null===startTime)throw timestampParsingError(cueElement);if(null===endTime){if(null===duration)throw timestampParsingError(cueElement);endTime=startTime+duration}var cue=new VTTCue(startTime-syncTime,endTime-syncTime,cueText);cue.id=generateCueId(cue.startTime,cue.endTime,cue.text);var styles=getTtmlStyles(regionElements[cueElement.getAttribute("region")],styleElements[cueElement.getAttribute("style")],styleElements),textAlign=styles.textAlign;if(textAlign){var lineAlign=textAlignToLineAlign[textAlign];lineAlign&&(cue.lineAlign=lineAlign),cue.align=textAlign}return _extends(cue,styles),cue})).filter((function(cue){return null!==cue}))}function getElementCollection(fromElement,parentName,childName){var parent=fromElement.getElementsByTagName(parentName)[0];return parent?[].slice.call(parent.querySelectorAll(childName)):[]}function collectionToDictionary(elementsWithId){return elementsWithId.reduce((function(dict,element){var id=element.getAttribute("xml:id");return id&&(dict[id]=element),dict}),{})}function getTextContent(element,trim){return[].slice.call(element.childNodes).reduce((function(str,node,i){var _node$childNodes;return"br"===node.nodeName&&i?str+"\n":null!=(_node$childNodes=node.childNodes)&&_node$childNodes.length?getTextContent(node,trim):trim?str+node.textContent.trim().replace(/\s+/g," "):str+node.textContent}),"")}function getTtmlStyles(region,style,styleElements){var ttsNs="http://www.w3.org/ns/ttml#styling",regionStyle=null,styleAttributes=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],regionStyleName=null!=region&&region.hasAttribute("style")?region.getAttribute("style"):null;return regionStyleName&&styleElements.hasOwnProperty(regionStyleName)&&(regionStyle=styleElements[regionStyleName]),styleAttributes.reduce((function(styles,name){var value=getAttributeNS(style,ttsNs,name)||getAttributeNS(region,ttsNs,name)||getAttributeNS(regionStyle,ttsNs,name);return value&&(styles[name]=value),styles}),{})}function getAttributeNS(element,ns,name){return element&&element.hasAttributeNS(ns,name)?element.getAttributeNS(ns,name):null}function timestampParsingError(node){return new Error("Could not parse ttml timestamp "+node)}function parseTtmlTime(timeAttributeValue,rateInfo){if(!timeAttributeValue)return null;var seconds=parseTimeStamp(timeAttributeValue);return null===seconds&&(HMSF_REGEX.test(timeAttributeValue)?seconds=parseHoursMinutesSecondsFrames(timeAttributeValue,rateInfo):TIME_UNIT_REGEX.test(timeAttributeValue)&&(seconds=parseTimeUnits(timeAttributeValue,rateInfo))),seconds}function parseHoursMinutesSecondsFrames(timeAttributeValue,rateInfo){var m=HMSF_REGEX.exec(timeAttributeValue),frames=(0|m[4])+(0|m[5])/rateInfo.subFrameRate;return 3600*(0|m[1])+60*(0|m[2])+(0|m[3])+frames/rateInfo.frameRate}function parseTimeUnits(timeAttributeValue,rateInfo){var m=TIME_UNIT_REGEX.exec(timeAttributeValue),value=Number(m[1]);switch(m[2]){case"h":return 3600*value;case"m":return 60*value;case"ms":return 1e3*value;case"f":return value/rateInfo.frameRate;case"t":return value/rateInfo.tickRate}return value}var TimelineController=(function(){function TimelineController(hls){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=newVTTCCs(),this.captionsProperties=void 0,this.hls=hls,this.config=hls.config,this.Cues=hls.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},hls.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),hls.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),hls.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),hls.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),hls.on(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),hls.on(Events.FRAG_LOADING,this.onFragLoading,this),hls.on(Events.FRAG_LOADED,this.onFragLoaded,this),hls.on(Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),hls.on(Events.FRAG_DECRYPTED,this.onFragDecrypted,this),hls.on(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),hls.on(Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),hls.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var _proto=TimelineController.prototype;return _proto.destroy=function(){var hls=this.hls;hls.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),hls.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),hls.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),hls.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),hls.off(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),hls.off(Events.FRAG_LOADING,this.onFragLoading,this),hls.off(Events.FRAG_LOADED,this.onFragLoaded,this),hls.off(Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),hls.off(Events.FRAG_DECRYPTED,this.onFragDecrypted,this),hls.off(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),hls.off(Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),hls.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=null,this.cea608Parser1=this.cea608Parser2=void 0},_proto.initCea608Parsers=function(){if(this.config.enableCEA708Captions&&(!this.cea608Parser1||!this.cea608Parser2)){var channel1=new OutputFilter(this,"textTrack1"),channel2=new OutputFilter(this,"textTrack2"),channel3=new OutputFilter(this,"textTrack3"),channel4=new OutputFilter(this,"textTrack4");this.cea608Parser1=new Cea608Parser(1,channel1,channel2),this.cea608Parser2=new Cea608Parser(3,channel3,channel4)}},_proto.addCues=function(trackName,startTime,endTime,screen,cueRanges){for(var merged=!1,i=cueRanges.length;i--;){var cueRange=cueRanges[i],overlap=intersection(cueRange[0],cueRange[1],startTime,endTime);if(overlap>=0&&(cueRange[0]=Math.min(cueRange[0],startTime),cueRange[1]=Math.max(cueRange[1],endTime),merged=!0,overlap/(endTime-startTime)>.5))return}if(merged||cueRanges.push([startTime,endTime]),this.config.renderTextTracksNatively){var track=this.captionsTracks[trackName];this.Cues.newCue(track,startTime,endTime,screen)}else{var cues=this.Cues.newCue(null,startTime,endTime,screen);this.hls.trigger(Events.CUES_PARSED,{type:"captions",cues:cues,track:trackName})}},_proto.onInitPtsFound=function(event,_ref){var _this=this,frag=_ref.frag,id=_ref.id,initPTS=_ref.initPTS,timescale=_ref.timescale,unparsedVttFrags=this.unparsedVttFrags;"main"===id&&(this.initPTS[frag.cc]={baseTime:initPTS,timescale:timescale}),unparsedVttFrags.length&&(this.unparsedVttFrags=[],unparsedVttFrags.forEach((function(frag){_this.onFragLoaded(Events.FRAG_LOADED,frag)})))},_proto.getExistingTrack=function(label,language){var media=this.media;if(media)for(var i=0;i<media.textTracks.length;i++){var textTrack=media.textTracks[i];if(canReuseVttTextTrack(textTrack,{name:label,lang:language,attrs:{}}))return textTrack}return null},_proto.createCaptionsTrack=function(trackName){this.config.renderTextTracksNatively?this.createNativeTrack(trackName):this.createNonNativeTrack(trackName)},_proto.createNativeTrack=function(trackName){if(!this.captionsTracks[trackName]){var captionsProperties=this.captionsProperties,captionsTracks=this.captionsTracks,media=this.media,_captionsProperties$t=captionsProperties[trackName],label=_captionsProperties$t.label,languageCode=_captionsProperties$t.languageCode,existingTrack=this.getExistingTrack(label,languageCode);if(existingTrack)captionsTracks[trackName]=existingTrack,clearCurrentCues(captionsTracks[trackName]),sendAddTrackEvent(captionsTracks[trackName],media);else{var textTrack=this.createTextTrack("captions",label,languageCode);textTrack&&(textTrack[trackName]=!0,captionsTracks[trackName]=textTrack)}}},_proto.createNonNativeTrack=function(trackName){if(!this.nonNativeCaptionsTracks[trackName]){var trackProperties=this.captionsProperties[trackName];if(trackProperties){var track={_id:trackName,label:trackProperties.label,kind:"captions",default:!!trackProperties.media&&!!trackProperties.media.default,closedCaptions:trackProperties.media};this.nonNativeCaptionsTracks[trackName]=track,this.hls.trigger(Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[track]})}}},_proto.createTextTrack=function(kind,label,lang){var media=this.media;if(media)return media.addTextTrack(kind,label,lang)},_proto.onMediaAttaching=function(event,data){this.media=data.media,this._cleanTracks()},_proto.onMediaDetaching=function(){var captionsTracks=this.captionsTracks;Object.keys(captionsTracks).forEach((function(trackName){clearCurrentCues(captionsTracks[trackName]),delete captionsTracks[trackName]})),this.nonNativeCaptionsTracks={}},_proto.onManifestLoading=function(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=newVTTCCs(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},_proto._cleanTracks=function(){var media=this.media;if(media){var textTracks=media.textTracks;if(textTracks)for(var i=0;i<textTracks.length;i++)clearCurrentCues(textTracks[i])}},_proto.onSubtitleTracksUpdated=function(event,data){var _this2=this,tracks=data.subtitleTracks||[],hasIMSC1=tracks.some((function(track){return track.textCodec===IMSC1_CODEC}));if(this.config.enableWebVTT||hasIMSC1&&this.config.enableIMSC1){if(subtitleOptionsIdentical(this.tracks,tracks))return void(this.tracks=tracks);if(this.textTracks=[],this.tracks=tracks,this.config.renderTextTracksNatively){var media=this.media,inUseTracks=media?filterSubtitleTracks(media.textTracks):null;if(this.tracks.forEach((function(track,index){var textTrack;if(inUseTracks){for(var inUseTrack=null,i=0;i<inUseTracks.length;i++)if(inUseTracks[i]&&canReuseVttTextTrack(inUseTracks[i],track)){inUseTrack=inUseTracks[i],inUseTracks[i]=null;break}inUseTrack&&(textTrack=inUseTrack)}if(textTrack)clearCurrentCues(textTrack);else{var textTrackKind=captionsOrSubtitlesFromCharacteristics(track);(textTrack=_this2.createTextTrack(textTrackKind,track.name,track.lang))&&(textTrack.mode="disabled")}textTrack&&_this2.textTracks.push(textTrack)})),null!=inUseTracks&&inUseTracks.length){var unusedTextTracks=inUseTracks.filter((function(t){return null!==t})).map((function(t){return t.label}));unusedTextTracks.length&&logger.warn("Media element contains unused subtitle tracks: "+unusedTextTracks.join(", ")+". Replace media element for each source to clear TextTracks and captions menu.")}}else if(this.tracks.length){var tracksList=this.tracks.map((function(track){return{label:track.name,kind:track.type.toLowerCase(),default:track.default,subtitleTrack:track}}));this.hls.trigger(Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:tracksList})}}},_proto.onManifestLoaded=function(event,data){var _this3=this;this.config.enableCEA708Captions&&data.captions&&data.captions.forEach((function(captionsTrack){var instreamIdMatch=/(?:CC|SERVICE)([1-4])/.exec(captionsTrack.instreamId);if(instreamIdMatch){var trackName="textTrack"+instreamIdMatch[1],trackProperties=_this3.captionsProperties[trackName];trackProperties&&(trackProperties.label=captionsTrack.name,captionsTrack.lang&&(trackProperties.languageCode=captionsTrack.lang),trackProperties.media=captionsTrack)}}))},_proto.closedCaptionsForLevel=function(frag){var level=this.hls.levels[frag.level];return null==level?void 0:level.attrs["CLOSED-CAPTIONS"]},_proto.onFragLoading=function(event,data){this.initCea608Parsers();var cea608Parser1=this.cea608Parser1,cea608Parser2=this.cea608Parser2,lastCc=this.lastCc,lastSn=this.lastSn,lastPartIndex=this.lastPartIndex;if(this.enabled&&cea608Parser1&&cea608Parser2&&data.frag.type===PlaylistLevelType.MAIN){var _data$part$index,_data$part,_data$frag=data.frag,cc=_data$frag.cc,sn=_data$frag.sn,partIndex=null!=(_data$part$index=null==data||null==(_data$part=data.part)?void 0:_data$part.index)?_data$part$index:-1;sn===lastSn+1||sn===lastSn&&partIndex===lastPartIndex+1||cc===lastCc||(cea608Parser1.reset(),cea608Parser2.reset()),this.lastCc=cc,this.lastSn=sn,this.lastPartIndex=partIndex}},_proto.onFragLoaded=function(event,data){var frag=data.frag,payload=data.payload;if(frag.type===PlaylistLevelType.SUBTITLE)if(payload.byteLength){var decryptData=frag.decryptdata,decrypted="stats"in data;if(null==decryptData||!decryptData.encrypted||decrypted){var trackPlaylistMedia=this.tracks[frag.level],vttCCs=this.vttCCs;vttCCs[frag.cc]||(vttCCs[frag.cc]={start:frag.start,prevCC:this.prevCC,new:!0},this.prevCC=frag.cc),trackPlaylistMedia&&trackPlaylistMedia.textCodec===IMSC1_CODEC?this._parseIMSC1(frag,payload):this._parseVTTs(data)}}else this.hls.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:frag,error:new Error("Empty subtitle payload")})},_proto._parseIMSC1=function(frag,payload){var _this4=this,hls=this.hls;parseIMSC1(payload,this.initPTS[frag.cc],(function(cues){_this4._appendCues(cues,frag.level),hls.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:frag})}),(function(error){logger.log("Failed to parse IMSC1: "+error),hls.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:frag,error:error})}))},_proto._parseVTTs=function(data){var _frag$initSegment,_this5=this,frag=data.frag,payload=data.payload,initPTS=this.initPTS,unparsedVttFrags=this.unparsedVttFrags,maxAvCC=initPTS.length-1;if(initPTS[frag.cc]||-1!==maxAvCC){var hls=this.hls;parseWebVTT(null!=(_frag$initSegment=frag.initSegment)&&_frag$initSegment.data?appendUint8Array(frag.initSegment.data,new Uint8Array(payload)):payload,this.initPTS[frag.cc],this.vttCCs,frag.cc,frag.start,(function(cues){_this5._appendCues(cues,frag.level),hls.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:frag})}),(function(error){var missingInitPTS="Missing initPTS for VTT MPEGTS"===error.message;missingInitPTS?unparsedVttFrags.push(data):_this5._fallbackToIMSC1(frag,payload),logger.log("Failed to parse VTT cue: "+error),missingInitPTS&&maxAvCC>frag.cc||hls.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:frag,error:error})}))}else unparsedVttFrags.push(data)},_proto._fallbackToIMSC1=function(frag,payload){var _this6=this,trackPlaylistMedia=this.tracks[frag.level];trackPlaylistMedia.textCodec||parseIMSC1(payload,this.initPTS[frag.cc],(function(){trackPlaylistMedia.textCodec=IMSC1_CODEC,_this6._parseIMSC1(frag,payload)}),(function(){trackPlaylistMedia.textCodec="wvtt"}))},_proto._appendCues=function(cues,fragLevel){var hls=this.hls;if(this.config.renderTextTracksNatively){var textTrack=this.textTracks[fragLevel];if(!textTrack||"disabled"===textTrack.mode)return;cues.forEach((function(cue){return addCueToTrack(textTrack,cue)}))}else{var currentTrack=this.tracks[fragLevel];if(!currentTrack)return;var track=currentTrack.default?"default":"subtitles"+fragLevel;hls.trigger(Events.CUES_PARSED,{type:"subtitles",cues:cues,track:track})}},_proto.onFragDecrypted=function(event,data){data.frag.type===PlaylistLevelType.SUBTITLE&&this.onFragLoaded(Events.FRAG_LOADED,data)},_proto.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},_proto.onFragParsingUserdata=function(event,data){this.initCea608Parsers();var cea608Parser1=this.cea608Parser1,cea608Parser2=this.cea608Parser2;if(this.enabled&&cea608Parser1&&cea608Parser2){var frag=data.frag,samples=data.samples;if(frag.type!==PlaylistLevelType.MAIN||"NONE"!==this.closedCaptionsForLevel(frag))for(var i=0;i<samples.length;i++){var ccBytes=samples[i].bytes;if(ccBytes){var ccdatas=this.extractCea608Data(ccBytes);cea608Parser1.addData(samples[i].pts,ccdatas[0]),cea608Parser2.addData(samples[i].pts,ccdatas[1])}}}},_proto.onBufferFlushing=function(event,_ref2){var startOffset=_ref2.startOffset,endOffset=_ref2.endOffset,endOffsetSubtitles=_ref2.endOffsetSubtitles,type=_ref2.type,media=this.media;if(media&&!(media.currentTime<endOffset)){if(!type||"video"===type){var captionsTracks=this.captionsTracks;Object.keys(captionsTracks).forEach((function(trackName){return removeCuesInRange(captionsTracks[trackName],startOffset,endOffset)}))}if(this.config.renderTextTracksNatively&&0===startOffset&&void 0!==endOffsetSubtitles){var textTracks=this.textTracks;Object.keys(textTracks).forEach((function(trackName){return removeCuesInRange(textTracks[trackName],startOffset,endOffsetSubtitles)}))}}},_proto.extractCea608Data=function(byteArray){for(var actualCCBytes=[[],[]],count=31&byteArray[0],position=2,j=0;j<count;j++){var tmpByte=byteArray[position++],ccbyte1=127&byteArray[position++],ccbyte2=127&byteArray[position++];if((0!==ccbyte1||0!==ccbyte2)&&0!=(4&tmpByte)){var ccType=3&tmpByte;0!==ccType&&1!==ccType||(actualCCBytes[ccType].push(ccbyte1),actualCCBytes[ccType].push(ccbyte2))}}return actualCCBytes},TimelineController})();function captionsOrSubtitlesFromCharacteristics(track){return track.characteristics&&/transcribes-spoken-dialog/gi.test(track.characteristics)&&/describes-music-and-sound/gi.test(track.characteristics)?"captions":"subtitles"}function canReuseVttTextTrack(inUseTrack,manifestTrack){return!!inUseTrack&&inUseTrack.kind===captionsOrSubtitlesFromCharacteristics(manifestTrack)&&subtitleTrackMatchesTextTrack(manifestTrack,inUseTrack)}function intersection(x1,x2,y1,y2){return Math.min(x2,y2)-Math.max(x1,y1)}function newVTTCCs(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}var CapLevelController=(function(){function CapLevelController(hls){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=hls,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var _proto=CapLevelController.prototype;return _proto.setStreamController=function(streamController){this.streamController=streamController},_proto.destroy=function(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},_proto.registerListeners=function(){var hls=this.hls;hls.on(Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),hls.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),hls.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),hls.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),hls.on(Events.BUFFER_CODECS,this.onBufferCodecs,this),hls.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this)},_proto.unregisterListener=function(){var hls=this.hls;hls.off(Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),hls.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),hls.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),hls.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),hls.off(Events.BUFFER_CODECS,this.onBufferCodecs,this),hls.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this)},_proto.onFpsDropLevelCapping=function(event,data){var level=this.hls.levels[data.droppedLevel];this.isLevelAllowed(level)&&this.restrictedLevels.push({bitrate:level.bitrate,height:level.height,width:level.width})},_proto.onMediaAttaching=function(event,data){this.media=data.media instanceof HTMLVideoElement?data.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()},_proto.onManifestParsed=function(event,data){var hls=this.hls;this.restrictedLevels=[],this.firstLevel=data.firstLevel,hls.config.capLevelToPlayerSize&&data.video&&this.startCapping()},_proto.onLevelsUpdated=function(event,data){this.timer&&isFiniteNumber(this.autoLevelCapping)&&this.detectPlayerSize()},_proto.onBufferCodecs=function(event,data){this.hls.config.capLevelToPlayerSize&&data.video&&this.startCapping()},_proto.onMediaDetaching=function(){this.stopCapping()},_proto.detectPlayerSize=function(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0)return void(this.clientRect=null);var levels=this.hls.levels;if(levels.length){var hls=this.hls,maxLevel=this.getMaxLevel(levels.length-1);maxLevel!==this.autoLevelCapping&&logger.log("Setting autoLevelCapping to "+maxLevel+": "+levels[maxLevel].height+"p@"+levels[maxLevel].bitrate+" for media "+this.mediaWidth+"x"+this.mediaHeight),hls.autoLevelCapping=maxLevel,hls.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=hls.autoLevelCapping}}},_proto.getMaxLevel=function(capLevelIndex){var _this=this,levels=this.hls.levels;if(!levels.length)return-1;var validLevels=levels.filter((function(level,index){return _this.isLevelAllowed(level)&&index<=capLevelIndex}));return this.clientRect=null,CapLevelController.getMaxLevelByMediaSize(validLevels,this.mediaWidth,this.mediaHeight)},_proto.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},_proto.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},_proto.getDimensions=function(){if(this.clientRect)return this.clientRect;var media=this.media,boundsRect={width:0,height:0};if(media){var clientRect=media.getBoundingClientRect();boundsRect.width=clientRect.width,boundsRect.height=clientRect.height,boundsRect.width||boundsRect.height||(boundsRect.width=clientRect.right-clientRect.left||media.width||0,boundsRect.height=clientRect.bottom-clientRect.top||media.height||0)}return this.clientRect=boundsRect,boundsRect},_proto.isLevelAllowed=function(level){return!this.restrictedLevels.some((function(restrictedLevel){return level.bitrate===restrictedLevel.bitrate&&level.width===restrictedLevel.width&&level.height===restrictedLevel.height}))},CapLevelController.getMaxLevelByMediaSize=function(levels,width,height){if(null==levels||!levels.length)return-1;for(var atGreatestBandwidth=function(curLevel,nextLevel){return!nextLevel||curLevel.width!==nextLevel.width||curLevel.height!==nextLevel.height},maxLevelIndex=levels.length-1,squareSize=Math.max(width,height),i=0;i<levels.length;i+=1){var level=levels[i];if((level.width>=squareSize||level.height>=squareSize)&&atGreatestBandwidth(level,levels[i+1])){maxLevelIndex=i;break}}return maxLevelIndex},_createClass(CapLevelController,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var pixelRatio=1;if(!this.hls.config.ignoreDevicePixelRatio)try{pixelRatio=self.devicePixelRatio}catch(e){}return pixelRatio}}]),CapLevelController})(),FPSController=(function(){function FPSController(hls){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=hls,this.registerListeners()}var _proto=FPSController.prototype;return _proto.setStreamController=function(streamController){this.streamController=streamController},_proto.registerListeners=function(){this.hls.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},_proto.unregisterListeners=function(){this.hls.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},_proto.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},_proto.onMediaAttaching=function(event,data){var config=this.hls.config;if(config.capLevelOnFPSDrop){var media=data.media instanceof self.HTMLVideoElement?data.media:null;this.media=media,media&&"function"==typeof media.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),config.fpsDroppedMonitoringPeriod)}},_proto.checkFPS=function(video,decodedFrames,droppedFrames){var currentTime=performance.now();if(decodedFrames){if(this.lastTime){var currentPeriod=currentTime-this.lastTime,currentDropped=droppedFrames-this.lastDroppedFrames,currentDecoded=decodedFrames-this.lastDecodedFrames,droppedFPS=1e3*currentDropped/currentPeriod,hls=this.hls;if(hls.trigger(Events.FPS_DROP,{currentDropped:currentDropped,currentDecoded:currentDecoded,totalDroppedFrames:droppedFrames}),droppedFPS>0&&currentDropped>hls.config.fpsDroppedMonitoringThreshold*currentDecoded){var currentLevel=hls.currentLevel;logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+currentLevel),currentLevel>0&&(-1===hls.autoLevelCapping||hls.autoLevelCapping>=currentLevel)&&(currentLevel-=1,hls.trigger(Events.FPS_DROP_LEVEL_CAPPING,{level:currentLevel,droppedLevel:hls.currentLevel}),hls.autoLevelCapping=currentLevel,this.streamController.nextLevelSwitch())}}this.lastTime=currentTime,this.lastDroppedFrames=droppedFrames,this.lastDecodedFrames=decodedFrames}},_proto.checkFPSInterval=function(){var video=this.media;if(video)if(this.isVideoPlaybackQualityAvailable){var videoPlaybackQuality=video.getVideoPlaybackQuality();this.checkFPS(video,videoPlaybackQuality.totalVideoFrames,videoPlaybackQuality.droppedVideoFrames)}else this.checkFPS(video,video.webkitDecodedFrameCount,video.webkitDroppedFrameCount)},FPSController})(),LOGGER_PREFIX="[eme]",EMEController=(function(){function EMEController(hls){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=EMEController.CDMCleanupPromise?[EMEController.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=logger.debug.bind(logger,LOGGER_PREFIX),this.log=logger.log.bind(logger,LOGGER_PREFIX),this.warn=logger.warn.bind(logger,LOGGER_PREFIX),this.error=logger.error.bind(logger,LOGGER_PREFIX),this.hls=hls,this.config=hls.config,this.registerListeners()}var _proto=EMEController.prototype;return _proto.destroy=function(){this.unregisterListeners(),this.onMediaDetached();var config=this.config;config.requestMediaKeySystemAccessFunc=null,config.licenseXhrSetup=config.licenseResponseCallback=void 0,config.drmSystems=config.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null},_proto.registerListeners=function(){this.hls.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this)},_proto.unregisterListeners=function(){this.hls.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this)},_proto.getLicenseServerUrl=function(keySystem){var _this$config=this.config,drmSystems=_this$config.drmSystems,widevineLicenseUrl=_this$config.widevineLicenseUrl,keySystemConfiguration=drmSystems[keySystem];if(keySystemConfiguration)return keySystemConfiguration.licenseUrl;if(keySystem===KeySystems.WIDEVINE&&widevineLicenseUrl)return widevineLicenseUrl;throw new Error('no license server URL configured for key-system "'+keySystem+'"')},_proto.getServerCertificateUrl=function(keySystem){var keySystemConfiguration=this.config.drmSystems[keySystem];if(keySystemConfiguration)return keySystemConfiguration.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'+keySystem+'"]')},_proto.attemptKeySystemAccess=function(keySystemsToAttempt){var _this=this,levels=this.hls.levels,uniqueCodec=function(value,i,a){return!!value&&a.indexOf(value)===i},audioCodecs=levels.map((function(level){return level.audioCodec})).filter(uniqueCodec),videoCodecs=levels.map((function(level){return level.videoCodec})).filter(uniqueCodec);return audioCodecs.length+videoCodecs.length===0&&videoCodecs.push("avc1.42e01e"),new Promise((function(resolve,reject){!(function attempt(keySystems){var keySystem=keySystems.shift();_this.getMediaKeysPromise(keySystem,audioCodecs,videoCodecs).then((function(mediaKeys){return resolve({keySystem:keySystem,mediaKeys:mediaKeys})})).catch((function(error){keySystems.length?attempt(keySystems):reject(error instanceof EMEKeyError?error:new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_ACCESS,error:error,fatal:!0},error.message))}))})(keySystemsToAttempt)}))},_proto.requestMediaKeySystemAccess=function(keySystem,supportedConfigurations){var requestMediaKeySystemAccessFunc=this.config.requestMediaKeySystemAccessFunc;if("function"!=typeof requestMediaKeySystemAccessFunc){var errMessage="Configured requestMediaKeySystemAccess is not a function "+requestMediaKeySystemAccessFunc;return null===requestMediaKeySystemAccess&&"http:"===self.location.protocol&&(errMessage="navigator.requestMediaKeySystemAccess is not available over insecure protocol "+location.protocol),Promise.reject(new Error(errMessage))}return requestMediaKeySystemAccessFunc(keySystem,supportedConfigurations)},_proto.getMediaKeysPromise=function(keySystem,audioCodecs,videoCodecs){var _this2=this,mediaKeySystemConfigs=getSupportedMediaKeySystemConfigurations(keySystem,audioCodecs,videoCodecs,this.config.drmSystemOptions),keySystemAccessPromises=this.keySystemAccessPromises[keySystem],keySystemAccess=null==keySystemAccessPromises?void 0:keySystemAccessPromises.keySystemAccess;if(!keySystemAccess){this.log('Requesting encrypted media "'+keySystem+'" key-system access with config: '+JSON.stringify(mediaKeySystemConfigs)),keySystemAccess=this.requestMediaKeySystemAccess(keySystem,mediaKeySystemConfigs);var _keySystemAccessPromises=this.keySystemAccessPromises[keySystem]={keySystemAccess:keySystemAccess};return keySystemAccess.catch((function(error){_this2.log('Failed to obtain access to key-system "'+keySystem+'": '+error)})),keySystemAccess.then((function(mediaKeySystemAccess){_this2.log('Access for key-system "'+mediaKeySystemAccess.keySystem+'" obtained');var certificateRequest=_this2.fetchServerCertificate(keySystem);return _this2.log('Create media-keys for "'+keySystem+'"'),_keySystemAccessPromises.mediaKeys=mediaKeySystemAccess.createMediaKeys().then((function(mediaKeys){return _this2.log('Media-keys created for "'+keySystem+'"'),certificateRequest.then((function(certificate){return certificate?_this2.setMediaKeysServerCertificate(mediaKeys,keySystem,certificate):mediaKeys}))})),_keySystemAccessPromises.mediaKeys.catch((function(error){_this2.error('Failed to create media-keys for "'+keySystem+'"}: '+error)})),_keySystemAccessPromises.mediaKeys}))}return keySystemAccess.then((function(){return keySystemAccessPromises.mediaKeys}))},_proto.createMediaKeySessionContext=function(_ref){var decryptdata=_ref.decryptdata,keySystem=_ref.keySystem,mediaKeys=_ref.mediaKeys;this.log('Creating key-system session "'+keySystem+'" keyId: '+Hex.hexDump(decryptdata.keyId||[]));var mediaKeysSession=mediaKeys.createSession(),mediaKeySessionContext={decryptdata:decryptdata,keySystem:keySystem,mediaKeys:mediaKeys,mediaKeysSession:mediaKeysSession,keyStatus:"status-pending"};return this.mediaKeySessions.push(mediaKeySessionContext),mediaKeySessionContext},_proto.renewKeySession=function(mediaKeySessionContext){var decryptdata=mediaKeySessionContext.decryptdata;if(decryptdata.pssh){var keySessionContext=this.createMediaKeySessionContext(mediaKeySessionContext),_keyId=this.getKeyIdString(decryptdata),scheme="cenc";this.keyIdToKeySessionPromise[_keyId]=this.generateRequestWithPreferredKeySession(keySessionContext,scheme,decryptdata.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(mediaKeySessionContext)},_proto.getKeyIdString=function(decryptdata){if(!decryptdata)throw new Error("Could not read keyId of undefined decryptdata");if(null===decryptdata.keyId)throw new Error("keyId is null");return Hex.hexDump(decryptdata.keyId)},_proto.updateKeySession=function(mediaKeySessionContext,data){var _mediaKeySessionConte,keySession=mediaKeySessionContext.mediaKeysSession;return this.log('Updating key-session "'+keySession.sessionId+'" for keyID '+Hex.hexDump((null==(_mediaKeySessionConte=mediaKeySessionContext.decryptdata)?void 0:_mediaKeySessionConte.keyId)||[])+"\n      } (data length: "+(data?data.byteLength:data)+")"),keySession.update(data)},_proto.selectKeySystemFormat=function(frag){var keyFormats=Object.keys(frag.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: "+frag.sn+" "+frag.type+": "+frag.level+") key formats "+keyFormats.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(keyFormats)),this.keyFormatPromise},_proto.getKeyFormatPromise=function(keyFormats){var _this3=this;return new Promise((function(resolve,reject){var keySystemsInConfig=getKeySystemsForConfig(_this3.config),keySystemsToAttempt=keyFormats.map(keySystemFormatToKeySystemDomain).filter((function(value){return!!value&&-1!==keySystemsInConfig.indexOf(value)}));return _this3.getKeySystemSelectionPromise(keySystemsToAttempt).then((function(_ref2){var keySystem=_ref2.keySystem,keySystemFormat=keySystemDomainToKeySystemFormat(keySystem);keySystemFormat?resolve(keySystemFormat):reject(new Error('Unable to find format for key-system "'+keySystem+'"'))})).catch(reject)}))},_proto.loadKey=function(data){var _this4=this,decryptdata=data.keyInfo.decryptdata,keyId=this.getKeyIdString(decryptdata),keyDetails="(keyId: "+keyId+' format: "'+decryptdata.keyFormat+'" method: '+decryptdata.method+" uri: "+decryptdata.uri+")";this.log("Starting session for key "+keyDetails);var keySessionContextPromise=this.keyIdToKeySessionPromise[keyId];return keySessionContextPromise||(keySessionContextPromise=this.keyIdToKeySessionPromise[keyId]=this.getKeySystemForKeyPromise(decryptdata).then((function(_ref3){var keySystem=_ref3.keySystem,mediaKeys=_ref3.mediaKeys;return _this4.throwIfDestroyed(),_this4.log("Handle encrypted media sn: "+data.frag.sn+" "+data.frag.type+": "+data.frag.level+" using key "+keyDetails),_this4.attemptSetMediaKeys(keySystem,mediaKeys).then((function(){_this4.throwIfDestroyed();var keySessionContext=_this4.createMediaKeySessionContext({keySystem:keySystem,mediaKeys:mediaKeys,decryptdata:decryptdata}),scheme="cenc";return _this4.generateRequestWithPreferredKeySession(keySessionContext,scheme,decryptdata.pssh,"playlist-key")}))}))).catch((function(error){return _this4.handleError(error)})),keySessionContextPromise},_proto.throwIfDestroyed=function(message){if(!this.hls)throw new Error("invalid state")},_proto.handleError=function(error){this.hls&&(this.error(error.message),error instanceof EMEKeyError?this.hls.trigger(Events.ERROR,error.data):this.hls.trigger(Events.ERROR,{type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_KEYS,error:error,fatal:!0}))},_proto.getKeySystemForKeyPromise=function(decryptdata){var keyId=this.getKeyIdString(decryptdata),mediaKeySessionContext=this.keyIdToKeySessionPromise[keyId];if(!mediaKeySessionContext){var keySystem=keySystemFormatToKeySystemDomain(decryptdata.keyFormat),keySystemsToAttempt=keySystem?[keySystem]:getKeySystemsForConfig(this.config);return this.attemptKeySystemAccess(keySystemsToAttempt)}return mediaKeySessionContext},_proto.getKeySystemSelectionPromise=function(keySystemsToAttempt){if(keySystemsToAttempt.length||(keySystemsToAttempt=getKeySystemsForConfig(this.config)),0===keySystemsToAttempt.length)throw new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options "+JSON.stringify({drmSystems:this.config.drmSystems}));return this.attemptKeySystemAccess(keySystemsToAttempt)},_proto._onMediaEncrypted=function(event){var _this5=this,initDataType=event.initDataType,initData=event.initData;if(this.debug('"'+event.type+'" event: init data type: "'+initDataType+'"'),null!==initData){var keyId,keySystemDomain;if("sinf"===initDataType&&this.config.drmSystems[KeySystems.FAIRPLAY]){var json=bin2str(new Uint8Array(initData));try{var sinf=base64Decode(JSON.parse(json).sinf),tenc=parseSinf(new Uint8Array(sinf));if(!tenc)return;keyId=tenc.subarray(8,24),keySystemDomain=KeySystems.FAIRPLAY}catch(error){return void this.warn('Failed to parse sinf "encrypted" event message initData')}}else{var psshInfo=parsePssh(initData);if(null===psshInfo)return;0===psshInfo.version&&psshInfo.systemId===KeySystemIds.WIDEVINE&&psshInfo.data&&(keyId=psshInfo.data.subarray(8,24)),keySystemDomain=keySystemIdToKeySystemDomain(psshInfo.systemId)}if(keySystemDomain&&keyId){for(var _ret,keyIdHex=Hex.hexDump(keyId),keyIdToKeySessionPromise=this.keyIdToKeySessionPromise,mediaKeySessions=this.mediaKeySessions,keySessionContextPromise=keyIdToKeySessionPromise[keyIdHex],_loop=function(){var keyContext=mediaKeySessions[i],decryptdata=keyContext.decryptdata;if(decryptdata.pssh||!decryptdata.keyId)return 0;var oldKeyIdHex=Hex.hexDump(decryptdata.keyId);return keyIdHex===oldKeyIdHex||-1!==decryptdata.uri.replace(/-/g,"").indexOf(keyIdHex)?(keySessionContextPromise=keyIdToKeySessionPromise[oldKeyIdHex],delete keyIdToKeySessionPromise[oldKeyIdHex],decryptdata.pssh=new Uint8Array(initData),decryptdata.keyId=keyId,keySessionContextPromise=keyIdToKeySessionPromise[keyIdHex]=keySessionContextPromise.then((function(){return _this5.generateRequestWithPreferredKeySession(keyContext,initDataType,initData,"encrypted-event-key-match")})),1):void 0},i=0;i<mediaKeySessions.length&&(0===(_ret=_loop())||1!==_ret);i++);keySessionContextPromise||(keySessionContextPromise=keyIdToKeySessionPromise[keyIdHex]=this.getKeySystemSelectionPromise([keySystemDomain]).then((function(_ref4){var _keySystemToKeySystem,keySystem=_ref4.keySystem,mediaKeys=_ref4.mediaKeys;_this5.throwIfDestroyed();var decryptdata=new LevelKey("ISO-23001-7",keyIdHex,null!=(_keySystemToKeySystem=keySystemDomainToKeySystemFormat(keySystem))?_keySystemToKeySystem:"");return decryptdata.pssh=new Uint8Array(initData),decryptdata.keyId=keyId,_this5.attemptSetMediaKeys(keySystem,mediaKeys).then((function(){_this5.throwIfDestroyed();var keySessionContext=_this5.createMediaKeySessionContext({decryptdata:decryptdata,keySystem:keySystem,mediaKeys:mediaKeys});return _this5.generateRequestWithPreferredKeySession(keySessionContext,initDataType,initData,"encrypted-event-no-match")}))}))),keySessionContextPromise.catch((function(error){return _this5.handleError(error)}))}}},_proto._onWaitingForKey=function(event){this.log('"'+event.type+'" event')},_proto.attemptSetMediaKeys=function(keySystem,mediaKeys){var _this6=this,queue=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'+keySystem+'"');var setMediaKeysPromise=Promise.all(queue).then((function(){if(!_this6.media)throw new Error("Attempted to set mediaKeys without media element attached");return _this6.media.setMediaKeys(mediaKeys)}));return this.setMediaKeysQueue.push(setMediaKeysPromise),setMediaKeysPromise.then((function(){_this6.log('Media-keys set for "'+keySystem+'"'),queue.push(setMediaKeysPromise),_this6.setMediaKeysQueue=_this6.setMediaKeysQueue.filter((function(p){return-1===queue.indexOf(p)}))}))},_proto.generateRequestWithPreferredKeySession=function(context,initDataType,initData,reason){var _this$config$drmSyste,_this$config$drmSyste2,_this7=this,generateRequestFilter=null==(_this$config$drmSyste=this.config.drmSystems)||null==(_this$config$drmSyste2=_this$config$drmSyste[context.keySystem])?void 0:_this$config$drmSyste2.generateRequest;if(generateRequestFilter)try{var mappedInitData=generateRequestFilter.call(this.hls,initDataType,initData,context);if(!mappedInitData)throw new Error("Invalid response from configured generateRequest filter");initDataType=mappedInitData.initDataType,initData=context.decryptdata.pssh=mappedInitData.initData?new Uint8Array(mappedInitData.initData):null}catch(error){var _this$hls;if(this.warn(error.message),null!=(_this$hls=this.hls)&&_this$hls.config.debug)throw error}if(null===initData)return this.log('Skipping key-session request for "'+reason+'" (no initData)'),Promise.resolve(context);var keyId=this.getKeyIdString(context.decryptdata);this.log('Generating key-session request for "'+reason+'": '+keyId+" (init data type: "+initDataType+" length: "+(initData?initData.byteLength:null)+")");var licenseStatus=new EventEmitter,onmessage=context._onmessage=function(event){var keySession=context.mediaKeysSession;if(keySession){var messageType=event.messageType,message=event.message;_this7.log('"'+messageType+'" message event for session "'+keySession.sessionId+'" message size: '+message.byteLength),"license-request"===messageType||"license-renewal"===messageType?_this7.renewLicense(context,message).catch((function(error){_this7.handleError(error),licenseStatus.emit("error",error)})):"license-release"===messageType?context.keySystem===KeySystems.FAIRPLAY&&(_this7.updateKeySession(context,strToUtf8array("acknowledged")),_this7.removeSession(context)):_this7.warn('unhandled media key message type "'+messageType+'"')}else licenseStatus.emit("error",new Error("invalid state"))},onkeystatuseschange=context._onkeystatuseschange=function(event){if(context.mediaKeysSession){_this7.onKeyStatusChange(context);var keyStatus=context.keyStatus;licenseStatus.emit("keyStatus",keyStatus),"expired"===keyStatus&&(_this7.warn(context.keySystem+" expired for key "+keyId),_this7.renewKeySession(context))}else licenseStatus.emit("error",new Error("invalid state"))};context.mediaKeysSession.addEventListener("message",onmessage),context.mediaKeysSession.addEventListener("keystatuseschange",onkeystatuseschange);var keyUsablePromise=new Promise((function(resolve,reject){licenseStatus.on("error",reject),licenseStatus.on("keyStatus",(function(keyStatus){keyStatus.startsWith("usable")?resolve():"output-restricted"===keyStatus?reject(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):"internal-error"===keyStatus?reject(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},'key status changed to "'+keyStatus+'"')):"expired"===keyStatus?reject(new Error("key expired while generating request")):_this7.warn('unhandled key status change "'+keyStatus+'"')}))}));return context.mediaKeysSession.generateRequest(initDataType,initData).then((function(){var _context$mediaKeysSes;_this7.log('Request generated for key-session "'+(null==(_context$mediaKeysSes=context.mediaKeysSession)?void 0:_context$mediaKeysSes.sessionId)+'" keyId: '+keyId)})).catch((function(error){throw new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_SESSION,error:error,fatal:!1},"Error generating key-session request: "+error)})).then((function(){return keyUsablePromise})).catch((function(error){throw licenseStatus.removeAllListeners(),_this7.removeSession(context),error})).then((function(){return licenseStatus.removeAllListeners(),context}))},_proto.onKeyStatusChange=function(mediaKeySessionContext){var _this8=this;mediaKeySessionContext.mediaKeysSession.keyStatuses.forEach((function(status,keyId){_this8.log('key status change "'+status+'" for keyStatuses keyId: '+Hex.hexDump("buffer"in keyId?new Uint8Array(keyId.buffer,keyId.byteOffset,keyId.byteLength):new Uint8Array(keyId))+" session keyId: "+Hex.hexDump(new Uint8Array(mediaKeySessionContext.decryptdata.keyId||[]))+" uri: "+mediaKeySessionContext.decryptdata.uri),mediaKeySessionContext.keyStatus=status}))},_proto.fetchServerCertificate=function(keySystem){var config=this.config,certLoader=new(0,config.loader)(config),url=this.getServerCertificateUrl(keySystem);return url?(this.log('Fetching server certificate for "'+keySystem+'"'),new Promise((function(resolve,reject){var loaderContext={responseType:"arraybuffer",url:url},loadPolicy=config.certLoadPolicy.default,loaderConfig={loadPolicy:loadPolicy,timeout:loadPolicy.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},loaderCallbacks={onSuccess:function(response,stats,context,networkDetails){resolve(response.data)},onError:function(response,contex,networkDetails,stats){reject(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:networkDetails,response:_objectSpread2({url:loaderContext.url,data:void 0},response)},'"'+keySystem+'" certificate request failed ('+url+"). Status: "+response.code+" ("+response.text+")"))},onTimeout:function(stats,context,networkDetails){reject(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:networkDetails,response:{url:loaderContext.url,data:void 0}},'"'+keySystem+'" certificate request timed out ('+url+")"))},onAbort:function(stats,context,networkDetails){reject(new Error("aborted"))}};certLoader.load(loaderContext,loaderConfig,loaderCallbacks)}))):Promise.resolve()},_proto.setMediaKeysServerCertificate=function(mediaKeys,keySystem,cert){var _this9=this;return new Promise((function(resolve,reject){mediaKeys.setServerCertificate(cert).then((function(success){_this9.log("setServerCertificate "+(success?"success":"not supported by CDM")+" ("+(null==cert?void 0:cert.byteLength)+') on "'+keySystem+'"'),resolve(mediaKeys)})).catch((function(error){reject(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:error,fatal:!0},error.message))}))}))},_proto.renewLicense=function(context,keyMessage){var _this10=this;return this.requestLicense(context,new Uint8Array(keyMessage)).then((function(data){return _this10.updateKeySession(context,new Uint8Array(data)).catch((function(error){throw new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:error,fatal:!0},error.message)}))}))},_proto.unpackPlayReadyKeyMessage=function(xhr,licenseChallenge){var xmlString=String.fromCharCode.apply(null,new Uint16Array(licenseChallenge.buffer));if(!xmlString.includes("PlayReadyKeyMessage"))return xhr.setRequestHeader("Content-Type","text/xml; charset=utf-8"),licenseChallenge;var keyMessageXml=(new DOMParser).parseFromString(xmlString,"application/xml"),headers=keyMessageXml.querySelectorAll("HttpHeader");if(headers.length>0)for(var header,i=0,len=headers.length;i<len;i++){var _header$querySelector,_header$querySelector2,name=null==(_header$querySelector=(header=headers[i]).querySelector("name"))?void 0:_header$querySelector.textContent,_value=null==(_header$querySelector2=header.querySelector("value"))?void 0:_header$querySelector2.textContent;name&&_value&&xhr.setRequestHeader(name,_value)}var challengeElement=keyMessageXml.querySelector("Challenge"),challengeText=null==challengeElement?void 0:challengeElement.textContent;if(!challengeText)throw new Error("Cannot find <Challenge> in key message");return strToUtf8array(atob(challengeText))},_proto.setupLicenseXHR=function(xhr,url,keysListItem,licenseChallenge){var _this11=this,licenseXhrSetup=this.config.licenseXhrSetup;return licenseXhrSetup?Promise.resolve().then((function(){if(!keysListItem.decryptdata)throw new Error("Key removed");return licenseXhrSetup.call(_this11.hls,xhr,url,keysListItem,licenseChallenge)})).catch((function(error){if(!keysListItem.decryptdata)throw error;return xhr.open("POST",url,!0),licenseXhrSetup.call(_this11.hls,xhr,url,keysListItem,licenseChallenge)})).then((function(licenseXhrSetupResult){return xhr.readyState||xhr.open("POST",url,!0),{xhr:xhr,licenseChallenge:licenseXhrSetupResult||licenseChallenge}})):(xhr.open("POST",url,!0),Promise.resolve({xhr:xhr,licenseChallenge:licenseChallenge}))},_proto.requestLicense=function(keySessionContext,licenseChallenge){var _this12=this,keyLoadPolicy=this.config.keyLoadPolicy.default;return new Promise((function(resolve,reject){var url=_this12.getLicenseServerUrl(keySessionContext.keySystem);_this12.log("Sending license request to URL: "+url);var xhr=new XMLHttpRequest;xhr.responseType="arraybuffer",xhr.onreadystatechange=function(){if(!_this12.hls||!keySessionContext.mediaKeysSession)return reject(new Error("invalid state"));if(4===xhr.readyState)if(200===xhr.status){_this12._requestLicenseFailureCount=0;var data=xhr.response;_this12.log("License received "+(data instanceof ArrayBuffer?data.byteLength:data));var licenseResponseCallback=_this12.config.licenseResponseCallback;if(licenseResponseCallback)try{data=licenseResponseCallback.call(_this12.hls,xhr,url,keySessionContext)}catch(error){_this12.error(error)}resolve(data)}else{var retryConfig=keyLoadPolicy.errorRetry,maxNumRetry=retryConfig?retryConfig.maxNumRetry:0;if(_this12._requestLicenseFailureCount++,_this12._requestLicenseFailureCount>maxNumRetry||xhr.status>=400&&xhr.status<500)reject(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:xhr,response:{url:url,data:void 0,code:xhr.status,text:xhr.statusText}},"License Request XHR failed ("+url+"). Status: "+xhr.status+" ("+xhr.statusText+")"));else{var attemptsLeft=maxNumRetry-_this12._requestLicenseFailureCount+1;_this12.warn("Retrying license request, "+attemptsLeft+" attempts left"),_this12.requestLicense(keySessionContext,licenseChallenge).then(resolve,reject)}}},keySessionContext.licenseXhr&&keySessionContext.licenseXhr.readyState!==XMLHttpRequest.DONE&&keySessionContext.licenseXhr.abort(),keySessionContext.licenseXhr=xhr,_this12.setupLicenseXHR(xhr,url,keySessionContext,licenseChallenge).then((function(_ref5){var xhr=_ref5.xhr,licenseChallenge=_ref5.licenseChallenge;keySessionContext.keySystem==KeySystems.PLAYREADY&&(licenseChallenge=_this12.unpackPlayReadyKeyMessage(xhr,licenseChallenge)),xhr.send(licenseChallenge)}))}))},_proto.onMediaAttached=function(event,data){if(this.config.emeEnabled){var media=data.media;this.media=media,media.addEventListener("encrypted",this.onMediaEncrypted),media.addEventListener("waitingforkey",this.onWaitingForKey)}},_proto.onMediaDetached=function(){var _this13=this,media=this.media,mediaKeysList=this.mediaKeySessions;media&&(media.removeEventListener("encrypted",this.onMediaEncrypted),media.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},LevelKey.clearKeyUriToKeyIdMap();var keySessionCount=mediaKeysList.length;EMEController.CDMCleanupPromise=Promise.all(mediaKeysList.map((function(mediaKeySessionContext){return _this13.removeSession(mediaKeySessionContext)})).concat(null==media?void 0:media.setMediaKeys(null).catch((function(error){_this13.log("Could not clear media keys: "+error)})))).then((function(){keySessionCount&&(_this13.log("finished closing key sessions and clearing media keys"),mediaKeysList.length=0)})).catch((function(error){_this13.log("Could not close sessions and clear media keys: "+error)}))},_proto.onManifestLoading=function(){this.keyFormatPromise=null},_proto.onManifestLoaded=function(event,_ref6){var sessionKeys=_ref6.sessionKeys;if(sessionKeys&&this.config.emeEnabled&&!this.keyFormatPromise){var keyFormats=sessionKeys.reduce((function(formats,sessionKey){return-1===formats.indexOf(sessionKey.keyFormat)&&formats.push(sessionKey.keyFormat),formats}),[]);this.log("Selecting key-system from session-keys "+keyFormats.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(keyFormats)}},_proto.removeSession=function(mediaKeySessionContext){var _this14=this,mediaKeysSession=mediaKeySessionContext.mediaKeysSession,licenseXhr=mediaKeySessionContext.licenseXhr;if(mediaKeysSession){this.log("Remove licenses and keys and close session "+mediaKeysSession.sessionId),mediaKeySessionContext._onmessage&&(mediaKeysSession.removeEventListener("message",mediaKeySessionContext._onmessage),mediaKeySessionContext._onmessage=void 0),mediaKeySessionContext._onkeystatuseschange&&(mediaKeysSession.removeEventListener("keystatuseschange",mediaKeySessionContext._onkeystatuseschange),mediaKeySessionContext._onkeystatuseschange=void 0),licenseXhr&&licenseXhr.readyState!==XMLHttpRequest.DONE&&licenseXhr.abort(),mediaKeySessionContext.mediaKeysSession=mediaKeySessionContext.decryptdata=mediaKeySessionContext.licenseXhr=void 0;var index=this.mediaKeySessions.indexOf(mediaKeySessionContext);return index>-1&&this.mediaKeySessions.splice(index,1),mediaKeysSession.remove().catch((function(error){_this14.log("Could not remove session: "+error)})).then((function(){return mediaKeysSession.close()})).catch((function(error){_this14.log("Could not close session: "+error)}))}},EMEController})();EMEController.CDMCleanupPromise=void 0;var CmObjectType,CmStreamingFormat,CmcdHeaderField,_CmcdHeaderMap,EMEKeyError=(function(_Error){function EMEKeyError(data,message){var _this15;return(_this15=_Error.call(this,message)||this).data=void 0,data.error||(data.error=new Error(message)),_this15.data=data,data.err=data.error,_this15}return _inheritsLoose(EMEKeyError,_Error),EMEKeyError})(_wrapNativeSuper(Error));(function(CmObjectType){CmObjectType.MANIFEST="m",CmObjectType.AUDIO="a",CmObjectType.VIDEO="v",CmObjectType.MUXED="av",CmObjectType.INIT="i",CmObjectType.CAPTION="c",CmObjectType.TIMED_TEXT="tt",CmObjectType.KEY="k",CmObjectType.OTHER="o"})(CmObjectType||(CmObjectType={})),(function(CmStreamingFormat){CmStreamingFormat.DASH="d",CmStreamingFormat.HLS="h",CmStreamingFormat.SMOOTH="s",CmStreamingFormat.OTHER="o"})(CmStreamingFormat||(CmStreamingFormat={})),(function(CmcdHeaderField){CmcdHeaderField.OBJECT="CMCD-Object",CmcdHeaderField.REQUEST="CMCD-Request",CmcdHeaderField.SESSION="CMCD-Session",CmcdHeaderField.STATUS="CMCD-Status"})(CmcdHeaderField||(CmcdHeaderField={}));var CmcdHeaderMap=((_CmcdHeaderMap={})[CmcdHeaderField.OBJECT]=["br","d","ot","tb"],_CmcdHeaderMap[CmcdHeaderField.REQUEST]=["bl","dl","mtp","nor","nrr","su"],_CmcdHeaderMap[CmcdHeaderField.SESSION]=["cid","pr","sf","sid","st","v"],_CmcdHeaderMap[CmcdHeaderField.STATUS]=["bs","rtp"],_CmcdHeaderMap),SfItem=function SfItem(value,params){this.value=void 0,this.params=void 0,Array.isArray(value)&&(value=value.map((function(v){return v instanceof SfItem?v:new SfItem(v)}))),this.value=value,this.params=params},SfToken=function(description){this.description=void 0,this.description=description},DICT="Dict";function format(value){return Array.isArray(value)?JSON.stringify(value):value instanceof Map?"Map{}":value instanceof Set?"Set{}":"object"==typeof value?JSON.stringify(value):String(value)}function throwError(action,src,type,cause){return new Error("failed to "+action+' "'+format(src)+'" as '+type,{cause:cause})}var BARE_ITEM="Bare Item",BOOLEAN="Boolean",BYTES="Byte Sequence",DECIMAL="Decimal",INTEGER="Integer";function isInvalidInt(value){return value<-999999999999999||999999999999999<value}var STRING_REGEX=/[\x00-\x1f\x7f]+/,TOKEN="Token",KEY="Key";function serializeError(src,type,cause){return throwError("serialize",src,type,cause)}function serializeBoolean(value){if("boolean"!=typeof value)throw serializeError(value,BOOLEAN);return value?"?1":"?0"}function base64encode(binary){return btoa(String.fromCharCode.apply(String,binary))}function serializeByteSequence(value){if(!1===ArrayBuffer.isView(value))throw serializeError(value,BYTES);return":"+base64encode(value)+":"}function serializeInteger(value){if(isInvalidInt(value))throw serializeError(value,INTEGER);return value.toString()}function serializeDate(value){return"@"+serializeInteger(value.getTime()/1e3)}function roundToEven(value,precision){if(value<0)return-roundToEven(-value,precision);var decimalShift=Math.pow(10,precision);if(Math.abs(value*decimalShift%1-.5)<Number.EPSILON){var flooredValue=Math.floor(value*decimalShift);return(flooredValue%2==0?flooredValue:flooredValue+1)/decimalShift}return Math.round(value*decimalShift)/decimalShift}function serializeDecimal(value){var roundedValue=roundToEven(value,3);if(Math.floor(Math.abs(roundedValue)).toString().length>12)throw serializeError(value,DECIMAL);var stringValue=roundedValue.toString();return stringValue.includes(".")?stringValue:stringValue+".0"}var STRING="String";function serializeString(value){if(STRING_REGEX.test(value))throw serializeError(value,STRING);return'"'+value.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'}function symbolToStr(symbol){return symbol.description||symbol.toString().slice(7,-1)}function serializeToken(token){var value=symbolToStr(token);if(!1===/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(value))throw serializeError(value,TOKEN);return value}function serializeBareItem(value){switch(typeof value){case"number":if(!isFiniteNumber(value))throw serializeError(value,BARE_ITEM);return Number.isInteger(value)?serializeInteger(value):serializeDecimal(value);case"string":return serializeString(value);case"symbol":return serializeToken(value);case"boolean":return serializeBoolean(value);case"object":if(value instanceof Date)return serializeDate(value);if(value instanceof Uint8Array)return serializeByteSequence(value);if(value instanceof SfToken)return serializeToken(value);default:throw serializeError(value,BARE_ITEM)}}function serializeKey(value){if(!1===/^[a-z*][a-z0-9\-_.*]*$/.test(value))throw serializeError(value,KEY);return value}function serializeParams(params){return null==params?"":Object.entries(params).map((function(_ref){var key=_ref[0],value=_ref[1];return!0===value?";"+serializeKey(key):";"+serializeKey(key)+"="+serializeBareItem(value)})).join("")}function serializeItem(value){return value instanceof SfItem?""+serializeBareItem(value.value)+serializeParams(value.params):serializeBareItem(value)}function serializeInnerList(value){return"("+value.value.map(serializeItem).join(" ")+")"+serializeParams(value.params)}function serializeDict(dict,options){var _options;if(void 0===options&&(options={whitespace:!0}),"object"!=typeof dict)throw serializeError(dict,DICT);var entries=dict instanceof Map?dict.entries():Object.entries(dict),optionalWhiteSpace=null!=(_options=options)&&_options.whitespace?" ":"";return Array.from(entries).map((function(_ref){var key=_ref[0],item=_ref[1];item instanceof SfItem==0&&(item=new SfItem(item));var output=serializeKey(key);return!0===item.value?output+=serializeParams(item.params):(output+="=",Array.isArray(item.value)?output+=serializeInnerList(item):output+=serializeItem(item)),output})).join(","+optionalWhiteSpace)}function encodeSfDict(value,options){return serializeDict(value,options)}var isTokenField=function(key){return"ot"===key||"sf"===key||"st"===key},isValid=function(value){return"number"==typeof value?isFiniteNumber(value):null!=value&&""!==value&&!1!==value};function urlToRelativePath(url,base){var to=new URL(url),from=new URL(base);if(to.origin!==from.origin)return url;for(var toPath=to.pathname.split("/").slice(1),fromPath=from.pathname.split("/").slice(1,-1);toPath[0]===fromPath[0];)toPath.shift(),fromPath.shift();for(;fromPath.length;)fromPath.shift(),toPath.unshift("..");return toPath.join("/")}function uuid(){try{return crypto.randomUUID()}catch(error){try{var url=URL.createObjectURL(new Blob),_uuid=url.toString();return URL.revokeObjectURL(url),_uuid.slice(_uuid.lastIndexOf("/")+1)}catch(error){var dt=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(c){var r=(dt+16*Math.random())%16|0;return dt=Math.floor(dt/16),("x"==c?r:3&r|8).toString(16)}))}}}var toRounded=function(value){return Math.round(value)},toHundred=function(value){return 100*toRounded(value/100)},CmcdFormatters={br:toRounded,d:toRounded,bl:toHundred,dl:toHundred,mtp:toHundred,nor:function(value,options){return null!=options&&options.baseUrl&&(value=urlToRelativePath(value,options.baseUrl)),encodeURIComponent(value)},rtp:toHundred,tb:toRounded};function processCmcd(obj,options){var results={};if(null==obj||"object"!=typeof obj)return results;var keys=Object.keys(obj).sort(),formatters=_extends({},CmcdFormatters,null==options?void 0:options.formatters),filter=null==options?void 0:options.filter;return keys.forEach((function(key){if(null==filter||!filter(key)){var value=obj[key],formatter=formatters[key];formatter&&(value=formatter(value,options)),"v"===key&&1===value||"pr"==key&&1===value||isValid(value)&&(isTokenField(key)&&"string"==typeof value&&(value=new SfToken(value)),results[key]=value)}})),results}function encodeCmcd(cmcd,options){return void 0===options&&(options={}),cmcd?encodeSfDict(processCmcd(cmcd,options),_extends({whitespace:!1},options)):""}function toCmcdHeaders(cmcd,options){var _options;if(void 0===options&&(options={}),!cmcd)return{};var entries=Object.entries(cmcd),headerMap=Object.entries(CmcdHeaderMap).concat(Object.entries((null==(_options=options)?void 0:_options.customHeaderMap)||{})),shards=entries.reduce((function(acc,entry){var _headerMap$find,key=entry[0],value=entry[1],field=(null==(_headerMap$find=headerMap.find((function(entry){return entry[1].includes(key)})))?void 0:_headerMap$find[0])||CmcdHeaderField.REQUEST;return null!=acc[field]||(acc[field]={}),acc[field][key]=value,acc}),{});return Object.entries(shards).reduce((function(acc,_ref){var field=_ref[0],value=_ref[1];return acc[field]=encodeCmcd(value,options),acc}),{})}function appendCmcdHeaders(headers,cmcd,options){return _extends(headers,toCmcdHeaders(cmcd,options))}var CMCD_PARAM="CMCD";function toCmcdQuery(cmcd,options){if(void 0===options&&(options={}),!cmcd)return"";var params=encodeCmcd(cmcd,options);return CMCD_PARAM+"="+encodeURIComponent(params)}var REGEX=/CMCD=[^&#]+/;function appendCmcdQuery(url,cmcd,options){var query=toCmcdQuery(cmcd,options);if(!query)return url;if(REGEX.test(url))return url.replace(REGEX,query);var separator=url.includes("?")?"&":"?";return""+url+separator+query}var CMCDController=(function(){function CMCDController(hls){var _this=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){_this.initialized&&(_this.starved=!0),_this.buffering=!0},this.onPlaying=function(){_this.initialized||(_this.initialized=!0),_this.buffering=!1},this.applyPlaylistData=function(context){try{_this.apply(context,{ot:CmObjectType.MANIFEST,su:!_this.initialized})}catch(error){logger.warn("Could not generate manifest CMCD data.",error)}},this.applyFragmentData=function(context){try{var fragment=context.frag,level=_this.hls.levels[fragment.level],ot=_this.getObjectType(fragment),data={d:1e3*fragment.duration,ot:ot};ot!==CmObjectType.VIDEO&&ot!==CmObjectType.AUDIO&&ot!=CmObjectType.MUXED||(data.br=level.bitrate/1e3,data.tb=_this.getTopBandwidth(ot)/1e3,data.bl=_this.getBufferLength(ot)),_this.apply(context,data)}catch(error){logger.warn("Could not generate segment CMCD data.",error)}},this.hls=hls;var config=this.config=hls.config,cmcd=config.cmcd;null!=cmcd&&(config.pLoader=this.createPlaylistLoader(),config.fLoader=this.createFragmentLoader(),this.sid=cmcd.sessionId||uuid(),this.cid=cmcd.contentId,this.useHeaders=!0===cmcd.useHeaders,this.includeKeys=cmcd.includeKeys,this.registerListeners())}var _proto=CMCDController.prototype;return _proto.registerListeners=function(){var hls=this.hls;hls.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),hls.on(Events.MEDIA_DETACHED,this.onMediaDetached,this),hls.on(Events.BUFFER_CREATED,this.onBufferCreated,this)},_proto.unregisterListeners=function(){var hls=this.hls;hls.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),hls.off(Events.MEDIA_DETACHED,this.onMediaDetached,this),hls.off(Events.BUFFER_CREATED,this.onBufferCreated,this)},_proto.destroy=function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=null},_proto.onMediaAttached=function(event,data){this.media=data.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},_proto.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},_proto.onBufferCreated=function(event,data){var _data$tracks$audio,_data$tracks$video;this.audioBuffer=null==(_data$tracks$audio=data.tracks.audio)?void 0:_data$tracks$audio.buffer,this.videoBuffer=null==(_data$tracks$video=data.tracks.video)?void 0:_data$tracks$video.buffer},_proto.createData=function(){var _this$media;return{v:1,sf:CmStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:null==(_this$media=this.media)?void 0:_this$media.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},_proto.apply=function(context,data){void 0===data&&(data={}),_extends(data,this.createData());var isVideo=data.ot===CmObjectType.INIT||data.ot===CmObjectType.VIDEO||data.ot===CmObjectType.MUXED;this.starved&&isVideo&&(data.bs=!0,data.su=!0,this.starved=!1),null==data.su&&(data.su=this.buffering);var includeKeys=this.includeKeys;includeKeys&&(data=Object.keys(data).reduce((function(acc,key){return includeKeys.includes(key)&&(acc[key]=data[key]),acc}),{})),this.useHeaders?(context.headers||(context.headers={}),appendCmcdHeaders(context.headers,data)):context.url=appendCmcdQuery(context.url,data)},_proto.getObjectType=function(fragment){var type=fragment.type;return"subtitle"===type?CmObjectType.TIMED_TEXT:"initSegment"===fragment.sn?CmObjectType.INIT:"audio"===type?CmObjectType.AUDIO:"main"===type?this.hls.audioTracks.length?CmObjectType.VIDEO:CmObjectType.MUXED:void 0},_proto.getTopBandwidth=function(type){var levels,bitrate=0,hls=this.hls;if(type===CmObjectType.AUDIO)levels=hls.audioTracks;else{var max=hls.maxAutoLevel,len=max>-1?max+1:hls.levels.length;levels=hls.levels.slice(0,len)}for(var _step,_iterator=_createForOfIteratorHelperLoose(levels);!(_step=_iterator()).done;){var level=_step.value;level.bitrate>bitrate&&(bitrate=level.bitrate)}return bitrate>0?bitrate:NaN},_proto.getBufferLength=function(type){var media=this.hls.media,buffer=type===CmObjectType.AUDIO?this.audioBuffer:this.videoBuffer;return buffer&&media?1e3*BufferHelper.bufferInfo(buffer,media.currentTime,this.config.maxBufferHole).len:NaN},_proto.createPlaylistLoader=function(){var pLoader=this.config.pLoader,apply=this.applyPlaylistData,Ctor=pLoader||this.config.loader;return(function(){function CmcdPlaylistLoader(config){this.loader=void 0,this.loader=new Ctor(config)}var _proto2=CmcdPlaylistLoader.prototype;return _proto2.destroy=function(){this.loader.destroy()},_proto2.abort=function(){this.loader.abort()},_proto2.load=function(context,config,callbacks){apply(context),this.loader.load(context,config,callbacks)},_createClass(CmcdPlaylistLoader,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),CmcdPlaylistLoader})()},_proto.createFragmentLoader=function(){var fLoader=this.config.fLoader,apply=this.applyFragmentData,Ctor=fLoader||this.config.loader;return(function(){function CmcdFragmentLoader(config){this.loader=void 0,this.loader=new Ctor(config)}var _proto3=CmcdFragmentLoader.prototype;return _proto3.destroy=function(){this.loader.destroy()},_proto3.abort=function(){this.loader.abort()},_proto3.load=function(context,config,callbacks){apply(context),this.loader.load(context,config,callbacks)},_createClass(CmcdFragmentLoader,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),CmcdFragmentLoader})()},CMCDController})(),PATHWAY_PENALTY_DURATION_MS=3e5,ContentSteeringController=(function(){function ContentSteeringController(hls){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=hls,this.log=logger.log.bind(logger,"[content-steering]:"),this.registerListeners()}var _proto=ContentSteeringController.prototype;return _proto.registerListeners=function(){var hls=this.hls;hls.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),hls.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),hls.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),hls.on(Events.ERROR,this.onError,this)},_proto.unregisterListeners=function(){var hls=this.hls;hls&&(hls.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),hls.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),hls.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),hls.off(Events.ERROR,this.onError,this))},_proto.startLoad=function(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){var ttl=1e3*this.timeToLoad-(performance.now()-this.updated);if(ttl>0)return void this.scheduleRefresh(this.uri,ttl)}this.loadSteeringManifest(this.uri)}},_proto.stopLoad=function(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()},_proto.clearTimeout=function(){-1!==this.reloadTimer&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)},_proto.destroy=function(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null},_proto.removeLevel=function(levelToRemove){var levels=this.levels;levels&&(this.levels=levels.filter((function(level){return level!==levelToRemove})))},_proto.onManifestLoading=function(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null},_proto.onManifestLoaded=function(event,data){var contentSteering=data.contentSteering;null!==contentSteering&&(this.pathwayId=contentSteering.pathwayId,this.uri=contentSteering.uri,this.started&&this.startLoad())},_proto.onManifestParsed=function(event,data){this.audioTracks=data.audioTracks,this.subtitleTracks=data.subtitleTracks},_proto.onError=function(event,data){var errorAction=data.errorAction;if((null==errorAction?void 0:errorAction.action)===NetworkErrorAction.SendAlternateToPenaltyBox&&errorAction.flags===ErrorActionFlags.MoveAllAlternatesMatchingHost){var levels=this.levels,pathwayPriority=this.pathwayPriority,errorPathway=this.pathwayId;if(data.context){var _data$context=data.context,groupId=_data$context.groupId,_pathwayId=_data$context.pathwayId,type=_data$context.type;groupId&&levels?errorPathway=this.getPathwayForGroupId(groupId,type,errorPathway):_pathwayId&&(errorPathway=_pathwayId)}errorPathway in this.penalizedPathways||(this.penalizedPathways[errorPathway]=performance.now()),!pathwayPriority&&levels&&(pathwayPriority=levels.reduce((function(pathways,level){return-1===pathways.indexOf(level.pathwayId)&&pathways.push(level.pathwayId),pathways}),[])),pathwayPriority&&pathwayPriority.length>1&&(this.updatePathwayPriority(pathwayPriority),errorAction.resolved=this.pathwayId!==errorPathway),errorAction.resolved||logger.warn("Could not resolve "+data.details+' ("'+data.error.message+'") with content-steering for Pathway: '+errorPathway+" levels: "+(levels?levels.length:levels)+" priorities: "+JSON.stringify(pathwayPriority)+" penalized: "+JSON.stringify(this.penalizedPathways))}},_proto.filterParsedLevels=function(levels){this.levels=levels;var pathwayLevels=this.getLevelsForPathway(this.pathwayId);if(0===pathwayLevels.length){var _pathwayId2=levels[0].pathwayId;this.log("No levels found in Pathway "+this.pathwayId+'. Setting initial Pathway to "'+_pathwayId2+'"'),pathwayLevels=this.getLevelsForPathway(_pathwayId2),this.pathwayId=_pathwayId2}return pathwayLevels.length!==levels.length?(this.log("Found "+pathwayLevels.length+"/"+levels.length+' levels in Pathway "'+this.pathwayId+'"'),pathwayLevels):levels},_proto.getLevelsForPathway=function(pathwayId){return null===this.levels?[]:this.levels.filter((function(level){return pathwayId===level.pathwayId}))},_proto.updatePathwayPriority=function(pathwayPriority){var levels;this.pathwayPriority=pathwayPriority;var penalizedPathways=this.penalizedPathways,now=performance.now();Object.keys(penalizedPathways).forEach((function(pathwayId){now-penalizedPathways[pathwayId]>PATHWAY_PENALTY_DURATION_MS&&delete penalizedPathways[pathwayId]}));for(var i=0;i<pathwayPriority.length;i++){var _pathwayId3=pathwayPriority[i];if(!(_pathwayId3 in penalizedPathways)){if(_pathwayId3===this.pathwayId)return;var selectedIndex=this.hls.nextLoadLevel,selectedLevel=this.hls.levels[selectedIndex];if((levels=this.getLevelsForPathway(_pathwayId3)).length>0){this.log('Setting Pathway to "'+_pathwayId3+'"'),this.pathwayId=_pathwayId3,reassignFragmentLevelIndexes(levels),this.hls.trigger(Events.LEVELS_UPDATED,{levels:levels});var levelAfterChange=this.hls.levels[selectedIndex];selectedLevel&&levelAfterChange&&this.levels&&(levelAfterChange.attrs["STABLE-VARIANT-ID"]!==selectedLevel.attrs["STABLE-VARIANT-ID"]&&levelAfterChange.bitrate!==selectedLevel.bitrate&&this.log("Unstable Pathways change from bitrate "+selectedLevel.bitrate+" to "+levelAfterChange.bitrate),this.hls.nextLoadLevel=selectedIndex);break}}}},_proto.getPathwayForGroupId=function(groupId,type,defaultPathway){for(var levels=this.getLevelsForPathway(defaultPathway).concat(this.levels||[]),i=0;i<levels.length;i++)if(type===PlaylistContextType.AUDIO_TRACK&&levels[i].hasAudioGroup(groupId)||type===PlaylistContextType.SUBTITLE_TRACK&&levels[i].hasSubtitleGroup(groupId))return levels[i].pathwayId;return defaultPathway},_proto.clonePathways=function(pathwayClones){var _this=this,levels=this.levels;if(levels){var audioGroupCloneMap={},subtitleGroupCloneMap={};pathwayClones.forEach((function(pathwayClone){var cloneId=pathwayClone.ID,baseId=pathwayClone["BASE-ID"],uriReplacement=pathwayClone["URI-REPLACEMENT"];if(!levels.some((function(level){return level.pathwayId===cloneId}))){var clonedVariants=_this.getLevelsForPathway(baseId).map((function(baseLevel){var attributes=new AttrList(baseLevel.attrs);attributes["PATHWAY-ID"]=cloneId;var clonedAudioGroupId=attributes.AUDIO&&attributes.AUDIO+"_clone_"+cloneId,clonedSubtitleGroupId=attributes.SUBTITLES&&attributes.SUBTITLES+"_clone_"+cloneId;clonedAudioGroupId&&(audioGroupCloneMap[attributes.AUDIO]=clonedAudioGroupId,attributes.AUDIO=clonedAudioGroupId),clonedSubtitleGroupId&&(subtitleGroupCloneMap[attributes.SUBTITLES]=clonedSubtitleGroupId,attributes.SUBTITLES=clonedSubtitleGroupId);var url=performUriReplacement(baseLevel.uri,attributes["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",uriReplacement),clonedLevel=new Level({attrs:attributes,audioCodec:baseLevel.audioCodec,bitrate:baseLevel.bitrate,height:baseLevel.height,name:baseLevel.name,url:url,videoCodec:baseLevel.videoCodec,width:baseLevel.width});if(baseLevel.audioGroups)for(var i=1;i<baseLevel.audioGroups.length;i++)clonedLevel.addGroupId("audio",baseLevel.audioGroups[i]+"_clone_"+cloneId);if(baseLevel.subtitleGroups)for(var _i=1;_i<baseLevel.subtitleGroups.length;_i++)clonedLevel.addGroupId("text",baseLevel.subtitleGroups[_i]+"_clone_"+cloneId);return clonedLevel}));levels.push.apply(levels,clonedVariants),cloneRenditionGroups(_this.audioTracks,audioGroupCloneMap,uriReplacement,cloneId),cloneRenditionGroups(_this.subtitleTracks,subtitleGroupCloneMap,uriReplacement,cloneId)}}))}},_proto.loadSteeringManifest=function(uri){var url,_this2=this,config=this.hls.config,Loader=config.loader;this.loader&&this.loader.destroy(),this.loader=new Loader(config);try{url=new self.URL(uri)}catch(error){return this.enabled=!1,void this.log("Failed to parse Steering Manifest URI: "+uri)}if("data:"!==url.protocol){var throughput=0|(this.hls.bandwidthEstimate||config.abrEwmaDefaultEstimate);url.searchParams.set("_HLS_pathway",this.pathwayId),url.searchParams.set("_HLS_throughput",""+throughput)}var context={responseType:"json",url:url.href},loadPolicy=config.steeringManifestLoadPolicy.default,legacyRetryCompatibility=loadPolicy.errorRetry||loadPolicy.timeoutRetry||{},loaderConfig={loadPolicy:loadPolicy,timeout:loadPolicy.maxLoadTimeMs,maxRetry:legacyRetryCompatibility.maxNumRetry||0,retryDelay:legacyRetryCompatibility.retryDelayMs||0,maxRetryDelay:legacyRetryCompatibility.maxRetryDelayMs||0},callbacks={onSuccess:function(response,stats,context,networkDetails){_this2.log('Loaded steering manifest: "'+url+'"');var steeringData=response.data;if(1===steeringData.VERSION){_this2.updated=performance.now(),_this2.timeToLoad=steeringData.TTL;var reloadUri=steeringData["RELOAD-URI"],pathwayClones=steeringData["PATHWAY-CLONES"],pathwayPriority=steeringData["PATHWAY-PRIORITY"];if(reloadUri)try{_this2.uri=new self.URL(reloadUri,url).href}catch(error){return _this2.enabled=!1,void _this2.log("Failed to parse Steering Manifest RELOAD-URI: "+reloadUri)}_this2.scheduleRefresh(_this2.uri||context.url),pathwayClones&&_this2.clonePathways(pathwayClones);var loadedSteeringData={steeringManifest:steeringData,url:url.toString()};_this2.hls.trigger(Events.STEERING_MANIFEST_LOADED,loadedSteeringData),pathwayPriority&&_this2.updatePathwayPriority(pathwayPriority)}else _this2.log("Steering VERSION "+steeringData.VERSION+" not supported!")},onError:function(error,context,networkDetails,stats){if(_this2.log("Error loading steering manifest: "+error.code+" "+error.text+" ("+context.url+")"),_this2.stopLoad(),410===error.code)return _this2.enabled=!1,void _this2.log("Steering manifest "+context.url+" no longer available");var ttl=1e3*_this2.timeToLoad;if(429!==error.code)_this2.scheduleRefresh(_this2.uri||context.url,ttl);else{var loader=_this2.loader;if("function"==typeof(null==loader?void 0:loader.getResponseHeader)){var retryAfter=loader.getResponseHeader("Retry-After");retryAfter&&(ttl=1e3*parseFloat(retryAfter))}_this2.log("Steering manifest "+context.url+" rate limited")}},onTimeout:function(stats,context,networkDetails){_this2.log("Timeout loading steering manifest ("+context.url+")"),_this2.scheduleRefresh(_this2.uri||context.url)}};this.log("Requesting steering manifest: "+url),this.loader.load(context,loaderConfig,callbacks)},_proto.scheduleRefresh=function(uri,ttlMs){var _this3=this;void 0===ttlMs&&(ttlMs=1e3*this.timeToLoad),this.clearTimeout(),this.reloadTimer=self.setTimeout((function(){var _this3$hls,media=null==(_this3$hls=_this3.hls)?void 0:_this3$hls.media;!media||media.ended?_this3.scheduleRefresh(uri,1e3*_this3.timeToLoad):_this3.loadSteeringManifest(uri)}),ttlMs)},ContentSteeringController})();function cloneRenditionGroups(tracks,groupCloneMap,uriReplacement,cloneId){tracks&&Object.keys(groupCloneMap).forEach((function(audioGroupId){var clonedTracks=tracks.filter((function(track){return track.groupId===audioGroupId})).map((function(track){var clonedTrack=_extends({},track);return clonedTrack.details=void 0,clonedTrack.attrs=new AttrList(clonedTrack.attrs),clonedTrack.url=clonedTrack.attrs.URI=performUriReplacement(track.url,track.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",uriReplacement),clonedTrack.groupId=clonedTrack.attrs["GROUP-ID"]=groupCloneMap[audioGroupId],clonedTrack.attrs["PATHWAY-ID"]=cloneId,clonedTrack}));tracks.push.apply(tracks,clonedTracks)}))}function performUriReplacement(uri,stableId,perOptionKey,uriReplacement){var perVariantUri,host=uriReplacement.HOST,params=uriReplacement.PARAMS,perOptionUris=uriReplacement[perOptionKey];stableId&&(perVariantUri=null==perOptionUris?void 0:perOptionUris[stableId])&&(uri=perVariantUri);var url=new self.URL(uri);return host&&!perVariantUri&&(url.host=host),params&&Object.keys(params).sort().forEach((function(key){key&&url.searchParams.set(key,params[key])})),url.href}var AGE_HEADER_LINE_REGEX=/^age:\s*[\d.]+\s*$/im,XhrLoader=(function(){function XhrLoader(config){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=config&&config.xhrSetup||null,this.stats=new LoadStats,this.retryDelay=0}var _proto=XhrLoader.prototype;return _proto.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null,this.stats=null},_proto.abortInternal=function(){var loader=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),loader&&(loader.onreadystatechange=null,loader.onprogress=null,4!==loader.readyState&&(this.stats.aborted=!0,loader.abort()))},_proto.abort=function(){var _this$callbacks;this.abortInternal(),null!=(_this$callbacks=this.callbacks)&&_this$callbacks.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},_proto.load=function(context,config,callbacks){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=context,this.config=config,this.callbacks=callbacks,this.loadInternal()},_proto.loadInternal=function(){var _this=this,config=this.config,context=this.context;if(config&&context){var xhr=this.loader=new self.XMLHttpRequest,stats=this.stats;stats.loading.first=0,stats.loaded=0,stats.aborted=!1;var xhrSetup=this.xhrSetup;xhrSetup?Promise.resolve().then((function(){if(!_this.stats.aborted)return xhrSetup(xhr,context.url)})).catch((function(error){return xhr.open("GET",context.url,!0),xhrSetup(xhr,context.url)})).then((function(){_this.stats.aborted||_this.openAndSendXhr(xhr,context,config)})).catch((function(error){_this.callbacks.onError({code:xhr.status,text:error.message},context,xhr,stats)})):this.openAndSendXhr(xhr,context,config)}},_proto.openAndSendXhr=function(xhr,context,config){xhr.readyState||xhr.open("GET",context.url,!0);var headers=context.headers,_config$loadPolicy=config.loadPolicy,maxTimeToFirstByteMs=_config$loadPolicy.maxTimeToFirstByteMs,maxLoadTimeMs=_config$loadPolicy.maxLoadTimeMs;if(headers)for(var header in headers)xhr.setRequestHeader(header,headers[header]);context.rangeEnd&&xhr.setRequestHeader("Range","bytes="+context.rangeStart+"-"+(context.rangeEnd-1)),xhr.onreadystatechange=this.readystatechange.bind(this),xhr.onprogress=this.loadprogress.bind(this),xhr.responseType=context.responseType,self.clearTimeout(this.requestTimeout),config.timeout=maxTimeToFirstByteMs&&isFiniteNumber(maxTimeToFirstByteMs)?maxTimeToFirstByteMs:maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),config.timeout),xhr.send()},_proto.readystatechange=function(){var context=this.context,xhr=this.loader,stats=this.stats;if(context&&xhr){var readyState=xhr.readyState,config=this.config;if(!stats.aborted&&readyState>=2&&(0===stats.loading.first&&(stats.loading.first=Math.max(self.performance.now(),stats.loading.start),config.timeout!==config.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),config.timeout=config.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),config.loadPolicy.maxLoadTimeMs-(stats.loading.first-stats.loading.start)))),4===readyState)){self.clearTimeout(this.requestTimeout),xhr.onreadystatechange=null,xhr.onprogress=null;var _status=xhr.status,useResponse="text"!==xhr.responseType;if(_status>=200&&_status<300&&(useResponse&&xhr.response||null!==xhr.responseText)){stats.loading.end=Math.max(self.performance.now(),stats.loading.first);var data=useResponse?xhr.response:xhr.responseText,len="arraybuffer"===xhr.responseType?data.byteLength:data.length;if(stats.loaded=stats.total=len,stats.bwEstimate=8e3*stats.total/(stats.loading.end-stats.loading.first),!this.callbacks)return;var onProgress=this.callbacks.onProgress;if(onProgress&&onProgress(stats,context,data,xhr),!this.callbacks)return;var response={url:xhr.responseURL,data:data,code:_status};this.callbacks.onSuccess(response,stats,context,xhr)}else{var retryConfig=config.loadPolicy.errorRetry;shouldRetry(retryConfig,stats.retry,!1,{url:context.url,data:void 0,code:_status})?this.retry(retryConfig):(logger.error(_status+" while loading "+context.url),this.callbacks.onError({code:_status,text:xhr.statusText},context,xhr,stats))}}}},_proto.loadtimeout=function(){var _this$config,retryConfig=null==(_this$config=this.config)?void 0:_this$config.loadPolicy.timeoutRetry;if(shouldRetry(retryConfig,this.stats.retry,!0))this.retry(retryConfig);else{var _this$context;logger.warn("timeout while loading "+(null==(_this$context=this.context)?void 0:_this$context.url));var callbacks=this.callbacks;callbacks&&(this.abortInternal(),callbacks.onTimeout(this.stats,this.context,this.loader))}},_proto.retry=function(retryConfig){var context=this.context,stats=this.stats;this.retryDelay=getRetryDelay(retryConfig,stats.retry),stats.retry++,logger.warn((status?"HTTP Status "+status:"Timeout")+" while loading "+(null==context?void 0:context.url)+", retrying "+stats.retry+"/"+retryConfig.maxNumRetry+" in "+this.retryDelay+"ms"),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)},_proto.loadprogress=function(event){var stats=this.stats;stats.loaded=event.loaded,event.lengthComputable&&(stats.total=event.total)},_proto.getCacheAge=function(){var result=null;if(this.loader&&AGE_HEADER_LINE_REGEX.test(this.loader.getAllResponseHeaders())){var ageHeader=this.loader.getResponseHeader("age");result=ageHeader?parseFloat(ageHeader):null}return result},_proto.getResponseHeader=function(name){return this.loader&&new RegExp("^"+name+":\\s*[\\d.]+\\s*$","im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(name):null},XhrLoader})();function fetchSupported(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1}var BYTERANGE=/(\d+)-(\d+)\/(\d+)/,FetchLoader=(function(){function FetchLoader(config){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=config.fetchSetup||getRequest,this.controller=new self.AbortController,this.stats=new LoadStats}var _proto=FetchLoader.prototype;return _proto.destroy=function(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null},_proto.abortInternal=function(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())},_proto.abort=function(){var _this$callbacks;this.abortInternal(),null!=(_this$callbacks=this.callbacks)&&_this$callbacks.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},_proto.load=function(context,config,callbacks){var _this=this,stats=this.stats;if(stats.loading.start)throw new Error("Loader can only be used once.");stats.loading.start=self.performance.now();var initParams=getRequestParameters(context,this.controller.signal),onProgress=callbacks.onProgress,isArrayBuffer="arraybuffer"===context.responseType,LENGTH=isArrayBuffer?"byteLength":"length",_config$loadPolicy=config.loadPolicy,maxTimeToFirstByteMs=_config$loadPolicy.maxTimeToFirstByteMs,maxLoadTimeMs=_config$loadPolicy.maxLoadTimeMs;this.context=context,this.config=config,this.callbacks=callbacks,this.request=this.fetchSetup(context,initParams),self.clearTimeout(this.requestTimeout),config.timeout=maxTimeToFirstByteMs&&isFiniteNumber(maxTimeToFirstByteMs)?maxTimeToFirstByteMs:maxLoadTimeMs,this.requestTimeout=self.setTimeout((function(){_this.abortInternal(),callbacks.onTimeout(stats,context,_this.response)}),config.timeout),self.fetch(this.request).then((function(response){_this.response=_this.loader=response;var first=Math.max(self.performance.now(),stats.loading.start);if(self.clearTimeout(_this.requestTimeout),config.timeout=maxLoadTimeMs,_this.requestTimeout=self.setTimeout((function(){_this.abortInternal(),callbacks.onTimeout(stats,context,_this.response)}),maxLoadTimeMs-(first-stats.loading.start)),!response.ok){var status=response.status,statusText=response.statusText;throw new FetchError(statusText||"fetch, bad network response",status,response)}return stats.loading.first=first,stats.total=getContentLength(response.headers)||stats.total,onProgress&&isFiniteNumber(config.highWaterMark)?_this.loadProgressively(response,stats,context,config.highWaterMark,onProgress):isArrayBuffer?response.arrayBuffer():"json"===context.responseType?response.json():response.text()})).then((function(responseData){var response=_this.response;if(!response)throw new Error("loader destroyed");self.clearTimeout(_this.requestTimeout),stats.loading.end=Math.max(self.performance.now(),stats.loading.first);var total=responseData[LENGTH];total&&(stats.loaded=stats.total=total);var loaderResponse={url:response.url,data:responseData,code:response.status};onProgress&&!isFiniteNumber(config.highWaterMark)&&onProgress(stats,context,responseData,response),callbacks.onSuccess(loaderResponse,stats,context,response)})).catch((function(error){if(self.clearTimeout(_this.requestTimeout),!stats.aborted){var code=error&&error.code||0,text=error?error.message:null;callbacks.onError({code:code,text:text},context,error?error.details:null,stats)}}))},_proto.getCacheAge=function(){var result=null;if(this.response){var ageHeader=this.response.headers.get("age");result=ageHeader?parseFloat(ageHeader):null}return result},_proto.getResponseHeader=function(name){return this.response?this.response.headers.get(name):null},_proto.loadProgressively=function(response,stats,context,highWaterMark,onProgress){void 0===highWaterMark&&(highWaterMark=0);var chunkCache=new ChunkCache,reader=response.body.getReader();return(function pump(){return reader.read().then((function(data){if(data.done)return chunkCache.dataLength&&onProgress(stats,context,chunkCache.flush(),response),Promise.resolve(new ArrayBuffer(0));var chunk=data.value,len=chunk.length;return stats.loaded+=len,len<highWaterMark||chunkCache.dataLength?(chunkCache.push(chunk),chunkCache.dataLength>=highWaterMark&&onProgress(stats,context,chunkCache.flush(),response)):onProgress(stats,context,chunk,response),pump()})).catch((function(){return Promise.reject()}))})()},FetchLoader})();function getRequestParameters(context,signal){var initParams={method:"GET",mode:"cors",credentials:"same-origin",signal:signal,headers:new self.Headers(_extends({},context.headers))};return context.rangeEnd&&initParams.headers.set("Range","bytes="+context.rangeStart+"-"+String(context.rangeEnd-1)),initParams}function getByteRangeLength(byteRangeHeader){var result=BYTERANGE.exec(byteRangeHeader);if(result)return parseInt(result[2])-parseInt(result[1])+1}function getContentLength(headers){var contentRange=headers.get("Content-Range");if(contentRange){var byteRangeLength=getByteRangeLength(contentRange);if(isFiniteNumber(byteRangeLength))return byteRangeLength}var contentLength=headers.get("Content-Length");if(contentLength)return parseInt(contentLength)}function getRequest(context,initParams){return new self.Request(context.url,initParams)}var chromeOrFirefox,FetchError=(function(_Error){function FetchError(message,code,details){var _this2;return(_this2=_Error.call(this,message)||this).code=void 0,_this2.details=void 0,_this2.code=code,_this2.details=details,_this2}return _inheritsLoose(FetchError,_Error),FetchError})(_wrapNativeSuper(Error)),WHITESPACE_CHAR=/\s/,Cues={newCue:function(track,startTime,endTime,captionScreen){for(var row,cue,indenting,indent,text,result=[],Cue=self.VTTCue||self.TextTrackCue,r=0;r<captionScreen.rows.length;r++)if(indenting=!0,indent=0,text="",!(row=captionScreen.rows[r]).isEmpty()){for(var _track$cues,c=0;c<row.chars.length;c++)WHITESPACE_CHAR.test(row.chars[c].uchar)&&indenting?indent++:(text+=row.chars[c].uchar,indenting=!1);row.cueStartTime=startTime,startTime===endTime&&(endTime+=1e-4),indent>=16?indent--:indent++;var cueText=fixLineBreaks(text.trim()),id=generateCueId(startTime,endTime,cueText);null!=track&&null!=(_track$cues=track.cues)&&_track$cues.getCueById(id)||((cue=new Cue(startTime,endTime,cueText)).id=id,cue.line=r+1,cue.align="left",cue.position=10+Math.min(80,10*Math.floor(8*indent/32)),result.push(cue))}return track&&result.length&&(result.sort((function(cueA,cueB){return"auto"===cueA.line||"auto"===cueB.line?0:cueA.line>8&&cueB.line>8?cueB.line-cueA.line:cueA.line-cueB.line})),result.forEach((function(cue){return addCueToTrack(track,cue)}))),result}},hlsDefaultConfig=_objectSpread2(_objectSpread2({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:XhrLoader,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:AbrController,bufferController:BufferController,capLevelController:CapLevelController,errorController:ErrorController,fpsController:FPSController,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,useMediaCapabilities:!0,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},timelineConfig()),{},{subtitleStreamController:SubtitleStreamController,subtitleTrackController:SubtitleTrackController,timelineController:TimelineController,audioStreamController:AudioStreamController,audioTrackController:AudioTrackController,emeController:EMEController,cmcdController:CMCDController,contentSteeringController:ContentSteeringController});function timelineConfig(){return{cueHandler:Cues,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function mergeConfig(defaultConfig,userConfig){if((userConfig.liveSyncDurationCount||userConfig.liveMaxLatencyDurationCount)&&(userConfig.liveSyncDuration||userConfig.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==userConfig.liveMaxLatencyDurationCount&&(void 0===userConfig.liveSyncDurationCount||userConfig.liveMaxLatencyDurationCount<=userConfig.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==userConfig.liveMaxLatencyDuration&&(void 0===userConfig.liveSyncDuration||userConfig.liveMaxLatencyDuration<=userConfig.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');var defaultsCopy=deepCpy(defaultConfig),deprecatedSettings=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach((function(type){var policyName=("level"===type?"playlist":type)+"LoadPolicy",policyNotSet=void 0===userConfig[policyName],report=[];deprecatedSettings.forEach((function(setting){var deprecatedSetting=type+"Loading"+setting,value=userConfig[deprecatedSetting];if(void 0!==value&&policyNotSet){report.push(deprecatedSetting);var settings=defaultsCopy[policyName].default;switch(userConfig[policyName]={default:settings},setting){case"TimeOut":settings.maxLoadTimeMs=value,settings.maxTimeToFirstByteMs=value;break;case"MaxRetry":settings.errorRetry.maxNumRetry=value,settings.timeoutRetry.maxNumRetry=value;break;case"RetryDelay":settings.errorRetry.retryDelayMs=value,settings.timeoutRetry.retryDelayMs=value;break;case"MaxRetryTimeout":settings.errorRetry.maxRetryDelayMs=value,settings.timeoutRetry.maxRetryDelayMs=value}}})),report.length&&logger.warn('hls.js config: "'+report.join('", "')+'" setting(s) are deprecated, use "'+policyName+'": '+JSON.stringify(userConfig[policyName]))})),_objectSpread2(_objectSpread2({},defaultsCopy),userConfig)}function deepCpy(obj){return obj&&"object"==typeof obj?Array.isArray(obj)?obj.map(deepCpy):Object.keys(obj).reduce((function(result,key){return result[key]=deepCpy(obj[key]),result}),{}):obj}function enableStreamingMode(config){var currentLoader=config.loader;currentLoader!==FetchLoader&&currentLoader!==XhrLoader?(logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),config.progressive=!1):fetchSupported()&&(config.loader=FetchLoader,config.progressive=!0,config.enableSoftwareAES=!0,logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}var LevelController=(function(_BasePlaylistControll){function LevelController(hls,contentSteeringController){var _this;return(_this=_BasePlaylistControll.call(this,hls,"[level-controller]")||this)._levels=[],_this._firstLevel=-1,_this._maxAutoLevel=-1,_this._startLevel=void 0,_this.currentLevel=null,_this.currentLevelIndex=-1,_this.manualLevelIndex=-1,_this.steering=void 0,_this.onParsedComplete=void 0,_this.steering=contentSteeringController,_this._registerListeners(),_this}_inheritsLoose(LevelController,_BasePlaylistControll);var _proto=LevelController.prototype;return _proto._registerListeners=function(){var hls=this.hls;hls.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),hls.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),hls.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),hls.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),hls.on(Events.FRAG_BUFFERED,this.onFragBuffered,this),hls.on(Events.ERROR,this.onError,this)},_proto._unregisterListeners=function(){var hls=this.hls;hls.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),hls.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),hls.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),hls.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),hls.off(Events.FRAG_BUFFERED,this.onFragBuffered,this),hls.off(Events.ERROR,this.onError,this)},_proto.destroy=function(){this._unregisterListeners(),this.steering=null,this.resetLevels(),_BasePlaylistControll.prototype.destroy.call(this)},_proto.stopLoad=function(){this._levels.forEach((function(level){level.loadError=0,level.fragmentError=0})),_BasePlaylistControll.prototype.stopLoad.call(this)},_proto.resetLevels=function(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1},_proto.onManifestLoading=function(event,data){this.resetLevels()},_proto.onManifestLoaded=function(event,data){var preferManagedMediaSource=this.hls.config.preferManagedMediaSource,levels=[],redundantSet={},generatePathwaySet={},resolutionFound=!1,videoCodecFound=!1,audioCodecFound=!1;data.levels.forEach((function(levelParsed){var _audioCodec,_videoCodec,attributes=levelParsed.attrs,audioCodec=levelParsed.audioCodec,videoCodec=levelParsed.videoCodec;-1!==(null==(_audioCodec=audioCodec)?void 0:_audioCodec.indexOf("mp4a.40.34"))&&(chromeOrFirefox||(chromeOrFirefox=/chrome|firefox/i.test(navigator.userAgent)),chromeOrFirefox&&(levelParsed.audioCodec=audioCodec=void 0)),audioCodec&&(levelParsed.audioCodec=audioCodec=getCodecCompatibleName(audioCodec,preferManagedMediaSource)),0===(null==(_videoCodec=videoCodec)?void 0:_videoCodec.indexOf("avc1"))&&(videoCodec=levelParsed.videoCodec=convertAVC1ToAVCOTI(videoCodec));var width=levelParsed.width,height=levelParsed.height,unknownCodecs=levelParsed.unknownCodecs;if(resolutionFound||(resolutionFound=!(!width||!height)),videoCodecFound||(videoCodecFound=!!videoCodec),audioCodecFound||(audioCodecFound=!!audioCodec),!(null!=unknownCodecs&&unknownCodecs.length||audioCodec&&!areCodecsMediaSourceSupported(audioCodec,"audio",preferManagedMediaSource)||videoCodec&&!areCodecsMediaSourceSupported(videoCodec,"video",preferManagedMediaSource))){var CODECS=attributes.CODECS,FRAMERATE=attributes["FRAME-RATE"],HDCP=attributes["HDCP-LEVEL"],PATHWAY=attributes["PATHWAY-ID"],RESOLUTION=attributes.RESOLUTION,VIDEO_RANGE=attributes["VIDEO-RANGE"],levelKey=(PATHWAY||".")+"-"+levelParsed.bitrate+"-"+RESOLUTION+"-"+FRAMERATE+"-"+CODECS+"-"+VIDEO_RANGE+"-"+HDCP;if(redundantSet[levelKey])if(redundantSet[levelKey].uri===levelParsed.url||levelParsed.attrs["PATHWAY-ID"])redundantSet[levelKey].addGroupId("audio",attributes.AUDIO),redundantSet[levelKey].addGroupId("text",attributes.SUBTITLES);else{var pathwayCount=generatePathwaySet[levelKey]+=1;levelParsed.attrs["PATHWAY-ID"]=new Array(pathwayCount+1).join(".");var _level=new Level(levelParsed);redundantSet[levelKey]=_level,levels.push(_level)}else{var level=new Level(levelParsed);redundantSet[levelKey]=level,generatePathwaySet[levelKey]=1,levels.push(level)}}})),this.filterAndSortMediaOptions(levels,data,resolutionFound,videoCodecFound,audioCodecFound)},_proto.filterAndSortMediaOptions=function(filteredLevels,data,resolutionFound,videoCodecFound,audioCodecFound){var _this2=this,audioTracks=[],subtitleTracks=[],levels=filteredLevels;if((resolutionFound||videoCodecFound)&&audioCodecFound&&(levels=levels.filter((function(_ref){var videoCodec=_ref.videoCodec,videoRange=_ref.videoRange,width=_ref.width,height=_ref.height;return(!!videoCodec||!(!width||!height))&&isVideoRange(videoRange)}))),0!==levels.length){if(data.audioTracks){var preferManagedMediaSource=this.hls.config.preferManagedMediaSource;assignTrackIdsByGroup(audioTracks=data.audioTracks.filter((function(track){return!track.audioCodec||areCodecsMediaSourceSupported(track.audioCodec,"audio",preferManagedMediaSource)})))}data.subtitles&&assignTrackIdsByGroup(subtitleTracks=data.subtitles);var unsortedLevels=levels.slice(0);levels.sort((function(a,b){if(a.attrs["HDCP-LEVEL"]!==b.attrs["HDCP-LEVEL"])return(a.attrs["HDCP-LEVEL"]||"")>(b.attrs["HDCP-LEVEL"]||"")?1:-1;if(resolutionFound&&a.height!==b.height)return a.height-b.height;if(a.frameRate!==b.frameRate)return a.frameRate-b.frameRate;if(a.videoRange!==b.videoRange)return VideoRangeValues.indexOf(a.videoRange)-VideoRangeValues.indexOf(b.videoRange);if(a.videoCodec!==b.videoCodec){var valueA=videoCodecPreferenceValue(a.videoCodec),valueB=videoCodecPreferenceValue(b.videoCodec);if(valueA!==valueB)return valueB-valueA}if(a.uri===b.uri&&a.codecSet!==b.codecSet){var _valueA=codecsSetSelectionPreferenceValue(a.codecSet),_valueB=codecsSetSelectionPreferenceValue(b.codecSet);if(_valueA!==_valueB)return _valueB-_valueA}return a.averageBitrate!==b.averageBitrate?a.averageBitrate-b.averageBitrate:0}));var firstLevelInPlaylist=unsortedLevels[0];if(this.steering&&(levels=this.steering.filterParsedLevels(levels)).length!==unsortedLevels.length)for(var i=0;i<unsortedLevels.length;i++)if(unsortedLevels[i].pathwayId===levels[0].pathwayId){firstLevelInPlaylist=unsortedLevels[i];break}this._levels=levels;for(var _i=0;_i<levels.length;_i++)if(levels[_i]===firstLevelInPlaylist){var _this$hls$userConfig;this._firstLevel=_i;var firstLevelBitrate=firstLevelInPlaylist.bitrate,bandwidthEstimate=this.hls.bandwidthEstimate;if(this.log("manifest loaded, "+levels.length+" level(s) found, first bitrate: "+firstLevelBitrate),void 0===(null==(_this$hls$userConfig=this.hls.userConfig)?void 0:_this$hls$userConfig.abrEwmaDefaultEstimate)){var startingBwEstimate=Math.min(firstLevelBitrate,this.hls.config.abrEwmaDefaultEstimateMax);startingBwEstimate>bandwidthEstimate&&bandwidthEstimate===hlsDefaultConfig.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=startingBwEstimate)}break}var audioOnly=audioCodecFound&&!videoCodecFound,edata={levels:levels,audioTracks:audioTracks,subtitleTracks:subtitleTracks,sessionData:data.sessionData,sessionKeys:data.sessionKeys,firstLevel:this._firstLevel,stats:data.stats,audio:audioCodecFound,video:videoCodecFound,altAudio:!audioOnly&&audioTracks.some((function(t){return!!t.url}))};this.hls.trigger(Events.MANIFEST_PARSED,edata),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else Promise.resolve().then((function(){if(_this2.hls){data.levels.length&&_this2.warn("One or more CODECS in variant not supported: "+JSON.stringify(data.levels[0].attrs));var error=new Error("no level with compatible codecs found in manifest");_this2.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:data.url,error:error,reason:error.message})}}))},_proto.onError=function(event,data){!data.fatal&&data.context&&data.context.type===PlaylistContextType.LEVEL&&data.context.level===this.level&&this.checkRetry(data)},_proto.onFragBuffered=function(event,_ref2){var frag=_ref2.frag;if(void 0!==frag&&frag.type===PlaylistLevelType.MAIN){var el=frag.elementaryStreams;if(!Object.keys(el).some((function(type){return!!el[type]})))return;var level=this._levels[frag.level];null!=level&&level.loadError&&(this.log("Resetting level error count of "+level.loadError+" on frag buffered"),level.loadError=0)}},_proto.onLevelLoaded=function(event,data){var _data$deliveryDirecti2,_data$deliveryDirecti,level=data.level,details=data.details,curLevel=this._levels[level];if(!curLevel)return this.warn("Invalid level index "+level),void(null!=(_data$deliveryDirecti=data.deliveryDirectives)&&_data$deliveryDirecti.skip&&(details.deltaUpdateFailed=!0));level===this.currentLevelIndex?(0===curLevel.fragmentError&&(curLevel.loadError=0),this.playlistLoaded(level,data,curLevel.details)):null!=(_data$deliveryDirecti2=data.deliveryDirectives)&&_data$deliveryDirecti2.skip&&(details.deltaUpdateFailed=!0)},_proto.loadPlaylist=function(hlsUrlParameters){_BasePlaylistControll.prototype.loadPlaylist.call(this);var currentLevelIndex=this.currentLevelIndex,currentLevel=this.currentLevel;if(currentLevel&&this.shouldLoadPlaylist(currentLevel)){var url=currentLevel.uri;if(hlsUrlParameters)try{url=hlsUrlParameters.addDirectives(url)}catch(error){this.warn("Could not construct new URL with HLS Delivery Directives: "+error)}var pathwayId=currentLevel.attrs["PATHWAY-ID"];this.log("Loading level index "+currentLevelIndex+(void 0!==(null==hlsUrlParameters?void 0:hlsUrlParameters.msn)?" at sn "+hlsUrlParameters.msn+" part "+hlsUrlParameters.part:"")+" with"+(pathwayId?" Pathway "+pathwayId:"")+" "+url),this.clearTimer(),this.hls.trigger(Events.LEVEL_LOADING,{url:url,level:currentLevelIndex,pathwayId:currentLevel.attrs["PATHWAY-ID"],id:0,deliveryDirectives:hlsUrlParameters||null})}},_proto.removeLevel=function(levelIndex){var _this$currentLevel,_this3=this,levels=this._levels.filter((function(level,index){return index!==levelIndex||(_this3.steering&&_this3.steering.removeLevel(level),level===_this3.currentLevel&&(_this3.currentLevel=null,_this3.currentLevelIndex=-1,level.details&&level.details.fragments.forEach((function(f){return f.level=-1}))),!1)}));reassignFragmentLevelIndexes(levels),this._levels=levels,this.currentLevelIndex>-1&&null!=(_this$currentLevel=this.currentLevel)&&_this$currentLevel.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.hls.trigger(Events.LEVELS_UPDATED,{levels:levels})},_proto.onLevelsUpdated=function(event,_ref3){var levels=_ref3.levels;this._levels=levels},_proto.checkMaxAutoUpdated=function(){var _this$hls=this.hls,autoLevelCapping=_this$hls.autoLevelCapping,maxAutoLevel=_this$hls.maxAutoLevel,maxHdcpLevel=_this$hls.maxHdcpLevel;this._maxAutoLevel!==maxAutoLevel&&(this._maxAutoLevel=maxAutoLevel,this.hls.trigger(Events.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:autoLevelCapping,levels:this.levels,maxAutoLevel:maxAutoLevel,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:maxHdcpLevel}))},_createClass(LevelController,[{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(newLevel){var levels=this._levels;if(0!==levels.length){if(newLevel<0||newLevel>=levels.length){var error=new Error("invalid level idx"),fatal=newLevel<0;if(this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.LEVEL_SWITCH_ERROR,level:newLevel,fatal:fatal,error:error,reason:error.message}),fatal)return;newLevel=Math.min(newLevel,levels.length-1)}var lastLevelIndex=this.currentLevelIndex,lastLevel=this.currentLevel,lastPathwayId=lastLevel?lastLevel.attrs["PATHWAY-ID"]:void 0,level=levels[newLevel],pathwayId=level.attrs["PATHWAY-ID"];if(this.currentLevelIndex=newLevel,this.currentLevel=level,lastLevelIndex!==newLevel||!level.details||!lastLevel||lastPathwayId!==pathwayId){this.log("Switching to level "+newLevel+" ("+(level.height?level.height+"p ":"")+(level.videoRange?level.videoRange+" ":"")+(level.codecSet?level.codecSet+" ":"")+"@"+level.bitrate+")"+(pathwayId?" with Pathway "+pathwayId:"")+" from level "+lastLevelIndex+(lastPathwayId?" with Pathway "+lastPathwayId:""));var levelSwitchingData={level:newLevel,attrs:level.attrs,details:level.details,bitrate:level.bitrate,averageBitrate:level.averageBitrate,maxBitrate:level.maxBitrate,realBitrate:level.realBitrate,width:level.width,height:level.height,codecSet:level.codecSet,audioCodec:level.audioCodec,videoCodec:level.videoCodec,audioGroups:level.audioGroups,subtitleGroups:level.subtitleGroups,loaded:level.loaded,loadError:level.loadError,fragmentError:level.fragmentError,name:level.name,id:level.id,uri:level.uri,url:level.url,urlId:0,audioGroupIds:level.audioGroupIds,textGroupIds:level.textGroupIds};this.hls.trigger(Events.LEVEL_SWITCHING,levelSwitchingData);var levelDetails=level.details;if(!levelDetails||levelDetails.live){var hlsUrlParameters=this.switchParams(level.uri,null==lastLevel?void 0:lastLevel.details);this.loadPlaylist(hlsUrlParameters)}}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(newLevel){this.manualLevelIndex=newLevel,void 0===this._startLevel&&(this._startLevel=newLevel),-1!==newLevel&&(this.level=newLevel)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(newLevel){this._firstLevel=newLevel}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var configStartLevel=this.hls.config.startLevel;return void 0!==configStartLevel?configStartLevel:this.hls.firstAutoLevel}return this._startLevel},set:function(newLevel){this._startLevel=newLevel}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(nextLevel){this.level=nextLevel,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=nextLevel)}}]),LevelController})(BasePlaylistController);function assignTrackIdsByGroup(tracks){var groups={};tracks.forEach((function(track){var groupId=track.groupId||"";track.id=groups[groupId]=groups[groupId]||0,groups[groupId]++}))}var KeyLoader=(function(){function KeyLoader(config){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=config}var _proto=KeyLoader.prototype;return _proto.abort=function(type){for(var uri in this.keyUriToKeyInfo){var loader=this.keyUriToKeyInfo[uri].loader;if(loader){var _loader$context;if(type&&type!==(null==(_loader$context=loader.context)?void 0:_loader$context.frag.type))return;loader.abort()}}},_proto.detach=function(){for(var uri in this.keyUriToKeyInfo){var keyInfo=this.keyUriToKeyInfo[uri];(keyInfo.mediaKeySessionContext||keyInfo.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[uri]}},_proto.destroy=function(){for(var uri in this.detach(),this.keyUriToKeyInfo){var loader=this.keyUriToKeyInfo[uri].loader;loader&&loader.destroy()}this.keyUriToKeyInfo={}},_proto.createKeyLoadError=function(frag,details,error,networkDetails,response){return void 0===details&&(details=ErrorDetails.KEY_LOAD_ERROR),new LoadError({type:ErrorTypes.NETWORK_ERROR,details:details,fatal:!1,frag:frag,response:response,error:error,networkDetails:networkDetails})},_proto.loadClear=function(loadingFrag,encryptedFragments){var _this=this;if(this.emeController&&this.config.emeEnabled)for(var sn=loadingFrag.sn,cc=loadingFrag.cc,_loop=function(){var frag=encryptedFragments[i];if(cc<=frag.cc&&("initSegment"===sn||"initSegment"===frag.sn||sn<frag.sn))return _this.emeController.selectKeySystemFormat(frag).then((function(keySystemFormat){frag.setKeyFormat(keySystemFormat)})),1},i=0;i<encryptedFragments.length&&!_loop();i++);},_proto.load=function(frag){var _this2=this;return!frag.decryptdata&&frag.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(frag).then((function(keySystemFormat){return _this2.loadInternal(frag,keySystemFormat)})):this.loadInternal(frag)},_proto.loadInternal=function(frag,keySystemFormat){var _keyInfo,_keyInfo2;keySystemFormat&&frag.setKeyFormat(keySystemFormat);var decryptdata=frag.decryptdata;if(!decryptdata){var error=new Error(keySystemFormat?"Expected frag.decryptdata to be defined after setting format "+keySystemFormat:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(frag,ErrorDetails.KEY_LOAD_ERROR,error))}var uri=decryptdata.uri;if(!uri)return Promise.reject(this.createKeyLoadError(frag,ErrorDetails.KEY_LOAD_ERROR,new Error('Invalid key URI: "'+uri+'"')));var _keyInfo$mediaKeySess,keyInfo=this.keyUriToKeyInfo[uri];if(null!=(_keyInfo=keyInfo)&&_keyInfo.decryptdata.key)return decryptdata.key=keyInfo.decryptdata.key,Promise.resolve({frag:frag,keyInfo:keyInfo});if(null!=(_keyInfo2=keyInfo)&&_keyInfo2.keyLoadPromise)switch(null==(_keyInfo$mediaKeySess=keyInfo.mediaKeySessionContext)?void 0:_keyInfo$mediaKeySess.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return keyInfo.keyLoadPromise.then((function(keyLoadedData){return decryptdata.key=keyLoadedData.keyInfo.decryptdata.key,{frag:frag,keyInfo:keyInfo}}))}switch(keyInfo=this.keyUriToKeyInfo[uri]={decryptdata:decryptdata,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},decryptdata.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===decryptdata.keyFormat?this.loadKeyHTTP(keyInfo,frag):this.loadKeyEME(keyInfo,frag);case"AES-128":return this.loadKeyHTTP(keyInfo,frag);default:return Promise.reject(this.createKeyLoadError(frag,ErrorDetails.KEY_LOAD_ERROR,new Error('Key supplied with unsupported METHOD: "'+decryptdata.method+'"')))}},_proto.loadKeyEME=function(keyInfo,frag){var keyLoadedData={frag:frag,keyInfo:keyInfo};if(this.emeController&&this.config.emeEnabled){var keySessionContextPromise=this.emeController.loadKey(keyLoadedData);if(keySessionContextPromise)return(keyInfo.keyLoadPromise=keySessionContextPromise.then((function(keySessionContext){return keyInfo.mediaKeySessionContext=keySessionContext,keyLoadedData}))).catch((function(error){throw keyInfo.keyLoadPromise=null,error}))}return Promise.resolve(keyLoadedData)},_proto.loadKeyHTTP=function(keyInfo,frag){var _this3=this,config=this.config,keyLoader=new(0,config.loader)(config);return frag.keyLoader=keyInfo.loader=keyLoader,keyInfo.keyLoadPromise=new Promise((function(resolve,reject){var loaderContext={keyInfo:keyInfo,frag:frag,responseType:"arraybuffer",url:keyInfo.decryptdata.uri},loadPolicy=config.keyLoadPolicy.default,loaderConfig={loadPolicy:loadPolicy,timeout:loadPolicy.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},loaderCallbacks={onSuccess:function(response,stats,context,networkDetails){var frag=context.frag,keyInfo=context.keyInfo,uri=context.url;if(!frag.decryptdata||keyInfo!==_this3.keyUriToKeyInfo[uri])return reject(_this3.createKeyLoadError(frag,ErrorDetails.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),networkDetails));keyInfo.decryptdata.key=frag.decryptdata.key=new Uint8Array(response.data),frag.keyLoader=null,keyInfo.loader=null,resolve({frag:frag,keyInfo:keyInfo})},onError:function(response,context,networkDetails,stats){_this3.resetLoader(context),reject(_this3.createKeyLoadError(frag,ErrorDetails.KEY_LOAD_ERROR,new Error("HTTP Error "+response.code+" loading key "+response.text),networkDetails,_objectSpread2({url:loaderContext.url,data:void 0},response)))},onTimeout:function(stats,context,networkDetails){_this3.resetLoader(context),reject(_this3.createKeyLoadError(frag,ErrorDetails.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),networkDetails))},onAbort:function(stats,context,networkDetails){_this3.resetLoader(context),reject(_this3.createKeyLoadError(frag,ErrorDetails.INTERNAL_ABORTED,new Error("key loading aborted"),networkDetails))}};keyLoader.load(loaderContext,loaderConfig,loaderCallbacks)}))},_proto.resetLoader=function(context){var frag=context.frag,keyInfo=context.keyInfo,uri=context.url,loader=keyInfo.loader;frag.keyLoader===loader&&(frag.keyLoader=null,keyInfo.loader=null),delete this.keyUriToKeyInfo[uri],loader&&loader.destroy()},KeyLoader})();function getSourceBuffer(){return self.SourceBuffer||self.WebKitSourceBuffer}function isMSESupported(){if(!getMediaSource())return!1;var sourceBuffer=getSourceBuffer();return!sourceBuffer||sourceBuffer.prototype&&"function"==typeof sourceBuffer.prototype.appendBuffer&&"function"==typeof sourceBuffer.prototype.remove}function isSupported(){if(!isMSESupported())return!1;var mediaSource=getMediaSource();return"function"==typeof(null==mediaSource?void 0:mediaSource.isTypeSupported)&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some((function(codecsForVideoContainer){return mediaSource.isTypeSupported(mimeTypeForCodec(codecsForVideoContainer,"video"))}))||["mp4a.40.2","fLaC"].some((function(codecForAudioContainer){return mediaSource.isTypeSupported(mimeTypeForCodec(codecForAudioContainer,"audio"))})))}function changeTypeSupported(){var _sourceBuffer$prototy,sourceBuffer=getSourceBuffer();return"function"==typeof(null==sourceBuffer||null==(_sourceBuffer$prototy=sourceBuffer.prototype)?void 0:_sourceBuffer$prototy.changeType)}var STALL_MINIMUM_DURATION_MS=250,MAX_START_GAP_JUMP=2,SKIP_BUFFER_HOLE_STEP_SECONDS=.1,SKIP_BUFFER_RANGE_START=.05,GapController=(function(){function GapController(config,media,fragmentTracker,hls){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=config,this.media=media,this.fragmentTracker=fragmentTracker,this.hls=hls}var _proto=GapController.prototype;return _proto.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},_proto.poll=function(lastCurrentTime,activeFrag){var config=this.config,media=this.media,stalled=this.stalled;if(null!==media){var currentTime=media.currentTime,seeking=media.seeking,seeked=this.seeking&&!seeking,beginSeek=!this.seeking&&seeking;if(this.seeking=seeking,currentTime===lastCurrentTime)if(beginSeek||seeked)this.stalled=null;else if(media.paused&&!seeking||media.ended||0===media.playbackRate||!BufferHelper.getBuffered(media).length)this.nudgeRetry=0;else{var bufferInfo=BufferHelper.bufferInfo(media,currentTime,0),nextStart=bufferInfo.nextStart||0;if(seeking){var hasEnoughBuffer=bufferInfo.len>MAX_START_GAP_JUMP,noBufferGap=!nextStart||activeFrag&&activeFrag.start<=currentTime||nextStart-currentTime>MAX_START_GAP_JUMP&&!this.fragmentTracker.getPartialFragment(currentTime);if(hasEnoughBuffer||noBufferGap)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var _level$details;if(!(bufferInfo.len>0||nextStart))return;var startJump=Math.max(nextStart,bufferInfo.start||0)-currentTime,level=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,maxStartGapJump=(null==level||null==(_level$details=level.details)?void 0:_level$details.live)?2*level.details.targetduration:MAX_START_GAP_JUMP,partialOrGap=this.fragmentTracker.getPartialFragment(currentTime);if(startJump>0&&(startJump<=maxStartGapJump||partialOrGap))return void(media.paused||this._trySkipBufferHole(partialOrGap))}var tnow=self.performance.now();if(null!==stalled){var stalledDuration=tnow-stalled;if(seeking||!(stalledDuration>=STALL_MINIMUM_DURATION_MS)||(this._reportStall(bufferInfo),this.media)){var bufferedWithHoles=BufferHelper.bufferInfo(media,currentTime,config.maxBufferHole);this._tryFixBufferStall(bufferedWithHoles,stalledDuration)}}else this.stalled=tnow}else if(this.moved=!0,seeking||(this.nudgeRetry=0),null!==stalled){if(this.stallReported){var _stalledDuration=self.performance.now()-stalled;logger.warn("playback not stuck anymore @"+currentTime+", after "+Math.round(_stalledDuration)+"ms"),this.stallReported=!1}this.stalled=null}}},_proto._tryFixBufferStall=function(bufferInfo,stalledDurationMs){var config=this.config,fragmentTracker=this.fragmentTracker,media=this.media;if(null!==media){var currentTime=media.currentTime,partial=fragmentTracker.getPartialFragment(currentTime);if(partial&&(this._trySkipBufferHole(partial)||!this.media))return;(bufferInfo.len>config.maxBufferHole||bufferInfo.nextStart&&bufferInfo.nextStart-currentTime<config.maxBufferHole)&&stalledDurationMs>1e3*config.highBufferWatchdogPeriod&&(logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},_proto._reportStall=function(bufferInfo){var hls=this.hls,media=this.media;if(!this.stallReported&&media){this.stallReported=!0;var error=new Error("Playback stalling at @"+media.currentTime+" due to low buffer ("+JSON.stringify(bufferInfo)+")");logger.warn(error.message),hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,error:error,buffer:bufferInfo.len})}},_proto._trySkipBufferHole=function(partial){var config=this.config,hls=this.hls,media=this.media;if(null===media)return 0;var currentTime=media.currentTime,bufferInfo=BufferHelper.bufferInfo(media,currentTime,0),startTime=currentTime<bufferInfo.start?bufferInfo.start:bufferInfo.nextStart;if(startTime){var bufferStarved=bufferInfo.len<=config.maxBufferHole,waiting=bufferInfo.len>0&&bufferInfo.len<1&&media.readyState<3,gapLength=startTime-currentTime;if(gapLength>0&&(bufferStarved||waiting)){if(gapLength>config.maxBufferHole){var fragmentTracker=this.fragmentTracker,startGap=!1;if(0===currentTime){var startFrag=fragmentTracker.getAppendedFrag(0,PlaylistLevelType.MAIN);startFrag&&startTime<startFrag.end&&(startGap=!0)}if(!startGap){var startProvisioned=partial||fragmentTracker.getAppendedFrag(currentTime,PlaylistLevelType.MAIN);if(startProvisioned){for(var moreToLoad=!1,pos=startProvisioned.end;pos<startTime;){var provisioned=fragmentTracker.getPartialFragment(pos);if(!provisioned){moreToLoad=!0;break}pos+=provisioned.duration}if(moreToLoad)return 0}}}var targetTime=Math.max(startTime+SKIP_BUFFER_RANGE_START,currentTime+SKIP_BUFFER_HOLE_STEP_SECONDS);if(logger.warn("skipping hole, adjusting currentTime from "+currentTime+" to "+targetTime),this.moved=!0,this.stalled=null,media.currentTime=targetTime,partial&&!partial.gap){var error=new Error("fragment loaded with buffer holes, seeking from "+currentTime+" to "+targetTime);hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:error,reason:error.message,frag:partial})}return targetTime}}return 0},_proto._tryNudgeBuffer=function(){var config=this.config,hls=this.hls,media=this.media,nudgeRetry=this.nudgeRetry;if(null!==media){var currentTime=media.currentTime;if(this.nudgeRetry++,nudgeRetry<config.nudgeMaxRetry){var targetTime=currentTime+(nudgeRetry+1)*config.nudgeOffset,error=new Error("Nudging 'currentTime' from "+currentTime+" to "+targetTime);logger.warn(error.message),media.currentTime=targetTime,hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_NUDGE_ON_STALL,error:error,fatal:!1})}else{var _error=new Error("Playhead still not moving while enough data buffered @"+currentTime+" after "+config.nudgeMaxRetry+" nudges");logger.error(_error.message),hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_STALLED_ERROR,error:_error,fatal:!0})}}},GapController})(),TICK_INTERVAL=100,StreamController=(function(_BaseStreamController){function StreamController(hls,fragmentTracker,keyLoader){var _this;return(_this=_BaseStreamController.call(this,hls,fragmentTracker,keyLoader,"[stream-controller]",PlaylistLevelType.MAIN)||this).audioCodecSwap=!1,_this.gapController=null,_this.level=-1,_this._forceStartLoad=!1,_this.altAudio=!1,_this.audioOnly=!1,_this.fragPlaying=null,_this.onvplaying=null,_this.onvseeked=null,_this.fragLastKbps=0,_this.couldBacktrack=!1,_this.backtrackFragment=null,_this.audioCodecSwitch=!1,_this.videoBuffer=null,_this._registerListeners(),_this}_inheritsLoose(StreamController,_BaseStreamController);var _proto=StreamController.prototype;return _proto._registerListeners=function(){var hls=this.hls;hls.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),hls.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),hls.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),hls.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),hls.on(Events.LEVEL_LOADING,this.onLevelLoading,this),hls.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),hls.on(Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),hls.on(Events.ERROR,this.onError,this),hls.on(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),hls.on(Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),hls.on(Events.BUFFER_CREATED,this.onBufferCreated,this),hls.on(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),hls.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),hls.on(Events.FRAG_BUFFERED,this.onFragBuffered,this)},_proto._unregisterListeners=function(){var hls=this.hls;hls.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),hls.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),hls.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),hls.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),hls.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),hls.off(Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),hls.off(Events.ERROR,this.onError,this),hls.off(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),hls.off(Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),hls.off(Events.BUFFER_CREATED,this.onBufferCreated,this),hls.off(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),hls.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),hls.off(Events.FRAG_BUFFERED,this.onFragBuffered,this)},_proto.onHandlerDestroying=function(){this._unregisterListeners(),_BaseStreamController.prototype.onHandlerDestroying.call(this)},_proto.startLoad=function(startPosition){if(this.levels){var lastCurrentTime=this.lastCurrentTime,hls=this.hls;if(this.stopLoad(),this.setInterval(TICK_INTERVAL),this.level=-1,!this.startFragRequested){var startLevel=hls.startLevel;-1===startLevel&&(hls.config.testBandwidth&&this.levels.length>1?(startLevel=0,this.bitrateTest=!0):startLevel=hls.firstAutoLevel),hls.nextLoadLevel=startLevel,this.level=hls.loadLevel,this.loadedmetadata=!1}lastCurrentTime>0&&-1===startPosition&&(this.log("Override startPosition with lastCurrentTime @"+lastCurrentTime.toFixed(3)),startPosition=lastCurrentTime),this.state=State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=startPosition,this.tick()}else this._forceStartLoad=!0,this.state=State.STOPPED},_proto.stopLoad=function(){this._forceStartLoad=!1,_BaseStreamController.prototype.stopLoad.call(this)},_proto.doTick=function(){switch(this.state){case State.WAITING_LEVEL:var levels=this.levels,level=this.level,currentLevel=null==levels?void 0:levels[level],details=null==currentLevel?void 0:currentLevel.details;if(details&&(!details.live||this.levelLastLoaded===currentLevel)){if(this.waitForCdnTuneIn(details))break;this.state=State.IDLE;break}if(this.hls.nextLoadLevel!==this.level){this.state=State.IDLE;break}break;case State.FRAG_LOADING_WAITING_RETRY:var _this$media,now=self.performance.now(),retryDate=this.retryDate;if(!retryDate||now>=retryDate||null!=(_this$media=this.media)&&_this$media.seeking){var _levels=this.levels,_level=this.level,_currentLevel=null==_levels?void 0:_levels[_level];this.resetStartWhenNotLoaded(_currentLevel||null),this.state=State.IDLE}}this.state===State.IDLE&&this.doTickIdle(),this.onTickEnd()},_proto.onTickEnd=function(){_BaseStreamController.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},_proto.doTickIdle=function(){var hls=this.hls,levelLastLoaded=this.levelLastLoaded,levels=this.levels,media=this.media,config=hls.config,level=hls.nextLoadLevel;if(null!==levelLastLoaded&&(media||!this.startFragRequested&&config.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&null!=levels&&levels[level]){var levelInfo=levels[level],bufferInfo=this.getMainFwdBufferInfo();if(null!==bufferInfo){var lastDetails=this.getLevelDetails();if(lastDetails&&this._streamEnded(bufferInfo,lastDetails)){var data={};return this.altAudio&&(data.type="video"),this.hls.trigger(Events.BUFFER_EOS,data),void(this.state=State.ENDED)}hls.loadLevel!==level&&-1===hls.manualLevel&&this.log("Adapting to level "+level+" from level "+this.level),this.level=hls.nextLoadLevel=level;var levelDetails=levelInfo.details;if(!levelDetails||this.state===State.WAITING_LEVEL||levelDetails.live&&this.levelLastLoaded!==levelInfo)return this.level=level,void(this.state=State.WAITING_LEVEL);var bufferLen=bufferInfo.len,maxBufLen=this.getMaxBufferLength(levelInfo.maxBitrate);if(!(bufferLen>=maxBufLen)){this.backtrackFragment&&this.backtrackFragment.start>bufferInfo.end&&(this.backtrackFragment=null);var targetBufferTime=this.backtrackFragment?this.backtrackFragment.start:bufferInfo.end,frag=this.getNextFragment(targetBufferTime,levelDetails);if(this.couldBacktrack&&!this.fragPrevious&&frag&&"initSegment"!==frag.sn&&this.fragmentTracker.getState(frag)!==FragmentState.OK){var _this$backtrackFragme,fragIdx=(null!=(_this$backtrackFragme=this.backtrackFragment)?_this$backtrackFragme:frag).sn-levelDetails.startSN,backtrackFrag=levelDetails.fragments[fragIdx-1];backtrackFrag&&frag.cc===backtrackFrag.cc&&(frag=backtrackFrag,this.fragmentTracker.removeFragment(backtrackFrag))}else this.backtrackFragment&&bufferInfo.len&&(this.backtrackFragment=null);if(frag&&this.isLoopLoading(frag,targetBufferTime)){if(!frag.gap){var type=this.audioOnly&&!this.altAudio?ElementaryStreamTypes.AUDIO:ElementaryStreamTypes.VIDEO,mediaBuffer=(type===ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;mediaBuffer&&this.afterBufferFlushed(mediaBuffer,type,PlaylistLevelType.MAIN)}frag=this.getNextFragmentLoopLoading(frag,levelDetails,bufferInfo,PlaylistLevelType.MAIN,maxBufLen)}frag&&(!frag.initSegment||frag.initSegment.data||this.bitrateTest||(frag=frag.initSegment),this.loadFragment(frag,levelInfo,targetBufferTime))}}}},_proto.loadFragment=function(frag,level,targetBufferTime){var fragState=this.fragmentTracker.getState(frag);this.fragCurrent=frag,fragState===FragmentState.NOT_LOADED||fragState===FragmentState.PARTIAL?"initSegment"===frag.sn?this._loadInitSegment(frag,level):this.bitrateTest?(this.log("Fragment "+frag.sn+" of level "+frag.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(frag,level)):(this.startFragRequested=!0,_BaseStreamController.prototype.loadFragment.call(this,frag,level,targetBufferTime)):this.clearTrackerIfNeeded(frag)},_proto.getBufferedFrag=function(position){return this.fragmentTracker.getBufferedFrag(position,PlaylistLevelType.MAIN)},_proto.followingBufferedFrag=function(frag){return frag?this.getBufferedFrag(frag.end+.5):null},_proto.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},_proto.nextLevelSwitch=function(){var levels=this.levels,media=this.media;if(null!=media&&media.readyState){var fetchdelay,fragPlayingCurrent=this.getAppendedFrag(media.currentTime);fragPlayingCurrent&&fragPlayingCurrent.start>1&&this.flushMainBuffer(0,fragPlayingCurrent.start-1);var levelDetails=this.getLevelDetails();if(null!=levelDetails&&levelDetails.live){var bufferInfo=this.getMainFwdBufferInfo();if(!bufferInfo||bufferInfo.len<2*levelDetails.targetduration)return}if(!media.paused&&levels){var nextLevel=levels[this.hls.nextLoadLevel],fragLastKbps=this.fragLastKbps;fetchdelay=fragLastKbps&&this.fragCurrent?this.fragCurrent.duration*nextLevel.maxBitrate/(1e3*fragLastKbps)+1:0}else fetchdelay=0;var bufferedFrag=this.getBufferedFrag(media.currentTime+fetchdelay);if(bufferedFrag){var nextBufferedFrag=this.followingBufferedFrag(bufferedFrag);if(nextBufferedFrag){this.abortCurrentFrag();var maxStart=nextBufferedFrag.maxStartPTS?nextBufferedFrag.maxStartPTS:nextBufferedFrag.start,fragDuration=nextBufferedFrag.duration,startPts=Math.max(bufferedFrag.end,maxStart+Math.min(Math.max(fragDuration-this.config.maxFragLookUpTolerance,fragDuration*(this.couldBacktrack?.5:.125)),fragDuration*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(startPts,Number.POSITIVE_INFINITY)}}}},_proto.abortCurrentFrag=function(){var fragCurrent=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,fragCurrent&&(fragCurrent.abortRequests(),this.fragmentTracker.removeFragment(fragCurrent)),this.state){case State.KEY_LOADING:case State.FRAG_LOADING:case State.FRAG_LOADING_WAITING_RETRY:case State.PARSING:case State.PARSED:this.state=State.IDLE}this.nextLoadPosition=this.getLoadPosition()},_proto.flushMainBuffer=function(startOffset,endOffset){_BaseStreamController.prototype.flushMainBuffer.call(this,startOffset,endOffset,this.altAudio?"video":null)},_proto.onMediaAttached=function(event,data){_BaseStreamController.prototype.onMediaAttached.call(this,event,data);var media=data.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),media.addEventListener("playing",this.onvplaying),media.addEventListener("seeked",this.onvseeked),this.gapController=new GapController(this.config,media,this.fragmentTracker,this.hls)},_proto.onMediaDetaching=function(){var media=this.media;media&&this.onvplaying&&this.onvseeked&&(media.removeEventListener("playing",this.onvplaying),media.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),_BaseStreamController.prototype.onMediaDetaching.call(this)},_proto.onMediaPlaying=function(){this.tick()},_proto.onMediaSeeked=function(){var media=this.media,currentTime=media?media.currentTime:null;isFiniteNumber(currentTime)&&this.log("Media seeked to "+currentTime.toFixed(3));var bufferInfo=this.getMainFwdBufferInfo();null!==bufferInfo&&0!==bufferInfo.len?this.tick():this.warn('Main forward buffer length on "seeked" event '+(bufferInfo?bufferInfo.len:"empty")+")")},_proto.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=this.fragLastKbps=0,this.levels=this.fragPlaying=this.backtrackFragment=this.levelLastLoaded=null,this.altAudio=this.audioOnly=this.startFragRequested=!1},_proto.onManifestParsed=function(event,data){var aac=!1,heaac=!1;data.levels.forEach((function(level){var codec=level.audioCodec;codec&&(aac=aac||-1!==codec.indexOf("mp4a.40.2"),heaac=heaac||-1!==codec.indexOf("mp4a.40.5"))})),this.audioCodecSwitch=aac&&heaac&&!changeTypeSupported(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=data.levels,this.startFragRequested=!1},_proto.onLevelLoading=function(event,data){var levels=this.levels;if(levels&&this.state===State.IDLE){var level=levels[data.level];(!level.details||level.details.live&&this.levelLastLoaded!==level||this.waitForCdnTuneIn(level.details))&&(this.state=State.WAITING_LEVEL)}},_proto.onLevelLoaded=function(event,data){var _curLevel$details,levels=this.levels,newLevelId=data.level,newDetails=data.details,duration=newDetails.totalduration;if(levels){this.log("Level "+newLevelId+" loaded ["+newDetails.startSN+","+newDetails.endSN+"]"+(newDetails.lastPartSn?"[part-"+newDetails.lastPartSn+"-"+newDetails.lastPartIndex+"]":"")+", cc ["+newDetails.startCC+", "+newDetails.endCC+"] duration:"+duration);var curLevel=levels[newLevelId],fragCurrent=this.fragCurrent;!fragCurrent||this.state!==State.FRAG_LOADING&&this.state!==State.FRAG_LOADING_WAITING_RETRY||fragCurrent.level!==data.level&&fragCurrent.loader&&this.abortCurrentFrag();var sliding=0;if(newDetails.live||null!=(_curLevel$details=curLevel.details)&&_curLevel$details.live){var _this$levelLastLoaded;if(this.checkLiveUpdate(newDetails),newDetails.deltaUpdateFailed)return;sliding=this.alignPlaylists(newDetails,curLevel.details,null==(_this$levelLastLoaded=this.levelLastLoaded)?void 0:_this$levelLastLoaded.details)}if(curLevel.details=newDetails,this.levelLastLoaded=curLevel,this.hls.trigger(Events.LEVEL_UPDATED,{details:newDetails,level:newLevelId}),this.state===State.WAITING_LEVEL){if(this.waitForCdnTuneIn(newDetails))return;this.state=State.IDLE}this.startFragRequested?newDetails.live&&this.synchronizeToLiveEdge(newDetails):this.setStartPosition(newDetails,sliding),this.tick()}else this.warn("Levels were reset while loading level "+newLevelId)},_proto._handleFragmentLoadProgress=function(data){var _frag$initSegment,frag=data.frag,part=data.part,payload=data.payload,levels=this.levels;if(levels){var currentLevel=levels[frag.level],details=currentLevel.details;if(!details)return this.warn("Dropping fragment "+frag.sn+" of level "+frag.level+" after level details were reset"),void this.fragmentTracker.removeFragment(frag);var videoCodec=currentLevel.videoCodec,accurateTimeOffset=details.PTSKnown||!details.live,initSegmentData=null==(_frag$initSegment=frag.initSegment)?void 0:_frag$initSegment.data,audioCodec=this._getAudioCodec(currentLevel),transmuxer=this.transmuxer=this.transmuxer||new TransmuxerInterface(this.hls,PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),partIndex=part?part.index:-1,partial=-1!==partIndex,chunkMeta=new ChunkMetadata(frag.level,frag.sn,frag.stats.chunkCount,payload.byteLength,partIndex,partial),initPTS=this.initPTS[frag.cc];transmuxer.push(payload,initSegmentData,audioCodec,videoCodec,frag,part,details.totalduration,accurateTimeOffset,chunkMeta,initPTS)}else this.warn("Levels were reset while fragment load was in progress. Fragment "+frag.sn+" of level "+frag.level+" will not be buffered")},_proto.onAudioTrackSwitching=function(event,data){var fromAltAudio=this.altAudio;if(!data.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var fragCurrent=this.fragCurrent;fragCurrent&&(this.log("Switching to main audio track, cancel main fragment load"),fragCurrent.abortRequests(),this.fragmentTracker.removeFragment(fragCurrent)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var hls=this.hls;fromAltAudio&&(hls.trigger(Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),hls.trigger(Events.AUDIO_TRACK_SWITCHED,data)}},_proto.onAudioTrackSwitched=function(event,data){var trackId=data.id,altAudio=!!this.hls.audioTracks[trackId].url;if(altAudio){var videoBuffer=this.videoBuffer;videoBuffer&&this.mediaBuffer!==videoBuffer&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=videoBuffer)}this.altAudio=altAudio,this.tick()},_proto.onBufferCreated=function(event,data){var mediaTrack,name,tracks=data.tracks,alternate=!1;for(var type in tracks){var track=tracks[type];if("main"===track.id){if(name=type,mediaTrack=track,"video"===type){var videoTrack=tracks[type];videoTrack&&(this.videoBuffer=videoTrack.buffer)}}else alternate=!0}alternate&&mediaTrack?(this.log("Alternate track found, use "+name+".buffered to schedule main fragment loading"),this.mediaBuffer=mediaTrack.buffer):this.mediaBuffer=this.media},_proto.onFragBuffered=function(event,data){var frag=data.frag,part=data.part;if(!frag||frag.type===PlaylistLevelType.MAIN){if(this.fragContextChanged(frag))return this.warn("Fragment "+frag.sn+(part?" p: "+part.index:"")+" of level "+frag.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===State.PARSED&&(this.state=State.IDLE));var stats=part?part.stats:frag.stats;this.fragLastKbps=Math.round(8*stats.total/(stats.buffering.end-stats.loading.first)),"initSegment"!==frag.sn&&(this.fragPrevious=frag),this.fragBufferedComplete(frag,part)}},_proto.onError=function(event,data){var _data$context;if(data.fatal)this.state=State.ERROR;else switch(data.details){case ErrorDetails.FRAG_GAP:case ErrorDetails.FRAG_PARSING_ERROR:case ErrorDetails.FRAG_DECRYPT_ERROR:case ErrorDetails.FRAG_LOAD_ERROR:case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_ERROR:case ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(PlaylistLevelType.MAIN,data);break;case ErrorDetails.LEVEL_LOAD_ERROR:case ErrorDetails.LEVEL_LOAD_TIMEOUT:case ErrorDetails.LEVEL_PARSING_ERROR:data.levelRetry||this.state!==State.WAITING_LEVEL||(null==(_data$context=data.context)?void 0:_data$context.type)!==PlaylistContextType.LEVEL||(this.state=State.IDLE);break;case ErrorDetails.BUFFER_APPEND_ERROR:case ErrorDetails.BUFFER_FULL_ERROR:if(!data.parent||"main"!==data.parent)return;if(data.details===ErrorDetails.BUFFER_APPEND_ERROR)return void this.resetLoadingState();this.reduceLengthAndFlushBuffer(data)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case ErrorDetails.INTERNAL_EXCEPTION:this.recoverWorkerError(data)}},_proto.checkBuffer=function(){var media=this.media,gapController=this.gapController;if(media&&gapController&&media.readyState){if(this.loadedmetadata||!BufferHelper.getBuffered(media).length){var activeFrag=this.state!==State.IDLE?this.fragCurrent:null;gapController.poll(this.lastCurrentTime,activeFrag)}this.lastCurrentTime=media.currentTime}},_proto.onFragLoadEmergencyAborted=function(){this.state=State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},_proto.onBufferFlushed=function(event,_ref){var type=_ref.type;if(type!==ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var mediaBuffer=(type===ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(mediaBuffer,type,PlaylistLevelType.MAIN),this.tick()}},_proto.onLevelsUpdated=function(event,data){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level),this.levels=data.levels},_proto.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},_proto.seekToStartPos=function(){var media=this.media;if(media){var currentTime=media.currentTime,startPosition=this.startPosition;if(startPosition>=0&&currentTime<startPosition){if(media.seeking)return void this.log("could not seek to "+startPosition+", already seeking at "+currentTime);var buffered=BufferHelper.getBuffered(media),delta=(buffered.length?buffered.start(0):0)-startPosition;delta>0&&(delta<this.config.maxBufferHole||delta<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+delta+" to match buffer start"),startPosition+=delta,this.startPosition=startPosition),this.log("seek to target start position "+startPosition+" from current time "+currentTime),media.currentTime=startPosition}}},_proto._getAudioCodec=function(currentLevel){var audioCodec=this.config.defaultAudioCodec||currentLevel.audioCodec;return this.audioCodecSwap&&audioCodec&&(this.log("Swapping audio codec"),audioCodec=-1!==audioCodec.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),audioCodec},_proto._loadBitrateTestFrag=function(frag,level){var _this2=this;frag.bitrateTest=!0,this._doFragLoad(frag,level).then((function(data){var hls=_this2.hls;if(data&&!_this2.fragContextChanged(frag)){level.fragmentError=0,_this2.state=State.IDLE,_this2.startFragRequested=!1,_this2.bitrateTest=!1;var stats=frag.stats;stats.parsing.start=stats.parsing.end=stats.buffering.start=stats.buffering.end=self.performance.now(),hls.trigger(Events.FRAG_LOADED,data),frag.bitrateTest=!1}}))},_proto._handleTransmuxComplete=function(transmuxResult){var _id3$samples,id="main",hls=this.hls,remuxResult=transmuxResult.remuxResult,chunkMeta=transmuxResult.chunkMeta,context=this.getCurrentContext(chunkMeta);if(context){var frag=context.frag,part=context.part,level=context.level,video=remuxResult.video,text=remuxResult.text,id3=remuxResult.id3,initSegment=remuxResult.initSegment,details=level.details,audio=this.altAudio?void 0:remuxResult.audio;if(this.fragContextChanged(frag))this.fragmentTracker.removeFragment(frag);else{if(this.state=State.PARSING,initSegment){if(null!=initSegment&&initSegment.tracks){var mapFragment=frag.initSegment||frag;this._bufferInitSegment(level,initSegment.tracks,mapFragment,chunkMeta),hls.trigger(Events.FRAG_PARSING_INIT_SEGMENT,{frag:mapFragment,id:id,tracks:initSegment.tracks})}var initPTS=initSegment.initPTS,timescale=initSegment.timescale;isFiniteNumber(initPTS)&&(this.initPTS[frag.cc]={baseTime:initPTS,timescale:timescale},hls.trigger(Events.INIT_PTS_FOUND,{frag:frag,id:id,initPTS:initPTS,timescale:timescale}))}if(video&&details&&"initSegment"!==frag.sn){var prevFrag=details.fragments[frag.sn-1-details.startSN],isFirstFragment=frag.sn===details.startSN,isFirstInDiscontinuity=!prevFrag||frag.cc>prevFrag.cc;if(!1!==remuxResult.independent){var startPTS=video.startPTS,endPTS=video.endPTS,startDTS=video.startDTS,endDTS=video.endDTS;if(part)part.elementaryStreams[video.type]={startPTS:startPTS,endPTS:endPTS,startDTS:startDTS,endDTS:endDTS};else if(video.firstKeyFrame&&video.independent&&1===chunkMeta.id&&!isFirstInDiscontinuity&&(this.couldBacktrack=!0),video.dropped&&video.independent){var bufferInfo=this.getMainFwdBufferInfo(),targetBufferTime=(bufferInfo?bufferInfo.end:this.getLoadPosition())+this.config.maxBufferHole,startTime=video.firstKeyFramePTS?video.firstKeyFramePTS:startPTS;if(!isFirstFragment&&targetBufferTime<startTime-this.config.maxBufferHole&&!isFirstInDiscontinuity)return void this.backtrack(frag);isFirstInDiscontinuity&&(frag.gap=!0),frag.setElementaryStreamInfo(video.type,frag.start,endPTS,frag.start,endDTS,!0)}else isFirstFragment&&startPTS>MAX_START_GAP_JUMP&&(frag.gap=!0);frag.setElementaryStreamInfo(video.type,startPTS,endPTS,startDTS,endDTS),this.backtrackFragment&&(this.backtrackFragment=frag),this.bufferFragmentData(video,frag,part,chunkMeta,isFirstFragment||isFirstInDiscontinuity)}else{if(!isFirstFragment&&!isFirstInDiscontinuity)return void this.backtrack(frag);frag.gap=!0}}if(audio){var _startPTS=audio.startPTS,_endPTS=audio.endPTS,_startDTS=audio.startDTS,_endDTS=audio.endDTS;part&&(part.elementaryStreams[ElementaryStreamTypes.AUDIO]={startPTS:_startPTS,endPTS:_endPTS,startDTS:_startDTS,endDTS:_endDTS}),frag.setElementaryStreamInfo(ElementaryStreamTypes.AUDIO,_startPTS,_endPTS,_startDTS,_endDTS),this.bufferFragmentData(audio,frag,part,chunkMeta)}if(details&&null!=id3&&null!=(_id3$samples=id3.samples)&&_id3$samples.length){var emittedID3={id:id,frag:frag,details:details,samples:id3.samples};hls.trigger(Events.FRAG_PARSING_METADATA,emittedID3)}if(details&&text){var emittedText={id:id,frag:frag,details:details,samples:text.samples};hls.trigger(Events.FRAG_PARSING_USERDATA,emittedText)}}}else this.resetWhenMissingContext(chunkMeta)},_proto._bufferInitSegment=function(currentLevel,tracks,frag,chunkMeta){var _this3=this;if(this.state===State.PARSING){this.audioOnly=!!tracks.audio&&!tracks.video,this.altAudio&&!this.audioOnly&&delete tracks.audio;var audio=tracks.audio,video=tracks.video,audiovideo=tracks.audiovideo;if(audio){var audioCodec=currentLevel.audioCodec,ua=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(audioCodec&&(audioCodec=-1!==audioCodec.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==audio.metadata.channelCount&&-1===ua.indexOf("firefox")&&(audioCodec="mp4a.40.5")),audioCodec&&-1!==audioCodec.indexOf("mp4a.40.5")&&-1!==ua.indexOf("android")&&"audio/mpeg"!==audio.container&&(audioCodec="mp4a.40.2",this.log("Android: force audio codec to "+audioCodec)),currentLevel.audioCodec&&currentLevel.audioCodec!==audioCodec&&this.log('Swapping manifest audio codec "'+currentLevel.audioCodec+'" for "'+audioCodec+'"'),audio.levelCodec=audioCodec,audio.id="main",this.log("Init audio buffer, container:"+audio.container+", codecs[selected/level/parsed]=["+(audioCodec||"")+"/"+(currentLevel.audioCodec||"")+"/"+audio.codec+"]")}video&&(video.levelCodec=currentLevel.videoCodec,video.id="main",this.log("Init video buffer, container:"+video.container+", codecs[level/parsed]=["+(currentLevel.videoCodec||"")+"/"+video.codec+"]")),audiovideo&&this.log("Init audiovideo buffer, container:"+audiovideo.container+", codecs[level/parsed]=["+currentLevel.codecs+"/"+audiovideo.codec+"]"),this.hls.trigger(Events.BUFFER_CODECS,tracks),Object.keys(tracks).forEach((function(trackName){var initSegment=tracks[trackName].initSegment;null!=initSegment&&initSegment.byteLength&&_this3.hls.trigger(Events.BUFFER_APPENDING,{type:trackName,data:initSegment,frag:frag,part:null,chunkMeta:chunkMeta,parent:frag.type})})),this.tickImmediate()}},_proto.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,PlaylistLevelType.MAIN)},_proto.backtrack=function(frag){this.couldBacktrack=!0,this.backtrackFragment=frag,this.resetTransmuxer(),this.flushBufferGap(frag),this.fragmentTracker.removeFragment(frag),this.fragPrevious=null,this.nextLoadPosition=frag.start,this.state=State.IDLE},_proto.checkFragmentChanged=function(){var video=this.media,fragPlayingCurrent=null;if(video&&video.readyState>1&&!1===video.seeking){var currentTime=video.currentTime;if(BufferHelper.isBuffered(video,currentTime)?fragPlayingCurrent=this.getAppendedFrag(currentTime):BufferHelper.isBuffered(video,currentTime+.1)&&(fragPlayingCurrent=this.getAppendedFrag(currentTime+.1)),fragPlayingCurrent){this.backtrackFragment=null;var fragPlaying=this.fragPlaying,fragCurrentLevel=fragPlayingCurrent.level;fragPlaying&&fragPlayingCurrent.sn===fragPlaying.sn&&fragPlaying.level===fragCurrentLevel||(this.fragPlaying=fragPlayingCurrent,this.hls.trigger(Events.FRAG_CHANGED,{frag:fragPlayingCurrent}),fragPlaying&&fragPlaying.level===fragCurrentLevel||this.hls.trigger(Events.LEVEL_SWITCHED,{level:fragCurrentLevel}))}}},_createClass(StreamController,[{key:"nextLevel",get:function(){var frag=this.nextBufferedFrag;return frag?frag.level:-1}},{key:"currentFrag",get:function(){var media=this.media;return media?this.fragPlaying||this.getAppendedFrag(media.currentTime):null}},{key:"currentProgramDateTime",get:function(){var media=this.media;if(media){var currentTime=media.currentTime,frag=this.currentFrag;if(frag&&isFiniteNumber(currentTime)&&isFiniteNumber(frag.programDateTime)){var epocMs=frag.programDateTime+1e3*(currentTime-frag.start);return new Date(epocMs)}}return null}},{key:"currentLevel",get:function(){var frag=this.currentFrag;return frag?frag.level:-1}},{key:"nextBufferedFrag",get:function(){var frag=this.currentFrag;return frag?this.followingBufferedFrag(frag):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),StreamController})(BaseStreamController),Hls=(function(){function Hls(userConfig){void 0===userConfig&&(userConfig={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this.started=!1,this._emitter=new EventEmitter,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,this.triggeringException=void 0,enableLogs(userConfig.debug||!1,"Hls instance");var config=this.config=mergeConfig(Hls.DefaultConfig,userConfig);this.userConfig=userConfig,config.progressive&&enableStreamingMode(config);var ConfigAbrController=config.abrController,ConfigBufferController=config.bufferController,ConfigCapLevelController=config.capLevelController,ConfigErrorController=config.errorController,ConfigFpsController=config.fpsController,errorController=new ConfigErrorController(this),abrController=this.abrController=new ConfigAbrController(this),bufferController=this.bufferController=new ConfigBufferController(this),capLevelController=this.capLevelController=new ConfigCapLevelController(this),fpsController=new ConfigFpsController(this),playListLoader=new PlaylistLoader(this),id3TrackController=new ID3TrackController(this),ConfigContentSteeringController=config.contentSteeringController,contentSteering=ConfigContentSteeringController?new ConfigContentSteeringController(this):null,levelController=this.levelController=new LevelController(this,contentSteering),fragmentTracker=new FragmentTracker(this),keyLoader=new KeyLoader(this.config),streamController=this.streamController=new StreamController(this,fragmentTracker,keyLoader);capLevelController.setStreamController(streamController),fpsController.setStreamController(streamController);var networkControllers=[playListLoader,levelController,streamController];contentSteering&&networkControllers.splice(1,0,contentSteering),this.networkControllers=networkControllers;var coreComponents=[abrController,bufferController,capLevelController,fpsController,id3TrackController,fragmentTracker];this.audioTrackController=this.createController(config.audioTrackController,networkControllers);var AudioStreamControllerClass=config.audioStreamController;AudioStreamControllerClass&&networkControllers.push(new AudioStreamControllerClass(this,fragmentTracker,keyLoader)),this.subtitleTrackController=this.createController(config.subtitleTrackController,networkControllers);var SubtitleStreamControllerClass=config.subtitleStreamController;SubtitleStreamControllerClass&&networkControllers.push(new SubtitleStreamControllerClass(this,fragmentTracker,keyLoader)),this.createController(config.timelineController,coreComponents),keyLoader.emeController=this.emeController=this.createController(config.emeController,coreComponents),this.cmcdController=this.createController(config.cmcdController,coreComponents),this.latencyController=this.createController(LatencyController,coreComponents),this.coreComponents=coreComponents,networkControllers.push(errorController);var onErrorOut=errorController.onErrorOut;"function"==typeof onErrorOut&&this.on(Events.ERROR,onErrorOut,errorController)}Hls.isMSESupported=function(){return isMSESupported()},Hls.isSupported=function(){return isSupported()},Hls.getMediaSource=function(){return getMediaSource()};var _proto=Hls.prototype;return _proto.createController=function(ControllerClass,components){if(ControllerClass){var controllerInstance=new ControllerClass(this);return components&&components.push(controllerInstance),controllerInstance}return null},_proto.on=function(event,listener,context){void 0===context&&(context=this),this._emitter.on(event,listener,context)},_proto.once=function(event,listener,context){void 0===context&&(context=this),this._emitter.once(event,listener,context)},_proto.removeAllListeners=function(event){this._emitter.removeAllListeners(event)},_proto.off=function(event,listener,context,once){void 0===context&&(context=this),this._emitter.off(event,listener,context,once)},_proto.listeners=function(event){return this._emitter.listeners(event)},_proto.emit=function(event,name,eventObject){return this._emitter.emit(event,name,eventObject)},_proto.trigger=function(event,eventObject){if(this.config.debug)return this.emit(event,event,eventObject);try{return this.emit(event,event,eventObject)}catch(error){if(logger.error("An internal error happened while handling event "+event+'. Error message: "'+error.message+'". Here is a stacktrace:',error),!this.triggeringException){this.triggeringException=!0;var fatal=event===Events.ERROR;this.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,fatal:fatal,event:event,error:error}),this.triggeringException=!1}}return!1},_proto.listenerCount=function(event){return this._emitter.listenerCount(event)},_proto.destroy=function(){logger.log("destroy"),this.trigger(Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach((function(component){return component.destroy()})),this.networkControllers.length=0,this.coreComponents.forEach((function(component){return component.destroy()})),this.coreComponents.length=0;var config=this.config;config.xhrSetup=config.fetchSetup=void 0,this.userConfig=null},_proto.attachMedia=function(media){logger.log("attachMedia"),this._media=media,this.trigger(Events.MEDIA_ATTACHING,{media:media})},_proto.detachMedia=function(){logger.log("detachMedia"),this.trigger(Events.MEDIA_DETACHING,void 0),this._media=null},_proto.loadSource=function(url){this.stopLoad();var media=this.media,loadedSource=this.url,loadingSource=this.url=urlToolkitExports.buildAbsoluteURL(self.location.href,url,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,logger.log("loadSource:"+loadingSource),media&&loadedSource&&(loadedSource!==loadingSource||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(media)),this.trigger(Events.MANIFEST_LOADING,{url:url})},_proto.startLoad=function(startPosition){void 0===startPosition&&(startPosition=-1),logger.log("startLoad("+startPosition+")"),this.started=!0,this.networkControllers.forEach((function(controller){controller.startLoad(startPosition)}))},_proto.stopLoad=function(){logger.log("stopLoad"),this.started=!1,this.networkControllers.forEach((function(controller){controller.stopLoad()}))},_proto.resumeBuffering=function(){this.started&&this.networkControllers.forEach((function(controller){"fragmentLoader"in controller&&controller.startLoad(-1)}))},_proto.pauseBuffering=function(){this.networkControllers.forEach((function(controller){"fragmentLoader"in controller&&controller.stopLoad()}))},_proto.swapAudioCodec=function(){logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},_proto.recoverMediaError=function(){logger.log("recoverMediaError");var media=this._media;this.detachMedia(),media&&this.attachMedia(media)},_proto.removeLevel=function(levelIndex){this.levelController.removeLevel(levelIndex)},_proto.setAudioOption=function(audioOption){var _this$audioTrackContr;return null==(_this$audioTrackContr=this.audioTrackController)?void 0:_this$audioTrackContr.setAudioOption(audioOption)},_proto.setSubtitleOption=function(subtitleOption){var _this$subtitleTrackCo;return null==(_this$subtitleTrackCo=this.subtitleTrackController)||_this$subtitleTrackCo.setSubtitleOption(subtitleOption),null},_createClass(Hls,[{key:"levels",get:function(){var levels=this.levelController.levels;return levels||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(newLevel){logger.log("set currentLevel:"+newLevel),this.levelController.manualLevel=newLevel,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(newLevel){logger.log("set nextLevel:"+newLevel),this.levelController.manualLevel=newLevel,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(newLevel){logger.log("set loadLevel:"+newLevel),this.levelController.manualLevel=newLevel}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(level){this.levelController.nextLoadLevel=level}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(newLevel){logger.log("set firstLevel:"+newLevel),this.levelController.firstLevel=newLevel}},{key:"startLevel",get:function(){var startLevel=this.levelController.startLevel;return-1===startLevel&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:startLevel},set:function(newLevel){logger.log("set startLevel:"+newLevel),-1!==newLevel&&(newLevel=Math.max(newLevel,this.minAutoLevel)),this.levelController.startLevel=newLevel}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(shouldStartCapping){var newCapLevelToPlayerSize=!!shouldStartCapping;newCapLevelToPlayerSize!==this.config.capLevelToPlayerSize&&(newCapLevelToPlayerSize?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=newCapLevelToPlayerSize)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(newLevel){this._autoLevelCapping!==newLevel&&(logger.log("set autoLevelCapping:"+newLevel),this._autoLevelCapping=newLevel,this.levelController.checkMaxAutoUpdated())}},{key:"bandwidthEstimate",get:function(){var bwEstimator=this.abrController.bwEstimator;return bwEstimator?bwEstimator.getEstimate():NaN},set:function(abrEwmaDefaultEstimate){this.abrController.resetEstimator(abrEwmaDefaultEstimate)}},{key:"ttfbEstimate",get:function(){var bwEstimator=this.abrController.bwEstimator;return bwEstimator?bwEstimator.getEstimateTTFB():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(value){isHdcpLevel(value)&&this._maxHdcpLevel!==value&&(this._maxHdcpLevel=value,this.levelController.checkMaxAutoUpdated())}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var levels=this.levels,minAutoBitrate=this.config.minAutoBitrate;if(!levels)return 0;for(var len=levels.length,i=0;i<len;i++)if(levels[i].maxBitrate>=minAutoBitrate)return i;return 0}},{key:"maxAutoLevel",get:function(){var maxAutoLevel,levels=this.levels,autoLevelCapping=this.autoLevelCapping,maxHdcpLevel=this.maxHdcpLevel;if(maxAutoLevel=-1===autoLevelCapping&&null!=levels&&levels.length?levels.length-1:autoLevelCapping,maxHdcpLevel)for(var i=maxAutoLevel;i--;){var hdcpLevel=levels[i].attrs["HDCP-LEVEL"];if(hdcpLevel&&hdcpLevel<=maxHdcpLevel)return i}return maxAutoLevel}},{key:"firstAutoLevel",get:function(){return this.abrController.firstAutoLevel}},{key:"nextAutoLevel",get:function(){return this.abrController.nextAutoLevel},set:function(nextLevel){this.abrController.nextAutoLevel=nextLevel}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"allAudioTracks",get:function(){var audioTrackController=this.audioTrackController;return audioTrackController?audioTrackController.allAudioTracks:[]}},{key:"audioTracks",get:function(){var audioTrackController=this.audioTrackController;return audioTrackController?audioTrackController.audioTracks:[]}},{key:"audioTrack",get:function(){var audioTrackController=this.audioTrackController;return audioTrackController?audioTrackController.audioTrack:-1},set:function(audioTrackId){var audioTrackController=this.audioTrackController;audioTrackController&&(audioTrackController.audioTrack=audioTrackId)}},{key:"allSubtitleTracks",get:function(){var subtitleTrackController=this.subtitleTrackController;return subtitleTrackController?subtitleTrackController.allSubtitleTracks:[]}},{key:"subtitleTracks",get:function(){var subtitleTrackController=this.subtitleTrackController;return subtitleTrackController?subtitleTrackController.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var subtitleTrackController=this.subtitleTrackController;return subtitleTrackController?subtitleTrackController.subtitleTrack:-1},set:function(subtitleTrackId){var subtitleTrackController=this.subtitleTrackController;subtitleTrackController&&(subtitleTrackController.subtitleTrack=subtitleTrackId)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var subtitleTrackController=this.subtitleTrackController;return!!subtitleTrackController&&subtitleTrackController.subtitleDisplay},set:function(value){var subtitleTrackController=this.subtitleTrackController;subtitleTrackController&&(subtitleTrackController.subtitleDisplay=value)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(mode){this.config.lowLatencyMode=mode}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.5.5-0.canary.9893"}},{key:"Events",get:function(){return Events}},{key:"ErrorTypes",get:function(){return ErrorTypes}},{key:"ErrorDetails",get:function(){return ErrorDetails}},{key:"DefaultConfig",get:function(){return Hls.defaultConfig?Hls.defaultConfig:hlsDefaultConfig},set:function(defaultConfig){Hls.defaultConfig=defaultConfig}}]),Hls})();return Hls.defaultConfig=void 0,Hls})()})(!1)},645:(__unused_webpack_module,exports)=>{exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:1/0*(s?-1:1);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=value<0||0===value&&1/value<0?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),(value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias))*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}},3465:(module,exports,__webpack_require__)=>{module=__webpack_require__.nmd(module);var argsTag="[object Arguments]",boolTag="[object Boolean]",funcTag="[object Function]",genTag="[object GeneratorFunction]",mapTag="[object Map]",setTag="[object Set]",dataViewTag="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",reFlags=/\w*$/,reIsHostCtor=/^\[object .+?Constructor\]$/,reIsUint=/^(?:0|[1-9]\d*)$/,cloneableTags={};cloneableTags[argsTag]=cloneableTags["[object Array]"]=cloneableTags["[object ArrayBuffer]"]=cloneableTags["[object DataView]"]=cloneableTags["[object Boolean]"]=cloneableTags["[object Date]"]=cloneableTags["[object Float32Array]"]=cloneableTags["[object Float64Array]"]=cloneableTags["[object Int8Array]"]=cloneableTags["[object Int16Array]"]=cloneableTags["[object Int32Array]"]=cloneableTags[mapTag]=cloneableTags["[object Number]"]=cloneableTags["[object Object]"]=cloneableTags["[object RegExp]"]=cloneableTags[setTag]=cloneableTags["[object String]"]=cloneableTags["[object Symbol]"]=cloneableTags["[object Uint8Array]"]=cloneableTags["[object Uint8ClampedArray]"]=cloneableTags["[object Uint16Array]"]=cloneableTags["[object Uint32Array]"]=!0,cloneableTags["[object Error]"]=cloneableTags[funcTag]=cloneableTags["[object WeakMap]"]=!1;var freeGlobal="object"==typeof __webpack_require__.g&&__webpack_require__.g&&__webpack_require__.g.Object===Object&&__webpack_require__.g,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")(),freeExports=exports&&!exports.nodeType&&exports,freeModule=freeExports&&module&&!module.nodeType&&module,moduleExports=freeModule&&freeModule.exports===freeExports;function addMapEntry(map,pair){return map.set(pair[0],pair[1]),map}function addSetEntry(set,value){return set.add(value),set}function arrayReduce(array,iteratee,accumulator,initAccum){var index=-1,length=array?array.length:0;for(initAccum&&length&&(accumulator=array[++index]);++index<length;)accumulator=iteratee(accumulator,array[index],index,array);return accumulator}function isHostObject(value){var result=!1;if(null!=value&&"function"!=typeof value.toString)try{result=!!(value+"")}catch(e){}return result}function mapToArray(map){var index=-1,result=Array(map.size);return map.forEach((function(value,key){result[++index]=[key,value]})),result}function overArg(func,transform){return function(arg){return func(transform(arg))}}function setToArray(set){var index=-1,result=Array(set.size);return set.forEach((function(value){result[++index]=value})),result}var uid,arrayProto=Array.prototype,funcProto=Function.prototype,objectProto=Object.prototype,coreJsData=root["__core-js_shared__"],maskSrcKey=(uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||""))?"Symbol(src)_1."+uid:"",funcToString=funcProto.toString,hasOwnProperty=objectProto.hasOwnProperty,objectToString=objectProto.toString,reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Buffer=moduleExports?root.Buffer:void 0,Symbol=root.Symbol,Uint8Array=root.Uint8Array,getPrototype=overArg(Object.getPrototypeOf,Object),objectCreate=Object.create,propertyIsEnumerable=objectProto.propertyIsEnumerable,splice=arrayProto.splice,nativeGetSymbols=Object.getOwnPropertySymbols,nativeIsBuffer=Buffer?Buffer.isBuffer:void 0,nativeKeys=overArg(Object.keys,Object),DataView=getNative(root,"DataView"),Map=getNative(root,"Map"),Promise=getNative(root,"Promise"),Set=getNative(root,"Set"),WeakMap=getNative(root,"WeakMap"),nativeCreate=getNative(Object,"create"),dataViewCtorString=toSource(DataView),mapCtorString=toSource(Map),promiseCtorString=toSource(Promise),setCtorString=toSource(Set),weakMapCtorString=toSource(WeakMap),symbolProto=Symbol?Symbol.prototype:void 0,symbolValueOf=symbolProto?symbolProto.valueOf:void 0;function Hash(entries){var index=-1,length=entries?entries.length:0;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function ListCache(entries){var index=-1,length=entries?entries.length:0;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function MapCache(entries){var index=-1,length=entries?entries.length:0;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function Stack(entries){this.__data__=new ListCache(entries)}function arrayLikeKeys(value,inherited){var result=isArray(value)||(function(value){return(function(value){return(function(value){return!!value&&"object"==typeof value})(value)&&isArrayLike(value)})(value)&&hasOwnProperty.call(value,"callee")&&(!propertyIsEnumerable.call(value,"callee")||objectToString.call(value)==argsTag)})(value)?(function(n,iteratee){for(var index=-1,result=Array(n);++index<n;)result[index]=iteratee(index);return result})(value.length,String):[],length=result.length,skipIndexes=!!length;for(var key in value)!inherited&&!hasOwnProperty.call(value,key)||skipIndexes&&("length"==key||isIndex(key,length))||result.push(key);return result}function assignValue(object,key,value){var objValue=object[key];hasOwnProperty.call(object,key)&&eq(objValue,value)&&(void 0!==value||key in object)||(object[key]=value)}function assocIndexOf(array,key){for(var length=array.length;length--;)if(eq(array[length][0],key))return length;return-1}function baseClone(value,isDeep,isFull,customizer,key,object,stack){var result;if(customizer&&(result=object?customizer(value,key,object,stack):customizer(value)),void 0!==result)return result;if(!isObject(value))return value;var isArr=isArray(value);if(isArr){if(result=(function(array){var length=array.length,result=array.constructor(length);length&&"string"==typeof array[0]&&hasOwnProperty.call(array,"index")&&(result.index=array.index,result.input=array.input);return result})(value),!isDeep)return(function(source,array){var index=-1,length=source.length;array||(array=Array(length));for(;++index<length;)array[index]=source[index];return array})(value,result)}else{var tag=getTag(value),isFunc=tag==funcTag||tag==genTag;if(isBuffer(value))return(function(buffer,isDeep){if(isDeep)return buffer.slice();var result=new buffer.constructor(buffer.length);return buffer.copy(result),result})(value,isDeep);if("[object Object]"==tag||tag==argsTag||isFunc&&!object){if(isHostObject(value))return object?value:{};if(result=(function(object){return"function"!=typeof object.constructor||isPrototype(object)?{}:(proto=getPrototype(object),isObject(proto)?objectCreate(proto):{});var proto})(isFunc?{}:value),!isDeep)return(function(source,object){return copyObject(source,getSymbols(source),object)})(value,(function(object,source){return object&&copyObject(source,keys(source),object)})(result,value))}else{if(!cloneableTags[tag])return object?value:{};result=(function(object,tag,cloneFunc,isDeep){var Ctor=object.constructor;switch(tag){case"[object ArrayBuffer]":return cloneArrayBuffer(object);case boolTag:case"[object Date]":return new Ctor(+object);case dataViewTag:return(function(dataView,isDeep){var buffer=isDeep?cloneArrayBuffer(dataView.buffer):dataView.buffer;return new dataView.constructor(buffer,dataView.byteOffset,dataView.byteLength)})(object,isDeep);case float32Tag:case float64Tag:case int8Tag:case int16Tag:case int32Tag:case uint8Tag:case"[object Uint8ClampedArray]":case uint16Tag:case uint32Tag:return(function(typedArray,isDeep){var buffer=isDeep?cloneArrayBuffer(typedArray.buffer):typedArray.buffer;return new typedArray.constructor(buffer,typedArray.byteOffset,typedArray.length)})(object,isDeep);case mapTag:return(function(map,isDeep,cloneFunc){return arrayReduce(isDeep?cloneFunc(mapToArray(map),!0):mapToArray(map),addMapEntry,new map.constructor)})(object,isDeep,cloneFunc);case"[object Number]":case"[object String]":return new Ctor(object);case"[object RegExp]":return(function(regexp){var result=new regexp.constructor(regexp.source,reFlags.exec(regexp));return result.lastIndex=regexp.lastIndex,result})(object);case setTag:return(function(set,isDeep,cloneFunc){return arrayReduce(isDeep?cloneFunc(setToArray(set),!0):setToArray(set),addSetEntry,new set.constructor)})(object,isDeep,cloneFunc);case"[object Symbol]":return symbol=object,symbolValueOf?Object(symbolValueOf.call(symbol)):{}}var symbol})(value,tag,baseClone,isDeep)}}stack||(stack=new Stack);var stacked=stack.get(value);if(stacked)return stacked;if(stack.set(value,result),!isArr)var props=isFull?(function(object){return(function(object,keysFunc,symbolsFunc){var result=keysFunc(object);return isArray(object)?result:(function(array,values){for(var index=-1,length=values.length,offset=array.length;++index<length;)array[offset+index]=values[index];return array})(result,symbolsFunc(object))})(object,keys,getSymbols)})(value):keys(value);return(function(array,iteratee){for(var index=-1,length=array?array.length:0;++index<length&&!1!==iteratee(array[index],index,array););})(props||value,(function(subValue,key){props&&(subValue=value[key=subValue]),assignValue(result,key,baseClone(subValue,isDeep,isFull,customizer,key,value,stack))})),result}function baseIsNative(value){return!(!isObject(value)||(func=value,maskSrcKey&&maskSrcKey in func))&&(isFunction(value)||isHostObject(value)?reIsNative:reIsHostCtor).test(toSource(value));var func}function cloneArrayBuffer(arrayBuffer){var result=new arrayBuffer.constructor(arrayBuffer.byteLength);return new Uint8Array(result).set(new Uint8Array(arrayBuffer)),result}function copyObject(source,props,object,customizer){object||(object={});for(var index=-1,length=props.length;++index<length;){var key=props[index],newValue=customizer?customizer(object[key],source[key],key,object,source):void 0;assignValue(object,key,void 0===newValue?source[key]:newValue)}return object}function getMapData(map,key){var value,type,data=map.__data__;return("string"==(type=typeof(value=key))||"number"==type||"symbol"==type||"boolean"==type?"__proto__"!==value:null===value)?data["string"==typeof key?"string":"hash"]:data.map}function getNative(object,key){var value=(function(object,key){return null==object?void 0:object[key]})(object,key);return baseIsNative(value)?value:void 0}Hash.prototype.clear=function(){this.__data__=nativeCreate?nativeCreate(null):{}},Hash.prototype.delete=function(key){return this.has(key)&&delete this.__data__[key]},Hash.prototype.get=function(key){var data=this.__data__;if(nativeCreate){var result=data[key];return"__lodash_hash_undefined__"===result?void 0:result}return hasOwnProperty.call(data,key)?data[key]:void 0},Hash.prototype.has=function(key){var data=this.__data__;return nativeCreate?void 0!==data[key]:hasOwnProperty.call(data,key)},Hash.prototype.set=function(key,value){return this.__data__[key]=nativeCreate&&void 0===value?"__lodash_hash_undefined__":value,this},ListCache.prototype.clear=function(){this.__data__=[]},ListCache.prototype.delete=function(key){var data=this.__data__,index=assocIndexOf(data,key);return!(index<0)&&(index==data.length-1?data.pop():splice.call(data,index,1),!0)},ListCache.prototype.get=function(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?void 0:data[index][1]},ListCache.prototype.has=function(key){return assocIndexOf(this.__data__,key)>-1},ListCache.prototype.set=function(key,value){var data=this.__data__,index=assocIndexOf(data,key);return index<0?data.push([key,value]):data[index][1]=value,this},MapCache.prototype.clear=function(){this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}},MapCache.prototype.delete=function(key){return getMapData(this,key).delete(key)},MapCache.prototype.get=function(key){return getMapData(this,key).get(key)},MapCache.prototype.has=function(key){return getMapData(this,key).has(key)},MapCache.prototype.set=function(key,value){return getMapData(this,key).set(key,value),this},Stack.prototype.clear=function(){this.__data__=new ListCache},Stack.prototype.delete=function(key){return this.__data__.delete(key)},Stack.prototype.get=function(key){return this.__data__.get(key)},Stack.prototype.has=function(key){return this.__data__.has(key)},Stack.prototype.set=function(key,value){var cache=this.__data__;if(cache instanceof ListCache){var pairs=cache.__data__;if(!Map||pairs.length<199)return pairs.push([key,value]),this;cache=this.__data__=new MapCache(pairs)}return cache.set(key,value),this};var getSymbols=nativeGetSymbols?overArg(nativeGetSymbols,Object):function(){return[]},getTag=function(value){return objectToString.call(value)};function isIndex(value,length){return!!(length=null==length?9007199254740991:length)&&("number"==typeof value||reIsUint.test(value))&&value>-1&&value%1==0&&value<length}function isPrototype(value){var Ctor=value&&value.constructor;return value===("function"==typeof Ctor&&Ctor.prototype||objectProto)}function toSource(func){if(null!=func){try{return funcToString.call(func)}catch(e){}try{return func+""}catch(e){}}return""}function eq(value,other){return value===other||value!=value&&other!=other}(DataView&&getTag(new DataView(new ArrayBuffer(1)))!=dataViewTag||Map&&getTag(new Map)!=mapTag||Promise&&"[object Promise]"!=getTag(Promise.resolve())||Set&&getTag(new Set)!=setTag||WeakMap&&"[object WeakMap]"!=getTag(new WeakMap))&&(getTag=function(value){var result=objectToString.call(value),Ctor="[object Object]"==result?value.constructor:void 0,ctorString=Ctor?toSource(Ctor):void 0;if(ctorString)switch(ctorString){case dataViewCtorString:return dataViewTag;case mapCtorString:return mapTag;case promiseCtorString:return"[object Promise]";case setCtorString:return setTag;case weakMapCtorString:return"[object WeakMap]"}return result});var isArray=Array.isArray;function isArrayLike(value){return null!=value&&(function(value){return"number"==typeof value&&value>-1&&value%1==0&&value<=9007199254740991})(value.length)&&!isFunction(value)}var isBuffer=nativeIsBuffer||function(){return!1};function isFunction(value){var tag=isObject(value)?objectToString.call(value):"";return tag==funcTag||tag==genTag}function isObject(value){var type=typeof value;return!!value&&("object"==type||"function"==type)}function keys(object){return isArrayLike(object)?arrayLikeKeys(object):(function(object){if(!isPrototype(object))return nativeKeys(object);var result=[];for(var key in Object(object))hasOwnProperty.call(object,key)&&"constructor"!=key&&result.push(key);return result})(object)}module.exports=function(value){return baseClone(value,!0,!0)}},9566:(module,__unused_webpack_exports,__webpack_require__)=>{var Buffer=__webpack_require__(8764).Buffer;module.exports=magnetURIDecode,module.exports.decode=magnetURIDecode,module.exports.encode=function(obj){obj=Object.assign({},obj);let xts=new Set;obj.xt&&"string"==typeof obj.xt&&xts.add(obj.xt);obj.xt&&Array.isArray(obj.xt)&&(xts=new Set(obj.xt));obj.infoHashBuffer&&xts.add(`urn:btih:${obj.infoHashBuffer.toString("hex")}`);obj.infoHash&&xts.add(`urn:btih:${obj.infoHash}`);obj.infoHashV2Buffer&&xts.add(obj.xt=`urn:btmh:1220${obj.infoHashV2Buffer.toString("hex")}`);obj.infoHashV2&&xts.add(`urn:btmh:1220${obj.infoHashV2}`);const xtsDeduped=Array.from(xts);1===xtsDeduped.length&&(obj.xt=xtsDeduped[0]);xtsDeduped.length>1&&(obj.xt=xtsDeduped);obj.publicKeyBuffer&&(obj.xs=`urn:btpk:${obj.publicKeyBuffer.toString("hex")}`);obj.publicKey&&(obj.xs=`urn:btpk:${obj.publicKey}`);obj.name&&(obj.dn=obj.name);obj.keywords&&(obj.kt=obj.keywords);obj.announce&&(obj.tr=obj.announce);obj.urlList&&(obj.ws=obj.urlList,delete obj.as);obj.peerAddresses&&(obj["x.pe"]=obj.peerAddresses);let result="magnet:?";return Object.keys(obj).filter((key=>2===key.length||"x.pe"===key)).forEach(((key,i)=>{const values=Array.isArray(obj[key])?obj[key]:[obj[key]];values.forEach(((val,j)=>{(i>0||j>0)&&("kt"!==key&&"so"!==key||0===j)&&(result+="&"),"dn"===key&&(val=encodeURIComponent(val).replace(/%20/g,"+")),"tr"!==key&&"as"!==key&&"ws"!==key||(val=encodeURIComponent(val)),"xs"!==key||val.startsWith("urn:btpk:")||(val=encodeURIComponent(val)),"kt"===key&&(val=encodeURIComponent(val)),"so"!==key&&(result+="kt"===key&&j>0?`+${val}`:`${key}=${val}`)})),"so"===key&&(result+=`${key}=${bep53Range.compose(values)}`)})),result};const base32=__webpack_require__(5017),bep53Range=__webpack_require__(7500);function magnetURIDecode(uri){const result={},data=uri.split("magnet:?")[1];let m;if((data&&data.length>=0?data.split("&"):[]).forEach((param=>{const keyval=param.split("=");if(2!==keyval.length)return;const key=keyval[0];let val=keyval[1];"dn"===key&&(val=decodeURIComponent(val).replace(/\+/g," ")),"tr"!==key&&"xs"!==key&&"as"!==key&&"ws"!==key||(val=decodeURIComponent(val)),"kt"===key&&(val=decodeURIComponent(val).split("+")),"ix"===key&&(val=Number(val)),"so"===key&&(val=bep53Range.parse(decodeURIComponent(val).split(","))),result[key]?(Array.isArray(result[key])||(result[key]=[result[key]]),result[key].push(val)):result[key]=val})),result.xt){(Array.isArray(result.xt)?result.xt:[result.xt]).forEach((xt=>{if(m=xt.match(/^urn:btih:(.{40})/))result.infoHash=m[1].toLowerCase();else if(m=xt.match(/^urn:btih:(.{32})/)){const decodedStr=base32.decode(m[1]);result.infoHash=Buffer.from(decodedStr,"binary").toString("hex")}else(m=xt.match(/^urn:btmh:1220(.{64})/))&&(result.infoHashV2=m[1].toLowerCase())}))}if(result.xs){(Array.isArray(result.xs)?result.xs:[result.xs]).forEach((xs=>{(m=xs.match(/^urn:btpk:(.{64})/))&&(result.publicKey=m[1].toLowerCase())}))}return result.infoHash&&(result.infoHashBuffer=Buffer.from(result.infoHash,"hex")),result.infoHashV2&&(result.infoHashV2Buffer=Buffer.from(result.infoHashV2,"hex")),result.publicKey&&(result.publicKeyBuffer=Buffer.from(result.publicKey,"hex")),result.dn&&(result.name=result.dn),result.kt&&(result.keywords=result.kt),result.announce=[],("string"==typeof result.tr||Array.isArray(result.tr))&&(result.announce=result.announce.concat(result.tr)),result.urlList=[],("string"==typeof result.as||Array.isArray(result.as))&&(result.urlList=result.urlList.concat(result.as)),("string"==typeof result.ws||Array.isArray(result.ws))&&(result.urlList=result.urlList.concat(result.ws)),result.peerAddresses=[],("string"==typeof result["x.pe"]||Array.isArray(result["x.pe"]))&&(result.peerAddresses=result.peerAddresses.concat(result["x.pe"])),result.announce=Array.from(new Set(result.announce)),result.urlList=Array.from(new Set(result.urlList)),result.peerAddresses=Array.from(new Set(result.peerAddresses)),result}},751:module=>{module.exports={"app-container":"app-container-nMkA3",layer:"layer-i5dYf","video-layer":"video-layer-_EMHF",video:"video-phdOx","info-layer":"info-layer-XtbF5",logo:"logo-_Azd5",label:"label-BJP44"}},7418:module=>{"use strict";var getOwnPropertySymbols=Object.getOwnPropertySymbols,hasOwnProperty=Object.prototype.hasOwnProperty,propIsEnumerable=Object.prototype.propertyIsEnumerable;function toObject(val){if(null==val)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(val)}module.exports=(function(){try{if(!Object.assign)return!1;var test1=new String("abc");if(test1[5]="de","5"===Object.getOwnPropertyNames(test1)[0])return!1;for(var test2={},i=0;i<10;i++)test2["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(test2).map((function(n){return test2[n]})).join(""))return!1;var test3={};return"abcdefghijklmnopqrst".split("").forEach((function(letter){test3[letter]=letter})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},test3)).join("")}catch(err){return!1}})()?Object.assign:function(target,source){for(var from,symbols,to=toObject(target),s=1;s<arguments.length;s++){for(var key in from=Object(arguments[s]))hasOwnProperty.call(from,key)&&(to[key]=from[key]);if(getOwnPropertySymbols){symbols=getOwnPropertySymbols(from);for(var i=0;i<symbols.length;i++)propIsEnumerable.call(from,symbols[i])&&(to[symbols[i]]=from[symbols[i]])}}return to}},4971:function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_RESULT__;module=__webpack_require__.nmd(module),(function(root){exports&&exports.nodeType,module&&module.nodeType;var freeGlobal="object"==typeof __webpack_require__.g&&__webpack_require__.g;freeGlobal.global!==freeGlobal&&freeGlobal.window!==freeGlobal&&freeGlobal.self;var punycode,maxInt=2147483647,regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},floor=Math.floor,stringFromCharCode=String.fromCharCode;function error(type){throw RangeError(errors[type])}function map(array,fn){for(var length=array.length,result=[];length--;)result[length]=fn(array[length]);return result}function mapDomain(string,fn){var parts=string.split("@"),result="";return parts.length>1&&(result=parts[0]+"@",string=parts[1]),result+map((string=string.replace(regexSeparators,".")).split("."),fn).join(".")}function ucs2decode(string){for(var value,extra,output=[],counter=0,length=string.length;counter<length;)(value=string.charCodeAt(counter++))>=55296&&value<=56319&&counter<length?56320==(64512&(extra=string.charCodeAt(counter++)))?output.push(((1023&value)<<10)+(1023&extra)+65536):(output.push(value),counter--):output.push(value);return output}function ucs2encode(array){return map(array,(function(value){var output="";return value>65535&&(output+=stringFromCharCode((value-=65536)>>>10&1023|55296),value=56320|1023&value),output+=stringFromCharCode(value)})).join("")}function digitToBasic(digit,flag){return digit+22+75*(digit<26)-((0!=flag)<<5)}function adapt(delta,numPoints,firstTime){var k=0;for(delta=firstTime?floor(delta/700):delta>>1,delta+=floor(delta/numPoints);delta>455;k+=36)delta=floor(delta/35);return floor(k+36*delta/(delta+38))}function decode(input){var out,basic,j,index,oldi,w,k,digit,t,baseMinusT,codePoint,output=[],inputLength=input.length,i=0,n=128,bias=72;for((basic=input.lastIndexOf("-"))<0&&(basic=0),j=0;j<basic;++j)input.charCodeAt(j)>=128&&error("not-basic"),output.push(input.charCodeAt(j));for(index=basic>0?basic+1:0;index<inputLength;){for(oldi=i,w=1,k=36;index>=inputLength&&error("invalid-input"),((digit=(codePoint=input.charCodeAt(index++))-48<10?codePoint-22:codePoint-65<26?codePoint-65:codePoint-97<26?codePoint-97:36)>=36||digit>floor((maxInt-i)/w))&&error("overflow"),i+=digit*w,!(digit<(t=k<=bias?1:k>=bias+26?26:k-bias));k+=36)w>floor(maxInt/(baseMinusT=36-t))&&error("overflow"),w*=baseMinusT;bias=adapt(i-oldi,out=output.length+1,0==oldi),floor(i/out)>maxInt-n&&error("overflow"),n+=floor(i/out),i%=out,output.splice(i++,0,n)}return ucs2encode(output)}function encode(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,inputLength,handledCPCountPlusOne,baseMinusT,qMinusT,output=[];for(inputLength=(input=ucs2decode(input)).length,n=128,delta=0,bias=72,j=0;j<inputLength;++j)(currentValue=input[j])<128&&output.push(stringFromCharCode(currentValue));for(handledCPCount=basicLength=output.length,basicLength&&output.push("-");handledCPCount<inputLength;){for(m=maxInt,j=0;j<inputLength;++j)(currentValue=input[j])>=n&&currentValue<m&&(m=currentValue);for(m-n>floor((maxInt-delta)/(handledCPCountPlusOne=handledCPCount+1))&&error("overflow"),delta+=(m-n)*handledCPCountPlusOne,n=m,j=0;j<inputLength;++j)if((currentValue=input[j])<n&&++delta>maxInt&&error("overflow"),currentValue==n){for(q=delta,k=36;!(q<(t=k<=bias?1:k>=bias+26?26:k-bias));k+=36)qMinusT=q-t,baseMinusT=36-t,output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0))),q=floor(qMinusT/baseMinusT);output.push(stringFromCharCode(digitToBasic(q,0))),bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength),delta=0,++handledCPCount}++delta,++n}return output.join("")}punycode={version:"1.3.2",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode,encode:encode,toASCII:function(input){return mapDomain(input,(function(string){return regexNonASCII.test(string)?"xn--"+encode(string):string}))},toUnicode:function(input){return mapDomain(input,(function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string}))}},void 0===(__WEBPACK_AMD_DEFINE_RESULT__=function(){return punycode}.call(exports,__webpack_require__,exports,module))||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)})()},2587:module=>{"use strict";function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}module.exports=function(qs,sep,eq,options){sep=sep||"&",eq=eq||"=";var obj={};if("string"!=typeof qs||0===qs.length)return obj;var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;options&&"number"==typeof options.maxKeys&&(maxKeys=options.maxKeys);var len=qs.length;maxKeys>0&&len>maxKeys&&(len=maxKeys);for(var i=0;i<len;++i){var kstr,vstr,k,v,x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq);idx>=0?(kstr=x.substr(0,idx),vstr=x.substr(idx+1)):(kstr=x,vstr=""),k=decodeURIComponent(kstr),v=decodeURIComponent(vstr),hasOwnProperty(obj,k)?Array.isArray(obj[k])?obj[k].push(v):obj[k]=[obj[k],v]:obj[k]=v}return obj}},2361:module=>{"use strict";var stringifyPrimitive=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}};module.exports=function(obj,sep,eq,name){return sep=sep||"&",eq=eq||"=",null===obj&&(obj=void 0),"object"==typeof obj?Object.keys(obj).map((function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;return Array.isArray(obj[k])?obj[k].map((function(v){return ks+encodeURIComponent(stringifyPrimitive(v))})).join(sep):ks+encodeURIComponent(stringifyPrimitive(obj[k]))})).join(sep):name?encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj)):""}},7673:(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";exports.decode=exports.parse=__webpack_require__(2587),exports.encode=exports.stringify=__webpack_require__(2361)},4448:(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var aa=__webpack_require__(7294),n=__webpack_require__(7418),r=__webpack_require__(3840);function u(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!aa)throw Error(u(227));function ba(a,b,c,d,e,f,g,h,k){var l=Array.prototype.slice.call(arguments,3);try{b.apply(c,l)}catch(m){this.onError(m)}}var da=!1,ea=null,fa=!1,ha=null,ia={onError:function(a){da=!0,ea=a}};function ja(a,b,c,d,e,f,g,h,k){da=!1,ea=null,ba.apply(ia,arguments)}var la=null,ma=null,na=null;function oa(a,b,c){var d=a.type||"unknown-event";a.currentTarget=na(c),(function(a,b,c,d,e,f,g,h,k){if(ja.apply(this,arguments),da){if(!da)throw Error(u(198));var l=ea;da=!1,ea=null,fa||(fa=!0,ha=l)}})(d,b,void 0,a),a.currentTarget=null}var pa=null,qa={};function ra(){if(pa)for(var a in qa){var b=qa[a],c=pa.indexOf(a);if(!(-1<c))throw Error(u(96,a));if(!sa[c]){if(!b.extractEvents)throw Error(u(97,a));for(var d in sa[c]=b,c=b.eventTypes){var e=void 0,f=c[d],g=b,h=d;if(ta.hasOwnProperty(h))throw Error(u(99,h));ta[h]=f;var k=f.phasedRegistrationNames;if(k){for(e in k)k.hasOwnProperty(e)&&ua(k[e],g,h);e=!0}else f.registrationName?(ua(f.registrationName,g,h),e=!0):e=!1;if(!e)throw Error(u(98,d,a))}}}}function ua(a,b,c){if(va[a])throw Error(u(100,a));va[a]=b,wa[a]=b.eventTypes[c].dependencies}var sa=[],ta={},va={},wa={};function xa(a){var c,b=!1;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];if(!qa.hasOwnProperty(c)||qa[c]!==d){if(qa[c])throw Error(u(102,c));qa[c]=d,b=!0}}b&&ra()}var ya=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),za=null,Aa=null,Ba=null;function Ca(a){if(a=ma(a)){if("function"!=typeof za)throw Error(u(280));var b=a.stateNode;b&&(b=la(b),za(a.stateNode,a.type,b))}}function Da(a){Aa?Ba?Ba.push(a):Ba=[a]:Aa=a}function Ea(){if(Aa){var a=Aa,b=Ba;if(Ba=Aa=null,Ca(a),b)for(a=0;a<b.length;a++)Ca(b[a])}}function Fa(a,b){return a(b)}function Ga(a,b,c,d,e){return a(b,c,d,e)}function Ha(){}var Ia=Fa,Ja=!1,Ka=!1;function La(){null===Aa&&null===Ba||(Ha(),Ea())}function Ma(a,b,c){if(Ka)return a(b,c);Ka=!0;try{return Ia(a,b,c)}finally{Ka=!1,La()}}var Na=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Oa=Object.prototype.hasOwnProperty,Pa={},Qa={};function v(a,b,c,d,e,f){this.acceptsBooleans=2===b||3===b||4===b,this.attributeName=d,this.attributeNamespace=e,this.mustUseProperty=c,this.propertyName=a,this.type=b,this.sanitizeURL=f}var C={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(a){C[a]=new v(a,0,!1,a,null,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(a){var b=a[0];C[b]=new v(b,1,!1,a[1],null,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(a){C[a]=new v(a,2,!1,a.toLowerCase(),null,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(a){C[a]=new v(a,2,!1,a,null,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(a){C[a]=new v(a,3,!1,a.toLowerCase(),null,!1)})),["checked","multiple","muted","selected"].forEach((function(a){C[a]=new v(a,3,!0,a,null,!1)})),["capture","download"].forEach((function(a){C[a]=new v(a,4,!1,a,null,!1)})),["cols","rows","size","span"].forEach((function(a){C[a]=new v(a,6,!1,a,null,!1)})),["rowSpan","start"].forEach((function(a){C[a]=new v(a,5,!1,a.toLowerCase(),null,!1)}));var Ua=/[\-:]([a-z])/g;function Va(a){return a[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(a){var b=a.replace(Ua,Va);C[b]=new v(b,1,!1,a,null,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(a){var b=a.replace(Ua,Va);C[b]=new v(b,1,!1,a,"http://www.w3.org/1999/xlink",!1)})),["xml:base","xml:lang","xml:space"].forEach((function(a){var b=a.replace(Ua,Va);C[b]=new v(b,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1)})),["tabIndex","crossOrigin"].forEach((function(a){C[a]=new v(a,1,!1,a.toLowerCase(),null,!1)})),C.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0),["src","href","action","formAction"].forEach((function(a){C[a]=new v(a,1,!1,a.toLowerCase(),null,!0)}));var Wa=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function Xa(a,b,c,d){var e=C.hasOwnProperty(b)?C[b]:null;(null!==e?0===e.type:!d&&(2<b.length&&("o"===b[0]||"O"===b[0])&&("n"===b[1]||"N"===b[1])))||((function(a,b,c,d){if(null==b||(function(a,b,c,d){if(null!==c&&0===c.type)return!1;switch(typeof b){case"function":case"symbol":return!0;case"boolean":return!d&&(null!==c?!c.acceptsBooleans:"data-"!==(a=a.toLowerCase().slice(0,5))&&"aria-"!==a);default:return!1}})(a,b,c,d))return!0;if(d)return!1;if(null!==c)switch(c.type){case 3:return!b;case 4:return!1===b;case 5:return isNaN(b);case 6:return isNaN(b)||1>b}return!1})(b,c,e,d)&&(c=null),d||null===e?(function(a){return!!Oa.call(Qa,a)||!Oa.call(Pa,a)&&(Na.test(a)?Qa[a]=!0:(Pa[a]=!0,!1))})(b)&&(null===c?a.removeAttribute(b):a.setAttribute(b,""+c)):e.mustUseProperty?a[e.propertyName]=null===c?3!==e.type&&"":c:(b=e.attributeName,d=e.attributeNamespace,null===c?a.removeAttribute(b):(c=3===(e=e.type)||4===e&&!0===c?"":""+c,d?a.setAttributeNS(d,b,c):a.setAttribute(b,c))))}Wa.hasOwnProperty("ReactCurrentDispatcher")||(Wa.ReactCurrentDispatcher={current:null}),Wa.hasOwnProperty("ReactCurrentBatchConfig")||(Wa.ReactCurrentBatchConfig={suspense:null});var Ya=/^(.*)[\\\/]/,E="function"==typeof Symbol&&Symbol.for,Za=E?Symbol.for("react.element"):60103,$a=E?Symbol.for("react.portal"):60106,ab=E?Symbol.for("react.fragment"):60107,bb=E?Symbol.for("react.strict_mode"):60108,cb=E?Symbol.for("react.profiler"):60114,db=E?Symbol.for("react.provider"):60109,eb=E?Symbol.for("react.context"):60110,fb=E?Symbol.for("react.concurrent_mode"):60111,gb=E?Symbol.for("react.forward_ref"):60112,hb=E?Symbol.for("react.suspense"):60113,ib=E?Symbol.for("react.suspense_list"):60120,jb=E?Symbol.for("react.memo"):60115,kb=E?Symbol.for("react.lazy"):60116,lb=E?Symbol.for("react.block"):60121,mb="function"==typeof Symbol&&Symbol.iterator;function nb(a){return null===a||"object"!=typeof a?null:"function"==typeof(a=mb&&a[mb]||a["@@iterator"])?a:null}function pb(a){if(null==a)return null;if("function"==typeof a)return a.displayName||a.name||null;if("string"==typeof a)return a;switch(a){case ab:return"Fragment";case $a:return"Portal";case cb:return"Profiler";case bb:return"StrictMode";case hb:return"Suspense";case ib:return"SuspenseList"}if("object"==typeof a)switch(a.$$typeof){case eb:return"Context.Consumer";case db:return"Context.Provider";case gb:var b=a.render;return b=b.displayName||b.name||"",a.displayName||(""!==b?"ForwardRef("+b+")":"ForwardRef");case jb:return pb(a.type);case lb:return pb(a.render);case kb:if(a=1===a._status?a._result:null)return pb(a)}return null}function qb(a){var b="";do{a:switch(a.tag){case 3:case 4:case 6:case 7:case 10:case 9:var c="";break a;default:var d=a._debugOwner,e=a._debugSource,f=pb(a.type);c=null,d&&(c=pb(d.type)),d=f,f="",e?f=" (at "+e.fileName.replace(Ya,"")+":"+e.lineNumber+")":c&&(f=" (created by "+c+")"),c="\n    in "+(d||"Unknown")+f}b+=c,a=a.return}while(a);return b}function rb(a){switch(typeof a){case"boolean":case"number":case"object":case"string":case"undefined":return a;default:return""}}function sb(a){var b=a.type;return(a=a.nodeName)&&"input"===a.toLowerCase()&&("checkbox"===b||"radio"===b)}function xb(a){a._valueTracker||(a._valueTracker=(function(a){var b=sb(a)?"checked":"value",c=Object.getOwnPropertyDescriptor(a.constructor.prototype,b),d=""+a[b];if(!a.hasOwnProperty(b)&&void 0!==c&&"function"==typeof c.get&&"function"==typeof c.set){var e=c.get,f=c.set;return Object.defineProperty(a,b,{configurable:!0,get:function(){return e.call(this)},set:function(a){d=""+a,f.call(this,a)}}),Object.defineProperty(a,b,{enumerable:c.enumerable}),{getValue:function(){return d},setValue:function(a){d=""+a},stopTracking:function(){a._valueTracker=null,delete a[b]}}}})(a))}function yb(a){if(!a)return!1;var b=a._valueTracker;if(!b)return!0;var c=b.getValue(),d="";return a&&(d=sb(a)?a.checked?"true":"false":a.value),(a=d)!==c&&(b.setValue(a),!0)}function zb(a,b){var c=b.checked;return n({},b,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=c?c:a._wrapperState.initialChecked})}function Ab(a,b){var c=null==b.defaultValue?"":b.defaultValue,d=null!=b.checked?b.checked:b.defaultChecked;c=rb(null!=b.value?b.value:c),a._wrapperState={initialChecked:d,initialValue:c,controlled:"checkbox"===b.type||"radio"===b.type?null!=b.checked:null!=b.value}}function Bb(a,b){null!=(b=b.checked)&&Xa(a,"checked",b,!1)}function Cb(a,b){Bb(a,b);var c=rb(b.value),d=b.type;if(null!=c)"number"===d?(0===c&&""===a.value||a.value!=c)&&(a.value=""+c):a.value!==""+c&&(a.value=""+c);else if("submit"===d||"reset"===d)return void a.removeAttribute("value");b.hasOwnProperty("value")?Db(a,b.type,c):b.hasOwnProperty("defaultValue")&&Db(a,b.type,rb(b.defaultValue)),null==b.checked&&null!=b.defaultChecked&&(a.defaultChecked=!!b.defaultChecked)}function Eb(a,b,c){if(b.hasOwnProperty("value")||b.hasOwnProperty("defaultValue")){var d=b.type;if(!("submit"!==d&&"reset"!==d||void 0!==b.value&&null!==b.value))return;b=""+a._wrapperState.initialValue,c||b===a.value||(a.value=b),a.defaultValue=b}""!==(c=a.name)&&(a.name=""),a.defaultChecked=!!a._wrapperState.initialChecked,""!==c&&(a.name=c)}function Db(a,b,c){"number"===b&&a.ownerDocument.activeElement===a||(null==c?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+c&&(a.defaultValue=""+c))}function Gb(a,b){return a=n({children:void 0},b),(b=(function(a){var b="";return aa.Children.forEach(a,(function(a){null!=a&&(b+=a)})),b})(b.children))&&(a.children=b),a}function Hb(a,b,c,d){if(a=a.options,b){b={};for(var e=0;e<c.length;e++)b["$"+c[e]]=!0;for(c=0;c<a.length;c++)e=b.hasOwnProperty("$"+a[c].value),a[c].selected!==e&&(a[c].selected=e),e&&d&&(a[c].defaultSelected=!0)}else{for(c=""+rb(c),b=null,e=0;e<a.length;e++){if(a[e].value===c)return a[e].selected=!0,void(d&&(a[e].defaultSelected=!0));null!==b||a[e].disabled||(b=a[e])}null!==b&&(b.selected=!0)}}function Ib(a,b){if(null!=b.dangerouslySetInnerHTML)throw Error(u(91));return n({},b,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}function Jb(a,b){var c=b.value;if(null==c){if(c=b.children,b=b.defaultValue,null!=c){if(null!=b)throw Error(u(92));if(Array.isArray(c)){if(!(1>=c.length))throw Error(u(93));c=c[0]}b=c}null==b&&(b=""),c=b}a._wrapperState={initialValue:rb(c)}}function Kb(a,b){var c=rb(b.value),d=rb(b.defaultValue);null!=c&&((c=""+c)!==a.value&&(a.value=c),null==b.defaultValue&&a.defaultValue!==c&&(a.defaultValue=c)),null!=d&&(a.defaultValue=""+d)}function Lb(a){var b=a.textContent;b===a._wrapperState.initialValue&&""!==b&&null!==b&&(a.value=b)}var Mb_html="http://www.w3.org/1999/xhtml",Mb_svg="http://www.w3.org/2000/svg";function Nb(a){switch(a){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ob(a,b){return null==a||"http://www.w3.org/1999/xhtml"===a?Nb(b):"http://www.w3.org/2000/svg"===a&&"foreignObject"===b?"http://www.w3.org/1999/xhtml":a}var Pb,a,Qb=(a=function(a,b){if(a.namespaceURI!==Mb_svg||"innerHTML"in a)a.innerHTML=b;else{for((Pb=Pb||document.createElement("div")).innerHTML="<svg>"+b.valueOf().toString()+"</svg>",b=Pb.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;b.firstChild;)a.appendChild(b.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(b,c,d,e){MSApp.execUnsafeLocalFunction((function(){return a(b,c)}))}:a);function Rb(a,b){if(b){var c=a.firstChild;if(c&&c===a.lastChild&&3===c.nodeType)return void(c.nodeValue=b)}a.textContent=b}function Sb(a,b){var c={};return c[a.toLowerCase()]=b.toLowerCase(),c["Webkit"+a]="webkit"+b,c["Moz"+a]="moz"+b,c}var Tb={animationend:Sb("Animation","AnimationEnd"),animationiteration:Sb("Animation","AnimationIteration"),animationstart:Sb("Animation","AnimationStart"),transitionend:Sb("Transition","TransitionEnd")},Ub={},Vb={};function Wb(a){if(Ub[a])return Ub[a];if(!Tb[a])return a;var c,b=Tb[a];for(c in b)if(b.hasOwnProperty(c)&&c in Vb)return Ub[a]=b[c];return a}ya&&(Vb=document.createElement("div").style,"AnimationEvent"in window||(delete Tb.animationend.animation,delete Tb.animationiteration.animation,delete Tb.animationstart.animation),"TransitionEvent"in window||delete Tb.transitionend.transition);var Xb=Wb("animationend"),Yb=Wb("animationiteration"),Zb=Wb("animationstart"),$b=Wb("transitionend"),ac="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),bc=new("function"==typeof WeakMap?WeakMap:Map);function cc(a){var b=bc.get(a);return void 0===b&&(b=new Map,bc.set(a,b)),b}function dc(a){var b=a,c=a;if(a.alternate)for(;b.return;)b=b.return;else{a=b;do{0!=(1026&(b=a).effectTag)&&(c=b.return),a=b.return}while(a)}return 3===b.tag?c:null}function ec(a){if(13===a.tag){var b=a.memoizedState;if(null===b&&(null!==(a=a.alternate)&&(b=a.memoizedState)),null!==b)return b.dehydrated}return null}function fc(a){if(dc(a)!==a)throw Error(u(188))}function hc(a){if(!(a=(function(a){var b=a.alternate;if(!b){if(null===(b=dc(a)))throw Error(u(188));return b!==a?null:a}for(var c=a,d=b;;){var e=c.return;if(null===e)break;var f=e.alternate;if(null===f){if(null!==(d=e.return)){c=d;continue}break}if(e.child===f.child){for(f=e.child;f;){if(f===c)return fc(e),a;if(f===d)return fc(e),b;f=f.sibling}throw Error(u(188))}if(c.return!==d.return)c=e,d=f;else{for(var g=!1,h=e.child;h;){if(h===c){g=!0,c=e,d=f;break}if(h===d){g=!0,d=e,c=f;break}h=h.sibling}if(!g){for(h=f.child;h;){if(h===c){g=!0,c=f,d=e;break}if(h===d){g=!0,d=f,c=e;break}h=h.sibling}if(!g)throw Error(u(189))}}if(c.alternate!==d)throw Error(u(190))}if(3!==c.tag)throw Error(u(188));return c.stateNode.current===c?a:b})(a)))return null;for(var b=a;;){if(5===b.tag||6===b.tag)return b;if(b.child)b.child.return=b,b=b.child;else{if(b===a)break;for(;!b.sibling;){if(!b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return,b=b.sibling}}return null}function ic(a,b){if(null==b)throw Error(u(30));return null==a?b:Array.isArray(a)?Array.isArray(b)?(a.push.apply(a,b),a):(a.push(b),a):Array.isArray(b)?[a].concat(b):[a,b]}function jc(a,b,c){Array.isArray(a)?a.forEach(b,c):a&&b.call(c,a)}var kc=null;function lc(a){if(a){var b=a._dispatchListeners,c=a._dispatchInstances;if(Array.isArray(b))for(var d=0;d<b.length&&!a.isPropagationStopped();d++)oa(a,b[d],c[d]);else b&&oa(a,b,c);a._dispatchListeners=null,a._dispatchInstances=null,a.isPersistent()||a.constructor.release(a)}}function mc(a){if(null!==a&&(kc=ic(kc,a)),a=kc,kc=null,a){if(jc(a,lc),kc)throw Error(u(95));if(fa)throw a=ha,fa=!1,ha=null,a}}function nc(a){return(a=a.target||a.srcElement||window).correspondingUseElement&&(a=a.correspondingUseElement),3===a.nodeType?a.parentNode:a}function oc(a){if(!ya)return!1;var b=(a="on"+a)in document;return b||((b=document.createElement("div")).setAttribute(a,"return;"),b="function"==typeof b[a]),b}var pc=[];function qc(a){a.topLevelType=null,a.nativeEvent=null,a.targetInst=null,a.ancestors.length=0,10>pc.length&&pc.push(a)}function rc(a,b,c,d){if(pc.length){var e=pc.pop();return e.topLevelType=a,e.eventSystemFlags=d,e.nativeEvent=b,e.targetInst=c,e}return{topLevelType:a,eventSystemFlags:d,nativeEvent:b,targetInst:c,ancestors:[]}}function sc(a){var b=a.targetInst,c=b;do{if(!c){a.ancestors.push(c);break}var d=c;if(3===d.tag)d=d.stateNode.containerInfo;else{for(;d.return;)d=d.return;d=3!==d.tag?null:d.stateNode.containerInfo}if(!d)break;5!==(b=c.tag)&&6!==b||a.ancestors.push(c),c=tc(d)}while(c);for(c=0;c<a.ancestors.length;c++){b=a.ancestors[c];var e=nc(a.nativeEvent);d=a.topLevelType;var f=a.nativeEvent,g=a.eventSystemFlags;0===c&&(g|=64);for(var h=null,k=0;k<sa.length;k++){var l=sa[k];l&&(l=l.extractEvents(d,b,f,e,g))&&(h=ic(h,l))}mc(h)}}function uc(a,b,c){if(!c.has(a)){switch(a){case"scroll":vc(b,"scroll",!0);break;case"focus":case"blur":vc(b,"focus",!0),vc(b,"blur",!0),c.set("blur",null),c.set("focus",null);break;case"cancel":case"close":oc(a)&&vc(b,a,!0);break;case"invalid":case"submit":case"reset":break;default:-1===ac.indexOf(a)&&F(a,b)}c.set(a,null)}}var wc,xc,yc,zc=!1,Ac=[],Bc=null,Cc=null,Dc=null,Ec=new Map,Fc=new Map,Gc=[],Hc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),Ic="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" ");function Kc(a,b,c,d,e){return{blockedOn:a,topLevelType:b,eventSystemFlags:32|c,nativeEvent:e,container:d}}function Lc(a,b){switch(a){case"focus":case"blur":Bc=null;break;case"dragenter":case"dragleave":Cc=null;break;case"mouseover":case"mouseout":Dc=null;break;case"pointerover":case"pointerout":Ec.delete(b.pointerId);break;case"gotpointercapture":case"lostpointercapture":Fc.delete(b.pointerId)}}function Mc(a,b,c,d,e,f){return null===a||a.nativeEvent!==f?(a=Kc(b,c,d,e,f),null!==b&&(null!==(b=Nc(b))&&xc(b)),a):(a.eventSystemFlags|=d,a)}function Pc(a){var b=tc(a.target);if(null!==b){var c=dc(b);if(null!==c)if(13===(b=c.tag)){if(null!==(b=ec(c)))return a.blockedOn=b,void r.unstable_runWithPriority(a.priority,(function(){yc(c)}))}else if(3===b&&c.stateNode.hydrate)return void(a.blockedOn=3===c.tag?c.stateNode.containerInfo:null)}a.blockedOn=null}function Qc(a){if(null!==a.blockedOn)return!1;var b=Rc(a.topLevelType,a.eventSystemFlags,a.container,a.nativeEvent);if(null!==b){var c=Nc(b);return null!==c&&xc(c),a.blockedOn=b,!1}return!0}function Sc(a,b,c){Qc(a)&&c.delete(b)}function Tc(){for(zc=!1;0<Ac.length;){var a=Ac[0];if(null!==a.blockedOn){null!==(a=Nc(a.blockedOn))&&wc(a);break}var b=Rc(a.topLevelType,a.eventSystemFlags,a.container,a.nativeEvent);null!==b?a.blockedOn=b:Ac.shift()}null!==Bc&&Qc(Bc)&&(Bc=null),null!==Cc&&Qc(Cc)&&(Cc=null),null!==Dc&&Qc(Dc)&&(Dc=null),Ec.forEach(Sc),Fc.forEach(Sc)}function Uc(a,b){a.blockedOn===b&&(a.blockedOn=null,zc||(zc=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Tc)))}function Vc(a){function b(b){return Uc(b,a)}if(0<Ac.length){Uc(Ac[0],a);for(var c=1;c<Ac.length;c++){var d=Ac[c];d.blockedOn===a&&(d.blockedOn=null)}}for(null!==Bc&&Uc(Bc,a),null!==Cc&&Uc(Cc,a),null!==Dc&&Uc(Dc,a),Ec.forEach(b),Fc.forEach(b),c=0;c<Gc.length;c++)(d=Gc[c]).blockedOn===a&&(d.blockedOn=null);for(;0<Gc.length&&null===(c=Gc[0]).blockedOn;)Pc(c),null===c.blockedOn&&Gc.shift()}var Wc={},Yc=new Map,Zc=new Map,$c=["abort","abort",Xb,"animationEnd",Yb,"animationIteration",Zb,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",$b,"transitionEnd","waiting","waiting"];function ad(a,b){for(var c=0;c<a.length;c+=2){var d=a[c],e=a[c+1],f="on"+(e[0].toUpperCase()+e.slice(1));f={phasedRegistrationNames:{bubbled:f,captured:f+"Capture"},dependencies:[d],eventPriority:b},Zc.set(d,b),Yc.set(d,f),Wc[e]=f}}ad("blur blur cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focus focus input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),ad("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),ad($c,2);for(var bd="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),cd=0;cd<bd.length;cd++)Zc.set(bd[cd],0);var dd=r.unstable_UserBlockingPriority,ed=r.unstable_runWithPriority,fd=!0;function F(a,b){vc(b,a,!1)}function vc(a,b,c){var d=Zc.get(b);switch(void 0===d?2:d){case 0:d=gd.bind(null,b,1,a);break;case 1:d=hd.bind(null,b,1,a);break;default:d=id.bind(null,b,1,a)}c?a.addEventListener(b,d,!0):a.addEventListener(b,d,!1)}function gd(a,b,c,d){Ja||Ha();var e=id,f=Ja;Ja=!0;try{Ga(e,a,b,c,d)}finally{(Ja=f)||La()}}function hd(a,b,c,d){ed(dd,id.bind(null,a,b,c,d))}function id(a,b,c,d){if(fd)if(0<Ac.length&&-1<Hc.indexOf(a))a=Kc(null,a,b,c,d),Ac.push(a);else{var e=Rc(a,b,c,d);if(null===e)Lc(a,d);else if(-1<Hc.indexOf(a))a=Kc(e,a,b,c,d),Ac.push(a);else if(!(function(a,b,c,d,e){switch(b){case"focus":return Bc=Mc(Bc,a,b,c,d,e),!0;case"dragenter":return Cc=Mc(Cc,a,b,c,d,e),!0;case"mouseover":return Dc=Mc(Dc,a,b,c,d,e),!0;case"pointerover":var f=e.pointerId;return Ec.set(f,Mc(Ec.get(f)||null,a,b,c,d,e)),!0;case"gotpointercapture":return f=e.pointerId,Fc.set(f,Mc(Fc.get(f)||null,a,b,c,d,e)),!0}return!1})(e,a,b,c,d)){Lc(a,d),a=rc(a,d,null,b);try{Ma(sc,a)}finally{qc(a)}}}}function Rc(a,b,c,d){if(null!==(c=tc(c=nc(d)))){var e=dc(c);if(null===e)c=null;else{var f=e.tag;if(13===f){if(null!==(c=ec(e)))return c;c=null}else if(3===f){if(e.stateNode.hydrate)return 3===e.tag?e.stateNode.containerInfo:null;c=null}else e!==c&&(c=null)}}a=rc(a,d,c,b);try{Ma(sc,a)}finally{qc(a)}return null}var jd={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},kd=["Webkit","ms","Moz","O"];function ld(a,b,c){return null==b||"boolean"==typeof b||""===b?"":c||"number"!=typeof b||0===b||jd.hasOwnProperty(a)&&jd[a]?(""+b).trim():b+"px"}function md(a,b){for(var c in a=a.style,b)if(b.hasOwnProperty(c)){var d=0===c.indexOf("--"),e=ld(c,b[c],d);"float"===c&&(c="cssFloat"),d?a.setProperty(c,e):a[c]=e}}Object.keys(jd).forEach((function(a){kd.forEach((function(b){b=b+a.charAt(0).toUpperCase()+a.substring(1),jd[b]=jd[a]}))}));var nd=n({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function od(a,b){if(b){if(nd[a]&&(null!=b.children||null!=b.dangerouslySetInnerHTML))throw Error(u(137,a,""));if(null!=b.dangerouslySetInnerHTML){if(null!=b.children)throw Error(u(60));if("object"!=typeof b.dangerouslySetInnerHTML||!("__html"in b.dangerouslySetInnerHTML))throw Error(u(61))}if(null!=b.style&&"object"!=typeof b.style)throw Error(u(62,""))}}function pd(a,b){if(-1===a.indexOf("-"))return"string"==typeof b.is;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var qd=Mb_html;function rd(a,b){var c=cc(a=9===a.nodeType||11===a.nodeType?a:a.ownerDocument);b=wa[b];for(var d=0;d<b.length;d++)uc(b[d],a,c)}function sd(){}function td(a){if(void 0===(a=a||("undefined"!=typeof document?document:void 0)))return null;try{return a.activeElement||a.body}catch(b){return a.body}}function ud(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function vd(a,b){var d,c=ud(a);for(a=0;c;){if(3===c.nodeType){if(d=a+c.textContent.length,a<=b&&d>=b)return{node:c,offset:b-a};a=d}a:{for(;c;){if(c.nextSibling){c=c.nextSibling;break a}c=c.parentNode}c=void 0}c=ud(c)}}function wd(a,b){return!(!a||!b)&&(a===b||(!a||3!==a.nodeType)&&(b&&3===b.nodeType?wd(a,b.parentNode):"contains"in a?a.contains(b):!!a.compareDocumentPosition&&!!(16&a.compareDocumentPosition(b))))}function xd(){for(var a=window,b=td();b instanceof a.HTMLIFrameElement;){try{var c="string"==typeof b.contentWindow.location.href}catch(d){c=!1}if(!c)break;b=td((a=b.contentWindow).document)}return b}function yd(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return b&&("input"===b&&("text"===a.type||"search"===a.type||"tel"===a.type||"url"===a.type||"password"===a.type)||"textarea"===b||"true"===a.contentEditable)}var Dd=null,Ed=null;function Fd(a,b){switch(a){case"button":case"input":case"select":case"textarea":return!!b.autoFocus}return!1}function Gd(a,b){return"textarea"===a||"option"===a||"noscript"===a||"string"==typeof b.children||"number"==typeof b.children||"object"==typeof b.dangerouslySetInnerHTML&&null!==b.dangerouslySetInnerHTML&&null!=b.dangerouslySetInnerHTML.__html}var Hd="function"==typeof setTimeout?setTimeout:void 0,Id="function"==typeof clearTimeout?clearTimeout:void 0;function Jd(a){for(;null!=a;a=a.nextSibling){var b=a.nodeType;if(1===b||3===b)break}return a}function Kd(a){a=a.previousSibling;for(var b=0;a;){if(8===a.nodeType){var c=a.data;if("$"===c||"$!"===c||"$?"===c){if(0===b)return a;b--}else"/$"===c&&b++}a=a.previousSibling}return null}var Ld=Math.random().toString(36).slice(2),Md="__reactInternalInstance$"+Ld,Nd="__reactEventHandlers$"+Ld,Od="__reactContainere$"+Ld;function tc(a){var b=a[Md];if(b)return b;for(var c=a.parentNode;c;){if(b=c[Od]||c[Md]){if(c=b.alternate,null!==b.child||null!==c&&null!==c.child)for(a=Kd(a);null!==a;){if(c=a[Md])return c;a=Kd(a)}return b}c=(a=c).parentNode}return null}function Nc(a){return!(a=a[Md]||a[Od])||5!==a.tag&&6!==a.tag&&13!==a.tag&&3!==a.tag?null:a}function Pd(a){if(5===a.tag||6===a.tag)return a.stateNode;throw Error(u(33))}function Qd(a){return a[Nd]||null}function Rd(a){do{a=a.return}while(a&&5!==a.tag);return a||null}function Sd(a,b){var c=a.stateNode;if(!c)return null;var d=la(c);if(!d)return null;c=d[b];a:switch(b){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(d=!("button"===(a=a.type)||"input"===a||"select"===a||"textarea"===a)),a=!d;break a;default:a=!1}if(a)return null;if(c&&"function"!=typeof c)throw Error(u(231,b,typeof c));return c}function Td(a,b,c){(b=Sd(a,c.dispatchConfig.phasedRegistrationNames[b]))&&(c._dispatchListeners=ic(c._dispatchListeners,b),c._dispatchInstances=ic(c._dispatchInstances,a))}function Ud(a){if(a&&a.dispatchConfig.phasedRegistrationNames){for(var b=a._targetInst,c=[];b;)c.push(b),b=Rd(b);for(b=c.length;0<b--;)Td(c[b],"captured",a);for(b=0;b<c.length;b++)Td(c[b],"bubbled",a)}}function Vd(a,b,c){a&&c&&c.dispatchConfig.registrationName&&(b=Sd(a,c.dispatchConfig.registrationName))&&(c._dispatchListeners=ic(c._dispatchListeners,b),c._dispatchInstances=ic(c._dispatchInstances,a))}function Wd(a){a&&a.dispatchConfig.registrationName&&Vd(a._targetInst,null,a)}function Xd(a){jc(a,Ud)}var Yd=null,Zd=null,$d=null;function ae(){if($d)return $d;var a,d,b=Zd,c=b.length,e="value"in Yd?Yd.value:Yd.textContent,f=e.length;for(a=0;a<c&&b[a]===e[a];a++);var g=c-a;for(d=1;d<=g&&b[c-d]===e[f-d];d++);return $d=e.slice(a,1<d?1-d:void 0)}function be(){return!0}function ce(){return!1}function G(a,b,c,d){for(var e in this.dispatchConfig=a,this._targetInst=b,this.nativeEvent=c,a=this.constructor.Interface)a.hasOwnProperty(e)&&((b=a[e])?this[e]=b(c):"target"===e?this.target=d:this[e]=c[e]);return this.isDefaultPrevented=(null!=c.defaultPrevented?c.defaultPrevented:!1===c.returnValue)?be:ce,this.isPropagationStopped=ce,this}function ee(a,b,c,d){if(this.eventPool.length){var e=this.eventPool.pop();return this.call(e,a,b,c,d),e}return new this(a,b,c,d)}function fe(a){if(!(a instanceof this))throw Error(u(279));a.destructor(),10>this.eventPool.length&&this.eventPool.push(a)}function de(a){a.eventPool=[],a.getPooled=ee,a.release=fe}n(G.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():"unknown"!=typeof a.returnValue&&(a.returnValue=!1),this.isDefaultPrevented=be)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():"unknown"!=typeof a.cancelBubble&&(a.cancelBubble=!0),this.isPropagationStopped=be)},persist:function(){this.isPersistent=be},isPersistent:ce,destructor:function(){var b,a=this.constructor.Interface;for(b in a)this[b]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null,this.isPropagationStopped=this.isDefaultPrevented=ce,this._dispatchInstances=this._dispatchListeners=null}}),G.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null},G.extend=function(a){function b(){}function c(){return d.apply(this,arguments)}var d=this;b.prototype=d.prototype;var e=new b;return n(e,c.prototype),c.prototype=e,c.prototype.constructor=c,c.Interface=n({},d.Interface,a),c.extend=d.extend,de(c),c},de(G);var ge=G.extend({data:null}),he=G.extend({data:null}),ie=[9,13,27,32],je=ya&&"CompositionEvent"in window,ke=null;ya&&"documentMode"in document&&(ke=document.documentMode);var le=ya&&"TextEvent"in window&&!ke,me=ya&&(!je||ke&&8<ke&&11>=ke),ne=String.fromCharCode(32),oe={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},pe=!1;function qe(a,b){switch(a){case"keyup":return-1!==ie.indexOf(b.keyCode);case"keydown":return 229!==b.keyCode;case"keypress":case"mousedown":case"blur":return!0;default:return!1}}function re(a){return"object"==typeof(a=a.detail)&&"data"in a?a.data:null}var se=!1;var ve={eventTypes:oe,extractEvents:function(a,b,c,d){var e;if(je)b:{switch(a){case"compositionstart":var f=oe.compositionStart;break b;case"compositionend":f=oe.compositionEnd;break b;case"compositionupdate":f=oe.compositionUpdate;break b}f=void 0}else se?qe(a,c)&&(f=oe.compositionEnd):"keydown"===a&&229===c.keyCode&&(f=oe.compositionStart);return f?(me&&"ko"!==c.locale&&(se||f!==oe.compositionStart?f===oe.compositionEnd&&se&&(e=ae()):(Zd="value"in(Yd=d)?Yd.value:Yd.textContent,se=!0)),f=ge.getPooled(f,b,c,d),e?f.data=e:null!==(e=re(c))&&(f.data=e),Xd(f),e=f):e=null,(a=le?(function(a,b){switch(a){case"compositionend":return re(b);case"keypress":return 32!==b.which?null:(pe=!0,ne);case"textInput":return(a=b.data)===ne&&pe?null:a;default:return null}})(a,c):(function(a,b){if(se)return"compositionend"===a||!je&&qe(a,b)?(a=ae(),$d=Zd=Yd=null,se=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(b.ctrlKey||b.altKey||b.metaKey)||b.ctrlKey&&b.altKey){if(b.char&&1<b.char.length)return b.char;if(b.which)return String.fromCharCode(b.which)}return null;case"compositionend":return me&&"ko"!==b.locale?null:b.data;default:return null}})(a,c))?((b=he.getPooled(oe.beforeInput,b,c,d)).data=a,Xd(b)):b=null,null===e?b:null===b?e:[e,b]}},we={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function xe(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return"input"===b?!!we[a.type]:"textarea"===b}var ye={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}};function ze(a,b,c){return(a=G.getPooled(ye.change,a,b,c)).type="change",Da(c),Xd(a),a}var Ae=null,Be=null;function Ce(a){mc(a)}function De(a){if(yb(Pd(a)))return a}function Ee(a,b){if("change"===a)return b}var Fe=!1;function Ge(){Ae&&(Ae.detachEvent("onpropertychange",He),Be=Ae=null)}function He(a){if("value"===a.propertyName&&De(Be))if(a=ze(Be,a,nc(a)),Ja)mc(a);else{Ja=!0;try{Fa(Ce,a)}finally{Ja=!1,La()}}}function Ie(a,b,c){"focus"===a?(Ge(),Be=c,(Ae=b).attachEvent("onpropertychange",He)):"blur"===a&&Ge()}function Je(a){if("selectionchange"===a||"keyup"===a||"keydown"===a)return De(Be)}function Ke(a,b){if("click"===a)return De(b)}function Le(a,b){if("input"===a||"change"===a)return De(b)}ya&&(Fe=oc("input")&&(!document.documentMode||9<document.documentMode));var Me={eventTypes:ye,_isInputEventSupported:Fe,extractEvents:function(a,b,c,d){var e=b?Pd(b):window,f=e.nodeName&&e.nodeName.toLowerCase();if("select"===f||"input"===f&&"file"===e.type)var g=Ee;else if(xe(e))if(Fe)g=Le;else{g=Je;var h=Ie}else(f=e.nodeName)&&"input"===f.toLowerCase()&&("checkbox"===e.type||"radio"===e.type)&&(g=Ke);if(g&&(g=g(a,b)))return ze(g,c,d);h&&h(a,e,b),"blur"===a&&(a=e._wrapperState)&&a.controlled&&"number"===e.type&&Db(e,"number",e.value)}},Ne=G.extend({view:null,detail:null}),Oe={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pe(a){var b=this.nativeEvent;return b.getModifierState?b.getModifierState(a):!!(a=Oe[a])&&!!b[a]}function Qe(){return Pe}var Re=0,Se=0,Te=!1,Ue=!1,Ve=Ne.extend({screenX:null,screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:Qe,button:null,buttons:null,relatedTarget:function(a){return a.relatedTarget||(a.fromElement===a.srcElement?a.toElement:a.fromElement)},movementX:function(a){if("movementX"in a)return a.movementX;var b=Re;return Re=a.screenX,Te?"mousemove"===a.type?a.screenX-b:0:(Te=!0,0)},movementY:function(a){if("movementY"in a)return a.movementY;var b=Se;return Se=a.screenY,Ue?"mousemove"===a.type?a.screenY-b:0:(Ue=!0,0)}}),We=Ve.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),Xe={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout","pointerover"]}},Ye={eventTypes:Xe,extractEvents:function(a,b,c,d,e){var f="mouseover"===a||"pointerover"===a,g="mouseout"===a||"pointerout"===a;if(f&&0==(32&e)&&(c.relatedTarget||c.fromElement)||!g&&!f)return null;(f=d.window===d?d:(f=d.ownerDocument)?f.defaultView||f.parentWindow:window,g)?(g=b,null!==(b=(b=c.relatedTarget||c.toElement)?tc(b):null)&&(b!==dc(b)||5!==b.tag&&6!==b.tag)&&(b=null)):g=null;if(g===b)return null;if("mouseout"===a||"mouseover"===a)var k=Ve,l=Xe.mouseLeave,m=Xe.mouseEnter,p="mouse";else"pointerout"!==a&&"pointerover"!==a||(k=We,l=Xe.pointerLeave,m=Xe.pointerEnter,p="pointer");if(a=null==g?f:Pd(g),f=null==b?f:Pd(b),(l=k.getPooled(l,g,c,d)).type=p+"leave",l.target=a,l.relatedTarget=f,(c=k.getPooled(m,b,c,d)).type=p+"enter",c.target=f,c.relatedTarget=a,p=b,(d=g)&&p)a:{for(m=p,g=0,a=k=d;a;a=Rd(a))g++;for(a=0,b=m;b;b=Rd(b))a++;for(;0<g-a;)k=Rd(k),g--;for(;0<a-g;)m=Rd(m),a--;for(;g--;){if(k===m||k===m.alternate)break a;k=Rd(k),m=Rd(m)}k=null}else k=null;for(m=k,k=[];d&&d!==m&&(null===(g=d.alternate)||g!==m);)k.push(d),d=Rd(d);for(d=[];p&&p!==m&&(null===(g=p.alternate)||g!==m);)d.push(p),p=Rd(p);for(p=0;p<k.length;p++)Vd(k[p],"bubbled",l);for(p=d.length;0<p--;)Vd(d[p],"captured",c);return 0==(64&e)?[l]:[l,c]}};var $e="function"==typeof Object.is?Object.is:function(a,b){return a===b&&(0!==a||1/a==1/b)||a!=a&&b!=b},af=Object.prototype.hasOwnProperty;function bf(a,b){if($e(a,b))return!0;if("object"!=typeof a||null===a||"object"!=typeof b||null===b)return!1;var c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++)if(!af.call(b,c[d])||!$e(a[c[d]],b[c[d]]))return!1;return!0}var cf=ya&&"documentMode"in document&&11>=document.documentMode,df={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},ef=null,ff=null,gf=null,hf=!1;function jf(a,b){var c=b.window===b?b.document:9===b.nodeType?b:b.ownerDocument;return hf||null==ef||ef!==td(c)?null:("selectionStart"in(c=ef)&&yd(c)?c={start:c.selectionStart,end:c.selectionEnd}:c={anchorNode:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset},gf&&bf(gf,c)?null:(gf=c,(a=G.getPooled(df.select,ff,a,b)).type="select",a.target=ef,Xd(a),a))}var kf={eventTypes:df,extractEvents:function(a,b,c,d,e,f){if(!(f=!(e=f||(d.window===d?d.document:9===d.nodeType?d:d.ownerDocument)))){a:{e=cc(e),f=wa.onSelect;for(var g=0;g<f.length;g++)if(!e.has(f[g])){e=!1;break a}e=!0}f=!e}if(f)return null;switch(e=b?Pd(b):window,a){case"focus":(xe(e)||"true"===e.contentEditable)&&(ef=e,ff=b,gf=null);break;case"blur":gf=ff=ef=null;break;case"mousedown":hf=!0;break;case"contextmenu":case"mouseup":case"dragend":return hf=!1,jf(c,d);case"selectionchange":if(cf)break;case"keydown":case"keyup":return jf(c,d)}return null}},lf=G.extend({animationName:null,elapsedTime:null,pseudoElement:null}),mf=G.extend({clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),nf=Ne.extend({relatedTarget:null});function of(a){var b=a.keyCode;return"charCode"in a?0===(a=a.charCode)&&13===b&&(a=13):a=b,10===a&&(a=13),32<=a||13===a?a:0}var pf={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},qf={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},rf=Ne.extend({key:function(a){if(a.key){var b=pf[a.key]||a.key;if("Unidentified"!==b)return b}return"keypress"===a.type?13===(a=of(a))?"Enter":String.fromCharCode(a):"keydown"===a.type||"keyup"===a.type?qf[a.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:Qe,charCode:function(a){return"keypress"===a.type?of(a):0},keyCode:function(a){return"keydown"===a.type||"keyup"===a.type?a.keyCode:0},which:function(a){return"keypress"===a.type?of(a):"keydown"===a.type||"keyup"===a.type?a.keyCode:0}}),sf=Ve.extend({dataTransfer:null}),tf=Ne.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:Qe}),uf=G.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),vf=Ve.extend({deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:null,deltaMode:null}),wf={eventTypes:Wc,extractEvents:function(a,b,c,d){var e=Yc.get(a);if(!e)return null;switch(a){case"keypress":if(0===of(c))return null;case"keydown":case"keyup":a=rf;break;case"blur":case"focus":a=nf;break;case"click":if(2===c.button)return null;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":a=Ve;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":a=sf;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":a=tf;break;case Xb:case Yb:case Zb:a=lf;break;case $b:a=uf;break;case"scroll":a=Ne;break;case"wheel":a=vf;break;case"copy":case"cut":case"paste":a=mf;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":a=We;break;default:a=G}return Xd(b=a.getPooled(e,b,c,d)),b}};if(pa)throw Error(u(101));pa=Array.prototype.slice.call("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" ")),ra(),la=Qd,ma=Nc,na=Pd,xa({SimpleEventPlugin:wf,EnterLeaveEventPlugin:Ye,ChangeEventPlugin:Me,SelectEventPlugin:kf,BeforeInputEventPlugin:ve});var yf=[],zf=-1;function H(a){0>zf||(a.current=yf[zf],yf[zf]=null,zf--)}function I(a,b){zf++,yf[zf]=a.current,a.current=b}var Af={},J={current:Af},K={current:!1},Bf=Af;function Cf(a,b){var c=a.type.contextTypes;if(!c)return Af;var d=a.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===b)return d.__reactInternalMemoizedMaskedChildContext;var f,e={};for(f in c)e[f]=b[f];return d&&((a=a.stateNode).__reactInternalMemoizedUnmaskedChildContext=b,a.__reactInternalMemoizedMaskedChildContext=e),e}function L(a){return null!=(a=a.childContextTypes)}function Df(){H(K),H(J)}function Ef(a,b,c){if(J.current!==Af)throw Error(u(168));I(J,b),I(K,c)}function Ff(a,b,c){var d=a.stateNode;if(a=b.childContextTypes,"function"!=typeof d.getChildContext)return c;for(var e in d=d.getChildContext())if(!(e in a))throw Error(u(108,pb(b)||"Unknown",e));return n({},c,{},d)}function Gf(a){return a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||Af,Bf=J.current,I(J,a),I(K,K.current),!0}function Hf(a,b,c){var d=a.stateNode;if(!d)throw Error(u(169));c?(a=Ff(a,b,Bf),d.__reactInternalMemoizedMergedChildContext=a,H(K),H(J),I(J,a)):H(K),I(K,c)}var If=r.unstable_runWithPriority,Jf=r.unstable_scheduleCallback,Kf=r.unstable_cancelCallback,Lf=r.unstable_requestPaint,Mf=r.unstable_now,Nf=r.unstable_getCurrentPriorityLevel,Of=r.unstable_ImmediatePriority,Pf=r.unstable_UserBlockingPriority,Qf=r.unstable_NormalPriority,Rf=r.unstable_LowPriority,Sf=r.unstable_IdlePriority,Tf={},Uf=r.unstable_shouldYield,Vf=void 0!==Lf?Lf:function(){},Wf=null,Xf=null,Yf=!1,Zf=Mf(),$f=1e4>Zf?Mf:function(){return Mf()-Zf};function ag(){switch(Nf()){case Of:return 99;case Pf:return 98;case Qf:return 97;case Rf:return 96;case Sf:return 95;default:throw Error(u(332))}}function bg(a){switch(a){case 99:return Of;case 98:return Pf;case 97:return Qf;case 96:return Rf;case 95:return Sf;default:throw Error(u(332))}}function cg(a,b){return a=bg(a),If(a,b)}function dg(a,b,c){return a=bg(a),Jf(a,b,c)}function eg(a){return null===Wf?(Wf=[a],Xf=Jf(Of,fg)):Wf.push(a),Tf}function gg(){if(null!==Xf){var a=Xf;Xf=null,Kf(a)}fg()}function fg(){if(!Yf&&null!==Wf){Yf=!0;var a=0;try{var b=Wf;cg(99,(function(){for(;a<b.length;a++){var c=b[a];do{c=c(!0)}while(null!==c)}})),Wf=null}catch(c){throw null!==Wf&&(Wf=Wf.slice(a+1)),Jf(Of,gg),c}finally{Yf=!1}}}function hg(a,b,c){return 1073741821-(1+((1073741821-a+b/10)/(c/=10)|0))*c}function ig(a,b){if(a&&a.defaultProps)for(var c in b=n({},b),a=a.defaultProps)void 0===b[c]&&(b[c]=a[c]);return b}var jg={current:null},kg=null,lg=null,mg=null;function ng(){mg=lg=kg=null}function og(a){var b=jg.current;H(jg),a.type._context._currentValue=b}function pg(a,b){for(;null!==a;){var c=a.alternate;if(a.childExpirationTime<b)a.childExpirationTime=b,null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b);else{if(!(null!==c&&c.childExpirationTime<b))break;c.childExpirationTime=b}a=a.return}}function qg(a,b){kg=a,mg=lg=null,null!==(a=a.dependencies)&&null!==a.firstContext&&(a.expirationTime>=b&&(rg=!0),a.firstContext=null)}function sg(a,b){if(mg!==a&&!1!==b&&0!==b)if("number"==typeof b&&1073741823!==b||(mg=a,b=1073741823),b={context:a,observedBits:b,next:null},null===lg){if(null===kg)throw Error(u(308));lg=b,kg.dependencies={expirationTime:0,firstContext:b,responders:null}}else lg=lg.next=b;return a._currentValue}var tg=!1;function ug(a){a.updateQueue={baseState:a.memoizedState,baseQueue:null,shared:{pending:null},effects:null}}function vg(a,b){a=a.updateQueue,b.updateQueue===a&&(b.updateQueue={baseState:a.baseState,baseQueue:a.baseQueue,shared:a.shared,effects:a.effects})}function wg(a,b){return(a={expirationTime:a,suspenseConfig:b,tag:0,payload:null,callback:null,next:null}).next=a}function xg(a,b){if(null!==(a=a.updateQueue)){var c=(a=a.shared).pending;null===c?b.next=b:(b.next=c.next,c.next=b),a.pending=b}}function yg(a,b){var c=a.alternate;null!==c&&vg(c,a),null===(c=(a=a.updateQueue).baseQueue)?(a.baseQueue=b.next=b,b.next=b):(b.next=c.next,c.next=b)}function zg(a,b,c,d){var e=a.updateQueue;tg=!1;var f=e.baseQueue,g=e.shared.pending;if(null!==g){if(null!==f){var h=f.next;f.next=g.next,g.next=h}f=g,e.shared.pending=null,null!==(h=a.alternate)&&(null!==(h=h.updateQueue)&&(h.baseQueue=g))}if(null!==f){h=f.next;var k=e.baseState,l=0,m=null,p=null,x=null;if(null!==h)for(var z=h;;){if((g=z.expirationTime)<d){var ca={expirationTime:z.expirationTime,suspenseConfig:z.suspenseConfig,tag:z.tag,payload:z.payload,callback:z.callback,next:null};null===x?(p=x=ca,m=k):x=x.next=ca,g>l&&(l=g)}else{null!==x&&(x=x.next={expirationTime:1073741823,suspenseConfig:z.suspenseConfig,tag:z.tag,payload:z.payload,callback:z.callback,next:null}),Ag(g,z.suspenseConfig);a:{var D=a,t=z;switch(g=b,ca=c,t.tag){case 1:if("function"==typeof(D=t.payload)){k=D.call(ca,k,g);break a}k=D;break a;case 3:D.effectTag=-4097&D.effectTag|64;case 0:if(null==(g="function"==typeof(D=t.payload)?D.call(ca,k,g):D))break a;k=n({},k,g);break a;case 2:tg=!0}}null!==z.callback&&(a.effectTag|=32,null===(g=e.effects)?e.effects=[z]:g.push(z))}if(null===(z=z.next)||z===h){if(null===(g=e.shared.pending))break;z=f.next=g.next,g.next=h,e.baseQueue=f=g,e.shared.pending=null}}null===x?m=k:x.next=p,e.baseState=m,e.baseQueue=x,Bg(l),a.expirationTime=l,a.memoizedState=k}}function Cg(a,b,c){if(a=b.effects,b.effects=null,null!==a)for(b=0;b<a.length;b++){var d=a[b],e=d.callback;if(null!==e){if(d.callback=null,d=e,e=c,"function"!=typeof d)throw Error(u(191,d));d.call(e)}}}var Dg=Wa.ReactCurrentBatchConfig,Eg=(new aa.Component).refs;function Fg(a,b,c,d){c=null==(c=c(d,b=a.memoizedState))?b:n({},b,c),a.memoizedState=c,0===a.expirationTime&&(a.updateQueue.baseState=c)}var Jg={isMounted:function(a){return!!(a=a._reactInternalFiber)&&dc(a)===a},enqueueSetState:function(a,b,c){a=a._reactInternalFiber;var d=Gg(),e=Dg.suspense;(e=wg(d=Hg(d,a,e),e)).payload=b,null!=c&&(e.callback=c),xg(a,e),Ig(a,d)},enqueueReplaceState:function(a,b,c){a=a._reactInternalFiber;var d=Gg(),e=Dg.suspense;(e=wg(d=Hg(d,a,e),e)).tag=1,e.payload=b,null!=c&&(e.callback=c),xg(a,e),Ig(a,d)},enqueueForceUpdate:function(a,b){a=a._reactInternalFiber;var c=Gg(),d=Dg.suspense;(d=wg(c=Hg(c,a,d),d)).tag=2,null!=b&&(d.callback=b),xg(a,d),Ig(a,c)}};function Kg(a,b,c,d,e,f,g){return"function"==typeof(a=a.stateNode).shouldComponentUpdate?a.shouldComponentUpdate(d,f,g):!b.prototype||!b.prototype.isPureReactComponent||(!bf(c,d)||!bf(e,f))}function Lg(a,b,c){var d=!1,e=Af,f=b.contextType;return"object"==typeof f&&null!==f?f=sg(f):(e=L(b)?Bf:J.current,f=(d=null!=(d=b.contextTypes))?Cf(a,e):Af),b=new b(c,f),a.memoizedState=null!==b.state&&void 0!==b.state?b.state:null,b.updater=Jg,a.stateNode=b,b._reactInternalFiber=a,d&&((a=a.stateNode).__reactInternalMemoizedUnmaskedChildContext=e,a.__reactInternalMemoizedMaskedChildContext=f),b}function Mg(a,b,c,d){a=b.state,"function"==typeof b.componentWillReceiveProps&&b.componentWillReceiveProps(c,d),"function"==typeof b.UNSAFE_componentWillReceiveProps&&b.UNSAFE_componentWillReceiveProps(c,d),b.state!==a&&Jg.enqueueReplaceState(b,b.state,null)}function Ng(a,b,c,d){var e=a.stateNode;e.props=c,e.state=a.memoizedState,e.refs=Eg,ug(a);var f=b.contextType;"object"==typeof f&&null!==f?e.context=sg(f):(f=L(b)?Bf:J.current,e.context=Cf(a,f)),zg(a,c,e,d),e.state=a.memoizedState,"function"==typeof(f=b.getDerivedStateFromProps)&&(Fg(a,b,f,c),e.state=a.memoizedState),"function"==typeof b.getDerivedStateFromProps||"function"==typeof e.getSnapshotBeforeUpdate||"function"!=typeof e.UNSAFE_componentWillMount&&"function"!=typeof e.componentWillMount||(b=e.state,"function"==typeof e.componentWillMount&&e.componentWillMount(),"function"==typeof e.UNSAFE_componentWillMount&&e.UNSAFE_componentWillMount(),b!==e.state&&Jg.enqueueReplaceState(e,e.state,null),zg(a,c,e,d),e.state=a.memoizedState),"function"==typeof e.componentDidMount&&(a.effectTag|=4)}var Og=Array.isArray;function Pg(a,b,c){if(null!==(a=c.ref)&&"function"!=typeof a&&"object"!=typeof a){if(c._owner){if(c=c._owner){if(1!==c.tag)throw Error(u(309));var d=c.stateNode}if(!d)throw Error(u(147,a));var e=""+a;return null!==b&&null!==b.ref&&"function"==typeof b.ref&&b.ref._stringRef===e?b.ref:((b=function(a){var b=d.refs;b===Eg&&(b=d.refs={}),null===a?delete b[e]:b[e]=a})._stringRef=e,b)}if("string"!=typeof a)throw Error(u(284));if(!c._owner)throw Error(u(290,a))}return a}function Qg(a,b){if("textarea"!==a.type)throw Error(u(31,"[object Object]"===Object.prototype.toString.call(b)?"object with keys {"+Object.keys(b).join(", ")+"}":b,""))}function Rg(a){function b(b,c){if(a){var d=b.lastEffect;null!==d?(d.nextEffect=c,b.lastEffect=c):b.firstEffect=b.lastEffect=c,c.nextEffect=null,c.effectTag=8}}function c(c,d){if(!a)return null;for(;null!==d;)b(c,d),d=d.sibling;return null}function d(a,b){for(a=new Map;null!==b;)null!==b.key?a.set(b.key,b):a.set(b.index,b),b=b.sibling;return a}function e(a,b){return(a=Sg(a,b)).index=0,a.sibling=null,a}function f(b,c,d){return b.index=d,a?null!==(d=b.alternate)?(d=d.index)<c?(b.effectTag=2,c):d:(b.effectTag=2,c):c}function g(b){return a&&null===b.alternate&&(b.effectTag=2),b}function h(a,b,c,d){return null===b||6!==b.tag?((b=Tg(c,a.mode,d)).return=a,b):((b=e(b,c)).return=a,b)}function k(a,b,c,d){return null!==b&&b.elementType===c.type?((d=e(b,c.props)).ref=Pg(a,b,c),d.return=a,d):((d=Ug(c.type,c.key,c.props,null,a.mode,d)).ref=Pg(a,b,c),d.return=a,d)}function l(a,b,c,d){return null===b||4!==b.tag||b.stateNode.containerInfo!==c.containerInfo||b.stateNode.implementation!==c.implementation?((b=Vg(c,a.mode,d)).return=a,b):((b=e(b,c.children||[])).return=a,b)}function m(a,b,c,d,f){return null===b||7!==b.tag?((b=Wg(c,a.mode,d,f)).return=a,b):((b=e(b,c)).return=a,b)}function p(a,b,c){if("string"==typeof b||"number"==typeof b)return(b=Tg(""+b,a.mode,c)).return=a,b;if("object"==typeof b&&null!==b){switch(b.$$typeof){case Za:return(c=Ug(b.type,b.key,b.props,null,a.mode,c)).ref=Pg(a,null,b),c.return=a,c;case $a:return(b=Vg(b,a.mode,c)).return=a,b}if(Og(b)||nb(b))return(b=Wg(b,a.mode,c,null)).return=a,b;Qg(a,b)}return null}function x(a,b,c,d){var e=null!==b?b.key:null;if("string"==typeof c||"number"==typeof c)return null!==e?null:h(a,b,""+c,d);if("object"==typeof c&&null!==c){switch(c.$$typeof){case Za:return c.key===e?c.type===ab?m(a,b,c.props.children,d,e):k(a,b,c,d):null;case $a:return c.key===e?l(a,b,c,d):null}if(Og(c)||nb(c))return null!==e?null:m(a,b,c,d,null);Qg(a,c)}return null}function z(a,b,c,d,e){if("string"==typeof d||"number"==typeof d)return h(b,a=a.get(c)||null,""+d,e);if("object"==typeof d&&null!==d){switch(d.$$typeof){case Za:return a=a.get(null===d.key?c:d.key)||null,d.type===ab?m(b,a,d.props.children,e,d.key):k(b,a,d,e);case $a:return l(b,a=a.get(null===d.key?c:d.key)||null,d,e)}if(Og(d)||nb(d))return m(b,a=a.get(c)||null,d,e,null);Qg(b,d)}return null}function ca(e,g,h,k){for(var l=null,t=null,m=g,y=g=0,A=null;null!==m&&y<h.length;y++){m.index>y?(A=m,m=null):A=m.sibling;var q=x(e,m,h[y],k);if(null===q){null===m&&(m=A);break}a&&m&&null===q.alternate&&b(e,m),g=f(q,g,y),null===t?l=q:t.sibling=q,t=q,m=A}if(y===h.length)return c(e,m),l;if(null===m){for(;y<h.length;y++)null!==(m=p(e,h[y],k))&&(g=f(m,g,y),null===t?l=m:t.sibling=m,t=m);return l}for(m=d(e,m);y<h.length;y++)null!==(A=z(m,e,y,h[y],k))&&(a&&null!==A.alternate&&m.delete(null===A.key?y:A.key),g=f(A,g,y),null===t?l=A:t.sibling=A,t=A);return a&&m.forEach((function(a){return b(e,a)})),l}function D(e,g,h,l){var k=nb(h);if("function"!=typeof k)throw Error(u(150));if(null==(h=k.call(h)))throw Error(u(151));for(var m=k=null,t=g,y=g=0,A=null,q=h.next();null!==t&&!q.done;y++,q=h.next()){t.index>y?(A=t,t=null):A=t.sibling;var D=x(e,t,q.value,l);if(null===D){null===t&&(t=A);break}a&&t&&null===D.alternate&&b(e,t),g=f(D,g,y),null===m?k=D:m.sibling=D,m=D,t=A}if(q.done)return c(e,t),k;if(null===t){for(;!q.done;y++,q=h.next())null!==(q=p(e,q.value,l))&&(g=f(q,g,y),null===m?k=q:m.sibling=q,m=q);return k}for(t=d(e,t);!q.done;y++,q=h.next())null!==(q=z(t,e,y,q.value,l))&&(a&&null!==q.alternate&&t.delete(null===q.key?y:q.key),g=f(q,g,y),null===m?k=q:m.sibling=q,m=q);return a&&t.forEach((function(a){return b(e,a)})),k}return function(a,d,f,h){var k="object"==typeof f&&null!==f&&f.type===ab&&null===f.key;k&&(f=f.props.children);var l="object"==typeof f&&null!==f;if(l)switch(f.$$typeof){case Za:a:{for(l=f.key,k=d;null!==k;){if(k.key===l){switch(k.tag){case 7:if(f.type===ab){c(a,k.sibling),(d=e(k,f.props.children)).return=a,a=d;break a}break;default:if(k.elementType===f.type){c(a,k.sibling),(d=e(k,f.props)).ref=Pg(a,k,f),d.return=a,a=d;break a}}c(a,k);break}b(a,k),k=k.sibling}f.type===ab?((d=Wg(f.props.children,a.mode,h,f.key)).return=a,a=d):((h=Ug(f.type,f.key,f.props,null,a.mode,h)).ref=Pg(a,d,f),h.return=a,a=h)}return g(a);case $a:a:{for(k=f.key;null!==d;){if(d.key===k){if(4===d.tag&&d.stateNode.containerInfo===f.containerInfo&&d.stateNode.implementation===f.implementation){c(a,d.sibling),(d=e(d,f.children||[])).return=a,a=d;break a}c(a,d);break}b(a,d),d=d.sibling}(d=Vg(f,a.mode,h)).return=a,a=d}return g(a)}if("string"==typeof f||"number"==typeof f)return f=""+f,null!==d&&6===d.tag?(c(a,d.sibling),(d=e(d,f)).return=a,a=d):(c(a,d),(d=Tg(f,a.mode,h)).return=a,a=d),g(a);if(Og(f))return ca(a,d,f,h);if(nb(f))return D(a,d,f,h);if(l&&Qg(a,f),void 0===f&&!k)switch(a.tag){case 1:case 0:throw a=a.type,Error(u(152,a.displayName||a.name||"Component"))}return c(a,d)}}var Xg=Rg(!0),Yg=Rg(!1),Zg={},$g={current:Zg},ah={current:Zg},bh={current:Zg};function ch(a){if(a===Zg)throw Error(u(174));return a}function dh(a,b){switch(I(bh,b),I(ah,a),I($g,Zg),a=b.nodeType){case 9:case 11:b=(b=b.documentElement)?b.namespaceURI:Ob(null,"");break;default:b=Ob(b=(a=8===a?b.parentNode:b).namespaceURI||null,a=a.tagName)}H($g),I($g,b)}function eh(){H($g),H(ah),H(bh)}function fh(a){ch(bh.current);var b=ch($g.current),c=Ob(b,a.type);b!==c&&(I(ah,a),I($g,c))}function gh(a){ah.current===a&&(H($g),H(ah))}var M={current:0};function hh(a){for(var b=a;null!==b;){if(13===b.tag){var c=b.memoizedState;if(null!==c&&(null===(c=c.dehydrated)||"$?"===c.data||"$!"===c.data))return b}else if(19===b.tag&&void 0!==b.memoizedProps.revealOrder){if(0!=(64&b.effectTag))return b}else if(null!==b.child){b.child.return=b,b=b.child;continue}if(b===a)break;for(;null===b.sibling;){if(null===b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return,b=b.sibling}return null}function ih(a,b){return{responder:a,props:b}}var jh=Wa.ReactCurrentDispatcher,kh=Wa.ReactCurrentBatchConfig,lh=0,N=null,O=null,P=null,mh=!1;function Q(){throw Error(u(321))}function nh(a,b){if(null===b)return!1;for(var c=0;c<b.length&&c<a.length;c++)if(!$e(a[c],b[c]))return!1;return!0}function oh(a,b,c,d,e,f){if(lh=f,N=b,b.memoizedState=null,b.updateQueue=null,b.expirationTime=0,jh.current=null===a||null===a.memoizedState?ph:qh,a=c(d,e),b.expirationTime===lh){f=0;do{if(b.expirationTime=0,!(25>f))throw Error(u(301));f+=1,P=O=null,b.updateQueue=null,jh.current=rh,a=c(d,e)}while(b.expirationTime===lh)}if(jh.current=sh,b=null!==O&&null!==O.next,lh=0,P=O=N=null,mh=!1,b)throw Error(u(300));return a}function th(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===P?N.memoizedState=P=a:P=P.next=a,P}function uh(){if(null===O){var a=N.alternate;a=null!==a?a.memoizedState:null}else a=O.next;var b=null===P?N.memoizedState:P.next;if(null!==b)P=b,O=a;else{if(null===a)throw Error(u(310));a={memoizedState:(O=a).memoizedState,baseState:O.baseState,baseQueue:O.baseQueue,queue:O.queue,next:null},null===P?N.memoizedState=P=a:P=P.next=a}return P}function vh(a,b){return"function"==typeof b?b(a):b}function wh(a){var b=uh(),c=b.queue;if(null===c)throw Error(u(311));c.lastRenderedReducer=a;var d=O,e=d.baseQueue,f=c.pending;if(null!==f){if(null!==e){var g=e.next;e.next=f.next,f.next=g}d.baseQueue=e=f,c.pending=null}if(null!==e){e=e.next,d=d.baseState;var h=g=f=null,k=e;do{var l=k.expirationTime;if(l<lh){var m={expirationTime:k.expirationTime,suspenseConfig:k.suspenseConfig,action:k.action,eagerReducer:k.eagerReducer,eagerState:k.eagerState,next:null};null===h?(g=h=m,f=d):h=h.next=m,l>N.expirationTime&&(N.expirationTime=l,Bg(l))}else null!==h&&(h=h.next={expirationTime:1073741823,suspenseConfig:k.suspenseConfig,action:k.action,eagerReducer:k.eagerReducer,eagerState:k.eagerState,next:null}),Ag(l,k.suspenseConfig),d=k.eagerReducer===a?k.eagerState:a(d,k.action);k=k.next}while(null!==k&&k!==e);null===h?f=d:h.next=g,$e(d,b.memoizedState)||(rg=!0),b.memoizedState=d,b.baseState=f,b.baseQueue=h,c.lastRenderedState=d}return[b.memoizedState,c.dispatch]}function xh(a){var b=uh(),c=b.queue;if(null===c)throw Error(u(311));c.lastRenderedReducer=a;var d=c.dispatch,e=c.pending,f=b.memoizedState;if(null!==e){c.pending=null;var g=e=e.next;do{f=a(f,g.action),g=g.next}while(g!==e);$e(f,b.memoizedState)||(rg=!0),b.memoizedState=f,null===b.baseQueue&&(b.baseState=f),c.lastRenderedState=f}return[f,d]}function yh(a){var b=th();return"function"==typeof a&&(a=a()),b.memoizedState=b.baseState=a,a=(a=b.queue={pending:null,dispatch:null,lastRenderedReducer:vh,lastRenderedState:a}).dispatch=zh.bind(null,N,a),[b.memoizedState,a]}function Ah(a,b,c,d){return a={tag:a,create:b,destroy:c,deps:d,next:null},null===(b=N.updateQueue)?(b={lastEffect:null},N.updateQueue=b,b.lastEffect=a.next=a):null===(c=b.lastEffect)?b.lastEffect=a.next=a:(d=c.next,c.next=a,a.next=d,b.lastEffect=a),a}function Bh(){return uh().memoizedState}function Ch(a,b,c,d){var e=th();N.effectTag|=a,e.memoizedState=Ah(1|b,c,void 0,void 0===d?null:d)}function Dh(a,b,c,d){var e=uh();d=void 0===d?null:d;var f=void 0;if(null!==O){var g=O.memoizedState;if(f=g.destroy,null!==d&&nh(d,g.deps))return void Ah(b,c,f,d)}N.effectTag|=a,e.memoizedState=Ah(1|b,c,f,d)}function Eh(a,b){return Ch(516,4,a,b)}function Fh(a,b){return Dh(516,4,a,b)}function Gh(a,b){return Dh(4,2,a,b)}function Hh(a,b){return"function"==typeof b?(a=a(),b(a),function(){b(null)}):null!=b?(a=a(),b.current=a,function(){b.current=null}):void 0}function Ih(a,b,c){return c=null!=c?c.concat([a]):null,Dh(4,2,Hh.bind(null,b,a),c)}function Jh(){}function Kh(a,b){return th().memoizedState=[a,void 0===b?null:b],a}function Lh(a,b){var c=uh();b=void 0===b?null:b;var d=c.memoizedState;return null!==d&&null!==b&&nh(b,d[1])?d[0]:(c.memoizedState=[a,b],a)}function Mh(a,b){var c=uh();b=void 0===b?null:b;var d=c.memoizedState;return null!==d&&null!==b&&nh(b,d[1])?d[0]:(a=a(),c.memoizedState=[a,b],a)}function Nh(a,b,c){var d=ag();cg(98>d?98:d,(function(){a(!0)})),cg(97<d?97:d,(function(){var d=kh.suspense;kh.suspense=void 0===b?null:b;try{a(!1),c()}finally{kh.suspense=d}}))}function zh(a,b,c){var d=Gg(),e=Dg.suspense;e={expirationTime:d=Hg(d,a,e),suspenseConfig:e,action:c,eagerReducer:null,eagerState:null,next:null};var f=b.pending;if(null===f?e.next=e:(e.next=f.next,f.next=e),b.pending=e,f=a.alternate,a===N||null!==f&&f===N)mh=!0,e.expirationTime=lh,N.expirationTime=lh;else{if(0===a.expirationTime&&(null===f||0===f.expirationTime)&&null!==(f=b.lastRenderedReducer))try{var g=b.lastRenderedState,h=f(g,c);if(e.eagerReducer=f,e.eagerState=h,$e(h,g))return}catch(k){}Ig(a,d)}}var sh={readContext:sg,useCallback:Q,useContext:Q,useEffect:Q,useImperativeHandle:Q,useLayoutEffect:Q,useMemo:Q,useReducer:Q,useRef:Q,useState:Q,useDebugValue:Q,useResponder:Q,useDeferredValue:Q,useTransition:Q},ph={readContext:sg,useCallback:Kh,useContext:sg,useEffect:Eh,useImperativeHandle:function(a,b,c){return c=null!=c?c.concat([a]):null,Ch(4,2,Hh.bind(null,b,a),c)},useLayoutEffect:function(a,b){return Ch(4,2,a,b)},useMemo:function(a,b){var c=th();return b=void 0===b?null:b,a=a(),c.memoizedState=[a,b],a},useReducer:function(a,b,c){var d=th();return b=void 0!==c?c(b):b,d.memoizedState=d.baseState=b,a=(a=d.queue={pending:null,dispatch:null,lastRenderedReducer:a,lastRenderedState:b}).dispatch=zh.bind(null,N,a),[d.memoizedState,a]},useRef:function(a){return a={current:a},th().memoizedState=a},useState:yh,useDebugValue:Jh,useResponder:ih,useDeferredValue:function(a,b){var c=yh(a),d=c[0],e=c[1];return Eh((function(){var c=kh.suspense;kh.suspense=void 0===b?null:b;try{e(a)}finally{kh.suspense=c}}),[a,b]),d},useTransition:function(a){var b=yh(!1),c=b[0];return b=b[1],[Kh(Nh.bind(null,b,a),[b,a]),c]}},qh={readContext:sg,useCallback:Lh,useContext:sg,useEffect:Fh,useImperativeHandle:Ih,useLayoutEffect:Gh,useMemo:Mh,useReducer:wh,useRef:Bh,useState:function(){return wh(vh)},useDebugValue:Jh,useResponder:ih,useDeferredValue:function(a,b){var c=wh(vh),d=c[0],e=c[1];return Fh((function(){var c=kh.suspense;kh.suspense=void 0===b?null:b;try{e(a)}finally{kh.suspense=c}}),[a,b]),d},useTransition:function(a){var b=wh(vh),c=b[0];return b=b[1],[Lh(Nh.bind(null,b,a),[b,a]),c]}},rh={readContext:sg,useCallback:Lh,useContext:sg,useEffect:Fh,useImperativeHandle:Ih,useLayoutEffect:Gh,useMemo:Mh,useReducer:xh,useRef:Bh,useState:function(){return xh(vh)},useDebugValue:Jh,useResponder:ih,useDeferredValue:function(a,b){var c=xh(vh),d=c[0],e=c[1];return Fh((function(){var c=kh.suspense;kh.suspense=void 0===b?null:b;try{e(a)}finally{kh.suspense=c}}),[a,b]),d},useTransition:function(a){var b=xh(vh),c=b[0];return b=b[1],[Lh(Nh.bind(null,b,a),[b,a]),c]}},Oh=null,Ph=null,Qh=!1;function Rh(a,b){var c=Sh(5,null,null,0);c.elementType="DELETED",c.type="DELETED",c.stateNode=b,c.return=a,c.effectTag=8,null!==a.lastEffect?(a.lastEffect.nextEffect=c,a.lastEffect=c):a.firstEffect=a.lastEffect=c}function Th(a,b){switch(a.tag){case 5:var c=a.type;return null!==(b=1!==b.nodeType||c.toLowerCase()!==b.nodeName.toLowerCase()?null:b)&&(a.stateNode=b,!0);case 6:return null!==(b=""===a.pendingProps||3!==b.nodeType?null:b)&&(a.stateNode=b,!0);case 13:default:return!1}}function Uh(a){if(Qh){var b=Ph;if(b){var c=b;if(!Th(a,b)){if(!(b=Jd(c.nextSibling))||!Th(a,b))return a.effectTag=-1025&a.effectTag|2,Qh=!1,void(Oh=a);Rh(Oh,c)}Oh=a,Ph=Jd(b.firstChild)}else a.effectTag=-1025&a.effectTag|2,Qh=!1,Oh=a}}function Vh(a){for(a=a.return;null!==a&&5!==a.tag&&3!==a.tag&&13!==a.tag;)a=a.return;Oh=a}function Wh(a){if(a!==Oh)return!1;if(!Qh)return Vh(a),Qh=!0,!1;var b=a.type;if(5!==a.tag||"head"!==b&&"body"!==b&&!Gd(b,a.memoizedProps))for(b=Ph;b;)Rh(a,b),b=Jd(b.nextSibling);if(Vh(a),13===a.tag){if(!(a=null!==(a=a.memoizedState)?a.dehydrated:null))throw Error(u(317));a:{for(a=a.nextSibling,b=0;a;){if(8===a.nodeType){var c=a.data;if("/$"===c){if(0===b){Ph=Jd(a.nextSibling);break a}b--}else"$"!==c&&"$!"!==c&&"$?"!==c||b++}a=a.nextSibling}Ph=null}}else Ph=Oh?Jd(a.stateNode.nextSibling):null;return!0}function Xh(){Ph=Oh=null,Qh=!1}var Yh=Wa.ReactCurrentOwner,rg=!1;function R(a,b,c,d){b.child=null===a?Yg(b,null,c,d):Xg(b,a.child,c,d)}function Zh(a,b,c,d,e){c=c.render;var f=b.ref;return qg(b,e),d=oh(a,b,c,d,f,e),null===a||rg?(b.effectTag|=1,R(a,b,d,e),b.child):(b.updateQueue=a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),$h(a,b,e))}function ai(a,b,c,d,e,f){if(null===a){var g=c.type;return"function"!=typeof g||bi(g)||void 0!==g.defaultProps||null!==c.compare||void 0!==c.defaultProps?((a=Ug(c.type,null,d,null,b.mode,f)).ref=b.ref,a.return=b,b.child=a):(b.tag=15,b.type=g,ci(a,b,g,d,e,f))}return g=a.child,e<f&&(e=g.memoizedProps,(c=null!==(c=c.compare)?c:bf)(e,d)&&a.ref===b.ref)?$h(a,b,f):(b.effectTag|=1,(a=Sg(g,d)).ref=b.ref,a.return=b,b.child=a)}function ci(a,b,c,d,e,f){return null!==a&&bf(a.memoizedProps,d)&&a.ref===b.ref&&(rg=!1,e<f)?(b.expirationTime=a.expirationTime,$h(a,b,f)):di(a,b,c,d,f)}function ei(a,b){var c=b.ref;(null===a&&null!==c||null!==a&&a.ref!==c)&&(b.effectTag|=128)}function di(a,b,c,d,e){var f=L(c)?Bf:J.current;return f=Cf(b,f),qg(b,e),c=oh(a,b,c,d,f,e),null===a||rg?(b.effectTag|=1,R(a,b,c,e),b.child):(b.updateQueue=a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),$h(a,b,e))}function fi(a,b,c,d,e){if(L(c)){var f=!0;Gf(b)}else f=!1;if(qg(b,e),null===b.stateNode)null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),Lg(b,c,d),Ng(b,c,d,e),d=!0;else if(null===a){var g=b.stateNode,h=b.memoizedProps;g.props=h;var k=g.context,l=c.contextType;"object"==typeof l&&null!==l?l=sg(l):l=Cf(b,l=L(c)?Bf:J.current);var m=c.getDerivedStateFromProps,p="function"==typeof m||"function"==typeof g.getSnapshotBeforeUpdate;p||"function"!=typeof g.UNSAFE_componentWillReceiveProps&&"function"!=typeof g.componentWillReceiveProps||(h!==d||k!==l)&&Mg(b,g,d,l),tg=!1;var x=b.memoizedState;g.state=x,zg(b,d,g,e),k=b.memoizedState,h!==d||x!==k||K.current||tg?("function"==typeof m&&(Fg(b,c,m,d),k=b.memoizedState),(h=tg||Kg(b,c,h,d,x,k,l))?(p||"function"!=typeof g.UNSAFE_componentWillMount&&"function"!=typeof g.componentWillMount||("function"==typeof g.componentWillMount&&g.componentWillMount(),"function"==typeof g.UNSAFE_componentWillMount&&g.UNSAFE_componentWillMount()),"function"==typeof g.componentDidMount&&(b.effectTag|=4)):("function"==typeof g.componentDidMount&&(b.effectTag|=4),b.memoizedProps=d,b.memoizedState=k),g.props=d,g.state=k,g.context=l,d=h):("function"==typeof g.componentDidMount&&(b.effectTag|=4),d=!1)}else g=b.stateNode,vg(a,b),h=b.memoizedProps,g.props=b.type===b.elementType?h:ig(b.type,h),k=g.context,"object"==typeof(l=c.contextType)&&null!==l?l=sg(l):l=Cf(b,l=L(c)?Bf:J.current),(p="function"==typeof(m=c.getDerivedStateFromProps)||"function"==typeof g.getSnapshotBeforeUpdate)||"function"!=typeof g.UNSAFE_componentWillReceiveProps&&"function"!=typeof g.componentWillReceiveProps||(h!==d||k!==l)&&Mg(b,g,d,l),tg=!1,k=b.memoizedState,g.state=k,zg(b,d,g,e),x=b.memoizedState,h!==d||k!==x||K.current||tg?("function"==typeof m&&(Fg(b,c,m,d),x=b.memoizedState),(m=tg||Kg(b,c,h,d,k,x,l))?(p||"function"!=typeof g.UNSAFE_componentWillUpdate&&"function"!=typeof g.componentWillUpdate||("function"==typeof g.componentWillUpdate&&g.componentWillUpdate(d,x,l),"function"==typeof g.UNSAFE_componentWillUpdate&&g.UNSAFE_componentWillUpdate(d,x,l)),"function"==typeof g.componentDidUpdate&&(b.effectTag|=4),"function"==typeof g.getSnapshotBeforeUpdate&&(b.effectTag|=256)):("function"!=typeof g.componentDidUpdate||h===a.memoizedProps&&k===a.memoizedState||(b.effectTag|=4),"function"!=typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&k===a.memoizedState||(b.effectTag|=256),b.memoizedProps=d,b.memoizedState=x),g.props=d,g.state=x,g.context=l,d=m):("function"!=typeof g.componentDidUpdate||h===a.memoizedProps&&k===a.memoizedState||(b.effectTag|=4),"function"!=typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&k===a.memoizedState||(b.effectTag|=256),d=!1);return gi(a,b,c,d,f,e)}function gi(a,b,c,d,e,f){ei(a,b);var g=0!=(64&b.effectTag);if(!d&&!g)return e&&Hf(b,c,!1),$h(a,b,f);d=b.stateNode,Yh.current=b;var h=g&&"function"!=typeof c.getDerivedStateFromError?null:d.render();return b.effectTag|=1,null!==a&&g?(b.child=Xg(b,a.child,null,f),b.child=Xg(b,null,h,f)):R(a,b,h,f),b.memoizedState=d.state,e&&Hf(b,c,!0),b.child}function hi(a){var b=a.stateNode;b.pendingContext?Ef(0,b.pendingContext,b.pendingContext!==b.context):b.context&&Ef(0,b.context,!1),dh(a,b.containerInfo)}var ni,pi,qi,ii={dehydrated:null,retryTime:0};function ji(a,b,c){var h,d=b.mode,e=b.pendingProps,f=M.current,g=!1;if((h=0!=(64&b.effectTag))||(h=0!=(2&f)&&(null===a||null!==a.memoizedState)),h?(g=!0,b.effectTag&=-65):null!==a&&null===a.memoizedState||void 0===e.fallback||!0===e.unstable_avoidThisFallback||(f|=1),I(M,1&f),null===a){if(void 0!==e.fallback&&Uh(b),g){if(g=e.fallback,(e=Wg(null,d,0,null)).return=b,0==(2&b.mode))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==a;)a.return=e,a=a.sibling;return(c=Wg(g,d,c,null)).return=b,e.sibling=c,b.memoizedState=ii,b.child=e,c}return d=e.children,b.memoizedState=null,b.child=Yg(b,null,d,c)}if(null!==a.memoizedState){if(d=(a=a.child).sibling,g){if(e=e.fallback,(c=Sg(a,a.pendingProps)).return=b,0==(2&b.mode)&&(g=null!==b.memoizedState?b.child.child:b.child)!==a.child)for(c.child=g;null!==g;)g.return=c,g=g.sibling;return(d=Sg(d,e)).return=b,c.sibling=d,c.childExpirationTime=0,b.memoizedState=ii,b.child=c,d}return c=Xg(b,a.child,e.children,c),b.memoizedState=null,b.child=c}if(a=a.child,g){if(g=e.fallback,(e=Wg(null,d,0,null)).return=b,e.child=a,null!==a&&(a.return=e),0==(2&b.mode))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==a;)a.return=e,a=a.sibling;return(c=Wg(g,d,c,null)).return=b,e.sibling=c,c.effectTag|=2,e.childExpirationTime=0,b.memoizedState=ii,b.child=e,c}return b.memoizedState=null,b.child=Xg(b,a,e.children,c)}function ki(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b),pg(a.return,b)}function li(a,b,c,d,e,f){var g=a.memoizedState;null===g?a.memoizedState={isBackwards:b,rendering:null,renderingStartTime:0,last:d,tail:c,tailExpiration:0,tailMode:e,lastEffect:f}:(g.isBackwards=b,g.rendering=null,g.renderingStartTime=0,g.last=d,g.tail=c,g.tailExpiration=0,g.tailMode=e,g.lastEffect=f)}function mi(a,b,c){var d=b.pendingProps,e=d.revealOrder,f=d.tail;if(R(a,b,d.children,c),0!=(2&(d=M.current)))d=1&d|2,b.effectTag|=64;else{if(null!==a&&0!=(64&a.effectTag))a:for(a=b.child;null!==a;){if(13===a.tag)null!==a.memoizedState&&ki(a,c);else if(19===a.tag)ki(a,c);else if(null!==a.child){a.child.return=a,a=a.child;continue}if(a===b)break a;for(;null===a.sibling;){if(null===a.return||a.return===b)break a;a=a.return}a.sibling.return=a.return,a=a.sibling}d&=1}if(I(M,d),0==(2&b.mode))b.memoizedState=null;else switch(e){case"forwards":for(c=b.child,e=null;null!==c;)null!==(a=c.alternate)&&null===hh(a)&&(e=c),c=c.sibling;null===(c=e)?(e=b.child,b.child=null):(e=c.sibling,c.sibling=null),li(b,!1,e,c,f,b.lastEffect);break;case"backwards":for(c=null,e=b.child,b.child=null;null!==e;){if(null!==(a=e.alternate)&&null===hh(a)){b.child=e;break}a=e.sibling,e.sibling=c,c=e,e=a}li(b,!0,c,null,f,b.lastEffect);break;case"together":li(b,!1,null,null,void 0,b.lastEffect);break;default:b.memoizedState=null}return b.child}function $h(a,b,c){null!==a&&(b.dependencies=a.dependencies);var d=b.expirationTime;if(0!==d&&Bg(d),b.childExpirationTime<c)return null;if(null!==a&&b.child!==a.child)throw Error(u(153));if(null!==b.child){for(c=Sg(a=b.child,a.pendingProps),b.child=c,c.return=b;null!==a.sibling;)a=a.sibling,(c=c.sibling=Sg(a,a.pendingProps)).return=b;c.sibling=null}return b.child}function ri(a,b){switch(a.tailMode){case"hidden":b=a.tail;for(var c=null;null!==b;)null!==b.alternate&&(c=b),b=b.sibling;null===c?a.tail=null:c.sibling=null;break;case"collapsed":c=a.tail;for(var d=null;null!==c;)null!==c.alternate&&(d=c),c=c.sibling;null===d?b||null===a.tail?a.tail=null:a.tail.sibling=null:d.sibling=null}}function si(a,b,c){var d=b.pendingProps;switch(b.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return L(b.type)&&Df(),null;case 3:return eh(),H(K),H(J),(c=b.stateNode).pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),null!==a&&null!==a.child||!Wh(b)||(b.effectTag|=4),null;case 5:gh(b),c=ch(bh.current);var e=b.type;if(null!==a&&null!=b.stateNode)pi(a,b,e,d,c),a.ref!==b.ref&&(b.effectTag|=128);else{if(!d){if(null===b.stateNode)throw Error(u(166));return null}if(a=ch($g.current),Wh(b)){d=b.stateNode,e=b.type;var f=b.memoizedProps;switch(d[Md]=b,d[Nd]=f,e){case"iframe":case"object":case"embed":F("load",d);break;case"video":case"audio":for(a=0;a<ac.length;a++)F(ac[a],d);break;case"source":F("error",d);break;case"img":case"image":case"link":F("error",d),F("load",d);break;case"form":F("reset",d),F("submit",d);break;case"details":F("toggle",d);break;case"input":Ab(d,f),F("invalid",d),rd(c,"onChange");break;case"select":d._wrapperState={wasMultiple:!!f.multiple},F("invalid",d),rd(c,"onChange");break;case"textarea":Jb(d,f),F("invalid",d),rd(c,"onChange")}for(var g in od(e,f),a=null,f)if(f.hasOwnProperty(g)){var h=f[g];"children"===g?"string"==typeof h?d.textContent!==h&&(a=["children",h]):"number"==typeof h&&d.textContent!==""+h&&(a=["children",""+h]):va.hasOwnProperty(g)&&null!=h&&rd(c,g)}switch(e){case"input":xb(d),Eb(d,f,!0);break;case"textarea":xb(d),Lb(d);break;case"select":case"option":break;default:"function"==typeof f.onClick&&(d.onclick=sd)}c=a,b.updateQueue=c,null!==c&&(b.effectTag|=4)}else{switch(g=9===c.nodeType?c:c.ownerDocument,a===qd&&(a=Nb(e)),a===qd?"script"===e?((a=g.createElement("div")).innerHTML="<script><\/script>",a=a.removeChild(a.firstChild)):"string"==typeof d.is?a=g.createElement(e,{is:d.is}):(a=g.createElement(e),"select"===e&&(g=a,d.multiple?g.multiple=!0:d.size&&(g.size=d.size))):a=g.createElementNS(a,e),a[Md]=b,a[Nd]=d,ni(a,b),b.stateNode=a,g=pd(e,d),e){case"iframe":case"object":case"embed":F("load",a),h=d;break;case"video":case"audio":for(h=0;h<ac.length;h++)F(ac[h],a);h=d;break;case"source":F("error",a),h=d;break;case"img":case"image":case"link":F("error",a),F("load",a),h=d;break;case"form":F("reset",a),F("submit",a),h=d;break;case"details":F("toggle",a),h=d;break;case"input":Ab(a,d),h=zb(a,d),F("invalid",a),rd(c,"onChange");break;case"option":h=Gb(a,d);break;case"select":a._wrapperState={wasMultiple:!!d.multiple},h=n({},d,{value:void 0}),F("invalid",a),rd(c,"onChange");break;case"textarea":Jb(a,d),h=Ib(a,d),F("invalid",a),rd(c,"onChange");break;default:h=d}od(e,h);var k=h;for(f in k)if(k.hasOwnProperty(f)){var l=k[f];"style"===f?md(a,l):"dangerouslySetInnerHTML"===f?null!=(l=l?l.__html:void 0)&&Qb(a,l):"children"===f?"string"==typeof l?("textarea"!==e||""!==l)&&Rb(a,l):"number"==typeof l&&Rb(a,""+l):"suppressContentEditableWarning"!==f&&"suppressHydrationWarning"!==f&&"autoFocus"!==f&&(va.hasOwnProperty(f)?null!=l&&rd(c,f):null!=l&&Xa(a,f,l,g))}switch(e){case"input":xb(a),Eb(a,d,!1);break;case"textarea":xb(a),Lb(a);break;case"option":null!=d.value&&a.setAttribute("value",""+rb(d.value));break;case"select":a.multiple=!!d.multiple,null!=(c=d.value)?Hb(a,!!d.multiple,c,!1):null!=d.defaultValue&&Hb(a,!!d.multiple,d.defaultValue,!0);break;default:"function"==typeof h.onClick&&(a.onclick=sd)}Fd(e,d)&&(b.effectTag|=4)}null!==b.ref&&(b.effectTag|=128)}return null;case 6:if(a&&null!=b.stateNode)qi(0,b,a.memoizedProps,d);else{if("string"!=typeof d&&null===b.stateNode)throw Error(u(166));c=ch(bh.current),ch($g.current),Wh(b)?(c=b.stateNode,d=b.memoizedProps,c[Md]=b,c.nodeValue!==d&&(b.effectTag|=4)):((c=(9===c.nodeType?c:c.ownerDocument).createTextNode(d))[Md]=b,b.stateNode=c)}return null;case 13:return H(M),d=b.memoizedState,0!=(64&b.effectTag)?(b.expirationTime=c,b):(c=null!==d,d=!1,null===a?void 0!==b.memoizedProps.fallback&&Wh(b):(d=null!==(e=a.memoizedState),c||null===e||null!==(e=a.child.sibling)&&(null!==(f=b.firstEffect)?(b.firstEffect=e,e.nextEffect=f):(b.firstEffect=b.lastEffect=e,e.nextEffect=null),e.effectTag=8)),c&&!d&&0!=(2&b.mode)&&(null===a&&!0!==b.memoizedProps.unstable_avoidThisFallback||0!=(1&M.current)?S===ti&&(S=ui):(S!==ti&&S!==ui||(S=vi),0!==wi&&null!==T&&(xi(T,U),yi(T,wi)))),(c||d)&&(b.effectTag|=4),null);case 4:return eh(),null;case 10:return og(b),null;case 17:return L(b.type)&&Df(),null;case 19:if(H(M),null===(d=b.memoizedState))return null;if(e=0!=(64&b.effectTag),null===(f=d.rendering)){if(e)ri(d,!1);else if(S!==ti||null!==a&&0!=(64&a.effectTag))for(f=b.child;null!==f;){if(null!==(a=hh(f))){for(b.effectTag|=64,ri(d,!1),null!==(e=a.updateQueue)&&(b.updateQueue=e,b.effectTag|=4),null===d.lastEffect&&(b.firstEffect=null),b.lastEffect=d.lastEffect,d=b.child;null!==d;)f=c,(e=d).effectTag&=2,e.nextEffect=null,e.firstEffect=null,e.lastEffect=null,null===(a=e.alternate)?(e.childExpirationTime=0,e.expirationTime=f,e.child=null,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null):(e.childExpirationTime=a.childExpirationTime,e.expirationTime=a.expirationTime,e.child=a.child,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,e.updateQueue=a.updateQueue,f=a.dependencies,e.dependencies=null===f?null:{expirationTime:f.expirationTime,firstContext:f.firstContext,responders:f.responders}),d=d.sibling;return I(M,1&M.current|2),b.child}f=f.sibling}}else{if(!e)if(null!==(a=hh(f))){if(b.effectTag|=64,e=!0,null!==(c=a.updateQueue)&&(b.updateQueue=c,b.effectTag|=4),ri(d,!0),null===d.tail&&"hidden"===d.tailMode&&!f.alternate)return null!==(b=b.lastEffect=d.lastEffect)&&(b.nextEffect=null),null}else 2*$f()-d.renderingStartTime>d.tailExpiration&&1<c&&(b.effectTag|=64,e=!0,ri(d,!1),b.expirationTime=b.childExpirationTime=c-1);d.isBackwards?(f.sibling=b.child,b.child=f):(null!==(c=d.last)?c.sibling=f:b.child=f,d.last=f)}return null!==d.tail?(0===d.tailExpiration&&(d.tailExpiration=$f()+500),c=d.tail,d.rendering=c,d.tail=c.sibling,d.lastEffect=b.lastEffect,d.renderingStartTime=$f(),c.sibling=null,b=M.current,I(M,e?1&b|2:1&b),c):null}throw Error(u(156,b.tag))}function zi(a){switch(a.tag){case 1:L(a.type)&&Df();var b=a.effectTag;return 4096&b?(a.effectTag=-4097&b|64,a):null;case 3:if(eh(),H(K),H(J),0!=(64&(b=a.effectTag)))throw Error(u(285));return a.effectTag=-4097&b|64,a;case 5:return gh(a),null;case 13:return H(M),4096&(b=a.effectTag)?(a.effectTag=-4097&b|64,a):null;case 19:return H(M),null;case 4:return eh(),null;case 10:return og(a),null;default:return null}}function Ai(a,b){return{value:a,source:b,stack:qb(b)}}ni=function(a,b){for(var c=b.child;null!==c;){if(5===c.tag||6===c.tag)a.appendChild(c.stateNode);else if(4!==c.tag&&null!==c.child){c.child.return=c,c=c.child;continue}if(c===b)break;for(;null===c.sibling;){if(null===c.return||c.return===b)return;c=c.return}c.sibling.return=c.return,c=c.sibling}},pi=function(a,b,c,d,e){var f=a.memoizedProps;if(f!==d){var h,k,g=b.stateNode;switch(ch($g.current),a=null,c){case"input":f=zb(g,f),d=zb(g,d),a=[];break;case"option":f=Gb(g,f),d=Gb(g,d),a=[];break;case"select":f=n({},f,{value:void 0}),d=n({},d,{value:void 0}),a=[];break;case"textarea":f=Ib(g,f),d=Ib(g,d),a=[];break;default:"function"!=typeof f.onClick&&"function"==typeof d.onClick&&(g.onclick=sd)}for(h in od(c,d),c=null,f)if(!d.hasOwnProperty(h)&&f.hasOwnProperty(h)&&null!=f[h])if("style"===h)for(k in g=f[h])g.hasOwnProperty(k)&&(c||(c={}),c[k]="");else"dangerouslySetInnerHTML"!==h&&"children"!==h&&"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(va.hasOwnProperty(h)?a||(a=[]):(a=a||[]).push(h,null));for(h in d){var l=d[h];if(g=null!=f?f[h]:void 0,d.hasOwnProperty(h)&&l!==g&&(null!=l||null!=g))if("style"===h)if(g){for(k in g)!g.hasOwnProperty(k)||l&&l.hasOwnProperty(k)||(c||(c={}),c[k]="");for(k in l)l.hasOwnProperty(k)&&g[k]!==l[k]&&(c||(c={}),c[k]=l[k])}else c||(a||(a=[]),a.push(h,c)),c=l;else"dangerouslySetInnerHTML"===h?(l=l?l.__html:void 0,g=g?g.__html:void 0,null!=l&&g!==l&&(a=a||[]).push(h,l)):"children"===h?g===l||"string"!=typeof l&&"number"!=typeof l||(a=a||[]).push(h,""+l):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&(va.hasOwnProperty(h)?(null!=l&&rd(e,h),a||g===l||(a=[])):(a=a||[]).push(h,l))}c&&(a=a||[]).push("style",c),e=a,(b.updateQueue=e)&&(b.effectTag|=4)}},qi=function(a,b,c,d){c!==d&&(b.effectTag|=4)};var Bi="function"==typeof WeakSet?WeakSet:Set;function Ci(a,b){var c=b.source,d=b.stack;null===d&&null!==c&&(d=qb(c)),null!==c&&pb(c.type),b=b.value,null!==a&&1===a.tag&&pb(a.type);try{console.error(b)}catch(e){setTimeout((function(){throw e}))}}function Fi(a){var b=a.ref;if(null!==b)if("function"==typeof b)try{b(null)}catch(c){Ei(a,c)}else b.current=null}function Gi(a,b){switch(b.tag){case 0:case 11:case 15:case 22:return;case 1:if(256&b.effectTag&&null!==a){var c=a.memoizedProps,d=a.memoizedState;b=(a=b.stateNode).getSnapshotBeforeUpdate(b.elementType===b.type?c:ig(b.type,c),d),a.__reactInternalSnapshotBeforeUpdate=b}return;case 3:case 5:case 6:case 4:case 17:return}throw Error(u(163))}function Hi(a,b){if(null!==(b=null!==(b=b.updateQueue)?b.lastEffect:null)){var c=b=b.next;do{if((c.tag&a)===a){var d=c.destroy;c.destroy=void 0,void 0!==d&&d()}c=c.next}while(c!==b)}}function Ii(a,b){if(null!==(b=null!==(b=b.updateQueue)?b.lastEffect:null)){var c=b=b.next;do{if((c.tag&a)===a){var d=c.create;c.destroy=d()}c=c.next}while(c!==b)}}function Ji(a,b,c){switch(c.tag){case 0:case 11:case 15:case 22:return void Ii(3,c);case 1:if(a=c.stateNode,4&c.effectTag)if(null===b)a.componentDidMount();else{var d=c.elementType===c.type?b.memoizedProps:ig(c.type,b.memoizedProps);a.componentDidUpdate(d,b.memoizedState,a.__reactInternalSnapshotBeforeUpdate)}return void(null!==(b=c.updateQueue)&&Cg(c,b,a));case 3:if(null!==(b=c.updateQueue)){if(a=null,null!==c.child)switch(c.child.tag){case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}Cg(c,b,a)}return;case 5:return a=c.stateNode,void(null===b&&4&c.effectTag&&Fd(c.type,c.memoizedProps)&&a.focus());case 6:case 4:case 12:return;case 13:return void(null===c.memoizedState&&(c=c.alternate,null!==c&&(c=c.memoizedState,null!==c&&(c=c.dehydrated,null!==c&&Vc(c)))));case 19:case 17:case 20:case 21:return}throw Error(u(163))}function Ki(a,b,c){switch("function"==typeof Li&&Li(b),b.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(a=b.updateQueue)&&null!==(a=a.lastEffect)){var d=a.next;cg(97<c?97:c,(function(){var a=d;do{var c=a.destroy;if(void 0!==c){var g=b;try{c()}catch(h){Ei(g,h)}}a=a.next}while(a!==d)}))}break;case 1:Fi(b),"function"==typeof(c=b.stateNode).componentWillUnmount&&(function(a,b){try{b.props=a.memoizedProps,b.state=a.memoizedState,b.componentWillUnmount()}catch(c){Ei(a,c)}})(b,c);break;case 5:Fi(b);break;case 4:Mi(a,b,c)}}function Ni(a){var b=a.alternate;a.return=null,a.child=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.alternate=null,a.firstEffect=null,a.lastEffect=null,a.pendingProps=null,a.memoizedProps=null,a.stateNode=null,null!==b&&Ni(b)}function Oi(a){return 5===a.tag||3===a.tag||4===a.tag}function Pi(a){a:{for(var b=a.return;null!==b;){if(Oi(b)){var c=b;break a}b=b.return}throw Error(u(160))}switch(b=c.stateNode,c.tag){case 5:var d=!1;break;case 3:case 4:b=b.containerInfo,d=!0;break;default:throw Error(u(161))}16&c.effectTag&&(Rb(b,""),c.effectTag&=-17);a:b:for(c=a;;){for(;null===c.sibling;){if(null===c.return||Oi(c.return)){c=null;break a}c=c.return}for(c.sibling.return=c.return,c=c.sibling;5!==c.tag&&6!==c.tag&&18!==c.tag;){if(2&c.effectTag)continue b;if(null===c.child||4===c.tag)continue b;c.child.return=c,c=c.child}if(!(2&c.effectTag)){c=c.stateNode;break a}}d?Qi(a,c,b):Ri(a,c,b)}function Qi(a,b,c){var d=a.tag,e=5===d||6===d;if(e)a=e?a.stateNode:a.stateNode.instance,b?8===c.nodeType?c.parentNode.insertBefore(a,b):c.insertBefore(a,b):(8===c.nodeType?(b=c.parentNode).insertBefore(a,c):(b=c).appendChild(a),null!=(c=c._reactRootContainer)||null!==b.onclick||(b.onclick=sd));else if(4!==d&&null!==(a=a.child))for(Qi(a,b,c),a=a.sibling;null!==a;)Qi(a,b,c),a=a.sibling}function Ri(a,b,c){var d=a.tag,e=5===d||6===d;if(e)a=e?a.stateNode:a.stateNode.instance,b?c.insertBefore(a,b):c.appendChild(a);else if(4!==d&&null!==(a=a.child))for(Ri(a,b,c),a=a.sibling;null!==a;)Ri(a,b,c),a=a.sibling}function Mi(a,b,c){for(var f,g,d=b,e=!1;;){if(!e){e=d.return;a:for(;;){if(null===e)throw Error(u(160));switch(f=e.stateNode,e.tag){case 5:g=!1;break a;case 3:case 4:f=f.containerInfo,g=!0;break a}e=e.return}e=!0}if(5===d.tag||6===d.tag){a:for(var h=a,k=d,l=c,m=k;;)if(Ki(h,m,l),null!==m.child&&4!==m.tag)m.child.return=m,m=m.child;else{if(m===k)break a;for(;null===m.sibling;){if(null===m.return||m.return===k)break a;m=m.return}m.sibling.return=m.return,m=m.sibling}g?(h=f,k=d.stateNode,8===h.nodeType?h.parentNode.removeChild(k):h.removeChild(k)):f.removeChild(d.stateNode)}else if(4===d.tag){if(null!==d.child){f=d.stateNode.containerInfo,g=!0,d.child.return=d,d=d.child;continue}}else if(Ki(a,d,c),null!==d.child){d.child.return=d,d=d.child;continue}if(d===b)break;for(;null===d.sibling;){if(null===d.return||d.return===b)return;4===(d=d.return).tag&&(e=!1)}d.sibling.return=d.return,d=d.sibling}}function Si(a,b){switch(b.tag){case 0:case 11:case 14:case 15:case 22:return void Hi(3,b);case 1:return;case 5:var c=b.stateNode;if(null!=c){var d=b.memoizedProps,e=null!==a?a.memoizedProps:d;a=b.type;var f=b.updateQueue;if(b.updateQueue=null,null!==f){for(c[Nd]=d,"input"===a&&"radio"===d.type&&null!=d.name&&Bb(c,d),pd(a,e),b=pd(a,d),e=0;e<f.length;e+=2){var g=f[e],h=f[e+1];"style"===g?md(c,h):"dangerouslySetInnerHTML"===g?Qb(c,h):"children"===g?Rb(c,h):Xa(c,g,h,b)}switch(a){case"input":Cb(c,d);break;case"textarea":Kb(c,d);break;case"select":b=c._wrapperState.wasMultiple,c._wrapperState.wasMultiple=!!d.multiple,null!=(a=d.value)?Hb(c,!!d.multiple,a,!1):b!==!!d.multiple&&(null!=d.defaultValue?Hb(c,!!d.multiple,d.defaultValue,!0):Hb(c,!!d.multiple,d.multiple?[]:"",!1))}}}return;case 6:if(null===b.stateNode)throw Error(u(162));return void(b.stateNode.nodeValue=b.memoizedProps);case 3:return void((b=b.stateNode).hydrate&&(b.hydrate=!1,Vc(b.containerInfo)));case 12:return;case 13:if(c=b,null===b.memoizedState?d=!1:(d=!0,c=b.child,Ti=$f()),null!==c)a:for(a=c;;){if(5===a.tag)f=a.stateNode,d?"function"==typeof(f=f.style).setProperty?f.setProperty("display","none","important"):f.display="none":(f=a.stateNode,e=null!=(e=a.memoizedProps.style)&&e.hasOwnProperty("display")?e.display:null,f.style.display=ld("display",e));else if(6===a.tag)a.stateNode.nodeValue=d?"":a.memoizedProps;else{if(13===a.tag&&null!==a.memoizedState&&null===a.memoizedState.dehydrated){(f=a.child.sibling).return=a,a=f;continue}if(null!==a.child){a.child.return=a,a=a.child;continue}}if(a===c)break;for(;null===a.sibling;){if(null===a.return||a.return===c)break a;a=a.return}a.sibling.return=a.return,a=a.sibling}return void Ui(b);case 19:return void Ui(b);case 17:return}throw Error(u(163))}function Ui(a){var b=a.updateQueue;if(null!==b){a.updateQueue=null;var c=a.stateNode;null===c&&(c=a.stateNode=new Bi),b.forEach((function(b){var d=Vi.bind(null,a,b);c.has(b)||(c.add(b),b.then(d,d))}))}}var Wi="function"==typeof WeakMap?WeakMap:Map;function Xi(a,b,c){(c=wg(c,null)).tag=3,c.payload={element:null};var d=b.value;return c.callback=function(){Yi||(Yi=!0,Zi=d),Ci(a,b)},c}function $i(a,b,c){(c=wg(c,null)).tag=3;var d=a.type.getDerivedStateFromError;if("function"==typeof d){var e=b.value;c.payload=function(){return Ci(a,b),d(e)}}var f=a.stateNode;return null!==f&&"function"==typeof f.componentDidCatch&&(c.callback=function(){"function"!=typeof d&&(null===aj?aj=new Set([this]):aj.add(this),Ci(a,b));var c=b.stack;this.componentDidCatch(b.value,{componentStack:null!==c?c:""})}),c}var Rj,bj=Math.ceil,cj=Wa.ReactCurrentDispatcher,dj=Wa.ReactCurrentOwner,ti=0,ui=3,vi=4,W=0,T=null,X=null,U=0,S=ti,kj=null,lj=1073741823,mj=1073741823,nj=null,wi=0,oj=!1,Ti=0,Y=null,Yi=!1,Zi=null,aj=null,qj=!1,rj=null,sj=90,tj=null,uj=0,vj=null,wj=0;function Gg(){return 0!=(48&W)?1073741821-($f()/10|0):0!==wj?wj:wj=1073741821-($f()/10|0)}function Hg(a,b,c){if(0==(2&(b=b.mode)))return 1073741823;var d=ag();if(0==(4&b))return 99===d?1073741823:1073741822;if(0!=(16&W))return U;if(null!==c)a=hg(a,0|c.timeoutMs||5e3,250);else switch(d){case 99:a=1073741823;break;case 98:a=hg(a,150,100);break;case 97:case 96:a=hg(a,5e3,250);break;case 95:a=2;break;default:throw Error(u(326))}return null!==T&&a===U&&--a,a}function Ig(a,b){if(50<uj)throw uj=0,vj=null,Error(u(185));if(null!==(a=xj(a,b))){var c=ag();1073741823===b?0!=(8&W)&&0==(48&W)?yj(a):(Z(a),0===W&&gg()):Z(a),0==(4&W)||98!==c&&99!==c||(null===tj?tj=new Map([[a,b]]):(void 0===(c=tj.get(a))||c>b)&&tj.set(a,b))}}function xj(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b);var d=a.return,e=null;if(null===d&&3===a.tag)e=a.stateNode;else for(;null!==d;){if(c=d.alternate,d.childExpirationTime<b&&(d.childExpirationTime=b),null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b),null===d.return&&3===d.tag){e=d.stateNode;break}d=d.return}return null!==e&&(T===e&&(Bg(b),S===vi&&xi(e,U)),yi(e,b)),e}function zj(a){var b=a.lastExpiredTime;if(0!==b)return b;if(!Aj(a,b=a.firstPendingTime))return b;var c=a.lastPingedTime;return 2>=(a=c>(a=a.nextKnownPendingLevel)?c:a)&&b!==a?0:a}function Z(a){if(0!==a.lastExpiredTime)a.callbackExpirationTime=1073741823,a.callbackPriority=99,a.callbackNode=eg(yj.bind(null,a));else{var b=zj(a),c=a.callbackNode;if(0===b)null!==c&&(a.callbackNode=null,a.callbackExpirationTime=0,a.callbackPriority=90);else{var d=Gg();if(1073741823===b?d=99:1===b||2===b?d=95:d=0>=(d=10*(1073741821-b)-10*(1073741821-d))?99:250>=d?98:5250>=d?97:95,null!==c){var e=a.callbackPriority;if(a.callbackExpirationTime===b&&e>=d)return;c!==Tf&&Kf(c)}a.callbackExpirationTime=b,a.callbackPriority=d,b=1073741823===b?eg(yj.bind(null,a)):dg(d,Bj.bind(null,a),{timeout:10*(1073741821-b)-$f()}),a.callbackNode=b}}}function Bj(a,b){if(wj=0,b)return Cj(a,b=Gg()),Z(a),null;var c=zj(a);if(0!==c){if(b=a.callbackNode,0!=(48&W))throw Error(u(327));if(Dj(),a===T&&c===U||Ej(a,c),null!==X){var d=W;W|=16;for(var e=Fj();;)try{Gj();break}catch(h){Hj(a,h)}if(ng(),W=d,cj.current=e,1===S)throw b=kj,Ej(a,c),xi(a,c),Z(a),b;if(null===X)switch(e=a.finishedWork=a.current.alternate,a.finishedExpirationTime=c,d=S,T=null,d){case ti:case 1:throw Error(u(345));case 2:Cj(a,2<c?2:c);break;case ui:if(xi(a,c),c===(d=a.lastSuspendedTime)&&(a.nextKnownPendingLevel=Ij(e)),1073741823===lj&&10<(e=Ti+500-$f())){if(oj){var f=a.lastPingedTime;if(0===f||f>=c){a.lastPingedTime=c,Ej(a,c);break}}if(0!==(f=zj(a))&&f!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}a.timeoutHandle=Hd(Jj.bind(null,a),e);break}Jj(a);break;case vi:if(xi(a,c),c===(d=a.lastSuspendedTime)&&(a.nextKnownPendingLevel=Ij(e)),oj&&(0===(e=a.lastPingedTime)||e>=c)){a.lastPingedTime=c,Ej(a,c);break}if(0!==(e=zj(a))&&e!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}if(1073741823!==mj?d=10*(1073741821-mj)-$f():1073741823===lj?d=0:(d=10*(1073741821-lj)-5e3,0>(d=(e=$f())-d)&&(d=0),(c=10*(1073741821-c)-e)<(d=(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3e3>d?3e3:4320>d?4320:1960*bj(d/1960))-d)&&(d=c)),10<d){a.timeoutHandle=Hd(Jj.bind(null,a),d);break}Jj(a);break;case 5:if(1073741823!==lj&&null!==nj){f=lj;var g=nj;if(0>=(d=0|g.busyMinDurationMs)?d=0:(e=0|g.busyDelayMs,d=(f=$f()-(10*(1073741821-f)-(0|g.timeoutMs||5e3)))<=e?0:e+d-f),10<d){xi(a,c),a.timeoutHandle=Hd(Jj.bind(null,a),d);break}}Jj(a);break;default:throw Error(u(329))}if(Z(a),a.callbackNode===b)return Bj.bind(null,a)}}return null}function yj(a){var b=a.lastExpiredTime;if(b=0!==b?b:1073741823,0!=(48&W))throw Error(u(327));if(Dj(),a===T&&b===U||Ej(a,b),null!==X){var c=W;W|=16;for(var d=Fj();;)try{Kj();break}catch(e){Hj(a,e)}if(ng(),W=c,cj.current=d,1===S)throw c=kj,Ej(a,b),xi(a,b),Z(a),c;if(null!==X)throw Error(u(261));a.finishedWork=a.current.alternate,a.finishedExpirationTime=b,T=null,Jj(a),Z(a)}return null}function Mj(a,b){var c=W;W|=1;try{return a(b)}finally{0===(W=c)&&gg()}}function Nj(a,b){var c=W;W&=-2,W|=8;try{return a(b)}finally{0===(W=c)&&gg()}}function Ej(a,b){a.finishedWork=null,a.finishedExpirationTime=0;var c=a.timeoutHandle;if(-1!==c&&(a.timeoutHandle=-1,Id(c)),null!==X)for(c=X.return;null!==c;){var d=c;switch(d.tag){case 1:null!=(d=d.type.childContextTypes)&&Df();break;case 3:eh(),H(K),H(J);break;case 5:gh(d);break;case 4:eh();break;case 13:case 19:H(M);break;case 10:og(d)}c=c.return}T=a,X=Sg(a.current,null),U=b,S=ti,kj=null,mj=lj=1073741823,nj=null,wi=0,oj=!1}function Hj(a,b){for(;;){try{if(ng(),jh.current=sh,mh)for(var c=N.memoizedState;null!==c;){var d=c.queue;null!==d&&(d.pending=null),c=c.next}if(lh=0,P=O=N=null,mh=!1,null===X||null===X.return)return S=1,kj=b,X=null;a:{var e=a,f=X.return,g=X,h=b;if(b=U,g.effectTag|=2048,g.firstEffect=g.lastEffect=null,null!==h&&"object"==typeof h&&"function"==typeof h.then){var k=h;if(0==(2&g.mode)){var l=g.alternate;l?(g.updateQueue=l.updateQueue,g.memoizedState=l.memoizedState,g.expirationTime=l.expirationTime):(g.updateQueue=null,g.memoizedState=null)}var m=0!=(1&M.current),p=f;do{var x;if(x=13===p.tag){var z=p.memoizedState;if(null!==z)x=null!==z.dehydrated;else{var ca=p.memoizedProps;x=void 0!==ca.fallback&&(!0!==ca.unstable_avoidThisFallback||!m)}}if(x){var D=p.updateQueue;if(null===D){var t=new Set;t.add(k),p.updateQueue=t}else D.add(k);if(0==(2&p.mode)){if(p.effectTag|=64,g.effectTag&=-2981,1===g.tag)if(null===g.alternate)g.tag=17;else{var y=wg(1073741823,null);y.tag=2,xg(g,y)}g.expirationTime=1073741823;break a}h=void 0,g=b;var A=e.pingCache;if(null===A?(A=e.pingCache=new Wi,h=new Set,A.set(k,h)):void 0===(h=A.get(k))&&(h=new Set,A.set(k,h)),!h.has(g)){h.add(g);var q=Oj.bind(null,e,k,g);k.then(q,q)}p.effectTag|=4096,p.expirationTime=b;break a}p=p.return}while(null!==p);h=Error((pb(g.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display."+qb(g))}5!==S&&(S=2),h=Ai(h,g),p=f;do{switch(p.tag){case 3:k=h,p.effectTag|=4096,p.expirationTime=b,yg(p,Xi(p,k,b));break a;case 1:k=h;var w=p.type,ub=p.stateNode;if(0==(64&p.effectTag)&&("function"==typeof w.getDerivedStateFromError||null!==ub&&"function"==typeof ub.componentDidCatch&&(null===aj||!aj.has(ub)))){p.effectTag|=4096,p.expirationTime=b,yg(p,$i(p,k,b));break a}}p=p.return}while(null!==p)}X=Pj(X)}catch(Xc){b=Xc;continue}break}}function Fj(){var a=cj.current;return cj.current=sh,null===a?sh:a}function Ag(a,b){a<lj&&2<a&&(lj=a),null!==b&&a<mj&&2<a&&(mj=a,nj=b)}function Bg(a){a>wi&&(wi=a)}function Kj(){for(;null!==X;)X=Qj(X)}function Gj(){for(;null!==X&&!Uf();)X=Qj(X)}function Qj(a){var b=Rj(a.alternate,a,U);return a.memoizedProps=a.pendingProps,null===b&&(b=Pj(a)),dj.current=null,b}function Pj(a){X=a;do{var b=X.alternate;if(a=X.return,0==(2048&X.effectTag)){if(b=si(b,X,U),1===U||1!==X.childExpirationTime){for(var c=0,d=X.child;null!==d;){var e=d.expirationTime,f=d.childExpirationTime;e>c&&(c=e),f>c&&(c=f),d=d.sibling}X.childExpirationTime=c}if(null!==b)return b;null!==a&&0==(2048&a.effectTag)&&(null===a.firstEffect&&(a.firstEffect=X.firstEffect),null!==X.lastEffect&&(null!==a.lastEffect&&(a.lastEffect.nextEffect=X.firstEffect),a.lastEffect=X.lastEffect),1<X.effectTag&&(null!==a.lastEffect?a.lastEffect.nextEffect=X:a.firstEffect=X,a.lastEffect=X))}else{if(null!==(b=zi(X)))return b.effectTag&=2047,b;null!==a&&(a.firstEffect=a.lastEffect=null,a.effectTag|=2048)}if(null!==(b=X.sibling))return b;X=a}while(null!==X);return S===ti&&(S=5),null}function Ij(a){var b=a.expirationTime;return b>(a=a.childExpirationTime)?b:a}function Jj(a){var b=ag();return cg(99,Sj.bind(null,a,b)),null}function Sj(a,b){do{Dj()}while(null!==rj);if(0!=(48&W))throw Error(u(327));var c=a.finishedWork,d=a.finishedExpirationTime;if(null===c)return null;if(a.finishedWork=null,a.finishedExpirationTime=0,c===a.current)throw Error(u(177));a.callbackNode=null,a.callbackExpirationTime=0,a.callbackPriority=90,a.nextKnownPendingLevel=0;var e=Ij(c);if(a.firstPendingTime=e,d<=a.lastSuspendedTime?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:d<=a.firstSuspendedTime&&(a.firstSuspendedTime=d-1),d<=a.lastPingedTime&&(a.lastPingedTime=0),d<=a.lastExpiredTime&&(a.lastExpiredTime=0),a===T&&(X=T=null,U=0),1<c.effectTag?null!==c.lastEffect?(c.lastEffect.nextEffect=c,e=c.firstEffect):e=c:e=c.firstEffect,null!==e){var f=W;W|=32,dj.current=null,Dd=fd;var g=xd();if(yd(g)){if("selectionStart"in g)var h={start:g.selectionStart,end:g.selectionEnd};else a:{var k=(h=(h=g.ownerDocument)&&h.defaultView||window).getSelection&&h.getSelection();if(k&&0!==k.rangeCount){h=k.anchorNode;var l=k.anchorOffset,m=k.focusNode;k=k.focusOffset;try{h.nodeType,m.nodeType}catch(wb){h=null;break a}var p=0,x=-1,z=-1,ca=0,D=0,t=g,y=null;b:for(;;){for(var A;t!==h||0!==l&&3!==t.nodeType||(x=p+l),t!==m||0!==k&&3!==t.nodeType||(z=p+k),3===t.nodeType&&(p+=t.nodeValue.length),null!==(A=t.firstChild);)y=t,t=A;for(;;){if(t===g)break b;if(y===h&&++ca===l&&(x=p),y===m&&++D===k&&(z=p),null!==(A=t.nextSibling))break;y=(t=y).parentNode}t=A}h=-1===x||-1===z?null:{start:x,end:z}}else h=null}h=h||{start:0,end:0}}else h=null;Ed={activeElementDetached:null,focusedElem:g,selectionRange:h},fd=!1,Y=e;do{try{Tj()}catch(wb){if(null===Y)throw Error(u(330));Ei(Y,wb),Y=Y.nextEffect}}while(null!==Y);Y=e;do{try{for(g=a,h=b;null!==Y;){var q=Y.effectTag;if(16&q&&Rb(Y.stateNode,""),128&q){var B=Y.alternate;if(null!==B){var w=B.ref;null!==w&&("function"==typeof w?w(null):w.current=null)}}switch(1038&q){case 2:Pi(Y),Y.effectTag&=-3;break;case 6:Pi(Y),Y.effectTag&=-3,Si(Y.alternate,Y);break;case 1024:Y.effectTag&=-1025;break;case 1028:Y.effectTag&=-1025,Si(Y.alternate,Y);break;case 4:Si(Y.alternate,Y);break;case 8:Mi(g,l=Y,h),Ni(l)}Y=Y.nextEffect}}catch(wb){if(null===Y)throw Error(u(330));Ei(Y,wb),Y=Y.nextEffect}}while(null!==Y);if(w=Ed,B=xd(),q=w.focusedElem,h=w.selectionRange,B!==q&&q&&q.ownerDocument&&wd(q.ownerDocument.documentElement,q)){null!==h&&yd(q)&&(B=h.start,void 0===(w=h.end)&&(w=B),"selectionStart"in q?(q.selectionStart=B,q.selectionEnd=Math.min(w,q.value.length)):(w=(B=q.ownerDocument||document)&&B.defaultView||window).getSelection&&(w=w.getSelection(),l=q.textContent.length,g=Math.min(h.start,l),h=void 0===h.end?g:Math.min(h.end,l),!w.extend&&g>h&&(l=h,h=g,g=l),l=vd(q,g),m=vd(q,h),l&&m&&(1!==w.rangeCount||w.anchorNode!==l.node||w.anchorOffset!==l.offset||w.focusNode!==m.node||w.focusOffset!==m.offset)&&((B=B.createRange()).setStart(l.node,l.offset),w.removeAllRanges(),g>h?(w.addRange(B),w.extend(m.node,m.offset)):(B.setEnd(m.node,m.offset),w.addRange(B))))),B=[];for(w=q;w=w.parentNode;)1===w.nodeType&&B.push({element:w,left:w.scrollLeft,top:w.scrollTop});for("function"==typeof q.focus&&q.focus(),q=0;q<B.length;q++)(w=B[q]).element.scrollLeft=w.left,w.element.scrollTop=w.top}fd=!!Dd,Ed=Dd=null,a.current=c,Y=e;do{try{for(q=a;null!==Y;){var ub=Y.effectTag;if(36&ub&&Ji(q,Y.alternate,Y),128&ub){B=void 0;var vb=Y.ref;if(null!==vb){var Xc=Y.stateNode;switch(Y.tag){case 5:B=Xc;break;default:B=Xc}"function"==typeof vb?vb(B):vb.current=B}}Y=Y.nextEffect}}catch(wb){if(null===Y)throw Error(u(330));Ei(Y,wb),Y=Y.nextEffect}}while(null!==Y);Y=null,Vf(),W=f}else a.current=c;if(qj)qj=!1,rj=a,sj=b;else for(Y=e;null!==Y;)b=Y.nextEffect,Y.nextEffect=null,Y=b;if(0===(b=a.firstPendingTime)&&(aj=null),1073741823===b?a===vj?uj++:(uj=0,vj=a):uj=0,"function"==typeof Uj&&Uj(c.stateNode,d),Z(a),Yi)throw Yi=!1,a=Zi,Zi=null,a;return 0!=(8&W)||gg(),null}function Tj(){for(;null!==Y;){var a=Y.effectTag;0!=(256&a)&&Gi(Y.alternate,Y),0==(512&a)||qj||(qj=!0,dg(97,(function(){return Dj(),null}))),Y=Y.nextEffect}}function Dj(){if(90!==sj){var a=97<sj?97:sj;return sj=90,cg(a,Vj)}}function Vj(){if(null===rj)return!1;var a=rj;if(rj=null,0!=(48&W))throw Error(u(331));var b=W;for(W|=32,a=a.current.firstEffect;null!==a;){try{var c=a;if(0!=(512&c.effectTag))switch(c.tag){case 0:case 11:case 15:case 22:Hi(5,c),Ii(5,c)}}catch(d){if(null===a)throw Error(u(330));Ei(a,d)}c=a.nextEffect,a.nextEffect=null,a=c}return W=b,gg(),!0}function Wj(a,b,c){xg(a,b=Xi(a,b=Ai(c,b),1073741823)),null!==(a=xj(a,1073741823))&&Z(a)}function Ei(a,b){if(3===a.tag)Wj(a,a,b);else for(var c=a.return;null!==c;){if(3===c.tag){Wj(c,a,b);break}if(1===c.tag){var d=c.stateNode;if("function"==typeof c.type.getDerivedStateFromError||"function"==typeof d.componentDidCatch&&(null===aj||!aj.has(d))){xg(c,a=$i(c,a=Ai(b,a),1073741823)),null!==(c=xj(c,1073741823))&&Z(c);break}}c=c.return}}function Oj(a,b,c){var d=a.pingCache;null!==d&&d.delete(b),T===a&&U===c?S===vi||S===ui&&1073741823===lj&&$f()-Ti<500?Ej(a,U):oj=!0:Aj(a,c)&&(0!==(b=a.lastPingedTime)&&b<c||(a.lastPingedTime=c,Z(a)))}function Vi(a,b){var c=a.stateNode;null!==c&&c.delete(b),0===(b=0)&&(b=Hg(b=Gg(),a,null)),null!==(a=xj(a,b))&&Z(a)}Rj=function(a,b,c){var d=b.expirationTime;if(null!==a){var e=b.pendingProps;if(a.memoizedProps!==e||K.current)rg=!0;else{if(d<c){switch(rg=!1,b.tag){case 3:hi(b),Xh();break;case 5:if(fh(b),4&b.mode&&1!==c&&e.hidden)return b.expirationTime=b.childExpirationTime=1,null;break;case 1:L(b.type)&&Gf(b);break;case 4:dh(b,b.stateNode.containerInfo);break;case 10:d=b.memoizedProps.value,e=b.type._context,I(jg,e._currentValue),e._currentValue=d;break;case 13:if(null!==b.memoizedState)return 0!==(d=b.child.childExpirationTime)&&d>=c?ji(a,b,c):(I(M,1&M.current),null!==(b=$h(a,b,c))?b.sibling:null);I(M,1&M.current);break;case 19:if(d=b.childExpirationTime>=c,0!=(64&a.effectTag)){if(d)return mi(a,b,c);b.effectTag|=64}if(null!==(e=b.memoizedState)&&(e.rendering=null,e.tail=null),I(M,M.current),!d)return null}return $h(a,b,c)}rg=!1}}else rg=!1;switch(b.expirationTime=0,b.tag){case 2:if(d=b.type,null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),a=b.pendingProps,e=Cf(b,J.current),qg(b,c),e=oh(null,b,d,a,e,c),b.effectTag|=1,"object"==typeof e&&null!==e&&"function"==typeof e.render&&void 0===e.$$typeof){if(b.tag=1,b.memoizedState=null,b.updateQueue=null,L(d)){var f=!0;Gf(b)}else f=!1;b.memoizedState=null!==e.state&&void 0!==e.state?e.state:null,ug(b);var g=d.getDerivedStateFromProps;"function"==typeof g&&Fg(b,d,g,a),e.updater=Jg,b.stateNode=e,e._reactInternalFiber=b,Ng(b,d,a,c),b=gi(null,b,d,!0,f,c)}else b.tag=0,R(null,b,e,c),b=b.child;return b;case 16:a:{if(e=b.elementType,null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),a=b.pendingProps,(function(a){if(-1===a._status){a._status=0;var b=a._ctor;b=b(),a._result=b,b.then((function(b){0===a._status&&(b=b.default,a._status=1,a._result=b)}),(function(b){0===a._status&&(a._status=2,a._result=b)}))}})(e),1!==e._status)throw e._result;switch(e=e._result,b.type=e,f=b.tag=(function(a){if("function"==typeof a)return bi(a)?1:0;if(null!=a){if((a=a.$$typeof)===gb)return 11;if(a===jb)return 14}return 2})(e),a=ig(e,a),f){case 0:b=di(null,b,e,a,c);break a;case 1:b=fi(null,b,e,a,c);break a;case 11:b=Zh(null,b,e,a,c);break a;case 14:b=ai(null,b,e,ig(e.type,a),d,c);break a}throw Error(u(306,e,""))}return b;case 0:return d=b.type,e=b.pendingProps,di(a,b,d,e=b.elementType===d?e:ig(d,e),c);case 1:return d=b.type,e=b.pendingProps,fi(a,b,d,e=b.elementType===d?e:ig(d,e),c);case 3:if(hi(b),d=b.updateQueue,null===a||null===d)throw Error(u(282));if(d=b.pendingProps,e=null!==(e=b.memoizedState)?e.element:null,vg(a,b),zg(b,d,null,c),(d=b.memoizedState.element)===e)Xh(),b=$h(a,b,c);else{if((e=b.stateNode.hydrate)&&(Ph=Jd(b.stateNode.containerInfo.firstChild),Oh=b,e=Qh=!0),e)for(c=Yg(b,null,d,c),b.child=c;c;)c.effectTag=-3&c.effectTag|1024,c=c.sibling;else R(a,b,d,c),Xh();b=b.child}return b;case 5:return fh(b),null===a&&Uh(b),d=b.type,e=b.pendingProps,f=null!==a?a.memoizedProps:null,g=e.children,Gd(d,e)?g=null:null!==f&&Gd(d,f)&&(b.effectTag|=16),ei(a,b),4&b.mode&&1!==c&&e.hidden?(b.expirationTime=b.childExpirationTime=1,b=null):(R(a,b,g,c),b=b.child),b;case 6:return null===a&&Uh(b),null;case 13:return ji(a,b,c);case 4:return dh(b,b.stateNode.containerInfo),d=b.pendingProps,null===a?b.child=Xg(b,null,d,c):R(a,b,d,c),b.child;case 11:return d=b.type,e=b.pendingProps,Zh(a,b,d,e=b.elementType===d?e:ig(d,e),c);case 7:return R(a,b,b.pendingProps,c),b.child;case 8:case 12:return R(a,b,b.pendingProps.children,c),b.child;case 10:a:{d=b.type._context,e=b.pendingProps,g=b.memoizedProps,f=e.value;var h=b.type._context;if(I(jg,h._currentValue),h._currentValue=f,null!==g)if(h=g.value,0===(f=$e(h,f)?0:0|("function"==typeof d._calculateChangedBits?d._calculateChangedBits(h,f):1073741823))){if(g.children===e.children&&!K.current){b=$h(a,b,c);break a}}else for(null!==(h=b.child)&&(h.return=b);null!==h;){var k=h.dependencies;if(null!==k){g=h.child;for(var l=k.firstContext;null!==l;){if(l.context===d&&0!=(l.observedBits&f)){1===h.tag&&((l=wg(c,null)).tag=2,xg(h,l)),h.expirationTime<c&&(h.expirationTime=c),null!==(l=h.alternate)&&l.expirationTime<c&&(l.expirationTime=c),pg(h.return,c),k.expirationTime<c&&(k.expirationTime=c);break}l=l.next}}else g=10===h.tag&&h.type===b.type?null:h.child;if(null!==g)g.return=h;else for(g=h;null!==g;){if(g===b){g=null;break}if(null!==(h=g.sibling)){h.return=g.return,g=h;break}g=g.return}h=g}R(a,b,e.children,c),b=b.child}return b;case 9:return e=b.type,d=(f=b.pendingProps).children,qg(b,c),d=d(e=sg(e,f.unstable_observedBits)),b.effectTag|=1,R(a,b,d,c),b.child;case 14:return f=ig(e=b.type,b.pendingProps),ai(a,b,e,f=ig(e.type,f),d,c);case 15:return ci(a,b,b.type,b.pendingProps,d,c);case 17:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:ig(d,e),null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),b.tag=1,L(d)?(a=!0,Gf(b)):a=!1,qg(b,c),Lg(b,d,e),Ng(b,d,e,c),gi(null,b,d,!0,a,c);case 19:return mi(a,b,c)}throw Error(u(156,b.tag))};var Uj=null,Li=null;function Zj(a,b,c,d){this.tag=a,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=b,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.effectTag=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childExpirationTime=this.expirationTime=0,this.alternate=null}function Sh(a,b,c,d){return new Zj(a,b,c,d)}function bi(a){return!(!(a=a.prototype)||!a.isReactComponent)}function Sg(a,b){var c=a.alternate;return null===c?((c=Sh(a.tag,b,a.key,a.mode)).elementType=a.elementType,c.type=a.type,c.stateNode=a.stateNode,c.alternate=a,a.alternate=c):(c.pendingProps=b,c.effectTag=0,c.nextEffect=null,c.firstEffect=null,c.lastEffect=null),c.childExpirationTime=a.childExpirationTime,c.expirationTime=a.expirationTime,c.child=a.child,c.memoizedProps=a.memoizedProps,c.memoizedState=a.memoizedState,c.updateQueue=a.updateQueue,b=a.dependencies,c.dependencies=null===b?null:{expirationTime:b.expirationTime,firstContext:b.firstContext,responders:b.responders},c.sibling=a.sibling,c.index=a.index,c.ref=a.ref,c}function Ug(a,b,c,d,e,f){var g=2;if(d=a,"function"==typeof a)bi(a)&&(g=1);else if("string"==typeof a)g=5;else a:switch(a){case ab:return Wg(c.children,e,f,b);case fb:g=8,e|=7;break;case bb:g=8,e|=1;break;case cb:return(a=Sh(12,c,b,8|e)).elementType=cb,a.type=cb,a.expirationTime=f,a;case hb:return(a=Sh(13,c,b,e)).type=hb,a.elementType=hb,a.expirationTime=f,a;case ib:return(a=Sh(19,c,b,e)).elementType=ib,a.expirationTime=f,a;default:if("object"==typeof a&&null!==a)switch(a.$$typeof){case db:g=10;break a;case eb:g=9;break a;case gb:g=11;break a;case jb:g=14;break a;case kb:g=16,d=null;break a;case lb:g=22;break a}throw Error(u(130,null==a?a:typeof a,""))}return(b=Sh(g,c,b,e)).elementType=a,b.type=d,b.expirationTime=f,b}function Wg(a,b,c,d){return(a=Sh(7,a,d,b)).expirationTime=c,a}function Tg(a,b,c){return(a=Sh(6,a,null,b)).expirationTime=c,a}function Vg(a,b,c){return(b=Sh(4,null!==a.children?a.children:[],a.key,b)).expirationTime=c,b.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},b}function ak(a,b,c){this.tag=b,this.current=null,this.containerInfo=a,this.pingCache=this.pendingChildren=null,this.finishedExpirationTime=0,this.finishedWork=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=c,this.callbackNode=null,this.callbackPriority=90,this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function Aj(a,b){var c=a.firstSuspendedTime;return a=a.lastSuspendedTime,0!==c&&c>=b&&a<=b}function xi(a,b){var c=a.firstSuspendedTime,d=a.lastSuspendedTime;c<b&&(a.firstSuspendedTime=b),(d>b||0===c)&&(a.lastSuspendedTime=b),b<=a.lastPingedTime&&(a.lastPingedTime=0),b<=a.lastExpiredTime&&(a.lastExpiredTime=0)}function yi(a,b){b>a.firstPendingTime&&(a.firstPendingTime=b);var c=a.firstSuspendedTime;0!==c&&(b>=c?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:b>=a.lastSuspendedTime&&(a.lastSuspendedTime=b+1),b>a.nextKnownPendingLevel&&(a.nextKnownPendingLevel=b))}function Cj(a,b){var c=a.lastExpiredTime;(0===c||c>b)&&(a.lastExpiredTime=b)}function bk(a,b,c,d){var e=b.current,f=Gg(),g=Dg.suspense;f=Hg(f,e,g);a:if(c){b:{if(dc(c=c._reactInternalFiber)!==c||1!==c.tag)throw Error(u(170));var h=c;do{switch(h.tag){case 3:h=h.stateNode.context;break b;case 1:if(L(h.type)){h=h.stateNode.__reactInternalMemoizedMergedChildContext;break b}}h=h.return}while(null!==h);throw Error(u(171))}if(1===c.tag){var k=c.type;if(L(k)){c=Ff(c,k,h);break a}}c=h}else c=Af;return null===b.context?b.context=c:b.pendingContext=c,(b=wg(f,g)).payload={element:a},null!==(d=void 0===d?null:d)&&(b.callback=d),xg(e,b),Ig(e,f),f}function ck(a){if(!(a=a.current).child)return null;switch(a.child.tag){case 5:default:return a.child.stateNode}}function dk(a,b){null!==(a=a.memoizedState)&&null!==a.dehydrated&&a.retryTime<b&&(a.retryTime=b)}function ek(a,b){dk(a,b),(a=a.alternate)&&dk(a,b)}function fk(a,b,c){var d=new ak(a,b,c=null!=c&&!0===c.hydrate),e=Sh(3,null,null,2===b?7:1===b?3:0);d.current=e,e.stateNode=d,ug(e),a[Od]=d.current,c&&0!==b&&(function(a,b){var c=cc(b);Hc.forEach((function(a){uc(a,b,c)})),Ic.forEach((function(a){uc(a,b,c)}))})(0,9===a.nodeType?a:a.ownerDocument),this._internalRoot=d}function gk(a){return!(!a||1!==a.nodeType&&9!==a.nodeType&&11!==a.nodeType&&(8!==a.nodeType||" react-mount-point-unstable "!==a.nodeValue))}function ik(a,b,c,d,e){var f=c._reactRootContainer;if(f){var g=f._internalRoot;if("function"==typeof e){var h=e;e=function(){var a=ck(g);h.call(a)}}bk(b,g,a,e)}else{if(f=c._reactRootContainer=(function(a,b){if(b||(b=!(!(b=a?9===a.nodeType?a.documentElement:a.firstChild:null)||1!==b.nodeType||!b.hasAttribute("data-reactroot"))),!b)for(var c;c=a.lastChild;)a.removeChild(c);return new fk(a,0,b?{hydrate:!0}:void 0)})(c,d),g=f._internalRoot,"function"==typeof e){var k=e;e=function(){var a=ck(g);k.call(a)}}Nj((function(){bk(b,g,a,e)}))}return ck(g)}function jk(a,b,c){var d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:$a,key:null==d?null:""+d,children:a,containerInfo:b,implementation:c}}function kk(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!gk(b))throw Error(u(200));return jk(a,b,null,c)}fk.prototype.render=function(a){bk(a,this._internalRoot,null,null)},fk.prototype.unmount=function(){var a=this._internalRoot,b=a.containerInfo;bk(null,a,null,(function(){b[Od]=null}))},wc=function(a){if(13===a.tag){var b=hg(Gg(),150,100);Ig(a,b),ek(a,b)}},xc=function(a){13===a.tag&&(Ig(a,3),ek(a,3))},yc=function(a){if(13===a.tag){var b=Gg();Ig(a,b=Hg(b,a,null)),ek(a,b)}},za=function(a,b,c){switch(b){case"input":if(Cb(a,c),b=c.name,"radio"===c.type&&null!=b){for(c=a;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll("input[name="+JSON.stringify(""+b)+'][type="radio"]'),b=0;b<c.length;b++){var d=c[b];if(d!==a&&d.form===a.form){var e=Qd(d);if(!e)throw Error(u(90));yb(d),Cb(d,e)}}}break;case"textarea":Kb(a,c);break;case"select":null!=(b=c.value)&&Hb(a,!!c.multiple,b,!1)}},Fa=Mj,Ga=function(a,b,c,d,e){var f=W;W|=4;try{return cg(98,a.bind(null,b,c,d,e))}finally{0===(W=f)&&gg()}},Ha=function(){0==(49&W)&&((function(){if(null!==tj){var a=tj;tj=null,a.forEach((function(a,c){Cj(c,a),Z(c)})),gg()}})(),Dj())},Ia=function(a,b){var c=W;W|=2;try{return a(b)}finally{0===(W=c)&&gg()}};var lk={Events:[Nc,Pd,Qd,xa,ta,Xd,function(a){jc(a,Wd)},Da,Ea,id,mc,Dj,{current:!1}]};!(function(a){var b=a.findFiberByHostInstance;(function(a){if("undefined"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var b=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(b.isDisabled||!b.supportsFiber)return!0;try{var c=b.inject(a);Uj=function(a){try{b.onCommitFiberRoot(c,a,void 0,64==(64&a.current.effectTag))}catch(e){}},Li=function(a){try{b.onCommitFiberUnmount(c,a)}catch(e){}}}catch(d){}})(n({},a,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Wa.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){return null===(a=hc(a))?null:a.stateNode},findFiberByHostInstance:function(a){return b?b(a):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null}))})({findFiberByHostInstance:tc,bundleType:0,version:"16.14.0",rendererPackageName:"react-dom"}),exports.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=lk,exports.createPortal=kk,exports.findDOMNode=function(a){if(null==a)return null;if(1===a.nodeType)return a;var b=a._reactInternalFiber;if(void 0===b){if("function"==typeof a.render)throw Error(u(188));throw Error(u(268,Object.keys(a)))}return a=null===(a=hc(b))?null:a.stateNode},exports.flushSync=function(a,b){if(0!=(48&W))throw Error(u(187));var c=W;W|=1;try{return cg(99,a.bind(null,b))}finally{W=c,gg()}},exports.hydrate=function(a,b,c){if(!gk(b))throw Error(u(200));return ik(null,a,b,!0,c)},exports.render=function(a,b,c){if(!gk(b))throw Error(u(200));return ik(null,a,b,!1,c)},exports.unmountComponentAtNode=function(a){if(!gk(a))throw Error(u(40));return!!a._reactRootContainer&&(Nj((function(){ik(null,null,a,!1,(function(){a._reactRootContainer=null,a[Od]=null}))})),!0)},exports.unstable_batchedUpdates=Mj,exports.unstable_createPortal=function(a,b){return kk(a,b,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)},exports.unstable_renderSubtreeIntoContainer=function(a,b,c,d){if(!gk(c))throw Error(u(200));if(null==a||void 0===a._reactInternalFiber)throw Error(u(38));return ik(a,b,c,!1,d)},exports.version="16.14.0"},3935:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";!(function checkDCE(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch(err){console.error(err)}})(),module.exports=__webpack_require__(4448)},2408:(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var l=__webpack_require__(7418),n="function"==typeof Symbol&&Symbol.for,p=n?Symbol.for("react.element"):60103,q=n?Symbol.for("react.portal"):60106,r=n?Symbol.for("react.fragment"):60107,t=n?Symbol.for("react.strict_mode"):60108,u=n?Symbol.for("react.profiler"):60114,v=n?Symbol.for("react.provider"):60109,w=n?Symbol.for("react.context"):60110,x=n?Symbol.for("react.forward_ref"):60112,y=n?Symbol.for("react.suspense"):60113,z=n?Symbol.for("react.memo"):60115,A=n?Symbol.for("react.lazy"):60116,B="function"==typeof Symbol&&Symbol.iterator;function C(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var D={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E={};function F(a,b,c){this.props=a,this.context=b,this.refs=E,this.updater=c||D}function G(){}function H(a,b,c){this.props=a,this.context=b,this.refs=E,this.updater=c||D}F.prototype.isReactComponent={},F.prototype.setState=function(a,b){if("object"!=typeof a&&"function"!=typeof a&&null!=a)throw Error(C(85));this.updater.enqueueSetState(this,a,b,"setState")},F.prototype.forceUpdate=function(a){this.updater.enqueueForceUpdate(this,a,"forceUpdate")},G.prototype=F.prototype;var I=H.prototype=new G;I.constructor=H,l(I,F.prototype),I.isPureReactComponent=!0;var J={current:null},K=Object.prototype.hasOwnProperty,L={key:!0,ref:!0,__self:!0,__source:!0};function M(a,b,c){var e,d={},g=null,k=null;if(null!=b)for(e in void 0!==b.ref&&(k=b.ref),void 0!==b.key&&(g=""+b.key),b)K.call(b,e)&&!L.hasOwnProperty(e)&&(d[e]=b[e]);var f=arguments.length-2;if(1===f)d.children=c;else if(1<f){for(var h=Array(f),m=0;m<f;m++)h[m]=arguments[m+2];d.children=h}if(a&&a.defaultProps)for(e in f=a.defaultProps)void 0===d[e]&&(d[e]=f[e]);return{$$typeof:p,type:a,key:g,ref:k,props:d,_owner:J.current}}function O(a){return"object"==typeof a&&null!==a&&a.$$typeof===p}var P=/\/+/g,Q=[];function R(a,b,c,e){if(Q.length){var d=Q.pop();return d.result=a,d.keyPrefix=b,d.func=c,d.context=e,d.count=0,d}return{result:a,keyPrefix:b,func:c,context:e,count:0}}function S(a){a.result=null,a.keyPrefix=null,a.func=null,a.context=null,a.count=0,10>Q.length&&Q.push(a)}function T(a,b,c,e){var d=typeof a;"undefined"!==d&&"boolean"!==d||(a=null);var g=!1;if(null===a)g=!0;else switch(d){case"string":case"number":g=!0;break;case"object":switch(a.$$typeof){case p:case q:g=!0}}if(g)return c(e,a,""===b?"."+U(a,0):b),1;if(g=0,b=""===b?".":b+":",Array.isArray(a))for(var k=0;k<a.length;k++){var f=b+U(d=a[k],k);g+=T(d,f,c,e)}else if(null===a||"object"!=typeof a?f=null:f="function"==typeof(f=B&&a[B]||a["@@iterator"])?f:null,"function"==typeof f)for(a=f.call(a),k=0;!(d=a.next()).done;)g+=T(d=d.value,f=b+U(d,k++),c,e);else if("object"===d)throw c=""+a,Error(C(31,"[object Object]"===c?"object with keys {"+Object.keys(a).join(", ")+"}":c,""));return g}function V(a,b,c){return null==a?0:T(a,"",b,c)}function U(a,b){return"object"==typeof a&&null!==a&&null!=a.key?(function(a){var b={"=":"=0",":":"=2"};return"$"+(""+a).replace(/[=:]/g,(function(a){return b[a]}))})(a.key):b.toString(36)}function W(a,b){a.func.call(a.context,b,a.count++)}function aa(a,b,c){var e=a.result,d=a.keyPrefix;a=a.func.call(a.context,b,a.count++),Array.isArray(a)?X(a,e,c,(function(a){return a})):null!=a&&(O(a)&&(a=(function(a,b){return{$$typeof:p,type:a.type,key:b,ref:a.ref,props:a.props,_owner:a._owner}})(a,d+(!a.key||b&&b.key===a.key?"":(""+a.key).replace(P,"$&/")+"/")+c)),e.push(a))}function X(a,b,c,e,d){var g="";null!=c&&(g=(""+c).replace(P,"$&/")+"/"),V(a,aa,b=R(b,g,e,d)),S(b)}var Y={current:null};function Z(){var a=Y.current;if(null===a)throw Error(C(321));return a}var ba={ReactCurrentDispatcher:Y,ReactCurrentBatchConfig:{suspense:null},ReactCurrentOwner:J,IsSomeRendererActing:{current:!1},assign:l};exports.Children={map:function(a,b,c){if(null==a)return a;var e=[];return X(a,e,null,b,c),e},forEach:function(a,b,c){if(null==a)return a;V(a,W,b=R(null,null,b,c)),S(b)},count:function(a){return V(a,(function(){return null}),null)},toArray:function(a){var b=[];return X(a,b,null,(function(a){return a})),b},only:function(a){if(!O(a))throw Error(C(143));return a}},exports.Component=F,exports.Fragment=r,exports.Profiler=u,exports.PureComponent=H,exports.StrictMode=t,exports.Suspense=y,exports.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ba,exports.cloneElement=function(a,b,c){if(null==a)throw Error(C(267,a));var e=l({},a.props),d=a.key,g=a.ref,k=a._owner;if(null!=b){if(void 0!==b.ref&&(g=b.ref,k=J.current),void 0!==b.key&&(d=""+b.key),a.type&&a.type.defaultProps)var f=a.type.defaultProps;for(h in b)K.call(b,h)&&!L.hasOwnProperty(h)&&(e[h]=void 0===b[h]&&void 0!==f?f[h]:b[h])}var h=arguments.length-2;if(1===h)e.children=c;else if(1<h){f=Array(h);for(var m=0;m<h;m++)f[m]=arguments[m+2];e.children=f}return{$$typeof:p,type:a.type,key:d,ref:g,props:e,_owner:k}},exports.createContext=function(a,b){return void 0===b&&(b=null),(a={$$typeof:w,_calculateChangedBits:b,_currentValue:a,_currentValue2:a,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:v,_context:a},a.Consumer=a},exports.createElement=M,exports.createFactory=function(a){var b=M.bind(null,a);return b.type=a,b},exports.createRef=function(){return{current:null}},exports.forwardRef=function(a){return{$$typeof:x,render:a}},exports.isValidElement=O,exports.lazy=function(a){return{$$typeof:A,_ctor:a,_status:-1,_result:null}},exports.memo=function(a,b){return{$$typeof:z,type:a,compare:void 0===b?null:b}},exports.useCallback=function(a,b){return Z().useCallback(a,b)},exports.useContext=function(a,b){return Z().useContext(a,b)},exports.useDebugValue=function(){},exports.useEffect=function(a,b){return Z().useEffect(a,b)},exports.useImperativeHandle=function(a,b,c){return Z().useImperativeHandle(a,b,c)},exports.useLayoutEffect=function(a,b){return Z().useLayoutEffect(a,b)},exports.useMemo=function(a,b){return Z().useMemo(a,b)},exports.useReducer=function(a,b,c){return Z().useReducer(a,b,c)},exports.useRef=function(a){return Z().useRef(a)},exports.useState=function(a){return Z().useState(a)},exports.version="16.14.0"},7294:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";module.exports=__webpack_require__(2408)},53:(__unused_webpack_module,exports)=>{"use strict";var f,g,h,k,l;if("undefined"==typeof window||"function"!=typeof MessageChannel){var p=null,q=null,t=function(){if(null!==p)try{var a=exports.unstable_now();p(!0,a),p=null}catch(b){throw setTimeout(t,0),b}},u=Date.now();exports.unstable_now=function(){return Date.now()-u},f=function(a){null!==p?setTimeout(f,0,a):(p=a,setTimeout(t,0))},g=function(a,b){q=setTimeout(a,b)},h=function(){clearTimeout(q)},k=function(){return!1},l=exports.unstable_forceFrameRate=function(){}}else{var w=window.performance,x=window.Date,y=window.setTimeout,z=window.clearTimeout;if("undefined"!=typeof console){var A=window.cancelAnimationFrame;"function"!=typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),"function"!=typeof A&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills")}if("object"==typeof w&&"function"==typeof w.now)exports.unstable_now=function(){return w.now()};else{var B=x.now();exports.unstable_now=function(){return x.now()-B}}var C=!1,D=null,E=-1,F=5,G=0;k=function(){return exports.unstable_now()>=G},l=function(){},exports.unstable_forceFrameRate=function(a){0>a||125<a?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):F=0<a?Math.floor(1e3/a):5};var H=new MessageChannel,I=H.port2;H.port1.onmessage=function(){if(null!==D){var a=exports.unstable_now();G=a+F;try{D(!0,a)?I.postMessage(null):(C=!1,D=null)}catch(b){throw I.postMessage(null),b}}else C=!1},f=function(a){D=a,C||(C=!0,I.postMessage(null))},g=function(a,b){E=y((function(){a(exports.unstable_now())}),b)},h=function(){z(E),E=-1}}function J(a,b){var c=a.length;a.push(b);a:for(;;){var d=c-1>>>1,e=a[d];if(!(void 0!==e&&0<K(e,b)))break a;a[d]=b,a[c]=e,c=d}}function L(a){return void 0===(a=a[0])?null:a}function M(a){var b=a[0];if(void 0!==b){var c=a.pop();if(c!==b){a[0]=c;a:for(var d=0,e=a.length;d<e;){var m=2*(d+1)-1,n=a[m],v=m+1,r=a[v];if(void 0!==n&&0>K(n,c))void 0!==r&&0>K(r,n)?(a[d]=r,a[v]=c,d=v):(a[d]=n,a[m]=c,d=m);else{if(!(void 0!==r&&0>K(r,c)))break a;a[d]=r,a[v]=c,d=v}}}return b}return null}function K(a,b){var c=a.sortIndex-b.sortIndex;return 0!==c?c:a.id-b.id}var N=[],O=[],P=1,Q=null,R=3,S=!1,T=!1,U=!1;function V(a){for(var b=L(O);null!==b;){if(null===b.callback)M(O);else{if(!(b.startTime<=a))break;M(O),b.sortIndex=b.expirationTime,J(N,b)}b=L(O)}}function W(a){if(U=!1,V(a),!T)if(null!==L(N))T=!0,f(X);else{var b=L(O);null!==b&&g(W,b.startTime-a)}}function X(a,b){T=!1,U&&(U=!1,h()),S=!0;var c=R;try{for(V(b),Q=L(N);null!==Q&&(!(Q.expirationTime>b)||a&&!k());){var d=Q.callback;if(null!==d){Q.callback=null,R=Q.priorityLevel;var e=d(Q.expirationTime<=b);b=exports.unstable_now(),"function"==typeof e?Q.callback=e:Q===L(N)&&M(N),V(b)}else M(N);Q=L(N)}if(null!==Q)var m=!0;else{var n=L(O);null!==n&&g(W,n.startTime-b),m=!1}return m}finally{Q=null,R=c,S=!1}}function Y(a){switch(a){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1e4;default:return 5e3}}var Z=l;exports.unstable_IdlePriority=5,exports.unstable_ImmediatePriority=1,exports.unstable_LowPriority=4,exports.unstable_NormalPriority=3,exports.unstable_Profiling=null,exports.unstable_UserBlockingPriority=2,exports.unstable_cancelCallback=function(a){a.callback=null},exports.unstable_continueExecution=function(){T||S||(T=!0,f(X))},exports.unstable_getCurrentPriorityLevel=function(){return R},exports.unstable_getFirstCallbackNode=function(){return L(N)},exports.unstable_next=function(a){switch(R){case 1:case 2:case 3:var b=3;break;default:b=R}var c=R;R=b;try{return a()}finally{R=c}},exports.unstable_pauseExecution=function(){},exports.unstable_requestPaint=Z,exports.unstable_runWithPriority=function(a,b){switch(a){case 1:case 2:case 3:case 4:case 5:break;default:a=3}var c=R;R=a;try{return b()}finally{R=c}},exports.unstable_scheduleCallback=function(a,b,c){var d=exports.unstable_now();if("object"==typeof c&&null!==c){var e=c.delay;e="number"==typeof e&&0<e?d+e:d,c="number"==typeof c.timeout?c.timeout:Y(a)}else c=Y(a),e=d;return a={id:P++,callback:b,priorityLevel:a,startTime:e,expirationTime:c=e+c,sortIndex:-1},e>d?(a.sortIndex=e,J(O,a),null===L(N)&&a===L(O)&&(U?h():U=!0,g(W,e-d))):(a.sortIndex=c,J(N,a),T||S||(T=!0,f(X))),a},exports.unstable_shouldYield=function(){var a=exports.unstable_now();V(a);var b=L(N);return b!==Q&&null!==Q&&null!==b&&null!==b.callback&&b.startTime<=a&&b.expirationTime<Q.expirationTime||k()},exports.unstable_wrapCallback=function(a){var b=R;return function(){var c=R;R=b;try{return a.apply(this,arguments)}finally{R=c}}}},3840:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";module.exports=__webpack_require__(53)},6851:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var isArrayish=__webpack_require__(9594),concat=Array.prototype.concat,slice=Array.prototype.slice,swizzle=module.exports=function(args){for(var results=[],i=0,len=args.length;i<len;i++){var arg=args[i];isArrayish(arg)?results=concat.call(results,slice.call(arg)):results.push(arg)}return results};swizzle.wrap=function(fn){return function(){return fn(swizzle(arguments))}}},9594:module=>{module.exports=function(obj){return!(!obj||"string"==typeof obj)&&(obj instanceof Array||Array.isArray(obj)||obj.length>=0&&(obj.splice instanceof Function||Object.getOwnPropertyDescriptor(obj,obj.length-1)&&"String"!==obj.constructor.name))}},5017:(__unused_webpack_module,exports,__webpack_require__)=>{var base32=__webpack_require__(883);exports.encode=base32.encode,exports.decode=base32.decode},883:(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var Buffer=__webpack_require__(8764).Buffer,byteTable=[255,255,26,27,28,29,30,31,255,255,255,255,255,255,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255];exports.encode=function(plain){Buffer.isBuffer(plain)||(plain=new Buffer(plain));for(var buff,quintets,i=0,j=0,shiftIndex=0,digit=0,encoded=new Buffer(8*(buff=plain,quintets=Math.floor(buff.length/5),buff.length%5==0?quintets:quintets+1));i<plain.length;){var current=plain[i];shiftIndex>3?(digit=(digit=current&255>>shiftIndex)<<(shiftIndex=(shiftIndex+5)%8)|(i+1<plain.length?plain[i+1]:0)>>8-shiftIndex,i++):(digit=current>>8-(shiftIndex+5)&31,0===(shiftIndex=(shiftIndex+5)%8)&&i++),encoded[j]="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".charCodeAt(digit),j++}for(i=j;i<encoded.length;i++)encoded[i]=61;return encoded},exports.decode=function(encoded){var plainChar,shiftIndex=0,plainDigit=0,plainPos=0;Buffer.isBuffer(encoded)||(encoded=new Buffer(encoded));for(var decoded=new Buffer(Math.ceil(5*encoded.length/8)),i=0;i<encoded.length&&61!==encoded[i];i++){var encodedByte=encoded[i]-48;if(!(encodedByte<byteTable.length))throw new Error("Invalid input - it is not base32 encoded string");plainDigit=byteTable[encodedByte],shiftIndex<=3?0===(shiftIndex=(shiftIndex+5)%8)?(plainChar|=plainDigit,decoded[plainPos]=plainChar,plainPos++,plainChar=0):plainChar|=255&plainDigit<<8-shiftIndex:(plainChar|=255&plainDigit>>>(shiftIndex=(shiftIndex+5)%8),decoded[plainPos]=plainChar,plainPos++,plainChar=255&plainDigit<<8-shiftIndex)}return decoded.slice(0,plainPos)}},8575:(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var punycode=__webpack_require__(4971),util=__webpack_require__(2502);function Url(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}exports.parse=urlParse,exports.resolve=function(source,relative){return urlParse(source,!1,!0).resolve(relative)},exports.resolveObject=function(source,relative){return source?urlParse(source,!1,!0).resolveObject(relative):relative},exports.format=function(obj){util.isString(obj)&&(obj=urlParse(obj));return obj instanceof Url?obj.format():Url.prototype.format.call(obj)},exports.Url=Url;var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,unwise=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:!0,"javascript:":!0},hostlessProtocol={javascript:!0,"javascript:":!0},slashedProtocol={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},querystring=__webpack_require__(7673);function urlParse(url,parseQueryString,slashesDenoteHost){if(url&&util.isObject(url)&&url instanceof Url)return url;var u=new Url;return u.parse(url,parseQueryString,slashesDenoteHost),u}Url.prototype.parse=function(url,parseQueryString,slashesDenoteHost){if(!util.isString(url))throw new TypeError("Parameter 'url' must be a string, not "+typeof url);var queryIndex=url.indexOf("?"),splitter=-1!==queryIndex&&queryIndex<url.indexOf("#")?"?":"#",uSplit=url.split(splitter);uSplit[0]=uSplit[0].replace(/\\/g,"/");var rest=url=uSplit.join(splitter);if(rest=rest.trim(),!slashesDenoteHost&&1===url.split("#").length){var simplePath=simplePathPattern.exec(rest);if(simplePath)return this.path=rest,this.href=rest,this.pathname=simplePath[1],simplePath[2]?(this.search=simplePath[2],this.query=parseQueryString?querystring.parse(this.search.substr(1)):this.search.substr(1)):parseQueryString&&(this.search="",this.query={}),this}var proto=protocolPattern.exec(rest);if(proto){var lowerProto=(proto=proto[0]).toLowerCase();this.protocol=lowerProto,rest=rest.substr(proto.length)}if(slashesDenoteHost||proto||rest.match(/^\/\/[^@\/]+@[^@\/]+/)){var slashes="//"===rest.substr(0,2);!slashes||proto&&hostlessProtocol[proto]||(rest=rest.substr(2),this.slashes=!0)}if(!hostlessProtocol[proto]&&(slashes||proto&&!slashedProtocol[proto])){for(var auth,atSign,hostEnd=-1,i=0;i<hostEndingChars.length;i++){-1!==(hec=rest.indexOf(hostEndingChars[i]))&&(-1===hostEnd||hec<hostEnd)&&(hostEnd=hec)}-1!==(atSign=-1===hostEnd?rest.lastIndexOf("@"):rest.lastIndexOf("@",hostEnd))&&(auth=rest.slice(0,atSign),rest=rest.slice(atSign+1),this.auth=decodeURIComponent(auth)),hostEnd=-1;for(i=0;i<nonHostChars.length;i++){var hec;-1!==(hec=rest.indexOf(nonHostChars[i]))&&(-1===hostEnd||hec<hostEnd)&&(hostEnd=hec)}-1===hostEnd&&(hostEnd=rest.length),this.host=rest.slice(0,hostEnd),rest=rest.slice(hostEnd),this.parseHost(),this.hostname=this.hostname||"";var ipv6Hostname="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!ipv6Hostname)for(var hostparts=this.hostname.split(/\./),l=(i=0,hostparts.length);i<l;i++){var part=hostparts[i];if(part&&!part.match(hostnamePartPattern)){for(var newpart="",j=0,k=part.length;j<k;j++)part.charCodeAt(j)>127?newpart+="x":newpart+=part[j];if(!newpart.match(hostnamePartPattern)){var validParts=hostparts.slice(0,i),notHost=hostparts.slice(i+1),bit=part.match(hostnamePartStart);bit&&(validParts.push(bit[1]),notHost.unshift(bit[2])),notHost.length&&(rest="/"+notHost.join(".")+rest),this.hostname=validParts.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),ipv6Hostname||(this.hostname=punycode.toASCII(this.hostname));var p=this.port?":"+this.port:"",h=this.hostname||"";this.host=h+p,this.href+=this.host,ipv6Hostname&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==rest[0]&&(rest="/"+rest))}if(!unsafeProtocol[lowerProto])for(i=0,l=autoEscape.length;i<l;i++){var ae=autoEscape[i];if(-1!==rest.indexOf(ae)){var esc=encodeURIComponent(ae);esc===ae&&(esc=escape(ae)),rest=rest.split(ae).join(esc)}}var hash=rest.indexOf("#");-1!==hash&&(this.hash=rest.substr(hash),rest=rest.slice(0,hash));var qm=rest.indexOf("?");if(-1!==qm?(this.search=rest.substr(qm),this.query=rest.substr(qm+1),parseQueryString&&(this.query=querystring.parse(this.query)),rest=rest.slice(0,qm)):parseQueryString&&(this.search="",this.query={}),rest&&(this.pathname=rest),slashedProtocol[lowerProto]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){p=this.pathname||"";var s=this.search||"";this.path=p+s}return this.href=this.format(),this},Url.prototype.format=function(){var auth=this.auth||"";auth&&(auth=(auth=encodeURIComponent(auth)).replace(/%3A/i,":"),auth+="@");var protocol=this.protocol||"",pathname=this.pathname||"",hash=this.hash||"",host=!1,query="";this.host?host=auth+this.host:this.hostname&&(host=auth+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(host+=":"+this.port)),this.query&&util.isObject(this.query)&&Object.keys(this.query).length&&(query=querystring.stringify(this.query));var search=this.search||query&&"?"+query||"";return protocol&&":"!==protocol.substr(-1)&&(protocol+=":"),this.slashes||(!protocol||slashedProtocol[protocol])&&!1!==host?(host="//"+(host||""),pathname&&"/"!==pathname.charAt(0)&&(pathname="/"+pathname)):host||(host=""),hash&&"#"!==hash.charAt(0)&&(hash="#"+hash),search&&"?"!==search.charAt(0)&&(search="?"+search),protocol+host+(pathname=pathname.replace(/[?#]/g,(function(match){return encodeURIComponent(match)})))+(search=search.replace("#","%23"))+hash},Url.prototype.resolve=function(relative){return this.resolveObject(urlParse(relative,!1,!0)).format()},Url.prototype.resolveObject=function(relative){if(util.isString(relative)){var rel=new Url;rel.parse(relative,!1,!0),relative=rel}for(var result=new Url,tkeys=Object.keys(this),tk=0;tk<tkeys.length;tk++){var tkey=tkeys[tk];result[tkey]=this[tkey]}if(result.hash=relative.hash,""===relative.href)return result.href=result.format(),result;if(relative.slashes&&!relative.protocol){for(var rkeys=Object.keys(relative),rk=0;rk<rkeys.length;rk++){var rkey=rkeys[rk];"protocol"!==rkey&&(result[rkey]=relative[rkey])}return slashedProtocol[result.protocol]&&result.hostname&&!result.pathname&&(result.path=result.pathname="/"),result.href=result.format(),result}if(relative.protocol&&relative.protocol!==result.protocol){if(!slashedProtocol[relative.protocol]){for(var keys=Object.keys(relative),v=0;v<keys.length;v++){var k=keys[v];result[k]=relative[k]}return result.href=result.format(),result}if(result.protocol=relative.protocol,relative.host||hostlessProtocol[relative.protocol])result.pathname=relative.pathname;else{for(var relPath=(relative.pathname||"").split("/");relPath.length&&!(relative.host=relPath.shift()););relative.host||(relative.host=""),relative.hostname||(relative.hostname=""),""!==relPath[0]&&relPath.unshift(""),relPath.length<2&&relPath.unshift(""),result.pathname=relPath.join("/")}if(result.search=relative.search,result.query=relative.query,result.host=relative.host||"",result.auth=relative.auth,result.hostname=relative.hostname||relative.host,result.port=relative.port,result.pathname||result.search){var p=result.pathname||"",s=result.search||"";result.path=p+s}return result.slashes=result.slashes||relative.slashes,result.href=result.format(),result}var isSourceAbs=result.pathname&&"/"===result.pathname.charAt(0),isRelAbs=relative.host||relative.pathname&&"/"===relative.pathname.charAt(0),mustEndAbs=isRelAbs||isSourceAbs||result.host&&relative.pathname,removeAllDots=mustEndAbs,srcPath=result.pathname&&result.pathname.split("/")||[],psychotic=(relPath=relative.pathname&&relative.pathname.split("/")||[],result.protocol&&!slashedProtocol[result.protocol]);if(psychotic&&(result.hostname="",result.port=null,result.host&&(""===srcPath[0]?srcPath[0]=result.host:srcPath.unshift(result.host)),result.host="",relative.protocol&&(relative.hostname=null,relative.port=null,relative.host&&(""===relPath[0]?relPath[0]=relative.host:relPath.unshift(relative.host)),relative.host=null),mustEndAbs=mustEndAbs&&(""===relPath[0]||""===srcPath[0])),isRelAbs)result.host=relative.host||""===relative.host?relative.host:result.host,result.hostname=relative.hostname||""===relative.hostname?relative.hostname:result.hostname,result.search=relative.search,result.query=relative.query,srcPath=relPath;else if(relPath.length)srcPath||(srcPath=[]),srcPath.pop(),srcPath=srcPath.concat(relPath),result.search=relative.search,result.query=relative.query;else if(!util.isNullOrUndefined(relative.search)){if(psychotic)result.hostname=result.host=srcPath.shift(),(authInHost=!!(result.host&&result.host.indexOf("@")>0)&&result.host.split("@"))&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift());return result.search=relative.search,result.query=relative.query,util.isNull(result.pathname)&&util.isNull(result.search)||(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.href=result.format(),result}if(!srcPath.length)return result.pathname=null,result.search?result.path="/"+result.search:result.path=null,result.href=result.format(),result;for(var last=srcPath.slice(-1)[0],hasTrailingSlash=(result.host||relative.host||srcPath.length>1)&&("."===last||".."===last)||""===last,up=0,i=srcPath.length;i>=0;i--)"."===(last=srcPath[i])?srcPath.splice(i,1):".."===last?(srcPath.splice(i,1),up++):up&&(srcPath.splice(i,1),up--);if(!mustEndAbs&&!removeAllDots)for(;up--;up)srcPath.unshift("..");!mustEndAbs||""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0)||srcPath.unshift(""),hasTrailingSlash&&"/"!==srcPath.join("/").substr(-1)&&srcPath.push("");var authInHost,isAbsolute=""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0);psychotic&&(result.hostname=result.host=isAbsolute?"":srcPath.length?srcPath.shift():"",(authInHost=!!(result.host&&result.host.indexOf("@")>0)&&result.host.split("@"))&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift()));return(mustEndAbs=mustEndAbs||result.host&&srcPath.length)&&!isAbsolute&&srcPath.unshift(""),srcPath.length?result.pathname=srcPath.join("/"):(result.pathname=null,result.path=null),util.isNull(result.pathname)&&util.isNull(result.search)||(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.auth=relative.auth||result.auth,result.slashes=result.slashes||relative.slashes,result.href=result.format(),result},Url.prototype.parseHost=function(){var host=this.host,port=portPattern.exec(host);port&&(":"!==(port=port[0])&&(this.port=port.substr(1)),host=host.substr(0,host.length-port.length)),host&&(this.hostname=host)}},2502:module=>{"use strict";module.exports={isString:function(arg){return"string"==typeof arg},isObject:function(arg){return"object"==typeof arg&&null!==arg},isNull:function(arg){return null===arg},isNullOrUndefined:function(arg){return null==arg}}},8369:(module,__unused_webpack_exports,__webpack_require__)=>{module.exports={WebVTT:__webpack_require__(112).WebVTT,VTTCue:__webpack_require__(6427).VTTCue,VTTRegion:__webpack_require__(7224).VTTRegion}},112:function(){!(function(global){function makeColorSet(color,opacity){return void 0===opacity&&(opacity=1),"rgba("+[parseInt(color.substring(0,2),16),parseInt(color.substring(2,4),16),parseInt(color.substring(4,6),16),opacity].join(",")+")"}var fontScale=1;function observe(subject,topic,data){switch(data){case"webvtt.font.color":case"webvtt.font.opacity":var fontColor=Services.prefs.getCharPref("webvtt.font.color"),fontOpacity=Services.prefs.getIntPref("webvtt.font.opacity")/100;WebVTTSet.fontSet=makeColorSet(fontColor,fontOpacity);break;case"webvtt.font.scale":fontScale=Services.prefs.getIntPref("webvtt.font.scale")/100;break;case"webvtt.bg.color":case"webvtt.bg.opacity":var backgroundColor=Services.prefs.getCharPref("webvtt.bg.color"),backgroundOpacity=Services.prefs.getIntPref("webvtt.bg.opacity")/100;WebVTTSet.backgroundSet=makeColorSet(backgroundColor,backgroundOpacity);break;case"webvtt.edge.color":case"webvtt.edge.type":var edgeType=Services.prefs.getIntPref("webvtt.edge.type"),edgeColor=Services.prefs.getCharPref("webvtt.edge.color");WebVTTSet.edgeSet=["","0px 0px ","4px 4px 4px ","-2px -2px ","2px 2px "][edgeType]+makeColorSet(edgeColor)}}if("undefined"!=typeof Services){var WebVTTSet={};["webvtt.font.color","webvtt.font.opacity","webvtt.font.scale","webvtt.bg.color","webvtt.bg.opacity","webvtt.edge.color","webvtt.edge.type"].forEach((function(pref){observe(0,0,pref),Services.prefs.addObserver(pref,observe,!1)}))}var _objCreate=Object.create||(function(){function F(){}return function(o){if(1!==arguments.length)throw new Error("Object.create shim only accepts one parameter.");return F.prototype=o,new F}})();function ParsingError(errorData,message){this.name="ParsingError",this.code=errorData.code,this.message=message||errorData.message}function parseTimeStamp(input){function computeSeconds(h,m,s,f){return 3600*(0|h)+60*(0|m)+(0|s)+(0|f)/1e3}var m=input.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return m?m[3]?computeSeconds(m[1],m[2],m[3].replace(":",""),m[4]):m[1]>59?computeSeconds(m[1],m[2],0,m[4]):computeSeconds(0,m[1],m[2],m[4]):null}function Settings(){this.values=_objCreate(null)}function parseOptions(input,callback,keyValueDelim,groupDelim){var groups=groupDelim?input.split(groupDelim):[input];for(var i in groups)if("string"==typeof groups[i]){var kv=groups[i].split(keyValueDelim);if(2===kv.length)callback(kv[0],kv[1])}}ParsingError.prototype=_objCreate(Error.prototype),ParsingError.prototype.constructor=ParsingError,ParsingError.Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}},Settings.prototype={set:function(k,v){this.get(k)||""===v||(this.values[k]=v)},get:function(k,dflt,defaultKey){return defaultKey?this.has(k)?this.values[k]:dflt[defaultKey]:this.has(k)?this.values[k]:dflt},has:function(k){return k in this.values},alt:function(k,v,a){for(var n=0;n<a.length;++n)if(v===a[n]){this.set(k,v);break}},integer:function(k,v){/^-?\d+$/.test(v)&&this.set(k,parseInt(v,10))},percent:function(k,v){return!!(v.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(v=parseFloat(v))>=0&&v<=100)&&(this.set(k,v),!0)}};var ESCAPE={"&amp;":"&","&lt;":"<","&gt;":">","&lrm;":"‎","&rlm;":"‏","&nbsp;":" "},TAG_NAME={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},TAG_ANNOTATION={v:"title",lang:"lang"},NEEDS_PARENT={rt:"ruby"};function parseContent(window,input){function nextToken(){if(!input)return null;var result,m=input.match(/^([^<]*)(<[^>]+>?)?/);return result=m[1]?m[1]:m[2],input=input.substr(result.length),result}function unescape1(e){return ESCAPE[e]}function unescape(s){for(;m=s.match(/&(amp|lt|gt|lrm|rlm|nbsp);/);)s=s.replace(m[0],unescape1);return s}function shouldAdd(current,element){return!NEEDS_PARENT[element.localName]||NEEDS_PARENT[element.localName]===current.localName}function createElement(type,annotation){var tagName=TAG_NAME[type];if(!tagName)return null;var element=window.document.createElement(tagName);element.localName=tagName;var name=TAG_ANNOTATION[type];return name&&annotation&&(element[name]=annotation.trim()),element}for(var t,rootDiv=window.document.createElement("div"),current=rootDiv,tagStack=[];null!==(t=nextToken());)if("<"!==t[0])current.appendChild(window.document.createTextNode(unescape(t)));else{if("/"===t[1]){tagStack.length&&tagStack[tagStack.length-1]===t.substr(2).replace(">","")&&(tagStack.pop(),current=current.parentNode);continue}var node,ts=parseTimeStamp(t.substr(1,t.length-2));if(ts){node=window.document.createProcessingInstruction("timestamp",ts),current.appendChild(node);continue}var m=t.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/);if(!m)continue;if(!(node=createElement(m[1],m[3])))continue;if(!shouldAdd(current,node))continue;m[2]&&(node.className=m[2].substr(1).replace("."," ")),tagStack.push(m[1]),current.appendChild(node),current=node}return rootDiv}var strongRTLRanges=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];function isStrongRTLChar(charCode){for(var i=0;i<strongRTLRanges.length;i++){var currentRange=strongRTLRanges[i];if(charCode>=currentRange[0]&&charCode<=currentRange[1])return!0}return!1}function StyleBox(){}function CueStyleBox(window,cue,styleOptions){var isIE8="undefined"!=typeof navigator&&/MSIE\s8\.0/.test(navigator.userAgent),color="rgba(255, 255, 255, 1)",backgroundColor="rgba(0, 0, 0, 0.8)",textShadow="";void 0!==WebVTTSet&&(color=WebVTTSet.fontSet,backgroundColor=WebVTTSet.backgroundSet,textShadow=WebVTTSet.edgeSet),isIE8&&(color="rgb(255, 255, 255)",backgroundColor="rgb(0, 0, 0)"),StyleBox.call(this),this.cue=cue,this.cueDiv=parseContent(window,cue.text);var styles={color:color,backgroundColor:backgroundColor,textShadow:textShadow,position:"relative",left:0,right:0,top:0,bottom:0,display:"inline"};isIE8||(styles.writingMode=""===cue.vertical?"horizontal-tb":"lr"===cue.vertical?"vertical-lr":"vertical-rl",styles.unicodeBidi="plaintext"),this.applyStyles(styles,this.cueDiv),this.div=window.document.createElement("div"),styles={textAlign:"middle"===cue.align?"center":cue.align,font:styleOptions.font,whiteSpace:"pre-line",position:"absolute"},isIE8||(styles.direction=(function(cueDiv){var nodeStack=[],text="";if(!cueDiv||!cueDiv.childNodes)return"ltr";function pushNodes(nodeStack,node){for(var i=node.childNodes.length-1;i>=0;i--)nodeStack.push(node.childNodes[i])}function nextTextNode(nodeStack){if(!nodeStack||!nodeStack.length)return null;var node=nodeStack.pop(),text=node.textContent||node.innerText;if(text){var m=text.match(/^.*(\n|\r)/);return m?(nodeStack.length=0,m[0]):text}return"ruby"===node.tagName?nextTextNode(nodeStack):node.childNodes?(pushNodes(nodeStack,node),nextTextNode(nodeStack)):void 0}for(pushNodes(nodeStack,cueDiv);text=nextTextNode(nodeStack);)for(var i=0;i<text.length;i++)if(isStrongRTLChar(text.charCodeAt(i)))return"rtl";return"ltr"})(this.cueDiv),styles.writingMode=""===cue.vertical?"horizontal-tb":"lr"===cue.vertical?"vertical-lr":"vertical-rl".stylesunicodeBidi="plaintext"),this.applyStyles(styles),this.div.appendChild(this.cueDiv);var textPos=0;switch(cue.positionAlign){case"start":textPos=cue.position;break;case"middle":textPos=cue.position-cue.size/2;break;case"end":textPos=cue.position-cue.size}""===cue.vertical?this.applyStyles({left:this.formatStyle(textPos,"%"),width:this.formatStyle(cue.size,"%")}):this.applyStyles({top:this.formatStyle(textPos,"%"),height:this.formatStyle(cue.size,"%")}),this.move=function(box){this.applyStyles({top:this.formatStyle(box.top,"px"),bottom:this.formatStyle(box.bottom,"px"),left:this.formatStyle(box.left,"px"),right:this.formatStyle(box.right,"px"),height:this.formatStyle(box.height,"px"),width:this.formatStyle(box.width,"px")})}}function BoxPosition(obj){var lh,height,width,top,isIE8="undefined"!=typeof navigator&&/MSIE\s8\.0/.test(navigator.userAgent);if(obj.div){height=obj.div.offsetHeight,width=obj.div.offsetWidth,top=obj.div.offsetTop;var rects=(rects=obj.div.childNodes)&&(rects=rects[0])&&rects.getClientRects&&rects.getClientRects();obj=obj.div.getBoundingClientRect(),lh=rects?Math.max(rects[0]&&rects[0].height||0,obj.height/rects.length):0}this.left=obj.left,this.right=obj.right,this.top=obj.top||top,this.height=obj.height||height,this.bottom=obj.bottom||top+(obj.height||height),this.width=obj.width||width,this.lineHeight=void 0!==lh?lh:obj.lineHeight,isIE8&&!this.lineHeight&&(this.lineHeight=13)}function moveBoxToLinePosition(window,styleBox,containerBox,boxPositions){var boxPosition=new BoxPosition(styleBox),cue=styleBox.cue,linePos=(function(cue){if("number"==typeof cue.line&&(cue.snapToLines||cue.line>=0&&cue.line<=100))return cue.line;if(!cue.track||!cue.track.textTrackList||!cue.track.textTrackList.mediaElement)return-1;for(var track=cue.track,trackList=track.textTrackList,count=0,i=0;i<trackList.length&&trackList[i]!==track;i++)"showing"===trackList[i].mode&&count++;return-1*++count})(cue),axis=[];if(cue.snapToLines){var size;switch(cue.vertical){case"":axis=["+y","-y"],size="height";break;case"rl":axis=["+x","-x"],size="width";break;case"lr":axis=["-x","+x"],size="width"}var step=boxPosition.lineHeight,position=step*Math.round(linePos),maxPosition=containerBox[size]+step,initialAxis=axis[0];Math.abs(position)>maxPosition&&(position=position<0?-1:1,position*=Math.ceil(maxPosition/step)*step),linePos<0&&(position+=""===cue.vertical?containerBox.height:containerBox.width,axis=axis.reverse()),boxPosition.move(initialAxis,position)}else{var calculatedPercentage=boxPosition.lineHeight/containerBox.height*100;switch(cue.lineAlign){case"middle":linePos-=calculatedPercentage/2;break;case"end":linePos-=calculatedPercentage}switch(cue.vertical){case"":styleBox.applyStyles({top:styleBox.formatStyle(linePos,"%")});break;case"rl":styleBox.applyStyles({left:styleBox.formatStyle(linePos,"%")});break;case"lr":styleBox.applyStyles({right:styleBox.formatStyle(linePos,"%")})}axis=["+y","-x","+x","-y"],boxPosition=new BoxPosition(styleBox)}var bestPosition=(function(b,axis){for(var bestPosition,specifiedPosition=new BoxPosition(b),percentage=1,i=0;i<axis.length;i++){for(;b.overlapsOppositeAxis(containerBox,axis[i])||b.within(containerBox)&&b.overlapsAny(boxPositions);)b.move(axis[i]);if(b.within(containerBox))return b;var p=b.intersectPercentage(containerBox);percentage>p&&(bestPosition=new BoxPosition(b),percentage=p),b=new BoxPosition(specifiedPosition)}return bestPosition||specifiedPosition})(boxPosition,axis);styleBox.move(bestPosition.toCSSCompatValues(containerBox))}function WebVTT(){}StyleBox.prototype.applyStyles=function(styles,div){for(var prop in div=div||this.div,styles)styles.hasOwnProperty(prop)&&(div.style[prop]=styles[prop])},StyleBox.prototype.formatStyle=function(val,unit){return 0===val?0:val+unit},CueStyleBox.prototype=_objCreate(StyleBox.prototype),CueStyleBox.prototype.constructor=CueStyleBox,BoxPosition.prototype.move=function(axis,toMove){switch(toMove=void 0!==toMove?toMove:this.lineHeight,axis){case"+x":this.left+=toMove,this.right+=toMove;break;case"-x":this.left-=toMove,this.right-=toMove;break;case"+y":this.top+=toMove,this.bottom+=toMove;break;case"-y":this.top-=toMove,this.bottom-=toMove}},BoxPosition.prototype.overlaps=function(b2){return this.left<b2.right&&this.right>b2.left&&this.top<b2.bottom&&this.bottom>b2.top},BoxPosition.prototype.overlapsAny=function(boxes){for(var i=0;i<boxes.length;i++)if(this.overlaps(boxes[i]))return!0;return!1},BoxPosition.prototype.within=function(container){return this.top>=container.top&&this.bottom<=container.bottom&&this.left>=container.left&&this.right<=container.right},BoxPosition.prototype.overlapsOppositeAxis=function(container,axis){switch(axis){case"+x":return this.left<container.left;case"-x":return this.right>container.right;case"+y":return this.top<container.top;case"-y":return this.bottom>container.bottom}},BoxPosition.prototype.intersectPercentage=function(b2){return Math.max(0,Math.min(this.right,b2.right)-Math.max(this.left,b2.left))*Math.max(0,Math.min(this.bottom,b2.bottom)-Math.max(this.top,b2.top))/(this.height*this.width)},BoxPosition.prototype.toCSSCompatValues=function(reference){return{top:this.top-reference.top,bottom:reference.bottom-this.bottom,left:this.left-reference.left,right:reference.right-this.right,height:this.height,width:this.width}},BoxPosition.getSimpleBoxPosition=function(obj){var height=obj.div?obj.div.offsetHeight:obj.tagName?obj.offsetHeight:0,width=obj.div?obj.div.offsetWidth:obj.tagName?obj.offsetWidth:0,top=obj.div?obj.div.offsetTop:obj.tagName?obj.offsetTop:0;return{left:(obj=obj.div?obj.div.getBoundingClientRect():obj.tagName?obj.getBoundingClientRect():obj).left,right:obj.right,top:obj.top||top,height:obj.height||height,bottom:obj.bottom||top+(obj.height||height),width:obj.width||width}},WebVTT.StringDecoder=function(){return{decode:function(data){if(!data)return"";if("string"!=typeof data)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(data))}}},WebVTT.convertCueToDOMTree=function(window,cuetext){return window&&cuetext?parseContent(window,cuetext):null};WebVTT.processCues=function(window,cues,overlay){if(!window||!cues||!overlay)return null;for(;overlay.firstChild;)overlay.removeChild(overlay.firstChild);var paddedOverlay=window.document.createElement("div");if(paddedOverlay.style.position="absolute",paddedOverlay.style.left="0",paddedOverlay.style.right="0",paddedOverlay.style.top="0",paddedOverlay.style.bottom="0",paddedOverlay.style.margin="1.5%",overlay.appendChild(paddedOverlay),(function(cues){for(var i=0;i<cues.length;i++)if(cues[i].hasBeenReset||!cues[i].displayState)return!0;return!1})(cues)){var boxPositions=[],containerBox=BoxPosition.getSimpleBoxPosition(paddedOverlay),styleOptions={font:Math.round(.05*containerBox.height*100)/100*fontScale+"px sans-serif"};!(function(){for(var styleBox,cue,i=0;i<cues.length;i++)cue=cues[i],styleBox=new CueStyleBox(window,cue,styleOptions),paddedOverlay.appendChild(styleBox.div),moveBoxToLinePosition(0,styleBox,containerBox,boxPositions),cue.displayState=styleBox.div,boxPositions.push(BoxPosition.getSimpleBoxPosition(styleBox))})()}else for(var i=0;i<cues.length;i++)paddedOverlay.appendChild(cues[i].displayState)},WebVTT.Parser=function(window,decoder,VTTCue){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=decoder||new TextDecoder("utf8"),this.regionList=[],this.VTTCue=VTTCue},WebVTT.Parser.prototype={reportOrThrowError:function(e){if(!(e instanceof ParsingError))throw e;this.onparsingerror&&this.onparsingerror(e)},parse:function(data){var line,e,self=this;function collectNextLine(){for(var buffer=self.buffer,pos=0;pos<buffer.length&&"\r"!==buffer[pos]&&"\n"!==buffer[pos];)++pos;var line=buffer.substr(0,pos);return"\r"===buffer[pos]&&++pos,"\n"===buffer[pos]&&++pos,self.buffer=buffer.substr(pos),line}function parseHeader(input){input.match(/X-TIMESTAMP-MAP/)?parseOptions(input,(function(k,v){switch(k){case"X-TIMESTAMP-MAP":!(function(input){var settings=new Settings;parseOptions(input,(function(k,v){switch(k){case"MPEGT":settings.integer(k+"S",v);break;case"LOCA":settings.set(k+"L",parseTimeStamp(v))}}),/[^\d]:/,/,/),self.ontimestampmap&&self.ontimestampmap({MPEGTS:settings.get("MPEGTS"),LOCAL:settings.get("LOCAL")})})(v)}}),/=/):parseOptions(input,(function(k,v){switch(k){case"Region":!(function(input){var settings=new Settings;if(parseOptions(input,(function(k,v){switch(k){case"id":settings.set(k,v);break;case"width":settings.percent(k,v);break;case"lines":settings.integer(k,v);break;case"regionanchor":case"viewportanchor":var xy=v.split(",");if(2!==xy.length)break;var anchor=new Settings;if(anchor.percent("x",xy[0]),anchor.percent("y",xy[1]),!anchor.has("x")||!anchor.has("y"))break;settings.set(k+"X",anchor.get("x")),settings.set(k+"Y",anchor.get("y"));break;case"scroll":settings.alt(k,v,["up"])}}),/=/,/\s/),settings.has("id")){var region=new self.window.VTTRegion;region.width=settings.get("width",100),region.lines=settings.get("lines",3),region.regionAnchorX=settings.get("regionanchorX",0),region.regionAnchorY=settings.get("regionanchorY",100),region.viewportAnchorX=settings.get("viewportanchorX",0),region.viewportAnchorY=settings.get("viewportanchorY",100),region.scroll=settings.get("scroll",""),self.onregion&&self.onregion(region),self.regionList.push({id:settings.get("id"),region:region})}})(v)}}),/:/)}if(data&&(self.buffer+=self.decoder.decode(data,{stream:!0})),"INITIAL"===self.state){if(!/\r\n|\n/.test(self.buffer))return this;var m=(line=collectNextLine()).match(/^WEBVTT([ \t].*)?$/);if(!m||!m[0])return e=new ParsingError(ParsingError.Errors.BadSignature),self.reportOrThrowError(e),"CUETEXT"===self.state&&self.cue&&self.oncue&&self.oncue(self.cue),self.cue=null,void(self.state="INITIAL"===self.state?"BADWEBVTT":"BADCUE");self.state="HEADER"}var alreadyCollectedLine=!1,count=0;var fn,linebyline=(fn=function(){if(self.buffer&&/\r\n|\n/.test(self.buffer))switch(alreadyCollectedLine?alreadyCollectedLine=!1:line=collectNextLine(),self.state){case"HEADER":/:/.test(line)?parseHeader(line):line||(self.state="ID"),linebyline();break;case"NOTE":line||(self.state="ID"),linebyline();break;case"ID":if(/^NOTE($|[ \t])/.test(line)){self.state="NOTE",linebyline();break}if(!line){linebyline();break}if(self.cue=new(self.VTTCue||self.window.VTTCue)(0,0,""),self.state="CUE",-1===line.indexOf("--\x3e")){self.cue.id=line,linebyline();break}case"CUE":!(function(input,cue,regionList,successCb,errCb){var timestamp,oInput=input;function consumeTimeStamp(){var ts=parseTimeStamp(input);if(null!==ts||!errCb)return input=input.replace(/^[^\sa-zA-Z-]+/,""),ts;errCb(new ParsingError(ParsingError.Errors.BadTimeStamp,"Malformed timestamp: "+oInput))}function skipWhitespace(){input=input.replace(/^\s+/,"")}skipWhitespace(),void 0!==(timestamp=consumeTimeStamp())&&(cue.startTime=timestamp,skipWhitespace(),"--\x3e"===input.substr(0,3)?(input=input.substr(3),skipWhitespace(),void 0!==(timestamp=consumeTimeStamp())&&(cue.endTime=timestamp,skipWhitespace(),(function(input,cue){var settings=new Settings;parseOptions(input,(function(k,v){switch(k){case"region":for(var i=regionList.length-1;i>=0;i--)if(regionList[i].id===v){settings.set(k,regionList[i].region);break}break;case"vertical":settings.alt(k,v,["rl","lr"]);break;case"line":var vals=v.split(","),vals0=vals[0];settings.integer(k,vals0),settings.percent(k,vals0)&&settings.set("snapToLines",!1),settings.alt(k,vals0,["auto"]),2===vals.length&&settings.alt("lineAlign",vals[1],["start","middle","end"]);break;case"position":vals=v.split(","),settings.percent(k,vals[0]),2===vals.length&&settings.alt("positionAlign",vals[1],["start","middle","end"]);break;case"size":settings.percent(k,v);break;case"align":settings.alt(k,v,["start","middle","end","left","right"])}}),/:/,/\s/),cue.region=settings.get("region",null),cue.vertical=settings.get("vertical",""),cue.line=settings.get("line","auto"),cue.lineAlign=settings.get("lineAlign","start"),cue.snapToLines=settings.get("snapToLines",!0),cue.size=settings.get("size",100),cue.align=settings.get("align","center"),cue.position=settings.get("position","auto"),cue.positionAlign=settings.get("positionAlign",{start:"start",left:"start",middle:"middle",end:"end",right:"end",center:"center"},cue.align),successCb()})(input,cue))):errCb(new ParsingError(ParsingError.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '--\x3e'): "+oInput)))})(line,self.cue,self.regionList,(function(){self.state="CUETEXT",linebyline()}),(function(err){self.reportOrThrowError(err),self.cue=null,self.state="BADCUE",linebyline()}));break;case"CUETEXT":var hasSubstring=-1!==line.indexOf("--\x3e");if(!line||hasSubstring&&(alreadyCollectedLine=!0)){self.oncue&&self.oncue(self.cue),self.cue=null,self.state="ID",linebyline();break}self.cue.text&&(self.cue.text+="\n"),self.cue.text+=line,linebyline();break;case"BADCUE":line||(self.state="ID"),linebyline()}else self.flush()},function(){if(++count<1e3)return fn();setTimeout((function(){count=0,fn()}))});return linebyline(),this},flush:function(){try{if(this.buffer+=this.decoder.decode(),(this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state)throw new ParsingError(ParsingError.Errors.BadSignature)}catch(e){this.reportOrThrowError(e)}return this.onflush&&this.onflush(),this}},global.WebVTT=WebVTT})(this)},6427:function(module,__unused_webpack_exports,__webpack_require__){var root;module.exports&&(this.VTTCue=this.VTTCue||__webpack_require__(113).VTTCue),(root=this).VTTCue.prototype.toJSON=function(){var cue={},self=this;return Object.keys(this).forEach((function(key){"getCueAsHTML"!==key&&"hasBeenReset"!==key&&"displayState"!==key&&(cue[key]=self[key])})),cue},root.VTTCue.create=function(options){if(!options.hasOwnProperty("startTime")||!options.hasOwnProperty("endTime")||!options.hasOwnProperty("text"))throw new Error("You must at least have start time, end time, and text.");var cue=new root.VTTCue(options.startTime,options.endTime,options.text);for(var key in options)cue.hasOwnProperty(key)&&(cue[key]=options[key]);return cue},root.VTTCue.fromJSON=function(json){return this.create(JSON.parse(json))}},113:function(){!(function(root){var directionSetting={"":!0,lr:!0,rl:!0},alignSetting={start:!0,middle:!0,end:!0,left:!0,right:!0};function findAlignSetting(value){return"string"==typeof value&&(!!alignSetting[value.toLowerCase()]&&value.toLowerCase())}function extend(obj){for(var i=1;i<arguments.length;i++){var cobj=arguments[i];for(var p in cobj)obj[p]=cobj[p]}return obj}function VTTCue(startTime,endTime,text){var cue=this,isIE8=/MSIE\s8\.0/.test(navigator.userAgent),baseObj={};isIE8?cue=document.createElement("custom"):baseObj.enumerable=!0,cue.hasBeenReset=!1;var _id="",_pauseOnExit=!1,_startTime=startTime,_endTime=endTime,_text=text,_region=null,_vertical="",_snapToLines=!0,_line="auto",_lineAlign="start",_position=50,_positionAlign="middle",_size=50,_align="middle";if(Object.defineProperty(cue,"id",extend({},baseObj,{get:function(){return _id},set:function(value){_id=""+value}})),Object.defineProperty(cue,"pauseOnExit",extend({},baseObj,{get:function(){return _pauseOnExit},set:function(value){_pauseOnExit=!!value}})),Object.defineProperty(cue,"startTime",extend({},baseObj,{get:function(){return _startTime},set:function(value){if("number"!=typeof value)throw new TypeError("Start time must be set to a number.");_startTime=value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"endTime",extend({},baseObj,{get:function(){return _endTime},set:function(value){if("number"!=typeof value)throw new TypeError("End time must be set to a number.");_endTime=value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"text",extend({},baseObj,{get:function(){return _text},set:function(value){_text=""+value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"region",extend({},baseObj,{get:function(){return _region},set:function(value){_region=value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"vertical",extend({},baseObj,{get:function(){return _vertical},set:function(value){var setting=(function(value){return"string"==typeof value&&!!directionSetting[value.toLowerCase()]&&value.toLowerCase()})(value);if(!1===setting)throw new SyntaxError("An invalid or illegal string was specified.");_vertical=setting,this.hasBeenReset=!0}})),Object.defineProperty(cue,"snapToLines",extend({},baseObj,{get:function(){return _snapToLines},set:function(value){_snapToLines=!!value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"line",extend({},baseObj,{get:function(){return _line},set:function(value){if("number"!=typeof value&&"auto"!==value)throw new SyntaxError("An invalid number or illegal string was specified.");_line=value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"lineAlign",extend({},baseObj,{get:function(){return _lineAlign},set:function(value){var setting=findAlignSetting(value);if(!setting)throw new SyntaxError("An invalid or illegal string was specified.");_lineAlign=setting,this.hasBeenReset=!0}})),Object.defineProperty(cue,"position",extend({},baseObj,{get:function(){return _position},set:function(value){if(value<0||value>100)throw new Error("Position must be between 0 and 100.");_position=value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"positionAlign",extend({},baseObj,{get:function(){return _positionAlign},set:function(value){var setting=findAlignSetting(value);if(!setting)throw new SyntaxError("An invalid or illegal string was specified.");_positionAlign=setting,this.hasBeenReset=!0}})),Object.defineProperty(cue,"size",extend({},baseObj,{get:function(){return _size},set:function(value){if(value<0||value>100)throw new Error("Size must be between 0 and 100.");_size=value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"align",extend({},baseObj,{get:function(){return _align},set:function(value){var setting=findAlignSetting(value);if(!setting)throw new SyntaxError("An invalid or illegal string was specified.");_align=setting,this.hasBeenReset=!0}})),cue.displayState=void 0,isIE8)return cue}VTTCue.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)},root.VTTCue=root.VTTCue||VTTCue})(this)},7224:function(module,__unused_webpack_exports,__webpack_require__){var root;module.exports&&(this.VTTRegion=__webpack_require__(2285).VTTRegion),(root=this).VTTRegion.create=function(options){var region=new root.VTTRegion;for(var key in options)region.hasOwnProperty(key)&&(region[key]=options[key]);return region},root.VTTRegion.fromJSON=function(json){return this.create(JSON.parse(json))}},2285:function(){!(function(root){var scrollSetting={"":!0,up:!0};function isValidPercentValue(value){return"number"==typeof value&&value>=0&&value<=100}root.VTTRegion=root.VTTRegion||function(){var _width=100,_lines=3,_regionAnchorX=0,_regionAnchorY=100,_viewportAnchorX=0,_viewportAnchorY=100,_scroll="";Object.defineProperties(this,{width:{enumerable:!0,get:function(){return _width},set:function(value){if(!isValidPercentValue(value))throw new Error("Width must be between 0 and 100.");_width=value}},lines:{enumerable:!0,get:function(){return _lines},set:function(value){if("number"!=typeof value)throw new TypeError("Lines must be set to a number.");_lines=value}},regionAnchorY:{enumerable:!0,get:function(){return _regionAnchorY},set:function(value){if(!isValidPercentValue(value))throw new Error("RegionAnchorX must be between 0 and 100.");_regionAnchorY=value}},regionAnchorX:{enumerable:!0,get:function(){return _regionAnchorX},set:function(value){if(!isValidPercentValue(value))throw new Error("RegionAnchorY must be between 0 and 100.");_regionAnchorX=value}},viewportAnchorY:{enumerable:!0,get:function(){return _viewportAnchorY},set:function(value){if(!isValidPercentValue(value))throw new Error("ViewportAnchorY must be between 0 and 100.");_viewportAnchorY=value}},viewportAnchorX:{enumerable:!0,get:function(){return _viewportAnchorX},set:function(value){if(!isValidPercentValue(value))throw new Error("ViewportAnchorX must be between 0 and 100.");_viewportAnchorX=value}},scroll:{enumerable:!0,get:function(){return _scroll},set:function(value){var setting=(function(value){return"string"==typeof value&&!!scrollSetting[value.toLowerCase()]&&value.toLowerCase()})(value);if(!1===setting)throw new SyntaxError("An invalid or illegal string was specified.");_scroll=setting}}})}})(this)},5313:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";module.exports=__webpack_require__.p+"197e9b51bc2de199315ae71bb7ed9f07ba86afc0/images/stremio_symbol.png"}},__webpack_module_cache__={};function __webpack_require__(moduleId){var cachedModule=__webpack_module_cache__[moduleId];if(void 0!==cachedModule)return cachedModule.exports;var module=__webpack_module_cache__[moduleId]={id:moduleId,loaded:!1,exports:{}};return __webpack_modules__[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.loaded=!0,module.exports}__webpack_require__.g=(function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}})(),__webpack_require__.nmd=module=>(module.paths=[],module.children||(module.children=[]),module),(()=>{var scriptUrl;__webpack_require__.g.importScripts&&(scriptUrl=__webpack_require__.g.location+"");var document=__webpack_require__.g.document;if(!scriptUrl&&document&&(document.currentScript&&(scriptUrl=document.currentScript.src),!scriptUrl)){var scripts=document.getElementsByTagName("script");scripts.length&&(scriptUrl=scripts[scripts.length-1].src)}if(!scriptUrl)throw new Error("Automatic publicPath is not supported in this browser");scriptUrl=scriptUrl.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),__webpack_require__.p=scriptUrl+"../../"})(),React=__webpack_require__(7294),ReactDOM=__webpack_require__(3935),App=__webpack_require__(4008),ReactDOM.render(React.createElement(App,null),document.getElementById("app"))})();
//# sourceMappingURL=main.js.map