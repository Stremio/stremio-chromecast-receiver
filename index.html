<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stremio Chromecast Receiver</title>
    <link href="//fonts.googleapis.com/css?family=Roboto" rel="stylesheet" type="text/css">
    <script src="//www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js"></script>
    <style>
        *{-webkit-appearance:none;-moz-appearance:none;appearance:none;background:none;border:none;box-shadow:none;box-sizing:border-box;font-family:inherit;font-size:1rem;line-height:1.2em;list-style:none;margin:0;outline:none;overflow:hidden;padding:0;text-decoration:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;word-break:break-word}html{font-family:Roboto,"sans-serif"}body,html{height:100%;width:100%}#app,.app-container{height:100%;position:relative;width:100%;z-index:0}.app-container{background-color:black}.app-container .layer{bottom:0;left:0;position:absolute;right:0;top:0;z-index:0}.app-container .layer.video-layer .video{height:100%;width:100%}.app-container .layer.video-layer .video *{font-size:inherit}.app-container .layer.info-layer{align-items:center;color:white;display:flex;flex-direction:row;justify-content:center;text-align:center}

    </style>
</head>

<body>
    <div id="app"></div>
    <script type="text/javascript">
        !(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}__webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{enumerable:!0,get:getter})},__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.t=function(value,mode){if(1&mode&&(value=__webpack_require__(value)),8&mode)return value;if(4&mode&&"object"==typeof value&&value&&value.__esModule)return value;var ns=Object.create(null);if(__webpack_require__.r(ns),Object.defineProperty(ns,"default",{enumerable:!0,value}),2&mode&&"string"!=typeof value)for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=13)})([function(module,exports){module.exports={CAST_VIDEO:{INVALID_MESSAGE_RECEIVED:{code:100,message:"Invalid message received"},MESSAGE_SEND_FAILED:{code:101,message:"Failed to send message"}},YOUTUBE_VIDEO:{API_LOAD_FAILED:{code:90,message:"YouTube player iframe API failed to load"},INVALID_PARAMETER:{code:91,message:"The request contains an invalid parameter value"},HTML5_VIDEO:{code:92,message:"The requested content cannot be played in an HTML5 player"},VIDEO_NOT_FOUND:{code:93,message:"The video requested was not found"},VIDEO_NOT_EMBEDDABLE:{code:94,message:"The owner of the requested video does not allow it to be played in embedded players"}},HTML_VIDEO:{MEDIA_ERR_ABORTED:{code:80,message:"Fetching process aborted"},MEDIA_ERR_NETWORK:{code:81,message:"Error occurred when downloading"},MEDIA_ERR_DECODE:{code:82,message:"Error occurred when decoding"},MEDIA_ERR_SRC_NOT_SUPPORTED:{code:83,message:"Video is not supported"}},WITH_HTML_SUBTITLES:{FETCH_FAILED:{code:70,message:"Failed to fetch subtitles"},PARSE_FAILED:{code:71,message:"Failed to parse subtitles"}},WITH_STREAMING_SERVER:{STREAM_CONVERT_FAILED:{code:60,message:"Unable to convert stream to url"},TRANSCODING_FAILED:{code:61,message:"Unable to transcode the next segment of the stream"},TRANSCODER_CREATE_FAILED:{code:62,message:"Failed to create transcoder"},TORRENT_CREATE_FAILED:{code:63,message:"Failed to create torrent"},NO_MEDIA_FILES_FOUND:{code:64,message:"No media files found into the torrent"}},UNKNOWN_ERROR:{code:1,message:"Unknown error"},UNSUPPORTED_STREAM:{code:2,message:"Stream is not supported"}}},function(module,exports,__webpack_require__){"use strict";var ReflectOwnKeys,R="object"==typeof Reflect?Reflect:null,ReflectApply=R&&"function"==typeof R.apply?R.apply:function(target,receiver,args){return Function.prototype.apply.call(target,receiver,args)};ReflectOwnKeys=R&&"function"==typeof R.ownKeys?R.ownKeys:Object.getOwnPropertySymbols?function(target){return Object.getOwnPropertyNames(target).concat(Object.getOwnPropertySymbols(target))}:function(target){return Object.getOwnPropertyNames(target)};var NumberIsNaN=Number.isNaN||function(value){return value!=value};function EventEmitter(){EventEmitter.init.call(this)}module.exports=EventEmitter,module.exports.once=function(emitter,name){return new Promise((function(resolve,reject){function eventListener(){void 0!==errorListener&&emitter.removeListener("error",errorListener),resolve([].slice.call(arguments))}var errorListener;"error"!==name&&(errorListener=function(err){emitter.removeListener(name,eventListener),reject(err)},emitter.once("error",errorListener)),emitter.once(name,eventListener)}))},EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._eventsCount=0,EventEmitter.prototype._maxListeners=void 0;var defaultMaxListeners=10;function checkListener(listener){if("function"!=typeof listener)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof listener)}function _getMaxListeners(that){return void 0===that._maxListeners?EventEmitter.defaultMaxListeners:that._maxListeners}function _addListener(target,type,listener,prepend){var m,events,existing,warning;if(checkListener(listener),void 0===(events=target._events)?(events=target._events=Object.create(null),target._eventsCount=0):(void 0!==events.newListener&&(target.emit("newListener",type,listener.listener?listener.listener:listener),events=target._events),existing=events[type]),void 0===existing)existing=events[type]=listener,++target._eventsCount;else if("function"==typeof existing?existing=events[type]=prepend?[listener,existing]:[existing,listener]:prepend?existing.unshift(listener):existing.push(listener),(m=_getMaxListeners(target))>0&&existing.length>m&&!existing.warned){existing.warned=!0;var w=new Error("Possible EventEmitter memory leak detected. "+existing.length+" "+String(type)+" listeners added. Use emitter.setMaxListeners() to increase limit");w.name="MaxListenersExceededWarning",w.emitter=target,w.type=type,w.count=existing.length,warning=w,console&&console.warn&&console.warn(warning)}return target}function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(target,type,listener){var state={fired:!1,wrapFn:void 0,target,type,listener},wrapped=onceWrapper.bind(state);return wrapped.listener=listener,state.wrapFn=wrapped,wrapped}function _listeners(target,type,unwrap){var events=target._events;if(void 0===events)return[];var evlistener=events[type];return void 0===evlistener?[]:"function"==typeof evlistener?unwrap?[evlistener.listener||evlistener]:[evlistener]:unwrap?(function(arr){for(var ret=new Array(arr.length),i=0;i<ret.length;++i)ret[i]=arr[i].listener||arr[i];return ret})(evlistener):arrayClone(evlistener,evlistener.length)}function listenerCount(type){var events=this._events;if(void 0!==events){var evlistener=events[type];if("function"==typeof evlistener)return 1;if(void 0!==evlistener)return evlistener.length}return 0}function arrayClone(arr,n){for(var copy=new Array(n),i=0;i<n;++i)copy[i]=arr[i];return copy}Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(arg){if("number"!=typeof arg||arg<0||NumberIsNaN(arg))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+arg+".");defaultMaxListeners=arg}}),EventEmitter.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},EventEmitter.prototype.setMaxListeners=function(n){if("number"!=typeof n||n<0||NumberIsNaN(n))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+n+".");return this._maxListeners=n,this},EventEmitter.prototype.getMaxListeners=function(){return _getMaxListeners(this)},EventEmitter.prototype.emit=function(type){for(var args=[],i=1;i<arguments.length;i++)args.push(arguments[i]);var doError="error"===type,events=this._events;if(void 0!==events)doError=doError&&void 0===events.error;else if(!doError)return!1;if(doError){var er;if(args.length>0&&(er=args[0]),er instanceof Error)throw er;var err=new Error("Unhandled error."+(er?" ("+er.message+")":""));throw err.context=er,err}var handler=events[type];if(void 0===handler)return!1;if("function"==typeof handler)ReflectApply(handler,this,args);else{var len=handler.length,listeners=arrayClone(handler,len);for(i=0;i<len;++i)ReflectApply(listeners[i],this,args)}return!0},EventEmitter.prototype.addListener=function(type,listener){return _addListener(this,type,listener,!1)},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.prependListener=function(type,listener){return _addListener(this,type,listener,!0)},EventEmitter.prototype.once=function(type,listener){return checkListener(listener),this.on(type,_onceWrap(this,type,listener)),this},EventEmitter.prototype.prependOnceListener=function(type,listener){return checkListener(listener),this.prependListener(type,_onceWrap(this,type,listener)),this},EventEmitter.prototype.removeListener=function(type,listener){var list,events,position,i,originalListener;if(checkListener(listener),void 0===(events=this._events))return this;if(void 0===(list=events[type]))return this;if(list===listener||list.listener===listener)0==--this._eventsCount?this._events=Object.create(null):(delete events[type],events.removeListener&&this.emit("removeListener",type,list.listener||listener));else if("function"!=typeof list){for(position=-1,i=list.length-1;i>=0;i--)if(list[i]===listener||list[i].listener===listener){originalListener=list[i].listener,position=i;break}if(position<0)return this;0===position?list.shift():(function(list,index){for(;index+1<list.length;index++)list[index]=list[index+1];list.pop()})(list,position),1===list.length&&(events[type]=list[0]),void 0!==events.removeListener&&this.emit("removeListener",type,originalListener||listener)}return this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.removeAllListeners=function(type){var listeners,events,i;if(void 0===(events=this._events))return this;if(void 0===events.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==events[type]&&(0==--this._eventsCount?this._events=Object.create(null):delete events[type]),this;if(0===arguments.length){var key,keys=Object.keys(events);for(i=0;i<keys.length;++i)"removeListener"!==(key=keys[i])&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(listeners=events[type]))this.removeListener(type,listeners);else if(void 0!==listeners)for(i=listeners.length-1;i>=0;i--)this.removeListener(type,listeners[i]);return this},EventEmitter.prototype.listeners=function(type){return _listeners(this,type,!0)},EventEmitter.prototype.rawListeners=function(type){return _listeners(this,type,!1)},EventEmitter.listenerCount=function(emitter,type){return"function"==typeof emitter.listenerCount?emitter.listenerCount(type):listenerCount.call(emitter,type)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]}},function(module,exports,__webpack_require__){(function(global,module){var argsTag="[object Arguments]",funcTag="[object Function]",genTag="[object GeneratorFunction]",mapTag="[object Map]",setTag="[object Set]",reFlags=/\w*$/,reIsHostCtor=/^\[object .+?Constructor\]$/,reIsUint=/^(?:0|[1-9]\d*)$/,cloneableTags={};cloneableTags[argsTag]=cloneableTags["[object Array]"]=cloneableTags["[object ArrayBuffer]"]=cloneableTags["[object DataView]"]=cloneableTags["[object Boolean]"]=cloneableTags["[object Date]"]=cloneableTags["[object Float32Array]"]=cloneableTags["[object Float64Array]"]=cloneableTags["[object Int8Array]"]=cloneableTags["[object Int16Array]"]=cloneableTags["[object Int32Array]"]=cloneableTags[mapTag]=cloneableTags["[object Number]"]=cloneableTags["[object Object]"]=cloneableTags["[object RegExp]"]=cloneableTags[setTag]=cloneableTags["[object String]"]=cloneableTags["[object Symbol]"]=cloneableTags["[object Uint8Array]"]=cloneableTags["[object Uint8ClampedArray]"]=cloneableTags["[object Uint16Array]"]=cloneableTags["[object Uint32Array]"]=!0,cloneableTags["[object Error]"]=cloneableTags[funcTag]=cloneableTags["[object WeakMap]"]=!1;var freeGlobal="object"==typeof global&&global&&global.Object===Object&&global,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")(),freeExports=exports&&!exports.nodeType&&exports,freeModule=freeExports&&"object"==typeof module&&module&&!module.nodeType&&module,moduleExports=freeModule&&freeModule.exports===freeExports;function addMapEntry(map,pair){return map.set(pair[0],pair[1]),map}function addSetEntry(set,value){return set.add(value),set}function arrayReduce(array,iteratee,accumulator,initAccum){var index=-1,length=array?array.length:0;for(initAccum&&length&&(accumulator=array[++index]);++index<length;)accumulator=iteratee(accumulator,array[index],index,array);return accumulator}function isHostObject(value){var result=!1;if(null!=value&&"function"!=typeof value.toString)try{result=!!(value+"")}catch(e){}return result}function mapToArray(map){var index=-1,result=Array(map.size);return map.forEach((function(value,key){result[++index]=[key,value]})),result}function overArg(func,transform){return function(arg){return func(transform(arg))}}function setToArray(set){var index=-1,result=Array(set.size);return set.forEach((function(value){result[++index]=value})),result}var uid,arrayProto=Array.prototype,funcProto=Function.prototype,objectProto=Object.prototype,coreJsData=root["__core-js_shared__"],maskSrcKey=(uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||""))?"Symbol(src)_1."+uid:"",funcToString=funcProto.toString,hasOwnProperty=objectProto.hasOwnProperty,objectToString=objectProto.toString,reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Buffer=moduleExports?root.Buffer:void 0,Symbol=root.Symbol,Uint8Array=root.Uint8Array,getPrototype=overArg(Object.getPrototypeOf,Object),objectCreate=Object.create,propertyIsEnumerable=objectProto.propertyIsEnumerable,splice=arrayProto.splice,nativeGetSymbols=Object.getOwnPropertySymbols,nativeIsBuffer=Buffer?Buffer.isBuffer:void 0,nativeKeys=overArg(Object.keys,Object),DataView=getNative(root,"DataView"),Map=getNative(root,"Map"),Promise=getNative(root,"Promise"),Set=getNative(root,"Set"),WeakMap=getNative(root,"WeakMap"),nativeCreate=getNative(Object,"create"),dataViewCtorString=toSource(DataView),mapCtorString=toSource(Map),promiseCtorString=toSource(Promise),setCtorString=toSource(Set),weakMapCtorString=toSource(WeakMap),symbolProto=Symbol?Symbol.prototype:void 0,symbolValueOf=symbolProto?symbolProto.valueOf:void 0;function Hash(entries){var index=-1,length=entries?entries.length:0;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function ListCache(entries){var index=-1,length=entries?entries.length:0;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function MapCache(entries){var index=-1,length=entries?entries.length:0;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function Stack(entries){this.__data__=new ListCache(entries)}function arrayLikeKeys(value,inherited){var result=isArray(value)||(function(value){return(function(value){return(function(value){return!!value&&"object"==typeof value})(value)&&isArrayLike(value)})(value)&&hasOwnProperty.call(value,"callee")&&(!propertyIsEnumerable.call(value,"callee")||objectToString.call(value)==argsTag)})(value)?(function(n,iteratee){for(var index=-1,result=Array(n);++index<n;)result[index]=iteratee(index);return result})(value.length,String):[],length=result.length,skipIndexes=!!length;for(var key in value)!inherited&&!hasOwnProperty.call(value,key)||skipIndexes&&("length"==key||isIndex(key,length))||result.push(key);return result}function assignValue(object,key,value){var objValue=object[key];hasOwnProperty.call(object,key)&&eq(objValue,value)&&(void 0!==value||key in object)||(object[key]=value)}function assocIndexOf(array,key){for(var length=array.length;length--;)if(eq(array[length][0],key))return length;return-1}function baseClone(value,isDeep,isFull,customizer,key,object,stack){var result;if(customizer&&(result=object?customizer(value,key,object,stack):customizer(value)),void 0!==result)return result;if(!isObject(value))return value;var isArr=isArray(value);if(isArr){if(result=(function(array){var length=array.length,result=array.constructor(length);length&&"string"==typeof array[0]&&hasOwnProperty.call(array,"index")&&(result.index=array.index,result.input=array.input);return result})(value),!isDeep)return(function(source,array){var index=-1,length=source.length;array||(array=Array(length));for(;++index<length;)array[index]=source[index];return array})(value,result)}else{var tag=getTag(value),isFunc=tag==funcTag||tag==genTag;if(isBuffer(value))return(function(buffer,isDeep){if(isDeep)return buffer.slice();var result=new buffer.constructor(buffer.length);return buffer.copy(result),result})(value,isDeep);if("[object Object]"==tag||tag==argsTag||isFunc&&!object){if(isHostObject(value))return object?value:{};if(result=(function(object){return"function"!=typeof object.constructor||isPrototype(object)?{}:(proto=getPrototype(object),isObject(proto)?objectCreate(proto):{});var proto})(isFunc?{}:value),!isDeep)return(function(source,object){return copyObject(source,getSymbols(source),object)})(value,(function(object,source){return object&&copyObject(source,keys(source),object)})(result,value))}else{if(!cloneableTags[tag])return object?value:{};result=(function(object,tag,cloneFunc,isDeep){var Ctor=object.constructor;switch(tag){case"[object ArrayBuffer]":return cloneArrayBuffer(object);case"[object Boolean]":case"[object Date]":return new Ctor(+object);case"[object DataView]":return(function(dataView,isDeep){var buffer=isDeep?cloneArrayBuffer(dataView.buffer):dataView.buffer;return new dataView.constructor(buffer,dataView.byteOffset,dataView.byteLength)})(object,isDeep);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return(function(typedArray,isDeep){var buffer=isDeep?cloneArrayBuffer(typedArray.buffer):typedArray.buffer;return new typedArray.constructor(buffer,typedArray.byteOffset,typedArray.length)})(object,isDeep);case mapTag:return(function(map,isDeep,cloneFunc){return arrayReduce(isDeep?cloneFunc(mapToArray(map),!0):mapToArray(map),addMapEntry,new map.constructor)})(object,isDeep,cloneFunc);case"[object Number]":case"[object String]":return new Ctor(object);case"[object RegExp]":return(function(regexp){var result=new regexp.constructor(regexp.source,reFlags.exec(regexp));return result.lastIndex=regexp.lastIndex,result})(object);case setTag:return(function(set,isDeep,cloneFunc){return arrayReduce(isDeep?cloneFunc(setToArray(set),!0):setToArray(set),addSetEntry,new set.constructor)})(object,isDeep,cloneFunc);case"[object Symbol]":return symbol=object,symbolValueOf?Object(symbolValueOf.call(symbol)):{}}var symbol})(value,tag,baseClone,isDeep)}}stack||(stack=new Stack);var stacked=stack.get(value);if(stacked)return stacked;if(stack.set(value,result),!isArr)var props=isFull?(function(object){return(function(object,keysFunc,symbolsFunc){var result=keysFunc(object);return isArray(object)?result:(function(array,values){for(var index=-1,length=values.length,offset=array.length;++index<length;)array[offset+index]=values[index];return array})(result,symbolsFunc(object))})(object,keys,getSymbols)})(value):keys(value);return(function(array,iteratee){for(var index=-1,length=array?array.length:0;++index<length&&!1!==iteratee(array[index],index,array););})(props||value,(function(subValue,key){props&&(subValue=value[key=subValue]),assignValue(result,key,baseClone(subValue,isDeep,isFull,customizer,key,value,stack))})),result}function baseIsNative(value){return!(!isObject(value)||(func=value,maskSrcKey&&maskSrcKey in func))&&(isFunction(value)||isHostObject(value)?reIsNative:reIsHostCtor).test(toSource(value));var func}function cloneArrayBuffer(arrayBuffer){var result=new arrayBuffer.constructor(arrayBuffer.byteLength);return new Uint8Array(result).set(new Uint8Array(arrayBuffer)),result}function copyObject(source,props,object,customizer){object||(object={});for(var index=-1,length=props.length;++index<length;){var key=props[index],newValue=customizer?customizer(object[key],source[key],key,object,source):void 0;assignValue(object,key,void 0===newValue?source[key]:newValue)}return object}function getMapData(map,key){var value,type,data=map.__data__;return("string"==(type=typeof(value=key))||"number"==type||"symbol"==type||"boolean"==type?"__proto__"!==value:null===value)?data["string"==typeof key?"string":"hash"]:data.map}function getNative(object,key){var value=(function(object,key){return null==object?void 0:object[key]})(object,key);return baseIsNative(value)?value:void 0}Hash.prototype.clear=function(){this.__data__=nativeCreate?nativeCreate(null):{}},Hash.prototype.delete=function(key){return this.has(key)&&delete this.__data__[key]},Hash.prototype.get=function(key){var data=this.__data__;if(nativeCreate){var result=data[key];return"__lodash_hash_undefined__"===result?void 0:result}return hasOwnProperty.call(data,key)?data[key]:void 0},Hash.prototype.has=function(key){var data=this.__data__;return nativeCreate?void 0!==data[key]:hasOwnProperty.call(data,key)},Hash.prototype.set=function(key,value){return this.__data__[key]=nativeCreate&&void 0===value?"__lodash_hash_undefined__":value,this},ListCache.prototype.clear=function(){this.__data__=[]},ListCache.prototype.delete=function(key){var data=this.__data__,index=assocIndexOf(data,key);return!(index<0)&&(index==data.length-1?data.pop():splice.call(data,index,1),!0)},ListCache.prototype.get=function(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?void 0:data[index][1]},ListCache.prototype.has=function(key){return assocIndexOf(this.__data__,key)>-1},ListCache.prototype.set=function(key,value){var data=this.__data__,index=assocIndexOf(data,key);return index<0?data.push([key,value]):data[index][1]=value,this},MapCache.prototype.clear=function(){this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}},MapCache.prototype.delete=function(key){return getMapData(this,key).delete(key)},MapCache.prototype.get=function(key){return getMapData(this,key).get(key)},MapCache.prototype.has=function(key){return getMapData(this,key).has(key)},MapCache.prototype.set=function(key,value){return getMapData(this,key).set(key,value),this},Stack.prototype.clear=function(){this.__data__=new ListCache},Stack.prototype.delete=function(key){return this.__data__.delete(key)},Stack.prototype.get=function(key){return this.__data__.get(key)},Stack.prototype.has=function(key){return this.__data__.has(key)},Stack.prototype.set=function(key,value){var cache=this.__data__;if(cache instanceof ListCache){var pairs=cache.__data__;if(!Map||pairs.length<199)return pairs.push([key,value]),this;cache=this.__data__=new MapCache(pairs)}return cache.set(key,value),this};var getSymbols=nativeGetSymbols?overArg(nativeGetSymbols,Object):function(){return[]},getTag=function(value){return objectToString.call(value)};function isIndex(value,length){return!!(length=null==length?9007199254740991:length)&&("number"==typeof value||reIsUint.test(value))&&value>-1&&value%1==0&&value<length}function isPrototype(value){var Ctor=value&&value.constructor;return value===("function"==typeof Ctor&&Ctor.prototype||objectProto)}function toSource(func){if(null!=func){try{return funcToString.call(func)}catch(e){}try{return func+""}catch(e){}}return""}function eq(value,other){return value===other||value!=value&&other!=other}(DataView&&"[object DataView]"!=getTag(new DataView(new ArrayBuffer(1)))||Map&&getTag(new Map)!=mapTag||Promise&&"[object Promise]"!=getTag(Promise.resolve())||Set&&getTag(new Set)!=setTag||WeakMap&&"[object WeakMap]"!=getTag(new WeakMap))&&(getTag=function(value){var result=objectToString.call(value),Ctor="[object Object]"==result?value.constructor:void 0,ctorString=Ctor?toSource(Ctor):void 0;if(ctorString)switch(ctorString){case dataViewCtorString:return"[object DataView]";case mapCtorString:return mapTag;case promiseCtorString:return"[object Promise]";case setCtorString:return setTag;case weakMapCtorString:return"[object WeakMap]"}return result});var isArray=Array.isArray;function isArrayLike(value){return null!=value&&(function(value){return"number"==typeof value&&value>-1&&value%1==0&&value<=9007199254740991})(value.length)&&!isFunction(value)}var isBuffer=nativeIsBuffer||function(){return!1};function isFunction(value){var tag=isObject(value)?objectToString.call(value):"";return tag==funcTag||tag==genTag}function isObject(value){var type=typeof value;return!!value&&("object"==type||"function"==type)}function keys(object){return isArrayLike(object)?arrayLikeKeys(object):(function(object){if(!isPrototype(object))return nativeKeys(object);var result=[];for(var key in Object(object))hasOwnProperty.call(object,key)&&"constructor"!=key&&result.push(key);return result})(object)}module.exports=function(value){return baseClone(value,!0,!0)}}).call(this,__webpack_require__(5),__webpack_require__(9)(module))},function(module,exports){module.exports=function deepFreeze(o){return Object.freeze(o),Object.getOwnPropertyNames(o).forEach((function(prop){!o.hasOwnProperty(prop)||null===o[prop]||"object"!=typeof o[prop]&&"function"!=typeof o[prop]||Object.isFrozen(o[prop])||deepFreeze(o[prop])})),o}},function(module,exports,__webpack_require__){"use strict";module.exports=__webpack_require__(14)},function(module,exports){var g;g=(function(){return this})();try{g=g||new Function("return this")()}catch(e){"object"==typeof window&&(g=window)}module.exports=g},function(module,exports,__webpack_require__){"use strict";var punycode=__webpack_require__(42),util=__webpack_require__(43);function Url(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}exports.parse=urlParse,exports.resolve=function(source,relative){return urlParse(source,!1,!0).resolve(relative)},exports.resolveObject=function(source,relative){return source?urlParse(source,!1,!0).resolveObject(relative):relative},exports.format=function(obj){util.isString(obj)&&(obj=urlParse(obj));return obj instanceof Url?obj.format():Url.prototype.format.call(obj)},exports.Url=Url;var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,unwise=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:!0,"javascript:":!0},hostlessProtocol={javascript:!0,"javascript:":!0},slashedProtocol={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},querystring=__webpack_require__(44);function urlParse(url,parseQueryString,slashesDenoteHost){if(url&&util.isObject(url)&&url instanceof Url)return url;var u=new Url;return u.parse(url,parseQueryString,slashesDenoteHost),u}Url.prototype.parse=function(url,parseQueryString,slashesDenoteHost){if(!util.isString(url))throw new TypeError("Parameter 'url' must be a string, not "+typeof url);var queryIndex=url.indexOf("?"),splitter=-1!==queryIndex&&queryIndex<url.indexOf("#")?"?":"#",uSplit=url.split(splitter);uSplit[0]=uSplit[0].replace(/\\/g,"/");var rest=url=uSplit.join(splitter);if(rest=rest.trim(),!slashesDenoteHost&&1===url.split("#").length){var simplePath=simplePathPattern.exec(rest);if(simplePath)return this.path=rest,this.href=rest,this.pathname=simplePath[1],simplePath[2]?(this.search=simplePath[2],this.query=parseQueryString?querystring.parse(this.search.substr(1)):this.search.substr(1)):parseQueryString&&(this.search="",this.query={}),this}var proto=protocolPattern.exec(rest);if(proto){var lowerProto=(proto=proto[0]).toLowerCase();this.protocol=lowerProto,rest=rest.substr(proto.length)}if(slashesDenoteHost||proto||rest.match(/^\/\/[^@\/]+@[^@\/]+/)){var slashes="//"===rest.substr(0,2);!slashes||proto&&hostlessProtocol[proto]||(rest=rest.substr(2),this.slashes=!0)}if(!hostlessProtocol[proto]&&(slashes||proto&&!slashedProtocol[proto])){for(var auth,atSign,hostEnd=-1,i=0;i<hostEndingChars.length;i++){-1!==(hec=rest.indexOf(hostEndingChars[i]))&&(-1===hostEnd||hec<hostEnd)&&(hostEnd=hec)}-1!==(atSign=-1===hostEnd?rest.lastIndexOf("@"):rest.lastIndexOf("@",hostEnd))&&(auth=rest.slice(0,atSign),rest=rest.slice(atSign+1),this.auth=decodeURIComponent(auth)),hostEnd=-1;for(i=0;i<nonHostChars.length;i++){var hec;-1!==(hec=rest.indexOf(nonHostChars[i]))&&(-1===hostEnd||hec<hostEnd)&&(hostEnd=hec)}-1===hostEnd&&(hostEnd=rest.length),this.host=rest.slice(0,hostEnd),rest=rest.slice(hostEnd),this.parseHost(),this.hostname=this.hostname||"";var ipv6Hostname="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!ipv6Hostname)for(var hostparts=this.hostname.split(/\./),l=(i=0,hostparts.length);i<l;i++){var part=hostparts[i];if(part&&!part.match(hostnamePartPattern)){for(var newpart="",j=0,k=part.length;j<k;j++)part.charCodeAt(j)>127?newpart+="x":newpart+=part[j];if(!newpart.match(hostnamePartPattern)){var validParts=hostparts.slice(0,i),notHost=hostparts.slice(i+1),bit=part.match(hostnamePartStart);bit&&(validParts.push(bit[1]),notHost.unshift(bit[2])),notHost.length&&(rest="/"+notHost.join(".")+rest),this.hostname=validParts.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),ipv6Hostname||(this.hostname=punycode.toASCII(this.hostname));var p=this.port?":"+this.port:"",h=this.hostname||"";this.host=h+p,this.href+=this.host,ipv6Hostname&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==rest[0]&&(rest="/"+rest))}if(!unsafeProtocol[lowerProto])for(i=0,l=autoEscape.length;i<l;i++){var ae=autoEscape[i];if(-1!==rest.indexOf(ae)){var esc=encodeURIComponent(ae);esc===ae&&(esc=escape(ae)),rest=rest.split(ae).join(esc)}}var hash=rest.indexOf("#");-1!==hash&&(this.hash=rest.substr(hash),rest=rest.slice(0,hash));var qm=rest.indexOf("?");if(-1!==qm?(this.search=rest.substr(qm),this.query=rest.substr(qm+1),parseQueryString&&(this.query=querystring.parse(this.query)),rest=rest.slice(0,qm)):parseQueryString&&(this.search="",this.query={}),rest&&(this.pathname=rest),slashedProtocol[lowerProto]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){p=this.pathname||"";var s=this.search||"";this.path=p+s}return this.href=this.format(),this},Url.prototype.format=function(){var auth=this.auth||"";auth&&(auth=(auth=encodeURIComponent(auth)).replace(/%3A/i,":"),auth+="@");var protocol=this.protocol||"",pathname=this.pathname||"",hash=this.hash||"",host=!1,query="";this.host?host=auth+this.host:this.hostname&&(host=auth+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(host+=":"+this.port)),this.query&&util.isObject(this.query)&&Object.keys(this.query).length&&(query=querystring.stringify(this.query));var search=this.search||query&&"?"+query||"";return protocol&&":"!==protocol.substr(-1)&&(protocol+=":"),this.slashes||(!protocol||slashedProtocol[protocol])&&!1!==host?(host="//"+(host||""),pathname&&"/"!==pathname.charAt(0)&&(pathname="/"+pathname)):host||(host=""),hash&&"#"!==hash.charAt(0)&&(hash="#"+hash),search&&"?"!==search.charAt(0)&&(search="?"+search),protocol+host+(pathname=pathname.replace(/[?#]/g,(function(match){return encodeURIComponent(match)})))+(search=search.replace("#","%23"))+hash},Url.prototype.resolve=function(relative){return this.resolveObject(urlParse(relative,!1,!0)).format()},Url.prototype.resolveObject=function(relative){if(util.isString(relative)){var rel=new Url;rel.parse(relative,!1,!0),relative=rel}for(var result=new Url,tkeys=Object.keys(this),tk=0;tk<tkeys.length;tk++){var tkey=tkeys[tk];result[tkey]=this[tkey]}if(result.hash=relative.hash,""===relative.href)return result.href=result.format(),result;if(relative.slashes&&!relative.protocol){for(var rkeys=Object.keys(relative),rk=0;rk<rkeys.length;rk++){var rkey=rkeys[rk];"protocol"!==rkey&&(result[rkey]=relative[rkey])}return slashedProtocol[result.protocol]&&result.hostname&&!result.pathname&&(result.path=result.pathname="/"),result.href=result.format(),result}if(relative.protocol&&relative.protocol!==result.protocol){if(!slashedProtocol[relative.protocol]){for(var keys=Object.keys(relative),v=0;v<keys.length;v++){var k=keys[v];result[k]=relative[k]}return result.href=result.format(),result}if(result.protocol=relative.protocol,relative.host||hostlessProtocol[relative.protocol])result.pathname=relative.pathname;else{for(var relPath=(relative.pathname||"").split("/");relPath.length&&!(relative.host=relPath.shift()););relative.host||(relative.host=""),relative.hostname||(relative.hostname=""),""!==relPath[0]&&relPath.unshift(""),relPath.length<2&&relPath.unshift(""),result.pathname=relPath.join("/")}if(result.search=relative.search,result.query=relative.query,result.host=relative.host||"",result.auth=relative.auth,result.hostname=relative.hostname||relative.host,result.port=relative.port,result.pathname||result.search){var p=result.pathname||"",s=result.search||"";result.path=p+s}return result.slashes=result.slashes||relative.slashes,result.href=result.format(),result}var isSourceAbs=result.pathname&&"/"===result.pathname.charAt(0),isRelAbs=relative.host||relative.pathname&&"/"===relative.pathname.charAt(0),mustEndAbs=isRelAbs||isSourceAbs||result.host&&relative.pathname,removeAllDots=mustEndAbs,srcPath=result.pathname&&result.pathname.split("/")||[],psychotic=(relPath=relative.pathname&&relative.pathname.split("/")||[],result.protocol&&!slashedProtocol[result.protocol]);if(psychotic&&(result.hostname="",result.port=null,result.host&&(""===srcPath[0]?srcPath[0]=result.host:srcPath.unshift(result.host)),result.host="",relative.protocol&&(relative.hostname=null,relative.port=null,relative.host&&(""===relPath[0]?relPath[0]=relative.host:relPath.unshift(relative.host)),relative.host=null),mustEndAbs=mustEndAbs&&(""===relPath[0]||""===srcPath[0])),isRelAbs)result.host=relative.host||""===relative.host?relative.host:result.host,result.hostname=relative.hostname||""===relative.hostname?relative.hostname:result.hostname,result.search=relative.search,result.query=relative.query,srcPath=relPath;else if(relPath.length)srcPath||(srcPath=[]),srcPath.pop(),srcPath=srcPath.concat(relPath),result.search=relative.search,result.query=relative.query;else if(!util.isNullOrUndefined(relative.search)){if(psychotic)result.hostname=result.host=srcPath.shift(),(authInHost=!!(result.host&&result.host.indexOf("@")>0)&&result.host.split("@"))&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift());return result.search=relative.search,result.query=relative.query,util.isNull(result.pathname)&&util.isNull(result.search)||(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.href=result.format(),result}if(!srcPath.length)return result.pathname=null,result.search?result.path="/"+result.search:result.path=null,result.href=result.format(),result;for(var last=srcPath.slice(-1)[0],hasTrailingSlash=(result.host||relative.host||srcPath.length>1)&&("."===last||".."===last)||""===last,up=0,i=srcPath.length;i>=0;i--)"."===(last=srcPath[i])?srcPath.splice(i,1):".."===last?(srcPath.splice(i,1),up++):up&&(srcPath.splice(i,1),up--);if(!mustEndAbs&&!removeAllDots)for(;up--;up)srcPath.unshift("..");!mustEndAbs||""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0)||srcPath.unshift(""),hasTrailingSlash&&"/"!==srcPath.join("/").substr(-1)&&srcPath.push("");var authInHost,isAbsolute=""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0);psychotic&&(result.hostname=result.host=isAbsolute?"":srcPath.length?srcPath.shift():"",(authInHost=!!(result.host&&result.host.indexOf("@")>0)&&result.host.split("@"))&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift()));return(mustEndAbs=mustEndAbs||result.host&&srcPath.length)&&!isAbsolute&&srcPath.unshift(""),srcPath.length?result.pathname=srcPath.join("/"):(result.pathname=null,result.path=null),util.isNull(result.pathname)&&util.isNull(result.search)||(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.auth=relative.auth||result.auth,result.slashes=result.slashes||relative.slashes,result.href=result.format(),result},Url.prototype.parseHost=function(){var host=this.host,port=portPattern.exec(host);port&&(":"!==(port=port[0])&&(this.port=port.substr(1)),host=host.substr(0,host.length-port.length)),host&&(this.hostname=host)}},function(module,exports,__webpack_require__){"use strict";var getOwnPropertySymbols=Object.getOwnPropertySymbols,hasOwnProperty=Object.prototype.hasOwnProperty,propIsEnumerable=Object.prototype.propertyIsEnumerable;function toObject(val){if(null==val)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(val)}module.exports=(function(){try{if(!Object.assign)return!1;var test1=new String("abc");if(test1[5]="de","5"===Object.getOwnPropertyNames(test1)[0])return!1;for(var test2={},i=0;i<10;i++)test2["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(test2).map((function(n){return test2[n]})).join(""))return!1;var test3={};return"abcdefghijklmnopqrst".split("").forEach((function(letter){test3[letter]=letter})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},test3)).join("")}catch(err){return!1}})()?Object.assign:function(target,source){for(var from,symbols,to=toObject(target),s=1;s<arguments.length;s++){for(var key in from=Object(arguments[s]))hasOwnProperty.call(from,key)&&(to[key]=from[key]);if(getOwnPropertySymbols){symbols=getOwnPropertySymbols(from);for(var i=0;i<symbols.length;i++)propIsEnumerable.call(from,symbols[i])&&(to[symbols[i]]=from[symbols[i]])}}return to}},function(module,exports,__webpack_require__){var HTMLVideo=__webpack_require__(22),YouTubeVideo=__webpack_require__(25),ChromecastVideo=__webpack_require__(27),withHTMLSubtitles=__webpack_require__(29),withStreamingServer=__webpack_require__(39);module.exports={HTMLVideo,YouTubeVideo,ChromecastVideo,withHTMLSubtitles,withStreamingServer}},function(module,exports){module.exports=function(module){return module.webpackPolyfill||(module.deprecate=function(){},module.paths=[],module.children||(module.children=[]),Object.defineProperty(module,"loaded",{enumerable:!0,get:function(){return module.l}}),Object.defineProperty(module,"id",{enumerable:!0,get:function(){return module.i}}),module.webpackPolyfill=1),module}},function(module,exports,__webpack_require__){module.exports={WebVTT:__webpack_require__(32).WebVTT,VTTCue:__webpack_require__(33).VTTCue,VTTRegion:__webpack_require__(35).VTTRegion}},function(module,exports){module.exports=function(array,value){if(value<array[0]||array[array.length-1]<value)return-1;for(var left=0,right=array.length-1,index=-1;left<=right;){var middle=Math.floor((left+right)/2);array[middle]>value?right=middle-1:(array[middle]<value||(index=middle),left=middle+1)}return-1!==index?index:right}},function(module,exports,__webpack_require__){"use strict";(function(global){var base64=__webpack_require__(48),ieee754=__webpack_require__(49),isArray=__webpack_require__(50);function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(that,length){if(kMaxLength()<length)throw new RangeError("Invalid typed array length");return Buffer.TYPED_ARRAY_SUPPORT?(that=new Uint8Array(length)).__proto__=Buffer.prototype:(null===that&&(that=new Buffer(length)),that.length=length),that}function Buffer(arg,encodingOrOffset,length){if(!(Buffer.TYPED_ARRAY_SUPPORT||this instanceof Buffer))return new Buffer(arg,encodingOrOffset,length);if("number"==typeof arg){if("string"==typeof encodingOrOffset)throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(this,arg)}return from(this,arg,encodingOrOffset,length)}function from(that,value,encodingOrOffset,length){if("number"==typeof value)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&value instanceof ArrayBuffer?(function(that,array,byteOffset,length){if(array.byteLength,byteOffset<0||array.byteLength<byteOffset)throw new RangeError("'offset' is out of bounds");if(array.byteLength<byteOffset+(length||0))throw new RangeError("'length' is out of bounds");array=void 0===byteOffset&&void 0===length?new Uint8Array(array):void 0===length?new Uint8Array(array,byteOffset):new Uint8Array(array,byteOffset,length);Buffer.TYPED_ARRAY_SUPPORT?(that=array).__proto__=Buffer.prototype:that=fromArrayLike(that,array);return that})(that,value,encodingOrOffset,length):"string"==typeof value?(function(that,string,encoding){"string"==typeof encoding&&""!==encoding||(encoding="utf8");if(!Buffer.isEncoding(encoding))throw new TypeError('"encoding" must be a valid string encoding');var length=0|byteLength(string,encoding),actual=(that=createBuffer(that,length)).write(string,encoding);actual!==length&&(that=that.slice(0,actual));return that})(that,value,encodingOrOffset):(function(that,obj){if(Buffer.isBuffer(obj)){var len=0|checked(obj.length);return 0===(that=createBuffer(that,len)).length||obj.copy(that,0,0,len),that}if(obj){if("undefined"!=typeof ArrayBuffer&&obj.buffer instanceof ArrayBuffer||"length"in obj)return"number"!=typeof obj.length||(val=obj.length)!=val?createBuffer(that,0):fromArrayLike(that,obj);if("Buffer"===obj.type&&isArray(obj.data))return fromArrayLike(that,obj.data)}var val;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")})(that,value)}function assertSize(size){if("number"!=typeof size)throw new TypeError('"size" argument must be a number');if(size<0)throw new RangeError('"size" argument must not be negative')}function allocUnsafe(that,size){if(assertSize(size),that=createBuffer(that,size<0?0:0|checked(size)),!Buffer.TYPED_ARRAY_SUPPORT)for(var i=0;i<size;++i)that[i]=0;return that}function fromArrayLike(that,array){var length=array.length<0?0:0|checked(array.length);that=createBuffer(that,length);for(var i=0;i<length;i+=1)that[i]=255&array[i];return that}function checked(length){if(length>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|length}function byteLength(string,encoding){if(Buffer.isBuffer(string))return string.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(string)||string instanceof ArrayBuffer))return string.byteLength;"string"!=typeof string&&(string=""+string);var len=string.length;if(0===len)return 0;for(var loweredCase=!1;;)switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":case void 0:return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*len;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase(),loweredCase=!0}}function slowToString(encoding,start,end){var loweredCase=!1;if((void 0===start||start<0)&&(start=0),start>this.length)return"";if((void 0===end||end>this.length)&&(end=this.length),end<=0)return"";if((end>>>=0)<=(start>>>=0))return"";for(encoding||(encoding="utf8");;)switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase(),loweredCase=!0}}function swap(b,n,m){var i=b[n];b[n]=b[m],b[m]=i}function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(0===buffer.length)return-1;if("string"==typeof byteOffset?(encoding=byteOffset,byteOffset=0):byteOffset>2147483647?byteOffset=2147483647:byteOffset<-2147483648&&(byteOffset=-2147483648),byteOffset=+byteOffset,isNaN(byteOffset)&&(byteOffset=dir?0:buffer.length-1),byteOffset<0&&(byteOffset=buffer.length+byteOffset),byteOffset>=buffer.length){if(dir)return-1;byteOffset=buffer.length-1}else if(byteOffset<0){if(!dir)return-1;byteOffset=0}if("string"==typeof val&&(val=Buffer.from(val,encoding)),Buffer.isBuffer(val))return 0===val.length?-1:arrayIndexOf(buffer,val,byteOffset,encoding,dir);if("number"==typeof val)return val&=255,Buffer.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?dir?Uint8Array.prototype.indexOf.call(buffer,val,byteOffset):Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset):arrayIndexOf(buffer,[val],byteOffset,encoding,dir);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var i,indexSize=1,arrLength=arr.length,valLength=val.length;if(void 0!==encoding&&("ucs2"===(encoding=String(encoding).toLowerCase())||"ucs-2"===encoding||"utf16le"===encoding||"utf-16le"===encoding)){if(arr.length<2||val.length<2)return-1;indexSize=2,arrLength/=2,valLength/=2,byteOffset/=2}function read(buf,i){return 1===indexSize?buf[i]:buf.readUInt16BE(i*indexSize)}if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++)if(read(arr,i)===read(val,-1===foundIndex?0:i-foundIndex)){if(-1===foundIndex&&(foundIndex=i),i-foundIndex+1===valLength)return foundIndex*indexSize}else-1!==foundIndex&&(i-=i-foundIndex),foundIndex=-1}else for(byteOffset+valLength>arrLength&&(byteOffset=arrLength-valLength),i=byteOffset;i>=0;i--){for(var found=!0,j=0;j<valLength;j++)if(read(arr,i+j)!==read(val,j)){found=!1;break}if(found)return i}return-1}function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;length?(length=Number(length))>remaining&&(length=remaining):length=remaining;var strLen=string.length;if(strLen%2!=0)throw new TypeError("Invalid hex string");length>strLen/2&&(length=strLen/2);for(var i=0;i<length;++i){var parsed=parseInt(string.substr(2*i,2),16);if(isNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer((function(str){for(var byteArray=[],i=0;i<str.length;++i)byteArray.push(255&str.charCodeAt(i));return byteArray})(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer((function(str,units){for(var c,hi,lo,byteArray=[],i=0;i<str.length&&!((units-=2)<0);++i)c=str.charCodeAt(i),hi=c>>8,lo=c%256,byteArray.push(lo),byteArray.push(hi);return byteArray})(string,buf.length-offset),buf,offset,length)}function base64Slice(buf,start,end){return 0===start&&end===buf.length?base64.fromByteArray(buf):base64.fromByteArray(buf.slice(start,end))}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);for(var res=[],i=start;i<end;){var secondByte,thirdByte,fourthByte,tempCodePoint,firstByte=buf[i],codePoint=null,bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end)switch(bytesPerSequence){case 1:firstByte<128&&(codePoint=firstByte);break;case 2:128==(192&(secondByte=buf[i+1]))&&(tempCodePoint=(31&firstByte)<<6|63&secondByte)>127&&(codePoint=tempCodePoint);break;case 3:secondByte=buf[i+1],thirdByte=buf[i+2],128==(192&secondByte)&&128==(192&thirdByte)&&(tempCodePoint=(15&firstByte)<<12|(63&secondByte)<<6|63&thirdByte)>2047&&(tempCodePoint<55296||tempCodePoint>57343)&&(codePoint=tempCodePoint);break;case 4:secondByte=buf[i+1],thirdByte=buf[i+2],fourthByte=buf[i+3],128==(192&secondByte)&&128==(192&thirdByte)&&128==(192&fourthByte)&&(tempCodePoint=(15&firstByte)<<18|(63&secondByte)<<12|(63&thirdByte)<<6|63&fourthByte)>65535&&tempCodePoint<1114112&&(codePoint=tempCodePoint)}null===codePoint?(codePoint=65533,bytesPerSequence=1):codePoint>65535&&(codePoint-=65536,res.push(codePoint>>>10&1023|55296),codePoint=56320|1023&codePoint),res.push(codePoint),i+=bytesPerSequence}return(function(codePoints){var len=codePoints.length;if(len<=4096)return String.fromCharCode.apply(String,codePoints);var res="",i=0;for(;i<len;)res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=4096));return res})(res)}exports.Buffer=Buffer,exports.SlowBuffer=function(length){+length!=length&&(length=0);return Buffer.alloc(+length)},exports.INSPECT_MAX_BYTES=50,Buffer.TYPED_ARRAY_SUPPORT=void 0!==global.TYPED_ARRAY_SUPPORT?global.TYPED_ARRAY_SUPPORT:(function(){try{var arr=new Uint8Array(1);return arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===arr.foo()&&"function"==typeof arr.subarray&&0===arr.subarray(1,1).byteLength}catch(e){return!1}})(),exports.kMaxLength=kMaxLength(),Buffer.poolSize=8192,Buffer._augment=function(arr){return arr.__proto__=Buffer.prototype,arr},Buffer.from=function(value,encodingOrOffset,length){return from(null,value,encodingOrOffset,length)},Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0})),Buffer.alloc=function(size,fill,encoding){return(function(that,size,fill,encoding){return assertSize(size),size<=0?createBuffer(that,size):void 0!==fill?"string"==typeof encoding?createBuffer(that,size).fill(fill,encoding):createBuffer(that,size).fill(fill):createBuffer(that,size)})(null,size,fill,encoding)},Buffer.allocUnsafe=function(size){return allocUnsafe(null,size)},Buffer.allocUnsafeSlow=function(size){return allocUnsafe(null,size)},Buffer.isBuffer=function(b){return!(null==b||!b._isBuffer)},Buffer.compare=function(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError("Arguments must be Buffers");if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);i<len;++i)if(a[i]!==b[i]){x=a[i],y=b[i];break}return x<y?-1:y<x?1:0},Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(list,length){if(!isArray(list))throw new TypeError('"list" argument must be an Array of Buffers');if(0===list.length)return Buffer.alloc(0);var i;if(void 0===length)for(length=0,i=0;i<list.length;++i)length+=list[i].length;var buffer=Buffer.allocUnsafe(length),pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(!Buffer.isBuffer(buf))throw new TypeError('"list" argument must be an Array of Buffers');buf.copy(buffer,pos),pos+=buf.length}return buffer},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var len=this.length;if(len%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var i=0;i<len;i+=2)swap(this,i,i+1);return this},Buffer.prototype.swap32=function(){var len=this.length;if(len%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var i=0;i<len;i+=4)swap(this,i,i+3),swap(this,i+1,i+2);return this},Buffer.prototype.swap64=function(){var len=this.length;if(len%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var i=0;i<len;i+=8)swap(this,i,i+7),swap(this,i+1,i+6),swap(this,i+2,i+5),swap(this,i+3,i+4);return this},Buffer.prototype.toString=function(){var length=0|this.length;return 0===length?"":0===arguments.length?utf8Slice(this,0,length):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b||0===Buffer.compare(this,b)},Buffer.prototype.inspect=function(){var str="",max=exports.INSPECT_MAX_BYTES;return this.length>0&&(str=this.toString("hex",0,max).match(/.{2}/g).join(" "),this.length>max&&(str+=" ... ")),"<Buffer "+str+">"},Buffer.prototype.compare=function(target,start,end,thisStart,thisEnd){if(!Buffer.isBuffer(target))throw new TypeError("Argument must be a Buffer");if(void 0===start&&(start=0),void 0===end&&(end=target?target.length:0),void 0===thisStart&&(thisStart=0),void 0===thisEnd&&(thisEnd=this.length),start<0||end>target.length||thisStart<0||thisEnd>this.length)throw new RangeError("out of range index");if(thisStart>=thisEnd&&start>=end)return 0;if(thisStart>=thisEnd)return-1;if(start>=end)return 1;if(this===target)return 0;for(var x=(thisEnd>>>=0)-(thisStart>>>=0),y=(end>>>=0)-(start>>>=0),len=Math.min(x,y),thisCopy=this.slice(thisStart,thisEnd),targetCopy=target.slice(start,end),i=0;i<len;++i)if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i],y=targetCopy[i];break}return x<y?-1:y<x?1:0},Buffer.prototype.includes=function(val,byteOffset,encoding){return-1!==this.indexOf(val,byteOffset,encoding)},Buffer.prototype.indexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!0)},Buffer.prototype.lastIndexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!1)},Buffer.prototype.write=function(string,offset,length,encoding){if(void 0===offset)encoding="utf8",length=this.length,offset=0;else if(void 0===length&&"string"==typeof offset)encoding=offset,length=this.length,offset=0;else{if(!isFinite(offset))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");offset|=0,isFinite(length)?(length|=0,void 0===encoding&&(encoding="utf8")):(encoding=length,length=void 0)}var remaining=this.length-offset;if((void 0===length||length>remaining)&&(length=remaining),string.length>0&&(length<0||offset<0)||offset>this.length)throw new RangeError("Attempt to write outside buffer bounds");encoding||(encoding="utf8");for(var loweredCase=!1;;)switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase(),loweredCase=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(127&buf[i]);return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(buf[i]);return ret}function hexSlice(buf,start,end){var len=buf.length;(!start||start<0)&&(start=0),(!end||end<0||end>len)&&(end=len);for(var out="",i=start;i<end;++i)out+=toHex(buf[i]);return out}function utf16leSlice(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}function checkOffset(offset,ext,length){if(offset%1!=0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}function objectWriteUInt16(buf,value,offset,littleEndian){value<0&&(value=65535+value+1);for(var i=0,j=Math.min(buf.length-offset,2);i<j;++i)buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>8*(littleEndian?i:1-i)}function objectWriteUInt32(buf,value,offset,littleEndian){value<0&&(value=4294967295+value+1);for(var i=0,j=Math.min(buf.length-offset,4);i<j;++i)buf[offset+i]=value>>>8*(littleEndian?i:3-i)&255}function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,0,offset,4),ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,0,offset,8),ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}Buffer.prototype.slice=function(start,end){var newBuf,len=this.length;if((start=~~start)<0?(start+=len)<0&&(start=0):start>len&&(start=len),(end=void 0===end?len:~~end)<0?(end+=len)<0&&(end=0):end>len&&(end=len),end<start&&(end=start),Buffer.TYPED_ARRAY_SUPPORT)(newBuf=this.subarray(start,end)).__proto__=Buffer.prototype;else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,void 0);for(var i=0;i<sliceLen;++i)newBuf[i]=this[i+start]}return newBuf},Buffer.prototype.readUIntLE=function(offset,byteLength,noAssert){offset|=0,byteLength|=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val},Buffer.prototype.readUIntBE=function(offset,byteLength,noAssert){offset|=0,byteLength|=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset+--byteLength],mul=1;byteLength>0&&(mul*=256);)val+=this[offset+--byteLength]*mul;return val},Buffer.prototype.readUInt8=function(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer.prototype.readUInt16LE=function(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer.prototype.readUInt16BE=function(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer.prototype.readUInt32LE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer.prototype.readUInt32BE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer.prototype.readIntLE=function(offset,byteLength,noAssert){offset|=0,byteLength|=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val>=(mul*=128)&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readIntBE=function(offset,byteLength,noAssert){offset|=0,byteLength|=0,noAssert||checkOffset(offset,byteLength,this.length);for(var i=byteLength,mul=1,val=this[offset+--i];i>0&&(mul*=256);)val+=this[offset+--i]*mul;return val>=(mul*=128)&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readInt8=function(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),128&this[offset]?-1*(255-this[offset]+1):this[offset]},Buffer.prototype.readInt16LE=function(offset,noAssert){noAssert||checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt16BE=function(offset,noAssert){noAssert||checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt32LE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer.prototype.readInt32BE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer.prototype.readFloatLE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!0,23,4)},Buffer.prototype.readFloatBE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!1,23,4)},Buffer.prototype.readDoubleLE=function(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!0,52,8)},Buffer.prototype.readDoubleBE=function(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!1,52,8)},Buffer.prototype.writeUIntLE=function(value,offset,byteLength,noAssert){(value=+value,offset|=0,byteLength|=0,noAssert)||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var mul=1,i=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUIntBE=function(value,offset,byteLength,noAssert){(value=+value,offset|=0,byteLength|=0,noAssert)||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var i=byteLength-1,mul=1;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUInt8=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),this[offset]=255&value,offset+1},Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=255&value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=255&value):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer.prototype.writeIntLE=function(value,offset,byteLength,noAssert){if(value=+value,offset|=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0,mul=1,sub=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i-1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeIntBE=function(value,offset,byteLength,noAssert){if(value=+value,offset|=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1,mul=1,sub=0;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i+1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeInt8=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),value<0&&(value=255+value+1),this[offset]=255&value,offset+1},Buffer.prototype.writeInt16LE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer.prototype.writeInt16BE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=255&value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer.prototype.writeInt32LE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer.prototype.writeInt32BE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),value<0&&(value=4294967295+value+1),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.copy=function(target,targetStart,start,end){if(start||(start=0),end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),targetStart||(targetStart=0),end>0&&end<start&&(end=start),end===start)return 0;if(0===target.length||0===this.length)return 0;if(targetStart<0)throw new RangeError("targetStart out of bounds");if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");end>this.length&&(end=this.length),target.length-targetStart<end-start&&(end=target.length-targetStart+start);var i,len=end-start;if(this===target&&start<targetStart&&targetStart<end)for(i=len-1;i>=0;--i)target[i+targetStart]=this[i+start];else if(len<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for(i=0;i<len;++i)target[i+targetStart]=this[i+start];else Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart);return len},Buffer.prototype.fill=function(val,start,end,encoding){if("string"==typeof val){if("string"==typeof start?(encoding=start,start=0,end=this.length):"string"==typeof end&&(encoding=end,end=this.length),1===val.length){var code=val.charCodeAt(0);code<256&&(val=code)}if(void 0!==encoding&&"string"!=typeof encoding)throw new TypeError("encoding must be a string");if("string"==typeof encoding&&!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding)}else"number"==typeof val&&(val&=255);if(start<0||this.length<start||this.length<end)throw new RangeError("Out of range index");if(end<=start)return this;var i;if(start>>>=0,end=void 0===end?this.length:end>>>0,val||(val=0),"number"==typeof val)for(i=start;i<end;++i)this[i]=val;else{var bytes=Buffer.isBuffer(val)?val:utf8ToBytes(new Buffer(val,encoding).toString()),len=bytes.length;for(i=0;i<end-start;++i)this[i+start]=bytes[i%len]}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function toHex(n){return n<16?"0"+n.toString(16):n.toString(16)}function utf8ToBytes(string,units){var codePoint;units=units||1/0;for(var length=string.length,leadSurrogate=null,bytes=[],i=0;i<length;++i){if((codePoint=string.charCodeAt(i))>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){(units-=3)>-1&&bytes.push(239,191,189);continue}if(i+1===length){(units-=3)>-1&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){(units-=3)>-1&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=65536+(leadSurrogate-55296<<10|codePoint-56320)}else leadSurrogate&&(units-=3)>-1&&bytes.push(239,191,189);if(leadSurrogate=null,codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(codePoint<1114112))throw new Error("Invalid code point");if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function base64ToBytes(str){return base64.toByteArray((function(str){if((str=(function(str){return str.trim?str.trim():str.replace(/^\s+|\s+$/g,"")})(str).replace(INVALID_BASE64_RE,"")).length<2)return"";for(;str.length%4!=0;)str+="=";return str})(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length&&!(i+offset>=dst.length||i>=src.length);++i)dst[i+offset]=src[i];return i}}).call(this,__webpack_require__(5))},function(module,exports,__webpack_require__){var React=__webpack_require__(4),ReactDOM=__webpack_require__(15),App=__webpack_require__(19);ReactDOM.render(React.createElement(App,null),document.getElementById("app"))},function(module,exports,__webpack_require__){"use strict";var l=__webpack_require__(7),n="function"==typeof Symbol&&Symbol.for,p=n?Symbol.for("react.element"):60103,q=n?Symbol.for("react.portal"):60106,r=n?Symbol.for("react.fragment"):60107,t=n?Symbol.for("react.strict_mode"):60108,u=n?Symbol.for("react.profiler"):60114,v=n?Symbol.for("react.provider"):60109,w=n?Symbol.for("react.context"):60110,x=n?Symbol.for("react.forward_ref"):60112,y=n?Symbol.for("react.suspense"):60113,z=n?Symbol.for("react.memo"):60115,A=n?Symbol.for("react.lazy"):60116,B="function"==typeof Symbol&&Symbol.iterator;function C(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var D={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E={};function F(a,b,c){this.props=a,this.context=b,this.refs=E,this.updater=c||D}function G(){}function H(a,b,c){this.props=a,this.context=b,this.refs=E,this.updater=c||D}F.prototype.isReactComponent={},F.prototype.setState=function(a,b){if("object"!=typeof a&&"function"!=typeof a&&null!=a)throw Error(C(85));this.updater.enqueueSetState(this,a,b,"setState")},F.prototype.forceUpdate=function(a){this.updater.enqueueForceUpdate(this,a,"forceUpdate")},G.prototype=F.prototype;var I=H.prototype=new G;I.constructor=H,l(I,F.prototype),I.isPureReactComponent=!0;var J={current:null},K=Object.prototype.hasOwnProperty,L={key:!0,ref:!0,__self:!0,__source:!0};function M(a,b,c){var e,d={},g=null,k=null;if(null!=b)for(e in void 0!==b.ref&&(k=b.ref),void 0!==b.key&&(g=""+b.key),b)K.call(b,e)&&!L.hasOwnProperty(e)&&(d[e]=b[e]);var f=arguments.length-2;if(1===f)d.children=c;else if(1<f){for(var h=Array(f),m=0;m<f;m++)h[m]=arguments[m+2];d.children=h}if(a&&a.defaultProps)for(e in f=a.defaultProps)void 0===d[e]&&(d[e]=f[e]);return{$$typeof:p,type:a,key:g,ref:k,props:d,_owner:J.current}}function O(a){return"object"==typeof a&&null!==a&&a.$$typeof===p}var P=/\/+/g,Q=[];function R(a,b,c,e){if(Q.length){var d=Q.pop();return d.result=a,d.keyPrefix=b,d.func=c,d.context=e,d.count=0,d}return{result:a,keyPrefix:b,func:c,context:e,count:0}}function S(a){a.result=null,a.keyPrefix=null,a.func=null,a.context=null,a.count=0,10>Q.length&&Q.push(a)}function V(a,b,c){return null==a?0:(function T(a,b,c,e){var d=typeof a;"undefined"!==d&&"boolean"!==d||(a=null);var g=!1;if(null===a)g=!0;else switch(d){case"string":case"number":g=!0;break;case"object":switch(a.$$typeof){case p:case q:g=!0}}if(g)return c(e,a,""===b?"."+U(a,0):b),1;if(g=0,b=""===b?".":b+":",Array.isArray(a))for(var k=0;k<a.length;k++){var f=b+U(d=a[k],k);g+=T(d,f,c,e)}else if(null===a||"object"!=typeof a?f=null:f="function"==typeof(f=B&&a[B]||a["@@iterator"])?f:null,"function"==typeof f)for(a=f.call(a),k=0;!(d=a.next()).done;)g+=T(d=d.value,f=b+U(d,k++),c,e);else if("object"===d)throw c=""+a,Error(C(31,"[object Object]"===c?"object with keys {"+Object.keys(a).join(", ")+"}":c,""));return g})(a,"",b,c)}function U(a,b){return"object"==typeof a&&null!==a&&null!=a.key?(function(a){var b={"=":"=0",":":"=2"};return"$"+(""+a).replace(/[=:]/g,(function(a){return b[a]}))})(a.key):b.toString(36)}function W(a,b){a.func.call(a.context,b,a.count++)}function aa(a,b,c){var e=a.result,d=a.keyPrefix;a=a.func.call(a.context,b,a.count++),Array.isArray(a)?X(a,e,c,(function(a){return a})):null!=a&&(O(a)&&(a=(function(a,b){return{$$typeof:p,type:a.type,key:b,ref:a.ref,props:a.props,_owner:a._owner}})(a,d+(!a.key||b&&b.key===a.key?"":(""+a.key).replace(P,"$&/")+"/")+c)),e.push(a))}function X(a,b,c,e,d){var g="";null!=c&&(g=(""+c).replace(P,"$&/")+"/"),V(a,aa,b=R(b,g,e,d)),S(b)}var Y={current:null};function Z(){var a=Y.current;if(null===a)throw Error(C(321));return a}var ba={ReactCurrentDispatcher:Y,ReactCurrentBatchConfig:{suspense:null},ReactCurrentOwner:J,IsSomeRendererActing:{current:!1},assign:l};exports.Children={map:function(a,b,c){if(null==a)return a;var e=[];return X(a,e,null,b,c),e},forEach:function(a,b,c){if(null==a)return a;V(a,W,b=R(null,null,b,c)),S(b)},count:function(a){return V(a,(function(){return null}),null)},toArray:function(a){var b=[];return X(a,b,null,(function(a){return a})),b},only:function(a){if(!O(a))throw Error(C(143));return a}},exports.Component=F,exports.Fragment=r,exports.Profiler=u,exports.PureComponent=H,exports.StrictMode=t,exports.Suspense=y,exports.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ba,exports.cloneElement=function(a,b,c){if(null==a)throw Error(C(267,a));var e=l({},a.props),d=a.key,g=a.ref,k=a._owner;if(null!=b){if(void 0!==b.ref&&(g=b.ref,k=J.current),void 0!==b.key&&(d=""+b.key),a.type&&a.type.defaultProps)var f=a.type.defaultProps;for(h in b)K.call(b,h)&&!L.hasOwnProperty(h)&&(e[h]=void 0===b[h]&&void 0!==f?f[h]:b[h])}var h=arguments.length-2;if(1===h)e.children=c;else if(1<h){f=Array(h);for(var m=0;m<h;m++)f[m]=arguments[m+2];e.children=f}return{$$typeof:p,type:a.type,key:d,ref:g,props:e,_owner:k}},exports.createContext=function(a,b){return void 0===b&&(b=null),(a={$$typeof:w,_calculateChangedBits:b,_currentValue:a,_currentValue2:a,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:v,_context:a},a.Consumer=a},exports.createElement=M,exports.createFactory=function(a){var b=M.bind(null,a);return b.type=a,b},exports.createRef=function(){return{current:null}},exports.forwardRef=function(a){return{$$typeof:x,render:a}},exports.isValidElement=O,exports.lazy=function(a){return{$$typeof:A,_ctor:a,_status:-1,_result:null}},exports.memo=function(a,b){return{$$typeof:z,type:a,compare:void 0===b?null:b}},exports.useCallback=function(a,b){return Z().useCallback(a,b)},exports.useContext=function(a,b){return Z().useContext(a,b)},exports.useDebugValue=function(){},exports.useEffect=function(a,b){return Z().useEffect(a,b)},exports.useImperativeHandle=function(a,b,c){return Z().useImperativeHandle(a,b,c)},exports.useLayoutEffect=function(a,b){return Z().useLayoutEffect(a,b)},exports.useMemo=function(a,b){return Z().useMemo(a,b)},exports.useReducer=function(a,b,c){return Z().useReducer(a,b,c)},exports.useRef=function(a){return Z().useRef(a)},exports.useState=function(a){return Z().useState(a)},exports.version="16.13.1"},function(module,exports,__webpack_require__){"use strict";!(function checkDCE(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE){0;try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch(err){console.error(err)}}})(),module.exports=__webpack_require__(16)},function(module,exports,__webpack_require__){"use strict";var aa=__webpack_require__(4),n=__webpack_require__(7),r=__webpack_require__(17);function u(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!aa)throw Error(u(227));function ba(a,b,c,d,e,f,g,h,k){var l=Array.prototype.slice.call(arguments,3);try{b.apply(c,l)}catch(m){this.onError(m)}}var da=!1,ea=null,fa=!1,ha=null,ia={onError:function(a){da=!0,ea=a}};function ja(a,b,c,d,e,f,g,h,k){da=!1,ea=null,ba.apply(ia,arguments)}var la=null,ma=null,na=null;function oa(a,b,c){var d=a.type||"unknown-event";a.currentTarget=na(c),(function(a,b,c,d,e,f,g,h,k){if(ja.apply(this,arguments),da){if(!da)throw Error(u(198));var l=ea;da=!1,ea=null,fa||(fa=!0,ha=l)}})(d,b,void 0,a),a.currentTarget=null}var pa=null,qa={};function ra(){if(pa)for(var a in qa){var b=qa[a],c=pa.indexOf(a);if(!(-1<c))throw Error(u(96,a));if(!sa[c]){if(!b.extractEvents)throw Error(u(97,a));for(var d in sa[c]=b,c=b.eventTypes){var e=void 0,f=c[d],g=b,h=d;if(ta.hasOwnProperty(h))throw Error(u(99,h));ta[h]=f;var k=f.phasedRegistrationNames;if(k){for(e in k)k.hasOwnProperty(e)&&ua(k[e],g,h);e=!0}else f.registrationName?(ua(f.registrationName,g,h),e=!0):e=!1;if(!e)throw Error(u(98,d,a))}}}}function ua(a,b,c){if(va[a])throw Error(u(100,a));va[a]=b,wa[a]=b.eventTypes[c].dependencies}var sa=[],ta={},va={},wa={};function xa(a){var c,b=!1;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];if(!qa.hasOwnProperty(c)||qa[c]!==d){if(qa[c])throw Error(u(102,c));qa[c]=d,b=!0}}b&&ra()}var ya=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),za=null,Aa=null,Ba=null;function Ca(a){if(a=ma(a)){if("function"!=typeof za)throw Error(u(280));var b=a.stateNode;b&&(b=la(b),za(a.stateNode,a.type,b))}}function Da(a){Aa?Ba?Ba.push(a):Ba=[a]:Aa=a}function Ea(){if(Aa){var a=Aa,b=Ba;if(Ba=Aa=null,Ca(a),b)for(a=0;a<b.length;a++)Ca(b[a])}}function Fa(a,b){return a(b)}function Ga(a,b,c,d,e){return a(b,c,d,e)}function Ha(){}var Ia=Fa,Ja=!1,Ka=!1;function La(){null===Aa&&null===Ba||(Ha(),Ea())}function Ma(a,b,c){if(Ka)return a(b,c);Ka=!0;try{return Ia(a,b,c)}finally{Ka=!1,La()}}var Na=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Oa=Object.prototype.hasOwnProperty,Pa={},Qa={};function v(a,b,c,d,e,f){this.acceptsBooleans=2===b||3===b||4===b,this.attributeName=d,this.attributeNamespace=e,this.mustUseProperty=c,this.propertyName=a,this.type=b,this.sanitizeURL=f}var C={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(a){C[a]=new v(a,0,!1,a,null,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(a){var b=a[0];C[b]=new v(b,1,!1,a[1],null,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(a){C[a]=new v(a,2,!1,a.toLowerCase(),null,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(a){C[a]=new v(a,2,!1,a,null,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(a){C[a]=new v(a,3,!1,a.toLowerCase(),null,!1)})),["checked","multiple","muted","selected"].forEach((function(a){C[a]=new v(a,3,!0,a,null,!1)})),["capture","download"].forEach((function(a){C[a]=new v(a,4,!1,a,null,!1)})),["cols","rows","size","span"].forEach((function(a){C[a]=new v(a,6,!1,a,null,!1)})),["rowSpan","start"].forEach((function(a){C[a]=new v(a,5,!1,a.toLowerCase(),null,!1)}));var Ua=/[\-:]([a-z])/g;function Va(a){return a[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(a){var b=a.replace(Ua,Va);C[b]=new v(b,1,!1,a,null,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(a){var b=a.replace(Ua,Va);C[b]=new v(b,1,!1,a,"http://www.w3.org/1999/xlink",!1)})),["xml:base","xml:lang","xml:space"].forEach((function(a){var b=a.replace(Ua,Va);C[b]=new v(b,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1)})),["tabIndex","crossOrigin"].forEach((function(a){C[a]=new v(a,1,!1,a.toLowerCase(),null,!1)})),C.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0),["src","href","action","formAction"].forEach((function(a){C[a]=new v(a,1,!1,a.toLowerCase(),null,!0)}));var Wa=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function Xa(a,b,c,d){var e=C.hasOwnProperty(b)?C[b]:null;(null!==e?0===e.type:!d&&(2<b.length&&("o"===b[0]||"O"===b[0])&&("n"===b[1]||"N"===b[1])))||((function(a,b,c,d){if(null==b||(function(a,b,c,d){if(null!==c&&0===c.type)return!1;switch(typeof b){case"function":case"symbol":return!0;case"boolean":return!d&&(null!==c?!c.acceptsBooleans:"data-"!==(a=a.toLowerCase().slice(0,5))&&"aria-"!==a);default:return!1}})(a,b,c,d))return!0;if(d)return!1;if(null!==c)switch(c.type){case 3:return!b;case 4:return!1===b;case 5:return isNaN(b);case 6:return isNaN(b)||1>b}return!1})(b,c,e,d)&&(c=null),d||null===e?(function(a){return!!Oa.call(Qa,a)||!Oa.call(Pa,a)&&(Na.test(a)?Qa[a]=!0:(Pa[a]=!0,!1))})(b)&&(null===c?a.removeAttribute(b):a.setAttribute(b,""+c)):e.mustUseProperty?a[e.propertyName]=null===c?3!==e.type&&"":c:(b=e.attributeName,d=e.attributeNamespace,null===c?a.removeAttribute(b):(c=3===(e=e.type)||4===e&&!0===c?"":""+c,d?a.setAttributeNS(d,b,c):a.setAttribute(b,c))))}Wa.hasOwnProperty("ReactCurrentDispatcher")||(Wa.ReactCurrentDispatcher={current:null}),Wa.hasOwnProperty("ReactCurrentBatchConfig")||(Wa.ReactCurrentBatchConfig={suspense:null});var Ya=/^(.*)[\\\/]/,E="function"==typeof Symbol&&Symbol.for,Za=E?Symbol.for("react.element"):60103,$a=E?Symbol.for("react.portal"):60106,ab=E?Symbol.for("react.fragment"):60107,bb=E?Symbol.for("react.strict_mode"):60108,cb=E?Symbol.for("react.profiler"):60114,db=E?Symbol.for("react.provider"):60109,eb=E?Symbol.for("react.context"):60110,fb=E?Symbol.for("react.concurrent_mode"):60111,gb=E?Symbol.for("react.forward_ref"):60112,hb=E?Symbol.for("react.suspense"):60113,ib=E?Symbol.for("react.suspense_list"):60120,jb=E?Symbol.for("react.memo"):60115,kb=E?Symbol.for("react.lazy"):60116,lb=E?Symbol.for("react.block"):60121,mb="function"==typeof Symbol&&Symbol.iterator;function nb(a){return null===a||"object"!=typeof a?null:"function"==typeof(a=mb&&a[mb]||a["@@iterator"])?a:null}function pb(a){if(null==a)return null;if("function"==typeof a)return a.displayName||a.name||null;if("string"==typeof a)return a;switch(a){case ab:return"Fragment";case $a:return"Portal";case cb:return"Profiler";case bb:return"StrictMode";case hb:return"Suspense";case ib:return"SuspenseList"}if("object"==typeof a)switch(a.$$typeof){case eb:return"Context.Consumer";case db:return"Context.Provider";case gb:var b=a.render;return b=b.displayName||b.name||"",a.displayName||(""!==b?"ForwardRef("+b+")":"ForwardRef");case jb:return pb(a.type);case lb:return pb(a.render);case kb:if(a=1===a._status?a._result:null)return pb(a)}return null}function qb(a){var b="";do{a:switch(a.tag){case 3:case 4:case 6:case 7:case 10:case 9:var c="";break a;default:var d=a._debugOwner,e=a._debugSource,f=pb(a.type);c=null,d&&(c=pb(d.type)),d=f,f="",e?f=" (at "+e.fileName.replace(Ya,"")+":"+e.lineNumber+")":c&&(f=" (created by "+c+")"),c="\n    in "+(d||"Unknown")+f}b+=c,a=a.return}while(a);return b}function rb(a){switch(typeof a){case"boolean":case"number":case"object":case"string":case"undefined":return a;default:return""}}function sb(a){var b=a.type;return(a=a.nodeName)&&"input"===a.toLowerCase()&&("checkbox"===b||"radio"===b)}function xb(a){a._valueTracker||(a._valueTracker=(function(a){var b=sb(a)?"checked":"value",c=Object.getOwnPropertyDescriptor(a.constructor.prototype,b),d=""+a[b];if(!a.hasOwnProperty(b)&&void 0!==c&&"function"==typeof c.get&&"function"==typeof c.set){var e=c.get,f=c.set;return Object.defineProperty(a,b,{configurable:!0,get:function(){return e.call(this)},set:function(a){d=""+a,f.call(this,a)}}),Object.defineProperty(a,b,{enumerable:c.enumerable}),{getValue:function(){return d},setValue:function(a){d=""+a},stopTracking:function(){a._valueTracker=null,delete a[b]}}}})(a))}function yb(a){if(!a)return!1;var b=a._valueTracker;if(!b)return!0;var c=b.getValue(),d="";return a&&(d=sb(a)?a.checked?"true":"false":a.value),(a=d)!==c&&(b.setValue(a),!0)}function zb(a,b){var c=b.checked;return n({},b,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=c?c:a._wrapperState.initialChecked})}function Ab(a,b){var c=null==b.defaultValue?"":b.defaultValue,d=null!=b.checked?b.checked:b.defaultChecked;c=rb(null!=b.value?b.value:c),a._wrapperState={initialChecked:d,initialValue:c,controlled:"checkbox"===b.type||"radio"===b.type?null!=b.checked:null!=b.value}}function Bb(a,b){null!=(b=b.checked)&&Xa(a,"checked",b,!1)}function Cb(a,b){Bb(a,b);var c=rb(b.value),d=b.type;if(null!=c)"number"===d?(0===c&&""===a.value||a.value!=c)&&(a.value=""+c):a.value!==""+c&&(a.value=""+c);else if("submit"===d||"reset"===d)return void a.removeAttribute("value");b.hasOwnProperty("value")?Db(a,b.type,c):b.hasOwnProperty("defaultValue")&&Db(a,b.type,rb(b.defaultValue)),null==b.checked&&null!=b.defaultChecked&&(a.defaultChecked=!!b.defaultChecked)}function Eb(a,b,c){if(b.hasOwnProperty("value")||b.hasOwnProperty("defaultValue")){var d=b.type;if(!("submit"!==d&&"reset"!==d||void 0!==b.value&&null!==b.value))return;b=""+a._wrapperState.initialValue,c||b===a.value||(a.value=b),a.defaultValue=b}""!==(c=a.name)&&(a.name=""),a.defaultChecked=!!a._wrapperState.initialChecked,""!==c&&(a.name=c)}function Db(a,b,c){"number"===b&&a.ownerDocument.activeElement===a||(null==c?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+c&&(a.defaultValue=""+c))}function Gb(a,b){return a=n({children:void 0},b),(b=(function(a){var b="";return aa.Children.forEach(a,(function(a){null!=a&&(b+=a)})),b})(b.children))&&(a.children=b),a}function Hb(a,b,c,d){if(a=a.options,b){b={};for(var e=0;e<c.length;e++)b["$"+c[e]]=!0;for(c=0;c<a.length;c++)e=b.hasOwnProperty("$"+a[c].value),a[c].selected!==e&&(a[c].selected=e),e&&d&&(a[c].defaultSelected=!0)}else{for(c=""+rb(c),b=null,e=0;e<a.length;e++){if(a[e].value===c)return a[e].selected=!0,void(d&&(a[e].defaultSelected=!0));null!==b||a[e].disabled||(b=a[e])}null!==b&&(b.selected=!0)}}function Ib(a,b){if(null!=b.dangerouslySetInnerHTML)throw Error(u(91));return n({},b,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}function Jb(a,b){var c=b.value;if(null==c){if(c=b.children,b=b.defaultValue,null!=c){if(null!=b)throw Error(u(92));if(Array.isArray(c)){if(!(1>=c.length))throw Error(u(93));c=c[0]}b=c}null==b&&(b=""),c=b}a._wrapperState={initialValue:rb(c)}}function Kb(a,b){var c=rb(b.value),d=rb(b.defaultValue);null!=c&&((c=""+c)!==a.value&&(a.value=c),null==b.defaultValue&&a.defaultValue!==c&&(a.defaultValue=c)),null!=d&&(a.defaultValue=""+d)}function Lb(a){var b=a.textContent;b===a._wrapperState.initialValue&&""!==b&&null!==b&&(a.value=b)}var Mb_html="http://www.w3.org/1999/xhtml",Mb_svg="http://www.w3.org/2000/svg";function Nb(a){switch(a){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ob(a,b){return null==a||"http://www.w3.org/1999/xhtml"===a?Nb(b):"http://www.w3.org/2000/svg"===a&&"foreignObject"===b?"http://www.w3.org/1999/xhtml":a}var Pb,Qb=(function(a){return"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(b,c,d,e){MSApp.execUnsafeLocalFunction((function(){return a(b,c)}))}:a})((function(a,b){if(a.namespaceURI!==Mb_svg||"innerHTML"in a)a.innerHTML=b;else{for((Pb=Pb||document.createElement("div")).innerHTML="<svg>"+b.valueOf().toString()+"</svg>",b=Pb.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;b.firstChild;)a.appendChild(b.firstChild)}}));function Rb(a,b){if(b){var c=a.firstChild;if(c&&c===a.lastChild&&3===c.nodeType)return void(c.nodeValue=b)}a.textContent=b}function Sb(a,b){var c={};return c[a.toLowerCase()]=b.toLowerCase(),c["Webkit"+a]="webkit"+b,c["Moz"+a]="moz"+b,c}var Tb={animationend:Sb("Animation","AnimationEnd"),animationiteration:Sb("Animation","AnimationIteration"),animationstart:Sb("Animation","AnimationStart"),transitionend:Sb("Transition","TransitionEnd")},Ub={},Vb={};function Wb(a){if(Ub[a])return Ub[a];if(!Tb[a])return a;var c,b=Tb[a];for(c in b)if(b.hasOwnProperty(c)&&c in Vb)return Ub[a]=b[c];return a}ya&&(Vb=document.createElement("div").style,"AnimationEvent"in window||(delete Tb.animationend.animation,delete Tb.animationiteration.animation,delete Tb.animationstart.animation),"TransitionEvent"in window||delete Tb.transitionend.transition);var Xb=Wb("animationend"),Yb=Wb("animationiteration"),Zb=Wb("animationstart"),$b=Wb("transitionend"),ac="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),bc=new("function"==typeof WeakMap?WeakMap:Map);function cc(a){var b=bc.get(a);return void 0===b&&(b=new Map,bc.set(a,b)),b}function dc(a){var b=a,c=a;if(a.alternate)for(;b.return;)b=b.return;else{a=b;do{0!=(1026&(b=a).effectTag)&&(c=b.return),a=b.return}while(a)}return 3===b.tag?c:null}function ec(a){if(13===a.tag){var b=a.memoizedState;if(null===b&&(null!==(a=a.alternate)&&(b=a.memoizedState)),null!==b)return b.dehydrated}return null}function fc(a){if(dc(a)!==a)throw Error(u(188))}function hc(a){if(!(a=(function(a){var b=a.alternate;if(!b){if(null===(b=dc(a)))throw Error(u(188));return b!==a?null:a}for(var c=a,d=b;;){var e=c.return;if(null===e)break;var f=e.alternate;if(null===f){if(null!==(d=e.return)){c=d;continue}break}if(e.child===f.child){for(f=e.child;f;){if(f===c)return fc(e),a;if(f===d)return fc(e),b;f=f.sibling}throw Error(u(188))}if(c.return!==d.return)c=e,d=f;else{for(var g=!1,h=e.child;h;){if(h===c){g=!0,c=e,d=f;break}if(h===d){g=!0,d=e,c=f;break}h=h.sibling}if(!g){for(h=f.child;h;){if(h===c){g=!0,c=f,d=e;break}if(h===d){g=!0,d=f,c=e;break}h=h.sibling}if(!g)throw Error(u(189))}}if(c.alternate!==d)throw Error(u(190))}if(3!==c.tag)throw Error(u(188));return c.stateNode.current===c?a:b})(a)))return null;for(var b=a;;){if(5===b.tag||6===b.tag)return b;if(b.child)b.child.return=b,b=b.child;else{if(b===a)break;for(;!b.sibling;){if(!b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return,b=b.sibling}}return null}function ic(a,b){if(null==b)throw Error(u(30));return null==a?b:Array.isArray(a)?Array.isArray(b)?(a.push.apply(a,b),a):(a.push(b),a):Array.isArray(b)?[a].concat(b):[a,b]}function jc(a,b,c){Array.isArray(a)?a.forEach(b,c):a&&b.call(c,a)}var kc=null;function lc(a){if(a){var b=a._dispatchListeners,c=a._dispatchInstances;if(Array.isArray(b))for(var d=0;d<b.length&&!a.isPropagationStopped();d++)oa(a,b[d],c[d]);else b&&oa(a,b,c);a._dispatchListeners=null,a._dispatchInstances=null,a.isPersistent()||a.constructor.release(a)}}function mc(a){if(null!==a&&(kc=ic(kc,a)),a=kc,kc=null,a){if(jc(a,lc),kc)throw Error(u(95));if(fa)throw a=ha,fa=!1,ha=null,a}}function nc(a){return(a=a.target||a.srcElement||window).correspondingUseElement&&(a=a.correspondingUseElement),3===a.nodeType?a.parentNode:a}function oc(a){if(!ya)return!1;var b=(a="on"+a)in document;return b||((b=document.createElement("div")).setAttribute(a,"return;"),b="function"==typeof b[a]),b}var pc=[];function qc(a){a.topLevelType=null,a.nativeEvent=null,a.targetInst=null,a.ancestors.length=0,10>pc.length&&pc.push(a)}function rc(a,b,c,d){if(pc.length){var e=pc.pop();return e.topLevelType=a,e.eventSystemFlags=d,e.nativeEvent=b,e.targetInst=c,e}return{topLevelType:a,eventSystemFlags:d,nativeEvent:b,targetInst:c,ancestors:[]}}function sc(a){var b=a.targetInst,c=b;do{if(!c){a.ancestors.push(c);break}var d=c;if(3===d.tag)d=d.stateNode.containerInfo;else{for(;d.return;)d=d.return;d=3!==d.tag?null:d.stateNode.containerInfo}if(!d)break;5!==(b=c.tag)&&6!==b||a.ancestors.push(c),c=tc(d)}while(c);for(c=0;c<a.ancestors.length;c++){b=a.ancestors[c];var e=nc(a.nativeEvent);d=a.topLevelType;var f=a.nativeEvent,g=a.eventSystemFlags;0===c&&(g|=64);for(var h=null,k=0;k<sa.length;k++){var l=sa[k];l&&(l=l.extractEvents(d,b,f,e,g))&&(h=ic(h,l))}mc(h)}}function uc(a,b,c){if(!c.has(a)){switch(a){case"scroll":vc(b,"scroll",!0);break;case"focus":case"blur":vc(b,"focus",!0),vc(b,"blur",!0),c.set("blur",null),c.set("focus",null);break;case"cancel":case"close":oc(a)&&vc(b,a,!0);break;case"invalid":case"submit":case"reset":break;default:-1===ac.indexOf(a)&&F(a,b)}c.set(a,null)}}var wc,xc,yc,zc=!1,Ac=[],Bc=null,Cc=null,Dc=null,Ec=new Map,Fc=new Map,Gc=[],Hc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),Ic="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" ");function Kc(a,b,c,d,e){return{blockedOn:a,topLevelType:b,eventSystemFlags:32|c,nativeEvent:e,container:d}}function Lc(a,b){switch(a){case"focus":case"blur":Bc=null;break;case"dragenter":case"dragleave":Cc=null;break;case"mouseover":case"mouseout":Dc=null;break;case"pointerover":case"pointerout":Ec.delete(b.pointerId);break;case"gotpointercapture":case"lostpointercapture":Fc.delete(b.pointerId)}}function Mc(a,b,c,d,e,f){return null===a||a.nativeEvent!==f?(a=Kc(b,c,d,e,f),null!==b&&(null!==(b=Nc(b))&&xc(b)),a):(a.eventSystemFlags|=d,a)}function Pc(a){var b=tc(a.target);if(null!==b){var c=dc(b);if(null!==c)if(13===(b=c.tag)){if(null!==(b=ec(c)))return a.blockedOn=b,void r.unstable_runWithPriority(a.priority,(function(){yc(c)}))}else if(3===b&&c.stateNode.hydrate)return void(a.blockedOn=3===c.tag?c.stateNode.containerInfo:null)}a.blockedOn=null}function Qc(a){if(null!==a.blockedOn)return!1;var b=Rc(a.topLevelType,a.eventSystemFlags,a.container,a.nativeEvent);if(null!==b){var c=Nc(b);return null!==c&&xc(c),a.blockedOn=b,!1}return!0}function Sc(a,b,c){Qc(a)&&c.delete(b)}function Tc(){for(zc=!1;0<Ac.length;){var a=Ac[0];if(null!==a.blockedOn){null!==(a=Nc(a.blockedOn))&&wc(a);break}var b=Rc(a.topLevelType,a.eventSystemFlags,a.container,a.nativeEvent);null!==b?a.blockedOn=b:Ac.shift()}null!==Bc&&Qc(Bc)&&(Bc=null),null!==Cc&&Qc(Cc)&&(Cc=null),null!==Dc&&Qc(Dc)&&(Dc=null),Ec.forEach(Sc),Fc.forEach(Sc)}function Uc(a,b){a.blockedOn===b&&(a.blockedOn=null,zc||(zc=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Tc)))}function Vc(a){function b(b){return Uc(b,a)}if(0<Ac.length){Uc(Ac[0],a);for(var c=1;c<Ac.length;c++){var d=Ac[c];d.blockedOn===a&&(d.blockedOn=null)}}for(null!==Bc&&Uc(Bc,a),null!==Cc&&Uc(Cc,a),null!==Dc&&Uc(Dc,a),Ec.forEach(b),Fc.forEach(b),c=0;c<Gc.length;c++)(d=Gc[c]).blockedOn===a&&(d.blockedOn=null);for(;0<Gc.length&&null===(c=Gc[0]).blockedOn;)Pc(c),null===c.blockedOn&&Gc.shift()}var Wc={},Yc=new Map,Zc=new Map,$c=["abort","abort",Xb,"animationEnd",Yb,"animationIteration",Zb,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",$b,"transitionEnd","waiting","waiting"];function ad(a,b){for(var c=0;c<a.length;c+=2){var d=a[c],e=a[c+1],f="on"+(e[0].toUpperCase()+e.slice(1));f={phasedRegistrationNames:{bubbled:f,captured:f+"Capture"},dependencies:[d],eventPriority:b},Zc.set(d,b),Yc.set(d,f),Wc[e]=f}}ad("blur blur cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focus focus input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),ad("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),ad($c,2);for(var bd="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),cd=0;cd<bd.length;cd++)Zc.set(bd[cd],0);var dd=r.unstable_UserBlockingPriority,ed=r.unstable_runWithPriority,fd=!0;function F(a,b){vc(b,a,!1)}function vc(a,b,c){var d=Zc.get(b);switch(void 0===d?2:d){case 0:d=gd.bind(null,b,1,a);break;case 1:d=hd.bind(null,b,1,a);break;default:d=id.bind(null,b,1,a)}c?a.addEventListener(b,d,!0):a.addEventListener(b,d,!1)}function gd(a,b,c,d){Ja||Ha();var e=id,f=Ja;Ja=!0;try{Ga(e,a,b,c,d)}finally{(Ja=f)||La()}}function hd(a,b,c,d){ed(dd,id.bind(null,a,b,c,d))}function id(a,b,c,d){if(fd)if(0<Ac.length&&-1<Hc.indexOf(a))a=Kc(null,a,b,c,d),Ac.push(a);else{var e=Rc(a,b,c,d);if(null===e)Lc(a,d);else if(-1<Hc.indexOf(a))a=Kc(e,a,b,c,d),Ac.push(a);else if(!(function(a,b,c,d,e){switch(b){case"focus":return Bc=Mc(Bc,a,b,c,d,e),!0;case"dragenter":return Cc=Mc(Cc,a,b,c,d,e),!0;case"mouseover":return Dc=Mc(Dc,a,b,c,d,e),!0;case"pointerover":var f=e.pointerId;return Ec.set(f,Mc(Ec.get(f)||null,a,b,c,d,e)),!0;case"gotpointercapture":return f=e.pointerId,Fc.set(f,Mc(Fc.get(f)||null,a,b,c,d,e)),!0}return!1})(e,a,b,c,d)){Lc(a,d),a=rc(a,d,null,b);try{Ma(sc,a)}finally{qc(a)}}}}function Rc(a,b,c,d){if(null!==(c=tc(c=nc(d)))){var e=dc(c);if(null===e)c=null;else{var f=e.tag;if(13===f){if(null!==(c=ec(e)))return c;c=null}else if(3===f){if(e.stateNode.hydrate)return 3===e.tag?e.stateNode.containerInfo:null;c=null}else e!==c&&(c=null)}}a=rc(a,d,c,b);try{Ma(sc,a)}finally{qc(a)}return null}var jd={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},kd=["Webkit","ms","Moz","O"];function ld(a,b,c){return null==b||"boolean"==typeof b||""===b?"":c||"number"!=typeof b||0===b||jd.hasOwnProperty(a)&&jd[a]?(""+b).trim():b+"px"}function md(a,b){for(var c in a=a.style,b)if(b.hasOwnProperty(c)){var d=0===c.indexOf("--"),e=ld(c,b[c],d);"float"===c&&(c="cssFloat"),d?a.setProperty(c,e):a[c]=e}}Object.keys(jd).forEach((function(a){kd.forEach((function(b){b=b+a.charAt(0).toUpperCase()+a.substring(1),jd[b]=jd[a]}))}));var nd=n({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function od(a,b){if(b){if(nd[a]&&(null!=b.children||null!=b.dangerouslySetInnerHTML))throw Error(u(137,a,""));if(null!=b.dangerouslySetInnerHTML){if(null!=b.children)throw Error(u(60));if("object"!=typeof b.dangerouslySetInnerHTML||!("__html"in b.dangerouslySetInnerHTML))throw Error(u(61))}if(null!=b.style&&"object"!=typeof b.style)throw Error(u(62,""))}}function pd(a,b){if(-1===a.indexOf("-"))return"string"==typeof b.is;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var qd=Mb_html;function rd(a,b){var c=cc(a=9===a.nodeType||11===a.nodeType?a:a.ownerDocument);b=wa[b];for(var d=0;d<b.length;d++)uc(b[d],a,c)}function sd(){}function td(a){if(void 0===(a=a||("undefined"!=typeof document?document:void 0)))return null;try{return a.activeElement||a.body}catch(b){return a.body}}function ud(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function vd(a,b){var d,c=ud(a);for(a=0;c;){if(3===c.nodeType){if(d=a+c.textContent.length,a<=b&&d>=b)return{node:c,offset:b-a};a=d}a:{for(;c;){if(c.nextSibling){c=c.nextSibling;break a}c=c.parentNode}c=void 0}c=ud(c)}}function xd(){for(var a=window,b=td();b instanceof a.HTMLIFrameElement;){try{var c="string"==typeof b.contentWindow.location.href}catch(d){c=!1}if(!c)break;b=td((a=b.contentWindow).document)}return b}function yd(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return b&&("input"===b&&("text"===a.type||"search"===a.type||"tel"===a.type||"url"===a.type||"password"===a.type)||"textarea"===b||"true"===a.contentEditable)}var Dd=null,Ed=null;function Fd(a,b){switch(a){case"button":case"input":case"select":case"textarea":return!!b.autoFocus}return!1}function Gd(a,b){return"textarea"===a||"option"===a||"noscript"===a||"string"==typeof b.children||"number"==typeof b.children||"object"==typeof b.dangerouslySetInnerHTML&&null!==b.dangerouslySetInnerHTML&&null!=b.dangerouslySetInnerHTML.__html}var Hd="function"==typeof setTimeout?setTimeout:void 0,Id="function"==typeof clearTimeout?clearTimeout:void 0;function Jd(a){for(;null!=a;a=a.nextSibling){var b=a.nodeType;if(1===b||3===b)break}return a}function Kd(a){a=a.previousSibling;for(var b=0;a;){if(8===a.nodeType){var c=a.data;if("$"===c||"$!"===c||"$?"===c){if(0===b)return a;b--}else"/$"===c&&b++}a=a.previousSibling}return null}var Ld=Math.random().toString(36).slice(2),Md="__reactInternalInstance$"+Ld,Nd="__reactEventHandlers$"+Ld,Od="__reactContainere$"+Ld;function tc(a){var b=a[Md];if(b)return b;for(var c=a.parentNode;c;){if(b=c[Od]||c[Md]){if(c=b.alternate,null!==b.child||null!==c&&null!==c.child)for(a=Kd(a);null!==a;){if(c=a[Md])return c;a=Kd(a)}return b}c=(a=c).parentNode}return null}function Nc(a){return!(a=a[Md]||a[Od])||5!==a.tag&&6!==a.tag&&13!==a.tag&&3!==a.tag?null:a}function Pd(a){if(5===a.tag||6===a.tag)return a.stateNode;throw Error(u(33))}function Qd(a){return a[Nd]||null}function Rd(a){do{a=a.return}while(a&&5!==a.tag);return a||null}function Sd(a,b){var c=a.stateNode;if(!c)return null;var d=la(c);if(!d)return null;c=d[b];a:switch(b){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(d=!("button"===(a=a.type)||"input"===a||"select"===a||"textarea"===a)),a=!d;break a;default:a=!1}if(a)return null;if(c&&"function"!=typeof c)throw Error(u(231,b,typeof c));return c}function Td(a,b,c){(b=Sd(a,c.dispatchConfig.phasedRegistrationNames[b]))&&(c._dispatchListeners=ic(c._dispatchListeners,b),c._dispatchInstances=ic(c._dispatchInstances,a))}function Ud(a){if(a&&a.dispatchConfig.phasedRegistrationNames){for(var b=a._targetInst,c=[];b;)c.push(b),b=Rd(b);for(b=c.length;0<b--;)Td(c[b],"captured",a);for(b=0;b<c.length;b++)Td(c[b],"bubbled",a)}}function Vd(a,b,c){a&&c&&c.dispatchConfig.registrationName&&(b=Sd(a,c.dispatchConfig.registrationName))&&(c._dispatchListeners=ic(c._dispatchListeners,b),c._dispatchInstances=ic(c._dispatchInstances,a))}function Wd(a){a&&a.dispatchConfig.registrationName&&Vd(a._targetInst,null,a)}function Xd(a){jc(a,Ud)}var Yd=null,Zd=null,$d=null;function ae(){if($d)return $d;var a,d,b=Zd,c=b.length,e="value"in Yd?Yd.value:Yd.textContent,f=e.length;for(a=0;a<c&&b[a]===e[a];a++);var g=c-a;for(d=1;d<=g&&b[c-d]===e[f-d];d++);return $d=e.slice(a,1<d?1-d:void 0)}function be(){return!0}function ce(){return!1}function G(a,b,c,d){for(var e in this.dispatchConfig=a,this._targetInst=b,this.nativeEvent=c,a=this.constructor.Interface)a.hasOwnProperty(e)&&((b=a[e])?this[e]=b(c):"target"===e?this.target=d:this[e]=c[e]);return this.isDefaultPrevented=(null!=c.defaultPrevented?c.defaultPrevented:!1===c.returnValue)?be:ce,this.isPropagationStopped=ce,this}function ee(a,b,c,d){if(this.eventPool.length){var e=this.eventPool.pop();return this.call(e,a,b,c,d),e}return new this(a,b,c,d)}function fe(a){if(!(a instanceof this))throw Error(u(279));a.destructor(),10>this.eventPool.length&&this.eventPool.push(a)}function de(a){a.eventPool=[],a.getPooled=ee,a.release=fe}n(G.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():"unknown"!=typeof a.returnValue&&(a.returnValue=!1),this.isDefaultPrevented=be)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():"unknown"!=typeof a.cancelBubble&&(a.cancelBubble=!0),this.isPropagationStopped=be)},persist:function(){this.isPersistent=be},isPersistent:ce,destructor:function(){var b,a=this.constructor.Interface;for(b in a)this[b]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null,this.isPropagationStopped=this.isDefaultPrevented=ce,this._dispatchInstances=this._dispatchListeners=null}}),G.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null},G.extend=function(a){function b(){}function c(){return d.apply(this,arguments)}var d=this;b.prototype=d.prototype;var e=new b;return n(e,c.prototype),c.prototype=e,c.prototype.constructor=c,c.Interface=n({},d.Interface,a),c.extend=d.extend,de(c),c},de(G);var ge=G.extend({data:null}),he=G.extend({data:null}),ie=[9,13,27,32],je=ya&&"CompositionEvent"in window,ke=null;ya&&"documentMode"in document&&(ke=document.documentMode);var le=ya&&"TextEvent"in window&&!ke,me=ya&&(!je||ke&&8<ke&&11>=ke),ne=String.fromCharCode(32),oe={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},pe=!1;function qe(a,b){switch(a){case"keyup":return-1!==ie.indexOf(b.keyCode);case"keydown":return 229!==b.keyCode;case"keypress":case"mousedown":case"blur":return!0;default:return!1}}function re(a){return"object"==typeof(a=a.detail)&&"data"in a?a.data:null}var se=!1;var ve={eventTypes:oe,extractEvents:function(a,b,c,d){var e;if(je)b:{switch(a){case"compositionstart":var f=oe.compositionStart;break b;case"compositionend":f=oe.compositionEnd;break b;case"compositionupdate":f=oe.compositionUpdate;break b}f=void 0}else se?qe(a,c)&&(f=oe.compositionEnd):"keydown"===a&&229===c.keyCode&&(f=oe.compositionStart);return f?(me&&"ko"!==c.locale&&(se||f!==oe.compositionStart?f===oe.compositionEnd&&se&&(e=ae()):(Zd="value"in(Yd=d)?Yd.value:Yd.textContent,se=!0)),f=ge.getPooled(f,b,c,d),e?f.data=e:null!==(e=re(c))&&(f.data=e),Xd(f),e=f):e=null,(a=le?(function(a,b){switch(a){case"compositionend":return re(b);case"keypress":return 32!==b.which?null:(pe=!0,ne);case"textInput":return(a=b.data)===ne&&pe?null:a;default:return null}})(a,c):(function(a,b){if(se)return"compositionend"===a||!je&&qe(a,b)?(a=ae(),$d=Zd=Yd=null,se=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(b.ctrlKey||b.altKey||b.metaKey)||b.ctrlKey&&b.altKey){if(b.char&&1<b.char.length)return b.char;if(b.which)return String.fromCharCode(b.which)}return null;case"compositionend":return me&&"ko"!==b.locale?null:b.data;default:return null}})(a,c))?((b=he.getPooled(oe.beforeInput,b,c,d)).data=a,Xd(b)):b=null,null===e?b:null===b?e:[e,b]}},we={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function xe(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return"input"===b?!!we[a.type]:"textarea"===b}var ye={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}};function ze(a,b,c){return(a=G.getPooled(ye.change,a,b,c)).type="change",Da(c),Xd(a),a}var Ae=null,Be=null;function Ce(a){mc(a)}function De(a){if(yb(Pd(a)))return a}function Ee(a,b){if("change"===a)return b}var Fe=!1;function Ge(){Ae&&(Ae.detachEvent("onpropertychange",He),Be=Ae=null)}function He(a){if("value"===a.propertyName&&De(Be))if(a=ze(Be,a,nc(a)),Ja)mc(a);else{Ja=!0;try{Fa(Ce,a)}finally{Ja=!1,La()}}}function Ie(a,b,c){"focus"===a?(Ge(),Be=c,(Ae=b).attachEvent("onpropertychange",He)):"blur"===a&&Ge()}function Je(a){if("selectionchange"===a||"keyup"===a||"keydown"===a)return De(Be)}function Ke(a,b){if("click"===a)return De(b)}function Le(a,b){if("input"===a||"change"===a)return De(b)}ya&&(Fe=oc("input")&&(!document.documentMode||9<document.documentMode));var Me={eventTypes:ye,_isInputEventSupported:Fe,extractEvents:function(a,b,c,d){var e=b?Pd(b):window,f=e.nodeName&&e.nodeName.toLowerCase();if("select"===f||"input"===f&&"file"===e.type)var g=Ee;else if(xe(e))if(Fe)g=Le;else{g=Je;var h=Ie}else(f=e.nodeName)&&"input"===f.toLowerCase()&&("checkbox"===e.type||"radio"===e.type)&&(g=Ke);if(g&&(g=g(a,b)))return ze(g,c,d);h&&h(a,e,b),"blur"===a&&(a=e._wrapperState)&&a.controlled&&"number"===e.type&&Db(e,"number",e.value)}},Ne=G.extend({view:null,detail:null}),Oe={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pe(a){var b=this.nativeEvent;return b.getModifierState?b.getModifierState(a):!!(a=Oe[a])&&!!b[a]}function Qe(){return Pe}var Re=0,Se=0,Te=!1,Ue=!1,Ve=Ne.extend({screenX:null,screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:Qe,button:null,buttons:null,relatedTarget:function(a){return a.relatedTarget||(a.fromElement===a.srcElement?a.toElement:a.fromElement)},movementX:function(a){if("movementX"in a)return a.movementX;var b=Re;return Re=a.screenX,Te?"mousemove"===a.type?a.screenX-b:0:(Te=!0,0)},movementY:function(a){if("movementY"in a)return a.movementY;var b=Se;return Se=a.screenY,Ue?"mousemove"===a.type?a.screenY-b:0:(Ue=!0,0)}}),We=Ve.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),Xe={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout","pointerover"]}},Ye={eventTypes:Xe,extractEvents:function(a,b,c,d,e){var f="mouseover"===a||"pointerover"===a,g="mouseout"===a||"pointerout"===a;if(f&&0==(32&e)&&(c.relatedTarget||c.fromElement)||!g&&!f)return null;(f=d.window===d?d:(f=d.ownerDocument)?f.defaultView||f.parentWindow:window,g)?(g=b,null!==(b=(b=c.relatedTarget||c.toElement)?tc(b):null)&&(b!==dc(b)||5!==b.tag&&6!==b.tag)&&(b=null)):g=null;if(g===b)return null;if("mouseout"===a||"mouseover"===a)var k=Ve,l=Xe.mouseLeave,m=Xe.mouseEnter,p="mouse";else"pointerout"!==a&&"pointerover"!==a||(k=We,l=Xe.pointerLeave,m=Xe.pointerEnter,p="pointer");if(a=null==g?f:Pd(g),f=null==b?f:Pd(b),(l=k.getPooled(l,g,c,d)).type=p+"leave",l.target=a,l.relatedTarget=f,(c=k.getPooled(m,b,c,d)).type=p+"enter",c.target=f,c.relatedTarget=a,p=b,(d=g)&&p)a:{for(m=p,g=0,a=k=d;a;a=Rd(a))g++;for(a=0,b=m;b;b=Rd(b))a++;for(;0<g-a;)k=Rd(k),g--;for(;0<a-g;)m=Rd(m),a--;for(;g--;){if(k===m||k===m.alternate)break a;k=Rd(k),m=Rd(m)}k=null}else k=null;for(m=k,k=[];d&&d!==m&&(null===(g=d.alternate)||g!==m);)k.push(d),d=Rd(d);for(d=[];p&&p!==m&&(null===(g=p.alternate)||g!==m);)d.push(p),p=Rd(p);for(p=0;p<k.length;p++)Vd(k[p],"bubbled",l);for(p=d.length;0<p--;)Vd(d[p],"captured",c);return 0==(64&e)?[l]:[l,c]}};var $e="function"==typeof Object.is?Object.is:function(a,b){return a===b&&(0!==a||1/a==1/b)||a!=a&&b!=b},af=Object.prototype.hasOwnProperty;function bf(a,b){if($e(a,b))return!0;if("object"!=typeof a||null===a||"object"!=typeof b||null===b)return!1;var c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++)if(!af.call(b,c[d])||!$e(a[c[d]],b[c[d]]))return!1;return!0}var cf=ya&&"documentMode"in document&&11>=document.documentMode,df={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},ef=null,ff=null,gf=null,hf=!1;function jf(a,b){var c=b.window===b?b.document:9===b.nodeType?b:b.ownerDocument;return hf||null==ef||ef!==td(c)?null:("selectionStart"in(c=ef)&&yd(c)?c={start:c.selectionStart,end:c.selectionEnd}:c={anchorNode:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset},gf&&bf(gf,c)?null:(gf=c,(a=G.getPooled(df.select,ff,a,b)).type="select",a.target=ef,Xd(a),a))}var kf={eventTypes:df,extractEvents:function(a,b,c,d,e,f){if(!(f=!(e=f||(d.window===d?d.document:9===d.nodeType?d:d.ownerDocument)))){a:{e=cc(e),f=wa.onSelect;for(var g=0;g<f.length;g++)if(!e.has(f[g])){e=!1;break a}e=!0}f=!e}if(f)return null;switch(e=b?Pd(b):window,a){case"focus":(xe(e)||"true"===e.contentEditable)&&(ef=e,ff=b,gf=null);break;case"blur":gf=ff=ef=null;break;case"mousedown":hf=!0;break;case"contextmenu":case"mouseup":case"dragend":return hf=!1,jf(c,d);case"selectionchange":if(cf)break;case"keydown":case"keyup":return jf(c,d)}return null}},lf=G.extend({animationName:null,elapsedTime:null,pseudoElement:null}),mf=G.extend({clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),nf=Ne.extend({relatedTarget:null});function of(a){var b=a.keyCode;return"charCode"in a?0===(a=a.charCode)&&13===b&&(a=13):a=b,10===a&&(a=13),32<=a||13===a?a:0}var pf={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},qf={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},rf=Ne.extend({key:function(a){if(a.key){var b=pf[a.key]||a.key;if("Unidentified"!==b)return b}return"keypress"===a.type?13===(a=of(a))?"Enter":String.fromCharCode(a):"keydown"===a.type||"keyup"===a.type?qf[a.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:Qe,charCode:function(a){return"keypress"===a.type?of(a):0},keyCode:function(a){return"keydown"===a.type||"keyup"===a.type?a.keyCode:0},which:function(a){return"keypress"===a.type?of(a):"keydown"===a.type||"keyup"===a.type?a.keyCode:0}}),sf=Ve.extend({dataTransfer:null}),tf=Ne.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:Qe}),uf=G.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),vf=Ve.extend({deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:null,deltaMode:null}),wf={eventTypes:Wc,extractEvents:function(a,b,c,d){var e=Yc.get(a);if(!e)return null;switch(a){case"keypress":if(0===of(c))return null;case"keydown":case"keyup":a=rf;break;case"blur":case"focus":a=nf;break;case"click":if(2===c.button)return null;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":a=Ve;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":a=sf;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":a=tf;break;case Xb:case Yb:case Zb:a=lf;break;case $b:a=uf;break;case"scroll":a=Ne;break;case"wheel":a=vf;break;case"copy":case"cut":case"paste":a=mf;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":a=We;break;default:a=G}return Xd(b=a.getPooled(e,b,c,d)),b}};if(pa)throw Error(u(101));pa=Array.prototype.slice.call("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" ")),ra(),la=Qd,ma=Nc,na=Pd,xa({SimpleEventPlugin:wf,EnterLeaveEventPlugin:Ye,ChangeEventPlugin:Me,SelectEventPlugin:kf,BeforeInputEventPlugin:ve});var yf=[],zf=-1;function H(a){0>zf||(a.current=yf[zf],yf[zf]=null,zf--)}function I(a,b){zf++,yf[zf]=a.current,a.current=b}var Af={},J={current:Af},K={current:!1},Bf=Af;function Cf(a,b){var c=a.type.contextTypes;if(!c)return Af;var d=a.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===b)return d.__reactInternalMemoizedMaskedChildContext;var f,e={};for(f in c)e[f]=b[f];return d&&((a=a.stateNode).__reactInternalMemoizedUnmaskedChildContext=b,a.__reactInternalMemoizedMaskedChildContext=e),e}function L(a){return null!=(a=a.childContextTypes)}function Df(){H(K),H(J)}function Ef(a,b,c){if(J.current!==Af)throw Error(u(168));I(J,b),I(K,c)}function Ff(a,b,c){var d=a.stateNode;if(a=b.childContextTypes,"function"!=typeof d.getChildContext)return c;for(var e in d=d.getChildContext())if(!(e in a))throw Error(u(108,pb(b)||"Unknown",e));return n({},c,{},d)}function Gf(a){return a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||Af,Bf=J.current,I(J,a),I(K,K.current),!0}function Hf(a,b,c){var d=a.stateNode;if(!d)throw Error(u(169));c?(a=Ff(a,b,Bf),d.__reactInternalMemoizedMergedChildContext=a,H(K),H(J),I(J,a)):H(K),I(K,c)}var If=r.unstable_runWithPriority,Jf=r.unstable_scheduleCallback,Kf=r.unstable_cancelCallback,Lf=r.unstable_requestPaint,Mf=r.unstable_now,Nf=r.unstable_getCurrentPriorityLevel,Of=r.unstable_ImmediatePriority,Pf=r.unstable_UserBlockingPriority,Qf=r.unstable_NormalPriority,Rf=r.unstable_LowPriority,Sf=r.unstable_IdlePriority,Tf={},Uf=r.unstable_shouldYield,Vf=void 0!==Lf?Lf:function(){},Wf=null,Xf=null,Yf=!1,Zf=Mf(),$f=1e4>Zf?Mf:function(){return Mf()-Zf};function ag(){switch(Nf()){case Of:return 99;case Pf:return 98;case Qf:return 97;case Rf:return 96;case Sf:return 95;default:throw Error(u(332))}}function bg(a){switch(a){case 99:return Of;case 98:return Pf;case 97:return Qf;case 96:return Rf;case 95:return Sf;default:throw Error(u(332))}}function cg(a,b){return a=bg(a),If(a,b)}function dg(a,b,c){return a=bg(a),Jf(a,b,c)}function eg(a){return null===Wf?(Wf=[a],Xf=Jf(Of,fg)):Wf.push(a),Tf}function gg(){if(null!==Xf){var a=Xf;Xf=null,Kf(a)}fg()}function fg(){if(!Yf&&null!==Wf){Yf=!0;var a=0;try{var b=Wf;cg(99,(function(){for(;a<b.length;a++){var c=b[a];do{c=c(!0)}while(null!==c)}})),Wf=null}catch(c){throw null!==Wf&&(Wf=Wf.slice(a+1)),Jf(Of,gg),c}finally{Yf=!1}}}function hg(a,b,c){return 1073741821-(1+((1073741821-a+b/10)/(c/=10)|0))*c}function ig(a,b){if(a&&a.defaultProps)for(var c in b=n({},b),a=a.defaultProps)void 0===b[c]&&(b[c]=a[c]);return b}var jg={current:null},kg=null,lg=null,mg=null;function ng(){mg=lg=kg=null}function og(a){var b=jg.current;H(jg),a.type._context._currentValue=b}function pg(a,b){for(;null!==a;){var c=a.alternate;if(a.childExpirationTime<b)a.childExpirationTime=b,null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b);else{if(!(null!==c&&c.childExpirationTime<b))break;c.childExpirationTime=b}a=a.return}}function qg(a,b){kg=a,mg=lg=null,null!==(a=a.dependencies)&&null!==a.firstContext&&(a.expirationTime>=b&&(rg=!0),a.firstContext=null)}function sg(a,b){if(mg!==a&&!1!==b&&0!==b)if("number"==typeof b&&1073741823!==b||(mg=a,b=1073741823),b={context:a,observedBits:b,next:null},null===lg){if(null===kg)throw Error(u(308));lg=b,kg.dependencies={expirationTime:0,firstContext:b,responders:null}}else lg=lg.next=b;return a._currentValue}var tg=!1;function ug(a){a.updateQueue={baseState:a.memoizedState,baseQueue:null,shared:{pending:null},effects:null}}function vg(a,b){a=a.updateQueue,b.updateQueue===a&&(b.updateQueue={baseState:a.baseState,baseQueue:a.baseQueue,shared:a.shared,effects:a.effects})}function wg(a,b){return(a={expirationTime:a,suspenseConfig:b,tag:0,payload:null,callback:null,next:null}).next=a}function xg(a,b){if(null!==(a=a.updateQueue)){var c=(a=a.shared).pending;null===c?b.next=b:(b.next=c.next,c.next=b),a.pending=b}}function yg(a,b){var c=a.alternate;null!==c&&vg(c,a),null===(c=(a=a.updateQueue).baseQueue)?(a.baseQueue=b.next=b,b.next=b):(b.next=c.next,c.next=b)}function zg(a,b,c,d){var e=a.updateQueue;tg=!1;var f=e.baseQueue,g=e.shared.pending;if(null!==g){if(null!==f){var h=f.next;f.next=g.next,g.next=h}f=g,e.shared.pending=null,null!==(h=a.alternate)&&(null!==(h=h.updateQueue)&&(h.baseQueue=g))}if(null!==f){h=f.next;var k=e.baseState,l=0,m=null,p=null,x=null;if(null!==h)for(var z=h;;){if((g=z.expirationTime)<d){var ca={expirationTime:z.expirationTime,suspenseConfig:z.suspenseConfig,tag:z.tag,payload:z.payload,callback:z.callback,next:null};null===x?(p=x=ca,m=k):x=x.next=ca,g>l&&(l=g)}else{null!==x&&(x=x.next={expirationTime:1073741823,suspenseConfig:z.suspenseConfig,tag:z.tag,payload:z.payload,callback:z.callback,next:null}),Ag(g,z.suspenseConfig);a:{var D=a,t=z;switch(g=b,ca=c,t.tag){case 1:if("function"==typeof(D=t.payload)){k=D.call(ca,k,g);break a}k=D;break a;case 3:D.effectTag=-4097&D.effectTag|64;case 0:if(null==(g="function"==typeof(D=t.payload)?D.call(ca,k,g):D))break a;k=n({},k,g);break a;case 2:tg=!0}}null!==z.callback&&(a.effectTag|=32,null===(g=e.effects)?e.effects=[z]:g.push(z))}if(null===(z=z.next)||z===h){if(null===(g=e.shared.pending))break;z=f.next=g.next,g.next=h,e.baseQueue=f=g,e.shared.pending=null}}null===x?m=k:x.next=p,e.baseState=m,e.baseQueue=x,Bg(l),a.expirationTime=l,a.memoizedState=k}}function Cg(a,b,c){if(a=b.effects,b.effects=null,null!==a)for(b=0;b<a.length;b++){var d=a[b],e=d.callback;if(null!==e){if(d.callback=null,d=e,e=c,"function"!=typeof d)throw Error(u(191,d));d.call(e)}}}var Dg=Wa.ReactCurrentBatchConfig,Eg=(new aa.Component).refs;function Fg(a,b,c,d){c=null==(c=c(d,b=a.memoizedState))?b:n({},b,c),a.memoizedState=c,0===a.expirationTime&&(a.updateQueue.baseState=c)}var Jg={isMounted:function(a){return!!(a=a._reactInternalFiber)&&dc(a)===a},enqueueSetState:function(a,b,c){a=a._reactInternalFiber;var d=Gg(),e=Dg.suspense;(e=wg(d=Hg(d,a,e),e)).payload=b,null!=c&&(e.callback=c),xg(a,e),Ig(a,d)},enqueueReplaceState:function(a,b,c){a=a._reactInternalFiber;var d=Gg(),e=Dg.suspense;(e=wg(d=Hg(d,a,e),e)).tag=1,e.payload=b,null!=c&&(e.callback=c),xg(a,e),Ig(a,d)},enqueueForceUpdate:function(a,b){a=a._reactInternalFiber;var c=Gg(),d=Dg.suspense;(d=wg(c=Hg(c,a,d),d)).tag=2,null!=b&&(d.callback=b),xg(a,d),Ig(a,c)}};function Kg(a,b,c,d,e,f,g){return"function"==typeof(a=a.stateNode).shouldComponentUpdate?a.shouldComponentUpdate(d,f,g):!b.prototype||!b.prototype.isPureReactComponent||(!bf(c,d)||!bf(e,f))}function Lg(a,b,c){var d=!1,e=Af,f=b.contextType;return"object"==typeof f&&null!==f?f=sg(f):(e=L(b)?Bf:J.current,f=(d=null!=(d=b.contextTypes))?Cf(a,e):Af),b=new b(c,f),a.memoizedState=null!==b.state&&void 0!==b.state?b.state:null,b.updater=Jg,a.stateNode=b,b._reactInternalFiber=a,d&&((a=a.stateNode).__reactInternalMemoizedUnmaskedChildContext=e,a.__reactInternalMemoizedMaskedChildContext=f),b}function Mg(a,b,c,d){a=b.state,"function"==typeof b.componentWillReceiveProps&&b.componentWillReceiveProps(c,d),"function"==typeof b.UNSAFE_componentWillReceiveProps&&b.UNSAFE_componentWillReceiveProps(c,d),b.state!==a&&Jg.enqueueReplaceState(b,b.state,null)}function Ng(a,b,c,d){var e=a.stateNode;e.props=c,e.state=a.memoizedState,e.refs=Eg,ug(a);var f=b.contextType;"object"==typeof f&&null!==f?e.context=sg(f):(f=L(b)?Bf:J.current,e.context=Cf(a,f)),zg(a,c,e,d),e.state=a.memoizedState,"function"==typeof(f=b.getDerivedStateFromProps)&&(Fg(a,b,f,c),e.state=a.memoizedState),"function"==typeof b.getDerivedStateFromProps||"function"==typeof e.getSnapshotBeforeUpdate||"function"!=typeof e.UNSAFE_componentWillMount&&"function"!=typeof e.componentWillMount||(b=e.state,"function"==typeof e.componentWillMount&&e.componentWillMount(),"function"==typeof e.UNSAFE_componentWillMount&&e.UNSAFE_componentWillMount(),b!==e.state&&Jg.enqueueReplaceState(e,e.state,null),zg(a,c,e,d),e.state=a.memoizedState),"function"==typeof e.componentDidMount&&(a.effectTag|=4)}var Og=Array.isArray;function Pg(a,b,c){if(null!==(a=c.ref)&&"function"!=typeof a&&"object"!=typeof a){if(c._owner){if(c=c._owner){if(1!==c.tag)throw Error(u(309));var d=c.stateNode}if(!d)throw Error(u(147,a));var e=""+a;return null!==b&&null!==b.ref&&"function"==typeof b.ref&&b.ref._stringRef===e?b.ref:((b=function(a){var b=d.refs;b===Eg&&(b=d.refs={}),null===a?delete b[e]:b[e]=a})._stringRef=e,b)}if("string"!=typeof a)throw Error(u(284));if(!c._owner)throw Error(u(290,a))}return a}function Qg(a,b){if("textarea"!==a.type)throw Error(u(31,"[object Object]"===Object.prototype.toString.call(b)?"object with keys {"+Object.keys(b).join(", ")+"}":b,""))}function Rg(a){function b(b,c){if(a){var d=b.lastEffect;null!==d?(d.nextEffect=c,b.lastEffect=c):b.firstEffect=b.lastEffect=c,c.nextEffect=null,c.effectTag=8}}function c(c,d){if(!a)return null;for(;null!==d;)b(c,d),d=d.sibling;return null}function d(a,b){for(a=new Map;null!==b;)null!==b.key?a.set(b.key,b):a.set(b.index,b),b=b.sibling;return a}function e(a,b){return(a=Sg(a,b)).index=0,a.sibling=null,a}function f(b,c,d){return b.index=d,a?null!==(d=b.alternate)?(d=d.index)<c?(b.effectTag=2,c):d:(b.effectTag=2,c):c}function g(b){return a&&null===b.alternate&&(b.effectTag=2),b}function h(a,b,c,d){return null===b||6!==b.tag?((b=Tg(c,a.mode,d)).return=a,b):((b=e(b,c)).return=a,b)}function k(a,b,c,d){return null!==b&&b.elementType===c.type?((d=e(b,c.props)).ref=Pg(a,b,c),d.return=a,d):((d=Ug(c.type,c.key,c.props,null,a.mode,d)).ref=Pg(a,b,c),d.return=a,d)}function l(a,b,c,d){return null===b||4!==b.tag||b.stateNode.containerInfo!==c.containerInfo||b.stateNode.implementation!==c.implementation?((b=Vg(c,a.mode,d)).return=a,b):((b=e(b,c.children||[])).return=a,b)}function m(a,b,c,d,f){return null===b||7!==b.tag?((b=Wg(c,a.mode,d,f)).return=a,b):((b=e(b,c)).return=a,b)}function p(a,b,c){if("string"==typeof b||"number"==typeof b)return(b=Tg(""+b,a.mode,c)).return=a,b;if("object"==typeof b&&null!==b){switch(b.$$typeof){case Za:return(c=Ug(b.type,b.key,b.props,null,a.mode,c)).ref=Pg(a,null,b),c.return=a,c;case $a:return(b=Vg(b,a.mode,c)).return=a,b}if(Og(b)||nb(b))return(b=Wg(b,a.mode,c,null)).return=a,b;Qg(a,b)}return null}function x(a,b,c,d){var e=null!==b?b.key:null;if("string"==typeof c||"number"==typeof c)return null!==e?null:h(a,b,""+c,d);if("object"==typeof c&&null!==c){switch(c.$$typeof){case Za:return c.key===e?c.type===ab?m(a,b,c.props.children,d,e):k(a,b,c,d):null;case $a:return c.key===e?l(a,b,c,d):null}if(Og(c)||nb(c))return null!==e?null:m(a,b,c,d,null);Qg(a,c)}return null}function z(a,b,c,d,e){if("string"==typeof d||"number"==typeof d)return h(b,a=a.get(c)||null,""+d,e);if("object"==typeof d&&null!==d){switch(d.$$typeof){case Za:return a=a.get(null===d.key?c:d.key)||null,d.type===ab?m(b,a,d.props.children,e,d.key):k(b,a,d,e);case $a:return l(b,a=a.get(null===d.key?c:d.key)||null,d,e)}if(Og(d)||nb(d))return m(b,a=a.get(c)||null,d,e,null);Qg(b,d)}return null}function ca(e,g,h,k){for(var l=null,t=null,m=g,y=g=0,A=null;null!==m&&y<h.length;y++){m.index>y?(A=m,m=null):A=m.sibling;var q=x(e,m,h[y],k);if(null===q){null===m&&(m=A);break}a&&m&&null===q.alternate&&b(e,m),g=f(q,g,y),null===t?l=q:t.sibling=q,t=q,m=A}if(y===h.length)return c(e,m),l;if(null===m){for(;y<h.length;y++)null!==(m=p(e,h[y],k))&&(g=f(m,g,y),null===t?l=m:t.sibling=m,t=m);return l}for(m=d(e,m);y<h.length;y++)null!==(A=z(m,e,y,h[y],k))&&(a&&null!==A.alternate&&m.delete(null===A.key?y:A.key),g=f(A,g,y),null===t?l=A:t.sibling=A,t=A);return a&&m.forEach((function(a){return b(e,a)})),l}function D(e,g,h,l){var k=nb(h);if("function"!=typeof k)throw Error(u(150));if(null==(h=k.call(h)))throw Error(u(151));for(var m=k=null,t=g,y=g=0,A=null,q=h.next();null!==t&&!q.done;y++,q=h.next()){t.index>y?(A=t,t=null):A=t.sibling;var D=x(e,t,q.value,l);if(null===D){null===t&&(t=A);break}a&&t&&null===D.alternate&&b(e,t),g=f(D,g,y),null===m?k=D:m.sibling=D,m=D,t=A}if(q.done)return c(e,t),k;if(null===t){for(;!q.done;y++,q=h.next())null!==(q=p(e,q.value,l))&&(g=f(q,g,y),null===m?k=q:m.sibling=q,m=q);return k}for(t=d(e,t);!q.done;y++,q=h.next())null!==(q=z(t,e,y,q.value,l))&&(a&&null!==q.alternate&&t.delete(null===q.key?y:q.key),g=f(q,g,y),null===m?k=q:m.sibling=q,m=q);return a&&t.forEach((function(a){return b(e,a)})),k}return function(a,d,f,h){var k="object"==typeof f&&null!==f&&f.type===ab&&null===f.key;k&&(f=f.props.children);var l="object"==typeof f&&null!==f;if(l)switch(f.$$typeof){case Za:a:{for(l=f.key,k=d;null!==k;){if(k.key===l){switch(k.tag){case 7:if(f.type===ab){c(a,k.sibling),(d=e(k,f.props.children)).return=a,a=d;break a}break;default:if(k.elementType===f.type){c(a,k.sibling),(d=e(k,f.props)).ref=Pg(a,k,f),d.return=a,a=d;break a}}c(a,k);break}b(a,k),k=k.sibling}f.type===ab?((d=Wg(f.props.children,a.mode,h,f.key)).return=a,a=d):((h=Ug(f.type,f.key,f.props,null,a.mode,h)).ref=Pg(a,d,f),h.return=a,a=h)}return g(a);case $a:a:{for(k=f.key;null!==d;){if(d.key===k){if(4===d.tag&&d.stateNode.containerInfo===f.containerInfo&&d.stateNode.implementation===f.implementation){c(a,d.sibling),(d=e(d,f.children||[])).return=a,a=d;break a}c(a,d);break}b(a,d),d=d.sibling}(d=Vg(f,a.mode,h)).return=a,a=d}return g(a)}if("string"==typeof f||"number"==typeof f)return f=""+f,null!==d&&6===d.tag?(c(a,d.sibling),(d=e(d,f)).return=a,a=d):(c(a,d),(d=Tg(f,a.mode,h)).return=a,a=d),g(a);if(Og(f))return ca(a,d,f,h);if(nb(f))return D(a,d,f,h);if(l&&Qg(a,f),void 0===f&&!k)switch(a.tag){case 1:case 0:throw a=a.type,Error(u(152,a.displayName||a.name||"Component"))}return c(a,d)}}var Xg=Rg(!0),Yg=Rg(!1),Zg={},$g={current:Zg},ah={current:Zg},bh={current:Zg};function ch(a){if(a===Zg)throw Error(u(174));return a}function dh(a,b){switch(I(bh,b),I(ah,a),I($g,Zg),a=b.nodeType){case 9:case 11:b=(b=b.documentElement)?b.namespaceURI:Ob(null,"");break;default:b=Ob(b=(a=8===a?b.parentNode:b).namespaceURI||null,a=a.tagName)}H($g),I($g,b)}function eh(){H($g),H(ah),H(bh)}function fh(a){ch(bh.current);var b=ch($g.current),c=Ob(b,a.type);b!==c&&(I(ah,a),I($g,c))}function gh(a){ah.current===a&&(H($g),H(ah))}var M={current:0};function hh(a){for(var b=a;null!==b;){if(13===b.tag){var c=b.memoizedState;if(null!==c&&(null===(c=c.dehydrated)||"$?"===c.data||"$!"===c.data))return b}else if(19===b.tag&&void 0!==b.memoizedProps.revealOrder){if(0!=(64&b.effectTag))return b}else if(null!==b.child){b.child.return=b,b=b.child;continue}if(b===a)break;for(;null===b.sibling;){if(null===b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return,b=b.sibling}return null}function ih(a,b){return{responder:a,props:b}}var jh=Wa.ReactCurrentDispatcher,kh=Wa.ReactCurrentBatchConfig,lh=0,N=null,O=null,P=null,mh=!1;function Q(){throw Error(u(321))}function nh(a,b){if(null===b)return!1;for(var c=0;c<b.length&&c<a.length;c++)if(!$e(a[c],b[c]))return!1;return!0}function oh(a,b,c,d,e,f){if(lh=f,N=b,b.memoizedState=null,b.updateQueue=null,b.expirationTime=0,jh.current=null===a||null===a.memoizedState?ph:qh,a=c(d,e),b.expirationTime===lh){f=0;do{if(b.expirationTime=0,!(25>f))throw Error(u(301));f+=1,P=O=null,b.updateQueue=null,jh.current=rh,a=c(d,e)}while(b.expirationTime===lh)}if(jh.current=sh,b=null!==O&&null!==O.next,lh=0,P=O=N=null,mh=!1,b)throw Error(u(300));return a}function th(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===P?N.memoizedState=P=a:P=P.next=a,P}function uh(){if(null===O){var a=N.alternate;a=null!==a?a.memoizedState:null}else a=O.next;var b=null===P?N.memoizedState:P.next;if(null!==b)P=b,O=a;else{if(null===a)throw Error(u(310));a={memoizedState:(O=a).memoizedState,baseState:O.baseState,baseQueue:O.baseQueue,queue:O.queue,next:null},null===P?N.memoizedState=P=a:P=P.next=a}return P}function vh(a,b){return"function"==typeof b?b(a):b}function wh(a){var b=uh(),c=b.queue;if(null===c)throw Error(u(311));c.lastRenderedReducer=a;var d=O,e=d.baseQueue,f=c.pending;if(null!==f){if(null!==e){var g=e.next;e.next=f.next,f.next=g}d.baseQueue=e=f,c.pending=null}if(null!==e){e=e.next,d=d.baseState;var h=g=f=null,k=e;do{var l=k.expirationTime;if(l<lh){var m={expirationTime:k.expirationTime,suspenseConfig:k.suspenseConfig,action:k.action,eagerReducer:k.eagerReducer,eagerState:k.eagerState,next:null};null===h?(g=h=m,f=d):h=h.next=m,l>N.expirationTime&&(N.expirationTime=l,Bg(l))}else null!==h&&(h=h.next={expirationTime:1073741823,suspenseConfig:k.suspenseConfig,action:k.action,eagerReducer:k.eagerReducer,eagerState:k.eagerState,next:null}),Ag(l,k.suspenseConfig),d=k.eagerReducer===a?k.eagerState:a(d,k.action);k=k.next}while(null!==k&&k!==e);null===h?f=d:h.next=g,$e(d,b.memoizedState)||(rg=!0),b.memoizedState=d,b.baseState=f,b.baseQueue=h,c.lastRenderedState=d}return[b.memoizedState,c.dispatch]}function xh(a){var b=uh(),c=b.queue;if(null===c)throw Error(u(311));c.lastRenderedReducer=a;var d=c.dispatch,e=c.pending,f=b.memoizedState;if(null!==e){c.pending=null;var g=e=e.next;do{f=a(f,g.action),g=g.next}while(g!==e);$e(f,b.memoizedState)||(rg=!0),b.memoizedState=f,null===b.baseQueue&&(b.baseState=f),c.lastRenderedState=f}return[f,d]}function yh(a){var b=th();return"function"==typeof a&&(a=a()),b.memoizedState=b.baseState=a,a=(a=b.queue={pending:null,dispatch:null,lastRenderedReducer:vh,lastRenderedState:a}).dispatch=zh.bind(null,N,a),[b.memoizedState,a]}function Ah(a,b,c,d){return a={tag:a,create:b,destroy:c,deps:d,next:null},null===(b=N.updateQueue)?(b={lastEffect:null},N.updateQueue=b,b.lastEffect=a.next=a):null===(c=b.lastEffect)?b.lastEffect=a.next=a:(d=c.next,c.next=a,a.next=d,b.lastEffect=a),a}function Bh(){return uh().memoizedState}function Ch(a,b,c,d){var e=th();N.effectTag|=a,e.memoizedState=Ah(1|b,c,void 0,void 0===d?null:d)}function Dh(a,b,c,d){var e=uh();d=void 0===d?null:d;var f=void 0;if(null!==O){var g=O.memoizedState;if(f=g.destroy,null!==d&&nh(d,g.deps))return void Ah(b,c,f,d)}N.effectTag|=a,e.memoizedState=Ah(1|b,c,f,d)}function Eh(a,b){return Ch(516,4,a,b)}function Fh(a,b){return Dh(516,4,a,b)}function Gh(a,b){return Dh(4,2,a,b)}function Hh(a,b){return"function"==typeof b?(a=a(),b(a),function(){b(null)}):null!=b?(a=a(),b.current=a,function(){b.current=null}):void 0}function Ih(a,b,c){return c=null!=c?c.concat([a]):null,Dh(4,2,Hh.bind(null,b,a),c)}function Jh(){}function Kh(a,b){return th().memoizedState=[a,void 0===b?null:b],a}function Lh(a,b){var c=uh();b=void 0===b?null:b;var d=c.memoizedState;return null!==d&&null!==b&&nh(b,d[1])?d[0]:(c.memoizedState=[a,b],a)}function Mh(a,b){var c=uh();b=void 0===b?null:b;var d=c.memoizedState;return null!==d&&null!==b&&nh(b,d[1])?d[0]:(a=a(),c.memoizedState=[a,b],a)}function Nh(a,b,c){var d=ag();cg(98>d?98:d,(function(){a(!0)})),cg(97<d?97:d,(function(){var d=kh.suspense;kh.suspense=void 0===b?null:b;try{a(!1),c()}finally{kh.suspense=d}}))}function zh(a,b,c){var d=Gg(),e=Dg.suspense;e={expirationTime:d=Hg(d,a,e),suspenseConfig:e,action:c,eagerReducer:null,eagerState:null,next:null};var f=b.pending;if(null===f?e.next=e:(e.next=f.next,f.next=e),b.pending=e,f=a.alternate,a===N||null!==f&&f===N)mh=!0,e.expirationTime=lh,N.expirationTime=lh;else{if(0===a.expirationTime&&(null===f||0===f.expirationTime)&&null!==(f=b.lastRenderedReducer))try{var g=b.lastRenderedState,h=f(g,c);if(e.eagerReducer=f,e.eagerState=h,$e(h,g))return}catch(k){}Ig(a,d)}}var sh={readContext:sg,useCallback:Q,useContext:Q,useEffect:Q,useImperativeHandle:Q,useLayoutEffect:Q,useMemo:Q,useReducer:Q,useRef:Q,useState:Q,useDebugValue:Q,useResponder:Q,useDeferredValue:Q,useTransition:Q},ph={readContext:sg,useCallback:Kh,useContext:sg,useEffect:Eh,useImperativeHandle:function(a,b,c){return c=null!=c?c.concat([a]):null,Ch(4,2,Hh.bind(null,b,a),c)},useLayoutEffect:function(a,b){return Ch(4,2,a,b)},useMemo:function(a,b){var c=th();return b=void 0===b?null:b,a=a(),c.memoizedState=[a,b],a},useReducer:function(a,b,c){var d=th();return b=void 0!==c?c(b):b,d.memoizedState=d.baseState=b,a=(a=d.queue={pending:null,dispatch:null,lastRenderedReducer:a,lastRenderedState:b}).dispatch=zh.bind(null,N,a),[d.memoizedState,a]},useRef:function(a){return a={current:a},th().memoizedState=a},useState:yh,useDebugValue:Jh,useResponder:ih,useDeferredValue:function(a,b){var c=yh(a),d=c[0],e=c[1];return Eh((function(){var c=kh.suspense;kh.suspense=void 0===b?null:b;try{e(a)}finally{kh.suspense=c}}),[a,b]),d},useTransition:function(a){var b=yh(!1),c=b[0];return b=b[1],[Kh(Nh.bind(null,b,a),[b,a]),c]}},qh={readContext:sg,useCallback:Lh,useContext:sg,useEffect:Fh,useImperativeHandle:Ih,useLayoutEffect:Gh,useMemo:Mh,useReducer:wh,useRef:Bh,useState:function(){return wh(vh)},useDebugValue:Jh,useResponder:ih,useDeferredValue:function(a,b){var c=wh(vh),d=c[0],e=c[1];return Fh((function(){var c=kh.suspense;kh.suspense=void 0===b?null:b;try{e(a)}finally{kh.suspense=c}}),[a,b]),d},useTransition:function(a){var b=wh(vh),c=b[0];return b=b[1],[Lh(Nh.bind(null,b,a),[b,a]),c]}},rh={readContext:sg,useCallback:Lh,useContext:sg,useEffect:Fh,useImperativeHandle:Ih,useLayoutEffect:Gh,useMemo:Mh,useReducer:xh,useRef:Bh,useState:function(){return xh(vh)},useDebugValue:Jh,useResponder:ih,useDeferredValue:function(a,b){var c=xh(vh),d=c[0],e=c[1];return Fh((function(){var c=kh.suspense;kh.suspense=void 0===b?null:b;try{e(a)}finally{kh.suspense=c}}),[a,b]),d},useTransition:function(a){var b=xh(vh),c=b[0];return b=b[1],[Lh(Nh.bind(null,b,a),[b,a]),c]}},Oh=null,Ph=null,Qh=!1;function Rh(a,b){var c=Sh(5,null,null,0);c.elementType="DELETED",c.type="DELETED",c.stateNode=b,c.return=a,c.effectTag=8,null!==a.lastEffect?(a.lastEffect.nextEffect=c,a.lastEffect=c):a.firstEffect=a.lastEffect=c}function Th(a,b){switch(a.tag){case 5:var c=a.type;return null!==(b=1!==b.nodeType||c.toLowerCase()!==b.nodeName.toLowerCase()?null:b)&&(a.stateNode=b,!0);case 6:return null!==(b=""===a.pendingProps||3!==b.nodeType?null:b)&&(a.stateNode=b,!0);case 13:default:return!1}}function Uh(a){if(Qh){var b=Ph;if(b){var c=b;if(!Th(a,b)){if(!(b=Jd(c.nextSibling))||!Th(a,b))return a.effectTag=-1025&a.effectTag|2,Qh=!1,void(Oh=a);Rh(Oh,c)}Oh=a,Ph=Jd(b.firstChild)}else a.effectTag=-1025&a.effectTag|2,Qh=!1,Oh=a}}function Vh(a){for(a=a.return;null!==a&&5!==a.tag&&3!==a.tag&&13!==a.tag;)a=a.return;Oh=a}function Wh(a){if(a!==Oh)return!1;if(!Qh)return Vh(a),Qh=!0,!1;var b=a.type;if(5!==a.tag||"head"!==b&&"body"!==b&&!Gd(b,a.memoizedProps))for(b=Ph;b;)Rh(a,b),b=Jd(b.nextSibling);if(Vh(a),13===a.tag){if(!(a=null!==(a=a.memoizedState)?a.dehydrated:null))throw Error(u(317));a:{for(a=a.nextSibling,b=0;a;){if(8===a.nodeType){var c=a.data;if("/$"===c){if(0===b){Ph=Jd(a.nextSibling);break a}b--}else"$"!==c&&"$!"!==c&&"$?"!==c||b++}a=a.nextSibling}Ph=null}}else Ph=Oh?Jd(a.stateNode.nextSibling):null;return!0}function Xh(){Ph=Oh=null,Qh=!1}var Yh=Wa.ReactCurrentOwner,rg=!1;function R(a,b,c,d){b.child=null===a?Yg(b,null,c,d):Xg(b,a.child,c,d)}function Zh(a,b,c,d,e){c=c.render;var f=b.ref;return qg(b,e),d=oh(a,b,c,d,f,e),null===a||rg?(b.effectTag|=1,R(a,b,d,e),b.child):(b.updateQueue=a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),$h(a,b,e))}function ai(a,b,c,d,e,f){if(null===a){var g=c.type;return"function"!=typeof g||bi(g)||void 0!==g.defaultProps||null!==c.compare||void 0!==c.defaultProps?((a=Ug(c.type,null,d,null,b.mode,f)).ref=b.ref,a.return=b,b.child=a):(b.tag=15,b.type=g,ci(a,b,g,d,e,f))}return g=a.child,e<f&&(e=g.memoizedProps,(c=null!==(c=c.compare)?c:bf)(e,d)&&a.ref===b.ref)?$h(a,b,f):(b.effectTag|=1,(a=Sg(g,d)).ref=b.ref,a.return=b,b.child=a)}function ci(a,b,c,d,e,f){return null!==a&&bf(a.memoizedProps,d)&&a.ref===b.ref&&(rg=!1,e<f)?(b.expirationTime=a.expirationTime,$h(a,b,f)):di(a,b,c,d,f)}function ei(a,b){var c=b.ref;(null===a&&null!==c||null!==a&&a.ref!==c)&&(b.effectTag|=128)}function di(a,b,c,d,e){var f=L(c)?Bf:J.current;return f=Cf(b,f),qg(b,e),c=oh(a,b,c,d,f,e),null===a||rg?(b.effectTag|=1,R(a,b,c,e),b.child):(b.updateQueue=a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),$h(a,b,e))}function fi(a,b,c,d,e){if(L(c)){var f=!0;Gf(b)}else f=!1;if(qg(b,e),null===b.stateNode)null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),Lg(b,c,d),Ng(b,c,d,e),d=!0;else if(null===a){var g=b.stateNode,h=b.memoizedProps;g.props=h;var k=g.context,l=c.contextType;"object"==typeof l&&null!==l?l=sg(l):l=Cf(b,l=L(c)?Bf:J.current);var m=c.getDerivedStateFromProps,p="function"==typeof m||"function"==typeof g.getSnapshotBeforeUpdate;p||"function"!=typeof g.UNSAFE_componentWillReceiveProps&&"function"!=typeof g.componentWillReceiveProps||(h!==d||k!==l)&&Mg(b,g,d,l),tg=!1;var x=b.memoizedState;g.state=x,zg(b,d,g,e),k=b.memoizedState,h!==d||x!==k||K.current||tg?("function"==typeof m&&(Fg(b,c,m,d),k=b.memoizedState),(h=tg||Kg(b,c,h,d,x,k,l))?(p||"function"!=typeof g.UNSAFE_componentWillMount&&"function"!=typeof g.componentWillMount||("function"==typeof g.componentWillMount&&g.componentWillMount(),"function"==typeof g.UNSAFE_componentWillMount&&g.UNSAFE_componentWillMount()),"function"==typeof g.componentDidMount&&(b.effectTag|=4)):("function"==typeof g.componentDidMount&&(b.effectTag|=4),b.memoizedProps=d,b.memoizedState=k),g.props=d,g.state=k,g.context=l,d=h):("function"==typeof g.componentDidMount&&(b.effectTag|=4),d=!1)}else g=b.stateNode,vg(a,b),h=b.memoizedProps,g.props=b.type===b.elementType?h:ig(b.type,h),k=g.context,"object"==typeof(l=c.contextType)&&null!==l?l=sg(l):l=Cf(b,l=L(c)?Bf:J.current),(p="function"==typeof(m=c.getDerivedStateFromProps)||"function"==typeof g.getSnapshotBeforeUpdate)||"function"!=typeof g.UNSAFE_componentWillReceiveProps&&"function"!=typeof g.componentWillReceiveProps||(h!==d||k!==l)&&Mg(b,g,d,l),tg=!1,k=b.memoizedState,g.state=k,zg(b,d,g,e),x=b.memoizedState,h!==d||k!==x||K.current||tg?("function"==typeof m&&(Fg(b,c,m,d),x=b.memoizedState),(m=tg||Kg(b,c,h,d,k,x,l))?(p||"function"!=typeof g.UNSAFE_componentWillUpdate&&"function"!=typeof g.componentWillUpdate||("function"==typeof g.componentWillUpdate&&g.componentWillUpdate(d,x,l),"function"==typeof g.UNSAFE_componentWillUpdate&&g.UNSAFE_componentWillUpdate(d,x,l)),"function"==typeof g.componentDidUpdate&&(b.effectTag|=4),"function"==typeof g.getSnapshotBeforeUpdate&&(b.effectTag|=256)):("function"!=typeof g.componentDidUpdate||h===a.memoizedProps&&k===a.memoizedState||(b.effectTag|=4),"function"!=typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&k===a.memoizedState||(b.effectTag|=256),b.memoizedProps=d,b.memoizedState=x),g.props=d,g.state=x,g.context=l,d=m):("function"!=typeof g.componentDidUpdate||h===a.memoizedProps&&k===a.memoizedState||(b.effectTag|=4),"function"!=typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&k===a.memoizedState||(b.effectTag|=256),d=!1);return gi(a,b,c,d,f,e)}function gi(a,b,c,d,e,f){ei(a,b);var g=0!=(64&b.effectTag);if(!d&&!g)return e&&Hf(b,c,!1),$h(a,b,f);d=b.stateNode,Yh.current=b;var h=g&&"function"!=typeof c.getDerivedStateFromError?null:d.render();return b.effectTag|=1,null!==a&&g?(b.child=Xg(b,a.child,null,f),b.child=Xg(b,null,h,f)):R(a,b,h,f),b.memoizedState=d.state,e&&Hf(b,c,!0),b.child}function hi(a){var b=a.stateNode;b.pendingContext?Ef(0,b.pendingContext,b.pendingContext!==b.context):b.context&&Ef(0,b.context,!1),dh(a,b.containerInfo)}var ni,pi,qi,ii={dehydrated:null,retryTime:0};function ji(a,b,c){var h,d=b.mode,e=b.pendingProps,f=M.current,g=!1;if((h=0!=(64&b.effectTag))||(h=0!=(2&f)&&(null===a||null!==a.memoizedState)),h?(g=!0,b.effectTag&=-65):null!==a&&null===a.memoizedState||void 0===e.fallback||!0===e.unstable_avoidThisFallback||(f|=1),I(M,1&f),null===a){if(void 0!==e.fallback&&Uh(b),g){if(g=e.fallback,(e=Wg(null,d,0,null)).return=b,0==(2&b.mode))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==a;)a.return=e,a=a.sibling;return(c=Wg(g,d,c,null)).return=b,e.sibling=c,b.memoizedState=ii,b.child=e,c}return d=e.children,b.memoizedState=null,b.child=Yg(b,null,d,c)}if(null!==a.memoizedState){if(d=(a=a.child).sibling,g){if(e=e.fallback,(c=Sg(a,a.pendingProps)).return=b,0==(2&b.mode)&&(g=null!==b.memoizedState?b.child.child:b.child)!==a.child)for(c.child=g;null!==g;)g.return=c,g=g.sibling;return(d=Sg(d,e)).return=b,c.sibling=d,c.childExpirationTime=0,b.memoizedState=ii,b.child=c,d}return c=Xg(b,a.child,e.children,c),b.memoizedState=null,b.child=c}if(a=a.child,g){if(g=e.fallback,(e=Wg(null,d,0,null)).return=b,e.child=a,null!==a&&(a.return=e),0==(2&b.mode))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==a;)a.return=e,a=a.sibling;return(c=Wg(g,d,c,null)).return=b,e.sibling=c,c.effectTag|=2,e.childExpirationTime=0,b.memoizedState=ii,b.child=e,c}return b.memoizedState=null,b.child=Xg(b,a,e.children,c)}function ki(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b),pg(a.return,b)}function li(a,b,c,d,e,f){var g=a.memoizedState;null===g?a.memoizedState={isBackwards:b,rendering:null,renderingStartTime:0,last:d,tail:c,tailExpiration:0,tailMode:e,lastEffect:f}:(g.isBackwards=b,g.rendering=null,g.renderingStartTime=0,g.last=d,g.tail=c,g.tailExpiration=0,g.tailMode=e,g.lastEffect=f)}function mi(a,b,c){var d=b.pendingProps,e=d.revealOrder,f=d.tail;if(R(a,b,d.children,c),0!=(2&(d=M.current)))d=1&d|2,b.effectTag|=64;else{if(null!==a&&0!=(64&a.effectTag))a:for(a=b.child;null!==a;){if(13===a.tag)null!==a.memoizedState&&ki(a,c);else if(19===a.tag)ki(a,c);else if(null!==a.child){a.child.return=a,a=a.child;continue}if(a===b)break a;for(;null===a.sibling;){if(null===a.return||a.return===b)break a;a=a.return}a.sibling.return=a.return,a=a.sibling}d&=1}if(I(M,d),0==(2&b.mode))b.memoizedState=null;else switch(e){case"forwards":for(c=b.child,e=null;null!==c;)null!==(a=c.alternate)&&null===hh(a)&&(e=c),c=c.sibling;null===(c=e)?(e=b.child,b.child=null):(e=c.sibling,c.sibling=null),li(b,!1,e,c,f,b.lastEffect);break;case"backwards":for(c=null,e=b.child,b.child=null;null!==e;){if(null!==(a=e.alternate)&&null===hh(a)){b.child=e;break}a=e.sibling,e.sibling=c,c=e,e=a}li(b,!0,c,null,f,b.lastEffect);break;case"together":li(b,!1,null,null,void 0,b.lastEffect);break;default:b.memoizedState=null}return b.child}function $h(a,b,c){null!==a&&(b.dependencies=a.dependencies);var d=b.expirationTime;if(0!==d&&Bg(d),b.childExpirationTime<c)return null;if(null!==a&&b.child!==a.child)throw Error(u(153));if(null!==b.child){for(c=Sg(a=b.child,a.pendingProps),b.child=c,c.return=b;null!==a.sibling;)a=a.sibling,(c=c.sibling=Sg(a,a.pendingProps)).return=b;c.sibling=null}return b.child}function ri(a,b){switch(a.tailMode){case"hidden":b=a.tail;for(var c=null;null!==b;)null!==b.alternate&&(c=b),b=b.sibling;null===c?a.tail=null:c.sibling=null;break;case"collapsed":c=a.tail;for(var d=null;null!==c;)null!==c.alternate&&(d=c),c=c.sibling;null===d?b||null===a.tail?a.tail=null:a.tail.sibling=null:d.sibling=null}}function si(a,b,c){var d=b.pendingProps;switch(b.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return L(b.type)&&Df(),null;case 3:return eh(),H(K),H(J),(c=b.stateNode).pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),null!==a&&null!==a.child||!Wh(b)||(b.effectTag|=4),null;case 5:gh(b),c=ch(bh.current);var e=b.type;if(null!==a&&null!=b.stateNode)pi(a,b,e,d,c),a.ref!==b.ref&&(b.effectTag|=128);else{if(!d){if(null===b.stateNode)throw Error(u(166));return null}if(a=ch($g.current),Wh(b)){d=b.stateNode,e=b.type;var f=b.memoizedProps;switch(d[Md]=b,d[Nd]=f,e){case"iframe":case"object":case"embed":F("load",d);break;case"video":case"audio":for(a=0;a<ac.length;a++)F(ac[a],d);break;case"source":F("error",d);break;case"img":case"image":case"link":F("error",d),F("load",d);break;case"form":F("reset",d),F("submit",d);break;case"details":F("toggle",d);break;case"input":Ab(d,f),F("invalid",d),rd(c,"onChange");break;case"select":d._wrapperState={wasMultiple:!!f.multiple},F("invalid",d),rd(c,"onChange");break;case"textarea":Jb(d,f),F("invalid",d),rd(c,"onChange")}for(var g in od(e,f),a=null,f)if(f.hasOwnProperty(g)){var h=f[g];"children"===g?"string"==typeof h?d.textContent!==h&&(a=["children",h]):"number"==typeof h&&d.textContent!==""+h&&(a=["children",""+h]):va.hasOwnProperty(g)&&null!=h&&rd(c,g)}switch(e){case"input":xb(d),Eb(d,f,!0);break;case"textarea":xb(d),Lb(d);break;case"select":case"option":break;default:"function"==typeof f.onClick&&(d.onclick=sd)}c=a,b.updateQueue=c,null!==c&&(b.effectTag|=4)}else{switch(g=9===c.nodeType?c:c.ownerDocument,a===qd&&(a=Nb(e)),a===qd?"script"===e?((a=g.createElement("div")).innerHTML="<script><\/script>",a=a.removeChild(a.firstChild)):"string"==typeof d.is?a=g.createElement(e,{is:d.is}):(a=g.createElement(e),"select"===e&&(g=a,d.multiple?g.multiple=!0:d.size&&(g.size=d.size))):a=g.createElementNS(a,e),a[Md]=b,a[Nd]=d,ni(a,b),b.stateNode=a,g=pd(e,d),e){case"iframe":case"object":case"embed":F("load",a),h=d;break;case"video":case"audio":for(h=0;h<ac.length;h++)F(ac[h],a);h=d;break;case"source":F("error",a),h=d;break;case"img":case"image":case"link":F("error",a),F("load",a),h=d;break;case"form":F("reset",a),F("submit",a),h=d;break;case"details":F("toggle",a),h=d;break;case"input":Ab(a,d),h=zb(a,d),F("invalid",a),rd(c,"onChange");break;case"option":h=Gb(a,d);break;case"select":a._wrapperState={wasMultiple:!!d.multiple},h=n({},d,{value:void 0}),F("invalid",a),rd(c,"onChange");break;case"textarea":Jb(a,d),h=Ib(a,d),F("invalid",a),rd(c,"onChange");break;default:h=d}od(e,h);var k=h;for(f in k)if(k.hasOwnProperty(f)){var l=k[f];"style"===f?md(a,l):"dangerouslySetInnerHTML"===f?null!=(l=l?l.__html:void 0)&&Qb(a,l):"children"===f?"string"==typeof l?("textarea"!==e||""!==l)&&Rb(a,l):"number"==typeof l&&Rb(a,""+l):"suppressContentEditableWarning"!==f&&"suppressHydrationWarning"!==f&&"autoFocus"!==f&&(va.hasOwnProperty(f)?null!=l&&rd(c,f):null!=l&&Xa(a,f,l,g))}switch(e){case"input":xb(a),Eb(a,d,!1);break;case"textarea":xb(a),Lb(a);break;case"option":null!=d.value&&a.setAttribute("value",""+rb(d.value));break;case"select":a.multiple=!!d.multiple,null!=(c=d.value)?Hb(a,!!d.multiple,c,!1):null!=d.defaultValue&&Hb(a,!!d.multiple,d.defaultValue,!0);break;default:"function"==typeof h.onClick&&(a.onclick=sd)}Fd(e,d)&&(b.effectTag|=4)}null!==b.ref&&(b.effectTag|=128)}return null;case 6:if(a&&null!=b.stateNode)qi(0,b,a.memoizedProps,d);else{if("string"!=typeof d&&null===b.stateNode)throw Error(u(166));c=ch(bh.current),ch($g.current),Wh(b)?(c=b.stateNode,d=b.memoizedProps,c[Md]=b,c.nodeValue!==d&&(b.effectTag|=4)):((c=(9===c.nodeType?c:c.ownerDocument).createTextNode(d))[Md]=b,b.stateNode=c)}return null;case 13:return H(M),d=b.memoizedState,0!=(64&b.effectTag)?(b.expirationTime=c,b):(c=null!==d,d=!1,null===a?void 0!==b.memoizedProps.fallback&&Wh(b):(d=null!==(e=a.memoizedState),c||null===e||null!==(e=a.child.sibling)&&(null!==(f=b.firstEffect)?(b.firstEffect=e,e.nextEffect=f):(b.firstEffect=b.lastEffect=e,e.nextEffect=null),e.effectTag=8)),c&&!d&&0!=(2&b.mode)&&(null===a&&!0!==b.memoizedProps.unstable_avoidThisFallback||0!=(1&M.current)?S===ti&&(S=ui):(S!==ti&&S!==ui||(S=vi),0!==wi&&null!==T&&(xi(T,U),yi(T,wi)))),(c||d)&&(b.effectTag|=4),null);case 4:return eh(),null;case 10:return og(b),null;case 17:return L(b.type)&&Df(),null;case 19:if(H(M),null===(d=b.memoizedState))return null;if(e=0!=(64&b.effectTag),null===(f=d.rendering)){if(e)ri(d,!1);else if(S!==ti||null!==a&&0!=(64&a.effectTag))for(f=b.child;null!==f;){if(null!==(a=hh(f))){for(b.effectTag|=64,ri(d,!1),null!==(e=a.updateQueue)&&(b.updateQueue=e,b.effectTag|=4),null===d.lastEffect&&(b.firstEffect=null),b.lastEffect=d.lastEffect,d=b.child;null!==d;)f=c,(e=d).effectTag&=2,e.nextEffect=null,e.firstEffect=null,e.lastEffect=null,null===(a=e.alternate)?(e.childExpirationTime=0,e.expirationTime=f,e.child=null,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null):(e.childExpirationTime=a.childExpirationTime,e.expirationTime=a.expirationTime,e.child=a.child,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,e.updateQueue=a.updateQueue,f=a.dependencies,e.dependencies=null===f?null:{expirationTime:f.expirationTime,firstContext:f.firstContext,responders:f.responders}),d=d.sibling;return I(M,1&M.current|2),b.child}f=f.sibling}}else{if(!e)if(null!==(a=hh(f))){if(b.effectTag|=64,e=!0,null!==(c=a.updateQueue)&&(b.updateQueue=c,b.effectTag|=4),ri(d,!0),null===d.tail&&"hidden"===d.tailMode&&!f.alternate)return null!==(b=b.lastEffect=d.lastEffect)&&(b.nextEffect=null),null}else 2*$f()-d.renderingStartTime>d.tailExpiration&&1<c&&(b.effectTag|=64,e=!0,ri(d,!1),b.expirationTime=b.childExpirationTime=c-1);d.isBackwards?(f.sibling=b.child,b.child=f):(null!==(c=d.last)?c.sibling=f:b.child=f,d.last=f)}return null!==d.tail?(0===d.tailExpiration&&(d.tailExpiration=$f()+500),c=d.tail,d.rendering=c,d.tail=c.sibling,d.lastEffect=b.lastEffect,d.renderingStartTime=$f(),c.sibling=null,b=M.current,I(M,e?1&b|2:1&b),c):null}throw Error(u(156,b.tag))}function zi(a){switch(a.tag){case 1:L(a.type)&&Df();var b=a.effectTag;return 4096&b?(a.effectTag=-4097&b|64,a):null;case 3:if(eh(),H(K),H(J),0!=(64&(b=a.effectTag)))throw Error(u(285));return a.effectTag=-4097&b|64,a;case 5:return gh(a),null;case 13:return H(M),4096&(b=a.effectTag)?(a.effectTag=-4097&b|64,a):null;case 19:return H(M),null;case 4:return eh(),null;case 10:return og(a),null;default:return null}}function Ai(a,b){return{value:a,source:b,stack:qb(b)}}ni=function(a,b){for(var c=b.child;null!==c;){if(5===c.tag||6===c.tag)a.appendChild(c.stateNode);else if(4!==c.tag&&null!==c.child){c.child.return=c,c=c.child;continue}if(c===b)break;for(;null===c.sibling;){if(null===c.return||c.return===b)return;c=c.return}c.sibling.return=c.return,c=c.sibling}},pi=function(a,b,c,d,e){var f=a.memoizedProps;if(f!==d){var h,k,g=b.stateNode;switch(ch($g.current),a=null,c){case"input":f=zb(g,f),d=zb(g,d),a=[];break;case"option":f=Gb(g,f),d=Gb(g,d),a=[];break;case"select":f=n({},f,{value:void 0}),d=n({},d,{value:void 0}),a=[];break;case"textarea":f=Ib(g,f),d=Ib(g,d),a=[];break;default:"function"!=typeof f.onClick&&"function"==typeof d.onClick&&(g.onclick=sd)}for(h in od(c,d),c=null,f)if(!d.hasOwnProperty(h)&&f.hasOwnProperty(h)&&null!=f[h])if("style"===h)for(k in g=f[h])g.hasOwnProperty(k)&&(c||(c={}),c[k]="");else"dangerouslySetInnerHTML"!==h&&"children"!==h&&"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(va.hasOwnProperty(h)?a||(a=[]):(a=a||[]).push(h,null));for(h in d){var l=d[h];if(g=null!=f?f[h]:void 0,d.hasOwnProperty(h)&&l!==g&&(null!=l||null!=g))if("style"===h)if(g){for(k in g)!g.hasOwnProperty(k)||l&&l.hasOwnProperty(k)||(c||(c={}),c[k]="");for(k in l)l.hasOwnProperty(k)&&g[k]!==l[k]&&(c||(c={}),c[k]=l[k])}else c||(a||(a=[]),a.push(h,c)),c=l;else"dangerouslySetInnerHTML"===h?(l=l?l.__html:void 0,g=g?g.__html:void 0,null!=l&&g!==l&&(a=a||[]).push(h,l)):"children"===h?g===l||"string"!=typeof l&&"number"!=typeof l||(a=a||[]).push(h,""+l):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&(va.hasOwnProperty(h)?(null!=l&&rd(e,h),a||g===l||(a=[])):(a=a||[]).push(h,l))}c&&(a=a||[]).push("style",c),e=a,(b.updateQueue=e)&&(b.effectTag|=4)}},qi=function(a,b,c,d){c!==d&&(b.effectTag|=4)};var Bi="function"==typeof WeakSet?WeakSet:Set;function Ci(a,b){var c=b.source,d=b.stack;null===d&&null!==c&&(d=qb(c)),null!==c&&pb(c.type),b=b.value,null!==a&&1===a.tag&&pb(a.type);try{console.error(b)}catch(e){setTimeout((function(){throw e}))}}function Fi(a){var b=a.ref;if(null!==b)if("function"==typeof b)try{b(null)}catch(c){Ei(a,c)}else b.current=null}function Gi(a,b){switch(b.tag){case 0:case 11:case 15:case 22:return;case 1:if(256&b.effectTag&&null!==a){var c=a.memoizedProps,d=a.memoizedState;b=(a=b.stateNode).getSnapshotBeforeUpdate(b.elementType===b.type?c:ig(b.type,c),d),a.__reactInternalSnapshotBeforeUpdate=b}return;case 3:case 5:case 6:case 4:case 17:return}throw Error(u(163))}function Hi(a,b){if(null!==(b=null!==(b=b.updateQueue)?b.lastEffect:null)){var c=b=b.next;do{if((c.tag&a)===a){var d=c.destroy;c.destroy=void 0,void 0!==d&&d()}c=c.next}while(c!==b)}}function Ii(a,b){if(null!==(b=null!==(b=b.updateQueue)?b.lastEffect:null)){var c=b=b.next;do{if((c.tag&a)===a){var d=c.create;c.destroy=d()}c=c.next}while(c!==b)}}function Ji(a,b,c){switch(c.tag){case 0:case 11:case 15:case 22:return void Ii(3,c);case 1:if(a=c.stateNode,4&c.effectTag)if(null===b)a.componentDidMount();else{var d=c.elementType===c.type?b.memoizedProps:ig(c.type,b.memoizedProps);a.componentDidUpdate(d,b.memoizedState,a.__reactInternalSnapshotBeforeUpdate)}return void(null!==(b=c.updateQueue)&&Cg(c,b,a));case 3:if(null!==(b=c.updateQueue)){if(a=null,null!==c.child)switch(c.child.tag){case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}Cg(c,b,a)}return;case 5:return a=c.stateNode,void(null===b&&4&c.effectTag&&Fd(c.type,c.memoizedProps)&&a.focus());case 6:case 4:case 12:return;case 13:return void(null===c.memoizedState&&(c=c.alternate,null!==c&&(c=c.memoizedState,null!==c&&(c=c.dehydrated,null!==c&&Vc(c)))));case 19:case 17:case 20:case 21:return}throw Error(u(163))}function Ki(a,b,c){switch("function"==typeof Li&&Li(b),b.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(a=b.updateQueue)&&null!==(a=a.lastEffect)){var d=a.next;cg(97<c?97:c,(function(){var a=d;do{var c=a.destroy;if(void 0!==c){var g=b;try{c()}catch(h){Ei(g,h)}}a=a.next}while(a!==d)}))}break;case 1:Fi(b),"function"==typeof(c=b.stateNode).componentWillUnmount&&(function(a,b){try{b.props=a.memoizedProps,b.state=a.memoizedState,b.componentWillUnmount()}catch(c){Ei(a,c)}})(b,c);break;case 5:Fi(b);break;case 4:Mi(a,b,c)}}function Ni(a){var b=a.alternate;a.return=null,a.child=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.alternate=null,a.firstEffect=null,a.lastEffect=null,a.pendingProps=null,a.memoizedProps=null,a.stateNode=null,null!==b&&Ni(b)}function Oi(a){return 5===a.tag||3===a.tag||4===a.tag}function Pi(a){a:{for(var b=a.return;null!==b;){if(Oi(b)){var c=b;break a}b=b.return}throw Error(u(160))}switch(b=c.stateNode,c.tag){case 5:var d=!1;break;case 3:case 4:b=b.containerInfo,d=!0;break;default:throw Error(u(161))}16&c.effectTag&&(Rb(b,""),c.effectTag&=-17);a:b:for(c=a;;){for(;null===c.sibling;){if(null===c.return||Oi(c.return)){c=null;break a}c=c.return}for(c.sibling.return=c.return,c=c.sibling;5!==c.tag&&6!==c.tag&&18!==c.tag;){if(2&c.effectTag)continue b;if(null===c.child||4===c.tag)continue b;c.child.return=c,c=c.child}if(!(2&c.effectTag)){c=c.stateNode;break a}}d?(function Qi(a,b,c){var d=a.tag,e=5===d||6===d;if(e)a=e?a.stateNode:a.stateNode.instance,b?8===c.nodeType?c.parentNode.insertBefore(a,b):c.insertBefore(a,b):(8===c.nodeType?(b=c.parentNode).insertBefore(a,c):(b=c).appendChild(a),null!==(c=c._reactRootContainer)&&void 0!==c||null!==b.onclick||(b.onclick=sd));else if(4!==d&&null!==(a=a.child))for(Qi(a,b,c),a=a.sibling;null!==a;)Qi(a,b,c),a=a.sibling})(a,c,b):(function Ri(a,b,c){var d=a.tag,e=5===d||6===d;if(e)a=e?a.stateNode:a.stateNode.instance,b?c.insertBefore(a,b):c.appendChild(a);else if(4!==d&&null!==(a=a.child))for(Ri(a,b,c),a=a.sibling;null!==a;)Ri(a,b,c),a=a.sibling})(a,c,b)}function Mi(a,b,c){for(var f,g,d=b,e=!1;;){if(!e){e=d.return;a:for(;;){if(null===e)throw Error(u(160));switch(f=e.stateNode,e.tag){case 5:g=!1;break a;case 3:case 4:f=f.containerInfo,g=!0;break a}e=e.return}e=!0}if(5===d.tag||6===d.tag){a:for(var h=a,k=d,l=c,m=k;;)if(Ki(h,m,l),null!==m.child&&4!==m.tag)m.child.return=m,m=m.child;else{if(m===k)break a;for(;null===m.sibling;){if(null===m.return||m.return===k)break a;m=m.return}m.sibling.return=m.return,m=m.sibling}g?(h=f,k=d.stateNode,8===h.nodeType?h.parentNode.removeChild(k):h.removeChild(k)):f.removeChild(d.stateNode)}else if(4===d.tag){if(null!==d.child){f=d.stateNode.containerInfo,g=!0,d.child.return=d,d=d.child;continue}}else if(Ki(a,d,c),null!==d.child){d.child.return=d,d=d.child;continue}if(d===b)break;for(;null===d.sibling;){if(null===d.return||d.return===b)return;4===(d=d.return).tag&&(e=!1)}d.sibling.return=d.return,d=d.sibling}}function Si(a,b){switch(b.tag){case 0:case 11:case 14:case 15:case 22:return void Hi(3,b);case 1:return;case 5:var c=b.stateNode;if(null!=c){var d=b.memoizedProps,e=null!==a?a.memoizedProps:d;a=b.type;var f=b.updateQueue;if(b.updateQueue=null,null!==f){for(c[Nd]=d,"input"===a&&"radio"===d.type&&null!=d.name&&Bb(c,d),pd(a,e),b=pd(a,d),e=0;e<f.length;e+=2){var g=f[e],h=f[e+1];"style"===g?md(c,h):"dangerouslySetInnerHTML"===g?Qb(c,h):"children"===g?Rb(c,h):Xa(c,g,h,b)}switch(a){case"input":Cb(c,d);break;case"textarea":Kb(c,d);break;case"select":b=c._wrapperState.wasMultiple,c._wrapperState.wasMultiple=!!d.multiple,null!=(a=d.value)?Hb(c,!!d.multiple,a,!1):b!==!!d.multiple&&(null!=d.defaultValue?Hb(c,!!d.multiple,d.defaultValue,!0):Hb(c,!!d.multiple,d.multiple?[]:"",!1))}}}return;case 6:if(null===b.stateNode)throw Error(u(162));return void(b.stateNode.nodeValue=b.memoizedProps);case 3:return void((b=b.stateNode).hydrate&&(b.hydrate=!1,Vc(b.containerInfo)));case 12:return;case 13:if(c=b,null===b.memoizedState?d=!1:(d=!0,c=b.child,Ti=$f()),null!==c)a:for(a=c;;){if(5===a.tag)f=a.stateNode,d?"function"==typeof(f=f.style).setProperty?f.setProperty("display","none","important"):f.display="none":(f=a.stateNode,e=null!=(e=a.memoizedProps.style)&&e.hasOwnProperty("display")?e.display:null,f.style.display=ld("display",e));else if(6===a.tag)a.stateNode.nodeValue=d?"":a.memoizedProps;else{if(13===a.tag&&null!==a.memoizedState&&null===a.memoizedState.dehydrated){(f=a.child.sibling).return=a,a=f;continue}if(null!==a.child){a.child.return=a,a=a.child;continue}}if(a===c)break;for(;null===a.sibling;){if(null===a.return||a.return===c)break a;a=a.return}a.sibling.return=a.return,a=a.sibling}return void Ui(b);case 19:return void Ui(b);case 17:return}throw Error(u(163))}function Ui(a){var b=a.updateQueue;if(null!==b){a.updateQueue=null;var c=a.stateNode;null===c&&(c=a.stateNode=new Bi),b.forEach((function(b){var d=Vi.bind(null,a,b);c.has(b)||(c.add(b),b.then(d,d))}))}}var Wi="function"==typeof WeakMap?WeakMap:Map;function Xi(a,b,c){(c=wg(c,null)).tag=3,c.payload={element:null};var d=b.value;return c.callback=function(){Yi||(Yi=!0,Zi=d),Ci(a,b)},c}function $i(a,b,c){(c=wg(c,null)).tag=3;var d=a.type.getDerivedStateFromError;if("function"==typeof d){var e=b.value;c.payload=function(){return Ci(a,b),d(e)}}var f=a.stateNode;return null!==f&&"function"==typeof f.componentDidCatch&&(c.callback=function(){"function"!=typeof d&&(null===aj?aj=new Set([this]):aj.add(this),Ci(a,b));var c=b.stack;this.componentDidCatch(b.value,{componentStack:null!==c?c:""})}),c}var Rj,bj=Math.ceil,cj=Wa.ReactCurrentDispatcher,dj=Wa.ReactCurrentOwner,ti=0,ui=3,vi=4,W=0,T=null,X=null,U=0,S=ti,kj=null,lj=1073741823,mj=1073741823,nj=null,wi=0,oj=!1,Ti=0,Y=null,Yi=!1,Zi=null,aj=null,qj=!1,rj=null,sj=90,tj=null,uj=0,vj=null,wj=0;function Gg(){return 0!=(48&W)?1073741821-($f()/10|0):0!==wj?wj:wj=1073741821-($f()/10|0)}function Hg(a,b,c){if(0==(2&(b=b.mode)))return 1073741823;var d=ag();if(0==(4&b))return 99===d?1073741823:1073741822;if(0!=(16&W))return U;if(null!==c)a=hg(a,0|c.timeoutMs||5e3,250);else switch(d){case 99:a=1073741823;break;case 98:a=hg(a,150,100);break;case 97:case 96:a=hg(a,5e3,250);break;case 95:a=2;break;default:throw Error(u(326))}return null!==T&&a===U&&--a,a}function Ig(a,b){if(50<uj)throw uj=0,vj=null,Error(u(185));if(null!==(a=xj(a,b))){var c=ag();1073741823===b?0!=(8&W)&&0==(48&W)?yj(a):(Z(a),0===W&&gg()):Z(a),0==(4&W)||98!==c&&99!==c||(null===tj?tj=new Map([[a,b]]):(void 0===(c=tj.get(a))||c>b)&&tj.set(a,b))}}function xj(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b);var d=a.return,e=null;if(null===d&&3===a.tag)e=a.stateNode;else for(;null!==d;){if(c=d.alternate,d.childExpirationTime<b&&(d.childExpirationTime=b),null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b),null===d.return&&3===d.tag){e=d.stateNode;break}d=d.return}return null!==e&&(T===e&&(Bg(b),S===vi&&xi(e,U)),yi(e,b)),e}function zj(a){var b=a.lastExpiredTime;if(0!==b)return b;if(!Aj(a,b=a.firstPendingTime))return b;var c=a.lastPingedTime;return 2>=(a=c>(a=a.nextKnownPendingLevel)?c:a)&&b!==a?0:a}function Z(a){if(0!==a.lastExpiredTime)a.callbackExpirationTime=1073741823,a.callbackPriority=99,a.callbackNode=eg(yj.bind(null,a));else{var b=zj(a),c=a.callbackNode;if(0===b)null!==c&&(a.callbackNode=null,a.callbackExpirationTime=0,a.callbackPriority=90);else{var d=Gg();if(1073741823===b?d=99:1===b||2===b?d=95:d=0>=(d=10*(1073741821-b)-10*(1073741821-d))?99:250>=d?98:5250>=d?97:95,null!==c){var e=a.callbackPriority;if(a.callbackExpirationTime===b&&e>=d)return;c!==Tf&&Kf(c)}a.callbackExpirationTime=b,a.callbackPriority=d,b=1073741823===b?eg(yj.bind(null,a)):dg(d,Bj.bind(null,a),{timeout:10*(1073741821-b)-$f()}),a.callbackNode=b}}}function Bj(a,b){if(wj=0,b)return Cj(a,b=Gg()),Z(a),null;var c=zj(a);if(0!==c){if(b=a.callbackNode,0!=(48&W))throw Error(u(327));if(Dj(),a===T&&c===U||Ej(a,c),null!==X){var d=W;W|=16;for(var e=Fj();;)try{Gj();break}catch(h){Hj(a,h)}if(ng(),W=d,cj.current=e,1===S)throw b=kj,Ej(a,c),xi(a,c),Z(a),b;if(null===X)switch(e=a.finishedWork=a.current.alternate,a.finishedExpirationTime=c,d=S,T=null,d){case ti:case 1:throw Error(u(345));case 2:Cj(a,2<c?2:c);break;case ui:if(xi(a,c),c===(d=a.lastSuspendedTime)&&(a.nextKnownPendingLevel=Ij(e)),1073741823===lj&&10<(e=Ti+500-$f())){if(oj){var f=a.lastPingedTime;if(0===f||f>=c){a.lastPingedTime=c,Ej(a,c);break}}if(0!==(f=zj(a))&&f!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}a.timeoutHandle=Hd(Jj.bind(null,a),e);break}Jj(a);break;case vi:if(xi(a,c),c===(d=a.lastSuspendedTime)&&(a.nextKnownPendingLevel=Ij(e)),oj&&(0===(e=a.lastPingedTime)||e>=c)){a.lastPingedTime=c,Ej(a,c);break}if(0!==(e=zj(a))&&e!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}if(1073741823!==mj?d=10*(1073741821-mj)-$f():1073741823===lj?d=0:(d=10*(1073741821-lj)-5e3,0>(d=(e=$f())-d)&&(d=0),(c=10*(1073741821-c)-e)<(d=(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3e3>d?3e3:4320>d?4320:1960*bj(d/1960))-d)&&(d=c)),10<d){a.timeoutHandle=Hd(Jj.bind(null,a),d);break}Jj(a);break;case 5:if(1073741823!==lj&&null!==nj){f=lj;var g=nj;if(0>=(d=0|g.busyMinDurationMs)?d=0:(e=0|g.busyDelayMs,d=(f=$f()-(10*(1073741821-f)-(0|g.timeoutMs||5e3)))<=e?0:e+d-f),10<d){xi(a,c),a.timeoutHandle=Hd(Jj.bind(null,a),d);break}}Jj(a);break;default:throw Error(u(329))}if(Z(a),a.callbackNode===b)return Bj.bind(null,a)}}return null}function yj(a){var b=a.lastExpiredTime;if(b=0!==b?b:1073741823,0!=(48&W))throw Error(u(327));if(Dj(),a===T&&b===U||Ej(a,b),null!==X){var c=W;W|=16;for(var d=Fj();;)try{Kj();break}catch(e){Hj(a,e)}if(ng(),W=c,cj.current=d,1===S)throw c=kj,Ej(a,b),xi(a,b),Z(a),c;if(null!==X)throw Error(u(261));a.finishedWork=a.current.alternate,a.finishedExpirationTime=b,T=null,Jj(a),Z(a)}return null}function Mj(a,b){var c=W;W|=1;try{return a(b)}finally{0===(W=c)&&gg()}}function Nj(a,b){var c=W;W&=-2,W|=8;try{return a(b)}finally{0===(W=c)&&gg()}}function Ej(a,b){a.finishedWork=null,a.finishedExpirationTime=0;var c=a.timeoutHandle;if(-1!==c&&(a.timeoutHandle=-1,Id(c)),null!==X)for(c=X.return;null!==c;){var d=c;switch(d.tag){case 1:null!=(d=d.type.childContextTypes)&&Df();break;case 3:eh(),H(K),H(J);break;case 5:gh(d);break;case 4:eh();break;case 13:case 19:H(M);break;case 10:og(d)}c=c.return}T=a,X=Sg(a.current,null),U=b,S=ti,kj=null,mj=lj=1073741823,nj=null,wi=0,oj=!1}function Hj(a,b){for(;;){try{if(ng(),jh.current=sh,mh)for(var c=N.memoizedState;null!==c;){var d=c.queue;null!==d&&(d.pending=null),c=c.next}if(lh=0,P=O=N=null,mh=!1,null===X||null===X.return)return S=1,kj=b,X=null;a:{var e=a,f=X.return,g=X,h=b;if(b=U,g.effectTag|=2048,g.firstEffect=g.lastEffect=null,null!==h&&"object"==typeof h&&"function"==typeof h.then){var k=h;if(0==(2&g.mode)){var l=g.alternate;l?(g.updateQueue=l.updateQueue,g.memoizedState=l.memoizedState,g.expirationTime=l.expirationTime):(g.updateQueue=null,g.memoizedState=null)}var m=0!=(1&M.current),p=f;do{var x;if(x=13===p.tag){var z=p.memoizedState;if(null!==z)x=null!==z.dehydrated;else{var ca=p.memoizedProps;x=void 0!==ca.fallback&&(!0!==ca.unstable_avoidThisFallback||!m)}}if(x){var D=p.updateQueue;if(null===D){var t=new Set;t.add(k),p.updateQueue=t}else D.add(k);if(0==(2&p.mode)){if(p.effectTag|=64,g.effectTag&=-2981,1===g.tag)if(null===g.alternate)g.tag=17;else{var y=wg(1073741823,null);y.tag=2,xg(g,y)}g.expirationTime=1073741823;break a}h=void 0,g=b;var A=e.pingCache;if(null===A?(A=e.pingCache=new Wi,h=new Set,A.set(k,h)):void 0===(h=A.get(k))&&(h=new Set,A.set(k,h)),!h.has(g)){h.add(g);var q=Oj.bind(null,e,k,g);k.then(q,q)}p.effectTag|=4096,p.expirationTime=b;break a}p=p.return}while(null!==p);h=Error((pb(g.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display."+qb(g))}5!==S&&(S=2),h=Ai(h,g),p=f;do{switch(p.tag){case 3:k=h,p.effectTag|=4096,p.expirationTime=b,yg(p,Xi(p,k,b));break a;case 1:k=h;var w=p.type,ub=p.stateNode;if(0==(64&p.effectTag)&&("function"==typeof w.getDerivedStateFromError||null!==ub&&"function"==typeof ub.componentDidCatch&&(null===aj||!aj.has(ub)))){p.effectTag|=4096,p.expirationTime=b,yg(p,$i(p,k,b));break a}}p=p.return}while(null!==p)}X=Pj(X)}catch(Xc){b=Xc;continue}break}}function Fj(){var a=cj.current;return cj.current=sh,null===a?sh:a}function Ag(a,b){a<lj&&2<a&&(lj=a),null!==b&&a<mj&&2<a&&(mj=a,nj=b)}function Bg(a){a>wi&&(wi=a)}function Kj(){for(;null!==X;)X=Qj(X)}function Gj(){for(;null!==X&&!Uf();)X=Qj(X)}function Qj(a){var b=Rj(a.alternate,a,U);return a.memoizedProps=a.pendingProps,null===b&&(b=Pj(a)),dj.current=null,b}function Pj(a){X=a;do{var b=X.alternate;if(a=X.return,0==(2048&X.effectTag)){if(b=si(b,X,U),1===U||1!==X.childExpirationTime){for(var c=0,d=X.child;null!==d;){var e=d.expirationTime,f=d.childExpirationTime;e>c&&(c=e),f>c&&(c=f),d=d.sibling}X.childExpirationTime=c}if(null!==b)return b;null!==a&&0==(2048&a.effectTag)&&(null===a.firstEffect&&(a.firstEffect=X.firstEffect),null!==X.lastEffect&&(null!==a.lastEffect&&(a.lastEffect.nextEffect=X.firstEffect),a.lastEffect=X.lastEffect),1<X.effectTag&&(null!==a.lastEffect?a.lastEffect.nextEffect=X:a.firstEffect=X,a.lastEffect=X))}else{if(null!==(b=zi(X)))return b.effectTag&=2047,b;null!==a&&(a.firstEffect=a.lastEffect=null,a.effectTag|=2048)}if(null!==(b=X.sibling))return b;X=a}while(null!==X);return S===ti&&(S=5),null}function Ij(a){var b=a.expirationTime;return b>(a=a.childExpirationTime)?b:a}function Jj(a){var b=ag();return cg(99,Sj.bind(null,a,b)),null}function Sj(a,b){do{Dj()}while(null!==rj);if(0!=(48&W))throw Error(u(327));var c=a.finishedWork,d=a.finishedExpirationTime;if(null===c)return null;if(a.finishedWork=null,a.finishedExpirationTime=0,c===a.current)throw Error(u(177));a.callbackNode=null,a.callbackExpirationTime=0,a.callbackPriority=90,a.nextKnownPendingLevel=0;var e=Ij(c);if(a.firstPendingTime=e,d<=a.lastSuspendedTime?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:d<=a.firstSuspendedTime&&(a.firstSuspendedTime=d-1),d<=a.lastPingedTime&&(a.lastPingedTime=0),d<=a.lastExpiredTime&&(a.lastExpiredTime=0),a===T&&(X=T=null,U=0),1<c.effectTag?null!==c.lastEffect?(c.lastEffect.nextEffect=c,e=c.firstEffect):e=c:e=c.firstEffect,null!==e){var f=W;W|=32,dj.current=null,Dd=fd;var g=xd();if(yd(g)){if("selectionStart"in g)var h={start:g.selectionStart,end:g.selectionEnd};else a:{var k=(h=(h=g.ownerDocument)&&h.defaultView||window).getSelection&&h.getSelection();if(k&&0!==k.rangeCount){h=k.anchorNode;var l=k.anchorOffset,m=k.focusNode;k=k.focusOffset;try{h.nodeType,m.nodeType}catch(wb){h=null;break a}var p=0,x=-1,z=-1,ca=0,D=0,t=g,y=null;b:for(;;){for(var A;t!==h||0!==l&&3!==t.nodeType||(x=p+l),t!==m||0!==k&&3!==t.nodeType||(z=p+k),3===t.nodeType&&(p+=t.nodeValue.length),null!==(A=t.firstChild);)y=t,t=A;for(;;){if(t===g)break b;if(y===h&&++ca===l&&(x=p),y===m&&++D===k&&(z=p),null!==(A=t.nextSibling))break;y=(t=y).parentNode}t=A}h=-1===x||-1===z?null:{start:x,end:z}}else h=null}h=h||{start:0,end:0}}else h=null;Ed={activeElementDetached:null,focusedElem:g,selectionRange:h},fd=!1,Y=e;do{try{Tj()}catch(wb){if(null===Y)throw Error(u(330));Ei(Y,wb),Y=Y.nextEffect}}while(null!==Y);Y=e;do{try{for(g=a,h=b;null!==Y;){var q=Y.effectTag;if(16&q&&Rb(Y.stateNode,""),128&q){var B=Y.alternate;if(null!==B){var w=B.ref;null!==w&&("function"==typeof w?w(null):w.current=null)}}switch(1038&q){case 2:Pi(Y),Y.effectTag&=-3;break;case 6:Pi(Y),Y.effectTag&=-3,Si(Y.alternate,Y);break;case 1024:Y.effectTag&=-1025;break;case 1028:Y.effectTag&=-1025,Si(Y.alternate,Y);break;case 4:Si(Y.alternate,Y);break;case 8:Mi(g,l=Y,h),Ni(l)}Y=Y.nextEffect}}catch(wb){if(null===Y)throw Error(u(330));Ei(Y,wb),Y=Y.nextEffect}}while(null!==Y);if(w=Ed,B=xd(),q=w.focusedElem,h=w.selectionRange,B!==q&&q&&q.ownerDocument&&(function wd(a,b){return!(!a||!b)&&(a===b||(!a||3!==a.nodeType)&&(b&&3===b.nodeType?wd(a,b.parentNode):"contains"in a?a.contains(b):!!a.compareDocumentPosition&&!!(16&a.compareDocumentPosition(b))))})(q.ownerDocument.documentElement,q)){null!==h&&yd(q)&&(B=h.start,void 0===(w=h.end)&&(w=B),"selectionStart"in q?(q.selectionStart=B,q.selectionEnd=Math.min(w,q.value.length)):(w=(B=q.ownerDocument||document)&&B.defaultView||window).getSelection&&(w=w.getSelection(),l=q.textContent.length,g=Math.min(h.start,l),h=void 0===h.end?g:Math.min(h.end,l),!w.extend&&g>h&&(l=h,h=g,g=l),l=vd(q,g),m=vd(q,h),l&&m&&(1!==w.rangeCount||w.anchorNode!==l.node||w.anchorOffset!==l.offset||w.focusNode!==m.node||w.focusOffset!==m.offset)&&((B=B.createRange()).setStart(l.node,l.offset),w.removeAllRanges(),g>h?(w.addRange(B),w.extend(m.node,m.offset)):(B.setEnd(m.node,m.offset),w.addRange(B))))),B=[];for(w=q;w=w.parentNode;)1===w.nodeType&&B.push({element:w,left:w.scrollLeft,top:w.scrollTop});for("function"==typeof q.focus&&q.focus(),q=0;q<B.length;q++)(w=B[q]).element.scrollLeft=w.left,w.element.scrollTop=w.top}fd=!!Dd,Ed=Dd=null,a.current=c,Y=e;do{try{for(q=a;null!==Y;){var ub=Y.effectTag;if(36&ub&&Ji(q,Y.alternate,Y),128&ub){B=void 0;var vb=Y.ref;if(null!==vb){var Xc=Y.stateNode;switch(Y.tag){case 5:B=Xc;break;default:B=Xc}"function"==typeof vb?vb(B):vb.current=B}}Y=Y.nextEffect}}catch(wb){if(null===Y)throw Error(u(330));Ei(Y,wb),Y=Y.nextEffect}}while(null!==Y);Y=null,Vf(),W=f}else a.current=c;if(qj)qj=!1,rj=a,sj=b;else for(Y=e;null!==Y;)b=Y.nextEffect,Y.nextEffect=null,Y=b;if(0===(b=a.firstPendingTime)&&(aj=null),1073741823===b?a===vj?uj++:(uj=0,vj=a):uj=0,"function"==typeof Uj&&Uj(c.stateNode,d),Z(a),Yi)throw Yi=!1,a=Zi,Zi=null,a;return 0!=(8&W)||gg(),null}function Tj(){for(;null!==Y;){var a=Y.effectTag;0!=(256&a)&&Gi(Y.alternate,Y),0==(512&a)||qj||(qj=!0,dg(97,(function(){return Dj(),null}))),Y=Y.nextEffect}}function Dj(){if(90!==sj){var a=97<sj?97:sj;return sj=90,cg(a,Vj)}}function Vj(){if(null===rj)return!1;var a=rj;if(rj=null,0!=(48&W))throw Error(u(331));var b=W;for(W|=32,a=a.current.firstEffect;null!==a;){try{var c=a;if(0!=(512&c.effectTag))switch(c.tag){case 0:case 11:case 15:case 22:Hi(5,c),Ii(5,c)}}catch(d){if(null===a)throw Error(u(330));Ei(a,d)}c=a.nextEffect,a.nextEffect=null,a=c}return W=b,gg(),!0}function Wj(a,b,c){xg(a,b=Xi(a,b=Ai(c,b),1073741823)),null!==(a=xj(a,1073741823))&&Z(a)}function Ei(a,b){if(3===a.tag)Wj(a,a,b);else for(var c=a.return;null!==c;){if(3===c.tag){Wj(c,a,b);break}if(1===c.tag){var d=c.stateNode;if("function"==typeof c.type.getDerivedStateFromError||"function"==typeof d.componentDidCatch&&(null===aj||!aj.has(d))){xg(c,a=$i(c,a=Ai(b,a),1073741823)),null!==(c=xj(c,1073741823))&&Z(c);break}}c=c.return}}function Oj(a,b,c){var d=a.pingCache;null!==d&&d.delete(b),T===a&&U===c?S===vi||S===ui&&1073741823===lj&&$f()-Ti<500?Ej(a,U):oj=!0:Aj(a,c)&&(0!==(b=a.lastPingedTime)&&b<c||(a.lastPingedTime=c,Z(a)))}function Vi(a,b){var c=a.stateNode;null!==c&&c.delete(b),0===(b=0)&&(b=Hg(b=Gg(),a,null)),null!==(a=xj(a,b))&&Z(a)}Rj=function(a,b,c){var d=b.expirationTime;if(null!==a){var e=b.pendingProps;if(a.memoizedProps!==e||K.current)rg=!0;else{if(d<c){switch(rg=!1,b.tag){case 3:hi(b),Xh();break;case 5:if(fh(b),4&b.mode&&1!==c&&e.hidden)return b.expirationTime=b.childExpirationTime=1,null;break;case 1:L(b.type)&&Gf(b);break;case 4:dh(b,b.stateNode.containerInfo);break;case 10:d=b.memoizedProps.value,e=b.type._context,I(jg,e._currentValue),e._currentValue=d;break;case 13:if(null!==b.memoizedState)return 0!==(d=b.child.childExpirationTime)&&d>=c?ji(a,b,c):(I(M,1&M.current),null!==(b=$h(a,b,c))?b.sibling:null);I(M,1&M.current);break;case 19:if(d=b.childExpirationTime>=c,0!=(64&a.effectTag)){if(d)return mi(a,b,c);b.effectTag|=64}if(null!==(e=b.memoizedState)&&(e.rendering=null,e.tail=null),I(M,M.current),!d)return null}return $h(a,b,c)}rg=!1}}else rg=!1;switch(b.expirationTime=0,b.tag){case 2:if(d=b.type,null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),a=b.pendingProps,e=Cf(b,J.current),qg(b,c),e=oh(null,b,d,a,e,c),b.effectTag|=1,"object"==typeof e&&null!==e&&"function"==typeof e.render&&void 0===e.$$typeof){if(b.tag=1,b.memoizedState=null,b.updateQueue=null,L(d)){var f=!0;Gf(b)}else f=!1;b.memoizedState=null!==e.state&&void 0!==e.state?e.state:null,ug(b);var g=d.getDerivedStateFromProps;"function"==typeof g&&Fg(b,d,g,a),e.updater=Jg,b.stateNode=e,e._reactInternalFiber=b,Ng(b,d,a,c),b=gi(null,b,d,!0,f,c)}else b.tag=0,R(null,b,e,c),b=b.child;return b;case 16:a:{if(e=b.elementType,null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),a=b.pendingProps,(function(a){if(-1===a._status){a._status=0;var b=a._ctor;b=b(),a._result=b,b.then((function(b){0===a._status&&(b=b.default,a._status=1,a._result=b)}),(function(b){0===a._status&&(a._status=2,a._result=b)}))}})(e),1!==e._status)throw e._result;switch(e=e._result,b.type=e,f=b.tag=(function(a){if("function"==typeof a)return bi(a)?1:0;if(null!=a){if((a=a.$$typeof)===gb)return 11;if(a===jb)return 14}return 2})(e),a=ig(e,a),f){case 0:b=di(null,b,e,a,c);break a;case 1:b=fi(null,b,e,a,c);break a;case 11:b=Zh(null,b,e,a,c);break a;case 14:b=ai(null,b,e,ig(e.type,a),d,c);break a}throw Error(u(306,e,""))}return b;case 0:return d=b.type,e=b.pendingProps,di(a,b,d,e=b.elementType===d?e:ig(d,e),c);case 1:return d=b.type,e=b.pendingProps,fi(a,b,d,e=b.elementType===d?e:ig(d,e),c);case 3:if(hi(b),d=b.updateQueue,null===a||null===d)throw Error(u(282));if(d=b.pendingProps,e=null!==(e=b.memoizedState)?e.element:null,vg(a,b),zg(b,d,null,c),(d=b.memoizedState.element)===e)Xh(),b=$h(a,b,c);else{if((e=b.stateNode.hydrate)&&(Ph=Jd(b.stateNode.containerInfo.firstChild),Oh=b,e=Qh=!0),e)for(c=Yg(b,null,d,c),b.child=c;c;)c.effectTag=-3&c.effectTag|1024,c=c.sibling;else R(a,b,d,c),Xh();b=b.child}return b;case 5:return fh(b),null===a&&Uh(b),d=b.type,e=b.pendingProps,f=null!==a?a.memoizedProps:null,g=e.children,Gd(d,e)?g=null:null!==f&&Gd(d,f)&&(b.effectTag|=16),ei(a,b),4&b.mode&&1!==c&&e.hidden?(b.expirationTime=b.childExpirationTime=1,b=null):(R(a,b,g,c),b=b.child),b;case 6:return null===a&&Uh(b),null;case 13:return ji(a,b,c);case 4:return dh(b,b.stateNode.containerInfo),d=b.pendingProps,null===a?b.child=Xg(b,null,d,c):R(a,b,d,c),b.child;case 11:return d=b.type,e=b.pendingProps,Zh(a,b,d,e=b.elementType===d?e:ig(d,e),c);case 7:return R(a,b,b.pendingProps,c),b.child;case 8:case 12:return R(a,b,b.pendingProps.children,c),b.child;case 10:a:{d=b.type._context,e=b.pendingProps,g=b.memoizedProps,f=e.value;var h=b.type._context;if(I(jg,h._currentValue),h._currentValue=f,null!==g)if(h=g.value,0===(f=$e(h,f)?0:0|("function"==typeof d._calculateChangedBits?d._calculateChangedBits(h,f):1073741823))){if(g.children===e.children&&!K.current){b=$h(a,b,c);break a}}else for(null!==(h=b.child)&&(h.return=b);null!==h;){var k=h.dependencies;if(null!==k){g=h.child;for(var l=k.firstContext;null!==l;){if(l.context===d&&0!=(l.observedBits&f)){1===h.tag&&((l=wg(c,null)).tag=2,xg(h,l)),h.expirationTime<c&&(h.expirationTime=c),null!==(l=h.alternate)&&l.expirationTime<c&&(l.expirationTime=c),pg(h.return,c),k.expirationTime<c&&(k.expirationTime=c);break}l=l.next}}else g=10===h.tag&&h.type===b.type?null:h.child;if(null!==g)g.return=h;else for(g=h;null!==g;){if(g===b){g=null;break}if(null!==(h=g.sibling)){h.return=g.return,g=h;break}g=g.return}h=g}R(a,b,e.children,c),b=b.child}return b;case 9:return e=b.type,d=(f=b.pendingProps).children,qg(b,c),d=d(e=sg(e,f.unstable_observedBits)),b.effectTag|=1,R(a,b,d,c),b.child;case 14:return f=ig(e=b.type,b.pendingProps),ai(a,b,e,f=ig(e.type,f),d,c);case 15:return ci(a,b,b.type,b.pendingProps,d,c);case 17:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:ig(d,e),null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),b.tag=1,L(d)?(a=!0,Gf(b)):a=!1,qg(b,c),Lg(b,d,e),Ng(b,d,e,c),gi(null,b,d,!0,a,c);case 19:return mi(a,b,c)}throw Error(u(156,b.tag))};var Uj=null,Li=null;function Zj(a,b,c,d){this.tag=a,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=b,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.effectTag=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childExpirationTime=this.expirationTime=0,this.alternate=null}function Sh(a,b,c,d){return new Zj(a,b,c,d)}function bi(a){return!(!(a=a.prototype)||!a.isReactComponent)}function Sg(a,b){var c=a.alternate;return null===c?((c=Sh(a.tag,b,a.key,a.mode)).elementType=a.elementType,c.type=a.type,c.stateNode=a.stateNode,c.alternate=a,a.alternate=c):(c.pendingProps=b,c.effectTag=0,c.nextEffect=null,c.firstEffect=null,c.lastEffect=null),c.childExpirationTime=a.childExpirationTime,c.expirationTime=a.expirationTime,c.child=a.child,c.memoizedProps=a.memoizedProps,c.memoizedState=a.memoizedState,c.updateQueue=a.updateQueue,b=a.dependencies,c.dependencies=null===b?null:{expirationTime:b.expirationTime,firstContext:b.firstContext,responders:b.responders},c.sibling=a.sibling,c.index=a.index,c.ref=a.ref,c}function Ug(a,b,c,d,e,f){var g=2;if(d=a,"function"==typeof a)bi(a)&&(g=1);else if("string"==typeof a)g=5;else a:switch(a){case ab:return Wg(c.children,e,f,b);case fb:g=8,e|=7;break;case bb:g=8,e|=1;break;case cb:return(a=Sh(12,c,b,8|e)).elementType=cb,a.type=cb,a.expirationTime=f,a;case hb:return(a=Sh(13,c,b,e)).type=hb,a.elementType=hb,a.expirationTime=f,a;case ib:return(a=Sh(19,c,b,e)).elementType=ib,a.expirationTime=f,a;default:if("object"==typeof a&&null!==a)switch(a.$$typeof){case db:g=10;break a;case eb:g=9;break a;case gb:g=11;break a;case jb:g=14;break a;case kb:g=16,d=null;break a;case lb:g=22;break a}throw Error(u(130,null==a?a:typeof a,""))}return(b=Sh(g,c,b,e)).elementType=a,b.type=d,b.expirationTime=f,b}function Wg(a,b,c,d){return(a=Sh(7,a,d,b)).expirationTime=c,a}function Tg(a,b,c){return(a=Sh(6,a,null,b)).expirationTime=c,a}function Vg(a,b,c){return(b=Sh(4,null!==a.children?a.children:[],a.key,b)).expirationTime=c,b.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},b}function ak(a,b,c){this.tag=b,this.current=null,this.containerInfo=a,this.pingCache=this.pendingChildren=null,this.finishedExpirationTime=0,this.finishedWork=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=c,this.callbackNode=null,this.callbackPriority=90,this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function Aj(a,b){var c=a.firstSuspendedTime;return a=a.lastSuspendedTime,0!==c&&c>=b&&a<=b}function xi(a,b){var c=a.firstSuspendedTime,d=a.lastSuspendedTime;c<b&&(a.firstSuspendedTime=b),(d>b||0===c)&&(a.lastSuspendedTime=b),b<=a.lastPingedTime&&(a.lastPingedTime=0),b<=a.lastExpiredTime&&(a.lastExpiredTime=0)}function yi(a,b){b>a.firstPendingTime&&(a.firstPendingTime=b);var c=a.firstSuspendedTime;0!==c&&(b>=c?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:b>=a.lastSuspendedTime&&(a.lastSuspendedTime=b+1),b>a.nextKnownPendingLevel&&(a.nextKnownPendingLevel=b))}function Cj(a,b){var c=a.lastExpiredTime;(0===c||c>b)&&(a.lastExpiredTime=b)}function bk(a,b,c,d){var e=b.current,f=Gg(),g=Dg.suspense;f=Hg(f,e,g);a:if(c){b:{if(dc(c=c._reactInternalFiber)!==c||1!==c.tag)throw Error(u(170));var h=c;do{switch(h.tag){case 3:h=h.stateNode.context;break b;case 1:if(L(h.type)){h=h.stateNode.__reactInternalMemoizedMergedChildContext;break b}}h=h.return}while(null!==h);throw Error(u(171))}if(1===c.tag){var k=c.type;if(L(k)){c=Ff(c,k,h);break a}}c=h}else c=Af;return null===b.context?b.context=c:b.pendingContext=c,(b=wg(f,g)).payload={element:a},null!==(d=void 0===d?null:d)&&(b.callback=d),xg(e,b),Ig(e,f),f}function ck(a){if(!(a=a.current).child)return null;switch(a.child.tag){case 5:default:return a.child.stateNode}}function dk(a,b){null!==(a=a.memoizedState)&&null!==a.dehydrated&&a.retryTime<b&&(a.retryTime=b)}function ek(a,b){dk(a,b),(a=a.alternate)&&dk(a,b)}function fk(a,b,c){var d=new ak(a,b,c=null!=c&&!0===c.hydrate),e=Sh(3,null,null,2===b?7:1===b?3:0);d.current=e,e.stateNode=d,ug(e),a[Od]=d.current,c&&0!==b&&(function(a,b){var c=cc(b);Hc.forEach((function(a){uc(a,b,c)})),Ic.forEach((function(a){uc(a,b,c)}))})(0,9===a.nodeType?a:a.ownerDocument),this._internalRoot=d}function gk(a){return!(!a||1!==a.nodeType&&9!==a.nodeType&&11!==a.nodeType&&(8!==a.nodeType||" react-mount-point-unstable "!==a.nodeValue))}function ik(a,b,c,d,e){var f=c._reactRootContainer;if(f){var g=f._internalRoot;if("function"==typeof e){var h=e;e=function(){var a=ck(g);h.call(a)}}bk(b,g,a,e)}else{if(f=c._reactRootContainer=(function(a,b){if(b||(b=!(!(b=a?9===a.nodeType?a.documentElement:a.firstChild:null)||1!==b.nodeType||!b.hasAttribute("data-reactroot"))),!b)for(var c;c=a.lastChild;)a.removeChild(c);return new fk(a,0,b?{hydrate:!0}:void 0)})(c,d),g=f._internalRoot,"function"==typeof e){var k=e;e=function(){var a=ck(g);k.call(a)}}Nj((function(){bk(b,g,a,e)}))}return ck(g)}function jk(a,b,c){var d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:$a,key:null==d?null:""+d,children:a,containerInfo:b,implementation:c}}function kk(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!gk(b))throw Error(u(200));return jk(a,b,null,c)}fk.prototype.render=function(a){bk(a,this._internalRoot,null,null)},fk.prototype.unmount=function(){var a=this._internalRoot,b=a.containerInfo;bk(null,a,null,(function(){b[Od]=null}))},wc=function(a){if(13===a.tag){var b=hg(Gg(),150,100);Ig(a,b),ek(a,b)}},xc=function(a){13===a.tag&&(Ig(a,3),ek(a,3))},yc=function(a){if(13===a.tag){var b=Gg();Ig(a,b=Hg(b,a,null)),ek(a,b)}},za=function(a,b,c){switch(b){case"input":if(Cb(a,c),b=c.name,"radio"===c.type&&null!=b){for(c=a;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll("input[name="+JSON.stringify(""+b)+'][type="radio"]'),b=0;b<c.length;b++){var d=c[b];if(d!==a&&d.form===a.form){var e=Qd(d);if(!e)throw Error(u(90));yb(d),Cb(d,e)}}}break;case"textarea":Kb(a,c);break;case"select":null!=(b=c.value)&&Hb(a,!!c.multiple,b,!1)}},Fa=Mj,Ga=function(a,b,c,d,e){var f=W;W|=4;try{return cg(98,a.bind(null,b,c,d,e))}finally{0===(W=f)&&gg()}},Ha=function(){0==(49&W)&&((function(){if(null!==tj){var a=tj;tj=null,a.forEach((function(a,c){Cj(c,a),Z(c)})),gg()}})(),Dj())},Ia=function(a,b){var c=W;W|=2;try{return a(b)}finally{0===(W=c)&&gg()}};var a,b,lk={Events:[Nc,Pd,Qd,xa,ta,Xd,function(a){jc(a,Wd)},Da,Ea,id,mc,Dj,{current:!1}]};b=(a={findFiberByHostInstance:tc,bundleType:0,version:"16.13.1",rendererPackageName:"react-dom"}).findFiberByHostInstance,(function(a){if("undefined"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var b=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(b.isDisabled||!b.supportsFiber)return!0;try{var c=b.inject(a);Uj=function(a){try{b.onCommitFiberRoot(c,a,void 0,64==(64&a.current.effectTag))}catch(e){}},Li=function(a){try{b.onCommitFiberUnmount(c,a)}catch(e){}}}catch(d){}})(n({},a,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Wa.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){return null===(a=hc(a))?null:a.stateNode},findFiberByHostInstance:function(a){return b?b(a):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null})),exports.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=lk,exports.createPortal=kk,exports.findDOMNode=function(a){if(null==a)return null;if(1===a.nodeType)return a;var b=a._reactInternalFiber;if(void 0===b){if("function"==typeof a.render)throw Error(u(188));throw Error(u(268,Object.keys(a)))}return a=null===(a=hc(b))?null:a.stateNode},exports.flushSync=function(a,b){if(0!=(48&W))throw Error(u(187));var c=W;W|=1;try{return cg(99,a.bind(null,b))}finally{W=c,gg()}},exports.hydrate=function(a,b,c){if(!gk(b))throw Error(u(200));return ik(null,a,b,!0,c)},exports.render=function(a,b,c){if(!gk(b))throw Error(u(200));return ik(null,a,b,!1,c)},exports.unmountComponentAtNode=function(a){if(!gk(a))throw Error(u(40));return!!a._reactRootContainer&&(Nj((function(){ik(null,null,a,!1,(function(){a._reactRootContainer=null,a[Od]=null}))})),!0)},exports.unstable_batchedUpdates=Mj,exports.unstable_createPortal=function(a,b){return kk(a,b,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)},exports.unstable_renderSubtreeIntoContainer=function(a,b,c,d){if(!gk(c))throw Error(u(200));if(null==a||void 0===a._reactInternalFiber)throw Error(u(38));return ik(a,b,c,!1,d)},exports.version="16.13.1"},function(module,exports,__webpack_require__){"use strict";module.exports=__webpack_require__(18)},function(module,exports,__webpack_require__){"use strict";var f,g,h,k,l;if("undefined"==typeof window||"function"!=typeof MessageChannel){var p=null,q=null,t=function(){if(null!==p)try{var a=exports.unstable_now();p(!0,a),p=null}catch(b){throw setTimeout(t,0),b}},u=Date.now();exports.unstable_now=function(){return Date.now()-u},f=function(a){null!==p?setTimeout(f,0,a):(p=a,setTimeout(t,0))},g=function(a,b){q=setTimeout(a,b)},h=function(){clearTimeout(q)},k=function(){return!1},l=exports.unstable_forceFrameRate=function(){}}else{var w=window.performance,x=window.Date,y=window.setTimeout,z=window.clearTimeout;if("undefined"!=typeof console){var A=window.cancelAnimationFrame;"function"!=typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),"function"!=typeof A&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills")}if("object"==typeof w&&"function"==typeof w.now)exports.unstable_now=function(){return w.now()};else{var B=x.now();exports.unstable_now=function(){return x.now()-B}}var C=!1,D=null,E=-1,F=5,G=0;k=function(){return exports.unstable_now()>=G},l=function(){},exports.unstable_forceFrameRate=function(a){0>a||125<a?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):F=0<a?Math.floor(1e3/a):5};var H=new MessageChannel,I=H.port2;H.port1.onmessage=function(){if(null!==D){var a=exports.unstable_now();G=a+F;try{D(!0,a)?I.postMessage(null):(C=!1,D=null)}catch(b){throw I.postMessage(null),b}}else C=!1},f=function(a){D=a,C||(C=!0,I.postMessage(null))},g=function(a,b){E=y((function(){a(exports.unstable_now())}),b)},h=function(){z(E),E=-1}}function J(a,b){var c=a.length;a.push(b);a:for(;;){var d=c-1>>>1,e=a[d];if(!(void 0!==e&&0<K(e,b)))break a;a[d]=b,a[c]=e,c=d}}function L(a){return void 0===(a=a[0])?null:a}function M(a){var b=a[0];if(void 0!==b){var c=a.pop();if(c!==b){a[0]=c;a:for(var d=0,e=a.length;d<e;){var m=2*(d+1)-1,n=a[m],v=m+1,r=a[v];if(void 0!==n&&0>K(n,c))void 0!==r&&0>K(r,n)?(a[d]=r,a[v]=c,d=v):(a[d]=n,a[m]=c,d=m);else{if(!(void 0!==r&&0>K(r,c)))break a;a[d]=r,a[v]=c,d=v}}}return b}return null}function K(a,b){var c=a.sortIndex-b.sortIndex;return 0!==c?c:a.id-b.id}var N=[],O=[],P=1,Q=null,R=3,S=!1,T=!1,U=!1;function V(a){for(var b=L(O);null!==b;){if(null===b.callback)M(O);else{if(!(b.startTime<=a))break;M(O),b.sortIndex=b.expirationTime,J(N,b)}b=L(O)}}function W(a){if(U=!1,V(a),!T)if(null!==L(N))T=!0,f(X);else{var b=L(O);null!==b&&g(W,b.startTime-a)}}function X(a,b){T=!1,U&&(U=!1,h()),S=!0;var c=R;try{for(V(b),Q=L(N);null!==Q&&(!(Q.expirationTime>b)||a&&!k());){var d=Q.callback;if(null!==d){Q.callback=null,R=Q.priorityLevel;var e=d(Q.expirationTime<=b);b=exports.unstable_now(),"function"==typeof e?Q.callback=e:Q===L(N)&&M(N),V(b)}else M(N);Q=L(N)}if(null!==Q)var m=!0;else{var n=L(O);null!==n&&g(W,n.startTime-b),m=!1}return m}finally{Q=null,R=c,S=!1}}function Y(a){switch(a){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1e4;default:return 5e3}}var Z=l;exports.unstable_IdlePriority=5,exports.unstable_ImmediatePriority=1,exports.unstable_LowPriority=4,exports.unstable_NormalPriority=3,exports.unstable_Profiling=null,exports.unstable_UserBlockingPriority=2,exports.unstable_cancelCallback=function(a){a.callback=null},exports.unstable_continueExecution=function(){T||S||(T=!0,f(X))},exports.unstable_getCurrentPriorityLevel=function(){return R},exports.unstable_getFirstCallbackNode=function(){return L(N)},exports.unstable_next=function(a){switch(R){case 1:case 2:case 3:var b=3;break;default:b=R}var c=R;R=b;try{return a()}finally{R=c}},exports.unstable_pauseExecution=function(){},exports.unstable_requestPaint=Z,exports.unstable_runWithPriority=function(a,b){switch(a){case 1:case 2:case 3:case 4:case 5:break;default:a=3}var c=R;R=a;try{return b()}finally{R=c}},exports.unstable_scheduleCallback=function(a,b,c){var d=exports.unstable_now();if("object"==typeof c&&null!==c){var e=c.delay;e="number"==typeof e&&0<e?d+e:d,c="number"==typeof c.timeout?c.timeout:Y(a)}else c=Y(a),e=d;return a={id:P++,callback:b,priorityLevel:a,startTime:e,expirationTime:c=e+c,sortIndex:-1},e>d?(a.sortIndex=e,J(O,a),null===L(N)&&a===L(O)&&(U?h():U=!0,g(W,e-d))):(a.sortIndex=c,J(N,a),T||S||(T=!0,f(X))),a},exports.unstable_shouldYield=function(){var a=exports.unstable_now();V(a);var b=L(N);return b!==Q&&null!==Q&&null!==b&&null!==b.callback&&b.startTime<=a&&b.expirationTime<Q.expirationTime||k()},exports.unstable_wrapCallback=function(a){var b=R;return function(){var c=R;R=b;try{return a.apply(this,arguments)}finally{R=c}}}},function(module,exports,__webpack_require__){var App=__webpack_require__(20);module.exports=App},function(module,exports,__webpack_require__){function _slicedToArray(arr,i){return(function(arr){if(Array.isArray(arr))return arr})(arr)||(function(arr,i){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr})(arr,i)||(function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)})(arr,i)||(function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")})()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var React=__webpack_require__(4),classnames=__webpack_require__(21),StremioVideo=__webpack_require__(8).StremioVideo,selectVideoImplementation=__webpack_require__(57),styles=__webpack_require__(58);module.exports=function(){var videoElementRef=React.useRef(null),_React$useState2=_slicedToArray(React.useState(!1),2),loaded=_React$useState2[0],setLoaded=_React$useState2[1];return React.useEffect((function(){var context=cast.framework.CastReceiverContext.getInstance(),video=new StremioVideo({selectVideoImplementation,containerElement:videoElementRef.current}),emit=function(args){context.sendCustomMessage("urn:x-cast:com.stremio",void 0,JSON.stringify(args,(function(_,value){return value instanceof Error?{message:value.message,stack:value.stack}:value instanceof MediaError?{message:value.message,code:value.code}:value})))},dispatch=function(args){try{video.dispatch(args)}catch(error){console.error("StremioVideo",error)}},onCustomMessage=function(event){dispatch(event.data)};return video.on("propValue",(function(propName,propValue){"stream"===propName&&setLoaded(null!==propValue),emit({event:"propValue",args:[propName,propValue]})})),video.on("propChanged",(function(propName,propValue){"stream"===propName&&setLoaded(null!==propValue),emit({event:"propChanged",args:[propName,propValue]})})),video.on("error",(function(error){emit({event:"error",args:[error]})})),video.on("ended",(function(){emit({event:"ended"})})),video.on("subtitlesTrackLoaded",(function(track){emit({event:"subtitlesTrackLoaded",args:[track]})})),video.on("extraSubtitlesTrackLoaded",(function(track){emit({event:"extraSubtitlesTrackLoaded",args:[track]})})),video.on("implementationChanged",(function(manifest){emit({event:"implementationChanged",args:[manifest]})})),context.addCustomMessageListener("urn:x-cast:com.stremio",onCustomMessage),context.setLoggerLevel(cast.framework.LoggerLevel.NONE),context.start(),function(){dispatch({commandName:"destroy"}),context.removeCustomMessageListener("urn:x-cast:com.stremio",onCustomMessage),context.stop()}}),[]),React.createElement("div",{className:styles["app-container"]},React.createElement("div",{className:classnames(styles.layer,styles["video-layer"])},React.createElement("div",{ref:videoElementRef,className:styles.video})),loaded?null:React.createElement("div",{className:classnames(styles.layer,styles["info-layer"])},"Stremio Chromecast Receiver v","0.0.4"))}},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_RESULT__;!(function(){"use strict";var hasOwn={}.hasOwnProperty;function classNames(){for(var classes=[],i=0;i<arguments.length;i++){var arg=arguments[i];if(arg){var argType=typeof arg;if("string"===argType||"number"===argType)classes.push(arg);else if(Array.isArray(arg)&&arg.length){var inner=classNames.apply(null,arg);inner&&classes.push(inner)}else if("object"===argType)for(var key in arg)hasOwn.call(arg,key)&&arg[key]&&classes.push(key)}}return classes.join(" ")}module.exports?(classNames.default=classNames,module.exports=classNames):void 0===(__WEBPACK_AMD_DEFINE_RESULT__=function(){return classNames}.apply(exports,[]))||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)})()},function(module,exports,__webpack_require__){var HTMLVideo=__webpack_require__(23);module.exports=HTMLVideo},function(module,exports,__webpack_require__){var EventEmitter=__webpack_require__(1),Hls=__webpack_require__(24),cloneDeep=__webpack_require__(2),deepFreeze=__webpack_require__(3),ERROR=__webpack_require__(0);function HTMLVideo(options){var containerElement=(options=options||{}).containerElement;if(!(containerElement instanceof HTMLElement))throw new Error("Container element required to be instance of HTMLElement");var videoElement=document.createElement("video");videoElement.style.width="100%",videoElement.style.height="100%",videoElement.style.backgroundColor="black",videoElement.crossOrigin="anonymous",videoElement.controls=!1,videoElement.onerror=function(){!(function(){var error;switch(videoElement.error.code){case 1:error=ERROR.HTML_VIDEO.MEDIA_ERR_ABORTED;break;case 2:error=ERROR.HTML_VIDEO.MEDIA_ERR_NETWORK;break;case 3:error=ERROR.HTML_VIDEO.MEDIA_ERR_DECODE;break;case 4:error=ERROR.HTML_VIDEO.MEDIA_ERR_SRC_NOT_SUPPORTED;break;default:error=ERROR.UNKNOWN_ERROR}onError(Object.assign({},error,{critical:!0,error:videoElement.error}))})()},videoElement.onended=function(){events.emit("ended")},videoElement.onpause=function(){onPropChanged("paused")},videoElement.onplay=function(){onPropChanged("paused")},videoElement.ontimeupdate=function(){onPropChanged("time"),onPropChanged("buffered")},videoElement.ondurationchange=function(){onPropChanged("duration")},videoElement.onwaiting=function(){onPropChanged("buffering"),onPropChanged("buffered")},videoElement.onseeking=function(){onPropChanged("buffering"),onPropChanged("buffered")},videoElement.onseeked=function(){onPropChanged("buffering"),onPropChanged("buffered")},videoElement.onstalled=function(){onPropChanged("buffering"),onPropChanged("buffered")},videoElement.onplaying=function(){onPropChanged("buffering"),onPropChanged("buffered")},videoElement.oncanplay=function(){onPropChanged("buffering"),onPropChanged("buffered")},videoElement.canplaythrough=function(){onPropChanged("buffering"),onPropChanged("buffered")},videoElement.onloadeddata=function(){onPropChanged("buffering"),onPropChanged("buffered")},videoElement.onvolumechange=function(){onPropChanged("volume"),onPropChanged("muted")},containerElement.appendChild(videoElement);var events=new EventEmitter;events.on("error",(function(){}));var hls=null,destroyed=!1,stream=null,observedProps={stream:!1,paused:!1,time:!1,duration:!1,buffering:!1,buffered:!1,volume:!1,muted:!1};function getProp(propName){switch(propName){case"stream":return stream;case"paused":return null===stream?null:!!videoElement.paused;case"time":return null!==stream&&null!==videoElement.currentTime&&isFinite(videoElement.currentTime)?Math.floor(1e3*videoElement.currentTime):null;case"duration":return null!==stream&&null!==videoElement.duration&&isFinite(videoElement.duration)?Math.floor(1e3*videoElement.duration):null;case"buffering":return null===stream?null:videoElement.readyState<videoElement.HAVE_FUTURE_DATA;case"buffered":if(null===stream)return null;for(var time=null!==videoElement.currentTime&&isFinite(videoElement.currentTime)?videoElement.currentTime:0,i=0;i<videoElement.buffered.length;i++)if(videoElement.buffered.start(i)<=time&&time<=videoElement.buffered.end(i))return Math.floor(1e3*videoElement.buffered.end(i));return Math.floor(1e3*time);case"volume":return destroyed||null===videoElement.volume||!isFinite(videoElement.volume)?null:Math.floor(100*videoElement.volume);case"muted":return destroyed?null:!!videoElement.muted}}function onError(error){events.emit("error",error),error.critical&&command("unload")}function onPropChanged(propName){observedProps[propName]&&events.emit("propChanged",propName,getProp(propName))}function command(commandName,commandArgs){switch(commandName){case"load":command("unload"),commandArgs&&commandArgs.stream&&"string"==typeof commandArgs.stream.url?(stream=commandArgs.stream,onPropChanged("stream"),videoElement.autoplay="boolean"!=typeof commandArgs.autoplay||commandArgs.autoplay,videoElement.currentTime=null!==commandArgs.time&&isFinite(commandArgs.time)?parseInt(commandArgs.time,10)/1e3:0,onPropChanged("paused"),onPropChanged("time"),onPropChanged("duration"),onPropChanged("buffering"),onPropChanged("buffered"),getContentType(stream).then((function(contentType){stream===commandArgs.stream&&("application/vnd.apple.mpegurl"===contentType&&Hls.isSupported()?((hls=new Hls).loadSource(stream.url),hls.attachMedia(videoElement)):videoElement.src=stream.url)})).catch((function(){stream===commandArgs.stream&&(videoElement.src=stream.url)}))):onError(Object.assign({},ERROR.UNSUPPORTED_STREAM,{critical:!0,stream:commandArgs?commandArgs.stream:null}));break;case"unload":stream=null,null!==hls&&(hls.destroy(),hls=null),videoElement.removeAttribute("src"),videoElement.load(),videoElement.currentTime=0,onPropChanged("stream"),onPropChanged("paused"),onPropChanged("time"),onPropChanged("duration"),onPropChanged("buffering"),onPropChanged("buffered");break;case"destroy":command("unload"),destroyed=!0,onPropChanged("volume"),onPropChanged("muted"),events.removeAllListeners(),events.on("error",(function(){})),videoElement.onerror=null,videoElement.onended=null,videoElement.onpause=null,videoElement.onplay=null,videoElement.ontimeupdate=null,videoElement.ondurationchange=null,videoElement.onwaiting=null,videoElement.onseeking=null,videoElement.onseeked=null,videoElement.onstalled=null,videoElement.onplaying=null,videoElement.oncanplay=null,videoElement.canplaythrough=null,videoElement.onloadeddata=null,videoElement.onvolumechange=null,containerElement.removeChild(videoElement)}}this.on=function(eventName,listener){if(destroyed)throw new Error("Video is destroyed");events.on(eventName,listener)},this.dispatch=function(action){if(destroyed)throw new Error("Video is destroyed");if(action=deepFreeze(cloneDeep(action)))switch(action.type){case"observeProp":return propName=action.propName,void(observedProps.hasOwnProperty(propName)&&(events.emit("propValue",propName,getProp(propName)),observedProps[propName]=!0));case"setProp":return void(function(propName,propValue){switch(propName){case"paused":null!==stream&&(propValue?videoElement.pause():videoElement.play());break;case"time":null!==stream&&null!==propValue&&isFinite(propValue)&&(videoElement.currentTime=parseInt(propValue,10)/1e3);break;case"volume":null!==propValue&&isFinite(propValue)&&(videoElement.muted=!1,videoElement.volume=Math.max(0,Math.min(100,parseInt(propValue,10)))/100);break;case"muted":videoElement.muted=!!propValue}})(action.propName,action.propValue);case"command":return void command(action.commandName,action.commandArgs)}var propName;throw new Error("Invalid action dispatched: "+JSON.stringify(action))}}function getContentType(stream){return stream&&"string"==typeof stream.url?stream.behaviorHints&&stream.behaviorHints.headers&&"string"==typeof stream.behaviorHints.headers["content-type"]?Promise.resolve(stream.behaviorHints.headers["content-type"]):fetch(stream.url,{method:"HEAD"}).then((function(resp){return resp.headers.get("content-type")})):Promise.reject(new Error("Invalid stream parameter!"))}HTMLVideo.canPlayStream=function(stream){return!stream||stream.behaviorHints&&stream.behaviorHints.notWebReady?Promise.resolve(!1):getContentType(stream).then((function(contentType){return!!document.createElement("video").canPlayType(contentType)||"application/vnd.apple.mpegurl"===contentType&&Hls.isSupported()})).catch((function(){return!1}))},HTMLVideo.manifest={name:"HTMLVideo",props:["stream","paused","time","duration","buffering","buffered","volume","muted"],commands:["load","unload","destroy"],events:["propChanged","propValue","ended","error"]},module.exports=HTMLVideo},function(module,exports,__webpack_require__){var factory;"undefined"!=typeof window&&(factory=function(){return(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{enumerable:!0,get:getter})},__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.t=function(value,mode){if(1&mode&&(value=__webpack_require__(value)),8&mode)return value;if(4&mode&&"object"==typeof value&&value&&value.__esModule)return value;var ns=Object.create(null);if(__webpack_require__.r(ns),Object.defineProperty(ns,"default",{enumerable:!0,value}),2&mode&&"string"!=typeof value)for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="/dist/",__webpack_require__(__webpack_require__.s="./src/hls.ts")})({"./node_modules/eventemitter3/index.js":function(module,exports,__webpack_require__){"use strict";var has=Object.prototype.hasOwnProperty,prefix="~";function Events(){}function EE(fn,context,once){this.fn=fn,this.context=context,this.once=once||!1}function addListener(emitter,event,fn,context,once){if("function"!=typeof fn)throw new TypeError("The listener must be a function");var listener=new EE(fn,context||emitter,once),evt=prefix?prefix+event:event;return emitter._events[evt]?emitter._events[evt].fn?emitter._events[evt]=[emitter._events[evt],listener]:emitter._events[evt].push(listener):(emitter._events[evt]=listener,emitter._eventsCount++),emitter}function clearEvent(emitter,evt){0==--emitter._eventsCount?emitter._events=new Events:delete emitter._events[evt]}function EventEmitter(){this._events=new Events,this._eventsCount=0}Object.create&&(Events.prototype=Object.create(null),(new Events).__proto__||(prefix=!1)),EventEmitter.prototype.eventNames=function(){var events,name,names=[];if(0===this._eventsCount)return names;for(name in events=this._events)has.call(events,name)&&names.push(prefix?name.slice(1):name);return Object.getOwnPropertySymbols?names.concat(Object.getOwnPropertySymbols(events)):names},EventEmitter.prototype.listeners=function(event){var evt=prefix?prefix+event:event,handlers=this._events[evt];if(!handlers)return[];if(handlers.fn)return[handlers.fn];for(var i=0,l=handlers.length,ee=new Array(l);i<l;i++)ee[i]=handlers[i].fn;return ee},EventEmitter.prototype.listenerCount=function(event){var evt=prefix?prefix+event:event,listeners=this._events[evt];return listeners?listeners.fn?1:listeners.length:0},EventEmitter.prototype.emit=function(event,a1,a2,a3,a4,a5){var evt=prefix?prefix+event:event;if(!this._events[evt])return!1;var args,i,listeners=this._events[evt],len=arguments.length;if(listeners.fn){switch(listeners.once&&this.removeListener(event,listeners.fn,void 0,!0),len){case 1:return listeners.fn.call(listeners.context),!0;case 2:return listeners.fn.call(listeners.context,a1),!0;case 3:return listeners.fn.call(listeners.context,a1,a2),!0;case 4:return listeners.fn.call(listeners.context,a1,a2,a3),!0;case 5:return listeners.fn.call(listeners.context,a1,a2,a3,a4),!0;case 6:return listeners.fn.call(listeners.context,a1,a2,a3,a4,a5),!0}for(i=1,args=new Array(len-1);i<len;i++)args[i-1]=arguments[i];listeners.fn.apply(listeners.context,args)}else{var j,length=listeners.length;for(i=0;i<length;i++)switch(listeners[i].once&&this.removeListener(event,listeners[i].fn,void 0,!0),len){case 1:listeners[i].fn.call(listeners[i].context);break;case 2:listeners[i].fn.call(listeners[i].context,a1);break;case 3:listeners[i].fn.call(listeners[i].context,a1,a2);break;case 4:listeners[i].fn.call(listeners[i].context,a1,a2,a3);break;default:if(!args)for(j=1,args=new Array(len-1);j<len;j++)args[j-1]=arguments[j];listeners[i].fn.apply(listeners[i].context,args)}}return!0},EventEmitter.prototype.on=function(event,fn,context){return addListener(this,event,fn,context,!1)},EventEmitter.prototype.once=function(event,fn,context){return addListener(this,event,fn,context,!0)},EventEmitter.prototype.removeListener=function(event,fn,context,once){var evt=prefix?prefix+event:event;if(!this._events[evt])return this;if(!fn)return clearEvent(this,evt),this;var listeners=this._events[evt];if(listeners.fn)listeners.fn!==fn||once&&!listeners.once||context&&listeners.context!==context||clearEvent(this,evt);else{for(var i=0,events=[],length=listeners.length;i<length;i++)(listeners[i].fn!==fn||once&&!listeners[i].once||context&&listeners[i].context!==context)&&events.push(listeners[i]);events.length?this._events[evt]=1===events.length?events[0]:events:clearEvent(this,evt)}return this},EventEmitter.prototype.removeAllListeners=function(event){var evt;return event?(evt=prefix?prefix+event:event,this._events[evt]&&clearEvent(this,evt)):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prefixed=prefix,EventEmitter.EventEmitter=EventEmitter,module.exports=EventEmitter},"./node_modules/url-toolkit/src/url-toolkit.js":function(module,exports,__webpack_require__){var URL_REGEX,FIRST_SEGMENT_REGEX,SLASH_DOT_REGEX,SLASH_DOT_DOT_REGEX,URLToolkit;URL_REGEX=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#.*)?$/,FIRST_SEGMENT_REGEX=/^([^\/?#]*)(.*)$/,SLASH_DOT_REGEX=/(?:\/|^)\.(?=\/)/g,SLASH_DOT_DOT_REGEX=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,URLToolkit={buildAbsoluteURL:function(baseURL,relativeURL,opts){if(opts=opts||{},baseURL=baseURL.trim(),!(relativeURL=relativeURL.trim())){if(!opts.alwaysNormalize)return baseURL;var basePartsForNormalise=URLToolkit.parseURL(baseURL);if(!basePartsForNormalise)throw new Error("Error trying to parse base URL.");return basePartsForNormalise.path=URLToolkit.normalizePath(basePartsForNormalise.path),URLToolkit.buildURLFromParts(basePartsForNormalise)}var relativeParts=URLToolkit.parseURL(relativeURL);if(!relativeParts)throw new Error("Error trying to parse relative URL.");if(relativeParts.scheme)return opts.alwaysNormalize?(relativeParts.path=URLToolkit.normalizePath(relativeParts.path),URLToolkit.buildURLFromParts(relativeParts)):relativeURL;var baseParts=URLToolkit.parseURL(baseURL);if(!baseParts)throw new Error("Error trying to parse base URL.");if(!baseParts.netLoc&&baseParts.path&&"/"!==baseParts.path[0]){var pathParts=FIRST_SEGMENT_REGEX.exec(baseParts.path);baseParts.netLoc=pathParts[1],baseParts.path=pathParts[2]}baseParts.netLoc&&!baseParts.path&&(baseParts.path="/");var builtParts={scheme:baseParts.scheme,netLoc:relativeParts.netLoc,path:null,params:relativeParts.params,query:relativeParts.query,fragment:relativeParts.fragment};if(!relativeParts.netLoc&&(builtParts.netLoc=baseParts.netLoc,"/"!==relativeParts.path[0]))if(relativeParts.path){var baseURLPath=baseParts.path,newPath=baseURLPath.substring(0,baseURLPath.lastIndexOf("/")+1)+relativeParts.path;builtParts.path=URLToolkit.normalizePath(newPath)}else builtParts.path=baseParts.path,relativeParts.params||(builtParts.params=baseParts.params,relativeParts.query||(builtParts.query=baseParts.query));return null===builtParts.path&&(builtParts.path=opts.alwaysNormalize?URLToolkit.normalizePath(relativeParts.path):relativeParts.path),URLToolkit.buildURLFromParts(builtParts)},parseURL:function(url){var parts=URL_REGEX.exec(url);return parts?{scheme:parts[1]||"",netLoc:parts[2]||"",path:parts[3]||"",params:parts[4]||"",query:parts[5]||"",fragment:parts[6]||""}:null},normalizePath:function(path){for(path=path.split("").reverse().join("").replace(SLASH_DOT_REGEX,"");path.length!==(path=path.replace(SLASH_DOT_DOT_REGEX,"")).length;);return path.split("").reverse().join("")},buildURLFromParts:function(parts){return parts.scheme+parts.netLoc+parts.path+parts.params+parts.query+parts.fragment}},module.exports=URLToolkit},"./node_modules/webworkify-webpack/index.js":function(module,exports,__webpack_require__){function webpackBootstrapFunc(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}__webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.i=function(value){return value},__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{configurable:!1,enumerable:!0,get:getter})},__webpack_require__.r=function(exports){Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="/",__webpack_require__.oe=function(err){throw console.error(err),err};var f=__webpack_require__(__webpack_require__.s=ENTRY_MODULE);return f.default||f}function quoteRegExp(str){return(str+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function getModuleDependencies(sources,module,queueName){var retval={};retval[queueName]=[];var fnString=module.toString(),wrapperSignature=fnString.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!wrapperSignature)return retval;for(var match,webpackRequireName=wrapperSignature[1],re=new RegExp("(\\\\n|\\W)"+quoteRegExp(webpackRequireName)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");match=re.exec(fnString);)"dll-reference"!==match[3]&&retval[queueName].push(match[3]);for(re=new RegExp("\\("+quoteRegExp(webpackRequireName)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");match=re.exec(fnString);)sources[match[2]]||(retval[queueName].push(match[1]),sources[match[2]]=__webpack_require__(match[1]).m),retval[match[2]]=retval[match[2]]||[],retval[match[2]].push(match[4]);for(var n,keys=Object.keys(retval),i=0;i<keys.length;i++)for(var j=0;j<retval[keys[i]].length;j++)n=retval[keys[i]][j],isNaN(1*n)||(retval[keys[i]][j]=1*retval[keys[i]][j]);return retval}function hasValuesInQueues(queues){return Object.keys(queues).reduce((function(hasValues,key){return hasValues||queues[key].length>0}),!1)}module.exports=function(moduleId,options){options=options||{};var sources={main:__webpack_require__.m},requiredModules=options.all?{main:Object.keys(sources.main)}:(function(sources,moduleId){for(var modulesQueue={main:[moduleId]},requiredModules={main:[]},seenModules={main:{}};hasValuesInQueues(modulesQueue);)for(var queues=Object.keys(modulesQueue),i=0;i<queues.length;i++){var queueName=queues[i],moduleToCheck=modulesQueue[queueName].pop();if(seenModules[queueName]=seenModules[queueName]||{},!seenModules[queueName][moduleToCheck]&&sources[queueName][moduleToCheck]){seenModules[queueName][moduleToCheck]=!0,requiredModules[queueName]=requiredModules[queueName]||[],requiredModules[queueName].push(moduleToCheck);for(var newModules=getModuleDependencies(sources,sources[queueName][moduleToCheck],queueName),newModulesKeys=Object.keys(newModules),j=0;j<newModulesKeys.length;j++)modulesQueue[newModulesKeys[j]]=modulesQueue[newModulesKeys[j]]||[],modulesQueue[newModulesKeys[j]]=modulesQueue[newModulesKeys[j]].concat(newModules[newModulesKeys[j]])}}return requiredModules})(sources,moduleId),src="";Object.keys(requiredModules).filter((function(m){return"main"!==m})).forEach((function(module){for(var entryModule=0;requiredModules[module][entryModule];)entryModule++;requiredModules[module].push(entryModule),sources[module][entryModule]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",src=src+"var "+module+" = ("+webpackBootstrapFunc.toString().replace("ENTRY_MODULE",JSON.stringify(entryModule))+")({"+requiredModules[module].map((function(id){return JSON.stringify(id)+": "+sources[module][id].toString()})).join(",")+"});\n"})),src=src+"new (("+webpackBootstrapFunc.toString().replace("ENTRY_MODULE",JSON.stringify(moduleId))+")({"+requiredModules.main.map((function(id){return JSON.stringify(id)+": "+sources.main[id].toString()})).join(",")+"}))(self);";var blob=new window.Blob([src],{type:"text/javascript"});if(options.bare)return blob;var workerUrl=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(blob),worker=new window.Worker(workerUrl);return worker.objectURL=workerUrl,worker}},"./src/crypt/decrypter.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var AESCrypto=(function(){function AESCrypto(subtle,iv){this.subtle=subtle,this.aesIV=iv}return AESCrypto.prototype.decrypt=function(data,key){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},key,data)},AESCrypto})(),fast_aes_key=(function(){function FastAESKey(subtle,key){this.subtle=subtle,this.key=key}return FastAESKey.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},FastAESKey})(),aes_decryptor=(function(){function AESDecryptor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}var _proto=AESDecryptor.prototype;return _proto.uint8ArrayToUint32Array_=function(arrayBuffer){for(var view=new DataView(arrayBuffer),newArray=new Uint32Array(4),i=0;i<4;i++)newArray[i]=view.getUint32(4*i);return newArray},_proto.initTable=function(){var sBox=this.sBox,invSBox=this.invSBox,subMix=this.subMix,subMix0=subMix[0],subMix1=subMix[1],subMix2=subMix[2],subMix3=subMix[3],invSubMix=this.invSubMix,invSubMix0=invSubMix[0],invSubMix1=invSubMix[1],invSubMix2=invSubMix[2],invSubMix3=invSubMix[3],d=new Uint32Array(256),x=0,xi=0,i=0;for(i=0;i<256;i++)d[i]=i<128?i<<1:i<<1^283;for(i=0;i<256;i++){var sx=xi^xi<<1^xi<<2^xi<<3^xi<<4;sx=sx>>>8^255&sx^99,sBox[x]=sx,invSBox[sx]=x;var x2=d[x],x4=d[x2],x8=d[x4],t=257*d[sx]^16843008*sx;subMix0[x]=t<<24|t>>>8,subMix1[x]=t<<16|t>>>16,subMix2[x]=t<<8|t>>>24,subMix3[x]=t,t=16843009*x8^65537*x4^257*x2^16843008*x,invSubMix0[sx]=t<<24|t>>>8,invSubMix1[sx]=t<<16|t>>>16,invSubMix2[sx]=t<<8|t>>>24,invSubMix3[sx]=t,x?(x=x2^d[d[d[x8^x2]]],xi^=d[d[xi]]):x=xi=1}},_proto.expandKey=function(keyBuffer){for(var key=this.uint8ArrayToUint32Array_(keyBuffer),sameKey=!0,offset=0;offset<key.length&&sameKey;)sameKey=key[offset]===this.key[offset],offset++;if(!sameKey){this.key=key;var keySize=this.keySize=key.length;if(4!==keySize&&6!==keySize&&8!==keySize)throw new Error("Invalid aes key size="+keySize);var ksRow,invKsRow,prev,t,ksRows=this.ksRows=4*(keySize+6+1),keySchedule=this.keySchedule=new Uint32Array(ksRows),invKeySchedule=this.invKeySchedule=new Uint32Array(ksRows),sbox=this.sBox,rcon=this.rcon,invSubMix=this.invSubMix,invSubMix0=invSubMix[0],invSubMix1=invSubMix[1],invSubMix2=invSubMix[2],invSubMix3=invSubMix[3];for(ksRow=0;ksRow<ksRows;ksRow++)ksRow<keySize?prev=keySchedule[ksRow]=key[ksRow]:(t=prev,ksRow%keySize==0?(t=sbox[(t=t<<8|t>>>24)>>>24]<<24|sbox[t>>>16&255]<<16|sbox[t>>>8&255]<<8|sbox[255&t],t^=rcon[ksRow/keySize|0]<<24):keySize>6&&ksRow%keySize==4&&(t=sbox[t>>>24]<<24|sbox[t>>>16&255]<<16|sbox[t>>>8&255]<<8|sbox[255&t]),keySchedule[ksRow]=prev=(keySchedule[ksRow-keySize]^t)>>>0);for(invKsRow=0;invKsRow<ksRows;invKsRow++)ksRow=ksRows-invKsRow,t=3&invKsRow?keySchedule[ksRow]:keySchedule[ksRow-4],invKeySchedule[invKsRow]=invKsRow<4||ksRow<=4?t:invSubMix0[sbox[t>>>24]]^invSubMix1[sbox[t>>>16&255]]^invSubMix2[sbox[t>>>8&255]]^invSubMix3[sbox[255&t]],invKeySchedule[invKsRow]=invKeySchedule[invKsRow]>>>0}},_proto.networkToHostOrderSwap=function(word){return word<<24|(65280&word)<<8|(16711680&word)>>8|word>>>24},_proto.decrypt=function(inputArrayBuffer,offset,aesIV,removePKCS7Padding){for(var t0,t1,t2,t3,s0,s1,s2,s3,inputWords0,inputWords1,inputWords2,inputWords3,ksRow,i,buffer,outputBytes,paddingBytes,nRounds=this.keySize+6,invKeySchedule=this.invKeySchedule,invSBOX=this.invSBox,invSubMix=this.invSubMix,invSubMix0=invSubMix[0],invSubMix1=invSubMix[1],invSubMix2=invSubMix[2],invSubMix3=invSubMix[3],initVector=this.uint8ArrayToUint32Array_(aesIV),initVector0=initVector[0],initVector1=initVector[1],initVector2=initVector[2],initVector3=initVector[3],inputInt32=new Int32Array(inputArrayBuffer),outputInt32=new Int32Array(inputInt32.length),swapWord=this.networkToHostOrderSwap;offset<inputInt32.length;){for(inputWords0=swapWord(inputInt32[offset]),inputWords1=swapWord(inputInt32[offset+1]),inputWords2=swapWord(inputInt32[offset+2]),inputWords3=swapWord(inputInt32[offset+3]),s0=inputWords0^invKeySchedule[0],s1=inputWords3^invKeySchedule[1],s2=inputWords2^invKeySchedule[2],s3=inputWords1^invKeySchedule[3],ksRow=4,i=1;i<nRounds;i++)t0=invSubMix0[s0>>>24]^invSubMix1[s1>>16&255]^invSubMix2[s2>>8&255]^invSubMix3[255&s3]^invKeySchedule[ksRow],t1=invSubMix0[s1>>>24]^invSubMix1[s2>>16&255]^invSubMix2[s3>>8&255]^invSubMix3[255&s0]^invKeySchedule[ksRow+1],t2=invSubMix0[s2>>>24]^invSubMix1[s3>>16&255]^invSubMix2[s0>>8&255]^invSubMix3[255&s1]^invKeySchedule[ksRow+2],t3=invSubMix0[s3>>>24]^invSubMix1[s0>>16&255]^invSubMix2[s1>>8&255]^invSubMix3[255&s2]^invKeySchedule[ksRow+3],s0=t0,s1=t1,s2=t2,s3=t3,ksRow+=4;t0=invSBOX[s0>>>24]<<24^invSBOX[s1>>16&255]<<16^invSBOX[s2>>8&255]<<8^invSBOX[255&s3]^invKeySchedule[ksRow],t1=invSBOX[s1>>>24]<<24^invSBOX[s2>>16&255]<<16^invSBOX[s3>>8&255]<<8^invSBOX[255&s0]^invKeySchedule[ksRow+1],t2=invSBOX[s2>>>24]<<24^invSBOX[s3>>16&255]<<16^invSBOX[s0>>8&255]<<8^invSBOX[255&s1]^invKeySchedule[ksRow+2],t3=invSBOX[s3>>>24]<<24^invSBOX[s0>>16&255]<<16^invSBOX[s1>>8&255]<<8^invSBOX[255&s2]^invKeySchedule[ksRow+3],ksRow+=3,outputInt32[offset]=swapWord(t0^initVector0),outputInt32[offset+1]=swapWord(t3^initVector1),outputInt32[offset+2]=swapWord(t2^initVector2),outputInt32[offset+3]=swapWord(t1^initVector3),initVector0=inputWords0,initVector1=inputWords1,initVector2=inputWords2,initVector3=inputWords3,offset+=4}return removePKCS7Padding?(buffer=outputInt32.buffer,outputBytes=buffer.byteLength,(paddingBytes=outputBytes&&new DataView(buffer).getUint8(outputBytes-1))?buffer.slice(0,outputBytes-paddingBytes):buffer):outputInt32.buffer},_proto.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},AESDecryptor})(),errors=__webpack_require__("./src/errors.ts"),logger=__webpack_require__("./src/utils/logger.js"),events=__webpack_require__("./src/events.js"),get_self_scope=__webpack_require__("./src/utils/get-self-scope.js"),global=Object(get_self_scope.getSelfScope)(),decrypter_Decrypter=(function(){function Decrypter(observer,config,_temp){var _ref$removePKCS7Paddi=(void 0===_temp?{}:_temp).removePKCS7Padding,removePKCS7Padding=void 0===_ref$removePKCS7Paddi||_ref$removePKCS7Paddi;if(this.logEnabled=!0,this.observer=observer,this.config=config,this.removePKCS7Padding=removePKCS7Padding,removePKCS7Padding)try{var browserCrypto=global.crypto;browserCrypto&&(this.subtle=browserCrypto.subtle||browserCrypto.webkitSubtle)}catch(e){}this.disableWebCrypto=!this.subtle}var _proto=Decrypter.prototype;return _proto.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},_proto.decrypt=function(data,key,iv,callback){var _this=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(logger.logger.log("JS AES decrypt"),this.logEnabled=!1);var decryptor=this.decryptor;decryptor||(this.decryptor=decryptor=new aes_decryptor),decryptor.expandKey(key),callback(decryptor.decrypt(data,0,iv,this.removePKCS7Padding))}else{this.logEnabled&&(logger.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1);var subtle=this.subtle;this.key!==key&&(this.key=key,this.fastAesKey=new fast_aes_key(subtle,key)),this.fastAesKey.expandKey().then((function(aesKey){new AESCrypto(subtle,iv).decrypt(data,aesKey).catch((function(err){_this.onWebCryptoError(err,data,key,iv,callback)})).then((function(result){callback(result)}))})).catch((function(err){_this.onWebCryptoError(err,data,key,iv,callback)}))}},_proto.onWebCryptoError=function(err,data,key,iv,callback){this.config.enableSoftwareAES?(logger.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(data,key,iv,callback)):(logger.logger.error("decrypting error : "+err.message),this.observer.trigger(events.default.ERROR,{type:errors.ErrorTypes.MEDIA_ERROR,details:errors.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:err.message}))},_proto.destroy=function(){var decryptor=this.decryptor;decryptor&&(decryptor.destroy(),this.decryptor=void 0)},Decrypter})();__webpack_exports__.default=decrypter_Decrypter},"./src/demux/demuxer-inline.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var events=__webpack_require__("./src/events.js"),errors=__webpack_require__("./src/errors.ts"),crypt_decrypter=__webpack_require__("./src/crypt/decrypter.js"),number=__webpack_require__("./src/polyfills/number.js"),logger=__webpack_require__("./src/utils/logger.js"),get_self_scope=__webpack_require__("./src/utils/get-self-scope.js");function isHeaderPattern(data,offset){return 255===data[offset]&&240==(246&data[offset+1])}function getHeaderLength(data,offset){return 1&data[offset+1]?7:9}function getFullFrameLength(data,offset){return(3&data[offset+3])<<11|data[offset+4]<<3|(224&data[offset+5])>>>5}function isHeader(data,offset){return!!(offset+1<data.length&&isHeaderPattern(data,offset))}function adts_probe(data,offset){if(isHeader(data,offset)){var headerLength=getHeaderLength(data,offset);if(offset+headerLength>=data.length)return!1;var frameLength=getFullFrameLength(data,offset);if(frameLength<=headerLength)return!1;var newOffset=offset+frameLength;if(newOffset===data.length||newOffset+1<data.length&&isHeaderPattern(data,newOffset))return!0}return!1}function initTrackConfig(track,observer,data,offset,audioCodec){if(!track.samplerate){var config=(function(observer,data,offset,audioCodec){var adtsObjectType,adtsSampleingIndex,adtsExtensionSampleingIndex,adtsChanelConfig,config,userAgent=navigator.userAgent.toLowerCase(),manifestCodec=audioCodec,adtsSampleingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];if(adtsObjectType=1+((192&data[offset+2])>>>6),!((adtsSampleingIndex=(60&data[offset+2])>>>2)>adtsSampleingRates.length-1))return adtsChanelConfig=(1&data[offset+2])<<2,adtsChanelConfig|=(192&data[offset+3])>>>6,logger.logger.log("manifest codec:"+audioCodec+",ADTS data:type:"+adtsObjectType+",sampleingIndex:"+adtsSampleingIndex+"["+adtsSampleingRates[adtsSampleingIndex]+"Hz],channelConfig:"+adtsChanelConfig),/firefox/i.test(userAgent)?adtsSampleingIndex>=6?(adtsObjectType=5,config=new Array(4),adtsExtensionSampleingIndex=adtsSampleingIndex-3):(adtsObjectType=2,config=new Array(2),adtsExtensionSampleingIndex=adtsSampleingIndex):-1!==userAgent.indexOf("android")?(adtsObjectType=2,config=new Array(2),adtsExtensionSampleingIndex=adtsSampleingIndex):(adtsObjectType=5,config=new Array(4),audioCodec&&(-1!==audioCodec.indexOf("mp4a.40.29")||-1!==audioCodec.indexOf("mp4a.40.5"))||!audioCodec&&adtsSampleingIndex>=6?adtsExtensionSampleingIndex=adtsSampleingIndex-3:((audioCodec&&-1!==audioCodec.indexOf("mp4a.40.2")&&(adtsSampleingIndex>=6&&1===adtsChanelConfig||/vivaldi/i.test(userAgent))||!audioCodec&&1===adtsChanelConfig)&&(adtsObjectType=2,config=new Array(2)),adtsExtensionSampleingIndex=adtsSampleingIndex)),config[0]=adtsObjectType<<3,config[0]|=(14&adtsSampleingIndex)>>1,config[1]|=(1&adtsSampleingIndex)<<7,config[1]|=adtsChanelConfig<<3,5===adtsObjectType&&(config[1]|=(14&adtsExtensionSampleingIndex)>>1,config[2]=(1&adtsExtensionSampleingIndex)<<7,config[2]|=8,config[3]=0),{config,samplerate:adtsSampleingRates[adtsSampleingIndex],channelCount:adtsChanelConfig,codec:"mp4a.40."+adtsObjectType,manifestCodec};observer.trigger(events.default.ERROR,{type:errors.ErrorTypes.MEDIA_ERROR,details:errors.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+adtsSampleingIndex})})(observer,data,offset,audioCodec);track.config=config.config,track.samplerate=config.samplerate,track.channelCount=config.channelCount,track.codec=config.codec,track.manifestCodec=config.manifestCodec,logger.logger.log("parsed codec:"+track.codec+",rate:"+config.samplerate+",nb channel:"+config.channelCount)}}function getFrameDuration(samplerate){return 9216e4/samplerate}function appendFrame(track,data,offset,pts,frameIndex){var header=(function(data,offset,pts,frameIndex,frameDuration){var headerLength,frameLength,length=data.length;if(headerLength=getHeaderLength(data,offset),frameLength=getFullFrameLength(data,offset),(frameLength-=headerLength)>0&&offset+headerLength+frameLength<=length)return{headerLength,frameLength,stamp:pts+frameIndex*frameDuration}})(data,offset,pts,frameIndex,getFrameDuration(track.samplerate));if(header){var stamp=header.stamp,headerLength=header.headerLength,frameLength=header.frameLength,aacSample={unit:data.subarray(offset+headerLength,offset+headerLength+frameLength),pts:stamp,dts:stamp};return track.samples.push(aacSample),{sample:aacSample,length:frameLength+headerLength}}}var id3=__webpack_require__("./src/demux/id3.js"),aacdemuxer=(function(){function AACDemuxer(observer,remuxer,config){this.observer=observer,this.config=config,this.remuxer=remuxer}var _proto=AACDemuxer.prototype;return _proto.resetInitSegment=function(initSegment,audioCodec,videoCodec,duration){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:audioCodec,duration,inputTimeScale:9e4}},_proto.resetTimeStamp=function(){},AACDemuxer.probe=function(data){if(!data)return!1;for(var offset=(id3.default.getID3Data(data,0)||[]).length,length=data.length;offset<length;offset++)if(adts_probe(data,offset))return logger.logger.log("ADTS sync word found !"),!0;return!1},_proto.append=function(data,timeOffset,contiguous,accurateTimeOffset){for(var track=this._audioTrack,id3Data=id3.default.getID3Data(data,0)||[],timestamp=id3.default.getTimeStamp(id3Data),pts=Object(number.isFiniteNumber)(timestamp)?90*timestamp:9e4*timeOffset,frameIndex=0,stamp=pts,length=data.length,offset=id3Data.length,id3Samples=[{pts:stamp,dts:stamp,data:id3Data}];offset<length-1;)if(isHeader(data,offset)&&offset+5<length){initTrackConfig(track,this.observer,data,offset,track.manifestCodec);var frame=appendFrame(track,data,offset,pts,frameIndex);if(!frame){logger.logger.log("Unable to parse AAC frame");break}offset+=frame.length,stamp=frame.sample.pts,frameIndex++}else id3.default.isHeader(data,offset)?(id3Data=id3.default.getID3Data(data,offset),id3Samples.push({pts:stamp,dts:stamp,data:id3Data}),offset+=id3Data.length):offset++;this.remuxer.remux(track,{samples:[]},{samples:id3Samples,inputTimeScale:9e4},{samples:[]},timeOffset,contiguous,accurateTimeOffset)},_proto.destroy=function(){},AACDemuxer})(),mp4demuxer=__webpack_require__("./src/demux/mp4demuxer.js"),MpegAudio={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(track,data,offset,pts,frameIndex){if(!(offset+24>data.length)){var header=this.parseHeader(data,offset);if(header&&offset+header.frameLength<=data.length){var stamp=pts+frameIndex*(9e4*header.samplesPerFrame/header.sampleRate),sample={unit:data.subarray(offset,offset+header.frameLength),pts:stamp,dts:stamp};return track.config=[],track.channelCount=header.channelCount,track.samplerate=header.sampleRate,track.samples.push(sample),{sample,length:header.frameLength}}}},parseHeader:function(data,offset){var headerB=data[offset+1]>>3&3,headerC=data[offset+1]>>1&3,headerE=data[offset+2]>>4&15,headerF=data[offset+2]>>2&3,headerG=data[offset+2]>>1&1;if(1!==headerB&&0!==headerE&&15!==headerE&&3!==headerF){var columnInBitrates=3===headerB?3-headerC:3===headerC?3:4,bitRate=1e3*MpegAudio.BitratesMap[14*columnInBitrates+headerE-1],columnInSampleRates=3===headerB?0:2===headerB?1:2,sampleRate=MpegAudio.SamplingRateMap[3*columnInSampleRates+headerF],channelCount=data[offset+3]>>6==3?1:2,sampleCoefficient=MpegAudio.SamplesCoefficients[headerB][headerC],bytesInSlot=MpegAudio.BytesInSlot[headerC],samplesPerFrame=8*sampleCoefficient*bytesInSlot;return{sampleRate,channelCount,frameLength:parseInt(sampleCoefficient*bitRate/sampleRate+headerG,10)*bytesInSlot,samplesPerFrame}}},isHeaderPattern:function(data,offset){return 255===data[offset]&&224==(224&data[offset+1])&&0!=(6&data[offset+1])},isHeader:function(data,offset){return!!(offset+1<data.length&&this.isHeaderPattern(data,offset))},probe:function(data,offset){if(offset+1<data.length&&this.isHeaderPattern(data,offset)){var header=this.parseHeader(data,offset),frameLength=4;header&&header.frameLength&&(frameLength=header.frameLength);var newOffset=offset+frameLength;if(newOffset===data.length||newOffset+1<data.length&&this.isHeaderPattern(data,newOffset))return!0}return!1}},mpegaudio=MpegAudio,exp_golomb=(function(){function ExpGolomb(data){this.data=data,this.bytesAvailable=data.byteLength,this.word=0,this.bitsAvailable=0}var _proto=ExpGolomb.prototype;return _proto.loadWord=function(){var data=this.data,bytesAvailable=this.bytesAvailable,position=data.byteLength-bytesAvailable,workingBytes=new Uint8Array(4),availableBytes=Math.min(4,bytesAvailable);if(0===availableBytes)throw new Error("no bytes available");workingBytes.set(data.subarray(position,position+availableBytes)),this.word=new DataView(workingBytes.buffer).getUint32(0),this.bitsAvailable=8*availableBytes,this.bytesAvailable-=availableBytes},_proto.skipBits=function(count){var skipBytes;this.bitsAvailable>count?(this.word<<=count,this.bitsAvailable-=count):(count-=this.bitsAvailable,count-=(skipBytes=count>>3)>>3,this.bytesAvailable-=skipBytes,this.loadWord(),this.word<<=count,this.bitsAvailable-=count)},_proto.readBits=function(size){var bits=Math.min(this.bitsAvailable,size),valu=this.word>>>32-bits;return size>32&&logger.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=bits,this.bitsAvailable>0?this.word<<=bits:this.bytesAvailable>0&&this.loadWord(),(bits=size-bits)>0&&this.bitsAvailable?valu<<bits|this.readBits(bits):valu},_proto.skipLZ=function(){var leadingZeroCount;for(leadingZeroCount=0;leadingZeroCount<this.bitsAvailable;++leadingZeroCount)if(0!=(this.word&2147483648>>>leadingZeroCount))return this.word<<=leadingZeroCount,this.bitsAvailable-=leadingZeroCount,leadingZeroCount;return this.loadWord(),leadingZeroCount+this.skipLZ()},_proto.skipUEG=function(){this.skipBits(1+this.skipLZ())},_proto.skipEG=function(){this.skipBits(1+this.skipLZ())},_proto.readUEG=function(){var clz=this.skipLZ();return this.readBits(clz+1)-1},_proto.readEG=function(){var valu=this.readUEG();return 1&valu?1+valu>>>1:-1*(valu>>>1)},_proto.readBoolean=function(){return 1===this.readBits(1)},_proto.readUByte=function(){return this.readBits(8)},_proto.readUShort=function(){return this.readBits(16)},_proto.readUInt=function(){return this.readBits(32)},_proto.skipScalingList=function(count){var j,lastScale=8,nextScale=8;for(j=0;j<count;j++)0!==nextScale&&(nextScale=(lastScale+this.readEG()+256)%256),lastScale=0===nextScale?lastScale:nextScale},_proto.readSPS=function(){var profileIdc,numRefFramesInPicOrderCntCycle,picWidthInMbsMinus1,picHeightInMapUnitsMinus1,frameMbsOnlyFlag,scalingListCount,i,frameCropLeftOffset=0,frameCropRightOffset=0,frameCropTopOffset=0,frameCropBottomOffset=0,readUByte=this.readUByte.bind(this),readBits=this.readBits.bind(this),readUEG=this.readUEG.bind(this),readBoolean=this.readBoolean.bind(this),skipBits=this.skipBits.bind(this),skipEG=this.skipEG.bind(this),skipUEG=this.skipUEG.bind(this),skipScalingList=this.skipScalingList.bind(this);if(readUByte(),profileIdc=readUByte(),readBits(5),skipBits(3),readUByte(),skipUEG(),100===profileIdc||110===profileIdc||122===profileIdc||244===profileIdc||44===profileIdc||83===profileIdc||86===profileIdc||118===profileIdc||128===profileIdc){var chromaFormatIdc=readUEG();if(3===chromaFormatIdc&&skipBits(1),skipUEG(),skipUEG(),skipBits(1),readBoolean())for(scalingListCount=3!==chromaFormatIdc?8:12,i=0;i<scalingListCount;i++)readBoolean()&&skipScalingList(i<6?16:64)}skipUEG();var picOrderCntType=readUEG();if(0===picOrderCntType)readUEG();else if(1===picOrderCntType)for(skipBits(1),skipEG(),skipEG(),numRefFramesInPicOrderCntCycle=readUEG(),i=0;i<numRefFramesInPicOrderCntCycle;i++)skipEG();skipUEG(),skipBits(1),picWidthInMbsMinus1=readUEG(),picHeightInMapUnitsMinus1=readUEG(),0===(frameMbsOnlyFlag=readBits(1))&&skipBits(1),skipBits(1),readBoolean()&&(frameCropLeftOffset=readUEG(),frameCropRightOffset=readUEG(),frameCropTopOffset=readUEG(),frameCropBottomOffset=readUEG());var pixelRatio=[1,1];if(readBoolean()&&readBoolean())switch(readUByte()){case 1:pixelRatio=[1,1];break;case 2:pixelRatio=[12,11];break;case 3:pixelRatio=[10,11];break;case 4:pixelRatio=[16,11];break;case 5:pixelRatio=[40,33];break;case 6:pixelRatio=[24,11];break;case 7:pixelRatio=[20,11];break;case 8:pixelRatio=[32,11];break;case 9:pixelRatio=[80,33];break;case 10:pixelRatio=[18,11];break;case 11:pixelRatio=[15,11];break;case 12:pixelRatio=[64,33];break;case 13:pixelRatio=[160,99];break;case 14:pixelRatio=[4,3];break;case 15:pixelRatio=[3,2];break;case 16:pixelRatio=[2,1];break;case 255:pixelRatio=[readUByte()<<8|readUByte(),readUByte()<<8|readUByte()]}return{width:Math.ceil(16*(picWidthInMbsMinus1+1)-2*frameCropLeftOffset-2*frameCropRightOffset),height:(2-frameMbsOnlyFlag)*(picHeightInMapUnitsMinus1+1)*16-(frameMbsOnlyFlag?2:4)*(frameCropTopOffset+frameCropBottomOffset),pixelRatio}},_proto.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},ExpGolomb})(),sample_aes=(function(){function SampleAesDecrypter(observer,config,decryptdata,discardEPB){this.decryptdata=decryptdata,this.discardEPB=discardEPB,this.decrypter=new crypt_decrypter.default(observer,config,{removePKCS7Padding:!1})}var _proto=SampleAesDecrypter.prototype;return _proto.decryptBuffer=function(encryptedData,callback){this.decrypter.decrypt(encryptedData,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,callback)},_proto.decryptAacSample=function(samples,sampleIndex,callback,sync){var curUnit=samples[sampleIndex].unit,encryptedData=curUnit.subarray(16,curUnit.length-curUnit.length%16),encryptedBuffer=encryptedData.buffer.slice(encryptedData.byteOffset,encryptedData.byteOffset+encryptedData.length),localthis=this;this.decryptBuffer(encryptedBuffer,(function(decryptedData){decryptedData=new Uint8Array(decryptedData),curUnit.set(decryptedData,16),sync||localthis.decryptAacSamples(samples,sampleIndex+1,callback)}))},_proto.decryptAacSamples=function(samples,sampleIndex,callback){for(;;sampleIndex++){if(sampleIndex>=samples.length)return void callback();if(!(samples[sampleIndex].unit.length<32)){var sync=this.decrypter.isSync();if(this.decryptAacSample(samples,sampleIndex,callback,sync),!sync)return}}},_proto.getAvcEncryptedData=function(decodedData){for(var encryptedDataLen=16*Math.floor((decodedData.length-48)/160)+16,encryptedData=new Int8Array(encryptedDataLen),outputPos=0,inputPos=32;inputPos<=decodedData.length-16;inputPos+=160,outputPos+=16)encryptedData.set(decodedData.subarray(inputPos,inputPos+16),outputPos);return encryptedData},_proto.getAvcDecryptedUnit=function(decodedData,decryptedData){decryptedData=new Uint8Array(decryptedData);for(var inputPos=0,outputPos=32;outputPos<=decodedData.length-16;outputPos+=160,inputPos+=16)decodedData.set(decryptedData.subarray(inputPos,inputPos+16),outputPos);return decodedData},_proto.decryptAvcSample=function(samples,sampleIndex,unitIndex,callback,curUnit,sync){var decodedData=this.discardEPB(curUnit.data),encryptedData=this.getAvcEncryptedData(decodedData),localthis=this;this.decryptBuffer(encryptedData.buffer,(function(decryptedData){curUnit.data=localthis.getAvcDecryptedUnit(decodedData,decryptedData),sync||localthis.decryptAvcSamples(samples,sampleIndex,unitIndex+1,callback)}))},_proto.decryptAvcSamples=function(samples,sampleIndex,unitIndex,callback){for(;;sampleIndex++,unitIndex=0){if(sampleIndex>=samples.length)return void callback();for(var curUnits=samples[sampleIndex].units;!(unitIndex>=curUnits.length);unitIndex++){var curUnit=curUnits[unitIndex];if(!(curUnit.data.length<=48||1!==curUnit.type&&5!==curUnit.type)){var sync=this.decrypter.isSync();if(this.decryptAvcSample(samples,sampleIndex,unitIndex,callback,curUnit,sync),!sync)return}}}},SampleAesDecrypter})(),RemuxerTrackIdConfig={video:1,audio:2,id3:3,text:4},tsdemuxer=(function(){function TSDemuxer(observer,remuxer,config,typeSupported){this.observer=observer,this.config=config,this.typeSupported=typeSupported,this.remuxer=remuxer,this.sampleAes=null,this.pmtUnknownTypes={}}var _proto=TSDemuxer.prototype;return _proto.setDecryptData=function(decryptdata){null!=decryptdata&&null!=decryptdata.key&&"SAMPLE-AES"===decryptdata.method?this.sampleAes=new sample_aes(this.observer,this.config,decryptdata,this.discardEPB):this.sampleAes=null},TSDemuxer.probe=function(data){var syncOffset=TSDemuxer._syncOffset(data);return!(syncOffset<0||(syncOffset&&logger.logger.warn("MPEG2-TS detected but first sync word found @ offset "+syncOffset+", junk ahead ?"),0))},TSDemuxer._syncOffset=function(data){for(var scanwindow=Math.min(1e3,data.length-564),i=0;i<scanwindow;){if(71===data[i]&&71===data[i+188]&&71===data[i+376])return i;i++}return-1},TSDemuxer.createTrack=function(type,duration){return{container:"video"===type||"audio"===type?"video/mp2t":void 0,type,id:RemuxerTrackIdConfig[type],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:"video"===type?0:void 0,isAAC:"audio"===type||void 0,duration:"audio"===type?duration:void 0}},_proto.resetInitSegment=function(initSegment,audioCodec,videoCodec,duration){this.pmtParsed=!1,this._pmtId=-1,this.pmtUnknownTypes={},this._avcTrack=TSDemuxer.createTrack("video",duration),this._audioTrack=TSDemuxer.createTrack("audio",duration),this._id3Track=TSDemuxer.createTrack("id3",duration),this._txtTrack=TSDemuxer.createTrack("text",duration),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=audioCodec,this.videoCodec=videoCodec,this._duration=duration},_proto.resetTimeStamp=function(){},_proto.append=function(data,timeOffset,contiguous,accurateTimeOffset){var start,stt,pid,offset,pes,len=data.length,unknownPIDs=!1;this.pmtUnknownTypes={},this.contiguous=contiguous;var pmtParsed=this.pmtParsed,avcTrack=this._avcTrack,audioTrack=this._audioTrack,id3Track=this._id3Track,avcId=avcTrack.pid,audioId=audioTrack.pid,id3Id=id3Track.pid,pmtId=this._pmtId,avcData=avcTrack.pesData,audioData=audioTrack.pesData,id3Data=id3Track.pesData,parsePAT=this._parsePAT,parsePMT=this._parsePMT.bind(this),parsePES=this._parsePES,parseAVCPES=this._parseAVCPES.bind(this),parseAACPES=this._parseAACPES.bind(this),parseMPEGPES=this._parseMPEGPES.bind(this),parseID3PES=this._parseID3PES.bind(this),syncOffset=TSDemuxer._syncOffset(data);for(len-=(len+syncOffset)%188,start=syncOffset;start<len;start+=188)if(71===data[start]){if(stt=!!(64&data[start+1]),pid=((31&data[start+1])<<8)+data[start+2],(48&data[start+3])>>4>1){if((offset=start+5+data[start+4])===start+188)continue}else offset=start+4;switch(pid){case avcId:stt&&(avcData&&(pes=parsePES(avcData))&&parseAVCPES(pes,!1),avcData={data:[],size:0}),avcData&&(avcData.data.push(data.subarray(offset,start+188)),avcData.size+=start+188-offset);break;case audioId:stt&&(audioData&&(pes=parsePES(audioData))&&(audioTrack.isAAC?parseAACPES(pes):parseMPEGPES(pes)),audioData={data:[],size:0}),audioData&&(audioData.data.push(data.subarray(offset,start+188)),audioData.size+=start+188-offset);break;case id3Id:stt&&(id3Data&&(pes=parsePES(id3Data))&&parseID3PES(pes),id3Data={data:[],size:0}),id3Data&&(id3Data.data.push(data.subarray(offset,start+188)),id3Data.size+=start+188-offset);break;case 0:stt&&(offset+=data[offset]+1),pmtId=this._pmtId=parsePAT(data,offset);break;case pmtId:stt&&(offset+=data[offset]+1);var parsedPIDs=parsePMT(data,offset,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);(avcId=parsedPIDs.avc)>0&&(avcTrack.pid=avcId),(audioId=parsedPIDs.audio)>0&&(audioTrack.pid=audioId,audioTrack.isAAC=parsedPIDs.isAAC),(id3Id=parsedPIDs.id3)>0&&(id3Track.pid=id3Id),unknownPIDs&&!pmtParsed&&(logger.logger.log("reparse from beginning"),unknownPIDs=!1,start=syncOffset-188),pmtParsed=this.pmtParsed=!0;break;case 17:case 8191:break;default:unknownPIDs=!0}}else this.observer.trigger(events.default.ERROR,{type:errors.ErrorTypes.MEDIA_ERROR,details:errors.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});avcData&&(pes=parsePES(avcData))?(parseAVCPES(pes,!0),avcTrack.pesData=null):avcTrack.pesData=avcData,audioData&&(pes=parsePES(audioData))?(audioTrack.isAAC?parseAACPES(pes):parseMPEGPES(pes),audioTrack.pesData=null):(audioData&&audioData.size&&logger.logger.log("last AAC PES packet truncated,might overlap between fragments"),audioTrack.pesData=audioData),id3Data&&(pes=parsePES(id3Data))?(parseID3PES(pes),id3Track.pesData=null):id3Track.pesData=id3Data,null==this.sampleAes?this.remuxer.remux(audioTrack,avcTrack,id3Track,this._txtTrack,timeOffset,contiguous,accurateTimeOffset):this.decryptAndRemux(audioTrack,avcTrack,id3Track,this._txtTrack,timeOffset,contiguous,accurateTimeOffset)},_proto.decryptAndRemux=function(audioTrack,videoTrack,id3Track,textTrack,timeOffset,contiguous,accurateTimeOffset){if(audioTrack.samples&&audioTrack.isAAC){var localthis=this;this.sampleAes.decryptAacSamples(audioTrack.samples,0,(function(){localthis.decryptAndRemuxAvc(audioTrack,videoTrack,id3Track,textTrack,timeOffset,contiguous,accurateTimeOffset)}))}else this.decryptAndRemuxAvc(audioTrack,videoTrack,id3Track,textTrack,timeOffset,contiguous,accurateTimeOffset)},_proto.decryptAndRemuxAvc=function(audioTrack,videoTrack,id3Track,textTrack,timeOffset,contiguous,accurateTimeOffset){if(videoTrack.samples){var localthis=this;this.sampleAes.decryptAvcSamples(videoTrack.samples,0,0,(function(){localthis.remuxer.remux(audioTrack,videoTrack,id3Track,textTrack,timeOffset,contiguous,accurateTimeOffset)}))}else this.remuxer.remux(audioTrack,videoTrack,id3Track,textTrack,timeOffset,contiguous,accurateTimeOffset)},_proto.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},_proto._parsePAT=function(data,offset){return(31&data[offset+10])<<8|data[offset+11]},_proto._trackUnknownPmt=function(type,logLevel,message){var result=this.pmtUnknownTypes[type]||0;return 0===result&&(this.pmtUnknownTypes[type]=0,logLevel.call(logger.logger,message)),this.pmtUnknownTypes[type]++,result},_proto._parsePMT=function(data,offset,mpegSupported,isSampleAes){var tableEnd,pid,result={audio:-1,avc:-1,id3:-1,isAAC:!0};for(tableEnd=offset+3+((15&data[offset+1])<<8|data[offset+2])-4,offset+=12+((15&data[offset+10])<<8|data[offset+11]);offset<tableEnd;){switch(pid=(31&data[offset+1])<<8|data[offset+2],data[offset]){case 207:if(!isSampleAes){this._trackUnknownPmt(data[offset],logger.logger.warn,"ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===result.audio&&(result.audio=pid);break;case 21:-1===result.id3&&(result.id3=pid);break;case 219:if(!isSampleAes){this._trackUnknownPmt(data[offset],logger.logger.warn,"H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===result.avc&&(result.avc=pid);break;case 3:case 4:mpegSupported?-1===result.audio&&(result.audio=pid,result.isAAC=!1):this._trackUnknownPmt(data[offset],logger.logger.warn,"MPEG audio found, not supported in this browser");break;case 36:this._trackUnknownPmt(data[offset],logger.logger.warn,"Unsupported HEVC stream type found");break;default:this._trackUnknownPmt(data[offset],logger.logger.log,"Unknown stream type:"+data[offset])}offset+=5+((15&data[offset+3])<<8|data[offset+4])}return result},_proto._parsePES=function(stream){var frag,pesFlags,pesLen,pesHdrLen,pesData,pesPts,pesDts,payloadStartOffset,i=0,data=stream.data;if(!stream||0===stream.size)return null;for(;data[0].length<19&&data.length>1;){var newData=new Uint8Array(data[0].length+data[1].length);newData.set(data[0]),newData.set(data[1],data[0].length),data[0]=newData,data.splice(1,1)}if(1===((frag=data[0])[0]<<16)+(frag[1]<<8)+frag[2]){if((pesLen=(frag[4]<<8)+frag[5])&&pesLen>stream.size-6)return null;if(192&(pesFlags=frag[7])&&(pesPts=536870912*(14&frag[9])+4194304*(255&frag[10])+16384*(254&frag[11])+128*(255&frag[12])+(254&frag[13])/2,64&pesFlags?pesPts-(pesDts=536870912*(14&frag[14])+4194304*(255&frag[15])+16384*(254&frag[16])+128*(255&frag[17])+(254&frag[18])/2)>54e5&&(logger.logger.warn(Math.round((pesPts-pesDts)/9e4)+"s delta between PTS and DTS, align them"),pesPts=pesDts):pesDts=pesPts),payloadStartOffset=(pesHdrLen=frag[8])+9,stream.size<=payloadStartOffset)return null;stream.size-=payloadStartOffset,pesData=new Uint8Array(stream.size);for(var j=0,dataLen=data.length;j<dataLen;j++){var len=(frag=data[j]).byteLength;if(payloadStartOffset){if(payloadStartOffset>len){payloadStartOffset-=len;continue}frag=frag.subarray(payloadStartOffset),len-=payloadStartOffset,payloadStartOffset=0}pesData.set(frag,i),i+=len}return pesLen&&(pesLen-=pesHdrLen+3),{data:pesData,pts:pesPts,dts:pesDts,len:pesLen}}return null},_proto.pushAccesUnit=function(avcSample,avcTrack){if(avcSample.units.length&&avcSample.frame){var samples=avcTrack.samples,nbSamples=samples.length;if(isNaN(avcSample.pts)){if(!nbSamples)return void avcTrack.dropped++;var lastSample=samples[nbSamples-1];avcSample.pts=lastSample.pts,avcSample.dts=lastSample.dts}!this.config.forceKeyFrameOnDiscontinuity||!0===avcSample.key||avcTrack.sps&&(nbSamples||this.contiguous)?(avcSample.id=nbSamples,samples.push(avcSample)):avcTrack.dropped++}avcSample.debug.length&&logger.logger.log(avcSample.pts+"/"+avcSample.dts+":"+avcSample.debug)},_proto._parseAVCPES=function(pes,last){var expGolombDecoder,push,i,_this=this,track=this._avcTrack,units=this._parseAVCNALu(pes.data),avcSample=this.avcSample,spsfound=!1,pushAccesUnit=this.pushAccesUnit.bind(this),createAVCSample=function(key,pts,dts,debug){return{key,pts,dts,units:[],debug}};pes.data=null,avcSample&&units.length&&!track.audFound&&(pushAccesUnit(avcSample,track),avcSample=this.avcSample=createAVCSample(!1,pes.pts,pes.dts,"")),units.forEach((function(unit){switch(unit.type){case 1:push=!0,avcSample||(avcSample=_this.avcSample=createAVCSample(!0,pes.pts,pes.dts,"")),avcSample.frame=!0;var data=unit.data;if(spsfound&&data.length>4){var sliceType=new exp_golomb(data).readSliceType();2!==sliceType&&4!==sliceType&&7!==sliceType&&9!==sliceType||(avcSample.key=!0)}break;case 5:push=!0,avcSample||(avcSample=_this.avcSample=createAVCSample(!0,pes.pts,pes.dts,"")),avcSample.key=!0,avcSample.frame=!0;break;case 6:push=!0,(expGolombDecoder=new exp_golomb(_this.discardEPB(unit.data))).readUByte();for(var payloadType=0,payloadSize=0,endOfCaptions=!1,b=0;!endOfCaptions&&expGolombDecoder.bytesAvailable>1;){payloadType=0;do{payloadType+=b=expGolombDecoder.readUByte()}while(255===b);payloadSize=0;do{payloadSize+=b=expGolombDecoder.readUByte()}while(255===b);if(4===payloadType&&0!==expGolombDecoder.bytesAvailable){if(endOfCaptions=!0,181===expGolombDecoder.readUByte()&&49===expGolombDecoder.readUShort()&&1195456820===expGolombDecoder.readUInt()&&3===expGolombDecoder.readUByte()){var firstByte=expGolombDecoder.readUByte(),totalCCs=31&firstByte,byteArray=[firstByte,expGolombDecoder.readUByte()];for(i=0;i<totalCCs;i++)byteArray.push(expGolombDecoder.readUByte()),byteArray.push(expGolombDecoder.readUByte()),byteArray.push(expGolombDecoder.readUByte());_this._insertSampleInOrder(_this._txtTrack.samples,{type:3,pts:pes.pts,bytes:byteArray})}}else if(5===payloadType&&0!==expGolombDecoder.bytesAvailable){if(endOfCaptions=!0,payloadSize>16){var uuidStrArray=[];for(i=0;i<16;i++)uuidStrArray.push(expGolombDecoder.readUByte().toString(16)),3!==i&&5!==i&&7!==i&&9!==i||uuidStrArray.push("-");var length=payloadSize-16,userDataPayloadBytes=new Uint8Array(length);for(i=0;i<length;i++)userDataPayloadBytes[i]=expGolombDecoder.readUByte();_this._insertSampleInOrder(_this._txtTrack.samples,{pts:pes.pts,payloadType,uuid:uuidStrArray.join(""),userDataBytes:userDataPayloadBytes,userData:Object(id3.utf8ArrayToStr)(userDataPayloadBytes.buffer)})}}else if(payloadSize<expGolombDecoder.bytesAvailable)for(i=0;i<payloadSize;i++)expGolombDecoder.readUByte()}break;case 7:if(push=!0,spsfound=!0,!track.sps){var config=(expGolombDecoder=new exp_golomb(unit.data)).readSPS();track.width=config.width,track.height=config.height,track.pixelRatio=config.pixelRatio,track.sps=[unit.data],track.duration=_this._duration;var codecarray=unit.data.subarray(1,4),codecstring="avc1.";for(i=0;i<3;i++){var h=codecarray[i].toString(16);h.length<2&&(h="0"+h),codecstring+=h}track.codec=codecstring}break;case 8:push=!0,track.pps||(track.pps=[unit.data]);break;case 9:push=!1,track.audFound=!0,avcSample&&pushAccesUnit(avcSample,track),avcSample=_this.avcSample=createAVCSample(!1,pes.pts,pes.dts,"");break;case 12:push=!1;break;default:push=!1,avcSample&&(avcSample.debug+="unknown NAL "+unit.type+" ")}avcSample&&push&&avcSample.units.push(unit)})),last&&avcSample&&(pushAccesUnit(avcSample,track),this.avcSample=null)},_proto._insertSampleInOrder=function(arr,data){var len=arr.length;if(len>0){if(data.pts>=arr[len-1].pts)arr.push(data);else for(var pos=len-1;pos>=0;pos--)if(data.pts<arr[pos].pts){arr.splice(pos,0,data);break}}else arr.push(data)},_proto._getLastNalUnit=function(){var lastUnit,avcSample=this.avcSample;if(!avcSample||0===avcSample.units.length){var samples=this._avcTrack.samples;avcSample=samples[samples.length-1]}if(avcSample){var units=avcSample.units;lastUnit=units[units.length-1]}return lastUnit},_proto._parseAVCNALu=function(array){var value,overflow,unit,lastUnitType,i=0,len=array.byteLength,track=this._avcTrack,state=track.naluState||0,lastState=state,units=[],lastUnitStart=-1;for(-1===state&&(lastUnitStart=0,lastUnitType=31&array[0],state=0,i=1);i<len;)if(value=array[i++],state)if(1!==state)if(value)if(1===value){if(lastUnitStart>=0)unit={data:array.subarray(lastUnitStart,i-state-1),type:lastUnitType},units.push(unit);else{var lastUnit=this._getLastNalUnit();if(lastUnit&&(lastState&&i<=4-lastState&&lastUnit.state&&(lastUnit.data=lastUnit.data.subarray(0,lastUnit.data.byteLength-lastState)),(overflow=i-state-1)>0)){var tmp=new Uint8Array(lastUnit.data.byteLength+overflow);tmp.set(lastUnit.data,0),tmp.set(array.subarray(0,overflow),lastUnit.data.byteLength),lastUnit.data=tmp}}i<len?(lastUnitStart=i,lastUnitType=31&array[i],state=0):state=-1}else state=0;else state=3;else state=value?0:2;else state=value?0:1;if(lastUnitStart>=0&&state>=0&&(unit={data:array.subarray(lastUnitStart,len),type:lastUnitType,state},units.push(unit)),0===units.length){var _lastUnit=this._getLastNalUnit();if(_lastUnit){var _tmp=new Uint8Array(_lastUnit.data.byteLength+array.byteLength);_tmp.set(_lastUnit.data,0),_tmp.set(array,_lastUnit.data.byteLength),_lastUnit.data=_tmp}}return track.naluState=state,units},_proto.discardEPB=function(data){for(var newLength,newData,length=data.byteLength,EPBPositions=[],i=1;i<length-2;)0===data[i]&&0===data[i+1]&&3===data[i+2]?(EPBPositions.push(i+2),i+=2):i++;if(0===EPBPositions.length)return data;newLength=length-EPBPositions.length,newData=new Uint8Array(newLength);var sourceIndex=0;for(i=0;i<newLength;sourceIndex++,i++)sourceIndex===EPBPositions[0]&&(sourceIndex++,EPBPositions.shift()),newData[i]=data[sourceIndex];return newData},_proto._parseAACPES=function(pes){var frameDuration,frameIndex,offset,stamp,len,reason,fatal,track=this._audioTrack,data=pes.data,pts=pes.pts,aacOverFlow=this.aacOverFlow,aacLastPTS=this.aacLastPTS;if(aacOverFlow){var tmp=new Uint8Array(aacOverFlow.byteLength+data.byteLength);tmp.set(aacOverFlow,0),tmp.set(data,aacOverFlow.byteLength),data=tmp}for(offset=0,len=data.length;offset<len-1&&!isHeader(data,offset);offset++);if(!offset||(offset<len-1?(reason="AAC PES did not start with ADTS header,offset:"+offset,fatal=!1):(reason="no ADTS header found in AAC PES",fatal=!0),logger.logger.warn("parsing error:"+reason),this.observer.trigger(events.default.ERROR,{type:errors.ErrorTypes.MEDIA_ERROR,details:errors.ErrorDetails.FRAG_PARSING_ERROR,fatal,reason}),!fatal)){if(initTrackConfig(track,this.observer,data,offset,this.audioCodec),frameIndex=0,frameDuration=getFrameDuration(track.samplerate),aacOverFlow&&aacLastPTS){var newPTS=aacLastPTS+frameDuration;Math.abs(newPTS-pts)>1&&(logger.logger.log("AAC: align PTS for overlapping frames by "+Math.round((newPTS-pts)/90)),pts=newPTS)}for(;offset<len;){if(isHeader(data,offset)){if(offset+5<len){var frame=appendFrame(track,data,offset,pts,frameIndex);if(frame){offset+=frame.length,stamp=frame.sample.pts,frameIndex++;continue}}break}offset++}aacOverFlow=offset<len?data.subarray(offset,len):null,this.aacOverFlow=aacOverFlow,this.aacLastPTS=stamp}},_proto._parseMPEGPES=function(pes){for(var data=pes.data,length=data.length,frameIndex=0,offset=0,pts=pes.pts;offset<length;)if(mpegaudio.isHeader(data,offset)){var frame=mpegaudio.appendFrame(this._audioTrack,data,offset,pts,frameIndex);if(!frame)break;offset+=frame.length,frameIndex++}else offset++},_proto._parseID3PES=function(pes){this._id3Track.samples.push(pes)},TSDemuxer})(),mp3demuxer=(function(){function MP3Demuxer(observer,remuxer,config){this.observer=observer,this.config=config,this.remuxer=remuxer}var _proto=MP3Demuxer.prototype;return _proto.resetInitSegment=function(initSegment,audioCodec,videoCodec,duration){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:audioCodec,duration,inputTimeScale:9e4}},_proto.resetTimeStamp=function(){},MP3Demuxer.probe=function(data){var offset,length,id3Data=id3.default.getID3Data(data,0);if(id3Data&&void 0!==id3.default.getTimeStamp(id3Data))for(offset=id3Data.length,length=Math.min(data.length-1,offset+100);offset<length;offset++)if(mpegaudio.probe(data,offset))return logger.logger.log("MPEG Audio sync word found !"),!0;return!1},_proto.append=function(data,timeOffset,contiguous,accurateTimeOffset){for(var id3Data=id3.default.getID3Data(data,0)||[],timestamp=id3.default.getTimeStamp(id3Data),pts=void 0!==timestamp?90*timestamp:9e4*timeOffset,offset=id3Data.length,length=data.length,frameIndex=0,stamp=0,track=this._audioTrack,id3Samples=[{pts,dts:pts,data:id3Data}];offset<length;)if(mpegaudio.isHeader(data,offset)){var frame=mpegaudio.appendFrame(track,data,offset,pts,frameIndex);if(!frame)break;offset+=frame.length,stamp=frame.sample.pts,frameIndex++}else id3.default.isHeader(data,offset)?(id3Data=id3.default.getID3Data(data,offset),id3Samples.push({pts:stamp,dts:stamp,data:id3Data}),offset+=id3Data.length):offset++;this.remuxer.remux(track,{samples:[]},{samples:id3Samples,inputTimeScale:9e4},{samples:[]},timeOffset,contiguous,accurateTimeOffset)},_proto.destroy=function(){},MP3Demuxer})(),aac_helper=(function(){function AAC(){}return AAC.getSilentFrame=function(codec,channelCount){switch(codec){case"mp4a.40.2":if(1===channelCount)return new Uint8Array([0,200,0,128,35,128]);if(2===channelCount)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===channelCount)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===channelCount)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===channelCount)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===channelCount)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===channelCount)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===channelCount)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===channelCount)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},AAC})(),UINT32_MAX=Math.pow(2,32)-1,mp4_generator=(function(){function MP4(){}return MP4.init=function(){var i;for(i in MP4.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},MP4.types)MP4.types.hasOwnProperty(i)&&(MP4.types[i]=[i.charCodeAt(0),i.charCodeAt(1),i.charCodeAt(2),i.charCodeAt(3)]);var videoHdlr=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),audioHdlr=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);MP4.HDLR_TYPES={video:videoHdlr,audio:audioHdlr};var dref=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),stco=new Uint8Array([0,0,0,0,0,0,0,0]);MP4.STTS=MP4.STSC=MP4.STCO=stco,MP4.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),MP4.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),MP4.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),MP4.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var majorBrand=new Uint8Array([105,115,111,109]),avc1Brand=new Uint8Array([97,118,99,49]),minorVersion=new Uint8Array([0,0,0,1]);MP4.FTYP=MP4.box(MP4.types.ftyp,majorBrand,minorVersion,majorBrand,avc1Brand),MP4.DINF=MP4.box(MP4.types.dinf,MP4.box(MP4.types.dref,dref))},MP4.box=function(type){for(var result,payload=Array.prototype.slice.call(arguments,1),size=8,i=payload.length,len=i;i--;)size+=payload[i].byteLength;for((result=new Uint8Array(size))[0]=size>>24&255,result[1]=size>>16&255,result[2]=size>>8&255,result[3]=255&size,result.set(type,4),i=0,size=8;i<len;i++)result.set(payload[i],size),size+=payload[i].byteLength;return result},MP4.hdlr=function(type){return MP4.box(MP4.types.hdlr,MP4.HDLR_TYPES[type])},MP4.mdat=function(data){return MP4.box(MP4.types.mdat,data)},MP4.mdhd=function(timescale,duration){duration*=timescale;var upperWordDuration=Math.floor(duration/(UINT32_MAX+1)),lowerWordDuration=Math.floor(duration%(UINT32_MAX+1));return MP4.box(MP4.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,timescale>>24&255,timescale>>16&255,timescale>>8&255,255&timescale,upperWordDuration>>24,upperWordDuration>>16&255,upperWordDuration>>8&255,255&upperWordDuration,lowerWordDuration>>24,lowerWordDuration>>16&255,lowerWordDuration>>8&255,255&lowerWordDuration,85,196,0,0]))},MP4.mdia=function(track){return MP4.box(MP4.types.mdia,MP4.mdhd(track.timescale,track.duration),MP4.hdlr(track.type),MP4.minf(track))},MP4.mfhd=function(sequenceNumber){return MP4.box(MP4.types.mfhd,new Uint8Array([0,0,0,0,sequenceNumber>>24,sequenceNumber>>16&255,sequenceNumber>>8&255,255&sequenceNumber]))},MP4.minf=function(track){return"audio"===track.type?MP4.box(MP4.types.minf,MP4.box(MP4.types.smhd,MP4.SMHD),MP4.DINF,MP4.stbl(track)):MP4.box(MP4.types.minf,MP4.box(MP4.types.vmhd,MP4.VMHD),MP4.DINF,MP4.stbl(track))},MP4.moof=function(sn,baseMediaDecodeTime,track){return MP4.box(MP4.types.moof,MP4.mfhd(sn),MP4.traf(track,baseMediaDecodeTime))},MP4.moov=function(tracks){for(var i=tracks.length,boxes=[];i--;)boxes[i]=MP4.trak(tracks[i]);return MP4.box.apply(null,[MP4.types.moov,MP4.mvhd(tracks[0].timescale,tracks[0].duration)].concat(boxes).concat(MP4.mvex(tracks)))},MP4.mvex=function(tracks){for(var i=tracks.length,boxes=[];i--;)boxes[i]=MP4.trex(tracks[i]);return MP4.box.apply(null,[MP4.types.mvex].concat(boxes))},MP4.mvhd=function(timescale,duration){duration*=timescale;var upperWordDuration=Math.floor(duration/(UINT32_MAX+1)),lowerWordDuration=Math.floor(duration%(UINT32_MAX+1)),bytes=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,timescale>>24&255,timescale>>16&255,timescale>>8&255,255&timescale,upperWordDuration>>24,upperWordDuration>>16&255,upperWordDuration>>8&255,255&upperWordDuration,lowerWordDuration>>24,lowerWordDuration>>16&255,lowerWordDuration>>8&255,255&lowerWordDuration,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return MP4.box(MP4.types.mvhd,bytes)},MP4.sdtp=function(track){var flags,i,samples=track.samples||[],bytes=new Uint8Array(4+samples.length);for(i=0;i<samples.length;i++)flags=samples[i].flags,bytes[i+4]=flags.dependsOn<<4|flags.isDependedOn<<2|flags.hasRedundancy;return MP4.box(MP4.types.sdtp,bytes)},MP4.stbl=function(track){return MP4.box(MP4.types.stbl,MP4.stsd(track),MP4.box(MP4.types.stts,MP4.STTS),MP4.box(MP4.types.stsc,MP4.STSC),MP4.box(MP4.types.stsz,MP4.STSZ),MP4.box(MP4.types.stco,MP4.STCO))},MP4.avc1=function(track){var i,data,len,sps=[],pps=[];for(i=0;i<track.sps.length;i++)len=(data=track.sps[i]).byteLength,sps.push(len>>>8&255),sps.push(255&len),sps=sps.concat(Array.prototype.slice.call(data));for(i=0;i<track.pps.length;i++)len=(data=track.pps[i]).byteLength,pps.push(len>>>8&255),pps.push(255&len),pps=pps.concat(Array.prototype.slice.call(data));var avcc=MP4.box(MP4.types.avcC,new Uint8Array([1,sps[3],sps[4],sps[5],255,224|track.sps.length].concat(sps).concat([track.pps.length]).concat(pps))),width=track.width,height=track.height,hSpacing=track.pixelRatio[0],vSpacing=track.pixelRatio[1];return MP4.box(MP4.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,width>>8&255,255&width,height>>8&255,255&height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),avcc,MP4.box(MP4.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),MP4.box(MP4.types.pasp,new Uint8Array([hSpacing>>24,hSpacing>>16&255,hSpacing>>8&255,255&hSpacing,vSpacing>>24,vSpacing>>16&255,vSpacing>>8&255,255&vSpacing])))},MP4.esds=function(track){var configlen=track.config.length;return new Uint8Array([0,0,0,0,3,23+configlen,0,1,0,4,15+configlen,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([configlen]).concat(track.config).concat([6,1,2]))},MP4.mp4a=function(track){var samplerate=track.samplerate;return MP4.box(MP4.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,track.channelCount,0,16,0,0,0,0,samplerate>>8&255,255&samplerate,0,0]),MP4.box(MP4.types.esds,MP4.esds(track)))},MP4.mp3=function(track){var samplerate=track.samplerate;return MP4.box(MP4.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,track.channelCount,0,16,0,0,0,0,samplerate>>8&255,255&samplerate,0,0]))},MP4.stsd=function(track){return"audio"===track.type?track.isAAC||"mp3"!==track.codec?MP4.box(MP4.types.stsd,MP4.STSD,MP4.mp4a(track)):MP4.box(MP4.types.stsd,MP4.STSD,MP4.mp3(track)):MP4.box(MP4.types.stsd,MP4.STSD,MP4.avc1(track))},MP4.tkhd=function(track){var id=track.id,duration=track.duration*track.timescale,width=track.width,height=track.height,upperWordDuration=Math.floor(duration/(UINT32_MAX+1)),lowerWordDuration=Math.floor(duration%(UINT32_MAX+1));return MP4.box(MP4.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,id>>24&255,id>>16&255,id>>8&255,255&id,0,0,0,0,upperWordDuration>>24,upperWordDuration>>16&255,upperWordDuration>>8&255,255&upperWordDuration,lowerWordDuration>>24,lowerWordDuration>>16&255,lowerWordDuration>>8&255,255&lowerWordDuration,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,width>>8&255,255&width,0,0,height>>8&255,255&height,0,0]))},MP4.traf=function(track,baseMediaDecodeTime){var sampleDependencyTable=MP4.sdtp(track),id=track.id,upperWordBaseMediaDecodeTime=Math.floor(baseMediaDecodeTime/(UINT32_MAX+1)),lowerWordBaseMediaDecodeTime=Math.floor(baseMediaDecodeTime%(UINT32_MAX+1));return MP4.box(MP4.types.traf,MP4.box(MP4.types.tfhd,new Uint8Array([0,0,0,0,id>>24,id>>16&255,id>>8&255,255&id])),MP4.box(MP4.types.tfdt,new Uint8Array([1,0,0,0,upperWordBaseMediaDecodeTime>>24,upperWordBaseMediaDecodeTime>>16&255,upperWordBaseMediaDecodeTime>>8&255,255&upperWordBaseMediaDecodeTime,lowerWordBaseMediaDecodeTime>>24,lowerWordBaseMediaDecodeTime>>16&255,lowerWordBaseMediaDecodeTime>>8&255,255&lowerWordBaseMediaDecodeTime])),MP4.trun(track,sampleDependencyTable.length+16+20+8+16+8+8),sampleDependencyTable)},MP4.trak=function(track){return track.duration=track.duration||4294967295,MP4.box(MP4.types.trak,MP4.tkhd(track),MP4.mdia(track))},MP4.trex=function(track){var id=track.id;return MP4.box(MP4.types.trex,new Uint8Array([0,0,0,0,id>>24,id>>16&255,id>>8&255,255&id,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},MP4.trun=function(track,offset){var i,sample,duration,size,flags,cts,samples=track.samples||[],len=samples.length,arraylen=12+16*len,array=new Uint8Array(arraylen);for(offset+=8+arraylen,array.set([0,0,15,1,len>>>24&255,len>>>16&255,len>>>8&255,255&len,offset>>>24&255,offset>>>16&255,offset>>>8&255,255&offset],0),i=0;i<len;i++)duration=(sample=samples[i]).duration,size=sample.size,flags=sample.flags,cts=sample.cts,array.set([duration>>>24&255,duration>>>16&255,duration>>>8&255,255&duration,size>>>24&255,size>>>16&255,size>>>8&255,255&size,flags.isLeading<<2|flags.dependsOn,flags.isDependedOn<<6|flags.hasRedundancy<<4|flags.paddingValue<<1|flags.isNonSync,61440&flags.degradPrio,15&flags.degradPrio,cts>>>24&255,cts>>>16&255,cts>>>8&255,255&cts],12+16*i);return MP4.box(MP4.types.trun,array)},MP4.initSegment=function(tracks){MP4.types||MP4.init();var result,movie=MP4.moov(tracks);return(result=new Uint8Array(MP4.FTYP.byteLength+movie.byteLength)).set(MP4.FTYP),result.set(movie,MP4.FTYP.byteLength),result},MP4})();function toTimescaleFromBase(value,destScale,srcBase,round){void 0===srcBase&&(srcBase=1),void 0===round&&(round=!1);var result=value*destScale*srcBase;return round?Math.round(result):result}function toMsFromMpegTsClock(value,round){return void 0===round&&(round=!1),toTimescaleFromBase(value,1e3,1/9e4,round)}function toMpegTsClockFromTimescale(value,srcScale){return void 0===srcScale&&(srcScale=1),toTimescaleFromBase(value,9e4,1/srcScale)}var MAX_SILENT_FRAME_DURATION_90KHZ=toMpegTsClockFromTimescale(10),PTS_DTS_SHIFT_TOLERANCE_90KHZ=toMpegTsClockFromTimescale(.2),chromeVersion=null;function PTSNormalize(value,reference){var offset;if(void 0===reference)return value;for(offset=reference<value?-8589934592:8589934592;Math.abs(value-reference)>4294967296;)value+=offset;return value}var now,mp4_remuxer=(function(){function MP4Remuxer(observer,config,typeSupported,vendor){if(this.observer=observer,this.config=config,this.typeSupported=typeSupported,this.ISGenerated=!1,null===chromeVersion){var result=navigator.userAgent.match(/Chrome\/(\d+)/i);chromeVersion=result?parseInt(result[1]):0}}var _proto=MP4Remuxer.prototype;return _proto.destroy=function(){},_proto.resetTimeStamp=function(defaultTimeStamp){this._initPTS=this._initDTS=defaultTimeStamp},_proto.resetInitSegment=function(){this.ISGenerated=!1},_proto.getVideoStartPts=function(videoSamples){var rolloverDetected=!1,startPTS=videoSamples.reduce((function(minPTS,sample){var delta=sample.pts-minPTS;return delta<-4294967296?(rolloverDetected=!0,PTSNormalize(minPTS,sample.pts)):delta>0?minPTS:sample.pts}),videoSamples[0].pts);return rolloverDetected&&logger.logger.debug("PTS rollover detected"),startPTS},_proto.remux=function(audioTrack,videoTrack,id3Track,textTrack,timeOffset,contiguous,accurateTimeOffset){if(this.ISGenerated||this.generateIS(audioTrack,videoTrack,timeOffset),this.ISGenerated){var nbAudioSamples=audioTrack.samples.length,nbVideoSamples=videoTrack.samples.length,audioTimeOffset=timeOffset,videoTimeOffset=timeOffset;if(nbAudioSamples&&nbVideoSamples){var startPTS=this.getVideoStartPts(videoTrack.samples),audiovideoTimestampDelta=(PTSNormalize(audioTrack.samples[0].pts,startPTS)-startPTS)/videoTrack.inputTimeScale;audioTimeOffset+=Math.max(0,audiovideoTimestampDelta),videoTimeOffset+=Math.max(0,-audiovideoTimestampDelta)}if(nbAudioSamples){audioTrack.timescale||(logger.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(audioTrack,videoTrack,timeOffset));var audioTrackLength,audioData=this.remuxAudio(audioTrack,audioTimeOffset,contiguous,accurateTimeOffset);nbVideoSamples&&(audioData&&(audioTrackLength=audioData.endPTS-audioData.startPTS),videoTrack.timescale||(logger.logger.warn("regenerate InitSegment as video detected"),this.generateIS(audioTrack,videoTrack,timeOffset)),this.remuxVideo(videoTrack,videoTimeOffset,contiguous,audioTrackLength))}else if(nbVideoSamples){var videoData=this.remuxVideo(videoTrack,videoTimeOffset,contiguous,0,accurateTimeOffset);videoData&&audioTrack.codec&&this.remuxEmptyAudio(audioTrack,audioTimeOffset,contiguous,videoData)}}id3Track.samples.length&&this.remuxID3(id3Track,timeOffset),textTrack.samples.length&&this.remuxText(textTrack,timeOffset),this.observer.trigger(events.default.FRAG_PARSED)},_proto.generateIS=function(audioTrack,videoTrack,timeOffset){var initPTS,initDTS,observer=this.observer,audioSamples=audioTrack.samples,videoSamples=videoTrack.samples,typeSupported=this.typeSupported,container="audio/mp4",tracks={},data={tracks},computePTSDTS=void 0===this._initPTS;if(computePTSDTS&&(initPTS=initDTS=1/0),audioTrack.config&&audioSamples.length&&(audioTrack.timescale=audioTrack.samplerate,logger.logger.log("audio sampling rate : "+audioTrack.samplerate),audioTrack.isAAC||(typeSupported.mpeg?(container="audio/mpeg",audioTrack.codec=""):typeSupported.mp3&&(audioTrack.codec="mp3")),tracks.audio={container,codec:audioTrack.codec,initSegment:!audioTrack.isAAC&&typeSupported.mpeg?new Uint8Array:mp4_generator.initSegment([audioTrack]),metadata:{channelCount:audioTrack.channelCount}},computePTSDTS&&(initPTS=initDTS=audioSamples[0].pts-Math.round(audioTrack.inputTimeScale*timeOffset))),videoTrack.sps&&videoTrack.pps&&videoSamples.length){var inputTimeScale=videoTrack.inputTimeScale;if(videoTrack.timescale=inputTimeScale,tracks.video={container:"video/mp4",codec:videoTrack.codec,initSegment:mp4_generator.initSegment([videoTrack]),metadata:{width:videoTrack.width,height:videoTrack.height}},computePTSDTS){var startPTS=this.getVideoStartPts(videoSamples),startOffset=Math.round(inputTimeScale*timeOffset);initDTS=Math.min(initDTS,PTSNormalize(videoSamples[0].dts,startPTS)-startOffset),initPTS=Math.min(initPTS,startPTS-startOffset),this.observer.trigger(events.default.INIT_PTS_FOUND,{initPTS})}}else computePTSDTS&&tracks.audio&&this.observer.trigger(events.default.INIT_PTS_FOUND,{initPTS});Object.keys(tracks).length?(observer.trigger(events.default.FRAG_PARSING_INIT_SEGMENT,data),this.ISGenerated=!0,computePTSDTS&&(this._initPTS=initPTS,this._initDTS=initDTS)):observer.trigger(events.default.ERROR,{type:errors.ErrorTypes.MEDIA_ERROR,details:errors.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},_proto.remuxVideo=function(track,timeOffset,contiguous,audioTrackLength){var mp4SampleDuration,mdat,moof,firstDTS,lastDTS,timeScale=track.timescale,inputSamples=track.samples,outputSamples=[],nbSamples=inputSamples.length,initPTS=this._initPTS,offset=8,minPTS=Number.POSITIVE_INFINITY,maxPTS=Number.NEGATIVE_INFINITY,ptsDtsShift=0,sortSamples=!1,nextAvcDts=this.nextAvcDts;if(0!==nbSamples){contiguous||(nextAvcDts=timeOffset*timeScale-(inputSamples[0].pts-PTSNormalize(inputSamples[0].dts,inputSamples[0].pts)));for(var i=0;i<nbSamples;i++){var sample=inputSamples[i];sample.pts=PTSNormalize(sample.pts-initPTS,nextAvcDts),sample.dts=PTSNormalize(sample.dts-initPTS,nextAvcDts),sample.dts>sample.pts&&(ptsDtsShift=Math.max(Math.min(ptsDtsShift,sample.pts-sample.dts),-1*PTS_DTS_SHIFT_TOLERANCE_90KHZ)),sample.dts<inputSamples[i>0?i-1:i].dts&&(sortSamples=!0)}sortSamples&&inputSamples.sort((function(a,b){var deltadts=a.dts-b.dts,deltapts=a.pts-b.pts;return deltadts||deltapts||a.id-b.id})),firstDTS=inputSamples[0].dts,lastDTS=inputSamples[nbSamples-1].dts;var averageSampleDuration=Math.round((lastDTS-firstDTS)/(nbSamples-1));if(ptsDtsShift<0){if(ptsDtsShift<-2*averageSampleDuration){logger.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+toMsFromMpegTsClock(-averageSampleDuration,!0)+" ms");for(var lastDts=ptsDtsShift,_i=0;_i<nbSamples;_i++)inputSamples[_i].dts=lastDts=Math.max(lastDts,inputSamples[_i].pts-averageSampleDuration),inputSamples[_i].pts=Math.max(lastDts,inputSamples[_i].pts)}else{logger.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+toMsFromMpegTsClock(ptsDtsShift,!0)+" ms to overcome this issue");for(var _i2=0;_i2<nbSamples;_i2++)inputSamples[_i2].dts=inputSamples[_i2].dts+ptsDtsShift}firstDTS=inputSamples[0].dts,lastDTS=inputSamples[nbSamples-1].dts}if(contiguous){var delta=firstDTS-nextAvcDts,foundHole=delta>averageSampleDuration;if(foundHole||delta<-1){foundHole?logger.logger.warn("AVC: "+toMsFromMpegTsClock(delta,!0)+" ms ("+delta+"dts) hole between fragments detected, filling it"):logger.logger.warn("AVC: "+toMsFromMpegTsClock(-delta,!0)+" ms ("+delta+"dts) overlapping between fragments detected"),firstDTS=nextAvcDts;var firstPTS=inputSamples[0].pts-delta;inputSamples[0].dts=firstDTS,inputSamples[0].pts=firstPTS,logger.logger.log("Video: First PTS/DTS adjusted: "+toMsFromMpegTsClock(firstPTS,!0)+"/"+toMsFromMpegTsClock(firstDTS,!0)+", delta: "+toMsFromMpegTsClock(delta,!0)+" ms")}}chromeVersion&&chromeVersion<75&&(firstDTS=Math.max(0,firstDTS));for(var nbNalu=0,naluLen=0,_i3=0;_i3<nbSamples;_i3++){for(var _sample=inputSamples[_i3],units=_sample.units,nbUnits=units.length,sampleLen=0,j=0;j<nbUnits;j++)sampleLen+=units[j].data.length;naluLen+=sampleLen,nbNalu+=nbUnits,_sample.length=sampleLen,_sample.dts=Math.max(_sample.dts,firstDTS),_sample.pts=Math.max(_sample.pts,_sample.dts,0),minPTS=Math.min(_sample.pts,minPTS),maxPTS=Math.max(_sample.pts,maxPTS)}lastDTS=inputSamples[nbSamples-1].dts;var mdatSize=naluLen+4*nbNalu+8;try{mdat=new Uint8Array(mdatSize)}catch(err){return void this.observer.trigger(events.default.ERROR,{type:errors.ErrorTypes.MUX_ERROR,details:errors.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:mdatSize,reason:"fail allocating video mdat "+mdatSize})}var view=new DataView(mdat.buffer);view.setUint32(0,mdatSize),mdat.set(mp4_generator.types.mdat,4);for(var _i4=0;_i4<nbSamples;_i4++){for(var compositionTimeOffset,avcSample=inputSamples[_i4],avcSampleUnits=avcSample.units,mp4SampleLength=0,_j=0,_nbUnits=avcSampleUnits.length;_j<_nbUnits;_j++){var unit=avcSampleUnits[_j],unitData=unit.data,unitDataLen=unit.data.byteLength;view.setUint32(offset,unitDataLen),offset+=4,mdat.set(unitData,offset),offset+=unitDataLen,mp4SampleLength+=4+unitDataLen}if(_i4<nbSamples-1)mp4SampleDuration=inputSamples[_i4+1].dts-avcSample.dts;else{var config=this.config,lastFrameDuration=avcSample.dts-inputSamples[_i4>0?_i4-1:_i4].dts;if(config.stretchShortVideoTrack){var maxBufferHole=config.maxBufferHole,gapTolerance=Math.floor(maxBufferHole*timeScale),deltaToFrameEnd=(audioTrackLength?minPTS+audioTrackLength*timeScale:this.nextAudioPts)-avcSample.pts;deltaToFrameEnd>gapTolerance?((mp4SampleDuration=deltaToFrameEnd-lastFrameDuration)<0&&(mp4SampleDuration=lastFrameDuration),logger.logger.log("It is approximately "+toMsFromMpegTsClock(deltaToFrameEnd,!1)+" ms to the next segment; using duration "+toMsFromMpegTsClock(mp4SampleDuration,!1)+" ms for the last video frame.")):mp4SampleDuration=lastFrameDuration}else mp4SampleDuration=lastFrameDuration}compositionTimeOffset=Math.round(avcSample.pts-avcSample.dts),outputSamples.push({size:mp4SampleLength,duration:mp4SampleDuration,cts:compositionTimeOffset,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:avcSample.key?2:1,isNonSync:avcSample.key?0:1}})}this.nextAvcDts=lastDTS+mp4SampleDuration;var dropped=track.dropped;if(track.nbNalu=0,track.dropped=0,outputSamples.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var flags=outputSamples[0].flags;flags.dependsOn=2,flags.isNonSync=0}track.samples=outputSamples,moof=mp4_generator.moof(track.sequenceNumber++,firstDTS,track),track.samples=[];var data={data1:moof,data2:mdat,startPTS:minPTS/timeScale,endPTS:(maxPTS+mp4SampleDuration)/timeScale,startDTS:firstDTS/timeScale,endDTS:this.nextAvcDts/timeScale,type:"video",hasAudio:!1,hasVideo:!0,nb:outputSamples.length,dropped};return this.observer.trigger(events.default.FRAG_PARSING_DATA,data),data}},_proto.remuxAudio=function(track,timeOffset,contiguous,accurateTimeOffset){var mp4Sample,fillFrame,mdat,moof,firstPTS,lastPTS,inputTimeScale=track.inputTimeScale,mp4timeScale=track.timescale,scaleFactor=inputTimeScale/mp4timeScale,inputSampleDuration=(track.isAAC?1024:1152)*scaleFactor,initPTS=this._initPTS,rawMPEG=!track.isAAC&&this.typeSupported.mpeg,offset=rawMPEG?0:8,inputSamples=track.samples,outputSamples=[],nextAudioPts=this.nextAudioPts;if(contiguous|=inputSamples.length&&nextAudioPts&&(accurateTimeOffset&&Math.abs(timeOffset-nextAudioPts/inputTimeScale)<.1||Math.abs(inputSamples[0].pts-nextAudioPts-initPTS)<20*inputSampleDuration),inputSamples.forEach((function(sample){sample.pts=sample.dts=PTSNormalize(sample.pts-initPTS,timeOffset*inputTimeScale)})),0!==(inputSamples=inputSamples.filter((function(sample){return sample.pts>=0}))).length){if(contiguous||(nextAudioPts=accurateTimeOffset?Math.max(0,timeOffset*inputTimeScale):inputSamples[0].pts),track.isAAC)for(var maxAudioFramesDrift=this.config.maxAudioFramesDrift,i=0,nextPts=nextAudioPts;i<inputSamples.length;){var sample=inputSamples[i],pts=sample.pts,delta=pts-nextPts;if(delta<=-maxAudioFramesDrift*inputSampleDuration)contiguous||i>0?(logger.logger.warn("Dropping 1 audio frame @ "+toMsFromMpegTsClock(nextPts,!0)/1e3+"s due to "+toMsFromMpegTsClock(delta,!0)+" ms overlap."),inputSamples.splice(i,1)):(logger.logger.warn("Audio frame @ "+toMsFromMpegTsClock(pts,!0)/1e3+"s overlaps nextAudioPts by "+toMsFromMpegTsClock(delta,!0)+" ms."),nextPts=pts+inputSampleDuration,i++);else if(delta>=maxAudioFramesDrift*inputSampleDuration&&delta<MAX_SILENT_FRAME_DURATION_90KHZ&&nextPts){var missing=Math.round(delta/inputSampleDuration);logger.logger.warn("Injecting "+missing+" audio frames @ "+toMsFromMpegTsClock(nextPts,!0)/1e3+"s due to "+toMsFromMpegTsClock(delta,!0)+" ms gap.");for(var j=0;j<missing;j++){var newStamp=Math.max(nextPts,0);(fillFrame=aac_helper.getSilentFrame(track.manifestCodec||track.codec,track.channelCount))||(logger.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),fillFrame=sample.unit.subarray()),inputSamples.splice(i,0,{unit:fillFrame,pts:newStamp,dts:newStamp}),nextPts+=inputSampleDuration,i++}sample.pts=sample.dts=nextPts,nextPts+=inputSampleDuration,i++}else Math.abs(delta),sample.pts=sample.dts=nextPts,nextPts+=inputSampleDuration,i++}for(var nbSamples=inputSamples.length,mdatSize=0;nbSamples--;)mdatSize+=inputSamples[nbSamples].unit.byteLength;for(var _j2=0,_nbSamples=inputSamples.length;_j2<_nbSamples;_j2++){var audioSample=inputSamples[_j2],unit=audioSample.unit,_pts=audioSample.pts;if(void 0!==lastPTS&&mp4Sample)mp4Sample.duration=Math.round((_pts-lastPTS)/scaleFactor);else{var _delta=_pts-nextAudioPts,numMissingFrames=0;if(contiguous&&track.isAAC&&_delta){if(_delta>0&&_delta<MAX_SILENT_FRAME_DURATION_90KHZ)numMissingFrames=Math.round((_pts-nextAudioPts)/inputSampleDuration),logger.logger.log(toMsFromMpegTsClock(_delta,!0)+" ms hole between AAC samples detected,filling it"),numMissingFrames>0&&((fillFrame=aac_helper.getSilentFrame(track.manifestCodec||track.codec,track.channelCount))||(fillFrame=unit.subarray()),mdatSize+=numMissingFrames*fillFrame.length);else if(_delta<-12){logger.logger.log("drop overlapping AAC sample, expected/parsed/delta: "+toMsFromMpegTsClock(nextAudioPts,!0)+" ms / "+toMsFromMpegTsClock(_pts,!0)+" ms / "+toMsFromMpegTsClock(-_delta,!0)+" ms"),mdatSize-=unit.byteLength;continue}_pts=nextAudioPts}if(firstPTS=_pts,!(mdatSize>0))return;mdatSize+=offset;try{mdat=new Uint8Array(mdatSize)}catch(err){return void this.observer.trigger(events.default.ERROR,{type:errors.ErrorTypes.MUX_ERROR,details:errors.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:mdatSize,reason:"fail allocating audio mdat "+mdatSize})}rawMPEG||(new DataView(mdat.buffer).setUint32(0,mdatSize),mdat.set(mp4_generator.types.mdat,4));for(var _i5=0;_i5<numMissingFrames;_i5++)(fillFrame=aac_helper.getSilentFrame(track.manifestCodec||track.codec,track.channelCount))||(logger.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),fillFrame=unit.subarray()),mdat.set(fillFrame,offset),offset+=fillFrame.byteLength,mp4Sample={size:fillFrame.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},outputSamples.push(mp4Sample)}mdat.set(unit,offset);var unitLen=unit.byteLength;offset+=unitLen,mp4Sample={size:unitLen,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},outputSamples.push(mp4Sample),lastPTS=_pts}var lastSampleDuration=0;if((nbSamples=outputSamples.length)>=2&&(lastSampleDuration=outputSamples[nbSamples-2].duration,mp4Sample.duration=lastSampleDuration),nbSamples){this.nextAudioPts=nextAudioPts=lastPTS+scaleFactor*lastSampleDuration,track.samples=outputSamples,moof=rawMPEG?new Uint8Array:mp4_generator.moof(track.sequenceNumber++,firstPTS/scaleFactor,track),track.samples=[];var start=firstPTS/inputTimeScale,end=nextAudioPts/inputTimeScale,audioData={data1:moof,data2:mdat,startPTS:start,endPTS:end,startDTS:start,endDTS:end,type:"audio",hasAudio:!0,hasVideo:!1,nb:nbSamples};return this.observer.trigger(events.default.FRAG_PARSING_DATA,audioData),audioData}return null}},_proto.remuxEmptyAudio=function(track,timeOffset,contiguous,videoData){var inputTimeScale=track.inputTimeScale,scaleFactor=inputTimeScale/(track.samplerate?track.samplerate:inputTimeScale),nextAudioPts=this.nextAudioPts,startDTS=(void 0!==nextAudioPts?nextAudioPts:videoData.startDTS*inputTimeScale)+this._initDTS,endDTS=videoData.endDTS*inputTimeScale+this._initDTS,frameDuration=1024*scaleFactor,nbSamples=Math.ceil((endDTS-startDTS)/frameDuration),silentFrame=aac_helper.getSilentFrame(track.manifestCodec||track.codec,track.channelCount);if(logger.logger.warn("remux empty Audio"),silentFrame){for(var samples=[],i=0;i<nbSamples;i++){var stamp=startDTS+i*frameDuration;samples.push({unit:silentFrame,pts:stamp,dts:stamp})}track.samples=samples,this.remuxAudio(track,timeOffset,contiguous)}else logger.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")},_proto.remuxID3=function(track,timeOffset){var length=track.samples.length;if(length){for(var inputTimeScale=track.inputTimeScale,initPTS=this._initPTS,initDTS=this._initDTS,index=0;index<length;index++){var sample=track.samples[index];sample.pts=PTSNormalize(sample.pts-initPTS,timeOffset*inputTimeScale)/inputTimeScale,sample.dts=PTSNormalize(sample.dts-initDTS,timeOffset*inputTimeScale)/inputTimeScale}this.observer.trigger(events.default.FRAG_PARSING_METADATA,{samples:track.samples}),track.samples=[]}},_proto.remuxText=function(track,timeOffset){var length=track.samples.length,inputTimeScale=track.inputTimeScale,initPTS=this._initPTS;if(length){for(var index=0;index<length;index++){var sample=track.samples[index];sample.pts=PTSNormalize(sample.pts-initPTS,timeOffset*inputTimeScale)/inputTimeScale}track.samples.sort((function(a,b){return a.pts-b.pts})),this.observer.trigger(events.default.FRAG_PARSING_USERDATA,{samples:track.samples})}track.samples=[]},MP4Remuxer})(),passthrough_remuxer=(function(){function PassThroughRemuxer(observer){this.observer=observer}var _proto=PassThroughRemuxer.prototype;return _proto.destroy=function(){},_proto.resetTimeStamp=function(){},_proto.resetInitSegment=function(){},_proto.remux=function(audioTrack,videoTrack,id3Track,textTrack,timeOffset,contiguous,accurateTimeOffset,rawData){var observer=this.observer,streamType="";audioTrack&&(streamType+="audio"),videoTrack&&(streamType+="video"),observer.trigger(events.default.FRAG_PARSING_DATA,{data1:rawData,startPTS:timeOffset,startDTS:timeOffset,type:streamType,hasAudio:!!audioTrack,hasVideo:!!videoTrack,nb:1,dropped:0}),observer.trigger(events.default.FRAG_PARSED)},PassThroughRemuxer})(),global=Object(get_self_scope.getSelfScope)();try{now=global.performance.now.bind(global.performance)}catch(err){logger.logger.debug("Unable to use Performance API on this environment"),now=global.Date.now}var demuxer_inline_DemuxerInline=(function(){function DemuxerInline(observer,typeSupported,config,vendor){this.observer=observer,this.typeSupported=typeSupported,this.config=config,this.vendor=vendor}var _proto=DemuxerInline.prototype;return _proto.destroy=function(){var demuxer=this.demuxer;demuxer&&demuxer.destroy()},_proto.push=function(data,decryptdata,initSegment,audioCodec,videoCodec,timeOffset,discontinuity,trackSwitch,contiguous,duration,accurateTimeOffset,defaultInitPTS){var _this=this;if(data.byteLength>0&&null!=decryptdata&&null!=decryptdata.key&&"AES-128"===decryptdata.method){var decrypter=this.decrypter;null==decrypter&&(decrypter=this.decrypter=new crypt_decrypter.default(this.observer,this.config));var startTime=now();decrypter.decrypt(data,decryptdata.key.buffer,decryptdata.iv.buffer,(function(decryptedData){var endTime=now();_this.observer.trigger(events.default.FRAG_DECRYPTED,{stats:{tstart:startTime,tdecrypt:endTime}}),_this.pushDecrypted(new Uint8Array(decryptedData),decryptdata,new Uint8Array(initSegment),audioCodec,videoCodec,timeOffset,discontinuity,trackSwitch,contiguous,duration,accurateTimeOffset,defaultInitPTS)}))}else this.pushDecrypted(new Uint8Array(data),decryptdata,new Uint8Array(initSegment),audioCodec,videoCodec,timeOffset,discontinuity,trackSwitch,contiguous,duration,accurateTimeOffset,defaultInitPTS)},_proto.pushDecrypted=function(data,decryptdata,initSegment,audioCodec,videoCodec,timeOffset,discontinuity,trackSwitch,contiguous,duration,accurateTimeOffset,defaultInitPTS){var demuxer=this.demuxer,remuxer=this.remuxer;if(!demuxer||discontinuity||trackSwitch){for(var mux,observer=this.observer,typeSupported=this.typeSupported,config=this.config,muxConfig=[{demux:tsdemuxer,remux:mp4_remuxer},{demux:mp4demuxer.default,remux:passthrough_remuxer},{demux:aacdemuxer,remux:mp4_remuxer},{demux:mp3demuxer,remux:mp4_remuxer}],i=0,len=muxConfig.length;i<len&&!(mux=muxConfig[i]).demux.probe(data);i++);if(!mux)return void observer.trigger(events.default.ERROR,{type:errors.ErrorTypes.MEDIA_ERROR,details:errors.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});remuxer&&remuxer instanceof mux.remux||(remuxer=new mux.remux(observer,config,typeSupported,this.vendor)),demuxer&&demuxer instanceof mux.demux||(demuxer=new mux.demux(observer,remuxer,config,typeSupported),this.probe=mux.demux.probe),this.demuxer=demuxer,this.remuxer=remuxer}(discontinuity||trackSwitch)&&(demuxer.resetInitSegment(initSegment,audioCodec,videoCodec,duration),remuxer.resetInitSegment()),discontinuity&&(demuxer.resetTimeStamp(defaultInitPTS),remuxer.resetTimeStamp(defaultInitPTS)),"function"==typeof demuxer.setDecryptData&&demuxer.setDecryptData(decryptdata),demuxer.append(data,timeOffset,contiguous,accurateTimeOffset)},DemuxerInline})();__webpack_exports__.default=demuxer_inline_DemuxerInline},"./src/demux/demuxer-worker.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _demux_demuxer_inline__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/demux/demuxer-inline.js"),_events__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/events.js"),_utils_logger__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/utils/logger.js"),eventemitter3__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/eventemitter3/index.js");__webpack_exports__.default=function(self){var observer=new eventemitter3__WEBPACK_IMPORTED_MODULE_3__.EventEmitter;observer.trigger=function(event){for(var _len=arguments.length,data=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)data[_key-1]=arguments[_key];observer.emit.apply(observer,[event,event].concat(data))},observer.off=function(event){for(var _len2=arguments.length,data=new Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++)data[_key2-1]=arguments[_key2];observer.removeListener.apply(observer,[event].concat(data))};var forwardMessage=function(ev,data){self.postMessage({event:ev,data})};self.addEventListener("message",(function(ev){var data=ev.data;switch(data.cmd){case"init":var config=JSON.parse(data.config);self.demuxer=new _demux_demuxer_inline__WEBPACK_IMPORTED_MODULE_0__.default(observer,data.typeSupported,config,data.vendor),Object(_utils_logger__WEBPACK_IMPORTED_MODULE_2__.enableLogs)(config.debug),forwardMessage("init",null);break;case"demux":self.demuxer.push(data.data,data.decryptdata,data.initSegment,data.audioCodec,data.videoCodec,data.timeOffset,data.discontinuity,data.trackSwitch,data.contiguous,data.duration,data.accurateTimeOffset,data.defaultInitPTS)}})),observer.on(_events__WEBPACK_IMPORTED_MODULE_1__.default.FRAG_DECRYPTED,forwardMessage),observer.on(_events__WEBPACK_IMPORTED_MODULE_1__.default.FRAG_PARSING_INIT_SEGMENT,forwardMessage),observer.on(_events__WEBPACK_IMPORTED_MODULE_1__.default.FRAG_PARSED,forwardMessage),observer.on(_events__WEBPACK_IMPORTED_MODULE_1__.default.ERROR,forwardMessage),observer.on(_events__WEBPACK_IMPORTED_MODULE_1__.default.FRAG_PARSING_METADATA,forwardMessage),observer.on(_events__WEBPACK_IMPORTED_MODULE_1__.default.FRAG_PARSING_USERDATA,forwardMessage),observer.on(_events__WEBPACK_IMPORTED_MODULE_1__.default.INIT_PTS_FOUND,forwardMessage),observer.on(_events__WEBPACK_IMPORTED_MODULE_1__.default.FRAG_PARSING_DATA,(function(ev,data){var transferable=[],message={event:ev,data};data.data1&&(message.data1=data.data1.buffer,transferable.push(data.data1.buffer),delete data.data1),data.data2&&(message.data2=data.data2.buffer,transferable.push(data.data2.buffer),delete data.data2),self.postMessage(message,transferable)}))}},"./src/demux/id3.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"utf8ArrayToStr",(function(){return utf8ArrayToStr}));var decoder,_utils_get_self_scope__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/utils/get-self-scope.js"),ID3=(function(){function ID3(){}return ID3.isHeader=function(data,offset){return offset+10<=data.length&&73===data[offset]&&68===data[offset+1]&&51===data[offset+2]&&data[offset+3]<255&&data[offset+4]<255&&data[offset+6]<128&&data[offset+7]<128&&data[offset+8]<128&&data[offset+9]<128},ID3.isFooter=function(data,offset){return offset+10<=data.length&&51===data[offset]&&68===data[offset+1]&&73===data[offset+2]&&data[offset+3]<255&&data[offset+4]<255&&data[offset+6]<128&&data[offset+7]<128&&data[offset+8]<128&&data[offset+9]<128},ID3.getID3Data=function(data,offset){for(var front=offset,length=0;ID3.isHeader(data,offset);)length+=10,length+=ID3._readSize(data,offset+6),ID3.isFooter(data,offset+10)&&(length+=10),offset+=length;if(length>0)return data.subarray(front,front+length)},ID3._readSize=function(data,offset){var size=0;return size=(127&data[offset])<<21,size|=(127&data[offset+1])<<14,size|=(127&data[offset+2])<<7,size|=127&data[offset+3]},ID3.getTimeStamp=function(data){for(var frames=ID3.getID3Frames(data),i=0;i<frames.length;i++){var frame=frames[i];if(ID3.isTimeStampFrame(frame))return ID3._readTimeStamp(frame)}},ID3.isTimeStampFrame=function(frame){return frame&&"PRIV"===frame.key&&"com.apple.streaming.transportStreamTimestamp"===frame.info},ID3._getFrameData=function(data){var type=String.fromCharCode(data[0],data[1],data[2],data[3]),size=ID3._readSize(data,4);return{type,size,data:data.subarray(10,10+size)}},ID3.getID3Frames=function(id3Data){for(var offset=0,frames=[];ID3.isHeader(id3Data,offset);){for(var size=ID3._readSize(id3Data,offset+6),end=(offset+=10)+size;offset+8<end;){var frameData=ID3._getFrameData(id3Data.subarray(offset)),frame=ID3._decodeFrame(frameData);frame&&frames.push(frame),offset+=frameData.size+10}ID3.isFooter(id3Data,offset)&&(offset+=10)}return frames},ID3._decodeFrame=function(frame){return"PRIV"===frame.type?ID3._decodePrivFrame(frame):"T"===frame.type[0]?ID3._decodeTextFrame(frame):"W"===frame.type[0]?ID3._decodeURLFrame(frame):void 0},ID3._readTimeStamp=function(timeStampFrame){if(8===timeStampFrame.data.byteLength){var data=new Uint8Array(timeStampFrame.data),pts33Bit=1&data[3],timestamp=(data[4]<<23)+(data[5]<<15)+(data[6]<<7)+data[7];return timestamp/=45,pts33Bit&&(timestamp+=47721858.84),Math.round(timestamp)}},ID3._decodePrivFrame=function(frame){if(!(frame.size<2)){var owner=ID3._utf8ArrayToStr(frame.data,!0),privateData=new Uint8Array(frame.data.subarray(owner.length+1));return{key:frame.type,info:owner,data:privateData.buffer}}},ID3._decodeTextFrame=function(frame){if(!(frame.size<2)){if("TXXX"===frame.type){var index=1,description=ID3._utf8ArrayToStr(frame.data.subarray(index),!0);index+=description.length+1;var value=ID3._utf8ArrayToStr(frame.data.subarray(index));return{key:frame.type,info:description,data:value}}var text=ID3._utf8ArrayToStr(frame.data.subarray(1));return{key:frame.type,data:text}}},ID3._decodeURLFrame=function(frame){if("WXXX"===frame.type){if(frame.size<2)return;var index=1,description=ID3._utf8ArrayToStr(frame.data.subarray(index),!0);index+=description.length+1;var value=ID3._utf8ArrayToStr(frame.data.subarray(index));return{key:frame.type,info:description,data:value}}var url=ID3._utf8ArrayToStr(frame.data);return{key:frame.type,data:url}},ID3._utf8ArrayToStr=function(array,exitOnNull){void 0===exitOnNull&&(exitOnNull=!1);var decoder=getTextDecoder();if(decoder){var decoded=decoder.decode(array);if(exitOnNull){var idx=decoded.indexOf("\0");return-1!==idx?decoded.substring(0,idx):decoded}return decoded.replace(/\0/g,"")}for(var c,char2,char3,len=array.length,out="",i=0;i<len;){if(0===(c=array[i++])&&exitOnNull)return out;if(0!==c&&3!==c)switch(c>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:out+=String.fromCharCode(c);break;case 12:case 13:char2=array[i++],out+=String.fromCharCode((31&c)<<6|63&char2);break;case 14:char2=array[i++],char3=array[i++],out+=String.fromCharCode((15&c)<<12|(63&char2)<<6|(63&char3)<<0)}}return out},ID3})();function getTextDecoder(){var global=Object(_utils_get_self_scope__WEBPACK_IMPORTED_MODULE_0__.getSelfScope)();return decoder||void 0===global.TextDecoder||(decoder=new global.TextDecoder("utf-8")),decoder}var utf8ArrayToStr=ID3._utf8ArrayToStr;__webpack_exports__.default=ID3},"./src/demux/mp4demuxer.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _utils_logger__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/utils/logger.js"),_events__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/events.js"),UINT32_MAX=Math.pow(2,32)-1,MP4Demuxer=(function(){function MP4Demuxer(observer,remuxer){this.observer=observer,this.remuxer=remuxer}var _proto=MP4Demuxer.prototype;return _proto.resetTimeStamp=function(initPTS){this.initPTS=initPTS},_proto.resetInitSegment=function(initSegment,audioCodec,videoCodec,duration){if(initSegment&&initSegment.byteLength){var initData=this.initData=MP4Demuxer.parseInitSegment(initSegment);null==audioCodec&&(audioCodec="mp4a.40.5"),null==videoCodec&&(videoCodec="avc1.42e01e");var tracks={};initData.audio&&initData.video?tracks.audiovideo={container:"video/mp4",codec:audioCodec+","+videoCodec,initSegment:duration?initSegment:null}:(initData.audio&&(tracks.audio={container:"audio/mp4",codec:audioCodec,initSegment:duration?initSegment:null}),initData.video&&(tracks.video={container:"video/mp4",codec:videoCodec,initSegment:duration?initSegment:null})),this.observer.trigger(_events__WEBPACK_IMPORTED_MODULE_1__.default.FRAG_PARSING_INIT_SEGMENT,{tracks})}else audioCodec&&(this.audioCodec=audioCodec),videoCodec&&(this.videoCodec=videoCodec)},MP4Demuxer.probe=function(data){return MP4Demuxer.findBox({data,start:0,end:Math.min(data.length,16384)},["moof"]).length>0},MP4Demuxer.bin2str=function(buffer){return String.fromCharCode.apply(null,buffer)},MP4Demuxer.readUint16=function(buffer,offset){buffer.data&&(offset+=buffer.start,buffer=buffer.data);var val=buffer[offset]<<8|buffer[offset+1];return val<0?65536+val:val},MP4Demuxer.readUint32=function(buffer,offset){buffer.data&&(offset+=buffer.start,buffer=buffer.data);var val=buffer[offset]<<24|buffer[offset+1]<<16|buffer[offset+2]<<8|buffer[offset+3];return val<0?4294967296+val:val},MP4Demuxer.writeUint32=function(buffer,offset,value){buffer.data&&(offset+=buffer.start,buffer=buffer.data),buffer[offset]=value>>24,buffer[offset+1]=value>>16&255,buffer[offset+2]=value>>8&255,buffer[offset+3]=255&value},MP4Demuxer.findBox=function(data,path){var i,size,end,subresults,start,endbox,results=[];if(data.data?(start=data.start,end=data.end,data=data.data):(start=0,end=data.byteLength),!path.length)return null;for(i=start;i<end;)endbox=(size=MP4Demuxer.readUint32(data,i))>1?i+size:end,MP4Demuxer.bin2str(data.subarray(i+4,i+8))===path[0]&&(1===path.length?results.push({data,start:i+8,end:endbox}):(subresults=MP4Demuxer.findBox({data,start:i+8,end:endbox},path.slice(1))).length&&(results=results.concat(subresults))),i=endbox;return results},MP4Demuxer.parseSegmentIndex=function(initSegment){var references,moov=MP4Demuxer.findBox(initSegment,["moov"])[0],moovEndOffset=moov?moov.end:null,index=0,sidx=MP4Demuxer.findBox(initSegment,["sidx"]);if(!sidx||!sidx[0])return null;references=[];var version=(sidx=sidx[0]).data[0];index=0===version?8:16;var timescale=MP4Demuxer.readUint32(sidx,index);index+=4,index+=0===version?8:16,index+=2;var startByte=sidx.end+0,referencesCount=MP4Demuxer.readUint16(sidx,index);index+=2;for(var i=0;i<referencesCount;i++){var referenceIndex=index,referenceInfo=MP4Demuxer.readUint32(sidx,referenceIndex);referenceIndex+=4;var referenceSize=2147483647&referenceInfo;if(1==(2147483648&referenceInfo)>>>31)return void console.warn("SIDX has hierarchical references (not supported)");var subsegmentDuration=MP4Demuxer.readUint32(sidx,referenceIndex);referenceIndex+=4,references.push({referenceSize,subsegmentDuration,info:{duration:subsegmentDuration/timescale,start:startByte,end:startByte+referenceSize-1}}),startByte+=referenceSize,index=referenceIndex+=4}return{earliestPresentationTime:0,timescale,version,referencesCount,references,moovEndOffset}},MP4Demuxer.parseInitSegment=function(initSegment){var result=[];return MP4Demuxer.findBox(initSegment,["moov","trak"]).forEach((function(trak){var tkhd=MP4Demuxer.findBox(trak,["tkhd"])[0];if(tkhd){var version=tkhd.data[tkhd.start],index=0===version?12:20,trackId=MP4Demuxer.readUint32(tkhd,index),mdhd=MP4Demuxer.findBox(trak,["mdia","mdhd"])[0];if(mdhd){index=0===(version=mdhd.data[mdhd.start])?12:20;var timescale=MP4Demuxer.readUint32(mdhd,index),hdlr=MP4Demuxer.findBox(trak,["mdia","hdlr"])[0];if(hdlr){var type={soun:"audio",vide:"video"}[MP4Demuxer.bin2str(hdlr.data.subarray(hdlr.start+8,hdlr.start+12))];if(type){var codecBox=MP4Demuxer.findBox(trak,["mdia","minf","stbl","stsd"]);if(codecBox.length){codecBox=codecBox[0];var codecType=MP4Demuxer.bin2str(codecBox.data.subarray(codecBox.start+12,codecBox.start+16));_utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.log("MP4Demuxer:"+type+":"+codecType+" found")}result[trackId]={timescale,type},result[type]={timescale,id:trackId}}}}}})),result},MP4Demuxer.getStartDTS=function(initData,fragment){var trafs,baseTimes,result;return trafs=MP4Demuxer.findBox(fragment,["moof","traf"]),baseTimes=[].concat.apply([],trafs.map((function(traf){return MP4Demuxer.findBox(traf,["tfhd"]).map((function(tfhd){var id,scale;return id=MP4Demuxer.readUint32(tfhd,4),scale=initData[id].timescale||9e4,MP4Demuxer.findBox(traf,["tfdt"]).map((function(tfdt){var version,result;return version=tfdt.data[tfdt.start],result=MP4Demuxer.readUint32(tfdt,4),1===version&&(result*=Math.pow(2,32),result+=MP4Demuxer.readUint32(tfdt,8)),result}))[0]/scale}))}))),result=Math.min.apply(null,baseTimes),isFinite(result)?result:0},MP4Demuxer.offsetStartDTS=function(initData,fragment,timeOffset){MP4Demuxer.findBox(fragment,["moof","traf"]).map((function(traf){return MP4Demuxer.findBox(traf,["tfhd"]).map((function(tfhd){var id=MP4Demuxer.readUint32(tfhd,4),timescale=initData[id].timescale||9e4;MP4Demuxer.findBox(traf,["tfdt"]).map((function(tfdt){var version=tfdt.data[tfdt.start],baseMediaDecodeTime=MP4Demuxer.readUint32(tfdt,4);if(0===version)MP4Demuxer.writeUint32(tfdt,4,baseMediaDecodeTime-timeOffset*timescale);else{baseMediaDecodeTime*=Math.pow(2,32),baseMediaDecodeTime+=MP4Demuxer.readUint32(tfdt,8),baseMediaDecodeTime-=timeOffset*timescale,baseMediaDecodeTime=Math.max(baseMediaDecodeTime,0);var upper=Math.floor(baseMediaDecodeTime/(UINT32_MAX+1)),lower=Math.floor(baseMediaDecodeTime%(UINT32_MAX+1));MP4Demuxer.writeUint32(tfdt,4,upper),MP4Demuxer.writeUint32(tfdt,8,lower)}}))}))}))},_proto.append=function(data,timeOffset,contiguous,accurateTimeOffset){var initData=this.initData;initData||(this.resetInitSegment(data,this.audioCodec,this.videoCodec,!1),initData=this.initData);var startDTS,initPTS=this.initPTS;if(void 0===initPTS){var _startDTS=MP4Demuxer.getStartDTS(initData,data);this.initPTS=initPTS=_startDTS-timeOffset,this.observer.trigger(_events__WEBPACK_IMPORTED_MODULE_1__.default.INIT_PTS_FOUND,{initPTS})}MP4Demuxer.offsetStartDTS(initData,data,initPTS),startDTS=MP4Demuxer.getStartDTS(initData,data),this.remuxer.remux(initData.audio,initData.video,null,null,startDTS,contiguous,accurateTimeOffset,data)},_proto.destroy=function(){},MP4Demuxer})();__webpack_exports__.default=MP4Demuxer},"./src/errors.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";var ErrorTypes,ErrorDetails;__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"ErrorTypes",(function(){return ErrorTypes})),__webpack_require__.d(__webpack_exports__,"ErrorDetails",(function(){return ErrorDetails})),(function(ErrorTypes){ErrorTypes.NETWORK_ERROR="networkError",ErrorTypes.MEDIA_ERROR="mediaError",ErrorTypes.KEY_SYSTEM_ERROR="keySystemError",ErrorTypes.MUX_ERROR="muxError",ErrorTypes.OTHER_ERROR="otherError"})(ErrorTypes||(ErrorTypes={})),(function(ErrorDetails){ErrorDetails.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",ErrorDetails.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",ErrorDetails.KEY_SYSTEM_NO_SESSION="keySystemNoSession",ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",ErrorDetails.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",ErrorDetails.MANIFEST_LOAD_ERROR="manifestLoadError",ErrorDetails.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",ErrorDetails.MANIFEST_PARSING_ERROR="manifestParsingError",ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",ErrorDetails.LEVEL_EMPTY_ERROR="levelEmptyError",ErrorDetails.LEVEL_LOAD_ERROR="levelLoadError",ErrorDetails.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",ErrorDetails.LEVEL_SWITCH_ERROR="levelSwitchError",ErrorDetails.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",ErrorDetails.FRAG_LOAD_ERROR="fragLoadError",ErrorDetails.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",ErrorDetails.FRAG_DECRYPT_ERROR="fragDecryptError",ErrorDetails.FRAG_PARSING_ERROR="fragParsingError",ErrorDetails.REMUX_ALLOC_ERROR="remuxAllocError",ErrorDetails.KEY_LOAD_ERROR="keyLoadError",ErrorDetails.KEY_LOAD_TIMEOUT="keyLoadTimeOut",ErrorDetails.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",ErrorDetails.BUFFER_APPEND_ERROR="bufferAppendError",ErrorDetails.BUFFER_APPENDING_ERROR="bufferAppendingError",ErrorDetails.BUFFER_STALLED_ERROR="bufferStalledError",ErrorDetails.BUFFER_FULL_ERROR="bufferFullError",ErrorDetails.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",ErrorDetails.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",ErrorDetails.INTERNAL_EXCEPTION="internalException"})(ErrorDetails||(ErrorDetails={}))},"./src/events.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_exports__.default={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVELS_UPDATED:"hlsLevelsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",CUES_PARSED:"hlsCuesParsed",NON_NATIVE_TEXT_TRACKS_FOUND:"hlsNonNativeTextTracksFound",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition",LIVE_BACK_BUFFER_REACHED:"hlsLiveBackBufferReached"}},"./src/hls.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return hls_Hls}));var cues_namespaceObject={};__webpack_require__.r(cues_namespaceObject),__webpack_require__.d(cues_namespaceObject,"newCue",(function(){return newCue}));var PlaylistContextType,PlaylistLevelType,url_toolkit=__webpack_require__("./node_modules/url-toolkit/src/url-toolkit.js"),errors=__webpack_require__("./src/errors.ts"),number=__webpack_require__("./src/polyfills/number.js"),events=__webpack_require__("./src/events.js"),logger=__webpack_require__("./src/utils/logger.js"),FORBIDDEN_EVENT_NAMES={hlsEventGeneric:!0,hlsHandlerDestroying:!0,hlsHandlerDestroyed:!0},event_handler=(function(){function EventHandler(hls){this.hls=void 0,this.handledEvents=void 0,this.useGenericHandler=void 0,this.hls=hls,this.onEvent=this.onEvent.bind(this);for(var _len=arguments.length,events=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)events[_key-1]=arguments[_key];this.handledEvents=events,this.useGenericHandler=!0,this.registerListeners()}var _proto=EventHandler.prototype;return _proto.destroy=function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},_proto.onHandlerDestroying=function(){},_proto.onHandlerDestroyed=function(){},_proto.isEventHandler=function(){return"object"==typeof this.handledEvents&&this.handledEvents.length&&"function"==typeof this.onEvent},_proto.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach((function(event){if(FORBIDDEN_EVENT_NAMES[event])throw new Error("Forbidden event-name: "+event);this.hls.on(event,this.onEvent)}),this)},_proto.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach((function(event){this.hls.off(event,this.onEvent)}),this)},_proto.onEvent=function(event,data){this.onEventGeneric(event,data)},_proto.onEventGeneric=function(event,data){try{(function(event,data){var funcName="on"+event.replace("hls","");if("function"!=typeof this[funcName])throw new Error("Event "+event+" has no generic handler in this "+this.constructor.name+" class (tried "+funcName+")");return this[funcName].bind(this,data)}).call(this,event,data).call()}catch(err){logger.logger.error("An internal error happened while handling event "+event+'. Error message: "'+err.message+'". Here is a stacktrace:',err),this.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.OTHER_ERROR,details:errors.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event,err})}},EventHandler})();!(function(PlaylistContextType){PlaylistContextType.MANIFEST="manifest",PlaylistContextType.LEVEL="level",PlaylistContextType.AUDIO_TRACK="audioTrack",PlaylistContextType.SUBTITLE_TRACK="subtitleTrack"})(PlaylistContextType||(PlaylistContextType={})),(function(PlaylistLevelType){PlaylistLevelType.MAIN="main",PlaylistLevelType.AUDIO="audio",PlaylistLevelType.SUBTITLE="subtitle"})(PlaylistLevelType||(PlaylistLevelType={}));var mp4demuxer=__webpack_require__("./src/demux/mp4demuxer.js");function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var ElementaryStreamTypes,level_key_LevelKey=(function(){function LevelKey(baseURI,relativeURI){this._uri=null,this.baseuri=void 0,this.reluri=void 0,this.method=null,this.key=null,this.iv=null,this.baseuri=baseURI,this.reluri=relativeURI}var Constructor,protoProps,staticProps;return Constructor=LevelKey,(protoProps=[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=Object(url_toolkit.buildAbsoluteURL)(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),LevelKey})();function fragment_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}!(function(ElementaryStreamTypes){ElementaryStreamTypes.AUDIO="audio",ElementaryStreamTypes.VIDEO="video"})(ElementaryStreamTypes||(ElementaryStreamTypes={}));var fragment_Fragment=(function(){function Fragment(){var _this$_elementaryStre;this._url=null,this._byteRange=null,this._decryptdata=null,this._elementaryStreams=((_this$_elementaryStre={})[ElementaryStreamTypes.AUDIO]=!1,_this$_elementaryStre[ElementaryStreamTypes.VIDEO]=!1,_this$_elementaryStre),this.deltaPTS=0,this.rawProgramDateTime=null,this.programDateTime=null,this.title=null,this.tagList=[],this.cc=void 0,this.type=void 0,this.relurl=void 0,this.baseurl=void 0,this.duration=void 0,this.start=void 0,this.sn=0,this.urlId=0,this.level=0,this.levelkey=void 0,this.loader=void 0}var Constructor,protoProps,staticProps,_proto=Fragment.prototype;return _proto.setByteRange=function(value,previousFrag){var params=value.split("@",2),byteRange=[];1===params.length?byteRange[0]=previousFrag?previousFrag.byteRangeEndOffset:0:byteRange[0]=parseInt(params[1]),byteRange[1]=parseInt(params[0])+byteRange[0],this._byteRange=byteRange},_proto.addElementaryStream=function(type){this._elementaryStreams[type]=!0},_proto.hasElementaryStream=function(type){return!0===this._elementaryStreams[type]},_proto.createInitializationVector=function(segmentNumber){for(var uint8View=new Uint8Array(16),i=12;i<16;i++)uint8View[i]=segmentNumber>>8*(15-i)&255;return uint8View},_proto.setDecryptDataFromLevelKey=function(levelkey,segmentNumber){var decryptdata=levelkey;return(null==levelkey?void 0:levelkey.method)&&levelkey.uri&&!levelkey.iv&&((decryptdata=new level_key_LevelKey(levelkey.baseuri,levelkey.reluri)).method=levelkey.method,decryptdata.iv=this.createInitializationVector(segmentNumber)),decryptdata},Constructor=Fragment,(protoProps=[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=Object(url_toolkit.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(value){this._url=value}},{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var sn=this.sn;"number"!=typeof sn&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&logger.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),sn=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,sn)}return this._decryptdata}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!Object(number.isFiniteNumber)(this.programDateTime))return null;var duration=Object(number.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*duration}},{key:"encrypted",get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)}}])&&fragment_defineProperties(Constructor.prototype,protoProps),staticProps&&fragment_defineProperties(Constructor,staticProps),Fragment})();function level_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var level_Level=(function(){function Level(baseUrl){this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=baseUrl,this.version=null}var Constructor,protoProps,staticProps;return Constructor=Level,(protoProps=[{key:"hasProgramDateTime",get:function(){return!(!this.fragments[0]||!Object(number.isFiniteNumber)(this.fragments[0].programDateTime))}}])&&level_defineProperties(Constructor.prototype,protoProps),staticProps&&level_defineProperties(Constructor,staticProps),Level})(),DECIMAL_RESOLUTION_REGEX=/^(\d+)x(\d+)$/,ATTR_LIST_REGEX=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,attr_list=(function(){function AttrList(attrs){for(var attr in"string"==typeof attrs&&(attrs=AttrList.parseAttrList(attrs)),attrs)attrs.hasOwnProperty(attr)&&(this[attr]=attrs[attr])}var _proto=AttrList.prototype;return _proto.decimalInteger=function(attrName){var intValue=parseInt(this[attrName],10);return intValue>Number.MAX_SAFE_INTEGER?1/0:intValue},_proto.hexadecimalInteger=function(attrName){if(this[attrName]){var stringValue=(this[attrName]||"0x").slice(2);stringValue=(1&stringValue.length?"0":"")+stringValue;for(var value=new Uint8Array(stringValue.length/2),i=0;i<stringValue.length/2;i++)value[i]=parseInt(stringValue.slice(2*i,2*i+2),16);return value}return null},_proto.hexadecimalIntegerAsNumber=function(attrName){var intValue=parseInt(this[attrName],16);return intValue>Number.MAX_SAFE_INTEGER?1/0:intValue},_proto.decimalFloatingPoint=function(attrName){return parseFloat(this[attrName])},_proto.enumeratedString=function(attrName){return this[attrName]},_proto.decimalResolution=function(attrName){var res=DECIMAL_RESOLUTION_REGEX.exec(this[attrName]);if(null!==res)return{width:parseInt(res[1],10),height:parseInt(res[2],10)}},AttrList.parseAttrList=function(input){var match,attrs={};for(ATTR_LIST_REGEX.lastIndex=0;null!==(match=ATTR_LIST_REGEX.exec(input));){var value=match[2];0===value.indexOf('"')&&value.lastIndexOf('"')===value.length-1&&(value=value.slice(1,-1)),attrs[match[1]]=value}return attrs},AttrList})(),sampleEntryCodesISO={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};function isCodecSupportedInMp4(codec,type){return MediaSource.isTypeSupported((type||"video")+'/mp4;codecs="'+codec+'"')}var MASTER_PLAYLIST_REGEX=/(?:#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)|#EXT-X-SESSION-DATA:([^\n\r]*)[\r\n]+)/g,MASTER_PLAYLIST_MEDIA_REGEX=/#EXT-X-MEDIA:(.*)/g,LEVEL_PLAYLIST_REGEX_FAST=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),LEVEL_PLAYLIST_REGEX_SLOW=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,MP4_REGEX_SUFFIX=/\.(mp4|m4s|m4v|m4a)$/i,m3u8_parser_M3U8Parser=(function(){function M3U8Parser(){}return M3U8Parser.findGroup=function(groups,mediaGroupId){for(var i=0;i<groups.length;i++){var group=groups[i];if(group.id===mediaGroupId)return group}},M3U8Parser.convertAVC1ToAVCOTI=function(codec){var result,avcdata=codec.split(".");return avcdata.length>2?(result=avcdata.shift()+".",result+=parseInt(avcdata.shift()).toString(16),result+=("000"+parseInt(avcdata.shift()).toString(16)).substr(-4)):result=codec,result},M3U8Parser.resolve=function(url,baseUrl){return url_toolkit.buildAbsoluteURL(baseUrl,url,{alwaysNormalize:!0})},M3U8Parser.parseMasterPlaylist=function(string,baseurl){var result,levels=[],sessionData={},hasSessionData=!1;function setCodecs(codecs,level){["video","audio"].forEach((function(type){var filtered=codecs.filter((function(codec){return(function(codec,type){var typeCodes=sampleEntryCodesISO[type];return!!typeCodes&&!0===typeCodes[codec.slice(0,4)]})(codec,type)}));if(filtered.length){var preferred=filtered.filter((function(codec){return 0===codec.lastIndexOf("avc1",0)||0===codec.lastIndexOf("mp4a",0)}));level[type+"Codec"]=preferred.length>0?preferred[0]:filtered[0],codecs=codecs.filter((function(codec){return-1===filtered.indexOf(codec)}))}})),level.unknownCodecs=codecs}for(MASTER_PLAYLIST_REGEX.lastIndex=0;null!=(result=MASTER_PLAYLIST_REGEX.exec(string));)if(result[1]){var level={},attrs=level.attrs=new attr_list(result[1]);level.url=M3U8Parser.resolve(result[2],baseurl);var resolution=attrs.decimalResolution("RESOLUTION");resolution&&(level.width=resolution.width,level.height=resolution.height),level.bitrate=attrs.decimalInteger("AVERAGE-BANDWIDTH")||attrs.decimalInteger("BANDWIDTH"),level.name=attrs.NAME,setCodecs([].concat((attrs.CODECS||"").split(/[ ,]+/)),level),level.videoCodec&&-1!==level.videoCodec.indexOf("avc1")&&(level.videoCodec=M3U8Parser.convertAVC1ToAVCOTI(level.videoCodec)),levels.push(level)}else if(result[3]){var sessionAttrs=new attr_list(result[3]);sessionAttrs["DATA-ID"]&&(hasSessionData=!0,sessionData[sessionAttrs["DATA-ID"]]=sessionAttrs)}return{levels,sessionData:hasSessionData?sessionData:null}},M3U8Parser.parseMasterPlaylistMedia=function(string,baseurl,type,audioGroups){var result;void 0===audioGroups&&(audioGroups=[]);var medias=[],id=0;for(MASTER_PLAYLIST_MEDIA_REGEX.lastIndex=0;null!==(result=MASTER_PLAYLIST_MEDIA_REGEX.exec(string));){var attrs=new attr_list(result[1]);if(attrs.TYPE===type){var media={attrs,id:id++,groupId:attrs["GROUP-ID"],instreamId:attrs["INSTREAM-ID"],name:attrs.NAME||attrs.LANGUAGE,type,default:"YES"===attrs.DEFAULT,autoselect:"YES"===attrs.AUTOSELECT,forced:"YES"===attrs.FORCED,lang:attrs.LANGUAGE};if(attrs.URI&&(media.url=M3U8Parser.resolve(attrs.URI,baseurl)),audioGroups.length){var groupCodec=M3U8Parser.findGroup(audioGroups,media.groupId);media.audioCodec=groupCodec?groupCodec.codec:audioGroups[0].codec}medias.push(media)}}return medias},M3U8Parser.parseLevelPlaylist=function(string,baseurl,id,type,levelUrlId){var result,i,levelkey,currentSN=0,totalduration=0,level=new level_Level(baseurl),discontinuityCounter=0,prevFrag=null,frag=new fragment_Fragment,firstPdtIndex=null;for(LEVEL_PLAYLIST_REGEX_FAST.lastIndex=0;null!==(result=LEVEL_PLAYLIST_REGEX_FAST.exec(string));){var duration=result[1];if(duration){frag.duration=parseFloat(duration);var title=(" "+result[2]).slice(1);frag.title=title||null,frag.tagList.push(title?["INF",duration,title]:["INF",duration])}else if(result[3]){if(Object(number.isFiniteNumber)(frag.duration)){var sn=currentSN++;frag.type=type,frag.start=totalduration,levelkey&&(frag.levelkey=levelkey),frag.sn=sn,frag.level=id,frag.cc=discontinuityCounter,frag.urlId=levelUrlId,frag.baseurl=baseurl,frag.relurl=(" "+result[3]).slice(1),assignProgramDateTime(frag,prevFrag),level.fragments.push(frag),prevFrag=frag,totalduration+=frag.duration,frag=new fragment_Fragment}}else if(result[4]){var data=(" "+result[4]).slice(1);prevFrag?frag.setByteRange(data,prevFrag):frag.setByteRange(data)}else if(result[5])frag.rawProgramDateTime=(" "+result[5]).slice(1),frag.tagList.push(["PROGRAM-DATE-TIME",frag.rawProgramDateTime]),null===firstPdtIndex&&(firstPdtIndex=level.fragments.length);else{if(!(result=result[0].match(LEVEL_PLAYLIST_REGEX_SLOW))){logger.logger.warn("No matches on slow regex match for level playlist!");continue}for(i=1;i<result.length&&void 0===result[i];i++);var value1=(" "+result[i+1]).slice(1),value2=(" "+result[i+2]).slice(1);switch(result[i]){case"#":frag.tagList.push(value2?[value1,value2]:[value1]);break;case"PLAYLIST-TYPE":level.type=value1.toUpperCase();break;case"MEDIA-SEQUENCE":currentSN=level.startSN=parseInt(value1);break;case"TARGETDURATION":level.targetduration=parseFloat(value1);break;case"VERSION":level.version=parseInt(value1);break;case"EXTM3U":break;case"ENDLIST":level.live=!1;break;case"DIS":discontinuityCounter++,frag.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":discontinuityCounter=parseInt(value1);break;case"KEY":var keyAttrs=new attr_list(value1),decryptmethod=keyAttrs.enumeratedString("METHOD"),decrypturi=keyAttrs.URI,decryptiv=keyAttrs.hexadecimalInteger("IV");if("com.apple.streamingkeydelivery"===(keyAttrs.KEYFORMAT||"identity")){logger.logger.warn("Keyformat com.apple.streamingkeydelivery is not supported");continue}decryptmethod&&(levelkey=new level_key_LevelKey(baseurl,decrypturi),decrypturi&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(decryptmethod)>=0&&(levelkey.method=decryptmethod,levelkey.key=null,levelkey.iv=decryptiv));break;case"START":var startTimeOffset=new attr_list(value1).decimalFloatingPoint("TIME-OFFSET");Object(number.isFiniteNumber)(startTimeOffset)&&(level.startTimeOffset=startTimeOffset);break;case"MAP":var mapAttrs=new attr_list(value1);frag.relurl=mapAttrs.URI,mapAttrs.BYTERANGE&&frag.setByteRange(mapAttrs.BYTERANGE),frag.baseurl=baseurl,frag.level=id,frag.type=type,frag.sn="initSegment",level.initSegment=frag,(frag=new fragment_Fragment).rawProgramDateTime=level.initSegment.rawProgramDateTime;break;default:logger.logger.warn("line parsed but not handled: "+result)}}}return(frag=prevFrag)&&!frag.relurl&&(level.fragments.pop(),totalduration-=frag.duration),level.totalduration=totalduration,level.averagetargetduration=totalduration/level.fragments.length,level.endSN=currentSN-1,level.startCC=level.fragments[0]?level.fragments[0].cc:0,level.endCC=discontinuityCounter,!level.initSegment&&level.fragments.length&&level.fragments.every((function(frag){return MP4_REGEX_SUFFIX.test(frag.relurl)}))&&(logger.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(frag=new fragment_Fragment).relurl=level.fragments[0].relurl,frag.baseurl=baseurl,frag.level=id,frag.type=type,frag.sn="initSegment",level.initSegment=frag,level.needSidxRanges=!0),firstPdtIndex&&(function(fragments,startIndex){for(var fragPrev=fragments[startIndex],i=startIndex-1;i>=0;i--){var frag=fragments[i];frag.programDateTime=fragPrev.programDateTime-1e3*frag.duration,fragPrev=frag}})(level.fragments,firstPdtIndex),level},M3U8Parser})();function assignProgramDateTime(frag,prevFrag){frag.rawProgramDateTime?frag.programDateTime=Date.parse(frag.rawProgramDateTime):(null==prevFrag?void 0:prevFrag.programDateTime)&&(frag.programDateTime=prevFrag.endProgramDateTime),Object(number.isFiniteNumber)(frag.programDateTime)||(frag.programDateTime=null,frag.rawProgramDateTime=null)}var performance=window.performance,playlist_loader=(function(_EventHandler){var subClass,superClass;function PlaylistLoader(hls){var _this;return(_this=_EventHandler.call(this,hls,events.default.MANIFEST_LOADING,events.default.LEVEL_LOADING,events.default.AUDIO_TRACK_LOADING,events.default.SUBTITLE_TRACK_LOADING)||this).loaders={},_this}superClass=_EventHandler,(subClass=PlaylistLoader).prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass,PlaylistLoader.canHaveQualityLevels=function(type){return type!==PlaylistContextType.AUDIO_TRACK&&type!==PlaylistContextType.SUBTITLE_TRACK},PlaylistLoader.mapContextToLevelType=function(context){switch(context.type){case PlaylistContextType.AUDIO_TRACK:return PlaylistLevelType.AUDIO;case PlaylistContextType.SUBTITLE_TRACK:return PlaylistLevelType.SUBTITLE;default:return PlaylistLevelType.MAIN}},PlaylistLoader.getResponseUrl=function(response,context){var url=response.url;return void 0!==url&&0!==url.indexOf("data:")||(url=context.url),url};var _proto=PlaylistLoader.prototype;return _proto.createInternalLoader=function(context){var config=this.hls.config,PLoader=config.pLoader,Loader=config.loader,loader=new(PLoader||Loader)(config);return context.loader=loader,this.loaders[context.type]=loader,loader},_proto.getInternalLoader=function(context){return this.loaders[context.type]},_proto.resetInternalLoader=function(contextType){this.loaders[contextType]&&delete this.loaders[contextType]},_proto.destroyInternalLoaders=function(){for(var contextType in this.loaders){var loader=this.loaders[contextType];loader&&loader.destroy(),this.resetInternalLoader(contextType)}},_proto.destroy=function(){this.destroyInternalLoaders(),_EventHandler.prototype.destroy.call(this)},_proto.onManifestLoading=function(data){this.load({url:data.url,type:PlaylistContextType.MANIFEST,level:0,id:null,responseType:"text"})},_proto.onLevelLoading=function(data){this.load({url:data.url,type:PlaylistContextType.LEVEL,level:data.level,id:data.id,responseType:"text"})},_proto.onAudioTrackLoading=function(data){this.load({url:data.url,type:PlaylistContextType.AUDIO_TRACK,level:null,id:data.id,responseType:"text"})},_proto.onSubtitleTrackLoading=function(data){this.load({url:data.url,type:PlaylistContextType.SUBTITLE_TRACK,level:null,id:data.id,responseType:"text"})},_proto.load=function(context){var config=this.hls.config;logger.logger.debug("Loading playlist of type "+context.type+", level: "+context.level+", id: "+context.id);var maxRetry,timeout,retryDelay,maxRetryDelay,loader=this.getInternalLoader(context);if(loader){var loaderContext=loader.context;if(loaderContext&&loaderContext.url===context.url)return logger.logger.trace("playlist request ongoing"),!1;logger.logger.warn("aborting previous loader for type: "+context.type),loader.abort()}switch(context.type){case PlaylistContextType.MANIFEST:maxRetry=config.manifestLoadingMaxRetry,timeout=config.manifestLoadingTimeOut,retryDelay=config.manifestLoadingRetryDelay,maxRetryDelay=config.manifestLoadingMaxRetryTimeout;break;case PlaylistContextType.LEVEL:maxRetry=0,maxRetryDelay=0,retryDelay=0,timeout=config.levelLoadingTimeOut;break;default:maxRetry=config.levelLoadingMaxRetry,timeout=config.levelLoadingTimeOut,retryDelay=config.levelLoadingRetryDelay,maxRetryDelay=config.levelLoadingMaxRetryTimeout}loader=this.createInternalLoader(context);var loaderConfig={timeout,maxRetry,retryDelay,maxRetryDelay},loaderCallbacks={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return logger.logger.debug("Calling internal loader delegate for URL: "+context.url),loader.load(context,loaderConfig,loaderCallbacks),!0},_proto.loadsuccess=function(response,stats,context,networkDetails){if(void 0===networkDetails&&(networkDetails=null),context.isSidxRequest)return this._handleSidxRequest(response,context),void this._handlePlaylistLoaded(response,stats,context,networkDetails);if(this.resetInternalLoader(context.type),"string"!=typeof response.data)throw new Error('expected responseType of "text" for PlaylistLoader');var string=response.data;stats.tload=performance.now(),0===string.indexOf("#EXTM3U")?string.indexOf("#EXTINF:")>0||string.indexOf("#EXT-X-TARGETDURATION:")>0?this._handleTrackOrLevelPlaylist(response,stats,context,networkDetails):this._handleMasterPlaylist(response,stats,context,networkDetails):this._handleManifestParsingError(response,context,"no EXTM3U delimiter",networkDetails)},_proto.loaderror=function(response,context,networkDetails){void 0===networkDetails&&(networkDetails=null),this._handleNetworkError(context,networkDetails,!1,response)},_proto.loadtimeout=function(stats,context,networkDetails){void 0===networkDetails&&(networkDetails=null),this._handleNetworkError(context,networkDetails,!0)},_proto._handleMasterPlaylist=function(response,stats,context,networkDetails){var hls=this.hls,string=response.data,url=PlaylistLoader.getResponseUrl(response,context),_M3U8Parser$parseMast=m3u8_parser_M3U8Parser.parseMasterPlaylist(string,url),levels=_M3U8Parser$parseMast.levels,sessionData=_M3U8Parser$parseMast.sessionData;if(levels.length){var audioGroups=levels.map((function(level){return{id:level.attrs.AUDIO,codec:level.audioCodec}})),audioTracks=m3u8_parser_M3U8Parser.parseMasterPlaylistMedia(string,url,"AUDIO",audioGroups),subtitles=m3u8_parser_M3U8Parser.parseMasterPlaylistMedia(string,url,"SUBTITLES"),captions=m3u8_parser_M3U8Parser.parseMasterPlaylistMedia(string,url,"CLOSED-CAPTIONS");if(audioTracks.length){var embeddedAudioFound=!1;audioTracks.forEach((function(audioTrack){audioTrack.url||(embeddedAudioFound=!0)})),!1===embeddedAudioFound&&levels[0].audioCodec&&!levels[0].attrs.AUDIO&&(logger.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),audioTracks.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:{},url:""}))}hls.trigger(events.default.MANIFEST_LOADED,{levels,audioTracks,subtitles,captions,url,stats,networkDetails,sessionData})}else this._handleManifestParsingError(response,context,"no level found in manifest",networkDetails)},_proto._handleTrackOrLevelPlaylist=function(response,stats,context,networkDetails){var hls=this.hls,id=context.id,level=context.level,type=context.type,url=PlaylistLoader.getResponseUrl(response,context),levelUrlId=Object(number.isFiniteNumber)(id)?id:0,levelId=Object(number.isFiniteNumber)(level)?level:levelUrlId,levelType=PlaylistLoader.mapContextToLevelType(context),levelDetails=m3u8_parser_M3U8Parser.parseLevelPlaylist(response.data,url,levelId,levelType,levelUrlId);if(levelDetails.tload=stats.tload,levelDetails.fragments.length){if(type===PlaylistContextType.MANIFEST){var singleLevel={url,details:levelDetails};hls.trigger(events.default.MANIFEST_LOADED,{levels:[singleLevel],audioTracks:[],url,stats,networkDetails,sessionData:null})}if(stats.tparsed=performance.now(),levelDetails.needSidxRanges){var sidxUrl=levelDetails.initSegment.url;this.load({url:sidxUrl,isSidxRequest:!0,type,level,levelDetails,id,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"})}else context.levelDetails=levelDetails,this._handlePlaylistLoaded(response,stats,context,networkDetails)}else hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.NETWORK_ERROR,details:errors.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url,reason:"no fragments found in level",level:"number"==typeof context.level?context.level:void 0})},_proto._handleSidxRequest=function(response,context){if("string"==typeof response.data)throw new Error("sidx request must be made with responseType of array buffer");var sidxInfo=mp4demuxer.default.parseSegmentIndex(new Uint8Array(response.data));if(sidxInfo){var sidxReferences=sidxInfo.references,levelDetails=context.levelDetails;sidxReferences.forEach((function(segmentRef,index){var segRefInfo=segmentRef.info;if(levelDetails){var frag=levelDetails.fragments[index];0===frag.byteRange.length&&frag.setByteRange(String(1+segRefInfo.end-segRefInfo.start)+"@"+String(segRefInfo.start))}})),levelDetails&&levelDetails.initSegment.setByteRange(String(sidxInfo.moovEndOffset)+"@0")}},_proto._handleManifestParsingError=function(response,context,reason,networkDetails){this.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.NETWORK_ERROR,details:errors.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:response.url,reason,networkDetails})},_proto._handleNetworkError=function(context,networkDetails,timeout,response){var details,fatal;void 0===timeout&&(timeout=!1),void 0===response&&(response=null),logger.logger.info("A network error occured while loading a "+context.type+"-type playlist");var loader=this.getInternalLoader(context);switch(context.type){case PlaylistContextType.MANIFEST:details=timeout?errors.ErrorDetails.MANIFEST_LOAD_TIMEOUT:errors.ErrorDetails.MANIFEST_LOAD_ERROR,fatal=!0;break;case PlaylistContextType.LEVEL:details=timeout?errors.ErrorDetails.LEVEL_LOAD_TIMEOUT:errors.ErrorDetails.LEVEL_LOAD_ERROR,fatal=!1;break;case PlaylistContextType.AUDIO_TRACK:details=timeout?errors.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:errors.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal=!1;break;default:fatal=!1}loader&&(loader.abort(),this.resetInternalLoader(context.type));var errorData={type:errors.ErrorTypes.NETWORK_ERROR,details,fatal,url:context.url,loader,context,networkDetails};response&&(errorData.response=response),this.hls.trigger(events.default.ERROR,errorData)},_proto._handlePlaylistLoaded=function(response,stats,context,networkDetails){var type=context.type,level=context.level,id=context.id,levelDetails=context.levelDetails;if(levelDetails&&levelDetails.targetduration)if(PlaylistLoader.canHaveQualityLevels(context.type))this.hls.trigger(events.default.LEVEL_LOADED,{details:levelDetails,level:level||0,id:id||0,stats,networkDetails});else switch(type){case PlaylistContextType.AUDIO_TRACK:this.hls.trigger(events.default.AUDIO_TRACK_LOADED,{details:levelDetails,id,stats,networkDetails});break;case PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(events.default.SUBTITLE_TRACK_LOADED,{details:levelDetails,id,stats,networkDetails})}else this._handleManifestParsingError(response,context,"invalid target duration",networkDetails)},PlaylistLoader})(event_handler),fragment_loader=(function(_EventHandler){var subClass,superClass;function FragmentLoader(hls){var _this;return(_this=_EventHandler.call(this,hls,events.default.FRAG_LOADING)||this).loaders={},_this}superClass=_EventHandler,(subClass=FragmentLoader).prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass;var _proto=FragmentLoader.prototype;return _proto.destroy=function(){var loaders=this.loaders;for(var loaderName in loaders){var loader=loaders[loaderName];loader&&loader.destroy()}this.loaders={},_EventHandler.prototype.destroy.call(this)},_proto.onFragLoading=function(data){var frag=data.frag,type=frag.type,loaders=this.loaders,config=this.hls.config,FragmentILoader=config.fLoader,DefaultILoader=config.loader;frag.loaded=0;var loaderContext,loaderConfig,loaderCallbacks,loader=loaders[type];loader&&(logger.logger.warn("abort previous fragment loader for type: "+type),loader.abort()),loader=loaders[type]=frag.loader=config.fLoader?new FragmentILoader(config):new DefaultILoader(config),loaderContext={url:frag.url,frag,responseType:"arraybuffer",progressData:!1};var start=frag.byteRangeStartOffset,end=frag.byteRangeEndOffset;Object(number.isFiniteNumber)(start)&&Object(number.isFiniteNumber)(end)&&(loaderContext.rangeStart=start,loaderContext.rangeEnd=end),loaderConfig={timeout:config.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:config.fragLoadingMaxRetryTimeout},loaderCallbacks={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},loader.load(loaderContext,loaderConfig,loaderCallbacks)},_proto.loadsuccess=function(response,stats,context,networkDetails){void 0===networkDetails&&(networkDetails=null);var payload=response.data,frag=context.frag;frag.loader=void 0,this.loaders[frag.type]=void 0,this.hls.trigger(events.default.FRAG_LOADED,{payload,frag,stats,networkDetails})},_proto.loaderror=function(response,context,networkDetails){void 0===networkDetails&&(networkDetails=null);var frag=context.frag,loader=frag.loader;loader&&loader.abort(),this.loaders[frag.type]=void 0,this.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.NETWORK_ERROR,details:errors.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:context.frag,response,networkDetails})},_proto.loadtimeout=function(stats,context,networkDetails){void 0===networkDetails&&(networkDetails=null);var frag=context.frag,loader=frag.loader;loader&&loader.abort(),this.loaders[frag.type]=void 0,this.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.NETWORK_ERROR,details:errors.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:context.frag,networkDetails})},_proto.loadprogress=function(stats,context,data,networkDetails){void 0===networkDetails&&(networkDetails=null);var frag=context.frag;frag.loaded=stats.loaded,this.hls.trigger(events.default.FRAG_LOAD_PROGRESS,{frag,stats,networkDetails})},FragmentLoader})(event_handler),key_loader=(function(_EventHandler){var subClass,superClass;function KeyLoader(hls){var _this;return(_this=_EventHandler.call(this,hls,events.default.KEY_LOADING)||this).loaders={},_this.decryptkey=null,_this.decrypturl=null,_this}superClass=_EventHandler,(subClass=KeyLoader).prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass;var _proto=KeyLoader.prototype;return _proto.destroy=function(){for(var loaderName in this.loaders){var loader=this.loaders[loaderName];loader&&loader.destroy()}this.loaders={},_EventHandler.prototype.destroy.call(this)},_proto.onKeyLoading=function(data){var frag=data.frag,type=frag.type,loader=this.loaders[type];if(frag.decryptdata){var uri=frag.decryptdata.uri;if(uri!==this.decrypturl||null===this.decryptkey){var config=this.hls.config;if(loader&&(logger.logger.warn("abort previous key loader for type:"+type),loader.abort()),!uri)return void logger.logger.warn("key uri is falsy");frag.loader=this.loaders[type]=new config.loader(config),this.decrypturl=uri,this.decryptkey=null;var loaderContext={url:uri,frag,responseType:"arraybuffer"},loaderConfig={timeout:config.fragLoadingTimeOut,maxRetry:0,retryDelay:config.fragLoadingRetryDelay,maxRetryDelay:config.fragLoadingMaxRetryTimeout},loaderCallbacks={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};frag.loader.load(loaderContext,loaderConfig,loaderCallbacks)}else this.decryptkey&&(frag.decryptdata.key=this.decryptkey,this.hls.trigger(events.default.KEY_LOADED,{frag}))}else logger.logger.warn("Missing decryption data on fragment in onKeyLoading")},_proto.loadsuccess=function(response,stats,context){var frag=context.frag;frag.decryptdata?(this.decryptkey=frag.decryptdata.key=new Uint8Array(response.data),frag.loader=void 0,delete this.loaders[frag.type],this.hls.trigger(events.default.KEY_LOADED,{frag})):logger.logger.error("after key load, decryptdata unset")},_proto.loaderror=function(response,context){var frag=context.frag,loader=frag.loader;loader&&loader.abort(),delete this.loaders[frag.type],this.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.NETWORK_ERROR,details:errors.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag,response})},_proto.loadtimeout=function(stats,context){var frag=context.frag,loader=frag.loader;loader&&loader.abort(),delete this.loaders[frag.type],this.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.NETWORK_ERROR,details:errors.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag})},KeyLoader})(event_handler),FragmentState_NOT_LOADED="NOT_LOADED",FragmentState_APPENDING="APPENDING",FragmentState_PARTIAL="PARTIAL",FragmentState_OK="OK",fragment_tracker_FragmentTracker=(function(_EventHandler){var subClass,superClass;function FragmentTracker(hls){var _this;return(_this=_EventHandler.call(this,hls,events.default.BUFFER_APPENDED,events.default.FRAG_BUFFERED,events.default.FRAG_LOADED)||this).bufferPadding=.2,_this.fragments=Object.create(null),_this.timeRanges=Object.create(null),_this.config=hls.config,_this}superClass=_EventHandler,(subClass=FragmentTracker).prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass;var _proto=FragmentTracker.prototype;return _proto.destroy=function(){this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.config=null,event_handler.prototype.destroy.call(this),_EventHandler.prototype.destroy.call(this)},_proto.getBufferedFrag=function(position,levelType){var fragments=this.fragments,bufferedFrags=Object.keys(fragments).filter((function(key){var fragmentEntity=fragments[key];if(fragmentEntity.body.type!==levelType)return!1;if(!fragmentEntity.buffered)return!1;var frag=fragmentEntity.body;return frag.startPTS<=position&&position<=frag.endPTS}));if(0===bufferedFrags.length)return null;var bufferedFragKey=bufferedFrags.pop();return fragments[bufferedFragKey].body},_proto.detectEvictedFragments=function(elementaryStream,timeRange){var _this2=this;Object.keys(this.fragments).forEach((function(key){var fragmentEntity=_this2.fragments[key];if(fragmentEntity&&fragmentEntity.buffered){var esData=fragmentEntity.range[elementaryStream];if(esData)for(var fragmentTimes=esData.time,i=0;i<fragmentTimes.length;i++){var time=fragmentTimes[i];if(!_this2.isTimeBuffered(time.startPTS,time.endPTS,timeRange)){_this2.removeFragment(fragmentEntity.body);break}}}}))},_proto.detectPartialFragments=function(fragment){var _this3=this,fragKey=this.getFragmentKey(fragment),fragmentEntity=this.fragments[fragKey];fragmentEntity&&(fragmentEntity.buffered=!0,Object.keys(this.timeRanges).forEach((function(elementaryStream){if(fragment.hasElementaryStream(elementaryStream)){var timeRange=_this3.timeRanges[elementaryStream];fragmentEntity.range[elementaryStream]=_this3.getBufferedTimes(fragment.startPTS,fragment.endPTS,timeRange)}})))},_proto.getBufferedTimes=function(startPTS,endPTS,timeRange){for(var startTime,endTime,fragmentTimes=[],fragmentPartial=!1,i=0;i<timeRange.length;i++){if(startTime=timeRange.start(i)-this.bufferPadding,endTime=timeRange.end(i)+this.bufferPadding,startPTS>=startTime&&endPTS<=endTime){fragmentTimes.push({startPTS:Math.max(startPTS,timeRange.start(i)),endPTS:Math.min(endPTS,timeRange.end(i))});break}if(startPTS<endTime&&endPTS>startTime)fragmentTimes.push({startPTS:Math.max(startPTS,timeRange.start(i)),endPTS:Math.min(endPTS,timeRange.end(i))}),fragmentPartial=!0;else if(endPTS<=startTime)break}return{time:fragmentTimes,partial:fragmentPartial}},_proto.getFragmentKey=function(fragment){return fragment.type+"_"+fragment.level+"_"+fragment.urlId+"_"+fragment.sn},_proto.getPartialFragment=function(time){var timePadding,startTime,endTime,_this4=this,bestFragment=null,bestOverlap=0;return Object.keys(this.fragments).forEach((function(key){var fragmentEntity=_this4.fragments[key];_this4.isPartial(fragmentEntity)&&(startTime=fragmentEntity.body.startPTS-_this4.bufferPadding,endTime=fragmentEntity.body.endPTS+_this4.bufferPadding,time>=startTime&&time<=endTime&&(timePadding=Math.min(time-startTime,endTime-time),bestOverlap<=timePadding&&(bestFragment=fragmentEntity.body,bestOverlap=timePadding)))})),bestFragment},_proto.getState=function(fragment){var fragKey=this.getFragmentKey(fragment),fragmentEntity=this.fragments[fragKey],state=FragmentState_NOT_LOADED;return void 0!==fragmentEntity&&(state=fragmentEntity.buffered?!0===this.isPartial(fragmentEntity)?FragmentState_PARTIAL:FragmentState_OK:FragmentState_APPENDING),state},_proto.isPartial=function(fragmentEntity){return!0===fragmentEntity.buffered&&(void 0!==fragmentEntity.range.video&&!0===fragmentEntity.range.video.partial||void 0!==fragmentEntity.range.audio&&!0===fragmentEntity.range.audio.partial)},_proto.isTimeBuffered=function(startPTS,endPTS,timeRange){for(var startTime,endTime,i=0;i<timeRange.length;i++){if(startTime=timeRange.start(i)-this.bufferPadding,endTime=timeRange.end(i)+this.bufferPadding,startPTS>=startTime&&endPTS<=endTime)return!0;if(endPTS<=startTime)return!1}return!1},_proto.onFragLoaded=function(e){var fragment=e.frag;Object(number.isFiniteNumber)(fragment.sn)&&!fragment.bitrateTest&&(this.fragments[this.getFragmentKey(fragment)]={body:fragment,range:Object.create(null),buffered:!1})},_proto.onBufferAppended=function(e){var _this5=this;this.timeRanges=e.timeRanges,Object.keys(this.timeRanges).forEach((function(elementaryStream){var timeRange=_this5.timeRanges[elementaryStream];_this5.detectEvictedFragments(elementaryStream,timeRange)}))},_proto.onFragBuffered=function(e){this.detectPartialFragments(e.frag)},_proto.hasFragment=function(fragment){var fragKey=this.getFragmentKey(fragment);return void 0!==this.fragments[fragKey]},_proto.removeFragment=function(fragment){var fragKey=this.getFragmentKey(fragment);delete this.fragments[fragKey]},_proto.removeAllFragments=function(){this.fragments=Object.create(null)},FragmentTracker})(event_handler),binary_search={search:function(list,comparisonFn){for(var minIndex=0,maxIndex=list.length-1,currentIndex=null,currentElement=null;minIndex<=maxIndex;){var comparisonResult=comparisonFn(currentElement=list[currentIndex=(minIndex+maxIndex)/2|0]);if(comparisonResult>0)minIndex=currentIndex+1;else{if(!(comparisonResult<0))return currentElement;maxIndex=currentIndex-1}}return null}},BufferHelper=(function(){function BufferHelper(){}return BufferHelper.isBuffered=function(media,position){try{if(media)for(var buffered=media.buffered,i=0;i<buffered.length;i++)if(position>=buffered.start(i)&&position<=buffered.end(i))return!0}catch(error){}return!1},BufferHelper.bufferInfo=function(media,pos,maxHoleDuration){try{if(media){var i,vbuffered=media.buffered,buffered=[];for(i=0;i<vbuffered.length;i++)buffered.push({start:vbuffered.start(i),end:vbuffered.end(i)});return this.bufferedInfo(buffered,pos,maxHoleDuration)}}catch(error){}return{len:0,start:pos,end:pos,nextStart:void 0}},BufferHelper.bufferedInfo=function(buffered,pos,maxHoleDuration){buffered.sort((function(a,b){var diff=a.start-b.start;return diff||b.end-a.end}));var buffered2=[];if(maxHoleDuration)for(var i=0;i<buffered.length;i++){var buf2len=buffered2.length;if(buf2len){var buf2end=buffered2[buf2len-1].end;buffered[i].start-buf2end<maxHoleDuration?buffered[i].end>buf2end&&(buffered2[buf2len-1].end=buffered[i].end):buffered2.push(buffered[i])}else buffered2.push(buffered[i])}else buffered2=buffered;for(var bufferStartNext,bufferLen=0,bufferStart=pos,bufferEnd=pos,_i=0;_i<buffered2.length;_i++){var start=buffered2[_i].start,end=buffered2[_i].end;if(pos+maxHoleDuration>=start&&pos<end)bufferStart=start,bufferLen=(bufferEnd=end)-pos;else if(pos+maxHoleDuration<start){bufferStartNext=start;break}}return{len:bufferLen,start:bufferStart,end:bufferEnd,nextStart:bufferStartNext}},BufferHelper})(),eventemitter3=__webpack_require__("./node_modules/eventemitter3/index.js"),webworkify_webpack=__webpack_require__("./node_modules/webworkify-webpack/index.js"),demuxer_inline=__webpack_require__("./src/demux/demuxer-inline.js");function getMediaSource(){return window.MediaSource||window.WebKitMediaSource}var get_self_scope=__webpack_require__("./src/utils/get-self-scope.js"),Observer=(function(_EventEmitter){var subClass,superClass;function Observer(){return _EventEmitter.apply(this,arguments)||this}return superClass=_EventEmitter,(subClass=Observer).prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass,Observer.prototype.trigger=function(event){for(var _len=arguments.length,data=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)data[_key-1]=arguments[_key];this.emit.apply(this,[event,event].concat(data))},Observer})(eventemitter3.EventEmitter),global=Object(get_self_scope.getSelfScope)(),demuxer_MediaSource=getMediaSource()||{isTypeSupported:function(){return!1}},demux_demuxer=(function(){function Demuxer(hls,id){var _this=this;this.hls=hls,this.id=id;var observer=this.observer=new Observer,config=hls.config,forwardMessage=function(ev,data){(data=data||{}).frag=_this.frag,data.id=_this.id,hls.trigger(ev,data)};observer.on(events.default.FRAG_DECRYPTED,forwardMessage),observer.on(events.default.FRAG_PARSING_INIT_SEGMENT,forwardMessage),observer.on(events.default.FRAG_PARSING_DATA,forwardMessage),observer.on(events.default.FRAG_PARSED,forwardMessage),observer.on(events.default.ERROR,forwardMessage),observer.on(events.default.FRAG_PARSING_METADATA,forwardMessage),observer.on(events.default.FRAG_PARSING_USERDATA,forwardMessage),observer.on(events.default.INIT_PTS_FOUND,forwardMessage);var typeSupported={mp4:demuxer_MediaSource.isTypeSupported("video/mp4"),mpeg:demuxer_MediaSource.isTypeSupported("audio/mpeg"),mp3:demuxer_MediaSource.isTypeSupported('audio/mp4; codecs="mp3"')},vendor=navigator.vendor;if(config.enableWorker&&"undefined"!=typeof Worker){var w;logger.logger.log("demuxing in webworker");try{w=this.w=webworkify_webpack("./src/demux/demuxer-worker.js"),this.onwmsg=this.onWorkerMessage.bind(this),w.addEventListener("message",this.onwmsg),w.onerror=function(event){hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.OTHER_ERROR,details:errors.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:event.message+" ("+event.filename+":"+event.lineno+")"}})},w.postMessage({cmd:"init",typeSupported,vendor,id,config:JSON.stringify(config)})}catch(err){logger.logger.warn("Error in worker:",err),logger.logger.error("Error while initializing DemuxerWorker, fallback on DemuxerInline"),w&&global.URL.revokeObjectURL(w.objectURL),this.demuxer=new demuxer_inline.default(observer,typeSupported,config,vendor),this.w=void 0}}else this.demuxer=new demuxer_inline.default(observer,typeSupported,config,vendor)}var _proto=Demuxer.prototype;return _proto.destroy=function(){var w=this.w;if(w)w.removeEventListener("message",this.onwmsg),w.terminate(),this.w=null;else{var demuxer=this.demuxer;demuxer&&(demuxer.destroy(),this.demuxer=null)}var observer=this.observer;observer&&(observer.removeAllListeners(),this.observer=null)},_proto.push=function(data,initSegment,audioCodec,videoCodec,frag,duration,accurateTimeOffset,defaultInitPTS){var w=this.w,timeOffset=Object(number.isFiniteNumber)(frag.startPTS)?frag.startPTS:frag.start,decryptdata=frag.decryptdata,lastFrag=this.frag,discontinuity=!(lastFrag&&frag.cc===lastFrag.cc),trackSwitch=!(lastFrag&&frag.level===lastFrag.level),nextSN=lastFrag&&frag.sn===lastFrag.sn+1,contiguous=!trackSwitch&&nextSN;if(discontinuity&&logger.logger.log(this.id+":discontinuity detected"),trackSwitch&&logger.logger.log(this.id+":switch detected"),this.frag=frag,w)w.postMessage({cmd:"demux",data,decryptdata,initSegment,audioCodec,videoCodec,timeOffset,discontinuity,trackSwitch,contiguous,duration,accurateTimeOffset,defaultInitPTS},data instanceof ArrayBuffer?[data]:[]);else{var demuxer=this.demuxer;demuxer&&demuxer.push(data,decryptdata,initSegment,audioCodec,videoCodec,timeOffset,discontinuity,trackSwitch,contiguous,duration,accurateTimeOffset,defaultInitPTS)}},_proto.onWorkerMessage=function(ev){var data=ev.data,hls=this.hls;switch(data.event){case"init":global.URL.revokeObjectURL(this.w.objectURL);break;case events.default.FRAG_PARSING_DATA:data.data.data1=new Uint8Array(data.data1),data.data2&&(data.data.data2=new Uint8Array(data.data2));default:data.data=data.data||{},data.data.frag=this.frag,data.data.id=this.id,hls.trigger(data.event,data.data)}},Demuxer})();function addGroupId(level,type,id){switch(type){case"audio":level.audioGroupIds||(level.audioGroupIds=[]),level.audioGroupIds.push(id);break;case"text":level.textGroupIds||(level.textGroupIds=[]),level.textGroupIds.push(id)}}function updatePTS(fragments,fromIdx,toIdx){var fragFrom=fragments[fromIdx],fragTo=fragments[toIdx],fragToPTS=fragTo.startPTS;if(Object(number.isFiniteNumber)(fragToPTS))toIdx>fromIdx?(fragFrom.duration=fragToPTS-fragFrom.start,fragFrom.duration<0&&logger.logger.warn("negative duration computed for frag "+fragFrom.sn+",level "+fragFrom.level+", there should be some duration drift between playlist and fragment!")):(fragTo.duration=fragFrom.start-fragToPTS,fragTo.duration<0&&logger.logger.warn("negative duration computed for frag "+fragTo.sn+",level "+fragTo.level+", there should be some duration drift between playlist and fragment!"));else if(toIdx>fromIdx){var contiguous=fragFrom.cc===fragTo.cc;fragTo.start=fragFrom.start+(contiguous&&fragFrom.minEndPTS?fragFrom.minEndPTS-fragFrom.start:fragFrom.duration)}else fragTo.start=Math.max(fragFrom.start-fragTo.duration,0)}function updateFragPTSDTS(details,frag,startPTS,endPTS,startDTS,endDTS){var maxStartPTS=startPTS,minEndPTS=endPTS;if(Object(number.isFiniteNumber)(frag.startPTS)){var deltaPTS=Math.abs(frag.startPTS-startPTS);Object(number.isFiniteNumber)(frag.deltaPTS)?frag.deltaPTS=Math.max(deltaPTS,frag.deltaPTS):frag.deltaPTS=deltaPTS,maxStartPTS=Math.max(startPTS,frag.startPTS),startPTS=Math.min(startPTS,frag.startPTS),minEndPTS=Math.min(endPTS,frag.endPTS),endPTS=Math.max(endPTS,frag.endPTS),startDTS=Math.min(startDTS,frag.startDTS),endDTS=Math.max(endDTS,frag.endDTS)}var drift=startPTS-frag.start;frag.start=frag.startPTS=startPTS,frag.maxStartPTS=maxStartPTS,frag.endPTS=endPTS,frag.minEndPTS=minEndPTS,frag.startDTS=startDTS,frag.endDTS=endDTS,frag.duration=endPTS-startPTS;var fragIdx,fragments,i,sn=frag.sn;if(!details||sn<details.startSN||sn>details.endSN)return 0;for(fragIdx=sn-details.startSN,(fragments=details.fragments)[fragIdx]=frag,i=fragIdx;i>0;i--)updatePTS(fragments,i,i-1);for(i=fragIdx;i<fragments.length-1;i++)updatePTS(fragments,i,i+1);return details.PTSKnown=!0,drift}function mergeDetails(oldDetails,newDetails){newDetails.initSegment&&oldDetails.initSegment&&(newDetails.initSegment=oldDetails.initSegment);var PTSFrag,ccOffset=0;if(mapFragmentIntersection(oldDetails,newDetails,(function(oldFrag,newFrag){ccOffset=oldFrag.cc-newFrag.cc,Object(number.isFiniteNumber)(oldFrag.startPTS)&&(newFrag.start=newFrag.startPTS=oldFrag.startPTS,newFrag.endPTS=oldFrag.endPTS,newFrag.duration=oldFrag.duration,newFrag.backtracked=oldFrag.backtracked,newFrag.dropped=oldFrag.dropped,PTSFrag=newFrag),newDetails.PTSKnown=!0})),newDetails.PTSKnown){if(ccOffset){logger.logger.log("discontinuity sliding from playlist, take drift into account");for(var newFragments=newDetails.fragments,i=0;i<newFragments.length;i++)newFragments[i].cc+=ccOffset}PTSFrag?updateFragPTSDTS(newDetails,PTSFrag,PTSFrag.startPTS,PTSFrag.endPTS,PTSFrag.startDTS,PTSFrag.endDTS):(function(oldPlaylist,newPlaylist){var delta=newPlaylist.startSN-oldPlaylist.startSN,oldFragments=oldPlaylist.fragments,newFragments=newPlaylist.fragments;if(!(delta<0||delta>oldFragments.length))for(var i=0;i<newFragments.length;i++)newFragments[i].start+=oldFragments[delta].start})(oldDetails,newDetails),newDetails.PTSKnown=oldDetails.PTSKnown}}function mapFragmentIntersection(oldPlaylist,newPlaylist,intersectionFn){if(oldPlaylist&&newPlaylist)for(var start=Math.max(oldPlaylist.startSN,newPlaylist.startSN)-newPlaylist.startSN,end=Math.min(oldPlaylist.endSN,newPlaylist.endSN)-newPlaylist.startSN,delta=newPlaylist.startSN-oldPlaylist.startSN,i=start;i<=end;i++){var oldFrag=oldPlaylist.fragments[delta+i],newFrag=newPlaylist.fragments[i];if(!oldFrag||!newFrag)break;intersectionFn(oldFrag,newFrag,i)}}function computeReloadInterval(currentPlaylist,newPlaylist,lastRequestTime){var reloadInterval=1e3*(newPlaylist.averagetargetduration?newPlaylist.averagetargetduration:newPlaylist.targetduration),minReloadInterval=reloadInterval/2;return currentPlaylist&&newPlaylist.endSN===currentPlaylist.endSN&&(reloadInterval=minReloadInterval),lastRequestTime&&(reloadInterval=Math.max(minReloadInterval,reloadInterval-(window.performance.now()-lastRequestTime))),Math.round(reloadInterval)}var time_ranges={toString:function(r){for(var log="",len=r.length,i=0;i<len;i++)log+="["+r.start(i).toFixed(3)+","+r.end(i).toFixed(3)+"]";return log}};function adjustPts(sliding,details){details.fragments.forEach((function(frag){if(frag){var start=frag.start+sliding;frag.start=frag.startPTS=start,frag.endPTS=start+frag.duration}})),details.PTSKnown=!0}function alignStream(lastFrag,lastLevel,details){!(function(lastFrag,details,lastLevel){if((function(lastFrag,lastLevel,details){var shouldAlign=!1;return lastLevel&&lastLevel.details&&details&&(details.endCC>details.startCC||lastFrag&&lastFrag.cc<details.startCC)&&(shouldAlign=!0),shouldAlign})(lastFrag,lastLevel,details)){var referenceFrag=(function(prevDetails,curDetails){var prevFrags=prevDetails.fragments,curFrags=curDetails.fragments;if(curFrags.length&&prevFrags.length){var prevStartFrag=(function(fragments,cc){for(var firstFrag=null,i=0;i<fragments.length;i+=1){var currentFrag=fragments[i];if(currentFrag&&currentFrag.cc===cc){firstFrag=currentFrag;break}}return firstFrag})(prevFrags,curFrags[0].cc);if(prevStartFrag&&(!prevStartFrag||prevStartFrag.startPTS))return prevStartFrag;logger.logger.log("No frag in previous level to align on")}else logger.logger.log("No fragments to align")})(lastLevel.details,details);referenceFrag&&(logger.logger.log("Adjusting PTS using last level due to CC increase within current level"),adjustPts(referenceFrag.start,details))}})(lastFrag,details,lastLevel),!details.PTSKnown&&lastLevel&&(function(details,lastDetails){if(lastDetails&&lastDetails.fragments.length){if(!details.hasProgramDateTime||!lastDetails.hasProgramDateTime)return;var lastPDT=lastDetails.fragments[0].programDateTime,sliding=(details.fragments[0].programDateTime-lastPDT)/1e3+lastDetails.fragments[0].start;Object(number.isFiniteNumber)(sliding)&&(logger.logger.log("adjusting PTS using programDateTime delta, sliding:"+sliding.toFixed(3)),adjustPts(sliding,details))}})(details,lastLevel.details)}function findFragmentByPDT(fragments,PDTValue,maxFragLookUpTolerance){if(null===PDTValue||!Array.isArray(fragments)||!fragments.length||!Object(number.isFiniteNumber)(PDTValue))return null;if(PDTValue<(fragments[0].programDateTime||0))return null;if(PDTValue>=(fragments[fragments.length-1].endProgramDateTime||0))return null;maxFragLookUpTolerance=maxFragLookUpTolerance||0;for(var seg=0;seg<fragments.length;++seg){var frag=fragments[seg];if(pdtWithinToleranceTest(PDTValue,maxFragLookUpTolerance,frag))return frag}return null}function findFragmentByPTS(fragPrevious,fragments,bufferEnd,maxFragLookUpTolerance){void 0===bufferEnd&&(bufferEnd=0),void 0===maxFragLookUpTolerance&&(maxFragLookUpTolerance=0);var fragNext=null;if(fragPrevious?fragNext=fragments[fragPrevious.sn-fragments[0].sn+1]:0===bufferEnd&&0===fragments[0].start&&(fragNext=fragments[0]),fragNext&&0===fragmentWithinToleranceTest(bufferEnd,maxFragLookUpTolerance,fragNext))return fragNext;var foundFragment=binary_search.search(fragments,fragmentWithinToleranceTest.bind(null,bufferEnd,maxFragLookUpTolerance));return foundFragment||fragNext}function fragmentWithinToleranceTest(bufferEnd,maxFragLookUpTolerance,candidate){void 0===bufferEnd&&(bufferEnd=0),void 0===maxFragLookUpTolerance&&(maxFragLookUpTolerance=0);var candidateLookupTolerance=Math.min(maxFragLookUpTolerance,candidate.duration+(candidate.deltaPTS?candidate.deltaPTS:0));return candidate.start+candidate.duration-candidateLookupTolerance<=bufferEnd?1:candidate.start-candidateLookupTolerance>bufferEnd&&candidate.start?-1:0}function pdtWithinToleranceTest(pdtBufferEnd,maxFragLookUpTolerance,candidate){var candidateLookupTolerance=1e3*Math.min(maxFragLookUpTolerance,candidate.duration+(candidate.deltaPTS?candidate.deltaPTS:0));return(candidate.endProgramDateTime||0)-candidateLookupTolerance>pdtBufferEnd}var gap_controller_GapController=(function(){function GapController(config,media,fragmentTracker,hls){this.config=config,this.media=media,this.fragmentTracker=fragmentTracker,this.hls=hls,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1}var _proto=GapController.prototype;return _proto.poll=function(lastCurrentTime){var config=this.config,media=this.media,stalled=this.stalled,currentTime=media.currentTime,seeking=media.seeking,seeked=this.seeking&&!seeking,beginSeek=!this.seeking&&seeking;if(this.seeking=seeking,currentTime===lastCurrentTime){if((beginSeek||seeked)&&(this.stalled=null),!media.paused&&!media.ended&&0!==media.playbackRate&&media.buffered.length){var bufferInfo=BufferHelper.bufferInfo(media,currentTime,0),isBuffered=bufferInfo.len>0,nextStart=bufferInfo.nextStart||0;if(isBuffered||nextStart){if(seeking){var hasEnoughBuffer=bufferInfo.len>2,noBufferGap=!nextStart||nextStart-currentTime>2&&!this.fragmentTracker.getPartialFragment(currentTime);if(hasEnoughBuffer||noBufferGap)return;this.moved=!1}if(!this.moved&&this.stalled){var startJump=Math.max(nextStart,bufferInfo.start||0)-currentTime;if(startJump>0&&startJump<=2)return void this._trySkipBufferHole(null)}var tnow=self.performance.now();if(null!==stalled){var stalledDuration=tnow-stalled;!seeking&&stalledDuration>=250&&this._reportStall(bufferInfo.len);var bufferedWithHoles=BufferHelper.bufferInfo(media,currentTime,config.maxBufferHole);this._tryFixBufferStall(bufferedWithHoles,stalledDuration)}else this.stalled=tnow}}}else if(this.moved=!0,null!==stalled){if(this.stallReported){var _stalledDuration=self.performance.now()-stalled;logger.logger.warn("playback not stuck anymore @"+currentTime+", after "+Math.round(_stalledDuration)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},_proto._tryFixBufferStall=function(bufferInfo,stalledDurationMs){var config=this.config,fragmentTracker=this.fragmentTracker,currentTime=this.media.currentTime,partial=fragmentTracker.getPartialFragment(currentTime);partial&&this._trySkipBufferHole(partial)||bufferInfo.len>config.maxBufferHole&&stalledDurationMs>1e3*config.highBufferWatchdogPeriod&&(logger.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},_proto._reportStall=function(bufferLen){var hls=this.hls,media=this.media;this.stallReported||(this.stallReported=!0,logger.logger.warn("Playback stalling at @"+media.currentTime+" due to low buffer (buffer="+bufferLen+")"),hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.MEDIA_ERROR,details:errors.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:bufferLen}))},_proto._trySkipBufferHole=function(partial){for(var config=this.config,hls=this.hls,media=this.media,currentTime=media.currentTime,lastEndTime=0,i=0;i<media.buffered.length;i++){var startTime=media.buffered.start(i);if(currentTime+config.maxBufferHole>=lastEndTime&&currentTime<startTime){var targetTime=Math.max(startTime+.05,media.currentTime+.1);return logger.logger.warn("skipping hole, adjusting currentTime from "+currentTime+" to "+targetTime),this.moved=!0,this.stalled=null,media.currentTime=targetTime,partial&&hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.MEDIA_ERROR,details:errors.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+currentTime+" to "+targetTime,frag:partial}),targetTime}lastEndTime=media.buffered.end(i)}return 0},_proto._tryNudgeBuffer=function(){var config=this.config,hls=this.hls,media=this.media,currentTime=media.currentTime,nudgeRetry=(this.nudgeRetry||0)+1;if(this.nudgeRetry=nudgeRetry,nudgeRetry<config.nudgeMaxRetry){var targetTime=currentTime+nudgeRetry*config.nudgeOffset;logger.logger.warn("Nudging 'currentTime' from "+currentTime+" to "+targetTime),media.currentTime=targetTime,hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.MEDIA_ERROR,details:errors.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else logger.logger.error("Playhead still not moving while enough data buffered @"+currentTime+" after "+config.nudgeMaxRetry+" nudges"),hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.MEDIA_ERROR,details:errors.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},GapController})();function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}var TaskLoop=(function(_EventHandler){var subClass,superClass;function TaskLoop(hls){for(var _this,_len=arguments.length,events=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)events[_key-1]=arguments[_key];return(_this=_EventHandler.call.apply(_EventHandler,[this,hls].concat(events))||this)._boundTick=void 0,_this._tickTimer=null,_this._tickInterval=null,_this._tickCallCount=0,_this._boundTick=_this.tick.bind(_assertThisInitialized(_this)),_this}superClass=_EventHandler,(subClass=TaskLoop).prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass;var _proto=TaskLoop.prototype;return _proto.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},_proto.hasInterval=function(){return!!this._tickInterval},_proto.hasNextTick=function(){return!!this._tickTimer},_proto.setInterval=function(millis){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,millis),!0)},_proto.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},_proto.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},_proto.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&(this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)),this._tickCallCount=0)},_proto.doTick=function(){},TaskLoop})(event_handler),State_STOPPED="STOPPED",State_STARTING="STARTING",State_IDLE="IDLE",State_PAUSED="PAUSED",State_KEY_LOADING="KEY_LOADING",State_FRAG_LOADING="FRAG_LOADING",State_FRAG_LOADING_WAITING_RETRY="FRAG_LOADING_WAITING_RETRY",State_WAITING_TRACK="WAITING_TRACK",State_PARSING="PARSING",State_PARSED="PARSED",State_BUFFER_FLUSHING="BUFFER_FLUSHING",State_ENDED="ENDED",State_ERROR="ERROR",State_WAITING_INIT_PTS="WAITING_INIT_PTS",State_WAITING_LEVEL="WAITING_LEVEL",base_stream_controller_BaseStreamController=(function(_TaskLoop){var subClass,superClass;function BaseStreamController(){return _TaskLoop.apply(this,arguments)||this}superClass=_TaskLoop,(subClass=BaseStreamController).prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass;var _proto=BaseStreamController.prototype;return _proto.doTick=function(){},_proto.startLoad=function(){},_proto.stopLoad=function(){var frag=this.fragCurrent;frag&&(frag.loader&&frag.loader.abort(),this.fragmentTracker.removeFragment(frag)),this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=State_STOPPED},_proto._streamEnded=function(bufferInfo,levelDetails){var fragCurrent=this.fragCurrent,fragmentTracker=this.fragmentTracker;if(!levelDetails.live&&fragCurrent&&!fragCurrent.backtracked&&fragCurrent.sn===levelDetails.endSN&&!bufferInfo.nextStart){var fragState=fragmentTracker.getState(fragCurrent);return fragState===FragmentState_PARTIAL||fragState===FragmentState_OK}return!1},_proto.onMediaSeeking=function(){var config=this.config,media=this.media,mediaBuffer=this.mediaBuffer,state=this.state,currentTime=media?media.currentTime:null,bufferInfo=BufferHelper.bufferInfo(mediaBuffer||media,currentTime,this.config.maxBufferHole);if(logger.logger.log("media seeking to "+(Object(number.isFiniteNumber)(currentTime)?currentTime.toFixed(3):currentTime)),state===State_FRAG_LOADING){var fragCurrent=this.fragCurrent;if(0===bufferInfo.len&&fragCurrent){var tolerance=config.maxFragLookUpTolerance,fragStartOffset=fragCurrent.start-tolerance,fragEndOffset=fragCurrent.start+fragCurrent.duration+tolerance;currentTime<fragStartOffset||currentTime>fragEndOffset?(fragCurrent.loader&&(logger.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),fragCurrent.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=State_IDLE):logger.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else state===State_ENDED&&(0===bufferInfo.len&&(this.fragPrevious=null,this.fragCurrent=null),this.state=State_IDLE);media&&(this.lastCurrentTime=currentTime),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=currentTime),this.tick()},_proto.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},_proto.onHandlerDestroying=function(){this.stopLoad(),_TaskLoop.prototype.onHandlerDestroying.call(this)},_proto.onHandlerDestroyed=function(){this.state=State_STOPPED,this.fragmentTracker=null},_proto.computeLivePosition=function(sliding,levelDetails){var targetLatency=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*levelDetails.targetduration;return sliding+Math.max(0,levelDetails.totalduration-targetLatency)},BaseStreamController})(TaskLoop);function stream_controller_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var chromeOrFirefox,stream_controller=(function(_BaseStreamController){var subClass,superClass;function StreamController(hls,fragmentTracker){var _this;return(_this=_BaseStreamController.call(this,hls,events.default.MEDIA_ATTACHED,events.default.MEDIA_DETACHING,events.default.MANIFEST_LOADING,events.default.MANIFEST_PARSED,events.default.LEVEL_LOADED,events.default.LEVELS_UPDATED,events.default.KEY_LOADED,events.default.FRAG_LOADED,events.default.FRAG_LOAD_EMERGENCY_ABORTED,events.default.FRAG_PARSING_INIT_SEGMENT,events.default.FRAG_PARSING_DATA,events.default.FRAG_PARSED,events.default.ERROR,events.default.AUDIO_TRACK_SWITCHING,events.default.AUDIO_TRACK_SWITCHED,events.default.BUFFER_CREATED,events.default.BUFFER_APPENDED,events.default.BUFFER_FLUSHED)||this).fragmentTracker=fragmentTracker,_this.config=hls.config,_this.audioCodecSwap=!1,_this._state=State_STOPPED,_this.stallReported=!1,_this.gapController=null,_this.altAudio=!1,_this.audioOnly=!1,_this.bitrateTest=!1,_this}superClass=_BaseStreamController,(subClass=StreamController).prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass;var Constructor,protoProps,staticProps,_proto=StreamController.prototype;return _proto.startLoad=function(startPosition){if(this.levels){var lastCurrentTime=this.lastCurrentTime,hls=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var startLevel=hls.startLevel;-1===startLevel&&(hls.config.testBandwidth?(startLevel=0,this.bitrateTest=!0):startLevel=hls.nextAutoLevel),this.level=hls.nextLoadLevel=startLevel,this.loadedmetadata=!1}lastCurrentTime>0&&-1===startPosition&&(logger.logger.log("override startPosition with lastCurrentTime @"+lastCurrentTime.toFixed(3)),startPosition=lastCurrentTime),this.state=State_IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=startPosition,this.tick()}else this.forceStartLoad=!0,this.state=State_STOPPED},_proto.stopLoad=function(){this.forceStartLoad=!1,_BaseStreamController.prototype.stopLoad.call(this)},_proto.doTick=function(){switch(this.state){case State_BUFFER_FLUSHING:this.fragLoadError=0;break;case State_IDLE:this._doTickIdle();break;case State_WAITING_LEVEL:var level=this.levels[this.level];level&&level.details&&(this.state=State_IDLE);break;case State_FRAG_LOADING_WAITING_RETRY:var now=window.performance.now(),retryDate=this.retryDate;(!retryDate||now>=retryDate||this.media&&this.media.seeking)&&(logger.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=State_IDLE)}this._checkBuffer(),this._checkFragmentChanged()},_proto._doTickIdle=function(){var hls=this.hls,config=hls.config,media=this.media;if(void 0!==this.levelLastLoaded&&(media||!this.startFragRequested&&config.startFragPrefetch))if(this.altAudio&&this.audioOnly)this.demuxer.frag=null;else{var pos;pos=this.loadedmetadata?media.currentTime:this.nextLoadPosition;var level=hls.nextLoadLevel,levelInfo=this.levels[level];if(levelInfo){var maxBufLen,levelBitrate=levelInfo.bitrate;maxBufLen=levelBitrate?Math.max(8*config.maxBufferSize/levelBitrate,config.maxBufferLength):config.maxBufferLength,maxBufLen=Math.min(maxBufLen,config.maxMaxBufferLength);var maxBufferHole=pos<config.maxBufferHole?Math.max(2,config.maxBufferHole):config.maxBufferHole,bufferInfo=BufferHelper.bufferInfo(this.mediaBuffer?this.mediaBuffer:media,pos,maxBufferHole),bufferLen=bufferInfo.len;if(!(bufferLen>=maxBufLen)){logger.logger.trace("buffer length of "+bufferLen.toFixed(3)+" is below max of "+maxBufLen.toFixed(3)+". checking for more payload ..."),this.level=hls.nextLoadLevel=level;var levelDetails=levelInfo.details;if(!levelDetails||levelDetails.live&&this.levelLastLoaded!==level)this.state=State_WAITING_LEVEL;else{if(this._streamEnded(bufferInfo,levelDetails)){var data={};return this.altAudio&&(data.type="video"),this.hls.trigger(events.default.BUFFER_EOS,data),void(this.state=State_ENDED)}this._fetchPayloadOrEos(pos,bufferInfo,levelDetails)}}}}},_proto._fetchPayloadOrEos=function(pos,bufferInfo,levelDetails){var fragPrevious=this.fragPrevious,fragments=(this.level,levelDetails.fragments),fragLen=fragments.length;if(0!==fragLen){var frag,start=fragments[0].start,end=fragments[fragLen-1].start+fragments[fragLen-1].duration,bufferEnd=bufferInfo.end;if(levelDetails.initSegment&&!levelDetails.initSegment.data)frag=levelDetails.initSegment;else if(levelDetails.live){var initialLiveManifestSize=this.config.initialLiveManifestSize;if(fragLen<initialLiveManifestSize)return void logger.logger.warn("Can not start playback of a level, reason: not enough fragments "+fragLen+" < "+initialLiveManifestSize);if(null===(frag=this._ensureFragmentAtLivePoint(levelDetails,bufferEnd,start,end,fragPrevious,fragments)))return}else bufferEnd<start&&(frag=fragments[0]);frag||(frag=this._findFragment(start,fragPrevious,fragLen,fragments,bufferEnd,end,levelDetails)),frag&&(frag.encrypted?this._loadKey(frag,levelDetails):this._loadFragment(frag,levelDetails,pos,bufferEnd))}},_proto._ensureFragmentAtLivePoint=function(levelDetails,bufferEnd,start,end,fragPrevious,fragments){var frag,config=this.hls.config,media=this.media,maxLatency=1/0;if(void 0!==config.liveMaxLatencyDuration?maxLatency=config.liveMaxLatencyDuration:Object(number.isFiniteNumber)(config.liveMaxLatencyDurationCount)&&(maxLatency=config.liveMaxLatencyDurationCount*levelDetails.targetduration),bufferEnd<Math.max(start-config.maxFragLookUpTolerance,end-maxLatency)){var liveSyncPosition=this.liveSyncPosition=this.computeLivePosition(start,levelDetails);bufferEnd=liveSyncPosition,media&&!media.paused&&media.readyState&&media.duration>liveSyncPosition&&liveSyncPosition>media.currentTime&&(logger.logger.log("buffer end: "+bufferEnd.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+liveSyncPosition.toFixed(3)),media.currentTime=liveSyncPosition),this.nextLoadPosition=liveSyncPosition}if(levelDetails.PTSKnown&&bufferEnd>end&&media&&media.readyState)return null;if(this.startFragRequested&&!levelDetails.PTSKnown&&fragPrevious)if(levelDetails.hasProgramDateTime)logger.logger.log("live playlist, switching playlist, load frag with same PDT: "+fragPrevious.programDateTime),frag=findFragmentByPDT(fragments,fragPrevious.endProgramDateTime,config.maxFragLookUpTolerance);else{var targetSN=fragPrevious.sn+1;if(targetSN>=levelDetails.startSN&&targetSN<=levelDetails.endSN){var fragNext=fragments[targetSN-levelDetails.startSN];fragPrevious.cc===fragNext.cc&&(frag=fragNext,logger.logger.log("live playlist, switching playlist, load frag with next SN: "+frag.sn))}frag||(frag=binary_search.search(fragments,(function(frag){return fragPrevious.cc-frag.cc})))&&logger.logger.log("live playlist, switching playlist, load frag with same CC: "+frag.sn)}return frag},_proto._findFragment=function(start,fragPreviousLoad,fragmentIndexRange,fragments,bufferEnd,end,levelDetails){var fragNextLoad,config=this.hls.config;if(fragNextLoad=bufferEnd<end?findFragmentByPTS(fragPreviousLoad,fragments,bufferEnd,bufferEnd>end-config.maxFragLookUpTolerance?0:config.maxFragLookUpTolerance):fragments[fragmentIndexRange-1]){var curSNIdx=fragNextLoad.sn-levelDetails.startSN,sameLevel=fragPreviousLoad&&fragNextLoad.level===fragPreviousLoad.level,prevSnFrag=fragments[curSNIdx-1],nextSnFrag=fragments[curSNIdx+1];if(fragPreviousLoad&&fragNextLoad.sn===fragPreviousLoad.sn)if(sameLevel&&!fragNextLoad.backtracked)if(fragNextLoad.sn<levelDetails.endSN){var deltaPTS=fragPreviousLoad.deltaPTS;deltaPTS&&deltaPTS>config.maxBufferHole&&fragPreviousLoad.dropped&&curSNIdx?(fragNextLoad=prevSnFrag,logger.logger.warn("Previous fragment was dropped with large PTS gap between audio and video. Maybe fragment is not starting with a keyframe? Loading previous one to try to overcome this")):(fragNextLoad=nextSnFrag,this.fragmentTracker.getState(fragNextLoad)!==FragmentState_OK&&logger.logger.log("Re-loading fragment with SN: "+fragNextLoad.sn))}else fragNextLoad=null;else fragNextLoad.backtracked&&(nextSnFrag&&nextSnFrag.backtracked?(logger.logger.warn("Already backtracked from fragment "+nextSnFrag.sn+", will not backtrack to fragment "+fragNextLoad.sn+". Loading fragment "+nextSnFrag.sn),fragNextLoad=nextSnFrag):(logger.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),fragNextLoad.dropped=0,prevSnFrag?(fragNextLoad=prevSnFrag).backtracked=!0:curSNIdx&&(fragNextLoad=null)))}return fragNextLoad},_proto._loadKey=function(frag,levelDetails){logger.logger.log("Loading key for "+frag.sn+" of ["+levelDetails.startSN+"-"+levelDetails.endSN+"], level "+this.level),this.state=State_KEY_LOADING,this.hls.trigger(events.default.KEY_LOADING,{frag})},_proto._loadFragment=function(frag,levelDetails,pos,bufferEnd){var fragState=this.fragmentTracker.getState(frag);this.fragCurrent=frag,"initSegment"!==frag.sn&&(this.startFragRequested=!0),Object(number.isFiniteNumber)(frag.sn)&&!frag.bitrateTest&&(this.nextLoadPosition=frag.start+frag.duration),frag.backtracked||fragState===FragmentState_NOT_LOADED||fragState===FragmentState_PARTIAL?(frag.autoLevel=this.hls.autoLevelEnabled,frag.bitrateTest=this.bitrateTest,logger.logger.log("Loading "+frag.sn+" of ["+levelDetails.startSN+"-"+levelDetails.endSN+"], level "+this.level+", "+(this.loadedmetadata?"currentTime":"nextLoadPosition")+": "+parseFloat(pos.toFixed(3))+", bufferEnd: "+parseFloat(bufferEnd.toFixed(3))),this.hls.trigger(events.default.FRAG_LOADING,{frag}),this.demuxer||(this.demuxer=new demux_demuxer(this.hls,"main")),this.state=State_FRAG_LOADING):fragState===FragmentState_APPENDING&&this._reduceMaxBufferLength(frag.duration)&&this.fragmentTracker.removeFragment(frag)},_proto.getBufferedFrag=function(position){return this.fragmentTracker.getBufferedFrag(position,PlaylistLevelType.MAIN)},_proto.followingBufferedFrag=function(frag){return frag?this.getBufferedFrag(frag.endPTS+.5):null},_proto._checkFragmentChanged=function(){var fragPlayingCurrent,currentTime,video=this.media;if(video&&video.readyState&&!1===video.seeking&&((currentTime=video.currentTime)>this.lastCurrentTime&&(this.lastCurrentTime=currentTime),BufferHelper.isBuffered(video,currentTime)?fragPlayingCurrent=this.getBufferedFrag(currentTime):BufferHelper.isBuffered(video,currentTime+.1)&&(fragPlayingCurrent=this.getBufferedFrag(currentTime+.1)),fragPlayingCurrent)){var fragPlaying=fragPlayingCurrent;if(fragPlaying!==this.fragPlaying){this.hls.trigger(events.default.FRAG_CHANGED,{frag:fragPlaying});var fragPlayingLevel=fragPlaying.level;this.fragPlaying&&this.fragPlaying.level===fragPlayingLevel||this.hls.trigger(events.default.LEVEL_SWITCHED,{level:fragPlayingLevel}),this.fragPlaying=fragPlaying}}},_proto.immediateLevelSwitch=function(){if(logger.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var previouslyPaused,media=this.media;media?(previouslyPaused=media.paused)||media.pause():previouslyPaused=!0,this.previouslyPaused=previouslyPaused}var fragCurrent=this.fragCurrent;fragCurrent&&fragCurrent.loader&&fragCurrent.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},_proto.immediateLevelSwitchEnd=function(){var media=this.media;media&&media.buffered.length&&(this.immediateSwitch=!1,media.currentTime>0&&BufferHelper.isBuffered(media,media.currentTime)&&(media.currentTime-=1e-4),this.previouslyPaused||media.play())},_proto.nextLevelSwitch=function(){var media=this.media;if(media&&media.readyState){var fetchdelay,fragPlayingCurrent=this.getBufferedFrag(media.currentTime);if(fragPlayingCurrent&&fragPlayingCurrent.startPTS>1&&this.flushMainBuffer(0,fragPlayingCurrent.startPTS-1),media.paused)fetchdelay=0;else{var nextLevelId=this.hls.nextLoadLevel,nextLevel=this.levels[nextLevelId],fragLastKbps=this.fragLastKbps;fetchdelay=fragLastKbps&&this.fragCurrent?this.fragCurrent.duration*nextLevel.bitrate/(1e3*fragLastKbps)+1:0}var bufferedFrag=this.getBufferedFrag(media.currentTime+fetchdelay);if(bufferedFrag){var nextBufferedFrag=this.followingBufferedFrag(bufferedFrag);if(nextBufferedFrag){var fragCurrent=this.fragCurrent;fragCurrent&&fragCurrent.loader&&fragCurrent.loader.abort(),this.fragCurrent=null;var startPts=Math.max(bufferedFrag.endPTS,nextBufferedFrag.maxStartPTS+Math.min(this.config.maxFragLookUpTolerance,nextBufferedFrag.duration));this.flushMainBuffer(startPts,Number.POSITIVE_INFINITY)}}}},_proto.flushMainBuffer=function(startOffset,endOffset){this.state=State_BUFFER_FLUSHING;var flushScope={startOffset,endOffset};this.altAudio&&(flushScope.type="video"),this.hls.trigger(events.default.BUFFER_FLUSHING,flushScope)},_proto.onMediaAttached=function(data){var media=this.media=this.mediaBuffer=data.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),media.addEventListener("seeking",this.onvseeking),media.addEventListener("seeked",this.onvseeked),media.addEventListener("ended",this.onvended);var config=this.config;this.levels&&config.autoStartLoad&&this.hls.startLoad(config.startPosition),this.gapController=new gap_controller_GapController(config,media,this.fragmentTracker,this.hls)},_proto.onMediaDetaching=function(){var media=this.media;media&&media.ended&&(logger.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var levels=this.levels;levels&&levels.forEach((function(level){level.details&&level.details.fragments.forEach((function(fragment){fragment.backtracked=void 0}))})),media&&(media.removeEventListener("seeking",this.onvseeking),media.removeEventListener("seeked",this.onvseeked),media.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.fragmentTracker.removeAllFragments(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},_proto.onMediaSeeked=function(){var media=this.media,currentTime=media?media.currentTime:void 0;Object(number.isFiniteNumber)(currentTime)&&logger.logger.log("media seeked to "+currentTime.toFixed(3)),this.tick()},_proto.onManifestLoading=function(){logger.logger.log("trigger BUFFER_RESET"),this.hls.trigger(events.default.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},_proto.onManifestParsed=function(data){var codec,aac=!1,heaac=!1;data.levels.forEach((function(level){(codec=level.audioCodec)&&(-1!==codec.indexOf("mp4a.40.2")&&(aac=!0),-1!==codec.indexOf("mp4a.40.5")&&(heaac=!0))})),this.audioCodecSwitch=aac&&heaac,this.audioCodecSwitch&&logger.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.altAudio=data.altAudio,this.levels=data.levels,this.startFragRequested=!1;var config=this.config;(config.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(config.startPosition)},_proto.onLevelLoaded=function(data){var newDetails=data.details,newLevelId=data.level,lastLevel=this.levels[this.levelLastLoaded],curLevel=this.levels[newLevelId],duration=newDetails.totalduration,sliding=0;if(logger.logger.log("level "+newLevelId+" loaded ["+newDetails.startSN+","+newDetails.endSN+"],duration:"+duration),newDetails.live||curLevel.details&&curLevel.details.live){var curDetails=curLevel.details;curDetails&&newDetails.fragments.length>0?(mergeDetails(curDetails,newDetails),sliding=newDetails.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(sliding,curDetails),newDetails.PTSKnown&&Object(number.isFiniteNumber)(sliding)?logger.logger.log("live playlist sliding:"+sliding.toFixed(3)):(logger.logger.log("live playlist - outdated PTS, unknown sliding"),alignStream(this.fragPrevious,lastLevel,newDetails))):(logger.logger.log("live playlist - first load, unknown sliding"),newDetails.PTSKnown=!1,alignStream(this.fragPrevious,lastLevel,newDetails))}else newDetails.PTSKnown=!1;if(curLevel.details=newDetails,this.levelLastLoaded=newLevelId,this.hls.trigger(events.default.LEVEL_UPDATED,{details:newDetails,level:newLevelId}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var startTimeOffset=newDetails.startTimeOffset;Object(number.isFiniteNumber)(startTimeOffset)?(startTimeOffset<0&&(logger.logger.log("negative start time offset "+startTimeOffset+", count from end of last fragment"),startTimeOffset=sliding+duration+startTimeOffset),logger.logger.log("start time offset found in playlist, adjust startPosition to "+startTimeOffset),this.startPosition=startTimeOffset):newDetails.live?(this.startPosition=this.computeLivePosition(sliding,newDetails),logger.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===State_WAITING_LEVEL&&(this.state=State_IDLE),this.tick()},_proto.onKeyLoaded=function(){this.state===State_KEY_LOADING&&(this.state=State_IDLE,this.tick())},_proto.onFragLoaded=function(data){var fragCurrent=this.fragCurrent,hls=this.hls,levels=this.levels,media=this.media,fragLoaded=data.frag;if(this.state===State_FRAG_LOADING&&fragCurrent&&"main"===fragLoaded.type&&fragLoaded.level===fragCurrent.level&&fragLoaded.sn===fragCurrent.sn){var stats=data.stats,currentLevel=levels[fragCurrent.level],details=currentLevel.details;if(this.bitrateTest=!1,this.stats=stats,logger.logger.log("Loaded "+fragCurrent.sn+" of ["+details.startSN+" ,"+details.endSN+"],level "+fragCurrent.level),fragLoaded.bitrateTest&&hls.nextLoadLevel)this.state=State_IDLE,this.startFragRequested=!1,stats.tparsed=stats.tbuffered=window.performance.now(),hls.trigger(events.default.FRAG_BUFFERED,{stats,frag:fragCurrent,id:"main"}),this.tick();else if("initSegment"===fragLoaded.sn)this.state=State_IDLE,stats.tparsed=stats.tbuffered=window.performance.now(),details.initSegment.data=data.payload,hls.trigger(events.default.FRAG_BUFFERED,{stats,frag:fragCurrent,id:"main"}),this.tick();else{logger.logger.log("Parsing "+fragCurrent.sn+" of ["+details.startSN+" ,"+details.endSN+"],level "+fragCurrent.level+", cc "+fragCurrent.cc),this.state=State_PARSING,this.pendingBuffering=!0,this.appended=!1,fragLoaded.bitrateTest&&(fragLoaded.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:fragLoaded}));var accurateTimeOffset=!(media&&media.seeking)&&(details.PTSKnown||!details.live),initSegmentData=details.initSegment?details.initSegment.data:[],audioCodec=this._getAudioCodec(currentLevel);(this.demuxer=this.demuxer||new demux_demuxer(this.hls,"main")).push(data.payload,initSegmentData,audioCodec,currentLevel.videoCodec,fragCurrent,details.totalduration,accurateTimeOffset)}}this.fragLoadError=0},_proto.onFragParsingInitSegment=function(data){var fragCurrent=this.fragCurrent,fragNew=data.frag;if(fragCurrent&&"main"===data.id&&fragNew.sn===fragCurrent.sn&&fragNew.level===fragCurrent.level&&this.state===State_PARSING){var trackName,track,tracks=data.tracks;if(this.audioOnly=tracks.audio&&!tracks.video,this.altAudio&&!this.audioOnly&&delete tracks.audio,track=tracks.audio){var audioCodec=this.levels[this.level].audioCodec,ua=navigator.userAgent.toLowerCase();audioCodec&&this.audioCodecSwap&&(logger.logger.log("swapping playlist audio codec"),audioCodec=-1!==audioCodec.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==track.metadata.channelCount&&-1===ua.indexOf("firefox")&&(audioCodec="mp4a.40.5"),-1!==ua.indexOf("android")&&"audio/mpeg"!==track.container&&(audioCodec="mp4a.40.2",logger.logger.log("Android: force audio codec to "+audioCodec)),track.levelCodec=audioCodec,track.id=data.id}for(trackName in(track=tracks.video)&&(track.levelCodec=this.levels[this.level].videoCodec,track.id=data.id),this.hls.trigger(events.default.BUFFER_CODECS,tracks),tracks){track=tracks[trackName],logger.logger.log("main track:"+trackName+",container:"+track.container+",codecs[level/parsed]=["+track.levelCodec+"/"+track.codec+"]");var initSegment=track.initSegment;initSegment&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(events.default.BUFFER_APPENDING,{type:trackName,data:initSegment,parent:"main",content:"initSegment"}))}this.tick()}},_proto.onFragParsingData=function(data){var _this2=this,fragCurrent=this.fragCurrent,fragNew=data.frag;if(fragCurrent&&"main"===data.id&&fragNew.sn===fragCurrent.sn&&fragNew.level===fragCurrent.level&&("audio"!==data.type||!this.altAudio)&&this.state===State_PARSING){var level=this.levels[this.level],frag=fragCurrent;if(Object(number.isFiniteNumber)(data.endPTS)||(data.endPTS=data.startPTS+fragCurrent.duration,data.endDTS=data.startDTS+fragCurrent.duration),!0===data.hasAudio&&frag.addElementaryStream(ElementaryStreamTypes.AUDIO),!0===data.hasVideo&&frag.addElementaryStream(ElementaryStreamTypes.VIDEO),logger.logger.log("Parsed "+data.type+",PTS:["+data.startPTS.toFixed(3)+","+data.endPTS.toFixed(3)+"],DTS:["+data.startDTS.toFixed(3)+"/"+data.endDTS.toFixed(3)+"],nb:"+data.nb+",dropped:"+(data.dropped||0)),"video"===data.type)if(frag.dropped=data.dropped,frag.dropped)if(frag.backtracked)logger.logger.warn("Already backtracked on this fragment, appending with the gap",frag.sn);else{var levelDetails=level.details;if(!levelDetails||frag.sn!==levelDetails.startSN)return logger.logger.warn("missing video frame(s), backtracking fragment",frag.sn),this.fragmentTracker.removeFragment(frag),frag.backtracked=!0,this.nextLoadPosition=data.startPTS,this.state=State_IDLE,this.fragPrevious=frag,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),void this.tick();logger.logger.warn("missing video frame(s) on first frag, appending with gap",frag.sn)}else frag.backtracked=!1;var drift=updateFragPTSDTS(level.details,frag,data.startPTS,data.endPTS,data.startDTS,data.endDTS),hls=this.hls;hls.trigger(events.default.LEVEL_PTS_UPDATED,{details:level.details,level:this.level,drift,type:data.type,start:data.startPTS,end:data.endPTS}),[data.data1,data.data2].forEach((function(buffer){buffer&&buffer.length&&_this2.state===State_PARSING&&(_this2.appended=!0,_this2.pendingBuffering=!0,hls.trigger(events.default.BUFFER_APPENDING,{type:data.type,data:buffer,parent:"main",content:"data"}))})),this.tick()}},_proto.onFragParsed=function(data){var fragCurrent=this.fragCurrent,fragNew=data.frag;fragCurrent&&"main"===data.id&&fragNew.sn===fragCurrent.sn&&fragNew.level===fragCurrent.level&&this.state===State_PARSING&&(this.stats.tparsed=window.performance.now(),this.state=State_PARSED,this._checkAppendedParsed())},_proto.onAudioTrackSwitching=function(data){var fromAltAudio=this.altAudio,altAudio=!!data.url,trackId=data.id;if(!altAudio){if(this.mediaBuffer!==this.media){logger.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var fragCurrent=this.fragCurrent;fragCurrent.loader&&(logger.logger.log("switching to main audio track, cancel main fragment load"),fragCurrent.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=State_IDLE}var hls=this.hls;fromAltAudio&&hls.trigger(events.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),hls.trigger(events.default.AUDIO_TRACK_SWITCHED,{id:trackId})}},_proto.onAudioTrackSwitched=function(data){var trackId=data.id,altAudio=!!this.hls.audioTracks[trackId].url;if(altAudio){var videoBuffer=this.videoBuffer;videoBuffer&&this.mediaBuffer!==videoBuffer&&(logger.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=videoBuffer)}this.altAudio=altAudio,this.tick()},_proto.onBufferCreated=function(data){var mediaTrack,name,tracks=data.tracks,alternate=!1;for(var type in tracks){var track=tracks[type];"main"===track.id?(name=type,mediaTrack=track,"video"===type&&(this.videoBuffer=tracks[type].buffer)):alternate=!0}alternate&&mediaTrack?(logger.logger.log("alternate track found, use "+name+".buffered to schedule main fragment loading"),this.mediaBuffer=mediaTrack.buffer):this.mediaBuffer=this.media},_proto.onBufferAppended=function(data){if("main"===data.parent){var state=this.state;state!==State_PARSING&&state!==State_PARSED||(this.pendingBuffering=data.pending>0,this._checkAppendedParsed())}},_proto._checkAppendedParsed=function(){if(!(this.state!==State_PARSED||this.appended&&this.pendingBuffering)){var frag=this.fragCurrent;if(frag){var media=this.mediaBuffer?this.mediaBuffer:this.media;logger.logger.log("main buffered : "+time_ranges.toString(media.buffered)),this.fragPrevious=frag;var stats=this.stats;stats.tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*stats.total/(stats.tbuffered-stats.tfirst)),this.hls.trigger(events.default.FRAG_BUFFERED,{stats,frag,id:"main"}),this.state=State_IDLE}(this.loadedmetadata||this.startPosition<=0)&&this.tick()}},_proto.onError=function(data){var frag=data.frag||this.fragCurrent;if(!frag||"main"===frag.type){var mediaBuffered=!!this.media&&BufferHelper.isBuffered(this.media,this.media.currentTime)&&BufferHelper.isBuffered(this.media,this.media.currentTime+.5);switch(data.details){case errors.ErrorDetails.FRAG_LOAD_ERROR:case errors.ErrorDetails.FRAG_LOAD_TIMEOUT:case errors.ErrorDetails.KEY_LOAD_ERROR:case errors.ErrorDetails.KEY_LOAD_TIMEOUT:if(!data.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var delay=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);logger.logger.warn("mediaController: frag loading failed, retry in "+delay+" ms"),this.retryDate=window.performance.now()+delay,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=State_FRAG_LOADING_WAITING_RETRY}else logger.logger.error("mediaController: "+data.details+" reaches max retry, redispatch as fatal ..."),data.fatal=!0,this.state=State_ERROR;break;case errors.ErrorDetails.LEVEL_LOAD_ERROR:case errors.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==State_ERROR&&(data.fatal?(this.state=State_ERROR,logger.logger.warn("streamController: "+data.details+",switch to "+this.state+" state ...")):data.levelRetry||this.state!==State_WAITING_LEVEL||(this.state=State_IDLE));break;case errors.ErrorDetails.BUFFER_FULL_ERROR:"main"!==data.parent||this.state!==State_PARSING&&this.state!==State_PARSED||(mediaBuffered?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=State_IDLE):(logger.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}},_proto._reduceMaxBufferLength=function(minLength){var config=this.config;return config.maxMaxBufferLength>=minLength&&(config.maxMaxBufferLength/=2,logger.logger.warn("main:reduce max buffer length to "+config.maxMaxBufferLength+"s"),!0)},_proto._checkBuffer=function(){var media=this.media;if(media&&0!==media.readyState){var buffered=(this.mediaBuffer?this.mediaBuffer:media).buffered;!this.loadedmetadata&&buffered.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,buffered)}},_proto.onFragLoadEmergencyAborted=function(){this.state=State_IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},_proto.onBufferFlushed=function(){var media=this.mediaBuffer?this.mediaBuffer:this.media;if(media){var elementaryStreamType=this.audioOnly?ElementaryStreamTypes.AUDIO:ElementaryStreamTypes.VIDEO;this.fragmentTracker.detectEvictedFragments(elementaryStreamType,media.buffered)}this.state=State_IDLE,this.fragPrevious=null},_proto.onLevelsUpdated=function(data){this.levels=data.levels},_proto.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},_proto._seekToStartPos=function(){var media=this.media,currentTime=media.currentTime,startPosition=this.startPosition;if(currentTime!==startPosition&&startPosition>=0){if(media.seeking)return void logger.logger.log("could not seek to "+startPosition+", already seeking at "+currentTime);var delta=(media.buffered.length?media.buffered.start(0):0)-startPosition;delta>0&&delta<this.config.maxBufferHole&&(logger.logger.log("adjusting start position by "+delta+" to match buffer start"),startPosition+=delta,this.startPosition=startPosition),logger.logger.log("seek to target start position "+startPosition+" from current time "+currentTime+". ready state "+media.readyState),media.currentTime=startPosition}},_proto._getAudioCodec=function(currentLevel){var audioCodec=this.config.defaultAudioCodec||currentLevel.audioCodec;return this.audioCodecSwap&&(logger.logger.log("swapping playlist audio codec"),audioCodec&&(audioCodec=-1!==audioCodec.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),audioCodec},Constructor=StreamController,(protoProps=[{key:"state",set:function(nextState){if(this.state!==nextState){var previousState=this.state;this._state=nextState,logger.logger.log("main stream-controller: "+previousState+"->"+nextState),this.hls.trigger(events.default.STREAM_STATE_TRANSITION,{previousState,nextState})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var media=this.media;if(media){var frag=this.getBufferedFrag(media.currentTime);if(frag)return frag.level}return-1}},{key:"nextBufferedFrag",get:function(){var media=this.media;return media?this.followingBufferedFrag(this.getBufferedFrag(media.currentTime)):null}},{key:"nextLevel",get:function(){var frag=this.nextBufferedFrag;return frag?frag.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(value){this._liveSyncPosition=value}}])&&stream_controller_defineProperties(Constructor.prototype,protoProps),staticProps&&stream_controller_defineProperties(Constructor,staticProps),StreamController})(base_stream_controller_BaseStreamController);function level_controller_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var level_controller_LevelController=(function(_EventHandler){var subClass,superClass;function LevelController(hls){var _this;return(_this=_EventHandler.call(this,hls,events.default.MANIFEST_LOADED,events.default.LEVEL_LOADED,events.default.AUDIO_TRACK_SWITCHED,events.default.FRAG_LOADED,events.default.ERROR)||this).canload=!1,_this.currentLevelIndex=null,_this.manualLevelIndex=-1,_this.timer=null,chromeOrFirefox=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),_this}superClass=_EventHandler,(subClass=LevelController).prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass;var Constructor,protoProps,staticProps,_proto=LevelController.prototype;return _proto.onHandlerDestroying=function(){this.clearTimer(),this.manualLevelIndex=-1},_proto.clearTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},_proto.startLoad=function(){var levels=this._levels;this.canload=!0,this.levelRetryCount=0,levels&&levels.forEach((function(level){level.loadError=0;var levelDetails=level.details;levelDetails&&levelDetails.live&&(level.details=void 0)})),null!==this.timer&&this.loadLevel()},_proto.stopLoad=function(){this.canload=!1},_proto.onManifestLoaded=function(data){var bitrateStart,levels=[],audioTracks=[],levelSet={},levelFromSet=null,videoCodecFound=!1,audioCodecFound=!1;if(data.levels.forEach((function(level){var attributes=level.attrs;level.loadError=0,level.fragmentError=!1,videoCodecFound=videoCodecFound||!!level.videoCodec,audioCodecFound=audioCodecFound||!!level.audioCodec,chromeOrFirefox&&level.audioCodec&&-1!==level.audioCodec.indexOf("mp4a.40.34")&&(level.audioCodec=void 0),(levelFromSet=levelSet[level.bitrate])?levelFromSet.url.push(level.url):(level.url=[level.url],level.urlId=0,levelSet[level.bitrate]=level,levels.push(level)),attributes&&(attributes.AUDIO&&addGroupId(levelFromSet||level,"audio",attributes.AUDIO),attributes.SUBTITLES&&addGroupId(levelFromSet||level,"text",attributes.SUBTITLES))})),videoCodecFound&&audioCodecFound&&(levels=levels.filter((function(_ref){return!!_ref.videoCodec}))),levels=levels.filter((function(_ref2){var audioCodec=_ref2.audioCodec,videoCodec=_ref2.videoCodec;return(!audioCodec||isCodecSupportedInMp4(audioCodec,"audio"))&&(!videoCodec||isCodecSupportedInMp4(videoCodec,"video"))})),data.audioTracks&&(audioTracks=data.audioTracks.filter((function(track){return!track.audioCodec||isCodecSupportedInMp4(track.audioCodec,"audio")}))).forEach((function(track,index){track.id=index})),levels.length>0){bitrateStart=levels[0].bitrate,levels.sort((function(a,b){return a.bitrate-b.bitrate})),this._levels=levels;for(var i=0;i<levels.length;i++)if(levels[i].bitrate===bitrateStart){this._firstLevel=i,logger.logger.log("manifest loaded,"+levels.length+" level(s) found, first bitrate:"+bitrateStart);break}var audioOnly=audioCodecFound&&!videoCodecFound;this.hls.trigger(events.default.MANIFEST_PARSED,{levels,audioTracks,firstLevel:this._firstLevel,stats:data.stats,audio:audioCodecFound,video:videoCodecFound,altAudio:!audioOnly&&audioTracks.some((function(t){return!!t.url}))})}else this.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.MEDIA_ERROR,details:errors.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},_proto.setLevelInternal=function(newLevel){var levels=this._levels,hls=this.hls;if(newLevel>=0&&newLevel<levels.length){if(this.clearTimer(),this.currentLevelIndex!==newLevel){logger.logger.log("switching to level "+newLevel),this.currentLevelIndex=newLevel;var levelProperties=levels[newLevel];levelProperties.level=newLevel,hls.trigger(events.default.LEVEL_SWITCHING,levelProperties)}var level=levels[newLevel],levelDetails=level.details;if(!levelDetails||levelDetails.live){var urlId=level.urlId;hls.trigger(events.default.LEVEL_LOADING,{url:level.url[urlId],level:newLevel,id:urlId})}}else hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.OTHER_ERROR,details:errors.ErrorDetails.LEVEL_SWITCH_ERROR,level:newLevel,fatal:!1,reason:"invalid level idx"})},_proto.onError=function(data){if(data.fatal)data.type===errors.ErrorTypes.NETWORK_ERROR&&this.clearTimer();else{var levelIndex,levelError=!1,fragmentError=!1;switch(data.details){case errors.ErrorDetails.FRAG_LOAD_ERROR:case errors.ErrorDetails.FRAG_LOAD_TIMEOUT:case errors.ErrorDetails.KEY_LOAD_ERROR:case errors.ErrorDetails.KEY_LOAD_TIMEOUT:levelIndex=data.frag.level,fragmentError=!0;break;case errors.ErrorDetails.LEVEL_LOAD_ERROR:case errors.ErrorDetails.LEVEL_LOAD_TIMEOUT:levelIndex=data.context.level,levelError=!0;break;case errors.ErrorDetails.REMUX_ALLOC_ERROR:levelIndex=data.level,levelError=!0}void 0!==levelIndex&&this.recoverLevel(data,levelIndex,levelError,fragmentError)}},_proto.recoverLevel=function(errorEvent,levelIndex,levelError,fragmentError){var redundantLevels,delay,nextLevel,_this2=this,config=this.hls.config,errorDetails=errorEvent.details,level=this._levels[levelIndex];if(level.loadError++,level.fragmentError=fragmentError,levelError){if(!(this.levelRetryCount+1<=config.levelLoadingMaxRetry))return logger.logger.error("level controller, cannot recover from "+errorDetails+" error"),this.currentLevelIndex=null,this.clearTimer(),void(errorEvent.fatal=!0);delay=Math.min(Math.pow(2,this.levelRetryCount)*config.levelLoadingRetryDelay,config.levelLoadingMaxRetryTimeout),this.timer=setTimeout((function(){return _this2.loadLevel()}),delay),errorEvent.levelRetry=!0,this.levelRetryCount++,logger.logger.warn("level controller, "+errorDetails+", retry in "+delay+" ms, current retry count is "+this.levelRetryCount)}(levelError||fragmentError)&&((redundantLevels=level.url.length)>1&&level.loadError<redundantLevels?(level.urlId=(level.urlId+1)%redundantLevels,level.details=void 0,logger.logger.warn("level controller, "+errorDetails+" for level "+levelIndex+": switching to redundant URL-id "+level.urlId)):-1===this.manualLevelIndex?(nextLevel=0===levelIndex?this._levels.length-1:levelIndex-1,logger.logger.warn("level controller, "+errorDetails+": switch to "+nextLevel),this.hls.nextAutoLevel=this.currentLevelIndex=nextLevel):fragmentError&&(logger.logger.warn("level controller, "+errorDetails+": reload a fragment"),this.currentLevelIndex=null))},_proto.onFragLoaded=function(_ref3){var frag=_ref3.frag;if(void 0!==frag&&"main"===frag.type){var level=this._levels[frag.level];void 0!==level&&(level.fragmentError=!1,level.loadError=0,this.levelRetryCount=0)}},_proto.onLevelLoaded=function(data){var _this3=this,level=data.level,details=data.details;if(level===this.currentLevelIndex){var curLevel=this._levels[level];if(curLevel.fragmentError||(curLevel.loadError=0,this.levelRetryCount=0),details.live){var reloadInterval=computeReloadInterval(curLevel.details,details,data.stats.trequest);logger.logger.log("live playlist, reload in "+Math.round(reloadInterval)+" ms"),this.timer=setTimeout((function(){return _this3.loadLevel()}),reloadInterval)}else this.clearTimer()}},_proto.onAudioTrackSwitched=function(data){var audioGroupId=this.hls.audioTracks[data.id].groupId,currentLevel=this.hls.levels[this.currentLevelIndex];if(currentLevel&&currentLevel.audioGroupIds){for(var urlId=-1,i=0;i<currentLevel.audioGroupIds.length;i++)if(currentLevel.audioGroupIds[i]===audioGroupId){urlId=i;break}urlId!==currentLevel.urlId&&(currentLevel.urlId=urlId,this.startLoad())}},_proto.loadLevel=function(){if(logger.logger.debug("call to loadLevel"),null!==this.currentLevelIndex&&this.canload){var levelObject=this._levels[this.currentLevelIndex];if("object"==typeof levelObject&&levelObject.url.length>0){var level=this.currentLevelIndex,id=levelObject.urlId,url=levelObject.url[id];logger.logger.log("Attempt loading level index "+level+" with URL-id "+id),this.hls.trigger(events.default.LEVEL_LOADING,{url,level,id})}}},_proto.removeLevel=function(levelIndex,urlId){var levels=this.levels.filter((function(level,index){return index!==levelIndex||level.url.length>1&&void 0!==urlId&&(level.url=level.url.filter((function(url,id){return id!==urlId})),level.urlId=0,!0)})).map((function(level,index){var details=level.details;return details&&details.fragments&&details.fragments.forEach((function(fragment){fragment.level=index})),level}));this._levels=levels,this.hls.trigger(events.default.LEVELS_UPDATED,{levels})},Constructor=LevelController,(protoProps=[{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(newLevel){var levels=this._levels;levels&&(newLevel=Math.min(newLevel,levels.length-1),this.currentLevelIndex===newLevel&&levels[newLevel].details||this.setLevelInternal(newLevel))}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(newLevel){this.manualLevelIndex=newLevel,void 0===this._startLevel&&(this._startLevel=newLevel),-1!==newLevel&&(this.level=newLevel)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(newLevel){this._firstLevel=newLevel}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var configStartLevel=this.hls.config.startLevel;return void 0!==configStartLevel?configStartLevel:this._firstLevel}return this._startLevel},set:function(newLevel){this._startLevel=newLevel}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(nextLevel){this.level=nextLevel,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=nextLevel)}}])&&level_controller_defineProperties(Constructor.prototype,protoProps),staticProps&&level_controller_defineProperties(Constructor,staticProps),LevelController})(event_handler),id3=__webpack_require__("./src/demux/id3.js");function sendAddTrackEvent(track,videoEl){var event;try{event=new Event("addtrack")}catch(err){(event=document.createEvent("Event")).initEvent("addtrack",!1,!1)}event.track=track,videoEl.dispatchEvent(event)}function clearCurrentCues(track){if(null==track?void 0:track.cues)for(;track.cues.length>0;)track.removeCue(track.cues[0])}var id3_track_controller=(function(_EventHandler){var subClass,superClass;function ID3TrackController(hls){var _this;return(_this=_EventHandler.call(this,hls,events.default.MEDIA_ATTACHED,events.default.MEDIA_DETACHING,events.default.FRAG_PARSING_METADATA,events.default.LIVE_BACK_BUFFER_REACHED)||this).id3Track=void 0,_this.media=void 0,_this}superClass=_EventHandler,(subClass=ID3TrackController).prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass;var _proto=ID3TrackController.prototype;return _proto.destroy=function(){event_handler.prototype.destroy.call(this)},_proto.onMediaAttached=function(data){this.media=data.media,this.media},_proto.onMediaDetaching=function(){clearCurrentCues(this.id3Track),this.id3Track=void 0,this.media=void 0},_proto.getID3Track=function(textTracks){for(var i=0;i<textTracks.length;i++){var textTrack=textTracks[i];if("metadata"===textTrack.kind&&"id3"===textTrack.label)return sendAddTrackEvent(textTrack,this.media),textTrack}return this.media.addTextTrack("metadata","id3")},_proto.onFragParsingMetadata=function(data){var fragment=data.frag,samples=data.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var Cue=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,i=0;i<samples.length;i++){var frames=id3.default.getID3Frames(samples[i].data);if(frames){var startTime=Math.max(samples[i].pts,0),endTime=i<samples.length-1?samples[i+1].pts:fragment.endPTS;endTime||(endTime=fragment.start+fragment.duration),endTime-startTime<=0&&(endTime=startTime+.25);for(var j=0;j<frames.length;j++){var frame=frames[j];if(!id3.default.isTimeStampFrame(frame)){var cue=new Cue(startTime,endTime,"");cue.value=frame,this.id3Track.addCue(cue)}}}}},_proto.onLiveBackBufferReached=function(_ref){var bufferEnd=_ref.bufferEnd,id3Track=this.id3Track;if(id3Track&&id3Track.cues&&id3Track.cues.length){var foundCue=(function(cues,time){if(time<cues[0].endTime)return cues[0];if(time>cues[cues.length-1].endTime)return cues[cues.length-1];for(var left=0,right=cues.length-1;left<=right;){var mid=Math.floor((right+left)/2);if(time<cues[mid].endTime)right=mid-1;else{if(!(time>cues[mid].endTime))return cues[mid];left=mid+1}}return cues[left].endTime-time<time-cues[right].endTime?cues[left]:cues[right]})(id3Track.cues,bufferEnd);if(foundCue)for(;id3Track.cues[0]!==foundCue;)id3Track.removeCue(id3Track.cues[0])}},ID3TrackController})(event_handler),ewma=(function(){function EWMA(halfLife){this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.alpha_=halfLife?Math.exp(Math.log(.5)/halfLife):0,this.estimate_=0,this.totalWeight_=0}var _proto=EWMA.prototype;return _proto.sample=function(weight,value){var adjAlpha=Math.pow(this.alpha_,weight);this.estimate_=value*(1-adjAlpha)+adjAlpha*this.estimate_,this.totalWeight_+=weight},_proto.getTotalWeight=function(){return this.totalWeight_},_proto.getEstimate=function(){if(this.alpha_){var zeroFactor=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/zeroFactor}return this.estimate_},EWMA})(),ewma_bandwidth_estimator=(function(){function EwmaBandWidthEstimator(hls,slow,fast,defaultEstimate){this.hls=void 0,this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.hls=hls,this.defaultEstimate_=defaultEstimate,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new ewma(slow),this.fast_=new ewma(fast)}var _proto=EwmaBandWidthEstimator.prototype;return _proto.sample=function(durationMs,numBytes){var durationS=(durationMs=Math.max(durationMs,this.minDelayMs_))/1e3,bandwidthInBps=8*numBytes/durationS;this.fast_.sample(durationS,bandwidthInBps),this.slow_.sample(durationS,bandwidthInBps)},_proto.canEstimate=function(){var fast=this.fast_;return fast&&fast.getTotalWeight()>=this.minWeight_},_proto.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},_proto.destroy=function(){},EwmaBandWidthEstimator})();function abr_controller_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var abr_controller_performance=window.performance,abr_controller=(function(_EventHandler){var subClass,superClass;function AbrController(hls){var _this;return(_this=_EventHandler.call(this,hls,events.default.FRAG_LOADING,events.default.FRAG_LOADED,events.default.FRAG_BUFFERED,events.default.ERROR)||this).lastLoadedFragLevel=0,_this._nextAutoLevel=-1,_this.hls=hls,_this.timer=null,_this._bwEstimator=null,_this.onCheck=_this._abandonRulesCheck.bind((function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self})(_this)),_this}superClass=_EventHandler,(subClass=AbrController).prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass;var Constructor,protoProps,staticProps,_proto=AbrController.prototype;return _proto.destroy=function(){this.clearTimer(),event_handler.prototype.destroy.call(this)},_proto.onFragLoading=function(data){var frag=data.frag;if("main"===frag.type&&(this.timer||(this.fragCurrent=frag,this.timer=setInterval(this.onCheck,100)),!this._bwEstimator)){var ewmaFast,ewmaSlow,hls=this.hls,config=hls.config,level=frag.level;hls.levels[level].details.live?(ewmaFast=config.abrEwmaFastLive,ewmaSlow=config.abrEwmaSlowLive):(ewmaFast=config.abrEwmaFastVoD,ewmaSlow=config.abrEwmaSlowVoD),this._bwEstimator=new ewma_bandwidth_estimator(hls,ewmaSlow,ewmaFast,config.abrEwmaDefaultEstimate)}},_proto._abandonRulesCheck=function(){var hls=this.hls,video=hls.media,frag=this.fragCurrent;if(frag){var loader=frag.loader;if(!loader||loader.stats&&loader.stats.aborted)return logger.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var stats=loader.stats;if(video&&stats&&(!video.paused&&0!==video.playbackRate||!video.readyState)&&frag.autoLevel&&frag.level){var requestDelay=abr_controller_performance.now()-stats.trequest,playbackRate=Math.abs(video.playbackRate);if(requestDelay>500*frag.duration/playbackRate){var levels=hls.levels,loadRate=Math.max(1,stats.bw?stats.bw/8:1e3*stats.loaded/requestDelay),level=levels[frag.level];if(!level)return;var levelBitrate=level.realBitrate?Math.max(level.realBitrate,level.bitrate):level.bitrate,expectedLen=stats.total?stats.total:Math.max(stats.loaded,Math.round(frag.duration*levelBitrate/8)),pos=video.currentTime,fragLoadedDelay=(expectedLen-stats.loaded)/loadRate,bufferStarvationDelay=(BufferHelper.bufferInfo(video,pos,hls.config.maxBufferHole).end-pos)/playbackRate;if(bufferStarvationDelay<2*frag.duration/playbackRate&&fragLoadedDelay>bufferStarvationDelay){var nextLoadLevel,minAutoLevel=hls.minAutoLevel;for(nextLoadLevel=frag.level-1;nextLoadLevel>minAutoLevel;nextLoadLevel--){var levelNextBitrate=levels[nextLoadLevel].realBitrate?Math.max(levels[nextLoadLevel].realBitrate,levels[nextLoadLevel].bitrate):levels[nextLoadLevel].bitrate;if(frag.duration*levelNextBitrate/(6.4*loadRate)<bufferStarvationDelay)break}void 0<fragLoadedDelay&&(logger.logger.warn("loading too slow, abort fragment loading and switch to level "+nextLoadLevel+":fragLoadedDelay["+nextLoadLevel+"]<fragLoadedDelay["+(frag.level-1)+"];bufferStarvationDelay:"+(void 0).toFixed(1)+"<"+fragLoadedDelay.toFixed(1)+":"+bufferStarvationDelay.toFixed(1)),hls.nextLoadLevel=nextLoadLevel,this._bwEstimator.sample(requestDelay,stats.loaded),loader.abort(),this.clearTimer(),hls.trigger(events.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag,stats}))}}}}},_proto.onFragLoaded=function(data){var frag=data.frag;if("main"===frag.type&&Object(number.isFiniteNumber)(frag.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=frag.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var level=this.hls.levels[frag.level],loadedBytes=(level.loaded?level.loaded.bytes:0)+data.stats.loaded,loadedDuration=(level.loaded?level.loaded.duration:0)+data.frag.duration;level.loaded={bytes:loadedBytes,duration:loadedDuration},level.realBitrate=Math.round(8*loadedBytes/loadedDuration)}if(data.frag.bitrateTest){var stats=data.stats;stats.tparsed=stats.tbuffered=stats.tload,this.onFragBuffered(data)}}},_proto.onFragBuffered=function(data){var stats=data.stats,frag=data.frag;if(!0!==stats.aborted&&"main"===frag.type&&Object(number.isFiniteNumber)(frag.sn)&&(!frag.bitrateTest||stats.tload===stats.tbuffered)){var fragLoadingProcessingMs=stats.tparsed-stats.trequest;logger.logger.log("latency/loading/parsing/append/kbps:"+Math.round(stats.tfirst-stats.trequest)+"/"+Math.round(stats.tload-stats.tfirst)+"/"+Math.round(stats.tparsed-stats.tload)+"/"+Math.round(stats.tbuffered-stats.tparsed)+"/"+Math.round(8*stats.loaded/(stats.tbuffered-stats.trequest))),this._bwEstimator.sample(fragLoadingProcessingMs,stats.loaded),stats.bwEstimate=this._bwEstimator.getEstimate(),frag.bitrateTest?this.bitrateTestDelay=fragLoadingProcessingMs/1e3:this.bitrateTestDelay=0}},_proto.onError=function(data){switch(data.details){case errors.ErrorDetails.FRAG_LOAD_ERROR:case errors.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},_proto.clearTimer=function(){clearInterval(this.timer),this.timer=null},_proto._findBestLevel=function(currentLevel,currentFragDuration,currentBw,minAutoLevel,maxAutoLevel,maxFetchDuration,bwFactor,bwUpFactor,levels){for(var i=maxAutoLevel;i>=minAutoLevel;i--){var levelInfo=levels[i];if(levelInfo){var levelDetails=levelInfo.details,avgDuration=levelDetails?levelDetails.totalduration/levelDetails.fragments.length:currentFragDuration,live=!!levelDetails&&levelDetails.live,adjustedbw=void 0;adjustedbw=i<=currentLevel?bwFactor*currentBw:bwUpFactor*currentBw;var bitrate=levels[i].realBitrate?Math.max(levels[i].realBitrate,levels[i].bitrate):levels[i].bitrate,fetchDuration=bitrate*avgDuration/adjustedbw;if(logger.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+i+"/"+Math.round(adjustedbw)+"/"+bitrate+"/"+avgDuration+"/"+maxFetchDuration+"/"+fetchDuration),adjustedbw>bitrate&&(!fetchDuration||live&&!this.bitrateTestDelay||fetchDuration<maxFetchDuration))return i}}return-1},Constructor=AbrController,(protoProps=[{key:"nextAutoLevel",get:function(){var forcedAutoLevel=this._nextAutoLevel,bwEstimator=this._bwEstimator;if(!(-1===forcedAutoLevel||bwEstimator&&bwEstimator.canEstimate()))return forcedAutoLevel;var nextABRAutoLevel=this._nextABRAutoLevel;return-1!==forcedAutoLevel&&(nextABRAutoLevel=Math.min(forcedAutoLevel,nextABRAutoLevel)),nextABRAutoLevel},set:function(nextLevel){this._nextAutoLevel=nextLevel}},{key:"_nextABRAutoLevel",get:function(){var hls=this.hls,maxAutoLevel=hls.maxAutoLevel,levels=hls.levels,config=hls.config,minAutoLevel=hls.minAutoLevel,video=hls.media,currentLevel=this.lastLoadedFragLevel,currentFragDuration=this.fragCurrent?this.fragCurrent.duration:0,pos=video?video.currentTime:0,playbackRate=video&&0!==video.playbackRate?Math.abs(video.playbackRate):1,avgbw=this._bwEstimator?this._bwEstimator.getEstimate():config.abrEwmaDefaultEstimate,bufferStarvationDelay=(BufferHelper.bufferInfo(video,pos,config.maxBufferHole).end-pos)/playbackRate,bestLevel=this._findBestLevel(currentLevel,currentFragDuration,avgbw,minAutoLevel,maxAutoLevel,bufferStarvationDelay,config.abrBandWidthFactor,config.abrBandWidthUpFactor,levels);if(bestLevel>=0)return bestLevel;logger.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var maxStarvationDelay=currentFragDuration?Math.min(currentFragDuration,config.maxStarvationDelay):config.maxStarvationDelay,bwFactor=config.abrBandWidthFactor,bwUpFactor=config.abrBandWidthUpFactor;if(0===bufferStarvationDelay){var bitrateTestDelay=this.bitrateTestDelay;bitrateTestDelay&&(maxStarvationDelay=(currentFragDuration?Math.min(currentFragDuration,config.maxLoadingDelay):config.maxLoadingDelay)-bitrateTestDelay,logger.logger.trace("bitrate test took "+Math.round(1e3*bitrateTestDelay)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*maxStarvationDelay)+" ms"),bwFactor=bwUpFactor=1)}return bestLevel=this._findBestLevel(currentLevel,currentFragDuration,avgbw,minAutoLevel,maxAutoLevel,bufferStarvationDelay+maxStarvationDelay,bwFactor,bwUpFactor,levels),Math.max(bestLevel,0)}}])&&abr_controller_defineProperties(Constructor.prototype,protoProps),staticProps&&abr_controller_defineProperties(Constructor,staticProps),AbrController})(event_handler),buffer_controller_MediaSource=getMediaSource(),buffer_controller=(function(_EventHandler){var subClass,superClass;function BufferController(hls){var _this;return(_this=_EventHandler.call(this,hls,events.default.MEDIA_ATTACHING,events.default.MEDIA_DETACHING,events.default.MANIFEST_PARSED,events.default.BUFFER_RESET,events.default.BUFFER_APPENDING,events.default.BUFFER_CODECS,events.default.BUFFER_EOS,events.default.BUFFER_FLUSHING,events.default.LEVEL_PTS_UPDATED,events.default.LEVEL_UPDATED)||this)._msDuration=null,_this._levelDuration=null,_this._levelTargetDuration=10,_this._live=null,_this._objectUrl=null,_this._needsFlush=!1,_this._needsEos=!1,_this.config=void 0,_this.audioTimestampOffset=void 0,_this.bufferCodecEventsExpected=0,_this._bufferCodecEventsTotal=0,_this.media=null,_this.mediaSource=null,_this.segments=[],_this.parent=void 0,_this.appending=!1,_this.appended=0,_this.appendError=0,_this.flushBufferCounter=0,_this.tracks={},_this.pendingTracks={},_this.sourceBuffer={},_this.flushRange=[],_this._onMediaSourceOpen=function(){logger.logger.log("media source opened"),_this.hls.trigger(events.default.MEDIA_ATTACHED,{media:_this.media});var mediaSource=_this.mediaSource;mediaSource&&mediaSource.removeEventListener("sourceopen",_this._onMediaSourceOpen),_this.checkPendingTracks()},_this._onMediaSourceClose=function(){logger.logger.log("media source closed")},_this._onMediaSourceEnded=function(){logger.logger.log("media source ended")},_this._onSBUpdateEnd=function(){if(_this.audioTimestampOffset&&_this.sourceBuffer.audio){var audioBuffer=_this.sourceBuffer.audio;logger.logger.warn("change mpeg audio timestamp offset from "+audioBuffer.timestampOffset+" to "+_this.audioTimestampOffset),audioBuffer.timestampOffset=_this.audioTimestampOffset,delete _this.audioTimestampOffset}_this._needsFlush&&_this.doFlush(),_this._needsEos&&_this.checkEos(),_this.appending=!1;var parent=_this.parent,pending=_this.segments.reduce((function(counter,segment){return segment.parent===parent?counter+1:counter}),0),timeRanges={},sbSet=_this.sourceBuffer;for(var streamType in sbSet){var sb=sbSet[streamType];if(!sb)throw Error("handling source buffer update end error: source buffer for "+streamType+" uninitilized and unable to update buffered TimeRanges.");timeRanges[streamType]=sb.buffered}_this.hls.trigger(events.default.BUFFER_APPENDED,{parent,pending,timeRanges}),_this._needsFlush||_this.doAppending(),_this.updateMediaElementDuration(),0===pending&&_this.flushLiveBackBuffer()},_this._onSBUpdateError=function(event){logger.logger.error("sourceBuffer error:",event),_this.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.MEDIA_ERROR,details:errors.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},_this.config=hls.config,_this}superClass=_EventHandler,(subClass=BufferController).prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass;var _proto=BufferController.prototype;return _proto.destroy=function(){event_handler.prototype.destroy.call(this)},_proto.onLevelPtsUpdated=function(data){var type=data.type,audioTrack=this.tracks.audio;if("audio"===type&&audioTrack&&"audio/mpeg"===audioTrack.container){var audioBuffer=this.sourceBuffer.audio;if(!audioBuffer)throw Error("Level PTS Updated and source buffer for audio uninitalized");if(Math.abs(audioBuffer.timestampOffset-data.start)>.1){var updating=audioBuffer.updating;try{audioBuffer.abort()}catch(err){logger.logger.warn("can not abort audio buffer: "+err)}updating?this.audioTimestampOffset=data.start:(logger.logger.warn("change mpeg audio timestamp offset from "+audioBuffer.timestampOffset+" to "+data.start),audioBuffer.timestampOffset=data.start)}}},_proto.onManifestParsed=function(data){var codecEvents=2;(data.audio&&!data.video||!data.altAudio)&&(codecEvents=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=codecEvents,logger.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},_proto.onMediaAttaching=function(data){var media=this.media=data.media;if(media&&buffer_controller_MediaSource){var ms=this.mediaSource=new buffer_controller_MediaSource;ms.addEventListener("sourceopen",this._onMediaSourceOpen),ms.addEventListener("sourceended",this._onMediaSourceEnded),ms.addEventListener("sourceclose",this._onMediaSourceClose),media.src=window.URL.createObjectURL(ms),this._objectUrl=media.src}},_proto.onMediaDetaching=function(){logger.logger.log("media source detaching");var ms=this.mediaSource;if(ms){if("open"===ms.readyState)try{ms.endOfStream()}catch(err){logger.logger.warn("onMediaDetaching:"+err.message+" while calling endOfStream")}ms.removeEventListener("sourceopen",this._onMediaSourceOpen),ms.removeEventListener("sourceended",this._onMediaSourceEnded),ms.removeEventListener("sourceclose",this._onMediaSourceClose),this.media&&(this._objectUrl&&window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):logger.logger.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.hls.trigger(events.default.MEDIA_DETACHED)},_proto.checkPendingTracks=function(){var bufferCodecEventsExpected=this.bufferCodecEventsExpected,pendingTracks=this.pendingTracks,pendingTracksCount=Object.keys(pendingTracks).length;(pendingTracksCount&&!bufferCodecEventsExpected||2===pendingTracksCount)&&(this.createSourceBuffers(pendingTracks),this.pendingTracks={},this.doAppending())},_proto.onBufferReset=function(){var sourceBuffer=this.sourceBuffer;for(var type in sourceBuffer){var sb=sourceBuffer[type];try{sb&&(this.mediaSource&&this.mediaSource.removeSourceBuffer(sb),sb.removeEventListener("updateend",this._onSBUpdateEnd),sb.removeEventListener("error",this._onSBUpdateError))}catch(err){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},_proto.onBufferCodecs=function(tracks){var _this2=this;Object.keys(this.sourceBuffer).length||(Object.keys(tracks).forEach((function(trackName){_this2.pendingTracks[trackName]=tracks[trackName]})),this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},_proto.createSourceBuffers=function(tracks){var sourceBuffer=this.sourceBuffer,mediaSource=this.mediaSource;if(!mediaSource)throw Error("createSourceBuffers called when mediaSource was null");for(var trackName in tracks)if(!sourceBuffer[trackName]){var track=tracks[trackName];if(!track)throw Error("source buffer exists for track "+trackName+", however track does not");var codec=track.levelCodec||track.codec,mimeType=track.container+";codecs="+codec;logger.logger.log("creating sourceBuffer("+mimeType+")");try{var sb=sourceBuffer[trackName]=mediaSource.addSourceBuffer(mimeType);sb.addEventListener("updateend",this._onSBUpdateEnd),sb.addEventListener("error",this._onSBUpdateError),this.tracks[trackName]={buffer:sb,codec,id:track.id,container:track.container,levelCodec:track.levelCodec}}catch(err){logger.logger.error("error while trying to add sourceBuffer:"+err.message),this.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.MEDIA_ERROR,details:errors.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err,mimeType})}}this.hls.trigger(events.default.BUFFER_CREATED,{tracks:this.tracks})},_proto.onBufferAppending=function(data){this._needsFlush||(this.segments?this.segments.push(data):this.segments=[data],this.doAppending())},_proto.onBufferEos=function(data){for(var type in this.sourceBuffer)if(!data.type||data.type===type){var sb=this.sourceBuffer[type];sb&&!sb.ended&&(sb.ended=!0,logger.logger.log(type+" sourceBuffer now EOS"))}this.checkEos()},_proto.checkEos=function(){var sourceBuffer=this.sourceBuffer,mediaSource=this.mediaSource;if(mediaSource&&"open"===mediaSource.readyState){for(var type in sourceBuffer){var sb=sourceBuffer[type];if(sb){if(!sb.ended)return;if(sb.updating)return void(this._needsEos=!0)}}logger.logger.log("all media data are available, signal endOfStream() to MediaSource and stop loading fragment");try{mediaSource.endOfStream()}catch(e){logger.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1},_proto.onBufferFlushing=function(data){data.type?this.flushRange.push({start:data.startOffset,end:data.endOffset,type:data.type}):(this.flushRange.push({start:data.startOffset,end:data.endOffset,type:"video"}),this.flushRange.push({start:data.startOffset,end:data.endOffset,type:"audio"})),this.flushBufferCounter=0,this.doFlush()},_proto.flushLiveBackBuffer=function(){if(this._live){var liveBackBufferLength=this.config.liveBackBufferLength;if(isFinite(liveBackBufferLength)&&!(liveBackBufferLength<0))if(this.media)for(var currentTime=this.media.currentTime,sourceBuffer=this.sourceBuffer,bufferTypes=Object.keys(sourceBuffer),targetBackBufferPosition=currentTime-Math.max(liveBackBufferLength,this._levelTargetDuration),index=bufferTypes.length-1;index>=0;index--){var bufferType=bufferTypes[index],sb=sourceBuffer[bufferType];if(sb){var buffered=sb.buffered;buffered.length>0&&targetBackBufferPosition>buffered.start(0)&&this.removeBufferRange(bufferType,sb,0,targetBackBufferPosition)&&this.hls.trigger(events.default.LIVE_BACK_BUFFER_REACHED,{bufferEnd:targetBackBufferPosition})}}else logger.logger.error("flushLiveBackBuffer called without attaching media")}},_proto.onLevelUpdated=function(_ref){var details=_ref.details;details.fragments.length>0&&(this._levelDuration=details.totalduration+details.fragments[0].start,this._levelTargetDuration=details.averagetargetduration||details.targetduration||10,this._live=details.live,this.updateMediaElementDuration())},_proto.updateMediaElementDuration=function(){var duration,config=this.config;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var type in this.sourceBuffer){var sb=this.sourceBuffer[type];if(sb&&!0===sb.updating)return}duration=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===config.liveDurationInfinity?(logger.logger.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>duration||!Object(number.isFiniteNumber)(duration))&&(logger.logger.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},_proto.doFlush=function(){for(;this.flushRange.length;){var range=this.flushRange[0];if(!this.flushBuffer(range.start,range.end,range.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var appended=0,sourceBuffer=this.sourceBuffer;try{for(var type in sourceBuffer){var sb=sourceBuffer[type];sb&&(appended+=sb.buffered.length)}}catch(error){logger.logger.error("error while accessing sourceBuffer.buffered")}this.appended=appended,this.hls.trigger(events.default.BUFFER_FLUSHED)}},_proto.doAppending=function(){var config=this.config,hls=this.hls,segments=this.segments,sourceBuffer=this.sourceBuffer;if(Object.keys(sourceBuffer).length){if(!this.media||this.media.error)return this.segments=[],void logger.logger.error("trying to append although a media error occured, flush segment and abort");if(!this.appending){var segment=segments.shift();if(segment)try{var sb=sourceBuffer[segment.type];if(!sb)return void this._onSBUpdateEnd();if(sb.updating)return void segments.unshift(segment);sb.ended=!1,this.parent=segment.parent,sb.appendBuffer(segment.data),this.appendError=0,this.appended++,this.appending=!0}catch(err){logger.logger.error("error while trying to append buffer:"+err.message),segments.unshift(segment);var event={type:errors.ErrorTypes.MEDIA_ERROR,parent:segment.parent,details:"",fatal:!1};22===err.code?(this.segments=[],event.details=errors.ErrorDetails.BUFFER_FULL_ERROR):(this.appendError++,event.details=errors.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>config.appendErrorMaxRetry&&(logger.logger.log("fail "+config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),this.segments=[],event.fatal=!0)),hls.trigger(events.default.ERROR,event)}}}},_proto.flushBuffer=function(startOffset,endOffset,sbType){var sourceBuffer=this.sourceBuffer;if(!Object.keys(sourceBuffer).length)return!0;var currentTime="null";if(this.media&&(currentTime=this.media.currentTime.toFixed(3)),logger.logger.log("flushBuffer,pos/start/end: "+currentTime+"/"+startOffset+"/"+endOffset),this.flushBufferCounter>=this.appended)return logger.logger.warn("abort flushing too many retries"),!0;var sb=sourceBuffer[sbType];if(sb){if(sb.ended=!1,sb.updating)return logger.logger.warn("cannot flush, sb updating in progress"),!1;if(this.removeBufferRange(sbType,sb,startOffset,endOffset))return this.flushBufferCounter++,!1}return logger.logger.log("buffer flushed"),!0},_proto.removeBufferRange=function(type,sb,startOffset,endOffset){try{for(var i=0;i<sb.buffered.length;i++){var bufStart=sb.buffered.start(i),bufEnd=sb.buffered.end(i),removeStart=Math.max(bufStart,startOffset),removeEnd=Math.min(bufEnd,endOffset);if(Math.min(removeEnd,bufEnd)-removeStart>.5){var currentTime="null";return this.media&&(currentTime=this.media.currentTime.toString()),logger.logger.log("sb remove "+type+" ["+removeStart+","+removeEnd+"], of ["+bufStart+","+bufEnd+"], pos:"+currentTime),sb.remove(removeStart,removeEnd),!0}}}catch(error){logger.logger.warn("removeBufferRange failed",error)}return!1},BufferController})(event_handler);function cap_level_controller_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var cap_level_controller=(function(_EventHandler){var subClass,superClass;function CapLevelController(hls){var _this;return(_this=_EventHandler.call(this,hls,events.default.FPS_DROP_LEVEL_CAPPING,events.default.MEDIA_ATTACHING,events.default.MANIFEST_PARSED,events.default.LEVELS_UPDATED,events.default.BUFFER_CODECS,events.default.MEDIA_DETACHING)||this).autoLevelCapping=Number.POSITIVE_INFINITY,_this.firstLevel=null,_this.levels=[],_this.media=null,_this.restrictedLevels=[],_this.timer=null,_this.clientRect=null,_this}superClass=_EventHandler,(subClass=CapLevelController).prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass;var Constructor,protoProps,staticProps,_proto=CapLevelController.prototype;return _proto.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this.clientRect=null,this.stopCapping())},_proto.onFpsDropLevelCapping=function(data){CapLevelController.isLevelAllowed(data.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(data.droppedLevel)},_proto.onMediaAttaching=function(data){this.media=data.media instanceof window.HTMLVideoElement?data.media:null},_proto.onManifestParsed=function(data){var hls=this.hls;this.restrictedLevels=[],this.levels=data.levels,this.firstLevel=data.firstLevel,hls.config.capLevelToPlayerSize&&data.video&&this.startCapping()},_proto.onBufferCodecs=function(data){this.hls.config.capLevelToPlayerSize&&data.video&&this.startCapping()},_proto.onLevelsUpdated=function(data){this.levels=data.levels},_proto.onMediaDetaching=function(){this.stopCapping()},_proto.detectPlayerSize=function(){if(this.media){var levelsLength=this.levels?this.levels.length:0;if(levelsLength){var hls=this.hls;hls.autoLevelCapping=this.getMaxLevel(levelsLength-1),hls.autoLevelCapping>this.autoLevelCapping&&hls.streamController.nextLevelSwitch(),this.autoLevelCapping=hls.autoLevelCapping}}},_proto.getMaxLevel=function(capLevelIndex){var _this2=this;if(!this.levels)return-1;var validLevels=this.levels.filter((function(level,index){return CapLevelController.isLevelAllowed(index,_this2.restrictedLevels)&&index<=capLevelIndex}));return this.clientRect=null,CapLevelController.getMaxLevelByMediaSize(validLevels,this.mediaWidth,this.mediaHeight)},_proto.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},_proto.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)},_proto.getDimensions=function(){if(this.clientRect)return this.clientRect;var media=this.media,boundsRect={width:0,height:0};if(media){var clientRect=media.getBoundingClientRect();boundsRect.width=clientRect.width,boundsRect.height=clientRect.height,boundsRect.width||boundsRect.height||(boundsRect.width=clientRect.right-clientRect.left||media.width||0,boundsRect.height=clientRect.bottom-clientRect.top||media.height||0)}return this.clientRect=boundsRect,boundsRect},CapLevelController.isLevelAllowed=function(level,restrictedLevels){return void 0===restrictedLevels&&(restrictedLevels=[]),-1===restrictedLevels.indexOf(level)},CapLevelController.getMaxLevelByMediaSize=function(levels,width,height){if(!levels||levels&&!levels.length)return-1;for(var curLevel,nextLevel,maxLevelIndex=levels.length-1,i=0;i<levels.length;i+=1){var level=levels[i];if((level.width>=width||level.height>=height)&&(curLevel=level,!(nextLevel=levels[i+1])||curLevel.width!==nextLevel.width||curLevel.height!==nextLevel.height)){maxLevelIndex=i;break}}return maxLevelIndex},Constructor=CapLevelController,staticProps=[{key:"contentScaleFactor",get:function(){var pixelRatio=1;try{pixelRatio=window.devicePixelRatio}catch(e){}return pixelRatio}}],(protoProps=[{key:"mediaWidth",get:function(){return this.getDimensions().width*CapLevelController.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*CapLevelController.contentScaleFactor}}])&&cap_level_controller_defineProperties(Constructor.prototype,protoProps),staticProps&&cap_level_controller_defineProperties(Constructor,staticProps),CapLevelController})(event_handler),fps_controller_performance=window.performance,fps_controller=(function(_EventHandler){var subClass,superClass;function FPSController(hls){return _EventHandler.call(this,hls,events.default.MEDIA_ATTACHING)||this}superClass=_EventHandler,(subClass=FPSController).prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass;var _proto=FPSController.prototype;return _proto.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},_proto.onMediaAttaching=function(data){var config=this.hls.config;config.capLevelOnFPSDrop&&("function"==typeof(this.video=data.media instanceof window.HTMLVideoElement?data.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),config.fpsDroppedMonitoringPeriod))},_proto.checkFPS=function(video,decodedFrames,droppedFrames){var currentTime=fps_controller_performance.now();if(decodedFrames){if(this.lastTime){var currentPeriod=currentTime-this.lastTime,currentDropped=droppedFrames-this.lastDroppedFrames,currentDecoded=decodedFrames-this.lastDecodedFrames,droppedFPS=1e3*currentDropped/currentPeriod,hls=this.hls;if(hls.trigger(events.default.FPS_DROP,{currentDropped,currentDecoded,totalDroppedFrames:droppedFrames}),droppedFPS>0&&currentDropped>hls.config.fpsDroppedMonitoringThreshold*currentDecoded){var currentLevel=hls.currentLevel;logger.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+currentLevel),currentLevel>0&&(-1===hls.autoLevelCapping||hls.autoLevelCapping>=currentLevel)&&(currentLevel-=1,hls.trigger(events.default.FPS_DROP_LEVEL_CAPPING,{level:currentLevel,droppedLevel:hls.currentLevel}),hls.autoLevelCapping=currentLevel,hls.streamController.nextLevelSwitch())}}this.lastTime=currentTime,this.lastDroppedFrames=droppedFrames,this.lastDecodedFrames=decodedFrames}},_proto.checkFPSInterval=function(){var video=this.video;if(video)if(this.isVideoPlaybackQualityAvailable){var videoPlaybackQuality=video.getVideoPlaybackQuality();this.checkFPS(video,videoPlaybackQuality.totalVideoFrames,videoPlaybackQuality.droppedVideoFrames)}else this.checkFPS(video,video.webkitDecodedFrameCount,video.webkitDroppedFrameCount)},FPSController})(event_handler),xhr_loader=(function(){function XhrLoader(config){config&&config.xhrSetup&&(this.xhrSetup=config.xhrSetup)}var _proto=XhrLoader.prototype;return _proto.destroy=function(){this.abort(),this.loader=null},_proto.abort=function(){var loader=this.loader;loader&&4!==loader.readyState&&(this.stats.aborted=!0,loader.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},_proto.load=function(context,config,callbacks){this.context=context,this.config=config,this.callbacks=callbacks,this.stats={trequest:window.performance.now(),retry:0},this.retryDelay=config.retryDelay,this.loadInternal()},_proto.loadInternal=function(){var xhr,context=this.context;xhr=this.loader=new window.XMLHttpRequest;var stats=this.stats;stats.tfirst=0,stats.loaded=0;var xhrSetup=this.xhrSetup;try{if(xhrSetup)try{xhrSetup(xhr,context.url)}catch(e){xhr.open("GET",context.url,!0),xhrSetup(xhr,context.url)}xhr.readyState||xhr.open("GET",context.url,!0)}catch(e){return void this.callbacks.onError({code:xhr.status,text:e.message},context,xhr)}context.rangeEnd&&xhr.setRequestHeader("Range","bytes="+context.rangeStart+"-"+(context.rangeEnd-1)),xhr.onreadystatechange=this.readystatechange.bind(this),xhr.onprogress=this.loadprogress.bind(this),xhr.responseType=context.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),xhr.send()},_proto.readystatechange=function(event){var xhr=event.currentTarget,readyState=xhr.readyState,stats=this.stats,context=this.context,config=this.config;if(!stats.aborted&&readyState>=2)if(window.clearTimeout(this.requestTimeout),0===stats.tfirst&&(stats.tfirst=Math.max(window.performance.now(),stats.trequest)),4===readyState){var status=xhr.status;if(status>=200&&status<300){var data,len;stats.tload=Math.max(stats.tfirst,window.performance.now()),len="arraybuffer"===context.responseType?(data=xhr.response).byteLength:(data=xhr.responseText).length,stats.loaded=stats.total=len;var response={url:xhr.responseURL,data};this.callbacks.onSuccess(response,stats,context,xhr)}else stats.retry>=config.maxRetry||status>=400&&status<499?(logger.logger.error(status+" while loading "+context.url),this.callbacks.onError({code:status,text:xhr.statusText},context,xhr)):(logger.logger.warn(status+" while loading "+context.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,config.maxRetryDelay),stats.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),config.timeout)},_proto.loadtimeout=function(){logger.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},_proto.loadprogress=function(event){var xhr=event.currentTarget,stats=this.stats;stats.loaded=event.loaded,event.lengthComputable&&(stats.total=event.total);var onProgress=this.callbacks.onProgress;onProgress&&onProgress(stats,this.context,null,xhr)},XhrLoader})();function audio_track_controller_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var audio_track_controller=(function(_TaskLoop){var subClass,superClass;function AudioTrackController(hls){var _this;return(_this=_TaskLoop.call(this,hls,events.default.MANIFEST_LOADING,events.default.MANIFEST_PARSED,events.default.AUDIO_TRACK_LOADED,events.default.AUDIO_TRACK_SWITCHED,events.default.LEVEL_LOADED,events.default.ERROR)||this)._trackId=-1,_this._selectDefaultTrack=!0,_this.tracks=[],_this.trackIdBlacklist=Object.create(null),_this.audioGroupId=null,_this}superClass=_TaskLoop,(subClass=AudioTrackController).prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass;var Constructor,protoProps,staticProps,_proto=AudioTrackController.prototype;return _proto.onManifestLoading=function(){this.tracks=[],this._trackId=-1,this._selectDefaultTrack=!0},_proto.onManifestParsed=function(data){var tracks=this.tracks=data.audioTracks||[];this.hls.trigger(events.default.AUDIO_TRACKS_UPDATED,{audioTracks:tracks}),this._selectAudioGroup(this.hls.nextLoadLevel)},_proto.onAudioTrackLoaded=function(data){if(data.id>=this.tracks.length)logger.logger.warn("Invalid audio track id:",data.id);else{if(logger.logger.log("audioTrack "+data.id+" loaded"),this.tracks[data.id].details=data.details,data.details.live&&!this.hasInterval()){var updatePeriodMs=1e3*data.details.targetduration;this.setInterval(updatePeriodMs)}!data.details.live&&this.hasInterval()&&this.clearInterval()}},_proto.onAudioTrackSwitched=function(data){var audioGroupId=this.tracks[data.id].groupId;audioGroupId&&this.audioGroupId!==audioGroupId&&(this.audioGroupId=audioGroupId)},_proto.onLevelLoaded=function(data){this._selectAudioGroup(data.level)},_proto.onError=function(data){data.type===errors.ErrorTypes.NETWORK_ERROR&&(data.fatal&&this.clearInterval(),data.details===errors.ErrorDetails.AUDIO_TRACK_LOAD_ERROR&&(logger.logger.warn("Network failure on audio-track id:",data.context.id),this._handleLoadError()))},_proto._setAudioTrack=function(newId){if(this._trackId===newId&&this.tracks[this._trackId].details)logger.logger.debug("Same id as current audio-track passed, and track details available -> no-op");else if(newId<0||newId>=this.tracks.length)logger.logger.warn("Invalid id passed to audio-track controller");else{var audioTrack=this.tracks[newId];logger.logger.log("Now switching to audio-track index "+newId),this.clearInterval(),this._trackId=newId;var url=audioTrack.url,type=audioTrack.type,id=audioTrack.id;this.hls.trigger(events.default.AUDIO_TRACK_SWITCHING,{id,type,url}),this._loadTrackDetailsIfNeeded(audioTrack)}},_proto.doTick=function(){this._updateTrack(this._trackId)},_proto._selectAudioGroup=function(levelId){var levelInfo=this.hls.levels[levelId];if(levelInfo&&levelInfo.audioGroupIds){var audioGroupId=levelInfo.audioGroupIds[levelInfo.urlId];this.audioGroupId!==audioGroupId&&(this.audioGroupId=audioGroupId,this._selectInitialAudioTrack())}},_proto._selectInitialAudioTrack=function(){var _this2=this,tracks=this.tracks;if(tracks.length){var currentAudioTrack=this.tracks[this._trackId],name=null;if(currentAudioTrack&&(name=currentAudioTrack.name),this._selectDefaultTrack){var defaultTracks=tracks.filter((function(track){return track.default}));defaultTracks.length?tracks=defaultTracks:logger.logger.warn("No default audio tracks defined")}var trackFound=!1,traverseTracks=function(){tracks.forEach((function(track){trackFound||_this2.audioGroupId&&track.groupId!==_this2.audioGroupId||name&&name!==track.name||(_this2._setAudioTrack(track.id),trackFound=!0)}))};traverseTracks(),trackFound||(name=null,traverseTracks()),trackFound||(logger.logger.error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.MEDIA_ERROR,details:errors.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))}},_proto._needsTrackLoading=function(audioTrack){var details=audioTrack.details,url=audioTrack.url;return!(details&&!details.live||!url)},_proto._loadTrackDetailsIfNeeded=function(audioTrack){if(this._needsTrackLoading(audioTrack)){var url=audioTrack.url,id=audioTrack.id;logger.logger.log("loading audio-track playlist for id: "+id),this.hls.trigger(events.default.AUDIO_TRACK_LOADING,{url,id})}},_proto._updateTrack=function(newId){if(!(newId<0||newId>=this.tracks.length)){this.clearInterval(),this._trackId=newId,logger.logger.log("trying to update audio-track "+newId);var audioTrack=this.tracks[newId];this._loadTrackDetailsIfNeeded(audioTrack)}},_proto._handleLoadError=function(){this.trackIdBlacklist[this._trackId]=!0;var previousId=this._trackId,_this$tracks$previous=this.tracks[previousId],name=_this$tracks$previous.name,language=_this$tracks$previous.language,groupId=_this$tracks$previous.groupId;logger.logger.warn("Loading failed on audio track id: "+previousId+", group-id: "+groupId+', name/language: "'+name+'" / "'+language+'"');for(var newId=previousId,i=0;i<this.tracks.length;i++)if(!this.trackIdBlacklist[i]&&this.tracks[i].name===name){newId=i;break}newId!==previousId?(logger.logger.log("Attempting audio-track fallback id:",newId,"group-id:",this.tracks[newId].groupId),this._setAudioTrack(newId)):logger.logger.warn('No fallback audio-track found for name/language: "'+name+'" / "'+language+'"')},Constructor=AudioTrackController,(protoProps=[{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this._trackId},set:function(newId){this._setAudioTrack(newId),this._selectDefaultTrack=!1}}])&&audio_track_controller_defineProperties(Constructor.prototype,protoProps),staticProps&&audio_track_controller_defineProperties(Constructor,staticProps),AudioTrackController})(TaskLoop);function audio_stream_controller_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var audio_stream_controller_performance=window.performance,audio_stream_controller=(function(_BaseStreamController){var subClass,superClass;function AudioStreamController(hls,fragmentTracker){var _this;return(_this=_BaseStreamController.call(this,hls,events.default.MEDIA_ATTACHED,events.default.MEDIA_DETACHING,events.default.AUDIO_TRACKS_UPDATED,events.default.AUDIO_TRACK_SWITCHING,events.default.AUDIO_TRACK_LOADED,events.default.KEY_LOADED,events.default.FRAG_LOADED,events.default.FRAG_PARSING_INIT_SEGMENT,events.default.FRAG_PARSING_DATA,events.default.FRAG_PARSED,events.default.ERROR,events.default.BUFFER_RESET,events.default.BUFFER_CREATED,events.default.BUFFER_APPENDED,events.default.BUFFER_FLUSHED,events.default.INIT_PTS_FOUND)||this).fragmentTracker=fragmentTracker,_this.config=hls.config,_this.audioCodecSwap=!1,_this._state=State_STOPPED,_this.initPTS=[],_this.waitingFragment=null,_this.videoTrackCC=null,_this.waitingVideoCC=null,_this}superClass=_BaseStreamController,(subClass=AudioStreamController).prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass;var Constructor,protoProps,staticProps,_proto=AudioStreamController.prototype;return _proto.onInitPtsFound=function(data){var demuxerId=data.id,cc=data.frag.cc,initPTS=data.initPTS;"main"===demuxerId&&(this.initPTS[cc]=initPTS,this.videoTrackCC=cc,logger.logger.log("InitPTS for cc: "+cc+" found from main: "+initPTS),this.state===State_WAITING_INIT_PTS&&this.tick())},_proto.startLoad=function(startPosition){if(this.tracks){var lastCurrentTime=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,lastCurrentTime>0&&-1===startPosition?(logger.logger.log("audio:override startPosition with lastCurrentTime @"+lastCurrentTime.toFixed(3)),this.state=State_IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:startPosition,this.state=State_STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=startPosition,this.state=State_STOPPED},_proto.doTick=function(){var pos,track,trackDetails,hls=this.hls,config=hls.config;switch(this.state){case State_ERROR:case State_PAUSED:case State_BUFFER_FLUSHING:break;case State_STARTING:this.state=State_WAITING_TRACK,this.loadedmetadata=!1;break;case State_IDLE:var tracks=this.tracks;if(!tracks)break;if(!this.media&&(this.startFragRequested||!config.startFragPrefetch))break;if(this.loadedmetadata)pos=this.media.currentTime;else if(void 0===(pos=this.nextLoadPosition))break;var media=this.mediaBuffer?this.mediaBuffer:this.media,videoBuffer=this.videoBuffer?this.videoBuffer:this.media,maxBufferHole=pos<config.maxBufferHole?Math.max(2,config.maxBufferHole):config.maxBufferHole,bufferInfo=BufferHelper.bufferInfo(media,pos,maxBufferHole),mainBufferInfo=BufferHelper.bufferInfo(videoBuffer,pos,maxBufferHole),bufferLen=bufferInfo.len,bufferEnd=bufferInfo.end,fragPrevious=this.fragPrevious,maxConfigBuffer=Math.min(config.maxBufferLength,config.maxMaxBufferLength),maxBufLen=Math.max(maxConfigBuffer,mainBufferInfo.len),audioSwitch=this.audioSwitch,trackId=this.trackId;if((bufferLen<maxBufLen||audioSwitch)&&trackId<tracks.length){if(void 0===(trackDetails=tracks[trackId].details)){this.state=State_WAITING_TRACK;break}if(!audioSwitch&&this._streamEnded(bufferInfo,trackDetails))return this.hls.trigger(events.default.BUFFER_EOS,{type:"audio"}),void(this.state=State_ENDED);var frag,fragments=trackDetails.fragments,fragLen=fragments.length,start=fragments[0].start,end=fragments[fragLen-1].start+fragments[fragLen-1].duration;if(audioSwitch)if(trackDetails.live&&!trackDetails.PTSKnown)logger.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),bufferEnd=0;else if(bufferEnd=pos,trackDetails.PTSKnown&&pos<start){if(!(bufferInfo.end>start||bufferInfo.nextStart))return;logger.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=start+.05}if(trackDetails.initSegment&&!trackDetails.initSegment.data)frag=trackDetails.initSegment;else if(bufferEnd<=start){if(frag=fragments[0],null!==this.videoTrackCC&&frag.cc!==this.videoTrackCC&&(frag=(function(fragments,CC){return binary_search.search(fragments,(function(candidate){return candidate.cc<CC?1:candidate.cc>CC?-1:0}))})(fragments,this.videoTrackCC)),trackDetails.live&&frag.loadIdx&&frag.loadIdx===this.fragLoadIdx){var nextBuffered=bufferInfo.nextStart?bufferInfo.nextStart:start;return logger.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(nextBuffered+.05)),void(this.media.currentTime=nextBuffered+.05)}}else{var foundFrag,maxFragLookUpTolerance=config.maxFragLookUpTolerance,fragNext=fragPrevious?fragments[fragPrevious.sn-fragments[0].sn+1]:void 0;bufferEnd<end?(bufferEnd>end-maxFragLookUpTolerance&&(maxFragLookUpTolerance=0),foundFrag=fragNext&&!fragmentWithinToleranceTest(bufferEnd,maxFragLookUpTolerance,fragNext)?fragNext:binary_search.search(fragments,(function(frag){return fragmentWithinToleranceTest(bufferEnd,maxFragLookUpTolerance,frag)}))):foundFrag=fragments[fragLen-1],foundFrag&&(frag=foundFrag,start=foundFrag.start,fragPrevious&&frag.level===fragPrevious.level&&frag.sn===fragPrevious.sn&&(frag.sn<trackDetails.endSN?(frag=fragments[frag.sn+1-trackDetails.startSN],this.fragmentTracker.getState(frag)!==FragmentState_OK&&logger.logger.log("SN just loaded, load next one: "+frag.sn)):frag=null))}frag&&(frag.encrypted?(logger.logger.log("Loading key for "+frag.sn+" of ["+trackDetails.startSN+" ,"+trackDetails.endSN+"],track "+trackId),this.state=State_KEY_LOADING,hls.trigger(events.default.KEY_LOADING,{frag})):(this.fragCurrent=frag,(audioSwitch||this.fragmentTracker.getState(frag)===FragmentState_NOT_LOADED)&&(logger.logger.log("Loading "+frag.sn+", cc: "+frag.cc+" of ["+trackDetails.startSN+" ,"+trackDetails.endSN+"],track "+trackId+", "+(this.loadedmetadata?"currentTime":"nextLoadPosition")+": "+pos+", bufferEnd: "+bufferEnd.toFixed(3)),"initSegment"!==frag.sn&&(this.startFragRequested=!0),Object(number.isFiniteNumber)(frag.sn)&&(this.nextLoadPosition=frag.start+frag.duration),hls.trigger(events.default.FRAG_LOADING,{frag}),this.state=State_FRAG_LOADING)))}break;case State_WAITING_TRACK:(track=this.tracks[this.trackId])&&track.details&&(this.state=State_IDLE);break;case State_FRAG_LOADING_WAITING_RETRY:var now=audio_stream_controller_performance.now(),retryDate=this.retryDate,isSeeking=(media=this.media)&&media.seeking;(!retryDate||now>=retryDate||isSeeking)&&(logger.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=State_IDLE);break;case State_WAITING_INIT_PTS:var waitingFrag=this.waitingFragment;if(waitingFrag){var waitingFragCC=waitingFrag.frag.cc;if(void 0!==this.initPTS[waitingFragCC])this.waitingFragment=null,this.state=State_FRAG_LOADING,this.onFragLoaded(waitingFrag);else if(this.videoTrackCC!==this.waitingVideoCC)logger.logger.log("Waiting fragment cc ("+waitingFragCC+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var _bufferInfo=BufferHelper.bufferInfo(this.mediaBuffer,this.media.currentTime,config.maxBufferHole);fragmentWithinToleranceTest(_bufferInfo.end,config.maxFragLookUpTolerance,waitingFrag.frag)<0&&(logger.logger.log("Waiting fragment cc ("+waitingFragCC+") @ "+waitingFrag.frag.start+" cancelled because another fragment at "+_bufferInfo.end+" is needed"),this.clearWaitingFragment())}}else this.state=State_IDLE}},_proto.clearWaitingFragment=function(){var waitingFrag=this.waitingFragment;waitingFrag&&(this.fragmentTracker.removeFragment(waitingFrag.frag),this.waitingFragment=null,this.waitingVideoCC=null,this.state=State_IDLE)},_proto.onMediaAttached=function(data){var media=this.media=this.mediaBuffer=data.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),media.addEventListener("seeking",this.onvseeking),media.addEventListener("ended",this.onvended);var config=this.config;this.tracks&&config.autoStartLoad&&this.startLoad(config.startPosition)},_proto.onMediaDetaching=function(){var media=this.media;media&&media.ended&&(logger.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),media&&(media.removeEventListener("seeking",this.onvseeking),media.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},_proto.onAudioTracksUpdated=function(data){logger.logger.log("audio tracks updated"),this.tracks=data.audioTracks},_proto.onAudioTrackSwitching=function(data){var altAudio=!!data.url;this.trackId=data.id,this.fragCurrent=null,this.clearWaitingFragment(),this.state=State_PAUSED,altAudio?this.setInterval(100):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),altAudio&&(this.audioSwitch=!0,this.state=State_IDLE),this.tick()},_proto.onAudioTrackLoaded=function(data){var newDetails=data.details,trackId=data.id,track=this.tracks[trackId],curDetails=track.details,duration=newDetails.totalduration,sliding=0;if(logger.logger.log("track "+trackId+" loaded ["+newDetails.startSN+","+newDetails.endSN+"],duration:"+duration),newDetails.live||curDetails&&curDetails.live?curDetails&&newDetails.fragments.length>0?(mergeDetails(curDetails,newDetails),sliding=newDetails.fragments[0].start,newDetails.PTSKnown?logger.logger.log("live audio playlist sliding:"+sliding.toFixed(3)):logger.logger.log("live audio playlist - outdated PTS, unknown sliding")):(newDetails.PTSKnown=!1,logger.logger.log("live audio playlist - first load, unknown sliding")):newDetails.PTSKnown=!1,track.details=newDetails,!this.startFragRequested){if(-1===this.startPosition){var startTimeOffset=newDetails.startTimeOffset;Object(number.isFiniteNumber)(startTimeOffset)?(logger.logger.log("start time offset found in playlist, adjust startPosition to "+startTimeOffset),this.startPosition=startTimeOffset):newDetails.live?(this.startPosition=this.computeLivePosition(sliding,newDetails),logger.logger.log("compute startPosition for audio-track to "+this.startPosition)):this.startPosition=0}this.nextLoadPosition=this.startPosition}this.state===State_WAITING_TRACK&&(this.state=State_IDLE),this.tick()},_proto.onKeyLoaded=function(){this.state===State_KEY_LOADING&&(this.state=State_IDLE,this.tick())},_proto.onFragLoaded=function(data){var fragCurrent=this.fragCurrent,fragLoaded=data.frag;if(this.state===State_FRAG_LOADING&&fragCurrent&&"audio"===fragLoaded.type&&fragLoaded.level===fragCurrent.level&&fragLoaded.sn===fragCurrent.sn){var track=this.tracks[this.trackId],details=track.details,duration=details.totalduration,trackId=fragCurrent.level,sn=fragCurrent.sn,cc=fragCurrent.cc,audioCodec=this.config.defaultAudioCodec||track.audioCodec||"mp4a.40.2",stats=this.stats=data.stats;if("initSegment"===sn)this.state=State_IDLE,stats.tparsed=stats.tbuffered=audio_stream_controller_performance.now(),details.initSegment.data=data.payload,this.hls.trigger(events.default.FRAG_BUFFERED,{stats,frag:fragCurrent,id:"audio"}),this.tick();else{this.state=State_PARSING,this.appended=!1,this.demuxer||(this.demuxer=new demux_demuxer(this.hls,"audio"));var initPTS=this.initPTS[cc],initSegmentData=details.initSegment?details.initSegment.data:[];void 0!==initPTS?(this.pendingBuffering=!0,logger.logger.log("Demuxing "+sn+" of ["+details.startSN+" ,"+details.endSN+"],track "+trackId),this.demuxer.push(data.payload,initSegmentData,audioCodec,null,fragCurrent,duration,!1,initPTS)):(logger.logger.log("Unknown video PTS for cc "+cc+", waiting for video PTS before demuxing audio frag "+sn+" of ["+details.startSN+" ,"+details.endSN+"],track "+trackId),this.waitingFragment=data,this.waitingVideoCC=this.videoTrackCC,this.state=State_WAITING_INIT_PTS)}}this.fragLoadError=0},_proto.onFragParsingInitSegment=function(data){var fragCurrent=this.fragCurrent,fragNew=data.frag;if(fragCurrent&&"audio"===data.id&&fragNew.sn===fragCurrent.sn&&fragNew.level===fragCurrent.level&&this.state===State_PARSING){var track,tracks=data.tracks;if(tracks.video&&delete tracks.video,track=tracks.audio){track.levelCodec=track.codec,track.id=data.id,this.hls.trigger(events.default.BUFFER_CODECS,tracks),logger.logger.log("audio track:audio,container:"+track.container+",codecs[level/parsed]=["+track.levelCodec+"/"+track.codec+"]");var initSegment=track.initSegment;if(initSegment){var appendObj={type:"audio",data:initSegment,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[appendObj]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(events.default.BUFFER_APPENDING,appendObj))}this.tick()}}},_proto.onFragParsingData=function(data){var _this2=this,fragCurrent=this.fragCurrent,fragNew=data.frag;if(fragCurrent&&"audio"===data.id&&"audio"===data.type&&fragNew.sn===fragCurrent.sn&&fragNew.level===fragCurrent.level&&this.state===State_PARSING){var trackId=this.trackId,track=this.tracks[trackId],hls=this.hls;Object(number.isFiniteNumber)(data.endPTS)||(data.endPTS=data.startPTS+fragCurrent.duration,data.endDTS=data.startDTS+fragCurrent.duration),fragCurrent.addElementaryStream(ElementaryStreamTypes.AUDIO),logger.logger.log("parsed "+data.type+",PTS:["+data.startPTS.toFixed(3)+","+data.endPTS.toFixed(3)+"],DTS:["+data.startDTS.toFixed(3)+"/"+data.endDTS.toFixed(3)+"],nb:"+data.nb),updateFragPTSDTS(track.details,fragCurrent,data.startPTS,data.endPTS);var media=this.media,appendOnBufferFlush=!1;if(this.audioSwitch)if(media&&media.readyState){var currentTime=media.currentTime;logger.logger.log("switching audio track : currentTime:"+currentTime),currentTime>=data.startPTS&&(logger.logger.log("switching audio track : flushing all audio"),this.state=State_BUFFER_FLUSHING,hls.trigger(events.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),appendOnBufferFlush=!0,this.audioSwitch=!1,hls.trigger(events.default.AUDIO_TRACK_SWITCHED,{id:trackId}))}else this.audioSwitch=!1,hls.trigger(events.default.AUDIO_TRACK_SWITCHED,{id:trackId});var pendingData=this.pendingData;if(!pendingData)return logger.logger.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),void hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.MEDIA_ERROR,details:null,fatal:!0});this.audioSwitch||([data.data1,data.data2].forEach((function(buffer){buffer&&buffer.length&&pendingData.push({type:data.type,data:buffer,parent:"audio",content:"data"})})),!appendOnBufferFlush&&pendingData.length&&(pendingData.forEach((function(appendObj){_this2.state===State_PARSING&&(_this2.pendingBuffering=!0,_this2.hls.trigger(events.default.BUFFER_APPENDING,appendObj))})),this.pendingData=[],this.appended=!0)),this.tick()}},_proto.onFragParsed=function(data){var fragCurrent=this.fragCurrent,fragNew=data.frag;fragCurrent&&"audio"===data.id&&fragNew.sn===fragCurrent.sn&&fragNew.level===fragCurrent.level&&this.state===State_PARSING&&(this.stats.tparsed=audio_stream_controller_performance.now(),this.state=State_PARSED,this._checkAppendedParsed())},_proto.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},_proto.onBufferCreated=function(data){var audioTrack=data.tracks.audio;audioTrack&&(this.mediaBuffer=audioTrack.buffer,this.loadedmetadata=!0),data.tracks.video&&(this.videoBuffer=data.tracks.video.buffer)},_proto.onBufferAppended=function(data){if("audio"===data.parent){var state=this.state;state!==State_PARSING&&state!==State_PARSED||(this.pendingBuffering=data.pending>0,this._checkAppendedParsed())}},_proto._checkAppendedParsed=function(){if(!(this.state!==State_PARSED||this.appended&&this.pendingBuffering)){var frag=this.fragCurrent,stats=this.stats,hls=this.hls;if(frag){this.fragPrevious=frag,stats.tbuffered=audio_stream_controller_performance.now(),hls.trigger(events.default.FRAG_BUFFERED,{stats,frag,id:"audio"});var media=this.mediaBuffer?this.mediaBuffer:this.media;media&&logger.logger.log("audio buffered : "+time_ranges.toString(media.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,hls.trigger(events.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=State_IDLE}this.tick()}},_proto.onError=function(data){var frag=data.frag;if(!frag||"audio"===frag.type)switch(data.details){case errors.ErrorDetails.FRAG_LOAD_ERROR:case errors.ErrorDetails.FRAG_LOAD_TIMEOUT:var _frag=data.frag;if(_frag&&"audio"!==_frag.type)break;if(!data.fatal){var loadError=this.fragLoadError;loadError?loadError++:loadError=1;var config=this.config;if(loadError<=config.fragLoadingMaxRetry){this.fragLoadError=loadError;var delay=Math.min(Math.pow(2,loadError-1)*config.fragLoadingRetryDelay,config.fragLoadingMaxRetryTimeout);logger.logger.warn("AudioStreamController: frag loading failed, retry in "+delay+" ms"),this.retryDate=audio_stream_controller_performance.now()+delay,this.state=State_FRAG_LOADING_WAITING_RETRY}else logger.logger.error("AudioStreamController: "+data.details+" reaches max retry, redispatch as fatal ..."),data.fatal=!0,this.state=State_ERROR}break;case errors.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case errors.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case errors.ErrorDetails.KEY_LOAD_ERROR:case errors.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==State_ERROR&&(this.state=data.fatal?State_ERROR:State_IDLE,logger.logger.warn("AudioStreamController: "+data.details+" while loading frag, now switching to "+this.state+" state ..."));break;case errors.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===data.parent&&(this.state===State_PARSING||this.state===State_PARSED)){var media=this.mediaBuffer,currentTime=this.media.currentTime;if(media&&BufferHelper.isBuffered(media,currentTime)&&BufferHelper.isBuffered(media,currentTime+.5)){var _config=this.config;_config.maxMaxBufferLength>=_config.maxBufferLength&&(_config.maxMaxBufferLength/=2,logger.logger.warn("AudioStreamController: reduce max buffer length to "+_config.maxMaxBufferLength+"s")),this.state=State_IDLE}else logger.logger.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=State_BUFFER_FLUSHING,this.hls.trigger(events.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}}},_proto.onBufferFlushed=function(){var _this3=this,pendingData=this.pendingData;pendingData&&pendingData.length?(logger.logger.log("AudioStreamController: appending pending audio data after buffer flushed"),pendingData.forEach((function(appendObj){_this3.hls.trigger(events.default.BUFFER_APPENDING,appendObj)})),this.appended=!0,this.pendingData=[],this.state=State_PARSED):(this.state=State_IDLE,this.fragPrevious=null,this.tick())},Constructor=AudioStreamController,(protoProps=[{key:"state",set:function(nextState){if(this.state!==nextState){var previousState=this.state;this._state=nextState,logger.logger.log("audio stream:"+previousState+"->"+nextState)}},get:function(){return this._state}}])&&audio_stream_controller_defineProperties(Constructor.prototype,protoProps),staticProps&&audio_stream_controller_defineProperties(Constructor,staticProps),AudioStreamController})(base_stream_controller_BaseStreamController),vttcue=(function(){if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var directionSetting={"":!0,lr:!0,rl:!0},alignSetting={start:!0,middle:!0,end:!0,left:!0,right:!0};function findAlignSetting(value){return"string"==typeof value&&!!alignSetting[value.toLowerCase()]&&value.toLowerCase()}function extend(obj){for(var i=1;i<arguments.length;i++){var cobj=arguments[i];for(var p in cobj)obj[p]=cobj[p]}return obj}function VTTCue(startTime,endTime,text){var cue=this,baseObj={enumerable:!0};cue.hasBeenReset=!1;var _id="",_pauseOnExit=!1,_startTime=startTime,_endTime=endTime,_text=text,_region=null,_vertical="",_snapToLines=!0,_line="auto",_lineAlign="start",_position=50,_positionAlign="middle",_size=50,_align="middle";Object.defineProperty(cue,"id",extend({},baseObj,{get:function(){return _id},set:function(value){_id=""+value}})),Object.defineProperty(cue,"pauseOnExit",extend({},baseObj,{get:function(){return _pauseOnExit},set:function(value){_pauseOnExit=!!value}})),Object.defineProperty(cue,"startTime",extend({},baseObj,{get:function(){return _startTime},set:function(value){if("number"!=typeof value)throw new TypeError("Start time must be set to a number.");_startTime=value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"endTime",extend({},baseObj,{get:function(){return _endTime},set:function(value){if("number"!=typeof value)throw new TypeError("End time must be set to a number.");_endTime=value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"text",extend({},baseObj,{get:function(){return _text},set:function(value){_text=""+value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"region",extend({},baseObj,{get:function(){return _region},set:function(value){_region=value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"vertical",extend({},baseObj,{get:function(){return _vertical},set:function(value){var setting=(function(value){return"string"==typeof value&&!!directionSetting[value.toLowerCase()]&&value.toLowerCase()})(value);if(!1===setting)throw new SyntaxError("An invalid or illegal string was specified.");_vertical=setting,this.hasBeenReset=!0}})),Object.defineProperty(cue,"snapToLines",extend({},baseObj,{get:function(){return _snapToLines},set:function(value){_snapToLines=!!value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"line",extend({},baseObj,{get:function(){return _line},set:function(value){if("number"!=typeof value&&"auto"!==value)throw new SyntaxError("An invalid number or illegal string was specified.");_line=value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"lineAlign",extend({},baseObj,{get:function(){return _lineAlign},set:function(value){var setting=findAlignSetting(value);if(!setting)throw new SyntaxError("An invalid or illegal string was specified.");_lineAlign=setting,this.hasBeenReset=!0}})),Object.defineProperty(cue,"position",extend({},baseObj,{get:function(){return _position},set:function(value){if(value<0||value>100)throw new Error("Position must be between 0 and 100.");_position=value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"positionAlign",extend({},baseObj,{get:function(){return _positionAlign},set:function(value){var setting=findAlignSetting(value);if(!setting)throw new SyntaxError("An invalid or illegal string was specified.");_positionAlign=setting,this.hasBeenReset=!0}})),Object.defineProperty(cue,"size",extend({},baseObj,{get:function(){return _size},set:function(value){if(value<0||value>100)throw new Error("Size must be between 0 and 100.");_size=value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"align",extend({},baseObj,{get:function(){return _align},set:function(value){var setting=findAlignSetting(value);if(!setting)throw new SyntaxError("An invalid or illegal string was specified.");_align=setting,this.hasBeenReset=!0}})),cue.displayState=void 0}return VTTCue.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},VTTCue})(),StringDecoder=function(){return{decode:function(data){if(!data)return"";if("string"!=typeof data)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(data))}}};function VTTParser(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new StringDecoder,this.regionList=[]}function Settings(){this.values=Object.create(null)}function parseOptions(input,callback,keyValueDelim,groupDelim){var groups=groupDelim?input.split(groupDelim):[input];for(var i in groups)if("string"==typeof groups[i]){var kv=groups[i].split(keyValueDelim);2===kv.length&&callback(kv[0],kv[1])}}Settings.prototype={set:function(k,v){this.get(k)||""===v||(this.values[k]=v)},get:function(k,dflt,defaultKey){return defaultKey?this.has(k)?this.values[k]:dflt[defaultKey]:this.has(k)?this.values[k]:dflt},has:function(k){return k in this.values},alt:function(k,v,a){for(var n=0;n<a.length;++n)if(v===a[n]){this.set(k,v);break}},integer:function(k,v){/^-?\d+$/.test(v)&&this.set(k,parseInt(v,10))},percent:function(k,v){return!!(v.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(v=parseFloat(v))>=0&&v<=100)&&(this.set(k,v),!0)}};var defaults=new vttcue(0,0,0),center="middle"===defaults.align?"middle":"center";function parseCue(input,cue,regionList){var oInput=input;function consumeTimeStamp(){var ts=(function(input){function computeSeconds(h,m,s,f){return 3600*(0|h)+60*(0|m)+(0|s)+(0|f)/1e3}var m=input.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return m?m[3]?computeSeconds(m[1],m[2],m[3].replace(":",""),m[4]):m[1]>59?computeSeconds(m[1],m[2],0,m[4]):computeSeconds(0,m[1],m[2],m[4]):null})(input);if(null===ts)throw new Error("Malformed timestamp: "+oInput);return input=input.replace(/^[^\sa-zA-Z-]+/,""),ts}function skipWhitespace(){input=input.replace(/^\s+/,"")}if(skipWhitespace(),cue.startTime=consumeTimeStamp(),skipWhitespace(),"--\x3e"!==input.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+oInput);input=input.substr(3),skipWhitespace(),cue.endTime=consumeTimeStamp(),skipWhitespace(),(function(input,cue){var settings=new Settings;parseOptions(input,(function(k,v){switch(k){case"region":for(var i=regionList.length-1;i>=0;i--)if(regionList[i].id===v){settings.set(k,regionList[i].region);break}break;case"vertical":settings.alt(k,v,["rl","lr"]);break;case"line":var vals=v.split(","),vals0=vals[0];settings.integer(k,vals0),settings.percent(k,vals0)&&settings.set("snapToLines",!1),settings.alt(k,vals0,["auto"]),2===vals.length&&settings.alt("lineAlign",vals[1],["start",center,"end"]);break;case"position":vals=v.split(","),settings.percent(k,vals[0]),2===vals.length&&settings.alt("positionAlign",vals[1],["start",center,"end","line-left","line-right","auto"]);break;case"size":settings.percent(k,v);break;case"align":settings.alt(k,v,["start",center,"end","left","right"])}}),/:/,/\s/),cue.region=settings.get("region",null),cue.vertical=settings.get("vertical","");var line=settings.get("line","auto");"auto"===line&&-1===defaults.line&&(line=-1),cue.line=line,cue.lineAlign=settings.get("lineAlign","start"),cue.snapToLines=settings.get("snapToLines",!0),cue.size=settings.get("size",100),cue.align=settings.get("align",center);var position=settings.get("position","auto");"auto"===position&&50===defaults.position&&(position="start"===cue.align||"left"===cue.align?0:"end"===cue.align||"right"===cue.align?100:50),cue.position=position})(input,cue)}function fixLineBreaks(input){return input.replace(/<br(?: \/)?>/gi,"\n")}VTTParser.prototype={parse:function(data){var self=this;function collectNextLine(){var buffer=self.buffer,pos=0;for(buffer=fixLineBreaks(buffer);pos<buffer.length&&"\r"!==buffer[pos]&&"\n"!==buffer[pos];)++pos;var line=buffer.substr(0,pos);return"\r"===buffer[pos]&&++pos,"\n"===buffer[pos]&&++pos,self.buffer=buffer.substr(pos),line}data&&(self.buffer+=self.decoder.decode(data,{stream:!0}));try{var line;if("INITIAL"===self.state){if(!/\r\n|\n/.test(self.buffer))return this;var m=(line=collectNextLine()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!m||!m[0])throw new Error("Malformed WebVTT signature.");self.state="HEADER"}for(var alreadyCollectedLine=!1;self.buffer;){if(!/\r\n|\n/.test(self.buffer))return this;switch(alreadyCollectedLine?alreadyCollectedLine=!1:line=collectNextLine(),self.state){case"HEADER":/:/.test(line)?parseOptions(line,(function(k,v){}),/:/):line||(self.state="ID");continue;case"NOTE":line||(self.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(line)){self.state="NOTE";break}if(!line)continue;if(self.cue=new vttcue(0,0,""),self.state="CUE",-1===line.indexOf("--\x3e")){self.cue.id=line;continue}case"CUE":try{parseCue(line,self.cue,self.regionList)}catch(e){self.cue=null,self.state="BADCUE";continue}self.state="CUETEXT";continue;case"CUETEXT":var hasSubstring=-1!==line.indexOf("--\x3e");if(!line||hasSubstring&&(alreadyCollectedLine=!0)){self.oncue&&self.oncue(self.cue),self.cue=null,self.state="ID";continue}self.cue.text&&(self.cue.text+="\n"),self.cue.text+=line;continue;case"BADCUE":line||(self.state="ID");continue}}}catch(e){"CUETEXT"===self.state&&self.cue&&self.oncue&&self.oncue(self.cue),self.cue=null,self.state="INITIAL"===self.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){try{if(this.buffer+=this.decoder.decode(),(this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state)throw new Error("Malformed WebVTT signature.")}catch(e){throw e}return this.onflush&&this.onflush(),this}};var vttparser=VTTParser;function newCue(track,startTime,endTime,captionScreen){for(var row,cue,indenting,indent,text,result=[],VTTCue=window.VTTCue||TextTrackCue,r=0;r<captionScreen.rows.length;r++)if(indenting=!0,indent=0,text="",!(row=captionScreen.rows[r]).isEmpty()){for(var c=0;c<row.chars.length;c++)row.chars[c].uchar.match(/\s/)&&indenting?indent++:(text+=row.chars[c].uchar,indenting=!1);row.cueStartTime=startTime,startTime===endTime&&(endTime+=1e-4),cue=new VTTCue(startTime,endTime,fixLineBreaks(text.trim())),indent>=16?indent--:indent++,navigator.userAgent.match(/Firefox\//)?cue.line=r+1:cue.line=r>7?r-2:r+1,cue.align="left",cue.position=Math.max(0,Math.min(100,indent/32*100)),result.push(cue),track&&track.addCue(cue)}return result}var VerboseLevel,specialCea608CharsCodes={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},getCharForByte=function(_byte){var charCode=_byte;return specialCea608CharsCodes.hasOwnProperty(_byte)&&(charCode=specialCea608CharsCodes[_byte]),String.fromCharCode(charCode)},rowsLowCh1={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},rowsHighCh1={17:2,18:4,21:6,22:8,23:10,19:13,20:15},rowsLowCh2={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},rowsHighCh2={25:2,26:4,29:6,30:8,31:10,27:13,28:15},backgroundColors=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];!(function(VerboseLevel){VerboseLevel[VerboseLevel.ERROR=0]="ERROR",VerboseLevel[VerboseLevel.TEXT=1]="TEXT",VerboseLevel[VerboseLevel.WARNING=2]="WARNING",VerboseLevel[VerboseLevel.INFO=2]="INFO",VerboseLevel[VerboseLevel.DEBUG=3]="DEBUG",VerboseLevel[VerboseLevel.DATA=3]="DATA"})(VerboseLevel||(VerboseLevel={}));var cea_608_parser_CaptionsLogger=(function(){function CaptionsLogger(){this.time=null,this.verboseLevel=VerboseLevel.ERROR}return CaptionsLogger.prototype.log=function(severity,msg){this.verboseLevel>=severity&&logger.logger.log(this.time+" ["+severity+"] "+msg)},CaptionsLogger})(),numArrayToHexArray=function(numArray){for(var hexArray=[],j=0;j<numArray.length;j++)hexArray.push(numArray[j].toString(16));return hexArray},PenState=(function(){function PenState(foreground,underline,italics,background,flash){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=foreground||"white",this.underline=underline||!1,this.italics=italics||!1,this.background=background||"black",this.flash=flash||!1}var _proto2=PenState.prototype;return _proto2.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},_proto2.setStyles=function(styles){for(var attribs=["foreground","underline","italics","background","flash"],i=0;i<attribs.length;i++){var style=attribs[i];styles.hasOwnProperty(style)&&(this[style]=styles[style])}},_proto2.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},_proto2.equals=function(other){return this.foreground===other.foreground&&this.underline===other.underline&&this.italics===other.italics&&this.background===other.background&&this.flash===other.flash},_proto2.copy=function(newPenState){this.foreground=newPenState.foreground,this.underline=newPenState.underline,this.italics=newPenState.italics,this.background=newPenState.background,this.flash=newPenState.flash},_proto2.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},PenState})(),StyledUnicodeChar=(function(){function StyledUnicodeChar(uchar,foreground,underline,italics,background,flash){this.uchar=void 0,this.penState=void 0,this.uchar=uchar||" ",this.penState=new PenState(foreground,underline,italics,background,flash)}var _proto3=StyledUnicodeChar.prototype;return _proto3.reset=function(){this.uchar=" ",this.penState.reset()},_proto3.setChar=function(uchar,newPenState){this.uchar=uchar,this.penState.copy(newPenState)},_proto3.setPenState=function(newPenState){this.penState.copy(newPenState)},_proto3.equals=function(other){return this.uchar===other.uchar&&this.penState.equals(other.penState)},_proto3.copy=function(newChar){this.uchar=newChar.uchar,this.penState.copy(newChar.penState)},_proto3.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},StyledUnicodeChar})(),Row=(function(){function Row(logger){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var i=0;i<100;i++)this.chars.push(new StyledUnicodeChar);this.logger=logger,this.pos=0,this.currPenState=new PenState}var _proto4=Row.prototype;return _proto4.equals=function(other){for(var equal=!0,i=0;i<100;i++)if(!this.chars[i].equals(other.chars[i])){equal=!1;break}return equal},_proto4.copy=function(other){for(var i=0;i<100;i++)this.chars[i].copy(other.chars[i])},_proto4.isEmpty=function(){for(var empty=!0,i=0;i<100;i++)if(!this.chars[i].isEmpty()){empty=!1;break}return empty},_proto4.setCursor=function(absPos){this.pos!==absPos&&(this.pos=absPos),this.pos<0?(this.logger.log(VerboseLevel.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>100&&(this.logger.log(VerboseLevel.DEBUG,"Too large cursor position "+this.pos),this.pos=100)},_proto4.moveCursor=function(relPos){var newPos=this.pos+relPos;if(relPos>1)for(var i=this.pos+1;i<newPos+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(newPos)},_proto4.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},_proto4.insertChar=function(_byte2){_byte2>=144&&this.backSpace();var _char=getCharForByte(_byte2);this.pos>=100?this.logger.log(VerboseLevel.ERROR,"Cannot insert "+_byte2.toString(16)+" ("+_char+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(_char,this.currPenState),this.moveCursor(1))},_proto4.clearFromPos=function(startPos){var i;for(i=startPos;i<100;i++)this.chars[i].reset()},_proto4.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},_proto4.clearToEndOfRow=function(){this.clearFromPos(this.pos)},_proto4.getTextString=function(){for(var chars=[],empty=!0,i=0;i<100;i++){var _char2=this.chars[i].uchar;" "!==_char2&&(empty=!1),chars.push(_char2)}return empty?"":chars.join("")},_proto4.setPenStyles=function(styles){this.currPenState.setStyles(styles),this.chars[this.pos].setPenState(this.currPenState)},Row})(),CaptionScreen=(function(){function CaptionScreen(logger){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var i=0;i<15;i++)this.rows.push(new Row(logger));this.logger=logger,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var _proto5=CaptionScreen.prototype;return _proto5.reset=function(){for(var i=0;i<15;i++)this.rows[i].clear();this.currRow=14},_proto5.equals=function(other){for(var equal=!0,i=0;i<15;i++)if(!this.rows[i].equals(other.rows[i])){equal=!1;break}return equal},_proto5.copy=function(other){for(var i=0;i<15;i++)this.rows[i].copy(other.rows[i])},_proto5.isEmpty=function(){for(var empty=!0,i=0;i<15;i++)if(!this.rows[i].isEmpty()){empty=!1;break}return empty},_proto5.backSpace=function(){this.rows[this.currRow].backSpace()},_proto5.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},_proto5.insertChar=function(_char3){this.rows[this.currRow].insertChar(_char3)},_proto5.setPen=function(styles){this.rows[this.currRow].setPenStyles(styles)},_proto5.moveCursor=function(relPos){this.rows[this.currRow].moveCursor(relPos)},_proto5.setCursor=function(absPos){this.logger.log(VerboseLevel.INFO,"setCursor: "+absPos),this.rows[this.currRow].setCursor(absPos)},_proto5.setPAC=function(pacData){this.logger.log(VerboseLevel.INFO,"pacData = "+JSON.stringify(pacData));var newRow=pacData.row-1;if(this.nrRollUpRows&&newRow<this.nrRollUpRows-1&&(newRow=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==newRow){for(var i=0;i<15;i++)this.rows[i].clear();var topRowIndex=this.currRow+1-this.nrRollUpRows,lastOutputScreen=this.lastOutputScreen;if(lastOutputScreen){var prevLineTime=lastOutputScreen.rows[topRowIndex].cueStartTime,time=this.logger.time;if(prevLineTime&&null!==time&&prevLineTime<time)for(var _i=0;_i<this.nrRollUpRows;_i++)this.rows[newRow-this.nrRollUpRows+_i+1].copy(lastOutputScreen.rows[topRowIndex+_i])}}this.currRow=newRow;var row=this.rows[this.currRow];if(null!==pacData.indent){var indent=pacData.indent,prevPos=Math.max(indent-1,0);row.setCursor(pacData.indent),pacData.color=row.chars[prevPos].penState.foreground}var styles={foreground:pacData.color,underline:pacData.underline,italics:pacData.italics,background:"black",flash:!1};this.setPen(styles)},_proto5.setBkgData=function(bkgData){this.logger.log(VerboseLevel.INFO,"bkgData = "+JSON.stringify(bkgData)),this.backSpace(),this.setPen(bkgData),this.insertChar(32)},_proto5.setRollUpRows=function(nrRows){this.nrRollUpRows=nrRows},_proto5.rollUp=function(){if(null!==this.nrRollUpRows){this.logger.log(VerboseLevel.TEXT,this.getDisplayText());var topRowIndex=this.currRow+1-this.nrRollUpRows,topRow=this.rows.splice(topRowIndex,1)[0];topRow.clear(),this.rows.splice(this.currRow,0,topRow),this.logger.log(VerboseLevel.INFO,"Rolling up")}else this.logger.log(VerboseLevel.DEBUG,"roll_up but nrRollUpRows not set yet")},_proto5.getDisplayText=function(asOneRow){asOneRow=asOneRow||!1;for(var displayText=[],text="",rowNr=-1,i=0;i<15;i++){var rowText=this.rows[i].getTextString();rowText&&(rowNr=i+1,asOneRow?displayText.push("Row "+rowNr+": '"+rowText+"'"):displayText.push(rowText.trim()))}return displayText.length>0&&(text=asOneRow?"["+displayText.join(" | ")+"]":displayText.join("\n")),text},_proto5.getTextAndFormat=function(){return this.rows},CaptionScreen})(),Cea608Channel=(function(){function Cea608Channel(channelNumber,outputFilter,logger){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=channelNumber,this.outputFilter=outputFilter,this.mode=null,this.verbose=0,this.displayedMemory=new CaptionScreen(logger),this.nonDisplayedMemory=new CaptionScreen(logger),this.lastOutputScreen=new CaptionScreen(logger),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=logger}var _proto6=Cea608Channel.prototype;return _proto6.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},_proto6.getHandler=function(){return this.outputFilter},_proto6.setHandler=function(newHandler){this.outputFilter=newHandler},_proto6.setPAC=function(pacData){this.writeScreen.setPAC(pacData)},_proto6.setBkgData=function(bkgData){this.writeScreen.setBkgData(bkgData)},_proto6.setMode=function(newMode){newMode!==this.mode&&(this.mode=newMode,this.logger.log(VerboseLevel.INFO,"MODE="+newMode),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=newMode)},_proto6.insertChars=function(chars){for(var i=0;i<chars.length;i++)this.writeScreen.insertChar(chars[i]);var screen=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(VerboseLevel.INFO,screen+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(VerboseLevel.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},_proto6.ccRCL=function(){this.logger.log(VerboseLevel.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},_proto6.ccBS=function(){this.logger.log(VerboseLevel.INFO,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},_proto6.ccAOF=function(){},_proto6.ccAON=function(){},_proto6.ccDER=function(){this.logger.log(VerboseLevel.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},_proto6.ccRU=function(nrRows){this.logger.log(VerboseLevel.INFO,"RU("+nrRows+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(nrRows)},_proto6.ccFON=function(){this.logger.log(VerboseLevel.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},_proto6.ccRDC=function(){this.logger.log(VerboseLevel.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},_proto6.ccTR=function(){this.logger.log(VerboseLevel.INFO,"TR"),this.setMode("MODE_TEXT")},_proto6.ccRTD=function(){this.logger.log(VerboseLevel.INFO,"RTD"),this.setMode("MODE_TEXT")},_proto6.ccEDM=function(){this.logger.log(VerboseLevel.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},_proto6.ccCR=function(){this.logger.log(VerboseLevel.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},_proto6.ccENM=function(){this.logger.log(VerboseLevel.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},_proto6.ccEOC=function(){if(this.logger.log(VerboseLevel.INFO,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var tmp=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=tmp,this.writeScreen=this.nonDisplayedMemory,this.logger.log(VerboseLevel.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},_proto6.ccTO=function(nrCols){this.logger.log(VerboseLevel.INFO,"TO("+nrCols+") - Tab Offset"),this.writeScreen.moveCursor(nrCols)},_proto6.ccMIDROW=function(secondByte){var styles={flash:!1};if(styles.underline=secondByte%2==1,styles.italics=secondByte>=46,styles.italics)styles.foreground="white";else{var colorIndex=Math.floor(secondByte/2)-16;styles.foreground=["white","green","blue","cyan","red","yellow","magenta"][colorIndex]}this.logger.log(VerboseLevel.INFO,"MIDROW: "+JSON.stringify(styles)),this.writeScreen.setPen(styles)},_proto6.outputDataUpdate=function(dispatch){void 0===dispatch&&(dispatch=!1);var time=this.logger.time;null!==time&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,time,this.lastOutputScreen),dispatch&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:time):this.cueStartTime=time,this.lastOutputScreen.copy(this.displayedMemory))},_proto6.cueSplitAtTime=function(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))},Cea608Channel})();function setLastCmd(a,b,cmdHistory){cmdHistory.a=a,cmdHistory.b=b}function hasCmdRepeated(a,b,cmdHistory){return cmdHistory.a===a&&cmdHistory.b===b}var cea_608_parser=(function(){function Cea608Parser(field,out1,out2){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var logger=new cea_608_parser_CaptionsLogger;this.channels=[null,new Cea608Channel(field,out1,logger),new Cea608Channel(field+1,out2,logger)],this.cmdHistory={a:null,b:null},this.logger=logger}var _proto7=Cea608Parser.prototype;return _proto7.getHandler=function(channel){return this.channels[channel].getHandler()},_proto7.setHandler=function(channel,newHandler){this.channels[channel].setHandler(newHandler)},_proto7.addData=function(time,byteList){var cmdFound,a,b,charsFound=!1;this.logger.time=time;for(var i=0;i<byteList.length;i+=2)if(a=127&byteList[i],b=127&byteList[i+1],0!==a||0!==b){if(this.logger.log(VerboseLevel.DATA,"["+numArrayToHexArray([byteList[i],byteList[i+1]])+"] -> ("+numArrayToHexArray([a,b])+")"),(cmdFound=this.parseCmd(a,b))||(cmdFound=this.parseMidrow(a,b)),cmdFound||(cmdFound=this.parsePAC(a,b)),cmdFound||(cmdFound=this.parseBackgroundAttributes(a,b)),!cmdFound&&(charsFound=this.parseChars(a,b))){var currChNr=this.currentChannel;currChNr&&currChNr>0?this.channels[currChNr].insertChars(charsFound):this.logger.log(VerboseLevel.WARNING,"No channel found yet. TEXT-MODE?")}cmdFound||charsFound||this.logger.log(VerboseLevel.WARNING,"Couldn't parse cleaned data "+numArrayToHexArray([a,b])+" orig: "+numArrayToHexArray([byteList[i],byteList[i+1]]))}},_proto7.parseCmd=function(a,b){var cmdHistory=this.cmdHistory;if(!((20===a||28===a||21===a||29===a)&&b>=32&&b<=47||(23===a||31===a)&&b>=33&&b<=35))return!1;if(hasCmdRepeated(a,b,cmdHistory))return setLastCmd(null,null,cmdHistory),this.logger.log(VerboseLevel.DEBUG,"Repeated command ("+numArrayToHexArray([a,b])+") is dropped"),!0;var chNr=20===a||21===a||23===a?1:2,channel=this.channels[chNr];return 20===a||21===a||28===a||29===a?32===b?channel.ccRCL():33===b?channel.ccBS():34===b?channel.ccAOF():35===b?channel.ccAON():36===b?channel.ccDER():37===b?channel.ccRU(2):38===b?channel.ccRU(3):39===b?channel.ccRU(4):40===b?channel.ccFON():41===b?channel.ccRDC():42===b?channel.ccTR():43===b?channel.ccRTD():44===b?channel.ccEDM():45===b?channel.ccCR():46===b?channel.ccENM():47===b&&channel.ccEOC():channel.ccTO(b-32),setLastCmd(a,b,cmdHistory),this.currentChannel=chNr,!0},_proto7.parseMidrow=function(a,b){var chNr=0;if((17===a||25===a)&&b>=32&&b<=47){if((chNr=17===a?1:2)!==this.currentChannel)return this.logger.log(VerboseLevel.ERROR,"Mismatch channel in midrow parsing"),!1;var channel=this.channels[chNr];return!!channel&&(channel.ccMIDROW(b),this.logger.log(VerboseLevel.DEBUG,"MIDROW ("+numArrayToHexArray([a,b])+")"),!0)}return!1},_proto7.parsePAC=function(a,b){var row,cmdHistory=this.cmdHistory;if(!((a>=17&&a<=23||a>=25&&a<=31)&&b>=64&&b<=127||(16===a||24===a)&&b>=64&&b<=95))return!1;if(hasCmdRepeated(a,b,cmdHistory))return setLastCmd(null,null,cmdHistory),!0;var chNr=a<=23?1:2;row=b>=64&&b<=95?1===chNr?rowsLowCh1[a]:rowsLowCh2[a]:1===chNr?rowsHighCh1[a]:rowsHighCh2[a];var channel=this.channels[chNr];return!!channel&&(channel.setPAC(this.interpretPAC(row,b)),setLastCmd(a,b,cmdHistory),this.currentChannel=chNr,!0)},_proto7.interpretPAC=function(row,_byte3){var pacIndex=_byte3,pacData={color:null,italics:!1,indent:null,underline:!1,row};return pacIndex=_byte3>95?_byte3-96:_byte3-64,pacData.underline=1==(1&pacIndex),pacIndex<=13?pacData.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(pacIndex/2)]:pacIndex<=15?(pacData.italics=!0,pacData.color="white"):pacData.indent=4*Math.floor((pacIndex-16)/2),pacData},_proto7.parseChars=function(a,b){var channelNr,charCodes=null,charCode1=null;if(a>=25?(channelNr=2,charCode1=a-8):(channelNr=1,charCode1=a),charCode1>=17&&charCode1<=19){var oneCode=b;oneCode=17===charCode1?b+80:18===charCode1?b+112:b+144,this.logger.log(VerboseLevel.INFO,"Special char '"+getCharForByte(oneCode)+"' in channel "+channelNr),charCodes=[oneCode]}else a>=32&&a<=127&&(charCodes=0===b?[a]:[a,b]);if(charCodes){var hexCodes=numArrayToHexArray(charCodes);this.logger.log(VerboseLevel.DEBUG,"Char codes =  "+hexCodes.join(",")),setLastCmd(a,b,this.cmdHistory)}return charCodes},_proto7.parseBackgroundAttributes=function(a,b){var index;if(!((16===a||24===a)&&b>=32&&b<=47||(23===a||31===a)&&b>=45&&b<=47))return!1;var bkgData={};16===a||24===a?(index=Math.floor((b-32)/2),bkgData.background=backgroundColors[index],b%2==1&&(bkgData.background=bkgData.background+"_semi")):45===b?bkgData.background="transparent":(bkgData.foreground="black",47===b&&(bkgData.underline=!0));var chNr=a<=23?1:2;return this.channels[chNr].setBkgData(bkgData),setLastCmd(a,b,this.cmdHistory),!0},_proto7.reset=function(){for(var i=0;i<Object.keys(this.channels).length;i++){var channel=this.channels[i];channel&&channel.reset()}this.cmdHistory={a:null,b:null}},_proto7.cueSplitAtTime=function(t){for(var i=0;i<this.channels.length;i++){var channel=this.channels[i];channel&&channel.cueSplitAtTime(t)}},Cea608Parser})(),OutputFilter=(function(){function OutputFilter(timelineController,trackName){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=timelineController,this.trackName=trackName}var _proto=OutputFilter.prototype;return _proto.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},_proto.newCue=function(startTime,endTime,screen){(null===this.startTime||this.startTime>startTime)&&(this.startTime=startTime),this.endTime=endTime,this.screen=screen,this.timelineController.createCaptionsTrack(this.trackName)},_proto.reset=function(){this.cueRanges=[]},OutputFilter})(),startsWith=function(inputString,searchString,position){return inputString.substr(position||0,searchString.length)===searchString},hash=function(text){for(var hash=5381,i=text.length;i;)hash=33*hash^text.charCodeAt(--i);return(hash>>>0).toString()},webvtt_parser={parse:function(vttByteArray,syncPTS,vttCCs,cc,callBack,errorCallBack){var parsingError,vttLines=Object(id3.utf8ArrayToStr)(new Uint8Array(vttByteArray)).trim().replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n"),cueTime="00:00.000",mpegTs=0,localTime=0,presentationTime=0,cues=[],inHeader=!0,timestampMap=!1,parser=new vttparser;parser.oncue=function(cue){var currCC=vttCCs[cc],cueOffset=vttCCs.ccOffset;currCC&&currCC.new&&(void 0!==localTime?cueOffset=vttCCs.ccOffset=currCC.start:(function(vttCCs,cc,presentationTime){var currCC=vttCCs[cc],prevCC=vttCCs[currCC.prevCC];if(!prevCC||!prevCC.new&&currCC.new)return vttCCs.ccOffset=vttCCs.presentationOffset=currCC.start,void(currCC.new=!1);for(;prevCC&&prevCC.new;)vttCCs.ccOffset+=currCC.start-prevCC.start,currCC.new=!1,prevCC=vttCCs[(currCC=prevCC).prevCC];vttCCs.presentationOffset=presentationTime})(vttCCs,cc,presentationTime)),presentationTime&&(cueOffset=presentationTime-vttCCs.presentationOffset),timestampMap&&(cue.startTime+=cueOffset-localTime,cue.endTime+=cueOffset-localTime),cue.id=hash(cue.startTime.toString())+hash(cue.endTime.toString())+hash(cue.text),cue.text=decodeURIComponent(encodeURIComponent(cue.text)),cue.endTime>0&&cues.push(cue)},parser.onparsingerror=function(e){parsingError=e},parser.onflush=function(){parsingError&&errorCallBack?errorCallBack(parsingError):callBack(cues)},vttLines.forEach((function(line){if(inHeader){if(startsWith(line,"X-TIMESTAMP-MAP=")){inHeader=!1,timestampMap=!0,line.substr(16).split(",").forEach((function(timestamp){startsWith(timestamp,"LOCAL:")?cueTime=timestamp.substr(6):startsWith(timestamp,"MPEGTS:")&&(mpegTs=parseInt(timestamp.substr(7)))}));try{syncPTS+(9e4*vttCCs[cc].start||0)<0&&(syncPTS+=8589934592),mpegTs-=syncPTS,localTime=(function(timeString){var ts=parseInt(timeString.substr(-3)),secs=parseInt(timeString.substr(-6,2)),mins=parseInt(timeString.substr(-9,2)),hours=timeString.length>9?parseInt(timeString.substr(0,timeString.indexOf(":"))):0;if(!(Object(number.isFiniteNumber)(ts)&&Object(number.isFiniteNumber)(secs)&&Object(number.isFiniteNumber)(mins)&&Object(number.isFiniteNumber)(hours)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+timeString);return ts+=1e3*secs,ts+=6e4*mins,ts+=36e5*hours})(cueTime)/1e3,presentationTime=mpegTs/9e4}catch(e){timestampMap=!1,parsingError=e}return}""===line&&(inHeader=!1)}parser.parse(line+"\n")})),parser.flush()}};function timeline_controller_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function canReuseVttTextTrack(inUseTrack,manifestTrack){return inUseTrack&&inUseTrack.label===manifestTrack.name&&!(inUseTrack.textTrack1||inUseTrack.textTrack2)}var timeline_controller=(function(_EventHandler){var subClass,superClass;function TimelineController(hls){var _this;if((_this=_EventHandler.call(this,hls,events.default.MEDIA_ATTACHING,events.default.MEDIA_DETACHING,events.default.FRAG_PARSING_USERDATA,events.default.FRAG_DECRYPTED,events.default.MANIFEST_LOADING,events.default.MANIFEST_LOADED,events.default.FRAG_LOADED,events.default.INIT_PTS_FOUND)||this).media=null,_this.config=void 0,_this.enabled=!0,_this.Cues=void 0,_this.textTracks=[],_this.tracks=[],_this.initPTS=[],_this.unparsedVttFrags=[],_this.captionsTracks={},_this.nonNativeCaptionsTracks={},_this.captionsProperties=void 0,_this.cea608Parser1=void 0,_this.cea608Parser2=void 0,_this.lastSn=-1,_this.prevCC=-1,_this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},_this.hls=hls,_this.config=hls.config,_this.Cues=hls.config.cueHandler,_this.captionsProperties={textTrack1:{label:_this.config.captionsTextTrack1Label,languageCode:_this.config.captionsTextTrack1LanguageCode},textTrack2:{label:_this.config.captionsTextTrack2Label,languageCode:_this.config.captionsTextTrack2LanguageCode},textTrack3:{label:_this.config.captionsTextTrack3Label,languageCode:_this.config.captionsTextTrack3LanguageCode},textTrack4:{label:_this.config.captionsTextTrack4Label,languageCode:_this.config.captionsTextTrack4LanguageCode}},_this.config.enableCEA708Captions){var channel1=new OutputFilter(timeline_controller_assertThisInitialized(_this),"textTrack1"),channel2=new OutputFilter(timeline_controller_assertThisInitialized(_this),"textTrack2"),channel3=new OutputFilter(timeline_controller_assertThisInitialized(_this),"textTrack3"),channel4=new OutputFilter(timeline_controller_assertThisInitialized(_this),"textTrack4");_this.cea608Parser1=new cea_608_parser(1,channel1,channel2),_this.cea608Parser2=new cea_608_parser(3,channel3,channel4)}return _this}superClass=_EventHandler,(subClass=TimelineController).prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass;var _proto=TimelineController.prototype;return _proto.addCues=function(trackName,startTime,endTime,screen,cueRanges){for(var x1,x2,y1,y2,merged=!1,i=cueRanges.length;i--;){var cueRange=cueRanges[i],overlap=(x1=cueRange[0],x2=cueRange[1],y1=startTime,y2=endTime,Math.min(x2,y2)-Math.max(x1,y1));if(overlap>=0&&(cueRange[0]=Math.min(cueRange[0],startTime),cueRange[1]=Math.max(cueRange[1],endTime),merged=!0,overlap/(endTime-startTime)>.5))return}if(merged||cueRanges.push([startTime,endTime]),this.config.renderTextTracksNatively)this.Cues.newCue(this.captionsTracks[trackName],startTime,endTime,screen);else{var cues=this.Cues.newCue(null,startTime,endTime,screen);this.hls.trigger(events.default.CUES_PARSED,{type:"captions",cues,track:trackName})}},_proto.onInitPtsFound=function(data){var _this2=this,frag=data.frag,id=data.id,initPTS=data.initPTS,unparsedVttFrags=this.unparsedVttFrags;"main"===id&&(this.initPTS[frag.cc]=initPTS),unparsedVttFrags.length&&(this.unparsedVttFrags=[],unparsedVttFrags.forEach((function(frag){_this2.onFragLoaded(frag)})))},_proto.getExistingTrack=function(trackName){var media=this.media;if(media)for(var i=0;i<media.textTracks.length;i++){var textTrack=media.textTracks[i];if(textTrack[trackName])return textTrack}return null},_proto.createCaptionsTrack=function(trackName){this.config.renderTextTracksNatively?this.createNativeTrack(trackName):this.createNonNativeTrack(trackName)},_proto.createNativeTrack=function(trackName){if(!this.captionsTracks[trackName]){var captionsProperties=this.captionsProperties,captionsTracks=this.captionsTracks,media=this.media,_captionsProperties$t=captionsProperties[trackName],label=_captionsProperties$t.label,languageCode=_captionsProperties$t.languageCode,existingTrack=this.getExistingTrack(trackName);if(existingTrack)captionsTracks[trackName]=existingTrack,clearCurrentCues(captionsTracks[trackName]),sendAddTrackEvent(captionsTracks[trackName],media);else{var textTrack=this.createTextTrack("captions",label,languageCode);textTrack&&(textTrack[trackName]=!0,captionsTracks[trackName]=textTrack)}}},_proto.createNonNativeTrack=function(trackName){if(!this.nonNativeCaptionsTracks[trackName]){var trackProperties=this.captionsProperties[trackName];if(trackProperties){var track={_id:trackName,label:trackProperties.label,kind:"captions",default:!!trackProperties.media&&!!trackProperties.media.default,closedCaptions:trackProperties.media};this.nonNativeCaptionsTracks[trackName]=track,this.hls.trigger(events.default.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[track]})}}},_proto.createTextTrack=function(kind,label,lang){var media=this.media;if(media)return media.addTextTrack(kind,label,lang)},_proto.destroy=function(){_EventHandler.prototype.destroy.call(this)},_proto.onMediaAttaching=function(data){this.media=data.media,this._cleanTracks()},_proto.onMediaDetaching=function(){var captionsTracks=this.captionsTracks;Object.keys(captionsTracks).forEach((function(trackName){clearCurrentCues(captionsTracks[trackName]),delete captionsTracks[trackName]})),this.nonNativeCaptionsTracks={}},_proto.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={}},_proto._cleanTracks=function(){var media=this.media;if(media){var textTracks=media.textTracks;if(textTracks)for(var i=0;i<textTracks.length;i++)clearCurrentCues(textTracks[i])}},_proto.onManifestLoaded=function(data){var _this3=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset()),this.config.enableWebVTT){var tracks=data.subtitles||[],sameTracks=this.tracks&&tracks&&this.tracks.length===tracks.length;if(this.tracks=data.subtitles||[],this.config.renderTextTracksNatively){var inUseTracks=this.media?this.media.textTracks:[];this.tracks.forEach((function(track,index){var textTrack;if(index<inUseTracks.length){for(var inUseTrack=null,i=0;i<inUseTracks.length;i++)if(canReuseVttTextTrack(inUseTracks[i],track)){inUseTrack=inUseTracks[i];break}inUseTrack&&(textTrack=inUseTrack)}textTrack||(textTrack=_this3.createTextTrack("subtitles",track.name,track.lang)),track.default?textTrack.mode=_this3.hls.subtitleDisplay?"showing":"hidden":textTrack.mode="disabled",_this3.textTracks.push(textTrack)}))}else if(!sameTracks&&this.tracks&&this.tracks.length){var tracksList=this.tracks.map((function(track){return{label:track.name,kind:track.type.toLowerCase(),default:track.default,subtitleTrack:track}}));this.hls.trigger(events.default.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:tracksList})}}this.config.enableCEA708Captions&&data.captions&&data.captions.forEach((function(captionsTrack){var instreamIdMatch=/(?:CC|SERVICE)([1-4])/.exec(captionsTrack.instreamId);if(instreamIdMatch){var trackName="textTrack"+instreamIdMatch[1],trackProperties=_this3.captionsProperties[trackName];trackProperties&&(trackProperties.label=captionsTrack.name,captionsTrack.lang&&(trackProperties.languageCode=captionsTrack.lang),trackProperties.media=captionsTrack)}}))},_proto.onFragLoaded=function(data){var frag=data.frag,payload=data.payload,cea608Parser1=this.cea608Parser1,cea608Parser2=this.cea608Parser2,initPTS=this.initPTS,lastSn=this.lastSn,unparsedVttFrags=this.unparsedVttFrags;if("main"===frag.type){var sn=frag.sn;frag.sn!==lastSn+1&&cea608Parser1&&cea608Parser2&&(cea608Parser1.reset(),cea608Parser2.reset()),this.lastSn=sn}else if("subtitle"===frag.type)if(payload.byteLength){if(!Object(number.isFiniteNumber)(initPTS[frag.cc]))return unparsedVttFrags.push(data),void(initPTS.length&&this.hls.trigger(events.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag}));var decryptData=frag.decryptdata;null!=decryptData&&null!=decryptData.key&&"AES-128"===decryptData.method||this._parseVTTs(frag,payload)}else this.hls.trigger(events.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag})},_proto._parseVTTs=function(frag,payload){var _this4=this,hls=this.hls,prevCC=this.prevCC,textTracks=this.textTracks,vttCCs=this.vttCCs;vttCCs[frag.cc]||(vttCCs[frag.cc]={start:frag.start,prevCC,new:!0},this.prevCC=frag.cc),webvtt_parser.parse(payload,this.initPTS[frag.cc],vttCCs,frag.cc,(function(cues){if(_this4.config.renderTextTracksNatively){var currentTrack=textTracks[frag.level];if("disabled"===currentTrack.mode)return void hls.trigger(events.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag});cues.forEach((function(cue){if(!currentTrack.cues.getCueById(cue.id))try{if(currentTrack.addCue(cue),!currentTrack.cues.getCueById(cue.id))throw new Error("addCue is failed for: "+cue)}catch(err){logger.logger.debug("Failed occurred on adding cues: "+err);var textTrackCue=new window.TextTrackCue(cue.startTime,cue.endTime,cue.text);textTrackCue.id=cue.id,currentTrack.addCue(textTrackCue)}}))}else{var trackId=_this4.tracks[frag.level].default?"default":"subtitles"+frag.level;hls.trigger(events.default.CUES_PARSED,{type:"subtitles",cues,track:trackId})}hls.trigger(events.default.SUBTITLE_FRAG_PROCESSED,{success:!0,frag})}),(function(e){logger.logger.log("Failed to parse VTT cue: "+e),hls.trigger(events.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag})}))},_proto.onFragDecrypted=function(data){var frag=data.frag,payload=data.payload;if("subtitle"===frag.type){if(!Object(number.isFiniteNumber)(this.initPTS[frag.cc]))return void this.unparsedVttFrags.push(data);this._parseVTTs(frag,payload)}},_proto.onFragParsingUserdata=function(data){var cea608Parser1=this.cea608Parser1,cea608Parser2=this.cea608Parser2;if(this.enabled&&cea608Parser1&&cea608Parser2)for(var i=0;i<data.samples.length;i++){var ccBytes=data.samples[i].bytes;if(ccBytes){var ccdatas=this.extractCea608Data(ccBytes);cea608Parser1.addData(data.samples[i].pts,ccdatas[0]),cea608Parser2.addData(data.samples[i].pts,ccdatas[1])}}},_proto.extractCea608Data=function(byteArray){for(var count=31&byteArray[0],position=2,actualCCBytes=[[],[]],j=0;j<count;j++){var tmpByte=byteArray[position++],ccbyte1=127&byteArray[position++],ccbyte2=127&byteArray[position++],ccType=3&tmpByte;0===ccbyte1&&0===ccbyte2||0!=(4&tmpByte)&&(0!==ccType&&1!==ccType||(actualCCBytes[ccType].push(ccbyte1),actualCCBytes[ccType].push(ccbyte2)))}return actualCCBytes},TimelineController})(event_handler);function subtitle_track_controller_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function filterSubtitleTracks(textTrackList){for(var tracks=[],i=0;i<textTrackList.length;i++){var track=textTrackList[i];"subtitles"===track.kind&&track.label&&tracks.push(textTrackList[i])}return tracks}var KeySystems,subtitle_track_controller=(function(_EventHandler){var subClass,superClass;function SubtitleTrackController(hls){var _this;return(_this=_EventHandler.call(this,hls,events.default.MEDIA_ATTACHED,events.default.MEDIA_DETACHING,events.default.MANIFEST_LOADED,events.default.SUBTITLE_TRACK_LOADED)||this).tracks=[],_this.trackId=-1,_this.media=null,_this.stopped=!0,_this.subtitleDisplay=!0,_this.queuedDefaultTrack=null,_this}superClass=_EventHandler,(subClass=SubtitleTrackController).prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass;var Constructor,protoProps,staticProps,_proto=SubtitleTrackController.prototype;return _proto.destroy=function(){event_handler.prototype.destroy.call(this)},_proto.onMediaAttached=function(data){var _this2=this;this.media=data.media,this.media&&(Object(number.isFiniteNumber)(this.queuedDefaultTrack)&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=null),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval((function(){_this2.trackChangeListener()}),500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},_proto.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),Object(number.isFiniteNumber)(this.subtitleTrack)&&(this.queuedDefaultTrack=this.subtitleTrack),filterSubtitleTracks(this.media.textTracks).forEach((function(track){clearCurrentCues(track)})),this.subtitleTrack=-1,this.media=null)},_proto.onManifestLoaded=function(data){var _this3=this,tracks=data.subtitles||[];this.tracks=tracks,this.hls.trigger(events.default.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:tracks}),tracks.forEach((function(track){track.default&&(_this3.media?_this3.subtitleTrack=track.id:_this3.queuedDefaultTrack=track.id)}))},_proto.onSubtitleTrackLoaded=function(data){var _this4=this,id=data.id,details=data.details,trackId=this.trackId,tracks=this.tracks,currentTrack=tracks[trackId];if(id>=tracks.length||id!==trackId||!currentTrack||this.stopped)this._clearReloadTimer();else if(logger.logger.log("subtitle track "+id+" loaded"),details.live){var reloadInterval=computeReloadInterval(currentTrack.details,details,data.stats.trequest);logger.logger.log("Reloading live subtitle playlist in "+reloadInterval+"ms"),this.timer=setTimeout((function(){_this4._loadCurrentTrack()}),reloadInterval)}else this._clearReloadTimer()},_proto.startLoad=function(){this.stopped=!1,this._loadCurrentTrack()},_proto.stopLoad=function(){this.stopped=!0,this._clearReloadTimer()},_proto._clearReloadTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},_proto._loadCurrentTrack=function(){var trackId=this.trackId,tracks=this.tracks,hls=this.hls,currentTrack=tracks[trackId];trackId<0||!currentTrack||currentTrack.details&&!currentTrack.details.live||(logger.logger.log("Loading subtitle track "+trackId),hls.trigger(events.default.SUBTITLE_TRACK_LOADING,{url:currentTrack.url,id:trackId}))},_proto._toggleTrackModes=function(newId){var media=this.media,subtitleDisplay=this.subtitleDisplay,trackId=this.trackId;if(media){var textTracks=filterSubtitleTracks(media.textTracks);if(-1===newId)[].slice.call(textTracks).forEach((function(track){track.mode="disabled"}));else{var oldTrack=textTracks[trackId];oldTrack&&(oldTrack.mode="disabled")}var nextTrack=textTracks[newId];nextTrack&&(nextTrack.mode=subtitleDisplay?"showing":"hidden")}},_proto._setSubtitleTrackInternal=function(newId){var hls=this.hls,tracks=this.tracks;!Object(number.isFiniteNumber)(newId)||newId<-1||newId>=tracks.length||(this.trackId=newId,logger.logger.log("Switching to subtitle track "+newId),hls.trigger(events.default.SUBTITLE_TRACK_SWITCH,{id:newId}),this._loadCurrentTrack())},_proto._onTextTracksChanged=function(){if(this.media&&this.hls.config.renderTextTracksNatively){for(var trackId=-1,tracks=filterSubtitleTracks(this.media.textTracks),id=0;id<tracks.length;id++)if("hidden"===tracks[id].mode)trackId=id;else if("showing"===tracks[id].mode){trackId=id;break}this.subtitleTrack=trackId}},Constructor=SubtitleTrackController,(protoProps=[{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(subtitleTrackId){this.trackId!==subtitleTrackId&&(this._toggleTrackModes(subtitleTrackId),this._setSubtitleTrackInternal(subtitleTrackId))}}])&&subtitle_track_controller_defineProperties(Constructor.prototype,protoProps),staticProps&&subtitle_track_controller_defineProperties(Constructor,staticProps),SubtitleTrackController})(event_handler),decrypter=__webpack_require__("./src/crypt/decrypter.js"),subtitle_stream_controller_performance=window.performance,subtitle_stream_controller_SubtitleStreamController=(function(_BaseStreamController){var subClass,superClass;function SubtitleStreamController(hls,fragmentTracker){var _this;return(_this=_BaseStreamController.call(this,hls,events.default.MEDIA_ATTACHED,events.default.MEDIA_DETACHING,events.default.ERROR,events.default.KEY_LOADED,events.default.FRAG_LOADED,events.default.SUBTITLE_TRACKS_UPDATED,events.default.SUBTITLE_TRACK_SWITCH,events.default.SUBTITLE_TRACK_LOADED,events.default.SUBTITLE_FRAG_PROCESSED,events.default.LEVEL_UPDATED)||this).fragmentTracker=fragmentTracker,_this.config=hls.config,_this.state=State_STOPPED,_this.tracks=[],_this.tracksBuffered=[],_this.currentTrackId=-1,_this.decrypter=new decrypter.default(hls,hls.config),_this.lastAVStart=0,_this._onMediaSeeking=_this.onMediaSeeking.bind((function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self})(_this)),_this}superClass=_BaseStreamController,(subClass=SubtitleStreamController).prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass;var _proto=SubtitleStreamController.prototype;return _proto.startLoad=function(){this.stopLoad(),this.state=State_IDLE;var currentTrack=this.tracks[this.currentTrackId];currentTrack&&currentTrack.details&&(this.setInterval(500),this.tick())},_proto.onSubtitleFragProcessed=function(data){var frag=data.frag,success=data.success;if(this.fragPrevious=frag,this.state=State_IDLE,success){var buffered=this.tracksBuffered[this.currentTrackId];if(buffered){for(var timeRange,fragStart=frag.start,i=0;i<buffered.length;i++)if(fragStart>=buffered[i].start&&fragStart<=buffered[i].end){timeRange=buffered[i];break}var fragEnd=frag.start+frag.duration;timeRange?timeRange.end=fragEnd:(timeRange={start:fragStart,end:fragEnd},buffered.push(timeRange))}}},_proto.onMediaAttached=function(_ref){var media=_ref.media;this.media=media,media.addEventListener("seeking",this._onMediaSeeking),this.state=State_IDLE},_proto.onMediaDetaching=function(){var _this2=this;this.media&&(this.media.removeEventListener("seeking",this._onMediaSeeking),this.fragmentTracker.removeAllFragments(),this.currentTrackId=-1,this.tracks.forEach((function(track){_this2.tracksBuffered[track.id]=[]})),this.media=null,this.state=State_STOPPED)},_proto.onError=function(data){var frag=data.frag;frag&&"subtitle"===frag.type&&(this.fragCurrent&&this.fragCurrent.loader&&this.fragCurrent.loader.abort(),this.state=State_IDLE)},_proto.onSubtitleTracksUpdated=function(data){var _this3=this;logger.logger.log("subtitle tracks updated"),this.tracksBuffered=[],this.tracks=data.subtitleTracks,this.tracks.forEach((function(track){_this3.tracksBuffered[track.id]=[]}))},_proto.onSubtitleTrackSwitch=function(data){if(this.currentTrackId=data.id,this.tracks&&this.tracks.length&&-1!==this.currentTrackId){var currentTrack=this.tracks[this.currentTrackId];currentTrack&&currentTrack.details&&this.setInterval(500)}else this.clearInterval()},_proto.onSubtitleTrackLoaded=function(data){var id=data.id,details=data.details,currentTrackId=this.currentTrackId,tracks=this.tracks,currentTrack=tracks[currentTrackId];id>=tracks.length||id!==currentTrackId||!currentTrack||(details.live&&(function(oldPlaylist,newPlaylist,referenceStart){void 0===referenceStart&&(referenceStart=0);var lastIndex=-1;mapFragmentIntersection(oldPlaylist,newPlaylist,(function(oldFrag,newFrag,index){newFrag.start=oldFrag.start,lastIndex=index}));var frags=newPlaylist.fragments;if(lastIndex<0)frags.forEach((function(frag){frag.start+=referenceStart}));else for(var i=lastIndex+1;i<frags.length;i++)frags[i].start=frags[i-1].start+frags[i-1].duration})(currentTrack.details,details,this.lastAVStart),currentTrack.details=details,this.setInterval(500))},_proto.onKeyLoaded=function(){this.state===State_KEY_LOADING&&(this.state=State_IDLE)},_proto.onFragLoaded=function(data){var fragCurrent=this.fragCurrent,decryptData=data.frag.decryptdata,fragLoaded=data.frag,hls=this.hls;if(this.state===State_FRAG_LOADING&&fragCurrent&&"subtitle"===data.frag.type&&fragCurrent.sn===data.frag.sn&&data.payload.byteLength>0&&decryptData&&decryptData.key&&"AES-128"===decryptData.method){var startTime=subtitle_stream_controller_performance.now();this.decrypter.decrypt(data.payload,decryptData.key.buffer,decryptData.iv.buffer,(function(decryptedData){var endTime=subtitle_stream_controller_performance.now();hls.trigger(events.default.FRAG_DECRYPTED,{frag:fragLoaded,payload:decryptedData,stats:{tstart:startTime,tdecrypt:endTime}})}))}},_proto.onLevelUpdated=function(_ref2){var frags=_ref2.details.fragments;this.lastAVStart=frags.length?frags[0].start:0},_proto.doTick=function(){if(this.media)switch(this.state){case State_IDLE:var config=this.config,currentTrackId=this.currentTrackId,fragmentTracker=this.fragmentTracker,media=this.media,tracks=this.tracks;if(!tracks||!tracks[currentTrackId]||!tracks[currentTrackId].details)break;var foundFrag,maxBufferHole=config.maxBufferHole,maxFragLookUpTolerance=config.maxFragLookUpTolerance,maxConfigBuffer=Math.min(config.maxBufferLength,config.maxMaxBufferLength),bufferedInfo=BufferHelper.bufferedInfo(this._getBuffered(),media.currentTime,maxBufferHole),bufferEnd=bufferedInfo.end,bufferLen=bufferedInfo.len,trackDetails=tracks[currentTrackId].details,fragments=trackDetails.fragments,fragLen=fragments.length,end=fragments[fragLen-1].start+fragments[fragLen-1].duration;if(bufferLen>maxConfigBuffer)return;var fragPrevious=this.fragPrevious;bufferEnd<end?(fragPrevious&&trackDetails.hasProgramDateTime&&(foundFrag=findFragmentByPDT(fragments,fragPrevious.endProgramDateTime,maxFragLookUpTolerance)),foundFrag||(foundFrag=findFragmentByPTS(fragPrevious,fragments,bufferEnd,maxFragLookUpTolerance))):foundFrag=fragments[fragLen-1],foundFrag&&foundFrag.encrypted?(logger.logger.log("Loading key for "+foundFrag.sn),this.state=State_KEY_LOADING,this.hls.trigger(events.default.KEY_LOADING,{frag:foundFrag})):foundFrag&&fragmentTracker.getState(foundFrag)===FragmentState_NOT_LOADED&&(this.fragCurrent=foundFrag,this.state=State_FRAG_LOADING,this.hls.trigger(events.default.FRAG_LOADING,{frag:foundFrag}))}else this.state=State_IDLE},_proto.stopLoad=function(){this.lastAVStart=0,this.fragPrevious=null,_BaseStreamController.prototype.stopLoad.call(this)},_proto._getBuffered=function(){return this.tracksBuffered[this.currentTrackId]||[]},_proto.onMediaSeeking=function(){if(this.fragCurrent){var currentTime=this.media?this.media.currentTime:0,tolerance=this.config.maxFragLookUpTolerance,fragStartOffset=this.fragCurrent.start-tolerance,fragEndOffset=this.fragCurrent.start+this.fragCurrent.duration+tolerance;(currentTime<fragStartOffset||currentTime>fragEndOffset)&&(this.fragCurrent.loader&&this.fragCurrent.loader.abort(),this.fragmentTracker.removeFragment(this.fragCurrent),this.fragCurrent=null,this.fragPrevious=null,this.state=State_IDLE,this.tick())}},SubtitleStreamController})(base_stream_controller_BaseStreamController);!(function(KeySystems){KeySystems.WIDEVINE="com.widevine.alpha",KeySystems.PLAYREADY="com.microsoft.playready"})(KeySystems||(KeySystems={}));var requestMediaKeySystemAccess="undefined"!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null;function eme_controller_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var eme_controller=(function(_EventHandler){var subClass,superClass;function EMEController(hls){var _this;return(_this=_EventHandler.call(this,hls,events.default.MEDIA_ATTACHED,events.default.MEDIA_DETACHED,events.default.MANIFEST_PARSED)||this)._widevineLicenseUrl=void 0,_this._licenseXhrSetup=void 0,_this._emeEnabled=void 0,_this._requestMediaKeySystemAccess=void 0,_this._drmSystemOptions=void 0,_this._config=void 0,_this._mediaKeysList=[],_this._media=null,_this._hasSetMediaKeys=!1,_this._requestLicenseFailureCount=0,_this.mediaKeysPromise=null,_this._onMediaEncrypted=function(e){if(logger.logger.log('Media is encrypted using "'+e.initDataType+'" init data type'),!_this.mediaKeysPromise)return logger.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void _this.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.KEY_SYSTEM_ERROR,details:errors.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});var finallySetKeyAndStartSession=function(mediaKeys){_this._media&&(_this._attemptSetMediaKeys(mediaKeys),_this._generateRequestWithPreferredKeySession(e.initDataType,e.initData))};_this.mediaKeysPromise.then(finallySetKeyAndStartSession).catch(finallySetKeyAndStartSession)},_this._config=hls.config,_this._widevineLicenseUrl=_this._config.widevineLicenseUrl,_this._licenseXhrSetup=_this._config.licenseXhrSetup,_this._emeEnabled=_this._config.emeEnabled,_this._requestMediaKeySystemAccess=_this._config.requestMediaKeySystemAccessFunc,_this._drmSystemOptions=hls.config.drmSystemOptions,_this}superClass=_EventHandler,(subClass=EMEController).prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass;var Constructor,protoProps,staticProps,_proto=EMEController.prototype;return _proto.getLicenseServerUrl=function(keySystem){switch(keySystem){case KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+keySystem+'"')},_proto._attemptKeySystemAccess=function(keySystem,audioCodecs,videoCodecs){var _this2=this,mediaKeySystemConfigs=(function(keySystem,audioCodecs,videoCodecs,drmSystemOptions){switch(keySystem){case KeySystems.WIDEVINE:return(function(audioCodecs,videoCodecs,drmSystemOptions){var baseConfig={audioCapabilities:[],videoCapabilities:[]};return audioCodecs.forEach((function(codec){baseConfig.audioCapabilities.push({contentType:'audio/mp4; codecs="'+codec+'"',robustness:drmSystemOptions.audioRobustness||""})})),videoCodecs.forEach((function(codec){baseConfig.videoCapabilities.push({contentType:'video/mp4; codecs="'+codec+'"',robustness:drmSystemOptions.videoRobustness||""})})),[baseConfig]})(audioCodecs,videoCodecs,drmSystemOptions);default:throw new Error("Unknown key-system: "+keySystem)}})(keySystem,audioCodecs,videoCodecs,this._drmSystemOptions);logger.logger.log("Requesting encrypted media key-system access");var keySystemAccessPromise=this.requestMediaKeySystemAccess(keySystem,mediaKeySystemConfigs);this.mediaKeysPromise=keySystemAccessPromise.then((function(mediaKeySystemAccess){return _this2._onMediaKeySystemAccessObtained(keySystem,mediaKeySystemAccess)})),keySystemAccessPromise.catch((function(err){logger.logger.error('Failed to obtain key-system "'+keySystem+'" access:',err)}))},_proto._onMediaKeySystemAccessObtained=function(keySystem,mediaKeySystemAccess){var _this3=this;logger.logger.log('Access for key-system "'+keySystem+'" obtained');var mediaKeysListItem={mediaKeysSessionInitialized:!1,mediaKeySystemAccess,mediaKeySystemDomain:keySystem};this._mediaKeysList.push(mediaKeysListItem);var mediaKeysPromise=Promise.resolve().then((function(){return mediaKeySystemAccess.createMediaKeys()})).then((function(mediaKeys){return mediaKeysListItem.mediaKeys=mediaKeys,logger.logger.log('Media-keys created for key-system "'+keySystem+'"'),_this3._onMediaKeysCreated(),mediaKeys}));return mediaKeysPromise.catch((function(err){logger.logger.error("Failed to create media-keys:",err)})),mediaKeysPromise},_proto._onMediaKeysCreated=function(){var _this4=this;this._mediaKeysList.forEach((function(mediaKeysListItem){mediaKeysListItem.mediaKeysSession||(mediaKeysListItem.mediaKeysSession=mediaKeysListItem.mediaKeys.createSession(),_this4._onNewMediaKeySession(mediaKeysListItem.mediaKeysSession))}))},_proto._onNewMediaKeySession=function(keySession){var _this5=this;logger.logger.log("New key-system session "+keySession.sessionId),keySession.addEventListener("message",(function(event){_this5._onKeySessionMessage(keySession,event.message)}),!1)},_proto._onKeySessionMessage=function(keySession,message){logger.logger.log("Got EME message event, creating license request"),this._requestLicense(message,(function(data){logger.logger.log("Received license data (length: "+(data?data.byteLength:data)+"), updating key-session"),keySession.update(data)}))},_proto._attemptSetMediaKeys=function(mediaKeys){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var keysListItem=this._mediaKeysList[0];if(!keysListItem||!keysListItem.mediaKeys)return logger.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.KEY_SYSTEM_ERROR,details:errors.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});logger.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(keysListItem.mediaKeys),this._hasSetMediaKeys=!0}},_proto._generateRequestWithPreferredKeySession=function(initDataType,initData){var _this6=this,keysListItem=this._mediaKeysList[0];if(!keysListItem)return logger.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.KEY_SYSTEM_ERROR,details:errors.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(keysListItem.mediaKeysSessionInitialized)logger.logger.warn("Key-Session already initialized but requested again");else{var keySession=keysListItem.mediaKeysSession;if(!keySession)return logger.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.KEY_SYSTEM_ERROR,details:errors.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!initData)return logger.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.KEY_SYSTEM_ERROR,details:errors.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});logger.logger.log('Generating key-session request for "'+initDataType+'" init data type'),keysListItem.mediaKeysSessionInitialized=!0,keySession.generateRequest(initDataType,initData).then((function(){logger.logger.debug("Key-session generation succeeded")})).catch((function(err){logger.logger.error("Error generating key-session request:",err),_this6.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.KEY_SYSTEM_ERROR,details:errors.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})}))}},_proto._createLicenseXhr=function(url,keyMessage,callback){var xhr=new XMLHttpRequest,licenseXhrSetup=this._licenseXhrSetup;try{if(licenseXhrSetup)try{licenseXhrSetup(xhr,url)}catch(e){xhr.open("POST",url,!0),licenseXhrSetup(xhr,url)}xhr.readyState||xhr.open("POST",url,!0)}catch(e){throw new Error("issue setting up KeySystem license XHR "+e)}return xhr.responseType="arraybuffer",xhr.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,xhr,url,keyMessage,callback),xhr},_proto._onLicenseRequestReadyStageChange=function(xhr,url,keyMessage,callback){switch(xhr.readyState){case 4:if(200===xhr.status)this._requestLicenseFailureCount=0,logger.logger.log("License request succeeded"),"arraybuffer"!==xhr.responseType&&logger.logger.warn("xhr response type was not set to the expected arraybuffer for license request"),callback(xhr.response);else{if(logger.logger.error("License Request XHR failed ("+url+"). Status: "+xhr.status+" ("+xhr.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.KEY_SYSTEM_ERROR,details:errors.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var attemptsLeft=3-this._requestLicenseFailureCount+1;logger.logger.warn("Retrying license request, "+attemptsLeft+" attempts left"),this._requestLicense(keyMessage,callback)}}},_proto._generateLicenseRequestChallenge=function(keysListItem,keyMessage){switch(keysListItem.mediaKeySystemDomain){case KeySystems.WIDEVINE:return keyMessage}throw new Error("unsupported key-system: "+keysListItem.mediaKeySystemDomain)},_proto._requestLicense=function(keyMessage,callback){logger.logger.log("Requesting content license for key-system");var keysListItem=this._mediaKeysList[0];if(!keysListItem)return logger.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.KEY_SYSTEM_ERROR,details:errors.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var _url=this.getLicenseServerUrl(keysListItem.mediaKeySystemDomain),_xhr=this._createLicenseXhr(_url,keyMessage,callback);logger.logger.log("Sending license request to URL: "+_url);var challenge=this._generateLicenseRequestChallenge(keysListItem,keyMessage);_xhr.send(challenge)}catch(e){logger.logger.error("Failure requesting DRM license: "+e),this.hls.trigger(events.default.ERROR,{type:errors.ErrorTypes.KEY_SYSTEM_ERROR,details:errors.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},_proto.onMediaAttached=function(data){if(this._emeEnabled){var media=data.media;this._media=media,media.addEventListener("encrypted",this._onMediaEncrypted)}},_proto.onMediaDetached=function(){var media=this._media,mediaKeysList=this._mediaKeysList;media&&(media.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(mediaKeysList.map((function(mediaKeysListItem){if(mediaKeysListItem.mediaKeysSession)return mediaKeysListItem.mediaKeysSession.close().catch((function(){}))}))).then((function(){return media.setMediaKeys(null)})).catch((function(){})))},_proto.onManifestParsed=function(data){if(this._emeEnabled){var audioCodecs=data.levels.map((function(level){return level.audioCodec})),videoCodecs=data.levels.map((function(level){return level.videoCodec}));this._attemptKeySystemAccess(KeySystems.WIDEVINE,audioCodecs,videoCodecs)}},Constructor=EMEController,(protoProps=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&eme_controller_defineProperties(Constructor.prototype,protoProps),staticProps&&eme_controller_defineProperties(Constructor,staticProps),EMEController})(event_handler);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var hlsDefaultConfig=_objectSpread(_objectSpread({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,liveBackBufferLength:1/0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:xhr_loader,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:abr_controller,bufferController:buffer_controller,capLevelController:cap_level_controller,fpsController:fps_controller,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:requestMediaKeySystemAccess,testBandwidth:!0},{cueHandler:cues_namespaceObject,enableCEA708Captions:!0,enableWebVTT:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:subtitle_stream_controller_SubtitleStreamController,subtitleTrackController:subtitle_track_controller,timelineController:timeline_controller,audioStreamController:audio_stream_controller,audioTrackController:audio_track_controller,emeController:eme_controller});function hls_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function hls_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?hls_ownKeys(Object(source),!0).forEach((function(key){hls_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):hls_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function hls_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function hls_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function hls_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function hls_createClass(Constructor,protoProps,staticProps){return protoProps&&hls_defineProperties(Constructor.prototype,protoProps),staticProps&&hls_defineProperties(Constructor,staticProps),Constructor}var hls_Hls=(function(_Observer){var subClass,superClass;function Hls(userConfig){var _this;void 0===userConfig&&(userConfig={}),(_this=_Observer.call(this)||this).config=void 0,_this._autoLevelCapping=void 0,_this.abrController=void 0,_this.capLevelController=void 0,_this.levelController=void 0,_this.streamController=void 0,_this.networkControllers=void 0,_this.audioTrackController=void 0,_this.subtitleTrackController=void 0,_this.emeController=void 0,_this.coreComponents=void 0,_this.media=null,_this.url=null;var defaultConfig=Hls.DefaultConfig;if((userConfig.liveSyncDurationCount||userConfig.liveMaxLatencyDurationCount)&&(userConfig.liveSyncDuration||userConfig.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");_this.config=hls_objectSpread(hls_objectSpread({},defaultConfig),userConfig);var config=hls_assertThisInitialized(_this).config;if(void 0!==config.liveMaxLatencyDurationCount&&config.liveMaxLatencyDurationCount<=config.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==config.liveMaxLatencyDuration&&(void 0===config.liveSyncDuration||config.liveMaxLatencyDuration<=config.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(logger.enableLogs)(config.debug),_this._autoLevelCapping=-1;var abrController=_this.abrController=new config.abrController(hls_assertThisInitialized(_this)),bufferController=new config.bufferController(hls_assertThisInitialized(_this)),capLevelController=_this.capLevelController=new config.capLevelController(hls_assertThisInitialized(_this)),fpsController=new config.fpsController(hls_assertThisInitialized(_this)),playListLoader=new playlist_loader(hls_assertThisInitialized(_this)),fragmentLoader=new fragment_loader(hls_assertThisInitialized(_this)),keyLoader=new key_loader(hls_assertThisInitialized(_this)),id3TrackController=new id3_track_controller(hls_assertThisInitialized(_this)),levelController=_this.levelController=new level_controller_LevelController(hls_assertThisInitialized(_this)),fragmentTracker=new fragment_tracker_FragmentTracker(hls_assertThisInitialized(_this)),networkControllers=[levelController,_this.streamController=new stream_controller(hls_assertThisInitialized(_this),fragmentTracker)],Controller=config.audioStreamController;Controller&&networkControllers.push(new Controller(hls_assertThisInitialized(_this),fragmentTracker)),_this.networkControllers=networkControllers;var coreComponents=[playListLoader,fragmentLoader,keyLoader,abrController,bufferController,capLevelController,fpsController,id3TrackController,fragmentTracker];if(Controller=config.audioTrackController){var audioTrackController=new Controller(hls_assertThisInitialized(_this));_this.audioTrackController=audioTrackController,coreComponents.push(audioTrackController)}if(Controller=config.subtitleTrackController){var subtitleTrackController=new Controller(hls_assertThisInitialized(_this));_this.subtitleTrackController=subtitleTrackController,networkControllers.push(subtitleTrackController)}if(Controller=config.emeController){var emeController=new Controller(hls_assertThisInitialized(_this));_this.emeController=emeController,coreComponents.push(emeController)}return(Controller=config.subtitleStreamController)&&networkControllers.push(new Controller(hls_assertThisInitialized(_this),fragmentTracker)),(Controller=config.timelineController)&&coreComponents.push(new Controller(hls_assertThisInitialized(_this))),_this.coreComponents=coreComponents,_this}superClass=_Observer,(subClass=Hls).prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass,Hls.isSupported=function(){return(function(){var mediaSource=getMediaSource();if(!mediaSource)return!1;var sourceBuffer=self.SourceBuffer||self.WebKitSourceBuffer,isTypeSupported=mediaSource&&"function"==typeof mediaSource.isTypeSupported&&mediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),sourceBufferValidAPI=!sourceBuffer||sourceBuffer.prototype&&"function"==typeof sourceBuffer.prototype.appendBuffer&&"function"==typeof sourceBuffer.prototype.remove;return!!isTypeSupported&&!!sourceBufferValidAPI})()},hls_createClass(Hls,null,[{key:"version",get:function(){return"0.14.16"}},{key:"Events",get:function(){return events.default}},{key:"ErrorTypes",get:function(){return errors.ErrorTypes}},{key:"ErrorDetails",get:function(){return errors.ErrorDetails}},{key:"DefaultConfig",get:function(){return Hls.defaultConfig?Hls.defaultConfig:hlsDefaultConfig},set:function(defaultConfig){Hls.defaultConfig=defaultConfig}}]);var _proto=Hls.prototype;return _proto.destroy=function(){logger.logger.log("destroy"),this.trigger(events.default.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach((function(component){component.destroy()})),this.url=null,this.removeAllListeners(),this._autoLevelCapping=-1},_proto.attachMedia=function(media){logger.logger.log("attachMedia"),this.media=media,this.trigger(events.default.MEDIA_ATTACHING,{media})},_proto.detachMedia=function(){logger.logger.log("detachMedia"),this.trigger(events.default.MEDIA_DETACHING),this.media=null},_proto.loadSource=function(url){url=url_toolkit.buildAbsoluteURL(window.location.href,url,{alwaysNormalize:!0}),logger.logger.log("loadSource:"+url),this.url=url,this.trigger(events.default.MANIFEST_LOADING,{url})},_proto.startLoad=function(startPosition){void 0===startPosition&&(startPosition=-1),logger.logger.log("startLoad("+startPosition+")"),this.networkControllers.forEach((function(controller){controller.startLoad(startPosition)}))},_proto.stopLoad=function(){logger.logger.log("stopLoad"),this.networkControllers.forEach((function(controller){controller.stopLoad()}))},_proto.swapAudioCodec=function(){logger.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},_proto.recoverMediaError=function(){logger.logger.log("recoverMediaError");var media=this.media;this.detachMedia(),media&&this.attachMedia(media)},_proto.removeLevel=function(levelIndex,urlId){void 0===urlId&&(urlId=0),this.levelController.removeLevel(levelIndex,urlId)},hls_createClass(Hls,[{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(newLevel){logger.logger.log("set currentLevel:"+newLevel),this.loadLevel=newLevel,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(newLevel){logger.logger.log("set nextLevel:"+newLevel),this.levelController.manualLevel=newLevel,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(newLevel){logger.logger.log("set loadLevel:"+newLevel),this.levelController.manualLevel=newLevel}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(level){this.levelController.nextLoadLevel=level}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(newLevel){logger.logger.log("set firstLevel:"+newLevel),this.levelController.firstLevel=newLevel}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(newLevel){logger.logger.log("set startLevel:"+newLevel),-1!==newLevel&&(newLevel=Math.max(newLevel,this.minAutoLevel)),this.levelController.startLevel=newLevel}},{key:"capLevelToPlayerSize",set:function(shouldStartCapping){var newCapLevelToPlayerSize=!!shouldStartCapping;newCapLevelToPlayerSize!==this.config.capLevelToPlayerSize&&(newCapLevelToPlayerSize?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=newCapLevelToPlayerSize)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(newLevel){logger.logger.log("set autoLevelCapping:"+newLevel),this._autoLevelCapping=newLevel}},{key:"bandwidthEstimate",get:function(){var bwEstimator=this.abrController._bwEstimator;return bwEstimator?bwEstimator.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var levels=this.levels,minAutoBitrate=this.config.minAutoBitrate,len=levels?levels.length:0,i=0;i<len;i++)if((levels[i].realBitrate?Math.max(levels[i].realBitrate,levels[i].bitrate):levels[i].bitrate)>minAutoBitrate)return i;return 0}},{key:"maxAutoLevel",get:function(){var levels=this.levels,autoLevelCapping=this.autoLevelCapping;return-1===autoLevelCapping&&levels&&levels.length?levels.length-1:autoLevelCapping}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(nextLevel){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,nextLevel)}},{key:"audioTracks",get:function(){var audioTrackController=this.audioTrackController;return audioTrackController?audioTrackController.audioTracks:[]}},{key:"audioTrack",get:function(){var audioTrackController=this.audioTrackController;return audioTrackController?audioTrackController.audioTrack:-1},set:function(audioTrackId){var audioTrackController=this.audioTrackController;audioTrackController&&(audioTrackController.audioTrack=audioTrackId)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var subtitleTrackController=this.subtitleTrackController;return subtitleTrackController?subtitleTrackController.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var subtitleTrackController=this.subtitleTrackController;return subtitleTrackController?subtitleTrackController.subtitleTrack:-1},set:function(subtitleTrackId){var subtitleTrackController=this.subtitleTrackController;subtitleTrackController&&(subtitleTrackController.subtitleTrack=subtitleTrackId)}},{key:"subtitleDisplay",get:function(){var subtitleTrackController=this.subtitleTrackController;return!!subtitleTrackController&&subtitleTrackController.subtitleDisplay},set:function(value){var subtitleTrackController=this.subtitleTrackController;subtitleTrackController&&(subtitleTrackController.subtitleDisplay=value)}}]),Hls})(Observer);hls_Hls.defaultConfig=void 0},"./src/polyfills/number.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"isFiniteNumber",(function(){return isFiniteNumber})),__webpack_require__.d(__webpack_exports__,"MAX_SAFE_INTEGER",(function(){return MAX_SAFE_INTEGER}));var isFiniteNumber=Number.isFinite||function(value){return"number"==typeof value&&isFinite(value)},MAX_SAFE_INTEGER=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/utils/get-self-scope.js":function(module,__webpack_exports__,__webpack_require__){"use strict";function getSelfScope(){return"undefined"==typeof window?self:window}__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"getSelfScope",(function(){return getSelfScope}))},"./src/utils/logger.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"enableLogs",(function(){return enableLogs})),__webpack_require__.d(__webpack_exports__,"logger",(function(){return logger}));var _get_self_scope__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/utils/get-self-scope.js");function noop(){}var fakeLogger={trace:noop,debug:noop,log:noop,warn:noop,info:noop,error:noop},exportedLogger=fakeLogger;function formatMsg(type,msg){return msg="["+type+"] > "+msg}var global=Object(_get_self_scope__WEBPACK_IMPORTED_MODULE_0__.getSelfScope)();function consolePrintFn(type){var func=global.console[type];return func?function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];args[0]&&(args[0]=formatMsg(type,args[0])),func.apply(global.console,args)}:noop}var enableLogs=function(debugConfig){if(global.console&&!0===debugConfig||"object"==typeof debugConfig){!(function(debugConfig){for(var _len2=arguments.length,functions=new Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++)functions[_key2-1]=arguments[_key2];functions.forEach((function(type){exportedLogger[type]=debugConfig[type]?debugConfig[type].bind(debugConfig):consolePrintFn(type)}))})(debugConfig,"debug","log","info","warn","error");try{exportedLogger.log()}catch(e){exportedLogger=fakeLogger}}else exportedLogger=fakeLogger},logger=exportedLogger}}).default},module.exports=factory())},function(module,exports,__webpack_require__){var YouTubeVideo=__webpack_require__(26);module.exports=YouTubeVideo},function(module,exports,__webpack_require__){var EventEmitter=__webpack_require__(1),cloneDeep=__webpack_require__(2),deepFreeze=__webpack_require__(3),ERROR=__webpack_require__(0);function YouTubeVideo(options){options=options||{};var timeChangedTimeout=isNaN(options.timeChangedTimeout)?100:parseInt(options.timeChangedTimeout,10),containerElement=options.containerElement;if(!(containerElement instanceof HTMLElement))throw new Error("Container element required to be instance of HTMLElement");var apiScriptElement=document.createElement("script");apiScriptElement.type="text/javascript",apiScriptElement.src="https://www.youtube.com/iframe_api",apiScriptElement.onload=function(){if(destroyed)return;if(!YT)return void onAPIError();YT.ready((function(){destroyed||(video=new YT.Player(videoContainerElement,{width:"100%",height:"100%",playerVars:{autoplay:1,cc_load_policy:3,controls:0,disablekb:1,enablejsapi:1,fs:0,iv_load_policy:3,loop:0,modestbranding:1,playsinline:1,rel:0},events:{onError:onVideoError,onReady:onVideoReady,onStateChange:onVideoStateChange,onApiChange:onVideoAPIChange}}))}))},apiScriptElement.onerror=onAPIError,containerElement.appendChild(apiScriptElement);var videoContainerElement=document.createElement("div");videoContainerElement.style.width="100%",videoContainerElement.style.height="100%",videoContainerElement.style.backgroundColor="black",containerElement.appendChild(videoContainerElement);var events=new EventEmitter;events.on("error",(function(){}));var destroyed=!1,ready=!1,stream=null,video=null,pendingLoadArgs=null,selectedSubtitlesTrackId=null,observedProps={stream:!1,paused:!1,time:!1,duration:!1,buffering:!1,volume:!1,muted:!1,subtitlesTracks:!1,selectedSubtitlesTrackId:!1},timeChangedIntervalId=window.setInterval((function(){onPropChanged("time"),onPropChanged("volume"),onPropChanged("muted")}),timeChangedTimeout);function onAPIError(){onError(Object.extend({},ERROR.YOUTUBE_VIDEO.API_LOAD_FAILED,{critical:!0}))}function onVideoError(videoError){var error;switch(videoError.data){case 2:error=ERROR.YOUTUBE_VIDEO.INVALID_PARAMETER;break;case 5:error=ERROR.YOUTUBE_VIDEO.HTML5_VIDEO;break;case 100:error=ERROR.YOUTUBE_VIDEO.VIDEO_NOT_FOUND;break;case 101:case 150:error=ERROR.YOUTUBE_VIDEO.VIDEO_NOT_EMBEDDABLE;break;default:error=ERROR.UNKNOWN_ERROR}onError(Object.extend({},error,{critical:!0,error:videoError}))}function onVideoReady(){ready=!0,null!==pendingLoadArgs&&(command("load",pendingLoadArgs),pendingLoadArgs=null)}function onVideoStateChange(state){switch(onPropChanged("buffering"),state.data){case YT.PlayerState.ENDED:events.emit("ended");break;case YT.PlayerState.CUED:case YT.PlayerState.UNSTARTED:case YT.PlayerState.PAUSED:case YT.PlayerState.PLAYING:onPropChanged("paused"),onPropChanged("time"),onPropChanged("duration")}}function onVideoAPIChange(){video.loadModule("captions"),video.setOption("captions","track",{}),onPropChanged("paused"),onPropChanged("time"),onPropChanged("duration"),onPropChanged("buffering"),onPropChanged("volume"),onPropChanged("muted"),onPropChanged("subtitlesTracks"),onPropChanged("selectedSubtitlesTrackId")}function getProp(propName){switch(propName){case"stream":return stream;case"paused":return null===stream||"function"!=typeof video.getPlayerState?null:video.getPlayerState()!==YT.PlayerState.PLAYING;case"time":return null!==stream&&"function"==typeof video.getCurrentTime&&null!==video.getCurrentTime()&&isFinite(video.getCurrentTime())?Math.floor(1e3*video.getCurrentTime()):null;case"duration":return null!==stream&&"function"==typeof video.getDuration&&null!==video.getDuration()&&isFinite(video.getDuration())?Math.floor(1e3*video.getDuration()):null;case"buffering":return null===stream||"function"!=typeof video.getPlayerState?null:video.getPlayerState()===YT.PlayerState.BUFFERING;case"volume":return null!==stream&&"function"==typeof video.getVolume&&null!==video.getVolume()&&isFinite(video.getVolume())?video.getVolume():null;case"muted":return null===stream||"function"!=typeof video.isMuted?null:video.isMuted();case"subtitlesTracks":return null===stream?[]:(video.getOption("captions","tracklist")||[]).filter((function(track){return track&&"string"==typeof track.languageCode})).map((function(track,index){return Object.freeze({id:String(index),lang:track.languageCode,label:"string"==typeof track.displayName?track.displayName:track.languageCode,origin:"EMBEDDED"})}));case"selectedSubtitlesTrackId":return null===stream?null:selectedSubtitlesTrackId}}function onError(error){events.emit("error",error),error.critical&&command("unload")}function onPropChanged(propName){observedProps[propName]&&events.emit("propChanged",propName,getProp(propName))}function command(commandName,commandArgs){switch(commandName){case"load":if(ready)if(command("unload"),commandArgs&&commandArgs.stream&&"string"==typeof commandArgs.stream.ytId){stream=commandArgs.stream,onPropChanged("stream");var autoplay="boolean"!=typeof commandArgs.autoplay||commandArgs.autoplay,time=null!==commandArgs.time&&isFinite(commandArgs.time)?parseInt(commandArgs.time,10)/1e3:0;autoplay?video.loadVideoById({videoId:commandArgs.stream.ytId,startSeconds:time}):video.cueVideoById({videoId:commandArgs.stream.ytId,startSeconds:time}),onPropChanged("paused"),onPropChanged("time"),onPropChanged("duration"),onPropChanged("buffering"),onPropChanged("volume"),onPropChanged("muted"),onPropChanged("subtitlesTracks"),onPropChanged("selectedSubtitlesTrackId")}else onError(Object.assign({},ERROR.UNSUPPORTED_STREAM,{critical:!0,stream:commandArgs?commandArgs.stream:null}));else pendingLoadArgs=commandArgs;break;case"unload":stream=null,onPropChanged("stream"),selectedSubtitlesTrackId=null,ready&&video.stopVideo(),onPropChanged("paused"),onPropChanged("time"),onPropChanged("duration"),onPropChanged("buffering"),onPropChanged("volume"),onPropChanged("muted"),onPropChanged("subtitlesTracks"),onPropChanged("selectedSubtitlesTrackId");break;case"destroy":command("unload"),destroyed=!0,events.removeAllListeners(),events.on("error",(function(){})),clearInterval(timeChangedIntervalId),ready&&video.destroy(),containerElement.removeChild(apiScriptElement),containerElement.removeChild(videoContainerElement)}}this.on=function(eventName,listener){if(destroyed)throw new Error("Video is destroyed");events.on(eventName,listener)},this.dispatch=function(action){if(destroyed)throw new Error("Video is destroyed");if(action=deepFreeze(cloneDeep(action)))switch(action.type){case"observeProp":return propName=action.propName,void(observedProps.hasOwnProperty(propName)&&(events.emit("propValue",propName,getProp(propName)),observedProps[propName]=!0));case"setProp":return void(function(propName,propValue){switch(propName){case"paused":null!==stream&&(propValue?"function"==typeof video.pauseVideo&&video.pauseVideo():"function"==typeof video.playVideo&&video.playVideo());break;case"time":null!==stream&&"function"==typeof video.seekTo&&null!==propValue&&isFinite(propValue)&&video.seekTo(parseInt(propValue,10)/1e3);break;case"volume":null!==stream&&null!==propValue&&isFinite(propValue)&&("function"==typeof video.unMute&&video.unMute(),"function"==typeof video.setVolume&&video.setVolume(Math.max(0,Math.min(100,parseInt(propValue,10)))),onPropChanged("muted"),onPropChanged("volume"));break;case"muted":null!==stream&&(propValue?"function"==typeof video.mute&&video.mute():"function"==typeof video.unMute&&video.unMute(),onPropChanged("muted"));break;case"selectedSubtitlesTrackId":if(null!==stream){selectedSubtitlesTrackId=null;var selecterdTrack=getProp("subtitlesTracks").find((function(track){return track.id===propValue}));selecterdTrack?(selectedSubtitlesTrackId=selecterdTrack.id,video.setOption("captions","track",{languageCode:selecterdTrack.lang}),events.emit("subtitlesTrackLoaded",selecterdTrack)):video.setOption("captions","track",{}),onPropChanged("selectedSubtitlesTrackId")}}})(action.propName,action.propValue);case"command":return void command(action.commandName,action.commandArgs)}var propName;throw new Error("Invalid action dispatched: "+JSON.stringify(action))}}YouTubeVideo.canPlayStream=function(stream){return Promise.resolve(stream&&"string"==typeof stream.ytId)},YouTubeVideo.manifest={name:"YouTubeVideo",props:["stream","paused","time","duration","buffering","volume","muted","subtitlesTracks","selectedSubtitlesTrackId"],commands:["load","unload","destroy"],events:["propChanged","propValue","ended","error","subtitlesTrackLoaded"]},module.exports=YouTubeVideo},function(module,exports,__webpack_require__){var ChromecastVideo=__webpack_require__(28);module.exports=ChromecastVideo},function(module,exports,__webpack_require__){var EventEmitter=__webpack_require__(1),ERROR=__webpack_require__(0);function ChromecastVideo(options){var containerElement=(options=options||{}).containerElement;if(!(containerElement instanceof HTMLElement))throw new Error("Container element required to be instance of HTMLElement");var chromecastTransport=options.chromecastTransport;if(!chromecastTransport)throw new Error("Chromecast transport required");var device=chromecastTransport.getCastDevice();if(null===device)throw new Error("Chromecast session must be started");var deviceNameContainerElement=document.createElement("div");deviceNameContainerElement.style.display="flex",deviceNameContainerElement.style.flexDirection="row",deviceNameContainerElement.style.alignItems="center",deviceNameContainerElement.style.justifyContent="center",deviceNameContainerElement.style.width="100%",deviceNameContainerElement.style.height="100%",deviceNameContainerElement.style.backgroundColor="black";var deviceNameLabelElement=document.createElement("div");deviceNameLabelElement.style.flex="none",deviceNameLabelElement.style.maxWidth="80%",deviceNameLabelElement.style.fontSize="5vmin",deviceNameLabelElement.style.lineHeight="1.2em",deviceNameLabelElement.style.maxHeight="3.6em",deviceNameLabelElement.style.textAlign="center",deviceNameLabelElement.style.color="#FFFFFF90",deviceNameLabelElement.innerText="Casting to "+device.friendlyName,deviceNameContainerElement.appendChild(deviceNameLabelElement),containerElement.appendChild(deviceNameContainerElement),chromecastTransport.on("message",onMessage);var events=new EventEmitter;events.on("error",(function(){}));var destroyed=!1,observedProps={stream:!1,paused:!1,time:!1,duration:!1,buffering:!1,buffered:!1,volume:!1,muted:!1,subtitlesTracks:!1,selectedSubtitlesTrackId:!1,subtitlesDelay:!1,subtitlesSize:!1,subtitlesOffset:!1,subtitlesTextColor:!1,subtitlesBackgroundColor:!1,subtitlesShadowColor:!1};function onTransportError(error){destroyed||events.emit("error",Object.assign({},ERROR.CAST_VIDEO.MESSAGE_SEND_FAILED,{error}))}function onMessage(message){var parsedMessage;try{parsedMessage=JSON.parse(message)}catch(error){return void events.emit("error",Object.assign({},ERROR.CAST_VIDEO.INVALID_MESSAGE_RECEIVED,{error,data:message}))}if(parsedMessage&&"string"==typeof parsedMessage.event){var args=Array.isArray(parsedMessage.args)?parsedMessage.args:[];events.emit.apply(events,[parsedMessage.event].concat(args))}else events.emit("error",Object.assign({},ERROR.CAST_VIDEO.INVALID_MESSAGE_RECEIVED,{data:message}))}function onPropChanged(propName,propValue){observedProps[propName]&&events.emit("propChanged",propName,propValue)}this.on=function(eventName,listener){if(destroyed)throw new Error("Video is destroyed");events.on(eventName,listener)},this.dispatch=function(action){if(destroyed)throw new Error("Video is destroyed");if(action)switch(action.type){case"observeProp":return propName=action.propName,observedProps.hasOwnProperty(propName)&&(observedProps[propName]=!0),void chromecastTransport.sendMessage(action).catch(onTransportError);case"setProp":return void chromecastTransport.sendMessage(action).catch(onTransportError);case"command":return(function(commandName){switch(commandName){case"destroy":destroyed=!0,onPropChanged("stream",null),onPropChanged("paused",null),onPropChanged("time",null),onPropChanged("duration",null),onPropChanged("buffering",null),onPropChanged("buffered",null),onPropChanged("volume",null),onPropChanged("muted",null),onPropChanged("subtitlesTracks",null),onPropChanged("selectedSubtitlesTrackId",null),onPropChanged("subtitlesDelay",null),onPropChanged("subtitlesSize",null),onPropChanged("subtitlesOffset",null),onPropChanged("subtitlesTextColor",null),onPropChanged("subtitlesBackgroundColor",null),onPropChanged("subtitlesShadowColor",null),events.removeAllListeners(),events.on("error",(function(){})),chromecastTransport.off("message",onMessage),containerElement.removeChild(deviceNameContainerElement)}})(action.commandName,action.commandArgs),void chromecastTransport.sendMessage(action).catch(onTransportError)}var propName;throw new Error("Invalid action dispatched: "+JSON.stringify(action))}}ChromecastVideo.canPlayStream=function(){return Promise.resolve(!0)},ChromecastVideo.manifest={name:"ChromecastVideo",props:["stream","paused","time","duration","buffering","buffered","volume","muted","subtitlesTracks","selectedSubtitlesTrackId","extraSubtitlesTracks","selectedExtraSubtitlesTrackId","extraSubtitlesDelay","extraSubtitlesSize","extraSubtitlesOffset","extraSubtitlesTextColor","extraSubtitlesBackgroundColor","extraSubtitlesShadowColor"],commands:["load","unload","destroy","addExtraSubtitlesTracks"],events:["propChanged","propValue","ended","error","subtitlesTrackLoaded","extraSubtitlesTrackLoaded"]},module.exports=ChromecastVideo},function(module,exports,__webpack_require__){var withHTMLSubtitles=__webpack_require__(30);module.exports=withHTMLSubtitles},function(module,exports,__webpack_require__){var EventEmitter=__webpack_require__(1),cloneDeep=__webpack_require__(2),deepFreeze=__webpack_require__(3),subtitlesRenderer=__webpack_require__(31),fetchSubtitles=__webpack_require__(37);module.exports=function(Video){function VideoWithHTMLSubtitles(options){var video=new Video(options=options||{}),containerElement=options.containerElement;containerElement.style.position="relative";var subtitlesElement=document.createElement("div");subtitlesElement.style.position="absolute",subtitlesElement.style.right="0",subtitlesElement.style.bottom="0",subtitlesElement.style.left="0",subtitlesElement.style.zIndex="1",subtitlesElement.style.textAlign="center",containerElement.appendChild(subtitlesElement);var events=new EventEmitter;events.on("error",(function(){})),video.on("error",onError),video.on("propValue",onVideoPropEvent.bind(null,"propValue")),video.on("propChanged",onVideoPropEvent.bind(null,"propChanged")),Video.manifest.events.filter((function(eventName){return!["error","propChanged","propValue"].includes(eventName)})).forEach((function(eventName){video.on(eventName,(function(eventName){return function(){events.emit.apply(events,[eventName].concat(Array.from(arguments)))}})(eventName))}));var destroyed=!1,videoState={time:null},cuesByTime=null,tracks=[],selectedTrackId=null,delay=null,size=100,offset=0,textColor="#FFFFFFFF",backgroundColor="#00000000",shadowColor="#222222FF",observedProps={extraSubtitlesTracks:!1,selectedExtraSubtitlesTrackId:!1,extraSubtitlesDelay:!1,extraSubtitlesSize:!1,extraSubtitlesOffset:!1,extraSubtitlesTextColor:!1,extraSubtitlesBackgroundColor:!1,extraSubtitlesShadowColor:!1};function renderSubtitles(){for(;subtitlesElement.hasChildNodes();)subtitlesElement.removeChild(subtitlesElement.lastChild);null!==cuesByTime&&null!==videoState.time&&isFinite(videoState.time)&&(subtitlesElement.style.bottom=offset+"%",subtitlesRenderer.render(cuesByTime,videoState.time+delay).map((function(cueNode){return cueNode.style.display="inline-block",cueNode.style.padding="0.2em",cueNode.style.fontSize=Math.floor(size/25)+"vmin",cueNode.style.color=textColor,cueNode.style.backgroundColor=backgroundColor,cueNode.style.textShadow="1px 1px 0.1em "+shadowColor,cueNode})).forEach((function(cueNode){subtitlesElement.append(cueNode,document.createElement("br"))})))}function getProp(propName,videoPropValue){switch(propName){case"extraSubtitlesTracks":return destroyed?[]:tracks.slice();case"selectedExtraSubtitlesTrackId":return destroyed?null:selectedTrackId;case"extraSubtitlesDelay":return destroyed?null:delay;case"extraSubtitlesSize":return destroyed?null:size;case"extraSubtitlesOffset":return destroyed?null:offset;case"extraSubtitlesTextColor":return destroyed?null:textColor;case"extraSubtitlesBackgroundColor":return destroyed?null:backgroundColor;case"extraSubtitlesShadowColor":return destroyed?null:shadowColor;default:return videoPropValue}}function onError(error){events.emit("error",error),error.critical&&(command("unload"),video.dispatch({type:"command",commandName:"unload"}))}function onVideoPropEvent(eventName,propName,propValue){switch(propName){case"time":videoState.time=propValue,renderSubtitles()}events.emit(eventName,propName,getProp(propName,propValue))}function onPropChanged(propName){observedProps[propName]&&events.emit("propChanged",propName,getProp(propName))}function command(commandName,commandArgs){switch(commandName){case"addExtraSubtitlesTracks":return commandArgs&&Array.isArray(commandArgs.tracks)&&(tracks=tracks.concat(commandArgs.tracks).filter((function(track,index,tracks){return track&&"string"==typeof track.id&&"string"==typeof track.url&&"string"==typeof track.lang&&"string"==typeof track.label&&"string"==typeof track.origin&&"EMBEDDED"!==track.origin&&index===tracks.findIndex((function(t){return t.id===track.id}))})),onPropChanged("extraSubtitlesTracks")),!0;case"load":return command("unload"),commandArgs.stream&&Array.isArray(commandArgs.stream.subtitles)&&command("addExtraSubtitlesTracks",{tracks:commandArgs.stream.subtitles.map((function(subtitles,index){return Object.assign({},subtitles,{id:"exclusive_"+index,label:"string"==typeof subtitles.label?subtitles.label:subtitles.lang,origin:"string"==typeof subtitles.origin?subtitles.origin:"EXCLUSIVE"})}))}),!1;case"unload":return cuesByTime=null,tracks=[],selectedTrackId=null,delay=null,renderSubtitles(),onPropChanged("extraSubtitlesTracks"),onPropChanged("selectedExtraSubtitlesTrackId"),onPropChanged("extraSubtitlesDelay"),!1;case"destroy":return command("unload"),destroyed=!0,onPropChanged("extraSubtitlesSize"),onPropChanged("extraSubtitlesOffset"),onPropChanged("extraSubtitlesTextColor"),onPropChanged("extraSubtitlesBackgroundColor"),onPropChanged("extraSubtitlesShadowColor"),events.removeAllListeners(),events.on("error",(function(){})),containerElement.removeChild(subtitlesElement),!1;default:return!1}}this.on=function(eventName,listener){if(destroyed)throw new Error("Video is destroyed");events.on(eventName,listener)},this.dispatch=function(action){if(destroyed)throw new Error("Video is destroyed");if(action=deepFreeze(cloneDeep(action)))switch(action.type){case"observeProp":if((function(propName){switch(propName){case"extraSubtitlesTracks":case"selectedExtraSubtitlesTrackId":case"extraSubtitlesDelay":case"extraSubtitlesSize":case"extraSubtitlesOffset":case"extraSubtitlesTextColor":case"extraSubtitlesBackgroundColor":case"extraSubtitlesShadowColor":return events.emit("propValue",propName,getProp(propName)),observedProps[propName]=!0,!0;default:return!1}})(action.propName))return;break;case"setProp":if((function(propName,propValue){switch(propName){case"selectedExtraSubtitlesTrackId":selectedTrackId=null,delay=null,cuesByTime=null;var selecterdTrack=tracks.find((function(track){return track.id===propValue}));return selecterdTrack&&(selectedTrackId=selecterdTrack.id,delay=0,cuesByTime=null,fetchSubtitles(selecterdTrack).then((function(resp){selectedTrackId===selecterdTrack.id&&(cuesByTime=resp,renderSubtitles(),events.emit("extraSubtitlesTrackLoaded",selecterdTrack))})).catch((function(error){selectedTrackId===selecterdTrack.id&&onError(Object.assign({},error,{critical:!1}))}))),renderSubtitles(),onPropChanged("selectedExtraSubtitlesTrackId"),onPropChanged("extraSubtitlesDelay"),!0;case"extraSubtitlesDelay":return null!==selectedTrackId&&null!==propValue&&isFinite(propValue)&&(delay=parseInt(propValue,10),renderSubtitles(),onPropChanged("extraSubtitlesDelay")),!0;case"extraSubtitlesSize":return null!==propValue&&isFinite(propValue)&&(size=Math.max(0,parseInt(propValue,10)),renderSubtitles(),onPropChanged("extraSubtitlesSize")),!0;case"extraSubtitlesOffset":return null!==propValue&&isFinite(propValue)&&(offset=Math.max(0,Math.min(100,parseInt(propValue,10))),renderSubtitles(),onPropChanged("extraSubtitlesOffset")),!0;case"extraSubtitlesTextColor":return"string"==typeof propValue&&(textColor=propValue,renderSubtitles(),onPropChanged("extraSubtitlesTextColor")),!0;case"extraSubtitlesBackgroundColor":return"string"==typeof propValue&&(backgroundColor=propValue,renderSubtitles(),onPropChanged("extraSubtitlesBackgroundColor")),!0;case"extraSubtitlesShadowColor":return"string"==typeof propValue&&(shadowColor=propValue,renderSubtitles(),onPropChanged("extraSubtitlesShadowColor")),!0;default:return!1}})(action.propName,action.propValue))return;break;case"command":if(command(action.commandName,action.commandArgs))return}video.dispatch(action)}}return VideoWithHTMLSubtitles.canPlayStream=function(stream){return Video.canPlayStream(stream)},VideoWithHTMLSubtitles.manifest={name:Video.manifest.name+"WithHTMLSubtitles",props:Video.manifest.props.concat(["extraSubtitlesTracks","selectedExtraSubtitlesTrackId","extraSubtitlesDelay","extraSubtitlesSize","extraSubtitlesOffset","extraSubtitlesTextColor","extraSubtitlesBackgroundColor","extraSubtitlesShadowColor"]).filter((function(value,index,array){return array.indexOf(value)===index})),commands:Video.manifest.commands.concat(["load","unload","destroy","addExtraSubtitlesTracks"]).filter((function(value,index,array){return array.indexOf(value)===index})),events:Video.manifest.events.concat(["propChanged","propValue","error","extraSubtitlesTrackLoaded"]).filter((function(value,index,array){return array.indexOf(value)===index}))},VideoWithHTMLSubtitles}},function(module,exports,__webpack_require__){var VTTJS=__webpack_require__(10),binarySearchUpperBound=__webpack_require__(11);module.exports={render:function(cuesByTime,time){var nodes=[],timeIndex=binarySearchUpperBound(cuesByTime.times,time);if(-1!==timeIndex)for(var cuesForTime=cuesByTime[cuesByTime.times[timeIndex]],i=0;i<cuesForTime.length;i++){var node=VTTJS.WebVTT.convertCueToDOMTree(window,cuesForTime[i].text);nodes.push(node)}return nodes}}},function(module,exports){!(function(global){function makeColorSet(color,opacity){return void 0===opacity&&(opacity=1),"rgba("+[parseInt(color.substring(0,2),16),parseInt(color.substring(2,4),16),parseInt(color.substring(4,6),16),opacity].join(",")+")"}var fontScale=1;function observe(subject,topic,data){switch(data){case"webvtt.font.color":case"webvtt.font.opacity":var fontColor=Services.prefs.getCharPref("webvtt.font.color"),fontOpacity=Services.prefs.getIntPref("webvtt.font.opacity")/100;WebVTTSet.fontSet=makeColorSet(fontColor,fontOpacity);break;case"webvtt.font.scale":fontScale=Services.prefs.getIntPref("webvtt.font.scale")/100;break;case"webvtt.bg.color":case"webvtt.bg.opacity":var backgroundColor=Services.prefs.getCharPref("webvtt.bg.color"),backgroundOpacity=Services.prefs.getIntPref("webvtt.bg.opacity")/100;WebVTTSet.backgroundSet=makeColorSet(backgroundColor,backgroundOpacity);break;case"webvtt.edge.color":case"webvtt.edge.type":var edgeType=Services.prefs.getIntPref("webvtt.edge.type"),edgeColor=Services.prefs.getCharPref("webvtt.edge.color");WebVTTSet.edgeSet=["","0px 0px ","4px 4px 4px ","-2px -2px ","2px 2px "][edgeType]+makeColorSet(edgeColor)}}if("undefined"!=typeof Services){var WebVTTSet={};["webvtt.font.color","webvtt.font.opacity","webvtt.font.scale","webvtt.bg.color","webvtt.bg.opacity","webvtt.edge.color","webvtt.edge.type"].forEach((function(pref){observe(0,0,pref),Services.prefs.addObserver(pref,observe,!1)}))}var _objCreate=Object.create||(function(){function F(){}return function(o){if(1!==arguments.length)throw new Error("Object.create shim only accepts one parameter.");return F.prototype=o,new F}})();function ParsingError(errorData,message){this.name="ParsingError",this.code=errorData.code,this.message=message||errorData.message}function parseTimeStamp(input){function computeSeconds(h,m,s,f){return 3600*(0|h)+60*(0|m)+(0|s)+(0|f)/1e3}var m=input.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return m?m[3]?computeSeconds(m[1],m[2],m[3].replace(":",""),m[4]):m[1]>59?computeSeconds(m[1],m[2],0,m[4]):computeSeconds(0,m[1],m[2],m[4]):null}function Settings(){this.values=_objCreate(null)}function parseOptions(input,callback,keyValueDelim,groupDelim){var groups=groupDelim?input.split(groupDelim):[input];for(var i in groups)if("string"==typeof groups[i]){var kv=groups[i].split(keyValueDelim);if(2===kv.length)callback(kv[0],kv[1])}}function parseCue(input,cue,regionList){var oInput=input;function consumeTimeStamp(){var ts=parseTimeStamp(input);if(null===ts)throw new ParsingError(ParsingError.Errors.BadTimeStamp,"Malformed timestamp: "+oInput);return input=input.replace(/^[^\sa-zA-Z-]+/,""),ts}function skipWhitespace(){input=input.replace(/^\s+/,"")}if(skipWhitespace(),cue.startTime=consumeTimeStamp(),skipWhitespace(),"--\x3e"!==input.substr(0,3))throw new ParsingError(ParsingError.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '--\x3e'): "+oInput);input=input.substr(3),skipWhitespace(),cue.endTime=consumeTimeStamp(),skipWhitespace(),(function(input,cue){var settings=new Settings;parseOptions(input,(function(k,v){switch(k){case"region":for(var i=regionList.length-1;i>=0;i--)if(regionList[i].id===v){settings.set(k,regionList[i].region);break}break;case"vertical":settings.alt(k,v,["rl","lr"]);break;case"line":var vals=v.split(","),vals0=vals[0];settings.integer(k,vals0),settings.percent(k,vals0)&&settings.set("snapToLines",!1),settings.alt(k,vals0,["auto"]),2===vals.length&&settings.alt("lineAlign",vals[1],["start","middle","end"]);break;case"position":vals=v.split(","),settings.percent(k,vals[0]),2===vals.length&&settings.alt("positionAlign",vals[1],["start","middle","end"]);break;case"size":settings.percent(k,v);break;case"align":settings.alt(k,v,["start","middle","end","left","right"])}}),/:/,/\s/),cue.region=settings.get("region",null),cue.vertical=settings.get("vertical",""),cue.line=settings.get("line","auto"),cue.lineAlign=settings.get("lineAlign","start"),cue.snapToLines=settings.get("snapToLines",!0),cue.size=settings.get("size",100),cue.align=settings.get("align","middle"),cue.position=settings.get("position","auto"),cue.positionAlign=settings.get("positionAlign",{start:"start",left:"start",middle:"middle",end:"end",right:"end"},cue.align)})(input,cue)}ParsingError.prototype=_objCreate(Error.prototype),ParsingError.prototype.constructor=ParsingError,ParsingError.Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}},Settings.prototype={set:function(k,v){this.get(k)||""===v||(this.values[k]=v)},get:function(k,dflt,defaultKey){return defaultKey?this.has(k)?this.values[k]:dflt[defaultKey]:this.has(k)?this.values[k]:dflt},has:function(k){return k in this.values},alt:function(k,v,a){for(var n=0;n<a.length;++n)if(v===a[n]){this.set(k,v);break}},integer:function(k,v){/^-?\d+$/.test(v)&&this.set(k,parseInt(v,10))},percent:function(k,v){return!!(v.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(v=parseFloat(v))>=0&&v<=100)&&(this.set(k,v),!0)}};var ESCAPE={"&amp;":"&","&lt;":"<","&gt;":">","&lrm;":"‎","&rlm;":"‏","&nbsp;":" "},TAG_NAME={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},TAG_ANNOTATION={v:"title",lang:"lang"},NEEDS_PARENT={rt:"ruby"};function parseContent(window,input){function nextToken(){if(!input)return null;var result,m=input.match(/^([^<]*)(<[^>]+>?)?/);return result=m[1]?m[1]:m[2],input=input.substr(result.length),result}function unescape1(e){return ESCAPE[e]}function unescape(s){for(;m=s.match(/&(amp|lt|gt|lrm|rlm|nbsp);/);)s=s.replace(m[0],unescape1);return s}function shouldAdd(current,element){return!NEEDS_PARENT[element.localName]||NEEDS_PARENT[element.localName]===current.localName}function createElement(type,annotation){var tagName=TAG_NAME[type];if(!tagName)return null;var element=window.document.createElement(tagName);element.localName=tagName;var name=TAG_ANNOTATION[type];return name&&annotation&&(element[name]=annotation.trim()),element}for(var t,rootDiv=window.document.createElement("div"),current=rootDiv,tagStack=[];null!==(t=nextToken());)if("<"!==t[0])current.appendChild(window.document.createTextNode(unescape(t)));else{if("/"===t[1]){tagStack.length&&tagStack[tagStack.length-1]===t.substr(2).replace(">","")&&(tagStack.pop(),current=current.parentNode);continue}var node,ts=parseTimeStamp(t.substr(1,t.length-2));if(ts){node=window.document.createProcessingInstruction("timestamp",ts),current.appendChild(node);continue}var m=t.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/);if(!m)continue;if(!(node=createElement(m[1],m[3])))continue;if(!shouldAdd(current,node))continue;m[2]&&(node.className=m[2].substr(1).replace("."," ")),tagStack.push(m[1]),current.appendChild(node),current=node}return rootDiv}var strongRTLRanges=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];function isStrongRTLChar(charCode){for(var i=0;i<strongRTLRanges.length;i++){var currentRange=strongRTLRanges[i];if(charCode>=currentRange[0]&&charCode<=currentRange[1])return!0}return!1}function StyleBox(){}function CueStyleBox(window,cue,styleOptions){var isIE8="undefined"!=typeof navigator&&/MSIE\s8\.0/.test(navigator.userAgent),color="rgba(255, 255, 255, 1)",backgroundColor="rgba(0, 0, 0, 0.8)",textShadow="";void 0!==WebVTTSet&&(color=WebVTTSet.fontSet,backgroundColor=WebVTTSet.backgroundSet,textShadow=WebVTTSet.edgeSet),isIE8&&(color="rgb(255, 255, 255)",backgroundColor="rgb(0, 0, 0)"),StyleBox.call(this),this.cue=cue,this.cueDiv=parseContent(window,cue.text);var styles={color,backgroundColor,textShadow,position:"relative",left:0,right:0,top:0,bottom:0,display:"inline"};isIE8||(styles.writingMode=""===cue.vertical?"horizontal-tb":"lr"===cue.vertical?"vertical-lr":"vertical-rl",styles.unicodeBidi="plaintext"),this.applyStyles(styles,this.cueDiv),this.div=window.document.createElement("div"),styles={textAlign:"middle"===cue.align?"center":cue.align,font:styleOptions.font,whiteSpace:"pre-line",position:"absolute"},isIE8||(styles.direction=(function(cueDiv){var nodeStack=[],text="";if(!cueDiv||!cueDiv.childNodes)return"ltr";function pushNodes(nodeStack,node){for(var i=node.childNodes.length-1;i>=0;i--)nodeStack.push(node.childNodes[i])}function nextTextNode(nodeStack){if(!nodeStack||!nodeStack.length)return null;var node=nodeStack.pop(),text=node.textContent||node.innerText;if(text){var m=text.match(/^.*(\n|\r)/);return m?(nodeStack.length=0,m[0]):text}return"ruby"===node.tagName?nextTextNode(nodeStack):node.childNodes?(pushNodes(nodeStack,node),nextTextNode(nodeStack)):void 0}for(pushNodes(nodeStack,cueDiv);text=nextTextNode(nodeStack);)for(var i=0;i<text.length;i++)if(isStrongRTLChar(text.charCodeAt(i)))return"rtl";return"ltr"})(this.cueDiv),styles.writingMode=""===cue.vertical?"horizontal-tb":"lr"===cue.vertical?"vertical-lr":"vertical-rl".stylesunicodeBidi="plaintext"),this.applyStyles(styles),this.div.appendChild(this.cueDiv);var textPos=0;switch(cue.positionAlign){case"start":textPos=cue.position;break;case"middle":textPos=cue.position-cue.size/2;break;case"end":textPos=cue.position-cue.size}""===cue.vertical?this.applyStyles({left:this.formatStyle(textPos,"%"),width:this.formatStyle(cue.size,"%")}):this.applyStyles({top:this.formatStyle(textPos,"%"),height:this.formatStyle(cue.size,"%")}),this.move=function(box){this.applyStyles({top:this.formatStyle(box.top,"px"),bottom:this.formatStyle(box.bottom,"px"),left:this.formatStyle(box.left,"px"),right:this.formatStyle(box.right,"px"),height:this.formatStyle(box.height,"px"),width:this.formatStyle(box.width,"px")})}}function BoxPosition(obj){var lh,height,width,top,isIE8="undefined"!=typeof navigator&&/MSIE\s8\.0/.test(navigator.userAgent);if(obj.div){height=obj.div.offsetHeight,width=obj.div.offsetWidth,top=obj.div.offsetTop;var rects=(rects=obj.div.childNodes)&&(rects=rects[0])&&rects.getClientRects&&rects.getClientRects();obj=obj.div.getBoundingClientRect(),lh=rects?Math.max(rects[0]&&rects[0].height||0,obj.height/rects.length):0}this.left=obj.left,this.right=obj.right,this.top=obj.top||top,this.height=obj.height||height,this.bottom=obj.bottom||top+(obj.height||height),this.width=obj.width||width,this.lineHeight=void 0!==lh?lh:obj.lineHeight,isIE8&&!this.lineHeight&&(this.lineHeight=13)}function moveBoxToLinePosition(window,styleBox,containerBox,boxPositions){var boxPosition=new BoxPosition(styleBox),cue=styleBox.cue,linePos=(function(cue){if("number"==typeof cue.line&&(cue.snapToLines||cue.line>=0&&cue.line<=100))return cue.line;if(!cue.track||!cue.track.textTrackList||!cue.track.textTrackList.mediaElement)return-1;for(var track=cue.track,trackList=track.textTrackList,count=0,i=0;i<trackList.length&&trackList[i]!==track;i++)"showing"===trackList[i].mode&&count++;return-1*++count})(cue),axis=[];if(cue.snapToLines){var size;switch(cue.vertical){case"":axis=["+y","-y"],size="height";break;case"rl":axis=["+x","-x"],size="width";break;case"lr":axis=["-x","+x"],size="width"}var step=boxPosition.lineHeight,position=step*Math.round(linePos),maxPosition=containerBox[size]+step,initialAxis=axis[0];Math.abs(position)>maxPosition&&(position=position<0?-1:1,position*=Math.ceil(maxPosition/step)*step),linePos<0&&(position+=""===cue.vertical?containerBox.height:containerBox.width,axis=axis.reverse()),boxPosition.move(initialAxis,position)}else{var calculatedPercentage=boxPosition.lineHeight/containerBox.height*100;switch(cue.lineAlign){case"middle":linePos-=calculatedPercentage/2;break;case"end":linePos-=calculatedPercentage}switch(cue.vertical){case"":styleBox.applyStyles({top:styleBox.formatStyle(linePos,"%")});break;case"rl":styleBox.applyStyles({left:styleBox.formatStyle(linePos,"%")});break;case"lr":styleBox.applyStyles({right:styleBox.formatStyle(linePos,"%")})}axis=["+y","-x","+x","-y"],boxPosition=new BoxPosition(styleBox)}var bestPosition=(function(b,axis){for(var bestPosition,specifiedPosition=new BoxPosition(b),percentage=1,i=0;i<axis.length;i++){for(;b.overlapsOppositeAxis(containerBox,axis[i])||b.within(containerBox)&&b.overlapsAny(boxPositions);)b.move(axis[i]);if(b.within(containerBox))return b;var p=b.intersectPercentage(containerBox);percentage>p&&(bestPosition=new BoxPosition(b),percentage=p),b=new BoxPosition(specifiedPosition)}return bestPosition||specifiedPosition})(boxPosition,axis);styleBox.move(bestPosition.toCSSCompatValues(containerBox))}function WebVTT(){}StyleBox.prototype.applyStyles=function(styles,div){for(var prop in div=div||this.div,styles)styles.hasOwnProperty(prop)&&(div.style[prop]=styles[prop])},StyleBox.prototype.formatStyle=function(val,unit){return 0===val?0:val+unit},CueStyleBox.prototype=_objCreate(StyleBox.prototype),CueStyleBox.prototype.constructor=CueStyleBox,BoxPosition.prototype.move=function(axis,toMove){switch(toMove=void 0!==toMove?toMove:this.lineHeight,axis){case"+x":this.left+=toMove,this.right+=toMove;break;case"-x":this.left-=toMove,this.right-=toMove;break;case"+y":this.top+=toMove,this.bottom+=toMove;break;case"-y":this.top-=toMove,this.bottom-=toMove}},BoxPosition.prototype.overlaps=function(b2){return this.left<b2.right&&this.right>b2.left&&this.top<b2.bottom&&this.bottom>b2.top},BoxPosition.prototype.overlapsAny=function(boxes){for(var i=0;i<boxes.length;i++)if(this.overlaps(boxes[i]))return!0;return!1},BoxPosition.prototype.within=function(container){return this.top>=container.top&&this.bottom<=container.bottom&&this.left>=container.left&&this.right<=container.right},BoxPosition.prototype.overlapsOppositeAxis=function(container,axis){switch(axis){case"+x":return this.left<container.left;case"-x":return this.right>container.right;case"+y":return this.top<container.top;case"-y":return this.bottom>container.bottom}},BoxPosition.prototype.intersectPercentage=function(b2){return Math.max(0,Math.min(this.right,b2.right)-Math.max(this.left,b2.left))*Math.max(0,Math.min(this.bottom,b2.bottom)-Math.max(this.top,b2.top))/(this.height*this.width)},BoxPosition.prototype.toCSSCompatValues=function(reference){return{top:this.top-reference.top,bottom:reference.bottom-this.bottom,left:this.left-reference.left,right:reference.right-this.right,height:this.height,width:this.width}},BoxPosition.getSimpleBoxPosition=function(obj){var height=obj.div?obj.div.offsetHeight:obj.tagName?obj.offsetHeight:0,width=obj.div?obj.div.offsetWidth:obj.tagName?obj.offsetWidth:0,top=obj.div?obj.div.offsetTop:obj.tagName?obj.offsetTop:0;return{left:(obj=obj.div?obj.div.getBoundingClientRect():obj.tagName?obj.getBoundingClientRect():obj).left,right:obj.right,top:obj.top||top,height:obj.height||height,bottom:obj.bottom||top+(obj.height||height),width:obj.width||width}},WebVTT.StringDecoder=function(){return{decode:function(data){if(!data)return"";if("string"!=typeof data)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(data))}}},WebVTT.convertCueToDOMTree=function(window,cuetext){return window&&cuetext?parseContent(window,cuetext):null};WebVTT.processCues=function(window,cues,overlay){if(!window||!cues||!overlay)return null;for(;overlay.firstChild;)overlay.removeChild(overlay.firstChild);var paddedOverlay=window.document.createElement("div");if(paddedOverlay.style.position="absolute",paddedOverlay.style.left="0",paddedOverlay.style.right="0",paddedOverlay.style.top="0",paddedOverlay.style.bottom="0",paddedOverlay.style.margin="1.5%",overlay.appendChild(paddedOverlay),(function(cues){for(var i=0;i<cues.length;i++)if(cues[i].hasBeenReset||!cues[i].displayState)return!0;return!1})(cues)){var boxPositions=[],containerBox=BoxPosition.getSimpleBoxPosition(paddedOverlay),styleOptions={font:Math.round(.05*containerBox.height*100)/100*fontScale+"px sans-serif"};!(function(){for(var styleBox,cue,i=0;i<cues.length;i++)cue=cues[i],styleBox=new CueStyleBox(window,cue,styleOptions),paddedOverlay.appendChild(styleBox.div),moveBoxToLinePosition(0,styleBox,containerBox,boxPositions),cue.displayState=styleBox.div,boxPositions.push(BoxPosition.getSimpleBoxPosition(styleBox))})()}else for(var i=0;i<cues.length;i++)paddedOverlay.appendChild(cues[i].displayState)},WebVTT.Parser=function(window,decoder){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=decoder||new TextDecoder("utf8"),this.regionList=[]},WebVTT.Parser.prototype={reportOrThrowError:function(e){if(!(e instanceof ParsingError))throw e;this.onparsingerror&&this.onparsingerror(e)},parse:function(data){var self=this;function collectNextLine(){for(var buffer=self.buffer,pos=0;pos<buffer.length&&"\r"!==buffer[pos]&&"\n"!==buffer[pos];)++pos;var line=buffer.substr(0,pos);return"\r"===buffer[pos]&&++pos,"\n"===buffer[pos]&&++pos,self.buffer=buffer.substr(pos),line}function parseHeader(input){parseOptions(input,(function(k,v){switch(k){case"Region":!(function(input){var settings=new Settings;if(parseOptions(input,(function(k,v){switch(k){case"id":settings.set(k,v);break;case"width":settings.percent(k,v);break;case"lines":settings.integer(k,v);break;case"regionanchor":case"viewportanchor":var xy=v.split(",");if(2!==xy.length)break;var anchor=new Settings;if(anchor.percent("x",xy[0]),anchor.percent("y",xy[1]),!anchor.has("x")||!anchor.has("y"))break;settings.set(k+"X",anchor.get("x")),settings.set(k+"Y",anchor.get("y"));break;case"scroll":settings.alt(k,v,["up"])}}),/=/,/\s/),settings.has("id")){var region=new self.window.VTTRegion;region.width=settings.get("width",100),region.lines=settings.get("lines",3),region.regionAnchorX=settings.get("regionanchorX",0),region.regionAnchorY=settings.get("regionanchorY",100),region.viewportAnchorX=settings.get("viewportanchorX",0),region.viewportAnchorY=settings.get("viewportanchorY",100),region.scroll=settings.get("scroll",""),self.onregion&&self.onregion(region),self.regionList.push({id:settings.get("id"),region})}})(v)}}),/:/)}data&&(self.buffer+=self.decoder.decode(data,{stream:!0}));try{var line;if("INITIAL"===self.state){if(!/\r\n|\n/.test(self.buffer))return this;var m=(line=collectNextLine()).match(/^WEBVTT([ \t].*)?$/);if(!m||!m[0])throw new ParsingError(ParsingError.Errors.BadSignature);self.state="HEADER"}for(var alreadyCollectedLine=!1;self.buffer;){if(!/\r\n|\n/.test(self.buffer))return this;switch(alreadyCollectedLine?alreadyCollectedLine=!1:line=collectNextLine(),self.state){case"HEADER":/:/.test(line)?parseHeader(line):line||(self.state="ID");continue;case"NOTE":line||(self.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(line)){self.state="NOTE";break}if(!line)continue;if(self.cue=new self.window.VTTCue(0,0,""),self.state="CUE",-1===line.indexOf("--\x3e")){self.cue.id=line;continue}case"CUE":try{parseCue(line,self.cue,self.regionList)}catch(e){self.reportOrThrowError(e),self.cue=null,self.state="BADCUE";continue}self.state="CUETEXT";continue;case"CUETEXT":var hasSubstring=-1!==line.indexOf("--\x3e");if(!line||hasSubstring&&(alreadyCollectedLine=!0)){self.oncue&&self.oncue(self.cue),self.cue=null,self.state="ID";continue}self.cue.text&&(self.cue.text+="\n"),self.cue.text+=line;continue;case"BADCUE":line||(self.state="ID");continue}}}catch(e){self.reportOrThrowError(e),"CUETEXT"===self.state&&self.cue&&self.oncue&&self.oncue(self.cue),self.cue=null,self.state="INITIAL"===self.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){try{if(this.buffer+=this.decoder.decode(),(this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state)throw new ParsingError(ParsingError.Errors.BadSignature)}catch(e){this.reportOrThrowError(e)}return this.onflush&&this.onflush(),this}},global.WebVTT=WebVTT})(this)},function(module,exports,__webpack_require__){var root;module.exports&&(this.VTTCue=this.VTTCue||__webpack_require__(34).VTTCue),(root=this).VTTCue.prototype.toJSON=function(){var cue={},self=this;return Object.keys(this).forEach((function(key){"getCueAsHTML"!==key&&"hasBeenReset"!==key&&"displayState"!==key&&(cue[key]=self[key])})),cue},root.VTTCue.create=function(options){if(!options.hasOwnProperty("startTime")||!options.hasOwnProperty("endTime")||!options.hasOwnProperty("text"))throw new Error("You must at least have start time, end time, and text.");var cue=new root.VTTCue(options.startTime,options.endTime,options.text);for(var key in options)cue.hasOwnProperty(key)&&(cue[key]=options[key]);return cue},root.VTTCue.fromJSON=function(json){return this.create(JSON.parse(json))}},function(module,exports){!(function(root){var directionSetting={"":!0,lr:!0,rl:!0},alignSetting={start:!0,middle:!0,end:!0,left:!0,right:!0};function findAlignSetting(value){return"string"==typeof value&&(!!alignSetting[value.toLowerCase()]&&value.toLowerCase())}function extend(obj){for(var i=1;i<arguments.length;i++){var cobj=arguments[i];for(var p in cobj)obj[p]=cobj[p]}return obj}function VTTCue(startTime,endTime,text){var cue=this,isIE8=/MSIE\s8\.0/.test(navigator.userAgent),baseObj={};isIE8?cue=document.createElement("custom"):baseObj.enumerable=!0,cue.hasBeenReset=!1;var _id="",_pauseOnExit=!1,_startTime=startTime,_endTime=endTime,_text=text,_region=null,_vertical="",_snapToLines=!0,_line="auto",_lineAlign="start",_position=50,_positionAlign="middle",_size=50,_align="middle";if(Object.defineProperty(cue,"id",extend({},baseObj,{get:function(){return _id},set:function(value){_id=""+value}})),Object.defineProperty(cue,"pauseOnExit",extend({},baseObj,{get:function(){return _pauseOnExit},set:function(value){_pauseOnExit=!!value}})),Object.defineProperty(cue,"startTime",extend({},baseObj,{get:function(){return _startTime},set:function(value){if("number"!=typeof value)throw new TypeError("Start time must be set to a number.");_startTime=value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"endTime",extend({},baseObj,{get:function(){return _endTime},set:function(value){if("number"!=typeof value)throw new TypeError("End time must be set to a number.");_endTime=value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"text",extend({},baseObj,{get:function(){return _text},set:function(value){_text=""+value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"region",extend({},baseObj,{get:function(){return _region},set:function(value){_region=value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"vertical",extend({},baseObj,{get:function(){return _vertical},set:function(value){var setting=(function(value){return"string"==typeof value&&(!!directionSetting[value.toLowerCase()]&&value.toLowerCase())})(value);if(!1===setting)throw new SyntaxError("An invalid or illegal string was specified.");_vertical=setting,this.hasBeenReset=!0}})),Object.defineProperty(cue,"snapToLines",extend({},baseObj,{get:function(){return _snapToLines},set:function(value){_snapToLines=!!value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"line",extend({},baseObj,{get:function(){return _line},set:function(value){if("number"!=typeof value&&"auto"!==value)throw new SyntaxError("An invalid number or illegal string was specified.");_line=value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"lineAlign",extend({},baseObj,{get:function(){return _lineAlign},set:function(value){var setting=findAlignSetting(value);if(!setting)throw new SyntaxError("An invalid or illegal string was specified.");_lineAlign=setting,this.hasBeenReset=!0}})),Object.defineProperty(cue,"position",extend({},baseObj,{get:function(){return _position},set:function(value){if(value<0||value>100)throw new Error("Position must be between 0 and 100.");_position=value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"positionAlign",extend({},baseObj,{get:function(){return _positionAlign},set:function(value){var setting=findAlignSetting(value);if(!setting)throw new SyntaxError("An invalid or illegal string was specified.");_positionAlign=setting,this.hasBeenReset=!0}})),Object.defineProperty(cue,"size",extend({},baseObj,{get:function(){return _size},set:function(value){if(value<0||value>100)throw new Error("Size must be between 0 and 100.");_size=value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"align",extend({},baseObj,{get:function(){return _align},set:function(value){var setting=findAlignSetting(value);if(!setting)throw new SyntaxError("An invalid or illegal string was specified.");_align=setting,this.hasBeenReset=!0}})),cue.displayState=void 0,isIE8)return cue}VTTCue.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)},root.VTTCue=root.VTTCue||VTTCue})(this)},function(module,exports,__webpack_require__){var root;module.exports&&(this.VTTRegion=__webpack_require__(36).VTTRegion),(root=this).VTTRegion.create=function(options){var region=new root.VTTRegion;for(var key in options)region.hasOwnProperty(key)&&(region[key]=options[key]);return region},root.VTTRegion.fromJSON=function(json){return this.create(JSON.parse(json))}},function(module,exports){!(function(root){var scrollSetting={"":!0,up:!0};function isValidPercentValue(value){return"number"==typeof value&&value>=0&&value<=100}root.VTTRegion=root.VTTRegion||function(){var _width=100,_lines=3,_regionAnchorX=0,_regionAnchorY=100,_viewportAnchorX=0,_viewportAnchorY=100,_scroll="";Object.defineProperties(this,{width:{enumerable:!0,get:function(){return _width},set:function(value){if(!isValidPercentValue(value))throw new Error("Width must be between 0 and 100.");_width=value}},lines:{enumerable:!0,get:function(){return _lines},set:function(value){if("number"!=typeof value)throw new TypeError("Lines must be set to a number.");_lines=value}},regionAnchorY:{enumerable:!0,get:function(){return _regionAnchorY},set:function(value){if(!isValidPercentValue(value))throw new Error("RegionAnchorX must be between 0 and 100.");_regionAnchorY=value}},regionAnchorX:{enumerable:!0,get:function(){return _regionAnchorX},set:function(value){if(!isValidPercentValue(value))throw new Error("RegionAnchorY must be between 0 and 100.");_regionAnchorX=value}},viewportAnchorY:{enumerable:!0,get:function(){return _viewportAnchorY},set:function(value){if(!isValidPercentValue(value))throw new Error("ViewportAnchorY must be between 0 and 100.");_viewportAnchorY=value}},viewportAnchorX:{enumerable:!0,get:function(){return _viewportAnchorX},set:function(value){if(!isValidPercentValue(value))throw new Error("ViewportAnchorX must be between 0 and 100.");_viewportAnchorX=value}},scroll:{enumerable:!0,get:function(){return _scroll},set:function(value){var setting=(function(value){return"string"==typeof value&&(!!scrollSetting[value.toLowerCase()]&&value.toLowerCase())})(value);if(!1===setting)throw new SyntaxError("An invalid or illegal string was specified.");_scroll=setting}}})}})(this)},function(module,exports,__webpack_require__){var ERROR=__webpack_require__(0),subtitlesParser=__webpack_require__(38);module.exports=function(track){return fetch(track.url).then((function(resp){return resp.text()})).catch((function(error){throw Object.assign({},ERROR.WITH_HTML_SUBTITLES.FETCH_FAILED,{track,error})})).then((function(text){var cuesByTime=subtitlesParser.parse(text);if(0===cuesByTime.times.length)throw Object.assign({},ERROR.WITH_HTML_SUBTITLES.PARSE_FAILED,{track});return cuesByTime}))}},function(module,exports,__webpack_require__){var VTTJS=__webpack_require__(10),binarySearchUpperBound=__webpack_require__(11);module.exports={parse:function(text){var nativeVTTCue=window.VTTCue;window.VTTCue=VTTJS.VTTCue;var parser=new VTTJS.WebVTT.Parser(window,VTTJS.WebVTT.StringDecoder()),cues=[],cuesByTime={};parser.oncue=function(c){var cue={startTime:1e3*c.startTime|0,endTime:1e3*c.endTime|0,text:c.text};cues.push(cue),cuesByTime[cue.startTime]=cuesByTime[cue.startTime]||[],cuesByTime[cue.endTime]=cuesByTime[cue.endTime]||[]},parser.parse(text),parser.flush(),window.VTTCue=nativeVTTCue,cuesByTime.times=Object.keys(cuesByTime).map((function(time){return parseInt(time,10)})).sort((function(t1,t2){return t1-t2}));for(var i=0;i<cues.length;i++){cuesByTime[cues[i].startTime].push(cues[i]);for(var j=binarySearchUpperBound(cuesByTime.times,cues[i].startTime)+1;j<cuesByTime.times.length&&!(cues[i].endTime<=cuesByTime.times[j]);j++)cuesByTime[cuesByTime.times[j]].push(cues[i])}for(var k=0;k<cuesByTime.times.length;k++)cuesByTime[cuesByTime.times[k]].sort((function(c1,c2){return c1.startTime-c2.startTime||c1.endTime-c2.endTime}));return cuesByTime}}},function(module,exports,__webpack_require__){var withStreamingServer=__webpack_require__(40);module.exports=withStreamingServer},function(module,exports,__webpack_require__){var EventEmitter=__webpack_require__(1),cloneDeep=__webpack_require__(2),deepFreeze=__webpack_require__(3),convertStreamToURL=__webpack_require__(41),createTranscoder=__webpack_require__(55),transcodeNextSegment=__webpack_require__(56),ERROR=__webpack_require__(0);module.exports=function(Video){function VideoWithStreamingServer(options){var video=new Video(options=options||{});video.on("error",onError),video.on("propChanged",onPropEvent.bind(null,"propChanged")),video.on("propValue",onPropEvent.bind(null,"propValue")),Video.manifest.events.filter((function(eventName){return!["error","propChanged","propValue"].includes(eventName)})).forEach((function(eventName){video.on(eventName,(function(eventName){return function(){events.emit.apply(events,[eventName].concat(Array.from(arguments)))}})(eventName))}));var events=new EventEmitter;events.on("error",(function(){}));var destroyed=!1,observedProps={stream:!1},videoState={time:null,duration:null},loadArgs=null,transcoder=null,transcodingNextSegment=!1,lastStarvationDuration=null,starvationHandlerTimeoutId=null;function isStarving(){return null!==transcoder&&!transcoder.ended&&!transcodingNextSegment&&null===starvationHandlerTimeoutId&&null!==videoState.time&&null!==videoState.duration&&videoState.duration!==lastStarvationDuration&&videoState.time+25e3>videoState.duration}function onStarving(){transcodingNextSegment=!0,lastStarvationDuration=videoState.duration;var loadingТranscoder=transcoder;transcodeNextSegment(transcoder.streamingServerURL,transcoder.hash).then((function(resp){if(loadingТranscoder===transcoder)if(resp.error){if(21!==resp.error.code)throw resp.error;command("load",Object.assign({},loadArgs,{time:videoState.time}))}else transcoder.ended=resp.ended,transcodingNextSegment=!1,isStarving()&&onStarving()})).catch((function(error){loadingТranscoder===transcoder&&onError(Object.assign({},ERROR.WITH_STREAMING_SERVER.TRANSCODING_FAILED,{critical:!0,error}))}))}function onPropEvent(eventName,propName,propValue){switch(propName){case"time":videoState.time=propValue,isStarving()&&onStarving();break;case"duration":videoState.duration=propValue,clearTimeout(starvationHandlerTimeoutId),starvationHandlerTimeoutId=transcodingNextSegment?null:setTimeout((function(){starvationHandlerTimeoutId=null,isStarving()&&onStarving()}),1e3)}events.emit(eventName,propName,getProp(propName,propValue))}function onPropChanged(propName){observedProps[propName]&&events.emit("propChanged",propName,getProp(propName))}function onError(error){events.emit("error",error),error.critical&&(command("unload"),video.dispatch({type:"command",commandName:"unload"}))}function getProp(propName,videoPropValue){switch(propName){case"stream":return null!==loadArgs?loadArgs.stream:null;case"time":return null!==videoPropValue&&null!==transcoder?videoPropValue+transcoder.timeOffset:videoPropValue;case"duration":return null!==transcoder?transcoder.duration:videoPropValue;case"buffered":return null!==videoPropValue&&null!==transcoder?videoPropValue+transcoder.timeOffset:videoPropValue;default:return videoPropValue}}function command(commandName,commandArgs){switch(commandName){case"load":return commandArgs&&commandArgs.stream&&"string"==typeof commandArgs.streamingServerURL?(command("unload"),video.dispatch({type:"command",commandName:"unload"}),loadArgs=commandArgs,onPropChanged("stream"),convertStreamToURL(commandArgs.streamingServerURL,commandArgs.stream,commandArgs.seriesInfo).then((function(mediaURL){return(commandArgs.forceTranscoding?Promise.resolve(!1):Video.canPlayStream({url:mediaURL})).catch((function(error){throw Object.assign({},ERROR.UNKNOWN_ERROR,{error,stream:commandArgs.stream})})).then((function(canPlay){if(canPlay)return{transcoder:null,loadArgsExt:{stream:{url:mediaURL}}};var time=null!==commandArgs.time&&isFinite(commandArgs.time)?parseInt(commandArgs.time,10):0;return createTranscoder(commandArgs.streamingServerURL,mediaURL,time).then((function(transcoder){return{transcoder,loadArgsExt:{time:0,stream:{url:transcoder.url}}}}))}))})).then((function(result){commandArgs===loadArgs&&(transcoder=result.transcoder,video.dispatch({type:"command",commandName:"load",commandArgs:Object.assign({},commandArgs,result.loadArgsExt)}))})).catch((function(error){commandArgs===loadArgs&&onError(Object.assign({},error,{critical:!0}))}))):onError(Object.assign({},ERROR.UNSUPPORTED_STREAM,{critical:!0,stream:commandArgs?commandArgs.stream:null})),!0;case"unload":return clearTimeout(starvationHandlerTimeoutId),loadArgs=null,transcoder=null,transcodingNextSegment=!1,lastStarvationDuration=null,starvationHandlerTimeoutId=null,onPropChanged("stream"),!1;case"destroy":return command("unload"),destroyed=!0,events.removeAllListeners(),events.on("error",(function(){})),!1;default:return!1}}this.on=function(eventName,listener){if(destroyed)throw new Error("Video is destroyed");events.on(eventName,listener)},this.dispatch=function(action){if(destroyed)throw new Error("Video is destroyed");if(action=deepFreeze(cloneDeep(action)))switch(action.type){case"observeProp":if((function(propName){switch(propName){case"stream":return events.emit("propValue",propName,getProp(propName)),observedProps[propName]=!0,!0;default:return!1}})(action.propName))return;break;case"setProp":if((function(propName,propValue){switch(propName){case"time":if(null!==transcoder){if(null!==propValue&&isFinite(propValue))command("load",Object.assign({},loadArgs,{time:parseInt(propValue,10)}));return!0}return!1;default:return!1}})(action.propName,action.propValue))return;break;case"command":if(command(action.commandName,action.commandArgs))return}video.dispatch(action)}}return VideoWithStreamingServer.canPlayStream=function(stream){return Video.canPlayStream(stream)},VideoWithStreamingServer.manifest={name:Video.manifest.name+"WithStreamingServer",props:Video.manifest.props.concat(["stream"]).filter((function(value,index,array){return array.indexOf(value)===index})),commands:Video.manifest.commands.concat(["load","unload","destroy"]).filter((function(value,index,array){return array.indexOf(value)===index})),events:Video.manifest.events.concat(["error"]).filter((function(value,index,array){return array.indexOf(value)===index}))},VideoWithStreamingServer}},function(module,exports,__webpack_require__){var url=__webpack_require__(6),magnet=__webpack_require__(47),parseVideoName=__webpack_require__(54),ERROR=__webpack_require__(0),MEDIA_FILE_EXTENTIONS=/.mkv$|.avi$|.mp4$|.wmv$|.vp8$|.mov$|.mpg$|.ts$|.m3u8$|.webm$|.flac$|.mp3$|.wav$|.wma$|.aac$|.ogg$/i;function inferTorrentFileIdx(streamingServerURL,infoHash,sources,seriesInfo){return fetch(url.resolve(streamingServerURL,"/"+encodeURIComponent(infoHash)+"/create"),{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({torrent:{infoHash,peerSearch:{sources:["dht:"+infoHash].concat(Array.isArray(sources)?sources:[]),min:40,max:150}}})}).then((function(resp){return resp.json()})).catch((function(error){throw Object.assign({},ERROR.WITH_STREAMING_SERVER.TORRENT_CREATE_FAILED,{infoHash,sources,error})})).then((function(resp){if(!resp||!Array.isArray(resp.files)||resp.files.some((function(file){return!file||"string"!=typeof file.path||null===file.length||!isFinite(file.length)})))throw Object.assign({},ERROR.WITH_STREAMING_SERVER.TORRENT_CREATE_FAILED,{infoHash,sources,files:resp.files,error:new Error("Invalid files")});var mediaFiles=resp.files.filter((function(file){return file.path.match(MEDIA_FILE_EXTENTIONS)}));if(0===mediaFiles.length)throw Object.assign({},ERROR.WITH_STREAMING_SERVER.NO_MEDIA_FILES_FOUND,{infoHash,sources,files:resp.files});var mediaFilesForEpisode=seriesInfo?mediaFiles.filter((function(file){try{var info=parseVideoName(file.path);return null!==info.season&&isFinite(info.season)&&info.season===seriesInfo.season&&Array.isArray(info.episode)&&-1!==info.episode.indexOf(seriesInfo.episode)}catch(e){return!1}})):[],selectedFile=(mediaFilesForEpisode.length>0?mediaFilesForEpisode:mediaFiles).reduce((function(result,file){return!result||file.length>result.length?file:result}),null);return resp.files.indexOf(selectedFile)}))}module.exports=function(streamingServerURL,stream,seriesInfo){return new Promise((function(resolve,reject){if("string"==typeof stream.url){if(0!==stream.url.indexOf("magnet:"))return void resolve(stream.url);var parsedMagnetURI;try{parsedMagnetURI=magnet.decode(stream.url)}catch(e){}if(parsedMagnetURI&&"string"==typeof parsedMagnetURI.infoHash){var sources=Array.isArray(parsedMagnetURI.announce)?parsedMagnetURI.announce.map((function(source){return"tracker:"+source})):[];return void inferTorrentFileIdx(streamingServerURL,parsedMagnetURI.infoHash,sources,seriesInfo).then((function(fileIdx){resolve(url.resolve(streamingServerURL,"/"+encodeURIComponent(stream.infoHash)+"/"+encodeURIComponent(fileIdx)))})).catch((function(error){reject(Object.assign({},error,{stream}))}))}}if("string"==typeof stream.infoHash)return null!==stream.fileIdx&&isFinite(stream.fileIdx)?void resolve(url.resolve(streamingServerURL,"/"+encodeURIComponent(stream.infoHash)+"/"+encodeURIComponent(stream.fileIdx))):void inferTorrentFileIdx(streamingServerURL,stream.infoHash,stream.announce,seriesInfo).then((function(fileIdx){resolve(url.resolve(streamingServerURL,"/"+encodeURIComponent(stream.infoHash)+"/"+encodeURIComponent(fileIdx)))})).catch((function(error){reject(Object.assign({},error,{stream}))}));reject(Object.assign({},ERROR.WITH_STREAMING_SERVER.STREAM_CONVERT_FAILED,{stream}))}))}},function(module,exports,__webpack_require__){(function(module,global){var __WEBPACK_AMD_DEFINE_RESULT__;!(function(root){exports&&exports.nodeType,module&&module.nodeType;var freeGlobal="object"==typeof global&&global;freeGlobal.global!==freeGlobal&&freeGlobal.window!==freeGlobal&&freeGlobal.self;var punycode,maxInt=2147483647,regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},floor=Math.floor,stringFromCharCode=String.fromCharCode;function error(type){throw RangeError(errors[type])}function map(array,fn){for(var length=array.length,result=[];length--;)result[length]=fn(array[length]);return result}function mapDomain(string,fn){var parts=string.split("@"),result="";return parts.length>1&&(result=parts[0]+"@",string=parts[1]),result+map((string=string.replace(regexSeparators,".")).split("."),fn).join(".")}function ucs2decode(string){for(var value,extra,output=[],counter=0,length=string.length;counter<length;)(value=string.charCodeAt(counter++))>=55296&&value<=56319&&counter<length?56320==(64512&(extra=string.charCodeAt(counter++)))?output.push(((1023&value)<<10)+(1023&extra)+65536):(output.push(value),counter--):output.push(value);return output}function ucs2encode(array){return map(array,(function(value){var output="";return value>65535&&(output+=stringFromCharCode((value-=65536)>>>10&1023|55296),value=56320|1023&value),output+=stringFromCharCode(value)})).join("")}function digitToBasic(digit,flag){return digit+22+75*(digit<26)-((0!=flag)<<5)}function adapt(delta,numPoints,firstTime){var k=0;for(delta=firstTime?floor(delta/700):delta>>1,delta+=floor(delta/numPoints);delta>455;k+=36)delta=floor(delta/35);return floor(k+36*delta/(delta+38))}function decode(input){var out,basic,j,index,oldi,w,k,digit,t,baseMinusT,codePoint,output=[],inputLength=input.length,i=0,n=128,bias=72;for((basic=input.lastIndexOf("-"))<0&&(basic=0),j=0;j<basic;++j)input.charCodeAt(j)>=128&&error("not-basic"),output.push(input.charCodeAt(j));for(index=basic>0?basic+1:0;index<inputLength;){for(oldi=i,w=1,k=36;index>=inputLength&&error("invalid-input"),((digit=(codePoint=input.charCodeAt(index++))-48<10?codePoint-22:codePoint-65<26?codePoint-65:codePoint-97<26?codePoint-97:36)>=36||digit>floor((maxInt-i)/w))&&error("overflow"),i+=digit*w,!(digit<(t=k<=bias?1:k>=bias+26?26:k-bias));k+=36)w>floor(maxInt/(baseMinusT=36-t))&&error("overflow"),w*=baseMinusT;bias=adapt(i-oldi,out=output.length+1,0==oldi),floor(i/out)>maxInt-n&&error("overflow"),n+=floor(i/out),i%=out,output.splice(i++,0,n)}return ucs2encode(output)}function encode(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,inputLength,handledCPCountPlusOne,baseMinusT,qMinusT,output=[];for(inputLength=(input=ucs2decode(input)).length,n=128,delta=0,bias=72,j=0;j<inputLength;++j)(currentValue=input[j])<128&&output.push(stringFromCharCode(currentValue));for(handledCPCount=basicLength=output.length,basicLength&&output.push("-");handledCPCount<inputLength;){for(m=maxInt,j=0;j<inputLength;++j)(currentValue=input[j])>=n&&currentValue<m&&(m=currentValue);for(m-n>floor((maxInt-delta)/(handledCPCountPlusOne=handledCPCount+1))&&error("overflow"),delta+=(m-n)*handledCPCountPlusOne,n=m,j=0;j<inputLength;++j)if((currentValue=input[j])<n&&++delta>maxInt&&error("overflow"),currentValue==n){for(q=delta,k=36;!(q<(t=k<=bias?1:k>=bias+26?26:k-bias));k+=36)qMinusT=q-t,baseMinusT=36-t,output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0))),q=floor(qMinusT/baseMinusT);output.push(stringFromCharCode(digitToBasic(q,0))),bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength),delta=0,++handledCPCount}++delta,++n}return output.join("")}punycode={version:"1.3.2",ucs2:{decode:ucs2decode,encode:ucs2encode},decode,encode,toASCII:function(input){return mapDomain(input,(function(string){return regexNonASCII.test(string)?"xn--"+encode(string):string}))},toUnicode:function(input){return mapDomain(input,(function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string}))}},void 0===(__WEBPACK_AMD_DEFINE_RESULT__=function(){return punycode}.call(exports,__webpack_require__,exports,module))||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)})()}).call(this,__webpack_require__(9)(module),__webpack_require__(5))},function(module,exports,__webpack_require__){"use strict";module.exports={isString:function(arg){return"string"==typeof arg},isObject:function(arg){return"object"==typeof arg&&null!==arg},isNull:function(arg){return null===arg},isNullOrUndefined:function(arg){return null==arg}}},function(module,exports,__webpack_require__){"use strict";exports.decode=exports.parse=__webpack_require__(45),exports.encode=exports.stringify=__webpack_require__(46)},function(module,exports,__webpack_require__){"use strict";function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}module.exports=function(qs,sep,eq,options){sep=sep||"&",eq=eq||"=";var obj={};if("string"!=typeof qs||0===qs.length)return obj;var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;options&&"number"==typeof options.maxKeys&&(maxKeys=options.maxKeys);var len=qs.length;maxKeys>0&&len>maxKeys&&(len=maxKeys);for(var i=0;i<len;++i){var kstr,vstr,k,v,x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq);idx>=0?(kstr=x.substr(0,idx),vstr=x.substr(idx+1)):(kstr=x,vstr=""),k=decodeURIComponent(kstr),v=decodeURIComponent(vstr),hasOwnProperty(obj,k)?isArray(obj[k])?obj[k].push(v):obj[k]=[obj[k],v]:obj[k]=v}return obj};var isArray=Array.isArray||function(xs){return"[object Array]"===Object.prototype.toString.call(xs)}},function(module,exports,__webpack_require__){"use strict";var stringifyPrimitive=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}};module.exports=function(obj,sep,eq,name){return sep=sep||"&",eq=eq||"=",null===obj&&(obj=void 0),"object"==typeof obj?map(objectKeys(obj),(function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;return isArray(obj[k])?map(obj[k],(function(v){return ks+encodeURIComponent(stringifyPrimitive(v))})).join(sep):ks+encodeURIComponent(stringifyPrimitive(obj[k]))})).join(sep):name?encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj)):""};var isArray=Array.isArray||function(xs){return"[object Array]"===Object.prototype.toString.call(xs)};function map(xs,f){if(xs.map)return xs.map(f);for(var res=[],i=0;i<xs.length;i++)res.push(f(xs[i],i));return res}var objectKeys=Object.keys||function(obj){var res=[];for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&res.push(key);return res}},function(module,exports,__webpack_require__){(function(Buffer){module.exports=magnetURIDecode,module.exports.decode=magnetURIDecode,module.exports.encode=function(obj){(obj=Object.assign({},obj)).infoHashBuffer&&(obj.xt="urn:btih:"+obj.infoHashBuffer.toString("hex"));obj.infoHash&&(obj.xt="urn:btih:"+obj.infoHash);obj.name&&(obj.dn=obj.name);obj.keywords&&(obj.kt=obj.keywords);obj.announce&&(obj.tr=obj.announce);obj.urlList&&(obj.ws=obj.urlList,delete obj.as);let result="magnet:?";return Object.keys(obj).filter(key=>2===key.length).forEach((key,i)=>{(Array.isArray(obj[key])?obj[key]:[obj[key]]).forEach((val,j)=>{!(i>0||j>0)||"kt"===key&&0!==j||(result+="&"),"dn"===key&&(val=encodeURIComponent(val).replace(/%20/g,"+")),"tr"!==key&&"xs"!==key&&"as"!==key&&"ws"!==key||(val=encodeURIComponent(val)),"kt"===key&&(val=encodeURIComponent(val)),result+="kt"===key&&j>0?"+"+val:`${key}=${val}`})}),result};const base32=__webpack_require__(51),uniq=__webpack_require__(53);function magnetURIDecode(uri){const result={},data=uri.split("magnet:?")[1];let m;if((data&&data.length>=0?data.split("&"):[]).forEach(param=>{const keyval=param.split("=");if(2!==keyval.length)return;const key=keyval[0];let val=keyval[1];if("dn"===key&&(val=decodeURIComponent(val).replace(/\+/g," ")),"tr"!==key&&"xs"!==key&&"as"!==key&&"ws"!==key||(val=decodeURIComponent(val)),"kt"===key&&(val=decodeURIComponent(val).split("+")),"ix"===key&&(val=Number(val)),result[key])if(Array.isArray(result[key]))result[key].push(val);else{const old=result[key];result[key]=[old,val]}else result[key]=val}),result.xt){(Array.isArray(result.xt)?result.xt:[result.xt]).forEach(xt=>{if(m=xt.match(/^urn:btih:(.{40})/))result.infoHash=m[1].toLowerCase();else if(m=xt.match(/^urn:btih:(.{32})/)){const decodedStr=base32.decode(m[1]);result.infoHash=Buffer.from(decodedStr,"binary").toString("hex")}})}return result.infoHash&&(result.infoHashBuffer=Buffer.from(result.infoHash,"hex")),result.dn&&(result.name=result.dn),result.kt&&(result.keywords=result.kt),"string"==typeof result.tr?result.announce=[result.tr]:Array.isArray(result.tr)?result.announce=result.tr:result.announce=[],result.urlList=[],("string"==typeof result.as||Array.isArray(result.as))&&(result.urlList=result.urlList.concat(result.as)),("string"==typeof result.ws||Array.isArray(result.ws))&&(result.urlList=result.urlList.concat(result.ws)),uniq(result.announce),uniq(result.urlList),result}}).call(this,__webpack_require__(12).Buffer)},function(module,exports,__webpack_require__){"use strict";exports.byteLength=function(b64){var lens=getLens(b64),validLen=lens[0],placeHoldersLen=lens[1];return 3*(validLen+placeHoldersLen)/4-placeHoldersLen},exports.toByteArray=function(b64){var tmp,i,lens=getLens(b64),validLen=lens[0],placeHoldersLen=lens[1],arr=new Arr((function(b64,validLen,placeHoldersLen){return 3*(validLen+placeHoldersLen)/4-placeHoldersLen})(0,validLen,placeHoldersLen)),curByte=0,len=placeHoldersLen>0?validLen-4:validLen;for(i=0;i<len;i+=4)tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)],arr[curByte++]=tmp>>16&255,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp;2===placeHoldersLen&&(tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4,arr[curByte++]=255&tmp);1===placeHoldersLen&&(tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp);return arr},exports.fromByteArray=function(uint8){for(var tmp,len=uint8.length,extraBytes=len%3,parts=[],i=0,len2=len-extraBytes;i<len2;i+=16383)parts.push(encodeChunk(uint8,i,i+16383>len2?len2:i+16383));1===extraBytes?(tmp=uint8[len-1],parts.push(lookup[tmp>>2]+lookup[tmp<<4&63]+"==")):2===extraBytes&&(tmp=(uint8[len-2]<<8)+uint8[len-1],parts.push(lookup[tmp>>10]+lookup[tmp>>4&63]+lookup[tmp<<2&63]+"="));return parts.join("")};for(var lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;function getLens(b64){var len=b64.length;if(len%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var validLen=b64.indexOf("=");return-1===validLen&&(validLen=len),[validLen,validLen===len?0:4-validLen%4]}function encodeChunk(uint8,start,end){for(var tmp,num,output=[],i=start;i<end;i+=3)tmp=(uint8[i]<<16&16711680)+(uint8[i+1]<<8&65280)+(255&uint8[i+2]),output.push(lookup[(num=tmp)>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[63&num]);return output.join("")}revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63},function(module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:1/0*(s?-1:1);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=value<0||0===value&&1/value<0?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),(value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias))*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}},function(module,exports){var toString={}.toString;module.exports=Array.isArray||function(arr){return"[object Array]"==toString.call(arr)}},function(module,exports,__webpack_require__){var base32=__webpack_require__(52);exports.encode=base32.encode,exports.decode=base32.decode},function(module,exports,__webpack_require__){"use strict";(function(Buffer){var byteTable=[255,255,26,27,28,29,30,31,255,255,255,255,255,255,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255];exports.encode=function(plain){Buffer.isBuffer(plain)||(plain=new Buffer(plain));for(var buff,quintets,i=0,j=0,shiftIndex=0,digit=0,encoded=new Buffer(8*(buff=plain,quintets=Math.floor(buff.length/5),buff.length%5==0?quintets:quintets+1));i<plain.length;){var current=plain[i];shiftIndex>3?(digit=(digit=current&255>>shiftIndex)<<(shiftIndex=(shiftIndex+5)%8)|(i+1<plain.length?plain[i+1]:0)>>8-shiftIndex,i++):(digit=current>>8-(shiftIndex+5)&31,0===(shiftIndex=(shiftIndex+5)%8)&&i++),encoded[j]="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".charCodeAt(digit),j++}for(i=j;i<encoded.length;i++)encoded[i]=61;return encoded},exports.decode=function(encoded){var plainChar,shiftIndex=0,plainDigit=0,plainPos=0;Buffer.isBuffer(encoded)||(encoded=new Buffer(encoded));for(var decoded=new Buffer(Math.ceil(5*encoded.length/8)),i=0;i<encoded.length&&61!==encoded[i];i++){var encodedByte=encoded[i]-48;if(!(encodedByte<byteTable.length))throw new Error("Invalid input - it is not base32 encoded string");plainDigit=byteTable[encodedByte],shiftIndex<=3?0===(shiftIndex=(shiftIndex+5)%8)?(plainChar|=plainDigit,decoded[plainPos]=plainChar,plainPos++,plainChar=0):plainChar|=255&plainDigit<<8-shiftIndex:(plainChar|=255&plainDigit>>>(shiftIndex=(shiftIndex+5)%8),decoded[plainPos]=plainChar,plainPos++,plainChar=255&plainDigit<<8-shiftIndex)}return decoded.slice(0,plainPos)}}).call(this,__webpack_require__(12).Buffer)},function(module,exports,__webpack_require__){"use strict";module.exports=function(list,compare,sorted){return 0===list.length?list:compare?(sorted||list.sort(compare),(function(list,compare){for(var ptr=1,len=list.length,a=list[0],b=list[0],i=1;i<len;++i)if(b=a,compare(a=list[i],b)){if(i===ptr){ptr++;continue}list[ptr++]=a}return list.length=ptr,list})(list,compare)):(sorted||list.sort(),(function(list){for(var ptr=1,len=list.length,a=list[0],b=list[0],i=1;i<len;++i,b=a)if(b=a,(a=list[i])!==b){if(i===ptr){ptr++;continue}list[ptr++]=a}return list.length=ptr,list})(list))}},function(module,exports){var movieKeywords=["1080p","720p","480p","blurayrip","brrip","divx","dvdrip","hdrip","hdtv","tvrip","xvid","camrip"],excluded={};movieKeywords.forEach((function(x){excluded[x]=1}));var SEGMENTS_SPLIT=/\.| |-|;|_/g;module.exports=function(filePath,options){options=options||{};var meta={},segments=filePath.replace(/\\/g,"/").split("/").reverse().filter((function(x){return x})).slice(0,3),firstNameSplit=segments[0].split(/\.| |_/);function saneSeason(){return meta.hasOwnProperty("season")&&!isNaN(meta.season)}function saneEpisode(){return Array.isArray(meta.episode)&&meta.episode.length}[segments[0],segments[1]].filter((function(x){return x})).forEach((function(seg){for(var matches,regex=/\b\d{4}\b/g;matches=regex.exec(seg);){var number=parseInt(matches[0],10);number>=1900&&number<=2030&&(meta.year=number)}}));var pad=function(x){return("00"+x).slice(-2)};[segments[0],segments[1]].filter((function(x){return x})).forEach((function(seg){var aired=seg.match(/(\d\d\d\d)(\.|-| )(\d\d)(\.|-| )(\d\d)/);if(aired&&aired[1]){var year=parseInt(aired[1],10);year>=1900&&year<=2030&&(meta.aired=[year,pad(aired[3]),pad(aired[5])].join("-"))}})),[segments[0],segments[1]].forEach((function(seg){seg&&seg.split(/\.| |_/).forEach((function(x,i){var seasonMatch=x.match(/S(\d{1,2})/i);seasonMatch&&(meta.season=parseInt(seasonMatch[1],10));var episodeMatch=x.match(/E(\d{2})/gi);episodeMatch&&(meta.episode=episodeMatch.map((function(y){return parseInt(y.slice(1),10)})));var xStampMatch=x.match(/(\d\d?)x(\d\d?)/i);xStampMatch&&(meta.season=parseInt(xStampMatch[1],10),meta.episode=[parseInt(xStampMatch[2],10)])}));var fullMatch=seg&&seg.replace(/\.| |;|_/g," ").match(/^([a-zA-Z0-9,-?!'& ]*) S(\d{1,2})E(\d{2})/i);!meta.name&&meta.season&&meta.episode&&fullMatch&&fullMatch[1]&&(meta.name=fullMatch[1])}));var dotStampMatch=segments[0].match(/[^\da-zA-Z](\d\d?)\.(\d\d?)[^\da-zA-Z]/i);if(saneSeason()&&saneEpisode()||!dotStampMatch||meta.year||(meta.season=parseInt(dotStampMatch[1],10),meta.episode=[parseInt(dotStampMatch[2],10)]),!(saneSeason()&&saneEpisode()||options.strict)){var stamp=firstNameSplit.reverse().map((function(x){return x.match(new RegExp("\\d\\d\\d\\d?e"))&&(x=x.slice(0,-1)),x.match(new RegExp("s\\d\\d\\d\\d?"))&&(x=x.slice(1)),x})).filter((function(x){return!isNaN(x)&&(3==x.length||!meta.year&&4==x.length)}))[0];stamp&&(!meta.year||meta.year&&firstNameSplit.indexOf(stamp.toString())<firstNameSplit.indexOf(meta.year.toString()))&&(meta.episode=[parseInt(stamp.slice(-2),10)],meta.season=parseInt(stamp.slice(0,-2),10))}if(!saneSeason()){var seasonMatch=segments.join("/").match(/season(\.| )?(\d{1,2})/gi);seasonMatch&&(meta.season=parseInt(seasonMatch[0].match(/\d/g).join(""),10));var seasonEpMatch=segments.join("/").match(/Season (\d{1,2}) - (\d{1,2})/i);seasonEpMatch&&(meta.season=parseInt(seasonEpMatch[1],10),meta.episode=[parseInt(seasonEpMatch[2],10)])}if(!saneEpisode()){var episodeMatch=segments.join("/").match(/ep(isode)?(\.| )?(\d+)/gi);episodeMatch&&(meta.episode=[parseInt(episodeMatch[0].match(/\d/g).join(""),10)])}var isSample,canBeMovie,diskNumberMatch=segments[0].match(/[ _.-]*(?:cd|dvd|p(?:ar)?t|dis[ck]|d)[ _.-]*(\d)[^\d]/);return diskNumberMatch&&(meta.diskNumber=parseInt(diskNumberMatch[1],10)),(options.fromInside?segments:[].concat(segments).reverse()).forEach((function(seg,i){if(seg==segments[0]){var sourcePrefix=(seg=seg.split(".").slice(0,-1).join(".")).match(/^\[(.*?)\]/);sourcePrefix&&(seg=seg.slice(sourcePrefix[0].length))}var squareBracket=seg.indexOf("[");squareBracket>-1&&(seg=seg.slice(0,squareBracket));var segSplit=seg.split(SEGMENTS_SPLIT),nameParts=[];(isSample=isSample||seg.match(/^sample/i)||seg.match(/^etrg/i),meta.name)||(segSplit.some((function(word,i){if(i,!(word.match("^[a-zA-Z,?!'&]*$")||!isNaN(word)&&word.length<=2||!isNaN(word)&&0==i)||excluded[word.toLowerCase()]||["ep","episode","season"].indexOf(word.toLowerCase())>-1&&!isNaN(segSplit[i+1]))return!0;nameParts.push(word)})),(1!=nameParts.length||isNaN(nameParts[0]))&&(meta.name=nameParts.filter((function(x){return x&&x.length>0})).map((function(x){return x[0].toUpperCase()+x.slice(1).toLowerCase()})).join(" ")))})),isSample=isSample||"sample"==(segments[1]||"").toLowerCase(),canBeMovie=options.strict?meta.hasOwnProperty("year"):meta.hasOwnProperty("year")||meta.hasOwnProperty("diskNumber")||movieKeywords.some((function(keyword){return segments.join("/").toLowerCase().search(keyword)>-1})),meta.name&&meta.aired&&(meta.type="series"),meta.name&&saneSeason()&&saneEpisode()?meta.type="series":meta.name&&canBeMovie?meta.type="movie":"movie"!=meta.type&&meta.name&&saneSeason()?meta.type="extras":meta.type="other",options.fileLength&&options.fileLength<1024*(meta.type.match(/movie/)?80:50)*1024&&meta.type.match(/movie|series/)&&!isSample&&(meta.type="other"),("series"!=meta.type||meta.aired)&&(delete meta.episode,delete meta.season),"series"==meta.type&&meta.year&&(meta.aired=meta.aired||meta.year,delete meta.year),meta.type+=isSample?"-sample":"",meta.name=meta.name&&meta.name.toLowerCase().trim().replace(/\([^\(]+\)$/,"").replace(/&/g,"and").replace(/[^0-9a-z ]+/g," ").split(" ").filter((function(r){return r})).join(" "),options.hints&&options.hints.imdb_id&&(meta.imdb_id=options.hints.imdb_id),meta.tag=[],filePath.match(/1080p/i)&&(meta.tag.push("hd"),meta.tag.push("1080p")),filePath.match(/720p/i)&&meta.tag.push("720p"),filePath.match(/480p/i)&&meta.tag.push("480p"),isSample&&meta.tag.push("sample"),meta}},function(module,exports,__webpack_require__){var url=__webpack_require__(6),ERROR=__webpack_require__(0);module.exports=function(streamingServerURL,mediaURL,time){return fetch(url.resolve(streamingServerURL,"/transcode/create")+"?"+new URLSearchParams([["url",mediaURL],["time",time]]).toString()).then((function(resp){return resp.json()})).then((function(resp){if(resp.error)throw resp.error;if("string"!=typeof resp.hash||null!==resp.duration&&!isFinite(resp.duration)||"boolean"!=typeof resp.ended)throw new Error("Inavalid response: "+JSON.stringify(resp));return Object.assign({},resp,{streamingServerURL,timeOffset:null!==resp.videoTimeOffset&&isFinite(resp.videoTimeOffset)?resp.videoTimeOffset:null!==resp.audioTimeOffset&&isFinite(resp.audioTimeOffset)?resp.audioTimeOffset:0,url:url.resolve(streamingServerURL,"/transcode/"+encodeURIComponent(resp.hash)+"/playlist.m3u8")})})).catch((function(error){throw Object.assign({},ERROR.WITH_STREAMING_SERVER.TRANSCODER_CREATE_FAILED,{error,mediaURL,time})}))}},function(module,exports,__webpack_require__){var url=__webpack_require__(6);module.exports=function(streamingServerURL,hash){return fetch(url.resolve(streamingServerURL,"/transcode/next")+"?"+new URLSearchParams([["hash",hash]]).toString()).then((function(resp){return resp.json()})).then((function(resp){if(!resp.error&&"boolean"!=typeof resp.ended)throw new Error("Inavalid response: "+JSON.stringify(resp));return resp}))}},function(module,exports,__webpack_require__){var _require=__webpack_require__(8),HTMLVideo=_require.HTMLVideo,YouTubeVideo=_require.YouTubeVideo,withStreamingServer=_require.withStreamingServer,withHTMLSubtitles=_require.withHTMLSubtitles;module.exports=function(args){return args.stream&&"string"==typeof args.stream.ytId?withHTMLSubtitles(YouTubeVideo):"string"==typeof args.streamingServerURL?withHTMLSubtitles(withStreamingServer(HTMLVideo)):withHTMLSubtitles(HTMLVideo)}},function(module,exports,__webpack_require__){module.exports={app:"app","app-container":"app-container",layer:"layer","video-layer":"video-layer",video:"video","info-layer":"info-layer"}}]);
    </script>
</body>

</html>